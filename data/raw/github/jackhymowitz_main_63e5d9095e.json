{
  "source_url": "https://github.com/jackhymowitz/main/blob/7325131db23094f1a28bd184b6a68f864f41a729/01_GH_Components/py/BT_DHW_Piping_Banches.py",
  "repo": "jackhymowitz/main",
  "repo_stars": 0,
  "repo_description": "IDF2PH is a free open source toolkit for working with E+ and PHPP Energy Models",
  "license": "GPL-3.0",
  "filepath": "01_GH_Components/py/BT_DHW_Piping_Banches.py",
  "instruction": "Creates DHW Branch Piping sets for the 'DHW+Distribution' PHPP worksheet. Can create up to 5 branch piping sets. Will take in a DataTree of curves from Rhino and calculate their lengths...",
  "code": "#\r\r\n# IDF2PHPP: A Plugin for exporting an EnergyPlus IDF file to the Passive House Planning Package (PHPP). Created by blgdtyp, llc\r\r\n# \r\r\n# This component is part of IDF2PHPP.\r\r\n# \r\r\n# Copyright (c) 2020, bldgtyp, llc <info@bldgtyp.com> \r\r\n# IDF2PHPP is free software; you can redistribute it and/or modify \r\r\n# it under the terms of the GNU General Public License as published \r\r\n# by the Free Software Foundation; either version 3 of the License, \r\r\n# or (at your option) any later version. \r\r\n# \r\r\n# IDF2PHPP is distributed in the hope that it will be useful,\r\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\r\n# GNU General Public License for more details.\r\r\n# \r\r\n# For a copy of the GNU General Public License\r\r\n# see <http://www.gnu.org/licenses/>.\r\r\n# \r\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\r\n#\r\r\n\"\"\"\r\r\nCreates DHW Branch Piping sets for the 'DHW+Distribution' PHPP worksheet. Can create up to 5 branch piping sets. Will take in a DataTree of curves from Rhino and calculate their lengths automatically. Will try and pull curve object attributes from Rhino as well - use attribute setter to assign the pipe diameter, insulation, etc... on the Rhino side.\r\r\n-\r\r\nEM August 10, 2020\r\r\n    Args:\r\r\n        pipe_geom_: <Tree> (Curves) A DataTree with each branch containing curves for one 'set' of recirculation piping. PHPP allows up to 5 'sets' of recirc piping. Each 'set' should include the forward and return piping curves for that distribution leg (ideally as a single continuous curve/loop)\r\r\n        Use the 'Entwine' component to organize geometry into branches before inputing if more than one set of piping. Use an 'ID' component before inputting Rhino geometry.\r\r\n        diameter_: (m) The nominal size of the branch piping. Default is 0.0127m (1/2\").\r\r\n        tapOpenings_: The number of tap openings / person every day. Default is 6 openings/person/day.\r\r\n        utilisation_: The days/year the DHW system is operational. Defauly is 365 days/year.\r\r\n    Returns:\r\r\n        branch_piping_: The Branch Piping object(s). Connect this to the 'branch_piping_' input on the 'DHW System' component in order to pass along to the PHPP.\r\r\n\"\"\"\r\r\n\r\r\nghenv.Component.Name = \"BT_DHW_Piping_Banches\"\r\r\nghenv.Component.NickName = \"Piping | Branches\"\r\r\nghenv.Component.Message = 'AUG_10_2020'\r\r\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\r\r\nghenv.Component.Category = \"BT\"\r\r\nghenv.Component.SubCategory = \"01 | Model\"\r\r\n\r\r\nimport Rhino\r\r\nimport scriptcontext as sc\r\r\nfrom contextlib import contextmanager\r\r\nimport rhinoscriptsyntax as rs\r\r\nimport ghpythonlib.components as ghc\r\r\nimport Grasshopper.Kernel as ghK\r\r\n\r\r\n# Classes and Defs\r\r\npreview = sc.sticky['Preview']\r\r\nPHPP_DHW_branch_piping = sc.sticky['PHPP_DHW_branch_piping']\r\r\n\r\r\n@contextmanager\r\r\ndef rhDoc():\r\r\n    try:\r\r\n        sc.doc = Rhino.RhinoDoc.ActiveDoc\r\r\n        yield\r\r\n    finally:\r\r\n        sc.doc = ghdoc\r\r\n\r\r\ndef cleanInputs(_in, _nm, _default):\r\r\n    # Apply defaults if the inputs are Nones\r\r\n    out = _in if _in != None else _default\r\r\n    \r\r\n    # Check that output can be float\r\r\n    try:\r\r\n        out = float(out)\r\r\n        # Check units\r\r\n        if _nm == \"diameter_\":\r\r\n            if out > 1:\r\r\n                unitWarning = \"Check diameter units? Should be in METERS not MM.\" \r\r\n                ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, unitWarning)\r\r\n        return out\r\r\n    except:\r\r\n        ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, '\"{}\" input should be a number'.format(_nm))\r\r\n        return out\r\r\n\r\r\ndef getTotalPipeLength(_branch):\r\r\n    temp = []\r\r\n    for geom_input in _branch:\r\r\n        try:\r\r\n            temp.append( float(geom_input) )\r\r\n        except:\r\r\n            if isinstance(geom_input, Rhino.Geometry.Curve):\r\r\n                crv = rs.coercecurve(geom_input)\r\r\n                pipeLen = ghc.Length(crv)\r\r\n            else:\r\r\n                pipeLen = False\r\r\n            \r\r\n            if not pipeLen:\r\r\n                crvWarning = \"Something went wrong getting the Pipe Geometry length?\\n\"\\\r\r\n                \"Please ensure you are passing in only curves / polyline objects or numeric values.?\"\r\r\n                ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, crvWarning)\r\r\n            else:\r\r\n                temp.append(pipeLen)\r\r\n        \r\r\n    return temp\r\r\n\r\r\ndef main(_pipe_geom, _openings, _util, _diam):\r\r\n    branch_piping = []\r\r\n    with rhDoc():\r\r\n        for branch in _pipe_geom.Branches:\r\r\n            totalLength = getTotalPipeLength(branch)\r\r\n            \r\r\n            # Create the Branch Piping Object\r\r\n            obj = PHPP_DHW_branch_piping()\r\r\n            obj.totalLength = sum(totalLength)\r\r\n            obj.totalTapPoints = len(branch)\r\r\n            obj.tapOpenings = _openings\r\r\n            obj.utilisation = _util\r\r\n            obj.diameter = _diam\r\r\n            \r\r\n            branch_piping.append(obj)\r\r\n    return branch_piping\r\r\n\r\r\n# Input Defaults, Warnings\r\r\ndiam = cleanInputs(diameter_, \"diameter_\", 0.0127)\r\r\nopenings = cleanInputs(tapOpenings_, \"tapOpenings_\", 6)\r\r\nutil = cleanInputs(utilisation_, \"utilisation_\", 365)\r\r\n\r\r\n# Main\r\r\nif pipe_geom_.BranchCount > 0:\r\r\n    branch_piping_ = main(pipe_geom_, openings, util, diam)\r\r\n\r\r\nif branch_piping_:\r\r\n    for obj in branch_piping_:\r\r\n        print('----\\nDHW Branch Piping:')\r\r\n        preview(obj)\r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}