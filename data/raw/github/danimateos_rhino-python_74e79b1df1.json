{
  "source_url": "https://github.com/danimateos/rhino-python/blob/5955415896e6ece315141e7eb0006b2ccde62e99/trees.py",
  "repo": "danimateos/rhino-python",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "trees.py",
  "instruction": null,
  "code": "import rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\nimport Rhino\r\nfrom Rhino.Geometry import Point3d, Vector3d, Ellipse, Curve\r\nimport math\r\nimport random\r\nimport System\r\n\r\ndef single_curve(scale, n_intermediate=3):\r\n    \r\n    zs = [0]\r\n    ys = [0]\r\n    \r\n    for _ in range(n_intermediate):\r\n        zs.append(scale * random.uniform(0, 1))\r\n        ys.append(random.normalvariate(.5, .2) * scale)\r\n    \r\n    zs.sort()\r\n    zs.append(scale)\r\n    ys.append(0)\r\n    xs = [0] * (n_intermediate + 2)\r\n    \r\n    points = [ Rhino.Geometry.Point3d(x,y,z) for x, y, z in zip(xs, ys, zs) ]\r\n    \r\n    return Curve.CreateInterpolatedCurve(points, degree=3)\r\n    \r\n\r\ndef treetop(scale = 10, **kwargs):\r\n    \r\n    curves = []\r\n    for step in range(4):\r\n        angle = step * math.pi/2\r\n        \r\n        curve = single_curve(scale)\r\n        curve.Rotate(angle, Vector3d(0,0,1), Point3d(0,0,0))\r\n        curves.append(curve)\r\n    \r\n    result = Rhino.Geometry.Brep.CreateFromLoft(curves, Point3d.Unset, Point3d.Unset, Rhino.Geometry.LoftType.Loose, closed=True)\r\n \r\n    # TODO: material: Paint, (100, 200, 100), matte\r\n    return result # For some reason, it returns an array\r\n    \r\n    \r\ndef ellipse(scale = 10, x=0, y=0, z=0):\r\n    base_half_length = scale * random.normalvariate(0.1, .02)\r\n    base_half_width =  scale * random.normalvariate(0.1, .02) \r\n    \r\n    return Rhino.Geometry.Ellipse(Point3d(x,y,z), Point3d(x + base_half_length, y, z), Point3d(x, y + base_half_width, z))\r\n\r\ndef jitter(n):\r\n    return n * random.normalvariate(1, .2)\r\n\r\ndef trunk(scale = 10, n_intermediate = 1, **kwargs):\r\n    \r\n    ellipses = [ellipse(scale)]\r\n    \r\n    for i in range(n_intermediate):\r\n        \r\n        x = jitter(scale/2) - scale / 2\r\n        y = jitter(scale/2) - scale / 2\r\n        z = scale * (i + 1) / (n_intermediate + 1)\r\n        \r\n        this_one = ellipse(scale / 2, x, y, z)\r\n        ellipses.append(this_one)\r\n        \r\n    ellipses.append(ellipse(scale, z = scale))\r\n    \r\n    curves = []\r\n    \r\n    for e in ellipses:\r\n        \r\n        curve = e.ToNurbsCurve()\r\n        curve.Rotate(random.uniform(0, 1) * 2 * math.pi, Vector3d(0,0,1), Point3d(0,0,0))\r\n        #sc.doc.Objects.AddCurve(curve)\r\n        curves.append(curve)\r\n        \r\n    # Normal Loft returns a lot funkier trunks\r\n    result = Rhino.Geometry.Brep.CreateFromLoft(curves, Point3d.Unset, Point3d.Unset, Rhino.Geometry.LoftType.Loose, closed=False)\r\n    result = result[0].CapPlanarHoles(1e-2)\r\n    \r\n    return [result]\r\n \r\ndef tree(scale = 10, **kwargs):\r\n    \r\n    top = treetop(scale, **kwargs)[0]\r\n    tr = trunk(scale, **kwargs)[0]\r\n    \r\n    center_top = Rhino.Geometry.AreaMassProperties.Compute(top).Centroid\r\n    apex_trunk = tr.ClosestPoint(Point3d(0,0, 2*scale))\r\n    \r\n    \r\n    top.Translate(apex_trunk - center_top)\r\n    \r\n    # TODO: align to center of mass\r\n    \r\n    return [tr, top]\r\n    \r\ndef rendermaterial(name):\r\n    for rendermaterial in sc.doc.RenderMaterials.GetEnumerator():\r\n        if rendermaterial.Name == name:\r\n            return rendermaterial\r\n\r\n\r\ndef many(scale = 10, side = 5, **kwargs):\r\n    \"\"\"temp function for playing around\r\n    \"\"\"\r\n    attributes = Rhino.DocObjects.ObjectAttributes()\r\n    attributes.MaterialSource = Rhino.DocObjects.ObjectMaterialSource.MaterialFromObject\r\n    \r\n    for x in range(-scale * side, scale * side, 2 * scale):\r\n        for y in range(-scale * side, scale * side, 2 * scale):\r\n            ids = []\r\n            for ix, each in enumerate(tree(scale, **kwargs)):\r\n                \r\n                each.Translate(x, y, 0)\r\n\r\n                this_id = sc.doc.Objects.AddBrep(each, attributes)\r\n                obj = rs.coercerhinoobject(this_id)\r\n                obj.RenderMaterial = rendermaterial('bark') if ix == 0 else rendermaterial('leaves')\r\n                obj.CommitChanges()\r\n                \r\n                ids.append(this_id)\r\n            \r\n                \r\n            group_id = sc.doc.Groups.Add(ids)\r\n            \r\n    sc.doc.Views.Redraw()\r\n    \r\n\r\n    \r\ndef add_materials():\r\n    \r\n    if sc.doc.RenderMaterials.Count > 0:\r\n        return list(sc.doc.RenderMaterials.GetEnumerator())\r\n    \r\n    leaves = Rhino.DocObjects.Material()\r\n    light_green = System.Drawing.Color.FromArgb(255, 100, 200, 100)\r\n    leaves.DiffuseColor = light_green\r\n    leaves.Name = 'leaves'\r\n    render_leaves = Rhino.Render.RenderMaterial.CreateBasicMaterial(leaves)\r\n    sc.doc.RenderMaterials.Add(render_leaves)\r\n    \r\n    \r\n    bark = Rhino.DocObjects.Material()\r\n    light_brown = System.Drawing.Color.FromArgb(255, 200, 100, 30)\r\n    bark.DiffuseColor = light_brown\r\n    bark.Name = 'bark'\r\n    render_bark = Rhino.Render.RenderMaterial.CreateBasicMaterial(bark)\r\n    sc.doc.RenderMaterials.Add(render_bark)\r\n\r\n    # from https://github.com/mcneel/rhino-developer-samples/blob/6/rhinopython/SampleAddRenderMaterials.py\r\n    \r\n    \r\n    return render_leaves, render_bark\r\n    \r\nif __name__ == \"__main__\":\r\n    \r\n    \r\n    leaves, bark = add_materials()\r\n    many(side = 5)\r\n           \r\n    \r\n    sc.doc.Views.Redraw()",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}