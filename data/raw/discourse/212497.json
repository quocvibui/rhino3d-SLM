{
  "source_url": "https://discourse.mcneel.com/t/new-revision-cloud-s/212497",
  "topic_id": 212497,
  "title": "New Revision Cloud(s)",
  "question": "Revit:\n\n\n\n\n15+ Years\n\n\n$2,500+ / year\n\n\nWho knows how many developers.\n\n\n\n\nIt’s basically just the same two arcs repeating over and over again. It’s hokey.\n\n\nimage\n213×178 5.38 KB\n\n\nMe (and Rhino 3D and Grok AI):\n\n\n\n\n2 hours\n\n\n2 glasses of wine\n\n\n$1,000 (+/-) perpetual license\n\n\n$30/month for ‘Super Grok’ - but I can shut that down whenever I want.\n\n\n\n\nIt’s everything I want a revision cloud to be!! Random. Bold (similar to AutoCAD’s calligraphy style). I eventually spent more than two hours (various tweaks + the pline version)… but common!! Given how much revisions Revit drawings need you’d think they’d make the revision clouds easier on the eyes.\n\n\nimage\n481×262 9.14 KB\n\n\nRhino’s built-in revision clouds are pretty okay. The command is begging for some scripting however. And even with a simply Rhino script you can make it much much better. I may end up doing that if this approach proves troublesome.\n\n\nA native Rhino revision cloud (a command script/alias is your friend!!):\n\n\nimage\n363×313 7.88 KB\n\n\nThere’s a few catches:\n\n\n\n\nIt’s mostly AI code and I haven’t completely deciphered it yet. It can likely be streamlined quite a bit.\n\n\nThe code will crash if you don’t have my block/layer in your drawing. You may want to adjust the layering to suite you.\n\n\nIt might slow down as the drawing file gets bigger due to it iterating through each block multiple times. I’m teaching myself how to work with XForms and had to do the transforms 1 by 1 to make sure they were doing the right thing.\n\n\n\n\nAll these issues are completely solvable. In the short term I might just use a combination of a script and a command alias using the existing REVCLOUD command - even that will be much better than Revit. Like a lot of my code, the ideal usage is a delete/replace rather than trying to edit the existing object - the code will group everything to make this easier. It would be nice if the rectangle/pline were chosen via a command line option… and maybe add to that a sticky variable to rememb...",
  "code_blocks": [
    {
      "code": "import rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport Rhino\nimport random\nimport math\n\n# -------------------------------------------------------------\n# Tiny helper: applies only the Y-scale in the block's LOCAL direction\n# -------------------------------------------------------------\ndef apply_local_y_scale(block_id, direction_angle_deg, y_variation):\n    \"\"\"\n    block_id           : GUID of the inserted block instance\n    direction_angle_deg: angle of the edge (from world X-axis)\n    y_variation        : +/- 2.5 units → converted to scale factor\n    \"\"\"\n    obj = sc.doc.Objects.FindId(block_id)\n    if not obj or not isinstance(obj, Rhino.DocObjects.InstanceObject):\n        return False\n\n    # Base point = insertion point\n    base_pt = obj.InsertionPoint\n\n    # Local Y direction = rotated 90 degrees from travel direction\n    # We want outward bumps → rotate +90° from direction (CCW)\n    local_y_angle = direction_angle_deg + 90.0\n    rad = math.radians(local_y_angle)\n    dir_y = Rhino.Geometry.Vector3d(math.cos(rad), math.sin(rad), 0)\n\n    # Scale factor for Y\n    y_scale = (10.0 + y_variation) / 10.0\n\n    # Non-uniform scale: X=1, Y=y_scale, Z=1, anchored at base point\n    plane = Rhino.Geometry.Plane(base_pt, dir_y, Rhino.Geometry.Vector3d.ZAxis)\n    xform = Rhino.Geometry.Transform.Scale(plane, 1.0, y_scale, 1.0)\n\n    return sc.doc.Objects.Transform(block_id, xform, True)\n\n\n# -------------------------------------------------------------\n# Main function — back to the clean, working version\n# -------------------------------------------------------------\ndef create_custom_revision_cloud():\n    pts = rs.GetRectangle()\n    if not pts or len(pts) != 4:\n        print(\"Failed to pick rectangle.\")\n        return\n\n    # Clockwise starting from top-left: TL → TR → BR → BL\n    vertices = [pts[3], pts[2], pts[1], pts[0]]\n\n    block_name = \"X-RevCloud Segment-1\"\n    if not rs.IsBlock(block_name):\n        print(\"Block '{}' not found.\".format(block_name))\n        return\n\n    inserted = []\n\n    for i in range(4):\n        start = vertices[i]\n        end   = vertices[(i + 1) % 4]\n\n        vec    = rs.VectorCreate(end, start)\n        length = rs.Distance(start, end)\n        if length < 0.001: continue\n\n        seg_count = max(1, int(length / 10.0 + 0.5))\n        spacings = [10 + random.uniform(-5, 5) for _ in range(seg_count)]\n        spacings = [s * (length / sum(spacings)) for s in spacings]\n\n        unit_vec = rs.VectorUnitize(vec)\n        angle_deg = math.degrees(math.atan2(unit_vec[1], unit_vec[0]))\n\n        cum = 0.0\n        for spacing in spacings:\n            pos = rs.PointAdd(start, rs.VectorScale(unit_vec, cum))\n\n            uniform_scale = spacing / 10.0\n            scale_tuple = (uniform_scale, uniform_scale, uniform_scale)\n\n            blk_id = rs.InsertBlock(\n                block_name,\n                pos,\n                scale=scale_tuple,\n                angle_degrees=angle_deg\n            )\n            if not blk_id:\n                cum += spacing\n                continue\n\n            # Now apply the independent LOCAL Y-scale\n            y_var = random.uniform(-2.5, 2.5)\n            apply_local_y_scale(blk_id, angle_deg, y_var)\n\n            inserted.append(blk_id)\n            cum += spacing\n\n    # Group\n    if inserted:\n        if rs.IsLayer(\"01-Anno-Markups\"):\n            rs.ObjectLayer(inserted, \"01-Anno-Markups\")\n        elif rs.IsLayer(\"01-Anno::01-Anno-Markups\"):\n            rs.ObjectLayer(inserted, \"01-Anno::01-Anno-Markups\")\n        \n        rs.AddObjectsToGroup(inserted, rs.AddGroup())\n        print(\"Custom revision cloud complete — {} segments\".format(len(inserted)))\n    sc.doc.Views.Redraw()\n\n# -------------------------------------------------------------\nif __name__ == \"__main__\":\n    create_custom_revision_cloud()",
      "language": "python",
      "author": "keithscadservices",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "layers",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 1,
  "views": 82
}