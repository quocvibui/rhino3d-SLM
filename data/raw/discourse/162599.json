{
  "source_url": "https://discourse.mcneel.com/t/mass-saving-with-options-python-script/162599",
  "topic_id": 162599,
  "title": "Mass saving with options. python script",
  "question": "his script is designed to automate several tasks in Rhino, including setting all viewports to wireframe, purging unused items, saving files in a smaller format, and deleting backup files. The script also allows the user to save files in a different location with a timestamp appended to the filename.\n\n\nHereâ€™s a step-by-step summary of what the script does:\n\n\n\n\nThe script first opens a dialog box asking the user to select a folder.\n\n\nThe script then asks the user several questions about what tasks they want to perform. The user can choose whether to set all viewports to wireframe, purge unused items, save files in a smaller format, save files in a different location, and delete backup files.\n\n\nIf the user chooses to save files in a different location, the script opens another dialog box asking the user to select a folder to save the files.\n\n\nThe script then opens a log file in the selected folder to record the processing of each file.\n\n\nIf a folder was selected, the script gets a list of all Rhino files in the folder and its subfolders.\n\n\nThe script sorts the files by the date they were last modified in descending order.\n\n\nThe script then loops through each file, performing the following tasks for each file:\n\n\n\n\n\n\nThe script opens the file in Rhino.\n\n\nThe script gets the current file path.\n\n\nIf the document has a path, the script performs the following tasks:\n\n\n\nIf the user chose to set all viewports to wireframe, the script sets all viewports to wireframe.\n\n\nIf the user chose to purge unused items, the script purges unused items.\n\n\nIf the user chose to save files in a smaller format, the script saves the document in a smaller format. If the user also chose to save files in a different location, the script saves the file in the selected folder with a timestamp appended to the filename. Otherwise, the script saves the file in its current location.\n\n\nThe script writes the path of the processed file to the log file.\n\n\n\n\n\n\nThe script opens a new document in Rhino.\n\n\n\n\n\n\nI...",
  "code_blocks": [
    {
      "code": "import rhinoscriptsyntax as rs\nimport os\nimport glob\nimport datetime\n\n# Open a dialog to choose a folder\nfolder = rs.BrowseForFolder(message=\"Select a folder\")\n\n# Ask the user for options\nwireframe = rs.GetBoolean(\"Set all viewports to wireframe?\", [(\"Wireframe\", \"Yes\", \"No\")], [True])[0]\npurge = rs.GetBoolean(\"Purge unused items?\", [(\"Purge\", \"Yes\", \"No\")], [True])[0]\ndelete_bak = rs.GetBoolean(\"Delete .3dmbak files?\", [(\"Delete\", \"Yes\", \"No\")], [True])[0]\nsave_small = rs.GetBoolean(\"Save small?\", [(\"SaveSmall\", \"Yes\", \"No\")], [True])[0]\nsave_as = rs.GetBoolean(\"Save as?\", [(\"SaveAs\", \"Yes\", \"No\")], [False])[0]\nsave_as_folder = None\nif save_as:\n    save_as_folder = rs.BrowseForFolder(message=\"Select a folder to save files\")\n\n# Open a log file\nwith open(os.path.join(folder, \"log.txt\"), \"w\") as log_file:\n    # Check if a folder was selected\n    if folder:\n        # Get a list of all Rhino files in the folder and subfolders\n        files = [os.path.join(dirpath, file) for dirpath, dirnames, files in os.walk(folder) for file in files if file.endswith(\".3dm\")]\n        \n        # Sort the files by modified date in descending order\n        files.sort(key=os.path.getmtime, reverse=True)\n        \n        # Loop through each file\n        for file in files:\n            # Open the file\n            rs.Command(\"_-Open \" + '\"' + file + '\"' + \" _Enter\", True)\n            \n            # Get the current file path\n            current_path = rs.DocumentPath()\n            \n            # Check if the document has a path\n            if current_path:\n                # Set all viewports to wireframe\n                if wireframe:\n                    viewports = rs.ViewNames()\n                    for viewport in viewports:\n                        rs.ViewDisplayMode(viewport, mode=\"Wireframe\")\n                \n                # Purge unused items\n                if purge:\n                    rs.Command(\"_-Purge _Enter\", True)\n                \n                # Save the document\n                if save_small:\n                    if save_as and save_as_folder:\n                        # Get the current date and time\n                        now = datetime.datetime.now().strftime(\"%Y%m%d_%H%M%S\")\n                        # Get the base file name\n                        base_name = os.path.splitext(os.path.basename(current_path))[0]\n                        # Create a new file name with the current date and time appended\n                        new_file_name = base_name + \"_\" + now + \".3dm\"\n                        new_path = os.path.join(save_as_folder, new_file_name)\n                        rs.Command(\"_-SaveAs \" + '\"' + new_path + '\"' + \" _Enter\", True)\n                    else:\n                        rs.Command(\"_-SaveSmall \" + '\"' + current_path + '\"' + \" _Enter\", True)\n                \n                # Write to the log file\n                log_file.write(\"Processed file: \" + current_path + \"\\n\")\n            \n            # Open a new document\n            rs.Command(\"_-New _None _Enter\", True)\n        \n        # Delete .3dmbak files\n        if delete_bak:\n            bak_files = [os.path.join(dirpath, file) for dirpath, dirnames, files in os.walk(folder) for file in files if file.endswith(\".3dmbak\")]\n            for bak_file in bak_files:\n                os.remove(bak_file)",
      "language": "python",
      "author": "krishnapparmar1995",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "file-io",
    "geometry",
    "python",
    "rhinoscriptsyntax",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 147,
  "posts_count": 1,
  "views": 297
}