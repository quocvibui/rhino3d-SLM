{
  "source_url": "https://github.com/jmpz63/WallPanelization/blob/5cc5ca05e3bf71e0f2900b5e4d6e2fbec1f49bdf/ghpython_exporter.py",
  "repo": "jmpz63/WallPanelization",
  "repo_stars": 0,
  "repo_description": "Wall Panel Project",
  "license": "unknown",
  "filepath": "ghpython_exporter.py",
  "instruction": "GhPython exporter script for Grasshopper",
  "code": "\"\"\"\nGhPython exporter script for Grasshopper\n\nInputs expected on the GhPython component:\n- geometry_in (Geometry, List access): studs, plates, sheathing as Rhino geometry (Brep/Extrusion/etc.)\n- panel_id (String, Item): optional, defaults to \"PANEL_W1\"\n- stud_ratio_threshold (Number, Item): optional, defaults to 8.0\n\nOutputs:\n- json_output (string): a JSON string matching schema/schema.json (array of component objects)\n\nPaste the contents of this file into a GhPython component.\n\"\"\"\n\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport json\n\n\ndef _get_mm_scale():\n    try:\n        return Rhino.RhinoMath.UnitScale(sc.doc.ModelUnitSystem, Rhino.UnitSystem.Millimeters)\n    except:\n        return 1.0\n\n\ndef _bbox_dims_mm(geom, scale):\n    # Try oriented bbox first for better dims on rotated parts\n    obb = Rhino.Geometry.BoundingBox.Empty\n    try:\n        obb_success, obb = geom.GetBoundingBox(True)\n    except:\n        obb_success = False\n    if not obb_success:\n        bb = geom.GetBoundingBox(False)\n        if not bb.IsValid:\n            bb = geom.GetBoundingBox(True)\n        size = bb.Max - bb.Min\n        sx, sy, sz = abs(size.X) * scale, abs(size.Y) * scale, abs(size.Z) * scale\n        center = bb.Center\n        cx, cy, cz = center.X * scale, center.Y * scale, center.Z * scale\n    else:\n        # RhinoCommon GetBoundingBox(True) may return a tuple differently per type; fallback to world bbox if needed\n        bb = geom.GetBoundingBox(True)\n        if isinstance(bb, Rhino.Geometry.BoundingBox):\n            size = bb.Max - bb.Min\n            sx, sy, sz = abs(size.X) * scale, abs(size.Y) * scale, abs(size.Z) * scale\n            center = bb.Center\n            cx, cy, cz = center.X * scale, center.Y * scale, center.Z * scale\n        else:\n            # Final fallback\n            bb = geom.GetBoundingBox(False)\n            size = bb.Max - bb.Min\n            sx, sy, sz = abs(size.X) * scale, abs(size.Y) * scale, abs(size.Z) * scale\n            center = bb.Center\n            cx, cy, cz = center.X * scale, center.Y * scale, center.Z * scale\n\n    dims = sorted([sx, sy, sz], reverse=True)\n    length, width, depth = dims[0], dims[1], dims[2]\n    return length, width, depth, (cx, cy, cz)\n\n\ndef _classify_type(length_mm, depth_mm, threshold):\n    denom = depth_mm if depth_mm > 1e-9 else 1e-9\n    ratio = float(length_mm) / denom\n    if ratio >= threshold:\n        return \"STUD_2X4\", ratio\n    else:\n        return \"SHEATHING_OSB\", ratio\n\n\ndef export_json(geometry_in, panel_id=None, stud_ratio_threshold=None):\n    scale = _get_mm_scale()\n    if not panel_id:\n        panel_id = \"PANEL_W1\"\n    try:\n        threshold = float(stud_ratio_threshold) if stud_ratio_threshold is not None else 8.0\n    except:\n        threshold = 8.0\n\n    fabrication_data = []\n\n    idx = 0\n    for g in (geometry_in or []):\n        if g is None:\n            continue\n        try:\n            length_mm, width_mm, depth_mm, (px, py, pz) = _bbox_dims_mm(g, scale)\n        except Exception:\n            continue\n\n        comp_type, ratio = _classify_type(length_mm, depth_mm, threshold)\n        comp_id = \"{}_{}\".format(comp_type, str(idx).zfill(3))\n\n        comp = {\n            \"id\": comp_id,\n            \"type\": comp_type,\n            \"panel_id\": panel_id,\n            \"pos_x_mm\": round(px, 3),\n            \"pos_y_mm\": round(py, 3),\n            \"pos_z_mm\": round(pz, 3),\n            \"length_mm\": round(length_mm, 3),\n            \"width_mm\": round(width_mm, 3),\n            \"depth_mm\": round(depth_mm, 3)\n        }\n        fabrication_data.append(comp)\n        idx += 1\n\n    return json.dumps(fabrication_data, indent=2)\n\n\n# If running in GhPython, assign to output variable json_output\ntry:\n    json_output = export_json(geometry_in, panel_id, stud_ratio_threshold)\nexcept NameError:\n    # If executed outside Grasshopper, provide a small smoke test\n    box = Rhino.Geometry.Box(Rhino.Geometry.Plane.WorldXY, Rhino.Geometry.Interval(0,1000), Rhino.Geometry.Interval(0,100), Rhino.Geometry.Interval(0,40))\n    brep = box.ToBrep()\n    json_output = export_json([brep], \"PANEL_TEST\", 8.0)\n    print(json_output)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "RhinoCommon",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}