{
  "source_url": "https://github.com/BlockResearchGroup/compas_3gs/blob/162cecfbeb8806340a55713ec3a0bce7cc932c89/examples/_old_examples/to_be_updated/z_11_cell_arearisation.py",
  "repo": "BlockResearchGroup/compas_3gs",
  "repo_stars": 11,
  "repo_description": "3D graphic statics add-on for the COMPAS framework",
  "license": "MIT",
  "filepath": "examples/_old_examples/to_be_updated/z_11_cell_arearisation.py",
  "instruction": "Z 11 cell arearisation",
  "code": "from __future__ import absolute_import\nfrom __future__ import print_function\nfrom __future__ import division\n\nimport compas\n\nfrom compas.utilities import i_to_blue\n\nfrom compas_rhino.artists import MeshArtist\n\nfrom compas_rhino.helpers import mesh_from_surface\nfrom compas_rhino.helpers import mesh_select_face\nfrom compas_rhino.helpers import mesh_select_faces\n\nfrom compas_3gs.algorithms import mesh_planarise\n\nfrom compas_3gs.rhino import MeshConduit\n\nfrom compas_3gs.diagrams import Cell\n\nfrom compas_3gs.utilities import cell_face_flatness\nfrom compas_3gs.utilities import compare_initial_current\n\ntry:\n    import rhinoscriptsyntax as rs\n\nexcept ImportError:\n    compas.raise_if_ironpython()\n\n\n__author__     = 'Juney Lee'\n__copyright__  = 'Copyright 2019, BLOCK Research Group - ETH Zurich'\n__license__    = 'MIT License'\n__email__      = 'juney.lee@arch.ethz.ch'\n\n\n# ------------------------------------------------------------------------------\n# 1. make cell from rhino polysurfaces\n# ------------------------------------------------------------------------------\nlayer = 'cell'\n\nguid = rs.GetObject(\"select a closed polysurface\", filter=rs.filter.polysurface)\nrs.HideObjects(guid)\n\ncell = mesh_from_surface(Cell, guid)\n\n\n# ------------------------------------------------------------------------------\n# 2. planarise\n# ------------------------------------------------------------------------------\n\nwhile True:\n\n    cell.draw()\n\n    rs.EnableRedraw(True)\n\n    # --------------------------------------------------------------------------\n\n    option = rs.GetString('Arearise cell',\n                          strings=['single',\n                                   'multiple',\n                                   'exit'])\n\n\n    if option is None or option == 'exit':\n        break\n\n    # arearise a single face ---------------------------------------------------\n    if option =='single':\n        fkey = mesh_select_face(cell)\n\n\n\n\n\n\n    # arearise multiple faces --------------------------------------------------\n    if option == 'multiple':\n\n        target_areas = {}\n\n        while True:\n\n            pick = rs.GetString('Set target area',\n                                strings=['pick_face',\n                                         'exit'])\n\n            if pick == 'pick_face':\n                fkey = mesh_select_face(cell)\n                target_area = rs.GetReal('set target area', 1, 0.1, 1000.0)\n                target_areas[fkey] = target_area\n\n            elif pick == 'exit':\n                break\n\n            artist = MeshArtist(cell)\n            artist.draw_facelabels(text=target_areas)\n\n            rs.EnableRedraw(True)\n\n        # arearisation options -------------------------------------------------\n        fix_normal = rs.GetBoolean('Fix face normals?',\n                                   items=[('fix_normals', 'no', 'yes')],\n                                   defaults=[False])\n\n        target_normals = {}\n\n        if fix_normal:\n            for fkey in cell.faces():\n                target_normals[fkey] = cell.face_normal(fkey)\n\n        # arearise -------------------------------------------------------------\n        initial_flatness = cell_face_flatness(cell)\n\n        conduit = MeshConduit(cell)\n\n        def callback(cell, k, args):\n            current_flatness = cell_face_flatness(cell)\n            face_colordict   = compare_initial_current(current_flatness,\n                                                       initial_flatness,\n                                                       color_scheme=i_to_blue)\n            conduit.face_colordict = face_colordict\n            conduit.redraw()\n\n        with conduit.enabled():\n            mesh_planarise(cell,\n                           kmax=500,\n                           target_normals=target_normals,\n                           target_areas=target_areas,\n                           callback=callback)\n\n    # --------------------------------------------------------------------------\n\n    rs.EnableRedraw(True)\n\nrs.EnableRedraw(False)\ncell.draw()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}