{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/spb_Brep_Edge_count.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "spb_Brep_Edge_count.py",
  "instruction": "Spb brep edge count",
  "code": "\"\"\"\r\n\"\"\"\r\n\r\n#! python 2  Must be on a line number less than 32.\r\nfrom __future__ import absolute_import, division, print_function, unicode_literals\r\n\r\n\"\"\"\r\n171107: Created.\r\n...\r\n171209-11: Added a function. Modularized.\r\n171220: Bug fix in final printed result.\r\n180625: Now only reports edge counts per brep for brep count up to 10.\r\n180726: Changed method in a function.\r\n181031: Corrected behavior for object preselection.\r\n190829: Replaced GetObjects from rhinoscriptsyntax with RhinoGet.GetMultipleObjects due sometimes getting an unsolved bug.\r\n220401: Now accepts subselection of faces.\r\n241230: Bug fix in counting naked edges of subselected faces.\r\n250130: Now, input of Nothing will select all normal breps. Added information to printed report.\r\n        Refactored to better support mix of face and brep selections.\r\n\"\"\"\r\n\r\nimport Rhino\r\nimport Rhino.DocObjects as rd\r\nimport Rhino.Geometry as rg\r\nimport scriptcontext as sc\r\n\r\n\r\ndef _getAllNormalBreps():\r\n    oes = rd.ObjectEnumeratorSettings()\r\n    oes.LockedObjects = False # Default is True.\r\n    oes.ObjectTypeFilter = rd.ObjectType.Brep\r\n    return list(sc.doc.Objects.GetObjectList(oes))\r\n\r\n\r\ndef _get_Faces_and_Breps_from_ObjRefs(objrefs):\r\n    rgFs = []\r\n    gBs_perF = []\r\n    rgBs = []\r\n    gBs_perB = []\r\n    for objref in objrefs:\r\n        rgF = objref.Face()\r\n        if rgF is not None:\r\n            rgFs.append(rgF)\r\n            gBs_perF.append(objref.ObjectId)\r\n        else:\r\n            rgBs.append(objref.Brep())\r\n            gBs_perB.append(objref.ObjectId)\r\n\r\n    # Remove faces whose entire breps are to be analyzed.\r\n    for i in range(len(gBs_perF)-1, -1, -1):\r\n        if gBs_perF[i] in gBs_perB:\r\n            del rgFs[i]\r\n            del gBs_perF[i]\r\n\r\n    return rgFs, gBs_perF, rgBs, gBs_perB\r\n\r\n\r\ndef main():\r\n\r\n    res, objrefs = Rhino.Input.RhinoGet.GetMultipleObjects(\r\n        \"Select breps and/or faces <All normal breps>\",\r\n        acceptNothing=True,\r\n        filter=(rd.ObjectType.Brep | rd.ObjectType.Surface))\r\n\r\n    if res == Rhino.Commands.Result.Cancel: return\r\n\r\n    if objrefs:\r\n        rgFs, gBs_perF, rgBs, gBs_perB = _get_Faces_and_Breps_from_ObjRefs(objrefs)\r\n    else:\r\n        rdBs = _getAllNormalBreps()\r\n        rgBs = [_.BrepGeometry for _ in rdBs]\r\n        gBs_perB = [_.Id for _ in rdBs]\r\n        rgFs = []\r\n        gBs_perF = []\r\n\r\n    iCt_Es_All = iCt_Es_ThisObj = 0\r\n    edgeValences_All = []\r\n    iCt_NEs_All = 0\r\n\r\n    iCt_Objs_Input = len(rgFs) + len(rgBs)\r\n    iCt_Objs_Valid = 0\r\n\r\n    bReportEveryObj = iCt_Objs_Input < 11\r\n\r\n    for rgO, gB in zip(rgFs + rgBs, gBs_perF + gBs_perB):\r\n        if isinstance(rgO, rg.BrepFace):\r\n            rgF = rgO\r\n            rgB = rgF.Brep\r\n        else:\r\n            rgB = rgO\r\n            rgF = None\r\n\r\n        if not rgB.IsValid:\r\n            print(\"Warning. Brep {} is not valid.\".format(gB),\r\n                  \"Repair before trusting edge count results.\")\r\n\r\n        if rgF:\r\n            idx_Es = rgF.AdjacentEdges()\r\n            iCt_Es_ThisObj = len(rgF.AdjacentEdges())\r\n        else:\r\n            iCt_Es_ThisObj = rgB.Edges.Count\r\n\r\n        if iCt_Es_ThisObj is None: # Don't check for 'not' or 0 in case the brep doesn't have edges.\r\n            s  = \"Edges were not obtained from {}.\".format(gB)\r\n            s += \" Check validity of brep.\"\r\n            print(s)\r\n            continue\r\n\r\n        iCt_Objs_Valid += 1\r\n        iCt_Es_All += iCt_Es_ThisObj\r\n\r\n        edgeValences_ThisObj = []\r\n\r\n        if rgF:\r\n            edgeValences_ThisObj = [rgB.Edges[idx_E].Valence for idx_E in idx_Es]\r\n        else:\r\n            edgeValences_ThisObj = [rgE.Valence for rgE in rgB.Edges]\r\n\r\n        edgeValences_All.extend(edgeValences_ThisObj)\r\n\r\n        if bReportEveryObj:\r\n            if rgF:\r\n                print(\"{} edges ({}) in face of {}\".format(\r\n                    iCt_Es_ThisObj,\r\n                    \" + \".join([\"{} {}\".format(edgeValences_ThisObj.count(_), _) for _ in set(edgeValences_ThisObj)]),\r\n                    gB))\r\n            else:\r\n                print(\"{} edges ({}) in {}\".format(\r\n                    iCt_Es_ThisObj,\r\n                    \" + \".join([\"{} {}\".format(edgeValences_ThisObj.count(_), _) for _ in set(edgeValences_ThisObj)]),\r\n                    gB))\r\n\r\n    if (iCt_Objs_Input > 1) and iCt_Es_All:\r\n        print(\"{} edges ({}) in {} breps and/or faces.\".format(\r\n            iCt_Es_All,\r\n            \" + \".join([\"{} {}\".format(edgeValences_All.count(_), _) for _ in set(edgeValences_All)]),\r\n            iCt_Objs_Valid))\r\n\r\n\r\nif __name__ == '__main__': main()",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}