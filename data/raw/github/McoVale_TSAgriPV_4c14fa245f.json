{
  "source_url": "https://github.com/McoVale/TSAgriPV/blob/706b3ff31447356205fa650c6b0afbf771c9f599/TSAgriPVTracking.py",
  "repo": "McoVale/TSAgriPV",
  "repo_stars": 1,
  "repo_description": "Data process from crop orientation and PVP geometry to electrical production and agricultural yield.",
  "license": "GPL-3.0",
  "filepath": "TSAgriPVTracking.py",
  "instruction": "Tsagri pvtracking",
  "code": "from source_py import param_inputs as pi\nfrom source_py.Rhino import rhino_geom\nfrom source_py import data_transformation as dt\nfrom source_py import stics_from_r as stics\n\nfrom ladybug.wea import Wea\nimport numpy as np\nimport pandas as pd\n\nPARAMS = {}\nHOYS = np.arange(0, 8760)\nSTART_DATE = pd.Timestamp('2022-01-01')\ntimestamps = [START_DATE + pd.Timedelta(hours=int(hour)) for hour in HOYS]\nbdd_irr = pd.DataFrame()\nbdd_irr['Month-Day-Hour'] = [ts.strftime('%m-%d-%H') for ts in timestamps]\nJAVASTICS_PATH = 'JavaSTICS/'\nR_STICS_WORKSPACE = 'R_related/Rproject/'\n\ndef import_general_settings():\n    params_non_dict = pi.read_input_excel()\n    parameters_dict = pi.transform_df_to_dict(params_non_dict)\n    pi.modify_STICS_files(parameters_dict)\n    return parameters_dict\n\ndef general_setup():\n    pi.settings_dirs(PARAMS['PY_DATA_NAME'])\n    PARAMS['PY_TYPE_PANEL'] = bool(PARAMS['PY_TYPE_PANEL'])\n    PARAMS['PY_DO_RHINO_SIM'] = bool(PARAMS['PY_DO_RHINO_SIM'])\n    PARAMS['PY_epw_name'] = \"DATA/\"+PARAMS['PY_epw_name']\n    PARAMS['PY_wea'] = Wea.from_epw_file(PARAMS['PY_epw_name'], PARAMS['PY_timestep_wea'])\n    PARAMS['PY_LARGEUR_AVIDE'] = (PARAMS['PY_RAMPANT']-4*PARAMS['PY_LARGEUR_BANDE'])/3\n    PARAMS['PY_NB_PVP_RANGS'] = int(PARAMS['PY_GRID_SIZE'] / PARAMS['PY_ENTRAXE'])\n    PARAMS['PY_LONGUEUR_PVP'] = PARAMS['PY_GRID_SIZE'] / (PARAMS['PY_NB_RANGS'])\n    PARAMS['PY_LIST_ANGLES'] = np.arange(PARAMS['PY_start_angle'], PARAMS['PY_end_angle'] + 1, PARAMS['PY_PAS_ANGLE'])\n    if PARAMS['PY_TYPE_CULT'] == 1 or PARAMS['PY_TYPE_CULT'] == 3:\n        PARAMS['PY_HAUTEUR_MESURE'] = 1\n    elif PARAMS['PY_TYPE_CULT'] == 2:\n        PARAMS['PY_HAUTEUR_MESURE'] = 2.5\n    PARAMS['PY_PATH_BDD_IRR'] = 'DATA/'+PARAMS['PY_DATA_NAME']+'/bdd_irr_'+PARAMS['PY_DATA_NAME']+'.xlsx'\n    return True\n\ndef run_data_transformation():\n    scenar = dt.import_scenario()\n    bdd_irrad = dt.import_bdd_irr(PARAMS['PY_PATH_BDD_IRR'])\n    pvsyst_file = dt.import_pvsyst_file()\n    dt.creer_tab_effacement(sc=scenar, bdd_irr=bdd_irrad,\n                                      pvsyst=pvsyst_file, step_angle= PARAMS['PY_PAS_ANGLE'],\n                                      data_name=PARAMS['PY_DATA_NAME'])\n    dt.creer_daily_ratios(data_name=PARAMS['PY_DATA_NAME'])\n    return True\n\ndef run_stics_simu():\n    stics.gen_weatherfile_from_epw(PARAMS['PY_epw_name'],START_DATE)\n    res1 = stics.stics_simulation(source_dir=\"R_related/weatherFilesSource/\", workspace_path=R_STICS_WORKSPACE,\n                           javastics_path= JAVASTICS_PATH, usm_name=PARAMS['PY_USM_NAME'],\n                           data_name=PARAMS['PY_DATA_NAME'])\n    print(\"Récoltes indicatives :\\n Zone témoin : \",res1[0],\" t/ha ; Zone d'étude avec panneaux : \", res1[1], \" t/ha.\"      )\n    return True\n\nif __name__ == \"__main__\":\n\n    # Settings\n    print(\"Import des paramètres ...\")\n    PARAMS = import_general_settings()\n    general_setup()\n    print(\"Paramétrage réalisé !\")\n\n    # Run Geom + Irradiance if wanted (PY_RHINO_SIM == TRUE)\n    print(\"Partie simulation d'irradiance :\")\n    print(PARAMS['PY_PATH_BDD_IRR'])\n    if PARAMS['PY_DO_RHINO_SIM'] == True :\n        print(\"Simulation d'irradiance au sol en cours ...\")\n        rhino_geom.run_annual_irradiance_simulation(angles=PARAMS['PY_LIST_ANGLES'], wea=PARAMS['PY_wea'],tab_1=bdd_irr,hoys=HOYS,\n                                                    output_path=PARAMS['PY_PATH_BDD_IRR'],FINESSE=PARAMS['PY_FINESSE'],GRID_SIZE=PARAMS['PY_GRID_SIZE'],\n                                                    ENTRAXE=PARAMS['PY_ENTRAXE'],RAMPANT=PARAMS['PY_RAMPANT'],NB_PVP_RANGS=PARAMS['PY_NB_PVP_RANGS'],\n                                                    ANGLE_ORIENTATION=PARAMS['PY_ANGLE_ORIENTATION'],TYPE_PANEL=PARAMS['PY_TYPE_PANEL'],\n                                                    LARGEUR_BANDE=PARAMS['PY_LARGEUR_BANDE'],LARGEUR_AVIDE=PARAMS['PY_LARGEUR_AVIDE'],\n                                                    LONGUEUR_PVP=PARAMS['PY_LONGUEUR_PVP'],HAUTEUR=PARAMS['PY_HAUTEUR'], cult=PARAMS['PY_TYPE_CULT'])\n        print(\"Simulation d'irradiance au sol sous tous les angles effectuée !\")\n    else : print(\"Simulation d'irradiance au sol sautée.\")\n\n    # Data Transformation\n    print(\"Début de la transformation des données\")\n    if run_data_transformation():\n        print(\"Transformation des données effectuée !\\nDocuments disponibles : tableau effacement, angle et irradiance en fonction des heures de l'année, dans le dossier \",PARAMS['PY_DATA_NAME'])\n    else :\n        print(\"Transformation des données non effectuée.\")\n\n    # STICS analysis\n    print(\"Début de la simulation agro ...\")\n    if PARAMS['PY_DO_STICS_SIM'] == True :\n        if run_stics_simu() :\n            print(\"Simulation STICS effectuée, résultats STICS disponibles dans le dossier results.\\n Veuillez les enregistrer avant de lancer une nouvelle simulation pour ne pas les perdre.\")\n    else : print(\"Simulation agronomique sautée.\")\n    print(\"Fin de l'application, veuillez fermer cette fenêtre.\")\n",
  "language": "python",
  "imports": [],
  "has_docstring": false
}