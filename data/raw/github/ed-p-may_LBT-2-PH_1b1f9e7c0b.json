{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/scripts/LBT2PH/appliances.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "scripts/LBT2PH/appliances.py",
  "instruction": "Appliances",
  "code": "import math\nfrom occupancy import Occupancy\nimport ghpythonlib.components as ghc\nimport Grasshopper.Kernel as ghK\nimport random\nfrom System import Object\n\nclass ApplianceSet(Object):\n\n    def __init__(self, _appliance_list=[], _hb_room_ids=[]):\n        self.id = random.randint(1000,9999)\n        self.appliance_list = _appliance_list\n        self._host_room_tfa = None\n        self._lighting_efficacy = None\n\n    def __iter__(self):\n        return self.appliance_list\n\n    @property\n    def lighting_efficacy(self):\n        if self._lighting_efficacy:\n            return self._lighting_efficacy\n        else:\n            return 50\n\n    @lighting_efficacy.setter\n    def lighting_efficacy(self, _input):\n        self._lighting_efficacy = _input\n\n    @property\n    def host_room_tfa(self):\n        return self._host_room_tfa\n\n    @host_room_tfa.setter\n    def host_room_tfa(self, _in):\n        try:\n            self._host_room_tfa = float( _in )\n        except Exception as e:\n            print(e)\n\n    def to_dict(self):\n        d = {}\n\n        d.update( {'id':self.id} )\n        d.update( {'_host_room_tfa':self.host_room_tfa} )\n        d.update( {'lighting_efficacy':self.lighting_efficacy} )\n                \n        appliances = {}\n        for appliance in self.appliance_list:\n            appliances.update( {appliance.id:appliance.to_dict()} )\n        d.update( {'appliance_list':appliances } )\n        \n        return d\n\n    @classmethod\n    def from_dict(cls, _dict):\n        if not _dict:\n            return []\n        \n        new_obj = cls()\n\n        new_obj.id = _dict.get('id')\n        new_obj._host_room_tfa = _dict.get('_host_room_tfa')    \n        new_obj.lighting_efficacy = _dict.get('lighting_efficacy')      \n        \n        new_obj.appliance_list = []\n        appliance_dict = _dict.get('appliance_list')\n        for appliance in appliance_dict.values():\n            new_obj.appliance_list.append( ElecEquipAppliance.from_dict( appliance) )\n\n        return new_obj\n\n    def hb_lighting_per_m2(self, _occupancy, _floor_area):\n        \n        lighting_FrequencyPerPerson = 2.9 #kh/(Person-year)\n        lighting_Frequency = lighting_FrequencyPerPerson * _occupancy\n        lighting_Demand = 720 /  self.lighting_efficacy\n        lighting_UtilizFactor = 1\n        lighting_AnnualEnergy = lighting_Demand * lighting_UtilizFactor * lighting_Frequency #kWh / year\n        lighting_AvgHourlyWattage =  lighting_AnnualEnergy * 1000  / 8760 # Annual Average W / hour for a constant schedule\n        lightingDensityPerArea = lighting_AvgHourlyWattage / _floor_area\n        \n        return lightingDensityPerArea\n\n    def hb_elec_equip_per_m2(self, _occupancy, _num_units, _floor_area):\n\n        appliance_annual_kWh = [appliance.calc_annual_demand(_occupancy, _num_units) for appliance in self.appliance_list]\n        appliance_avg_hourly_W = sum(appliance_annual_kWh) * 1000 / 8760\n        specific_appliance_avg_hourly_W = appliance_avg_hourly_W / _floor_area\n\n        return specific_appliance_avg_hourly_W\n\n    def __unicode__(self):\n        return u'PHPP Style Appliances Collection: < {} >'.format(self.id)\n    def __str__(self):\n        return unicode(self).encode('utf-8')\n    def __repr__(self):\n        return \"{}( _appliance_list={!r}, _hb_room_ids={!r})\".format(\n                self.__class__.__name__,\n                self.appliance_list,\n                self.hb_host_room_ids)\n\n\nclass ElecEquipAppliance(Object):\n    defaults = {\n        'dishwasher':   {'include':1, 'demand': 1.1, 'util_frac': 1, 'freq':65},\n        'clothesWasher':{'include':1, 'demand':1.1, 'util_frac': 1, 'freq':57},\n        'clothesDryer': {'include':1, 'demand':3.5, 'util_frac': 1, 'freq':57},\n        'fridge':       {'include':0, 'demand':0.78, 'util_frac': 1, 'freq':365},\n        'freezer':      {'include':0, 'demand':0.88, 'util_frac': 1, 'freq':365},\n        'fridgeFreezer':{'include':1, 'demand':1.0, 'util_frac': 1, 'freq':365},\n        'cooking':      {'include':1, 'demand':0.25, 'util_frac': 1, 'freq':500},\n        'other_kWhYear_':{'include':1, 'demand':0.0, 'util_frac': 1, 'freq':1},\n        'consumerElec': {'include':1, 'demand': 80.0, 'util_frac': 1, 'freq':0.55},\n    }\n    \n    def __init__(self, _nm=None, _nomDem=None, _utilFac=None, _freq=None, _type=None):\n        self.id = random.randint(1000,9999)\n        self.name = _nm\n        self.include = 1\n        self._nominal_demand = _nomDem\n        self._utilization_factor = _utilFac\n        self._frequency = _freq\n        self._type = _type\n        self.hb_wattage = None\n        self.hb_avg_daily_util_frac = None\n\n    @property\n    def type(self):\n        return self._type\n\n    @type.setter\n    def type(self, _input_val):\n        if self.name == 'dishwasher':\n            if '2' in str(_input_val):\n                self._type = '2-Cold water connection'\n            else:\n                self._type =  '1-DHW connection'\n        elif self.name == 'clothesWasher':\n            if '2' in str(_input_val):\n                self._type =  '2-Cold water connection'\n            else:\n                self._type =  '1-DHW connection'\n        elif self.name == 'clothesDryer':\n            if '1' in str(_input_val):\n                self._type =  '1-Clothes line'\n            if '2' in str(_input_val):\n                self._type =  '2-Drying closet (cold!)'\n            elif '3' in str(_input_val):\n                self._type =  '3-Drying closet (cold!) in extract air'\n            elif '5' in str(_input_val):\n                self._type =  '5-Electric exhaust air dryer'\n            elif '6' in str(_input_val):\n                self._type =  '6-Gas exhaust air dryer'\n            else:\n                self._type =  '4-Condensation dryer'\n        elif self.name == 'cooking':\n            if '2' in str(_input_val):\n                self._type =  '2-Natural gas'\n            elif '3' in str(_input_val):\n                self._type =  '3-LPG'\n            else:\n                self._type =  '1-Electricity'\n        else:\n            self._type =  None\n\n    @property\n    def frequency(self):\n        return self._frequency\n\n    @frequency.setter\n    def frequency(self, _in):\n        if not _in:\n            self._frequency = self.defaults.get(self.name, {}).get('freq', 0)\n        else:\n            self._frequency = float(_in)\n\n    @property\n    def utilization_factor(self):\n        return self._utilization_factor\n\n    @utilization_factor.setter\n    def utilization_factor(self, _in):\n        if not _in:\n            self._utilization_factor = self.defaults.get(self.name, {}).get('util_frac', 0)\n        else:\n            self._utilization_factor = float(_in)\n\n    @property\n    def nominal_demand(self):\n        return self._nominal_demand\n    \n    @nominal_demand.setter\n    def nominal_demand(self, _in):\n        if not _in:\n            self._nominal_demand = self.defaults.get(self.name, {}).get('demand', 0)\n        else:\n            self._nominal_demand = float(_in)\n\n    def calc_annual_demand(self, _bldgOccupancy=0, _numResUnits=0):\n        demandByOccupancy = self.nominal_demand * self.utilization_factor * self.frequency * _bldgOccupancy \n        demandByHousehold = self.nominal_demand * self.utilization_factor * self.frequency * _numResUnits\n        \n        if self.name == 'fridge' or self.name == 'freezer' or self.name == 'fridgeFreezer':\n            return demandByHousehold\n        elif self.name == 'other':\n            return self.nominal_demand\n        else:\n            return demandByOccupancy\n    \n    @classmethod\n    def from_ud(cls, _use_defaults, _name, _nom_demand, _utilFac=None, _freq=None, _type=None):\n        if not _use_defaults and not _nom_demand:\n            return None\n        else:\n            appliance_obj = cls()\n\n            if _name == 'fridge' or _name == 'freezer':\n                appliance_obj.include = 0\n \n            appliance_obj.name = _name\n            appliance_obj.utilization_factor = _utilFac\n            appliance_obj.type = _type\n            appliance_obj.frequency = _freq\n            appliance_obj.nominal_demand = _nom_demand\n        \n            return appliance_obj\n\n    @classmethod\n    def from_hb(cls, _name, _load, _sched):\n        appliance_obj = cls()\n        appliance_obj.name = _name   \n        appliance_obj.hb_wattage = _load\n        appliance_obj.hb_avg_daily_util_frac = _sched\n\n        return appliance_obj\n\n    def to_dict(self):\n        d = {}\n\n        d.update( {'id':self.id} )\n        d.update( {'name':self.name} )\n        d.update( {'include':self.include})\n        d.update( {'_nominal_demand':self.nominal_demand} )\n        d.update( {'_utilization_factor':self.utilization_factor} )\n        d.update( {'_frequency':self.frequency} )\n        d.update( {'_type':self._type} )\n        d.update( {'hb_wattage':self.hb_wattage} )\n        d.update( {'hb_avg_daily_util_frac':self.hb_avg_daily_util_frac} )\n\n        return d\n\n    @classmethod\n    def from_dict(cls, _dict):\n        new_obj = cls()\n\n        new_obj.id = _dict.get('id')\n        new_obj.name = _dict.get('name')\n        new_obj.include = _dict.get('include')\n        new_obj._nominal_demand = _dict.get('_nominal_demand')\n        new_obj._utilization_factor = _dict.get('_utilization_factor')\n        new_obj._frequency = _dict.get('_frequency')\n        new_obj._type = _dict.get('_type')\n        new_obj.hb_wattage = _dict.get('hb_wattage')\n        new_obj.hb_avg_daily_util_frac = _dict.get('hb_avg_daily_util_frac')\n\n        return new_obj\n\n    def __unicode__(self):\n        return u'PHPP Style Appliance: {}'.format(self.name)\n    def __str__(self):\n        return unicode(self).encode('utf-8')\n    def __repr__(self):\n        return \"{}( _nm={!r}, _nomDem={!r}, _utilFac={!r}, _freq={!r}, type={!r})\".format(\n                self.__class__.__name__,\n                self.name,\n                self._nominal_demand,\n                self.utilization_factor,\n                self.frequency,\n                self.type)\n    def ToString(self):\n        return str(self)\n\nclass PNNL_ResidentialLoads:\n    \"\"\"Loads and Schedules for the Honyebee Room which match the PNNL Example files\n\n    PNNL Sample File Source:\n    https://www.energycodes.gov/development/residential/iecc_models\n    \"\"\"\n\n    schedules = {\n        'refrigerator': [0.80,0.78,0.77,0.74,0.73,0.73,0.76,0.80,0.82,0.83,0.80,0.80,0.84,0.84,0.83,0.84,0.89,0.97,1.00,0.97,0.94,0.93,0.89,0.83],\n        'dishwasher': [0.12,0.05,0.04,0.03,0.03,0.08,0.15,0.23,0.44,0.49,0.43,0.36,0.31,0.35,0.28,0.27,0.28,0.37,0.66,0.84,0.68,0.50,0.33,0.23],\n        'clotheswasher': [0.08,0.06,0.03,0.03,0.06,0.10,0.19,0.41,0.62,0.73,0.72,0.64,0.57,0.51,0.45,0.41,0.43,0.41,0.41,0.41,0.41,0.40,0.27,0.14],\n        'clothesdryer': [0.10,0.06,0.04,0.02,0.04,0.06,0.16,0.32,0.49,0.69,0.79,0.82,0.75,0.68,0.61,0.58,0.56,0.55,0.52,0.51,0.53,0.55,0.44,0.24],\n        'stove': [0.05,0.05,0.02,0.02,0.05,0.07,0.17,0.28,0.31,0.32,0.28,0.33,0.38,0.31,0.29,0.38,0.61,1.00,0.78,0.40,0.24,0.17,0.10,0.07],\n        'mel': [0.61,0.56,0.55,0.55,0.52,0.59,0.68,0.72,0.61,0.52,0.53,0.53,0.52,0.54,0.57,0.60,0.71,0.86,0.94,0.97,1.00,0.98,0.85,0.73],\n        'plugloads': [0.61,0.56,0.55,0.55,0.52,0.59,0.68,0.72,0.61,0.52,0.53,0.53,0.52,0.54,0.57,0.60,0.71,0.86,0.94,0.97,1.00,0.98,0.85,0.73],\n        'occupancy' : [1.00000,1.00000,1.00000,1.00000,1.00000,1.00000,1.00000,0.88310,0.40861,0.24189,0.24189,0.24189,0.24189,0.24189,0.24189,0.2418,0.29498,0.55310,0.89693,0.89693,0.89693,1.00000,1.00000,1.00000],\n        'lighting' : [0.06875,0.06875,0.0687,0.06875,0.20625,0.4296875,0.48125,0.4296875,0.1890625,0.12890625,0.12890625,0.12890625,0.12890625,0.12890625,0.12890625,0.2234375,0.48125,0.6703125,0.90234375,1,1,0.75625,0.42109375,0.171875]\n    }\n\n    loads = {\n        'refrigerator':91.058,\n        'dishwasher': 65.699,\n        'clotheswasher': 28.478,\n        'clothesdryer':213.065,\n        'stove': 248.154,\n        'mel':1.713,\n        'plugloads':1.544,\n        'lighting':1.63,     # (1.15 W/m2 (Hardwired)  + 0.48 W/m2 (Plugin) = 1.63 W/,2)\n        'occupancy':0.0091   # (People / m2)\n    }\n    \n    def __init__(self):\n        pass\n\n    def schedule(self, _type):\n        return self.schedules.get(_type, None)\n\n    def load(self, _type):\n        return self.loads.get(_type, None)\n\n    def set_load(self, _load_type, _ud_val):\n        try:\n            self.loads[_load_type] = float(_ud_val)\n        except SystemError as e:\n            # Must be a None\n            pass\n\n    def _hourly_wattage(self, _hb_room_floor_area):\n        # Calc the hourly Wattage values (load * fraction)\n        wattHr_ref =   [ self.load('refrigerator') * hour for hour in self.schedule('refrigerator') ]\n        wattHr_dw =    [ self.load('dishwasher') * hour for hour in self.schedule('dishwasher') ]\n        wattHr_clWsh = [ self.load('clotheswasher') * hour for hour in self.schedule('clotheswasher') ]\n        wattHr_dryer = [ self.load('clothesdryer') * hour for hour in self.schedule('clothesdryer') ]\n        wattHr_stove = [ self.load('stove') * hour for hour in self.schedule('stove') ]\n        wattHr_mel =   [ self.load('mel') * hour * _hb_room_floor_area for hour in self.schedule('mel') ]\n        wattHr_pl =    [ self.load('plugloads') * hour * _hb_room_floor_area for hour in self.schedule('plugloads') ]\n        \n        # Sum up the wattage from each appliance for each hour\n        hourly_total_wattage = []\n        for i in range(24):\n            hourly_total_wattage.append(wattHr_ref[i] + wattHr_dw[i] + wattHr_clWsh[i] + wattHr_dryer[i] + wattHr_stove[i] + wattHr_mel[i] + wattHr_pl[i])\n\n        return hourly_total_wattage\n\n    def calc_elec_equip_load(self, _hb_room_floor_area):\n        peak_wattage = max( self._hourly_wattage( _hb_room_floor_area ) )\n        \n        return  peak_wattage / _hb_room_floor_area\n\n    def calc_elec_equip_sched(self, _hb_room_floor_area):\n        hourly_wattage = self._hourly_wattage( _hb_room_floor_area )\n        peak_wattage = max( hourly_wattage )\n        \n        return [hourly_wattage / peak_wattage for hourly_wattage in hourly_wattage]\n\n    def get_phpp_values(self, _name):\n        name = _name\n        load = self.load(_name)\n        sched = self.schedule(_name)\n        avg_util = sum(sched)/len(sched)\n\n        return ( name, load, avg_util  )\n",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": false
}