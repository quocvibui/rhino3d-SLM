{
  "source_url": "https://github.com/ladybug-tools/honeybee-legacy/blob/bd62af4862fe022801fb87dbc8794fdf1dff73a9/src/Honeybee_createHBSrfs.py",
  "repo": "ladybug-tools/honeybee-legacy",
  "repo_stars": 129,
  "repo_description": ":bee: Honeybee is a free and open source plugin to connect Grasshopper3D to EnergyPlus, Radiance, Daysim and OpenStudio for building energy and daylighting simulation",
  "license": "NOASSERTION",
  "filepath": "src/Honeybee_createHBSrfs.py",
  "instruction": "Create a Honeybee surface, which can be plugged into the \"Run Daylight Sumilation\" component or combined with other surfaces to make HBZones with the \"createHBZones\" component.\n-\nProvided by Honeybee...",
  "code": "#\n# Honeybee: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n# \n# This file is part of Honeybee.\n# \n# Copyright (c) 2013-2020, Mostapha Sadeghipour Roudsari <mostapha@ladybug.tools> \n# Honeybee is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# Honeybee is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with Honeybee; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n\n\"\"\"\nCreate a Honeybee surface, which can be plugged into the \"Run Daylight Sumilation\" component or combined with other surfaces to make HBZones with the \"createHBZones\" component.\n-\nProvided by Honeybee 0.0.66\n\n    Args:\n        _geometry: List of Breps\n        srfName_: Optional name for surface\n        srfType_: Optional input for surface type >\n            0- 'WALL'\n            0.5- 'UndergroundWall'\n            1- 'ROOF'\n            1.5- 'UndergroundCeiling'\n            2- 'FLOOR'\n            2.25- 'UndergroundSlab'\n            2.5- 'SlabOnGrade'\n            2.75- 'ExposedFloor'\n            3- 'CEILING'\n            4- 'AIRWALL'\n            5- 'WINDOW'\n            6- 'SHADING'\n        EPBC_: 'Ground', 'Adiabatic', 'Outdoors'\n        _EPConstruction_: Optional EnergyPlus construction\n        _RADMaterial_: Optional Radiance Material\n    Returns:\n        readMe!:...\n        HBZone: A Honeybee Surface, which can be plugged into the \"Run Daylight Sumilation\" component or combined with other surfaces to make HBZones with the \"createHBZones\" component.\n\"\"\"\n\nimport rhinoscriptsyntax as rs\nimport Rhino as rc\nimport scriptcontext as sc\nimport os\nimport sys\nimport System\nimport Grasshopper.Kernel as gh\nimport uuid\n\nghenv.Component.Name = 'Honeybee_createHBSrfs'\nghenv.Component.NickName = 'createHBSrfs'\nghenv.Component.Message = 'VER 0.0.66\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"HB-Legacy\"\nghenv.Component.SubCategory = \"00 | Honeybee\"\n#compatibleHBVersion = VER 0.0.57\\nNOV_04_2016\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"3\"\nexcept: pass\n\n\ntolerance = sc.doc.ModelAbsoluteTolerance\nimport math\n\n\ndef main(geometry, srfName, srfType, EPBC, EPConstruction, RADMaterial):\n    # import the classes\n    if sc.sticky.has_key('honeybee_release'):\n\n        try:\n            if not sc.sticky['honeybee_release'].isCompatible(ghenv.Component): return -1\n            if sc.sticky['honeybee_release'].isInputMissing(ghenv.Component): return -1\n        except:\n            warning = \"You need a newer version of Honeybee to use this compoent.\" + \\\n            \"Use updateHoneybee component to update userObjects.\\n\" + \\\n            \"If you have already updated userObjects drag Honeybee_Honeybee component \" + \\\n            \"into canvas and try again.\"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, warning)\n            return -1\n            \n        # don't customize this part\n        hb_EPZone = sc.sticky[\"honeybee_EPZone\"]\n        hb_EPSrf = sc.sticky[\"honeybee_EPSurface\"]\n        hb_EPZoneSurface = sc.sticky[\"honeybee_EPZoneSurface\"]\n        hb_EPFenSurface = sc.sticky[\"honeybee_EPFenSurface\"]\n        hb_RADMaterialAUX = sc.sticky[\"honeybee_RADMaterialAUX\"]\n        hb_EPObjectsAux = sc.sticky[\"honeybee_EPObjectsAUX\"]()\n        \n    else:\n        print \"You should first let Honeybee to fly...\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"You should first let Honeybee to fly...\")\n        return\n    \n    # if the input is mesh, convert it to a surface\n    try:\n        # check if this is a mesh\n        geometry.Faces[0].IsQuad\n        # convert to brep\n        geometry = rc.Geometry.Brep.CreateFromMesh(geometry, False)\n    except:\n        pass\n    \n    HBSurfaces = []\n    originalSrfName = srfName\n    \n    for faceCount in range(geometry.Faces.Count):\n        \n        # 0. check if user input a name for this surface\n        guid = str(uuid.uuid4())\n        number = guid.split(\"-\")[-1]\n        \n        if srfName != None:\n            if originalSrfName == None: originalSrfName = srfName\n            originalSrfName = originalSrfName.strip().replace(\" \",\"_\")\n            if geometry.Faces.Count != 1:\n                srfName = originalSrfName + \"_\" + `faceCount`\n            else: srfName = originalSrfName\n        else:\n            # generate a random name\n            # the name will be overwritten for energy simulation\n            srfName = \"\".join(guid.split(\"-\")[:-1])\n        \n        # 1. create initial surface\n        HBSurface = hb_EPZoneSurface(geometry.Faces[faceCount].DuplicateFace(False), number, srfName)\n        \n        # If the user has set a construction as Air Wall, change the surface type to air wall.\n        try:\n            if EPConstruction.ToUpper() == \"AIR WALL\":\n                if srfType == None or srfType == \"4\":\n                    srfType = 4\n                    infoMsg = \"Setting the construction to Air Wall will also ensure that the surface has the air wall srfType_.\"\n                    print infoMsg\n                else:\n                    infoMsg = \"By manually setting the srfType_ to be something other than 4: Air Wall on this component and also setting the Air Wall construction, you are overriding the air mixing properties of the air wall and only using the air wall as a construction.\"\n                    print infoMsg\n        except: pass\n        \n        if srfType == 4 or srfType == 4.0 or srfType == \"4\" or srfType == \"4.0\":\n            try:\n                if EPConstruction.ToUpper() == \"AIR WALL\": pass\n                else:\n                    infoMsg = \"Setting the srfType to 4 will also ensure that the surface has the air wall construction.\"\n                    print infoMsg\n            except:\n                infoMsg = \"Setting the srfType to 4 will also ensure that the surface has the air wall construction.\"\n                print infoMsg\n            EPConstruction = \"AIR WALL\"\n        \n        # 1.1 check for surface type\n        if srfType!=None:\n            try:\n                # if user uses a number to input type\n                try: surfaceType = int(srfType)\n                except:\n                    if float(srfType) == 0.5 or float(srfType) == 1.5 or float(srfType) == 2.25 or float(srfType) == 2.5 or float(srfType) == 2.75:\n                        surfaceType = float(srfType)\n                    else: pass\n                print \"HBSurface Type has been set to \" + HBSurface.srfType[float(srfType)]\n                \n                if surfaceType == 5.0:\n                    warningMsg = \"If you want to use this model for energy simulation, use addGlazing to add window to surfaces.\\n\" + \\\n                                 \"It will be fine for Daylighting simulation though.\"\n                    print warningMsg\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Remark, warningMsg)\n            except:\n                # user uses text as an input (e.g.: wall)\n                # convert it to a number if a valid input\n                surfaceType = srfType.ToUpper()\n                if surfaceType in HBSurface.srfType.keys():\n                   surfaceType = HBSurface.srfType[surfaceType.ToUpper()]\n                   print \"HBSurface Type has been set to \" + surfaceType.ToUpper()\n            \n            if surfaceType in HBSurface.srfType.keys():\n                acceptableCombination = [[1,3], [3,1], [0,5], [5,0], [1,5], [5,1], [4,0], [4,1], [4,2], [4,3], [0,4], [1,4], [2,4], [3,4]]\n                try:\n                    if int(HBSurface.type) != surfaceType and [int(HBSurface.type), surfaceType] not in acceptableCombination:\n                        warningMsg = \"Normal direction of the surface is not expected for a \" + HBSurface.srfType[surfaceType] + \". \" + \\\n                                     \"The surface is more likely a \" + HBSurface.srfType[int(HBSurface.type)] + \".\\n\" + \\\n                                     \"Honeybee won't overwrite the type so you may need to manually flip the surface.\"\n                        print warningMsg\n                    HBSurface.setType(surfaceType, isUserInput= True)\n                    if surfaceType == 2.5 or surfaceType == 2.25:\n                        HBSurface.setBC('ground', isUserInput= False)\n                except:\n                    warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                    print warningMsg\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    return\n            \n        \n        # 1.2 assign boundary condition\n        if EPBC!= None:\n            # only ground, adiabatic and outdoors is valid\n            validBC = ['ground', 'adiabatic', 'outdoors']\n            if EPBC.lower() in validBC:\n                try:\n                    HBSurface.setBC(EPBC, isUserInput= True)\n                    \n                    if EPBC.lower()== \"adiabatic\":\n                        if srfType == None and str(HBSurface.type).startswith('2'):\n                            HBSurface.setType(2, False)\n                        elif srfType == None and str(HBSurface.type).startswith('1'):\n                            HBSurface.setType(3, False)\n                        HBSurface.setEPConstruction(HBSurface.intCnstrSet[HBSurface.type])\n                    \n                    # change type of surface if BC is set to ground\n                    if EPBC.lower()== \"ground\":\n                        HBSurface.setType(int(HBSurface.type) + 0.5, isUserInput= True)\n                    \n                    if EPBC.lower()== \"ground\" or EPBC.lower()== \"adiabatic\":\n                        HBSurface.setSunExposure('NoSun')\n                        HBSurface.setWindExposure('NoWind')\n                    \n                    print \"HBSurface boundary condition has been set to \" + EPBC.upper()\n                except:\n                    warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                    print warningMsg\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    return               \n            else:\n                print \"HBSurface BOUNDARY CONDITION IS NOT VALID.\"\n        \n        # 1.3 assign construction for EnergyPlus\n        if EPConstruction!=None:\n            # if it is just the name of the material make sure it is already defined\n            if len(EPConstruction.split(\"\\n\")) == 1:\n                # if the material is not in the library add it to the library\n                if not hb_EPObjectsAux.isEPConstruction(EPConstruction):\n                    warningMsg = \"Can't find \" + EPConstruction + \" in EP Construction Library.\\n\" + \\\n                                \"Add the construction to the library and try again.\"\n                    print warningMsg\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    return\n            else:\n                # it is a full string\n                if \"CONSTRUCTION\" in EPConstruction.upper():\n                    added, EPConstruction = hb_EPObjectsAux.addEPObjectToLib(EPConstruction, overwrite = True)\n                    \n                    if not added:\n                        msg = name + \" is not added to the project library!\"\n                        ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                        print msg\n                        return\n                elif \"MATERIAL\" in EPConstruction.upper():\n                    msg = \"Your connected EPConstruction_ is just a material and not a full construction. \\n You have to pass it through an 'EnergyPlus Construction' component before connecting it here.\"\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                    print msg\n                    return\n                else:\n                    msg = \"Your connected EPConstruction_ is not a valid construction.\"\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                    print msg\n                    return\n            \n            try:\n                HBSurface.setEPConstruction(EPConstruction)\n                print \"HBSurface construction has been set to \" + EPConstruction\n            except:\n                warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                print warningMsg\n                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                return                 \n            \n        # 1.4 assign RAD Material\n        if RADMaterial!=None:\n            # if it is just the name of the material make sure it is already defined\n            if len(RADMaterial.split(\" \")) == 1:\n                # if the material is not in the library add it to the library\n                if not hb_RADMaterialAUX.isMatrialExistInLibrary(RADMaterial):\n                    warningMsg = \"Can't find \" + RADMaterial + \" in RAD Material Library.\\n\" + \\\n                                \"Add the material to the library and try again.\"\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    return\n                \n                try:\n                    HBSurface.setRADMaterial(RADMaterial)\n                    print \"HBSurface Radiance Material has been set to \" + RADMaterial\n                except Exception, e:\n                    print e\n                    warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                    print warningMsg\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    return\n                \n                addedToLib = True\n            else:\n                \n                # try to add the material to the library\n                addedToLib, HBSurface.RadMaterial = hb_RADMaterialAUX.analyseRadMaterials(RADMaterial, True)\n                \n            if addedToLib==False:\n                warningMsg = \"Failed to add \" + RADMaterial + \" to the Library.\"\n                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                return\n        \n        HBSurfaces.append(HBSurface)\n    \n    # add to the hive\n    hb_hive = sc.sticky[\"honeybee_Hive\"]()\n    HBSurface  = hb_hive.addToHoneybeeHive(HBSurfaces, ghenv.Component)\n    \n    return HBSurface\n    \n    \n    \n\nif _geometry != None:\n    \n    result= main(_geometry, srfName_, srfType_, EPBC_, _EPConstruction_, _RADMaterial_)\n    \n    if result!=-1:\n        HBSurface = result\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}