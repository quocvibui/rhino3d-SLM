{
  "source_url": "https://github.com/karim-daw/RhinoCompute-EnergyModelling/blob/142d4f70819c577225d1c6d2971b66b4fab048f5/app/app.py",
  "repo": "karim-daw/RhinoCompute-EnergyModelling",
  "repo_stars": 1,
  "repo_description": null,
  "license": "unknown",
  "filepath": "app/app.py",
  "instruction": null,
  "code": "import pandas\n# rhino 3dm import\n# from rhino3dm import *\nimport rhino3dm as rhino3dm\nimport compute_rhino3d.Util\nimport json\nimport requests\nimport base64\n\n# Rhino compute by default launches on port 6500\ncompute_url = \"http://localhost:6500/\"\n\n# set the URL\ncompute_rhino3d.Util.url = compute_url\n# no auth token required\ncompute_rhino3d.Util.authToken = \"\"\n\n# test, should return version object\nversion_test = requests.get(compute_url + '/version')\npload = json.loads(version_test.content)\n\nprint(pload)\n\ngh_energy = open(r\"./Rhino/single_zone_energy_model_v0.1.ghx\", mode=\"r\", encoding=\"utf-8-sig\").read()\ngh_energy_bytes = gh_energy.encode(\"utf-8\")\ngh_energy_encoded = base64.b64encode(gh_energy_bytes)\ngh_energy_decoded = gh_energy_encoded.decode(\"utf-8\")\n\n\n'''\nRhino 3dm Encoder\n'''\n\nclass __Rhino3dmEncoder(json.JSONEncoder):\n    def default(self, o):\n        if hasattr(o, \"Encode\"):\n            return o.Encode()\n        return json.JSONEncoder.default(self, o)\n\ndef getCurves(objs):\n    curves = [item.Geometry for item in objs if item.Geometry.ObjectType == rhino3dm.ObjectType.Curve]\n    return json.dumps(curves, cls=__Rhino3dmEncoder)\n\ndef getBreps(objs):\n    breps = [item.Geometry for item in objs if item.Geometry.ObjectType == rhino3dm.ObjectType.Brep]\n    return list(map(lambda x: {\"type\":\"Rhino.Geometry.Brep\",\"data\":json.dumps(x, cls=__Rhino3dmEncoder)}, breps))\n\n'''\nLoad Rhino 3dm model via File3dm.Read\n'''\n\nrhino_dir = \"./Rhino/\"\nmodel_path = \"singleZone.3dm\"\ngh_path = \"geometry\"\nfile_path = rhino_dir + model_path\nprint(file_path)\n\n# read the 3dm file and encode the geometry for transit\nrhFile = rhino3dm.File3dm.Read(file_path)\nmodelBreps = getBreps(rhFile.Objects)\n\nroomGeometry = json.loads(modelBreps[0][\"data\"])\nroomGeometry = json.dumps(roomGeometry)\n\nprint('Geometry encoded ready to go!')\n\n# # Inputs\n\n# # adjust between 0 and 0.9\nroomName = \"MyPythonRoom\"\nclimateZoneNumber = 4 # mixed\nmodelName = \"MyPythonModel\"\napertureFromInput = True\nwwr = 0.5\nrunSimulation = True\n\n\n#print((roomGeometry))\n\n# payload\ngeo_payload = {\n    \"algo\": gh_energy_decoded,\n    \"pointer\": None,\n    \"values\": [\n        {\n            \"ParamName\": \"RoomGeometry\",\n            \"InnerTree\": {\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"Rhino.Geometry.Brep\",\n                        \"data\": roomGeometry\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"RoomName\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.String\",\n                        \"data\": roomName\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"ClimateZoneNumber\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.Double\",\n                        \"data\": climateZoneNumber\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"ModelName\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.String\",\n                        \"data\": modelName\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"ApertureFromInput\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.Double\",\n                        \"data\": apertureFromInput\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"WWR\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.Double\",\n                        \"data\": wwr\n                    }\n                ]\n            }\n        },\n        {\n            \"ParamName\": \"RunSimulation\",\n            \"InnerTree\":{\n                \"{ 0; }\": [\n                    {\n                        \"type\": \"System.Bool\",\n                        \"data\": runSimulation\n                    }\n                ]\n            }\n        },\n    ]\n}\n\n\n\n# send HTTP request to Rhino Compute Server\nres = requests.post(compute_url + \"grasshopper\", json=geo_payload)\n\nprint(\"status code: {}\".format(res.status_code))\n\n# deserialize response object\nresponse_object = json.loads(res.content)['values']\n\nprint(len(response_object))\n#print(response_object[0])\n\ncomputed_eui = [result for result in response_object if result['ParamName'] == 'EUI'][0]['InnerTree']['{0}'][0]['data']\nprint('computed EUI: {}'.format(computed_eui))\n\n\nsql_object = [result for result in response_object if result['ParamName'] == 'sql'][0]['InnerTree']['{0}'][0]['data']\nprint(\"Computed SQL: : {}\".format(len(sql_object)))\n\n\"\"\"\nfloor_area = [result for result in response_object if result['ParamName'] == 'RH_OUT:max_area'][0]['InnerTree']['{0}'][0]['data']\nprint('max floor area: {}'.format(floor_area))\n\nfloor_area = [result for result in response_object if result['ParamName'] == 'RH_OUT:max_open'][0]['InnerTree']['{0}'][0]['data']\nprint('max open area: {}'.format(floor_area))\"\"\"",
  "language": "python",
  "imports": [
    "Rhino.Geometry",
    "rhino3dm"
  ],
  "has_docstring": false
}