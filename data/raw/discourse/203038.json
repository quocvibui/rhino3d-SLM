{
  "source_url": "https://discourse.mcneel.com/t/rhino-geometry-brep-createfromsweep-failure-to-produce-result/203038",
  "topic_id": 203038,
  "title": "Rhino.Geometry.Brep.CreateFromSweep() Failure To Produce Result",
  "question": "Hello,\n\n\nThe following code yields a sweep1 style sweep no problem:\n\n\nsweep = Rhino.Geometry.Brep.CreateFromSweep(path_curve, profile_curve, True, scriptcontext.doc.ModelAbsoluteTolerance)\n\n\n\nHowever, when I try to use the method with the additional args to create a midered, trimmed, and solid sweep1 it consistently returns None but my args look correct from what I can tell based on the API docs here:\n\n\nhttps://developer.rhino3d.com/api/rhinocommon/rhino.geometry.brep/createfromsweep\n\n\nimage\n1139Ã—656 48.1 KB\n\n\nCode:\n\n\n        def SweepFromCurve(nurbs_curve=None, width=default_width, height=default_height):\n            \"\"\"Given an input nurbs_curve/polyline, width number, and height number, \n            sweep a rectangle(curve_start_origin/plane, width, height) along the curve, \n            get the sweep result as a 3d brep\"\"\"\n            try:\n                if nurbs_curve is None:\n                    print(\"nurbs_curve is None, returning\")\n                    return None\n\n                path_curve = nurbs_curve.ToNurbsCurve()\n\n                # Create a rectangle profile for sweeping\n                # First, get the start point and tangent vector\n                t = 0.0  # Start of curve\n                start_point = path_curve.PointAt(t)\n                tangent = path_curve.TangentAt(t)\n                \n                # Create a plane perpendicular to the curve at the start point\n                success, perp_frame = path_curve.PerpendicularFrameAt(t)\n                if not success:\n                    # If we can't get a perpendicular frame, create one manually\n                    up_vector = Rhino.Geometry.Vector3d.ZAxis\n                    # Make sure the up vector isn't parallel to the tangent\n                    if abs(Rhino.Geometry.Vector3d.Multiply(up_vector, tangent)) > 0.99:\n                        up_vector = Rhino.Geometry.Vector3d.YAxis\n                    \n                    x_axis = tangent\n                    y_axis = Rhino.Geometry.Vector3d.Cro...",
  "code_blocks": [
    {
      "code": "def DynamicAddPreview(self):\n            # print(\">>>>>DynamicAddPreview Call\")\n            \"\"\"Add dynamic preview of the current polyline\"\"\"\n            self.dynamic_polyline = None\n            if len(self.points) > 1:\n                self.dynamic_polyline = Rhino.Geometry.Polyline(self.points)  # Create a polyline from the points\n                if len(self.points) > 2:\n                    flipped, flipped_dynamic_polyline = Utils.EnsureCounterClockwise(self.dynamic_polyline) # Ensure consistent orientation (counter-clockwise)\n                    if flipped:\n                        self.dynamic_polyline = flipped_dynamic_polyline\n                self.dynamic_polyline_nurbs = self.dynamic_polyline.ToNurbsCurve()  # Convert the polyline to a Nurbs curve\n\n                if self.polyline_preview_id:\n                    Display.EndPreviewObjects(self.polyline_preview_id)\n                self.polyline_preview_id = Display.PreviewObjects(\n                    \"dynamic polyline drawing\",\n                    \"new line drawing\",\n                    [self.dynamic_polyline_nurbs],\n                )",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 11,
      "is_solution": false
    },
    {
      "code": "def SweepFromCurve(nurbs_curve=None, width=default_width, height=default_height):\n            \"\"\"Given an input nurbs_curve/polyline, width number, and height number, \n            sweep a rectangle(curve_start_origin/plane, width, height) along the curve, \n            get the sweep result as a 3d brep\"\"\"\n            try:\n                if nurbs_curve is None:\n                    print(\"nurbs_curve is None, returning\")\n                    return None\n\n                path_curve = nurbs_curve.ToNurbsCurve()\n\n                # Create a rectangle profile for sweeping\n                # First, get the start point and tangent vector\n                t = 0.0  # Start of curve\n                start_point = path_curve.PointAt(t)\n                tangent = path_curve.TangentAt(t)\n                \n                # Create a plane perpendicular to the curve at the start point\n                success, perp_frame = path_curve.PerpendicularFrameAt(t)\n                if not success:\n                    # If we can't get a perpendicular frame, create one manually\n                    up_vector = Rhino.Geometry.Vector3d.ZAxis\n                    # Make sure the up vector isn't parallel to the tangent\n                    if abs(Rhino.Geometry.Vector3d.Multiply(up_vector, tangent)) > 0.99:\n                        up_vector = Rhino.Geometry.Vector3d.YAxis\n                    \n                    x_axis = tangent\n                    y_axis = Rhino.Geometry.Vector3d.CrossProduct(up_vector, x_axis)\n                    y_axis.Unitize()\n                    z_axis = Rhino.Geometry.Vector3d.CrossProduct(x_axis, y_axis)\n                    z_axis.Unitize()\n                    \n                    perp_frame = Rhino.Geometry.Plane(start_point, y_axis, z_axis)\n                \n                # Create the rectangular profile\n                # Center the rectangle on the curve\n                center = perp_frame.Origin\n                # Create rectangle corners\n                half_width = width / 2.0\n                rectangle = Rhino.Geometry.Rectangle3d(\n                    perp_frame,\n                    Rhino.Geometry.Interval(-half_width, half_width),\n                    Rhino.Geometry.Interval(0, height)\n                )\n                \n                # Convert the rectangle to a curve\n                profile_curve = rectangle.ToNurbsCurve()\n                \n                # Perform the sweep\n                # Create a rail sweep using the profile and the curve\n                # sweep = Rhino.Geometry.Brep.CreateFromSweep(path_curve, profile_curve, True, scriptcontext.doc.ModelAbsoluteTolerance)\n                \n                # Perform the sweep with additional arguments for mitering and solid geometry\n                sweep = Rhino.Geometry.Brep.CreateFromSweep(\n                    rail=path_curve,\n                    shapes=[profile_curve],\n                    startPoint=path_curve.PointAtStart,\n                    endPoint=path_curve.PointAtEnd,\n                    frameType=Rhino.Geometry.SweepFrame.Roadlike,  # Use roadlike framing for controlled orientation\n                    roadlikeNormal=Rhino.Geometry.Vector3d.ZAxis,   # Use Z axis as the normal reference\n                    closed=True,#path_curve.IsClosed,                     # Handle closed paths correctly\n                    blendType=Rhino.Geometry.SweepBlend.Local,     # Linear blending between cross-sections\n                    miterType=Rhino.Geometry.SweepMiter.Trimmed,      # Use sharp mitering at corners\n                    tolerance=scriptcontext.doc.ModelAbsoluteTolerance,\n                    rebuildType=Rhino.Geometry.SweepRebuild.NONE,   # No rebuild needed for a simple sweep\n                    rebuildPointCount=10,                           # Only used if rebuildType isn't None\n                    refitTolerance=scriptcontext.doc.ModelAbsoluteTolerance\n                )\n\n                \"\"\"CreateFromSweep(\n                    Curve rail,\n                    IEnumerable<Curve> shapes,\n                    Point3d startPoint,\n                    Point3d endPoint,\n                    SweepFrame frameType,\n                    Vector3d roadlikeNormal,\n                    bool closed,\n                    SweepBlend blendType,\n                    SweepMiter miterType,\n                    double tolerance,\n                    SweepRebuild rebuildType,\n                    int rebuildPointCount,\n                    double refitTolerance\n                    )\"\"\"\n\n                \n                if sweep:\n                    return sweep\n    \n                print(\"sweep failed, returning None\")\n                    \n                return None\n                \n            except Exception as ex:\n                Rhino.RhinoApp.WriteLine(f\"SweepFromCurve Exception: {ex}\")\n                return None",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "csharp",
    "geometry",
    "nurbs",
    "python",
    "rhinocommon",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 13,
  "views": 198
}