{
  "source_url": "https://discourse.mcneel.com/t/quick-stl-export-script/197734",
  "topic_id": 197734,
  "title": "Quick Stl-Export Script",
  "question": "Hi,\n\n\nI often find myself exporting a STL file for 3D printing, importing it into the slicer, discovering something that has to change in the file, re-exporting, importing and so on.\n\n\nTo make this a bit faster I made a python-script that someone might find useful as well:\n\n\nYou can set your export settings and a output directory inside the script. When you export then your file, the script will try to figure out if the object has been exported before and if so it will overwrite the previous file. Then you only have to select \nreload STL\n in the slicer to update it.  If it’s a file that hasn’t been exported before it will make a new file based on the filename of the rhino file and the location of the object in the workspace.\n\n\nWhen naming and “tracking” exported objects, the script uses the projected bounding box in centimeters. If a newly exported object’s center point falls within the boundaries of an existing box, the script treats it as the same object. While this approach generally works, it can create confusion when you’re exporting both large assemblies and their individual parts, since their bounding boxes may overlap with each other.\n\n\nYou can run this script form a button or with a shortcut like so:\n\n\n!_-RunPythonScript \"C:\\Filepath\\export_STL.py\"\n\n\ncheers\n\n\nexport_STL.py\n (5.9 KB)\n\n\nimport rhinoscriptsyntax as rs\nimport System.Guid\nimport math\nimport os\n\n# Configuration\nEXPORT_DIR = r\"C:\\Filepath\"\n\n# STL Mesh export settings from Rhino dialog\nMESH_DENSITY = 1          # Mesh density\nMESH_ANGLE = 5.0        # Maximum angle between mesh faces\nMESH_ASPECT = 4.0        # Maximum aspect ratio\nMESH_MIN_EDGE = 0.0001   # Minimum edge length\nMESH_MAX_EDGE = 0        # Maximum edge length\nMESH_EDGE_DISTANCE = 0.008  # Maximum edge to surface distance\nMESH_MIN_GRID = 0        # Minimum initial grid quads\nMESH_FLAGS = \"_RefineGrid=Yes _SimplePlanes=Yes _PackTextures=Yes\"\n\nMESH_SETTINGS = \"_MeshQuality {} _Density {} _MaxAngle {} _AspectRatio {} _MinEdgeLength {} _Ma...",
  "code_blocks": [
    {
      "code": "import rhinoscriptsyntax as rs\nimport System.Guid\nimport math\nimport os\n\n# STL Mesh export settings from Rhino dialog\nMESH_DENSITY = 0.9          # Mesh density\nMESH_ANGLE = 0.0        # Maximum angle between mesh faces\nMESH_ASPECT = 0.0        # Maximum aspect ratio\nMESH_MIN_EDGE = 0.0001   # Minimum edge length\nMESH_MAX_EDGE = 0        # Maximum edge length\nMESH_EDGE_DISTANCE = 0.005  # Maximum edge to surface distance\nMESH_MIN_GRID = 15        # Minimum initial grid quads\nMESH_FLAGS = \"_RefineGrid=Yes _SimplePlanes=Yes _PackTextures=Yes\"\n\nMESH_SETTINGS = \"_MeshQuality {} _Density {} _MaxAngle {} _AspectRatio {} _MinEdgeLength {} _MaxEdgeLength {} _RefineGrid _SimplePlanes _PackTextures _Enter\".format(\n    \"Custom\",\n    MESH_DENSITY,\n    MESH_ANGLE, \n    MESH_ASPECT,\n    MESH_MIN_EDGE,\n    MESH_MAX_EDGE)\n\ndef export_stl(filepath):\n    \"\"\"Export STL with predefined mesh settings without prompts\"\"\"\n    cmd = '-_NoEcho -_Export \"{}\" _STL _UseSimpleDialog=_No _Enter _DetailedOptions _Density={} _GridAngle={} _AspectRatio={} _MinEdgeLen={} _MaxEdgeLen={} _MaxEdgeSrf={} _PackTextures _SimplePlanes _RefineGrid _Enter'.format(\n        filepath,\n        MESH_DENSITY,\n        MESH_ANGLE,\n        MESH_ASPECT,\n        MESH_MIN_EDGE,\n        MESH_MAX_EDGE,\n        MESH_EDGE_DISTANCE\n    )\n    rs.Command(cmd, False)  # False to suppress command line history\n\ndef main():\n    selected_objects = rs.SelectedObjects()\n    if not selected_objects:\n        print(\"No objects selected\")\n        return\n    \n    # Get base filename from current Rhino file\n    doc_name = rs.DocumentName()\n    if doc_name:\n        base_name = doc_name.rsplit('.', 1)[0]\n    else:\n        base_name = \"export\"  # Default name if document name not available\n        print(\"Warning: Could not get document name, using 'export' as base name\")\n    \n    # Prompt for filename and location using SaveFileName\n    filepath = rs.SaveFileName(\"Save STL file\", \"*.stl\", None, base_name)\n    if not filepath:\n        print(\"Export cancelled\")\n        return\n    \n    # Ensure .stl extension\n    if not filepath.lower().endswith('.stl'):\n        filepath += '.stl'\n    \n    # Export the file\n    export_stl(filepath)\n    print(\"Exported {}\".format(os.path.basename(filepath)))\n\nif __name__ == '__main__':\n    main()",
      "language": "python",
      "author": "doubletrouble",
      "post_number": 2,
      "is_solution": false
    },
    {
      "code": "import rhinoscriptsyntax as rs\nimport System.Guid\nimport math\nimport os\n\n# Configuration\nEXPORT_DIR = r\"C:\\Filepath\"\n\n# STL Mesh export settings from Rhino dialog\nMESH_DENSITY = 1          # Mesh density\nMESH_ANGLE = 5.0        # Maximum angle between mesh faces\nMESH_ASPECT = 4.0        # Maximum aspect ratio\nMESH_MIN_EDGE = 0.0001   # Minimum edge length\nMESH_MAX_EDGE = 0        # Maximum edge length\nMESH_EDGE_DISTANCE = 0.008  # Maximum edge to surface distance\nMESH_MIN_GRID = 0        # Minimum initial grid quads\nMESH_FLAGS = \"_RefineGrid=Yes _SimplePlanes=Yes _PackTextures=Yes\"\n\nMESH_SETTINGS = \"_MeshQuality {} _Density {} _MaxAngle {} _AspectRatio {} _MinEdgeLength {} _MaxEdgeLength {} _RefineGrid _SimplePlanes _PackTextures _Enter\".format(\n    \"Custom\",\n    MESH_DENSITY,\n    MESH_ANGLE, \n    MESH_ASPECT,\n    MESH_MIN_EDGE,\n    MESH_MAX_EDGE)\n\ndef ensure_export_dir():\n    \"\"\"Ensure export directory exists\"\"\"\n    if not os.path.exists(EXPORT_DIR):\n        os.makedirs(EXPORT_DIR)\n\ndef get_projected_bounds():\n    \"\"\"Get the projected bounds of all selected objects\"\"\"\n    selected_objects = rs.SelectedObjects()\n    if not selected_objects:\n        return None\n    \n    bbox = rs.BoundingBox(selected_objects)\n    if not bbox:\n        return None\n    \n    #convert to cm\n    min_x = min(pt.X for pt in bbox)/10\n    max_x = max(pt.X for pt in bbox)/10\n    min_y = min(pt.Y for pt in bbox)/10\n    max_y = max(pt.Y for pt in bbox)/10\n    \n    # outward rounding\n    min_x = int(math.ceil(min_x) if min_x < 0 else math.floor(min_x))\n    max_x = int(math.floor(max_x) if max_x < 0 else math.ceil(max_x))\n    min_y = int(math.ceil(min_y) if min_y < 0 else math.floor(min_y))\n    max_y = int(math.floor(max_y) if max_y < 0 else math.ceil(max_y))\n    \n    return min_x, min_y, max_x, max_y\n\ndef format_coordinate(value):\n    \"\"\"Format coordinate with P/N prefix, treating 0 as positive\"\"\"\n    value = int(value)  # Ensure integer value\n    if value >= 0:\n        return \"P{}\".format(value)\n    return \"N{}\".format(abs(value))\n\ndef construct_filename(base_name, bounds):\n    \"\"\"Construct filename with coded coordinates\"\"\"\n    min_x, min_y, max_x, max_y = bounds\n    coords = [format_coordinate(c) for c in [min_x, min_y, max_x, max_y]]\n    return \"{}_{}.stl\".format(base_name, ''.join(coords))\n\ndef export_stl(filepath):\n    \"\"\"Export STL with predefined mesh settings without prompts\"\"\"\n    cmd = '-_NoEcho -_Export \"{}\" _STL _UseSimpleDialog=_No _Enter _DetailedOptions _Density={} _GridAngle={} _AspectRatio={} _MinEdgeLen={} _MaxEdgeLen={} _MaxEdgeSrf={} _PackTextures _SimplePlanes _RefineGrid _Enter'.format(\n        filepath,\n        MESH_DENSITY,\n        MESH_ANGLE,\n        MESH_ASPECT,\n        MESH_MIN_EDGE,\n        MESH_MAX_EDGE,\n        MESH_EDGE_DISTANCE\n    )\n    rs.Command(cmd, False)  # False to suppress command line history\n\ndef point_in_bounds(point, bounds):\n    \"\"\"Check if point lies within bounds\"\"\"\n    if not bounds or len(bounds) != 4:\n        return False\n    min_x, min_y, max_x, max_y = bounds\n    return (min_x <= point[0] <= max_x and \n            min_y <= point[1] <= max_y)\n\ndef get_center_point(bounds):\n    \"\"\"Get center point of bounds\"\"\"\n    min_x, min_y, max_x, max_y = bounds\n    return ((min_x + max_x) / 2, (min_y + max_y) / 2)\n\ndef parse_filename_bounds(filename):\n    \"\"\"Parse bounds from filename format like 'rhinofile_P3P10N3N5.stl'\n    Returns (min_x, min_y, max_x, max_y)\"\"\"\n    try:\n        # Get just the filename without path\n        filename = os.path.basename(filename)\n        # Split filename and get the coordinate part\n        coords_part = filename.rsplit('.', 1)[0].split('_')[-1]\n        \n        # Initialize variables\n        coords = []\n        current_num = \"\"\n        sign = 1\n        \n        # Parse the coordinate string\n        for char in coords_part:\n            if char == 'P':\n                if current_num:\n                    coords.append(sign * int(current_num))\n                sign = 1\n                current_num = \"\"\n            elif char == 'N':\n                if current_num:\n                    coords.append(sign * int(current_num))\n                sign = -1\n                current_num = \"\"\n            else:  # must be a digit\n                current_num += char\n        \n        # Add the last number\n        if current_num:\n            coords.append(sign * int(current_num))\n        \n        # Verify we got exactly 4 coordinates\n        if len(coords) != 4:\n            raise ValueError(\"Invalid coordinate format\")\n            \n        return tuple(coords)\n        \n    except Exception as e:\n        print(\"Error parsing filename: {}\".format(e))\n        return None\n\ndef main():\n    ensure_export_dir()\n    \n    bounds = get_projected_bounds()\n    if not bounds:\n        print(\"No objects selected\")\n        return\n    \n    # Get base filename from current Rhino file\n    doc_name = rs.DocumentName()\n    if doc_name:\n        base_name = doc_name.rsplit('.', 1)[0]\n    else:\n        base_name = \"export\"  # Default name if document name not available\n        print(\"Warning: Could not get document name, using 'export' as base name\")\n    \n    # Construct new filename\n    filename = construct_filename(base_name, bounds)\n    filepath = os.path.join(EXPORT_DIR, filename)\n    \n    # Get center point of current bounds\n    center = get_center_point(bounds)\n    \n    # Check for existing files and handle export\n    if os.path.exists(filepath):\n        old_bounds = parse_filename_bounds(filename)\n        if old_bounds and point_in_bounds(center, old_bounds):\n            export_stl(filepath)  # Overwrite\n            print(\"Overwritten {}\".format(filename))\n        else:\n            export_stl(filepath)  # New file\n            print(\"Exported {}\".format(filename))\n    else:\n        export_stl(filepath)  # New file\n        print(\"Exported {}\".format(filename))\n\nif __name__ == '__main__':\n    main()",
      "language": "python",
      "author": "Konrad",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "materials",
    "mesh",
    "python",
    "rhinoscriptsyntax",
    "selection"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 8,
  "views": 319
}