{
  "source_url": "https://github.com/SHLFab/shl-toolbox/blob/268349a38b254c507c73a5a12f81f05d8af3acfc/buildhelpers/build_shl_toolbar_installer.py",
  "repo": "SHLFab/shl-toolbox",
  "repo_stars": 1,
  "repo_description": "SHL Fabrication tools",
  "license": "AGPL-3.0",
  "filepath": "buildhelpers/build_shl_toolbar_installer.py",
  "instruction": "Build shl toolbar installer",
  "code": "import clr\nclr.AddReference('System.Xml.Linq')\nimport System.Xml.Linq as xm\nimport subprocess\nimport os\nimport zipfile\n\n#todo: build xml properly (why is is coming out strangely when using XDocument.Save?)\n\n#generate xml for command list\ndef make_xml_command_list(command_list,dir):\n\t\"\"\"generate xml for command list\"\"\"\n\tcommand_elements = []\n\tfor command_name in command_list:\n\t\tpath = dir + command_name + '.py'\n\t\tcommand = xm.XElement(xm.XName.Get(\"Command\"),\n\t\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"Name\"),command_name),\n\t\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"Path\"),path),\n\t\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"Type\"),\"Normal\")\n\t\t\t\t\t\t\t\t)\n\t\tcommand_elements.append(command)\n\treturn command_elements\n\n\ndef make_plugin_info(version_num):\n\t\"\"\"generate xml for plugin info\"\"\"\n\tname = \"SHL Toolbar\"\n\tbuild_directory = REPO_PATH + \"build\\\\\"\n\tauthor = \"SHL Architects - Sean Lamb (Developer)\"\n\temail = \"aam@shl.dk\"\n\tphone = \" \"\n\taddress = \"Njalsgade 17A/Pakhus 2/2300 Copenhagen S/Denmark\"\n\tcountry = \"Denmark\"\n\twebsite = \"www.shl.dk\"\n\tupdate_url = \"\"\n\tcopyright = \"Loading SHL Fabrication Toolbox v\" + str(version_num)\n\trc_directory = \"C:\\\\Program Files\\\\Rhino 6\\\\System\\\\RhinoCommon.dll\"\n\t\n\tplugin = xm.XElement(xm.XName.Get(\"Plugin\"),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"PluginName\"),name),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"PluginFolder\"),build_directory),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorName\"),author),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorEmail\"),email),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorPhone\"),phone),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorAddress\"),address),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorCountry\"),country),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"AuthorWebsite\"),website),\n\t\t\t\t\t\t\txm.XElement(\"UpdateURL\"),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"CopyrightMessage\"),copyright),\n\t\t\t\t\t\t\txm.XElement(xm.XName.Get(\"RhinoCommonOverride\"),rc_directory)\n\t\t\t\t\t\t\t)\n\treturn plugin\n\n\ndef archive_from_files(name,home_dir,files,extension='zip'):\n\tfilename = name + \".\" + extension\n\tpath = os.path.join(home_dir,filename)\n\twith zipfile.ZipFile(path,mode='a',compression=zipfile.ZIP_DEFLATED) as myzip:\n\t\tfor x in files:\n\t\t\tmyzip.write(x,arcname=os.path.basename(x))\n\n#make rhp file\ndef make_rhi(rhp_path,rui_path,directory_out):\n\t\"\"\"make rhi file from rhp and rui\"\"\"\n\tpass\n\nif __name__==\"__main__\":\n\t\n\t#set to local repo location\n\tglobal REPO_PATH\n\tREPO_PATH = 'C:\\\\Users\\\\lambs\\\\AppData\\\\Roaming\\\\McNeel\\\\Rhinoceros\\\\6.0\\\\scripts\\\\shl-toolbox\\\\'\n\t\n\tversion_num = 0.3\n\trhc_filename = \"SHL_Toolbar.rhc\"\n\tcommands_path = REPO_PATH + 'command_staging\\\\' #path to the directory with the commands\n\t#List all command names by their filenames here. The command name will be the same as the filename.\n\tcommand_list = [\n\t\t\t\"shlBridge\",\n\t\t\t\"shlSliceVolumes\",\n\t\t\t\"shlTag\",\n\t\t\t\"shlLaserSheet\",\n\t\t\t\"shlLayer\",\n\t\t\t\"shlPlotVolumes\",\n\t\t\t\"shlUnrollWithThickness\",\n\t\t\t\"shlMakeBox\",\n\t\t\t\"shlCollapseBox\",\n\t\t\t\"shlSketchLayers\",\n\t\t\t\"shlSmartOutline\",\n\t\t\t\"shlCutTerrain\",\n\t\t\t\"shlMakeSlidingLidBox\",\n\t\t\t\"shlCutPlan\"\n\t\t\t]\n\t\n\txml_command_list = make_xml_command_list(command_list,commands_path)\n\tplugin = make_plugin_info(version_num)\n\t\n\tcommands = xm.XElement(xm.XName.Get(\"Commands\"),xml_command_list)\n\tmenu = xm.XElement(\"Menu\")\n\t\n\txdoc = xm.XDocument(xm.XDeclaration(\"1.0\",\"utf-16\",\"no\"),xm.XElement(\n\t\t\t\txm.XName.Get(\"RhinoScriptCompilerProject\"),plugin,commands,menu))\n\t\n\t#location of rhinoscriptcompiler.\n\tpath_to_exe = REPO_PATH + 'buildhelpers\\\\RhinoScriptCompiler.exe' \n\t\n\t#Place where the Rhinoscript Compiler Project file SHL_Toolbar.rhc is located.\n\t#This is an XML file built by the batchscript automatically and read by the RhinoScriptCompiler\n\tpath_to_file = REPO_PATH + 'build\\\\' + rhc_filename \n\t\n\t#Write the xml to a .rhc file.\n\t#Dev note: using .ToString() here is poor form, .Save is preferred... but not working for some reason...\n\t#xdoc.Save(\"test1.rhc\",xm.SaveOptions.DisableFormatting)\n\tstr_doc = xdoc.ToString()\n\tfile = open(path_to_file,'w')\n\tfile.write('<?xml version=\"1.0\" encoding=\"utf-16\"?>\\n')\n\tfile.write(str_doc)\n\tfile.close()\n\tprint str_doc\n\n\t#Make the rhp file by running RhinoScriptCompiler.exe with SHL_Toolbar.rhc as an argument.\n\tsubprocess.call([path_to_exe,path_to_file])\n\n\n\t#Get paths to the location of the rhp, rui, and the build directory where the .rhi file will be placed.\n\trhp_path = os.path.normpath(REPO_PATH + 'build\\\\SHL_Toolbar.rhp')\n\trui_path = os.path.normpath(REPO_PATH + 'build\\\\SHL_Toolbar.rui')\n\trhi_build_path = os.path.normpath(REPO_PATH + 'build\\\\')\n\t\n\t#Remove any existing .rhi in the build directory.\n\ttry:\n\t\tos.remove(os.path.normpath(REPO_PATH + 'build\\\\SHL_Toolbar.rhi'))\n\t\tprint \"removed existing rhi\"\n\texcept:\n\t\tpass\n\t\n\t#zip together the rhi and rui files and give the archive the .rhi extension.\n\t#.rhi files are just zipped files with the extension .zip renamed to .rhi\n\tarchive_from_files(\"SHL_Toolbar\",rhi_build_path,[rhp_path,rui_path],'rhi')\n#\tprint rhp_path\n#\tprint rui_path\n#\tprint rhi_build_path\n",
  "language": "python",
  "imports": [
    "RhinoCommon"
  ],
  "has_docstring": false
}