{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/climate_site_from_phius_file.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/climate_site_from_phius_file.py",
  "instruction": "GHCompo Interface: HBPH - Create Site From Phius File.",
  "code": "# -*- Python Version: 2.7 -*-\n# -*- coding: utf-8 -*-\n\n\"\"\"GHCompo Interface: HBPH - Create Site From Phius File.\"\"\"\n\ntry:\n    from typing import Dict, List, Optional, Union\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph import site\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\n    from honeybee_ph_rhino.gh_compo_io import ghio_validators\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\n\ndef remove_non_ascii(string):\n    return \"\".join(char for char in string if ord(char) < 128)\n\n\ndef clean_key(key):\n    # type: (str) -> str\n    \"\"\"Utility function to clean the data key\"\"\"\n    return remove_non_ascii(key.upper().lstrip().rstrip().replace(\" \", \"_\"))\n\n\nclass MonthlyDataInputCollection(object):\n    \"\"\"A Collection of Monthly data.\"\"\"\n\n    def __init__(self):\n        self.storage = {}\n\n    def _clean_values(self, _input_value_list):\n        # type: (List[str]) -> List[float]\n        _ = []\n        for i in _input_value_list:\n            try:\n                _.append(float(i))\n            except:\n                _.append(i)\n        return _\n\n    def __setitem__(self, key, value):\n        # type: (str, List[str]) -> None\n        self.storage[clean_key(key)] = self._clean_values(value)\n\n    def __getitem__(self, key):\n        return self.storage[key]\n\n    def keys(self):\n        return self.storage.keys()\n\n    @property\n    def air_temps(self):\n        # type: () -> List[float]\n        return self[\"TEMPERATURE_OUTDOOR\"]\n\n    @property\n    def dewpoints(self):\n        # type: () -> List[float]\n        return self[\"DEWPOINT\"]\n\n    @property\n    def sky_temps(self):\n        # type: () -> List[float]\n        return self[\"SKY_TEMPERATURE\"]\n\n    @property\n    def north(self):\n        # type: () -> List[float]\n        return self[\"NORTH\"]\n\n    @property\n    def east(self):\n        # type: () -> List[float]\n        return self[\"EAST\"]\n\n    @property\n    def south(self):\n        # type: () -> List[float]\n        return self[\"SOUTH\"]\n\n    @property\n    def west(self):\n        # type: () -> List[float]\n        return self[\"WEST\"]\n\n    @property\n    def glob(self):\n        # type: () -> List[float]\n        return self[\"GLOBAL\"]\n\n    @property\n    def location_data(self):\n        # type: () -> List[str | float]\n        return self[\"LOCATION_DATA\"]\n\n    @property\n    def display_name(self):\n        # type: () -> str\n        return str(self.location_data[0])\n\n    @property\n    def station_elevation(self):\n        # type: () -> float\n        for i, data_item in enumerate(self.location_data):\n            if \"Height\" in str(data_item):\n                return float(str(self.location_data[i + 1]).strip())\n        raise ValueError(\"'Height' not found in location data? Please check the input file format.\")\n\n    @property\n    def daily_temp_swing(self):\n        # type: () -> float\n        for i, data_item in enumerate(self.location_data):\n            if \"Daily temperature variation\" in str(data_item):\n                return float(str(self.location_data[i + 1]).strip())\n        return 8.0\n\n    @property\n    def average_wind_speed(self):\n        # type: () -> float\n        return 4\n\n    @property\n    def latitude(self):\n        # type: () -> float\n        for i, data_item in enumerate(self.location_data):\n            if \"Latitude\" in str(data_item):\n                return float(str(self.location_data[i + 1]).strip())\n        raise ValueError(\"'Latitude' not found in location data? Please check the input file format.\")\n\n    @property\n    def longitude(self):\n        # type: () -> float\n        for i, data_item in enumerate(self.location_data):\n            if \"Longitude\" in str(data_item):\n                return float(str(self.location_data[i + 1]).strip())\n        raise ValueError(\"'Longitude' not found in location data? Please check the input file format.\")\n\n    def __str__(self):\n        return \"\\n\".join(\n            [\n                (\"air_temps: {}\".format(self.air_temps)),\n                (\"dewpoints: {}\".format(self.dewpoints)),\n                (\"sky_temps: {}\".format(self.sky_temps)),\n                (\"north: {}\".format(self.north)),\n                (\"east:: {}\".format(self.east)),\n                (\"south: {}\".format(self.south)),\n                (\"west: {}\".format(self.west)),\n                (\"global: {}\".format(self.glob)),\n                (\"location_data: {}\".format(self.location_data)),\n            ]\n        )\n\n\nclass PeakLoadValueSet(object):\n    \"\"\"The data for a single peak-load (heating, cooling).\"\"\"\n\n    def __init__(self):\n        self.storage = {}  # type: Dict[str, float]\n\n    def __setitem__(self, key, value):\n        # type: (str, float) -> None\n        self.storage[clean_key(key)] = value\n\n    def __getitem__(self, key):\n        # type: (str) -> float\n        return self.storage[key]\n\n    @property\n    def air_temp(self):\n        # type: () -> float\n        return self[\"TEMPERATURE_OUTDOOR\"]\n\n    @property\n    def dewpoint(self):\n        # type: () -> Optional[float]\n        try:\n            return self[\"DEWPOINT\"]\n        except KeyError:\n            return None\n\n    @property\n    def sky_temp(self):\n        # type: () -> Optional[float]\n        try:\n            return self[\"SKY_TEMPERATURE\"]\n        except KeyError:\n            return None\n\n    @property\n    def ground_temp(self):\n        # type: () -> Optional[float]\n        try:\n            return self[\"GROUND_TEMPERATURE\"]\n        except KeyError:\n            return None\n\n    @property\n    def north(self):\n        # type: () -> float\n        return self[\"NORTH\"]\n\n    @property\n    def east(self):\n        # type: () -> float\n        return self[\"EAST\"]\n\n    @property\n    def south(self):\n        # type: () -> float\n        return self[\"SOUTH\"]\n\n    @property\n    def west(self):\n        # type: () -> float\n        return self[\"WEST\"]\n\n    @property\n    def glob(self):\n        # type: () -> float\n        return self[\"GLOBAL\"]\n\n\nclass PeakLoadInputCollection(object):\n    \"\"\"A collection of Peak Load Datasets (2 Heating, 2 Cooling).\"\"\"\n\n    def __init__(self):\n        self.peak_heat_load_1 = PeakLoadValueSet()\n        self.peak_heat_load_2 = PeakLoadValueSet()\n        self.peak_cooling_load_1 = PeakLoadValueSet()\n        self.peak_cooling_load_2 = PeakLoadValueSet()\n\n\nclass GHCompo_CreateSiteFromPhiusFile(object):\n    \"\"\"Interface for the GH Component\"\"\"\n\n    site_elevation = ghio_validators.UnitM(\"station_elevation\")\n    _allowable_climate_zones = {\n        1: \"Not defined\",\n        11: \"US 1\",\n        12: \"US 2\",\n        13: \"US 3\",\n        14: \"US 4\",\n        141: \"US 4C\",\n        15: \"US 5\",\n        16: \"US 6\",\n        17: \"US 7\",\n        18: \"US 8\",\n    }\n\n    def __init__(self, _IGH, _source_file_path, _site_elevation, _climate_zone, *args, **kwargs):\n        # type: (gh_io.IGH, str, float | None, str, List, Dict) -> None\n        self.IGH = _IGH\n        self.data = self._get_input_data(_source_file_path)\n        self.monthly_data_collection = MonthlyDataInputCollection()\n        self.peak_load_data_collection = PeakLoadInputCollection()\n        self.site_elevation = _site_elevation\n        self.climate_zone = self.clean_climate_zone(_climate_zone or 1)\n\n    def clean_climate_zone(self, _cz_input):\n        # type: (Union[str, int]) -> int\n        \"\"\"Check the input climate zone and return the number.\"\"\"\n\n        cz_number = gh_io.input_to_int(str(_cz_input))\n        if not cz_number:\n            return 1\n\n        if cz_number not in self._allowable_climate_zones.keys():\n            msg = \"Climate zone number must be one of the following:\\n\"\n            msg += \", \".join([\"'{}-{}'\".format(k, v) for k, v in self._allowable_climate_zones.items()])\n            self.IGH.error(msg)\n            return 1\n\n        return cz_number\n\n    def _get_input_data(self, _source_file_path):\n        # type: (str | None) -> list[str]\n        \"\"\"Read in the Phius Data file and return a cleaned list of the contents.\"\"\"\n        raw_data = self._read_file(_source_file_path)\n        return self._clean_input_data(raw_data)\n\n    def _read_file(self, _source_file_path):\n        # type: (str | None) -> list[str]\n        \"\"\"Read in the Phius Data file (TXT only) and return a list of the contents.\"\"\"\n\n        if not _source_file_path:\n            msg = \"Please supply a valid .TXT file path for the Phius data to read.\"\n            self.IGH.warning(msg)\n            return []\n\n        extension = _source_file_path[-3:].upper()\n        if extension != \"TXT\":\n            msg = \"Error: Input Phius data '.TXT' file path. Got file of type: '{}'?\".format(extension)\n            self.IGH.error(msg)\n            return []\n\n        return self.IGH.ghpythonlib_components.ReadFile(_source_file_path)\n\n    def _clean_input_data(self, _data):\n        # type: (list[str]) -> list[str]\n        \"\"\"Remove any blank lines from the input data.\"\"\"\n\n        return [line for line in _data if line.strip()]\n\n    def _create_input_data_collection(self):\n        # type: () -> None\n\n        \"\"\"\n        Generate a dict (self.input_data_collection) that looks like:\n\n        {\n            \"Ambient Temp\": [10, 14, 17, ... 4],\n            \"North\": [10, 14, 17, ... 4], #<-- Radiation\n            \"East\": [10, 14, 17, ... 4],\n            \"South\": [10, 14, 17, ... 4],\n            \"West\": [10, 14, 17, ... 4],\n            \"Global\": [10, 14, 17, ... 4],\n            \"Dewpoint\": [10, 14, 17, ... 4],\n            \"Sky Temperature\": [10, 14, 17, ... 4],\n        }\n        \"\"\"\n        for line in self.data[1:9]:\n            # -- Log the monthly data\n            line = line.split(\"\\t\")\n\n            # -- Get the field name\n            field_name = line[0]  # North, South, East, West, Global, Dewpoint, Sky Temperature\n\n            self.monthly_data_collection[field_name] = line[1:13]\n\n        for line in self.data[1:7]:\n            line = line.split(\"\\t\")\n\n            # -- Get the field name\n            field_name = line[0]  # North, South, East, West, Global, Dewpoint, Sky Temperature\n\n            # -- Log the peak load data\n            self.peak_load_data_collection.peak_heat_load_1[field_name] = float(line[13])\n            self.peak_load_data_collection.peak_heat_load_2[field_name] = float(line[14])\n            self.peak_load_data_collection.peak_cooling_load_1[field_name] = float(line[15])\n            self.peak_load_data_collection.peak_cooling_load_2[field_name] = float(line[15])\n\n        # -- Log the header / location data\n        self.monthly_data_collection[\"LOCATION_DATA\"] = self.data[0].split(\"\\t\")\n\n    def _create_location(self):\n        # type: () -> site.Location\n\n        site_elevation = self.site_elevation or self.monthly_data_collection.station_elevation\n\n        return site.Location(\n            latitude=self.monthly_data_collection.latitude,\n            longitude=self.monthly_data_collection.longitude,\n            site_elevation=site_elevation,\n            climate_zone=self.climate_zone,\n            hours_from_UTC=-5,  # TODO: make automatic somehow?\n        )\n\n    def _create_monthly_temps(self):\n        # type: () -> site.Climate_MonthlyTempCollection\n\n        return site.Climate_MonthlyTempCollection(\n            _air=site.Climate_MonthlyValueSet(self.monthly_data_collection.air_temps),\n            _dewpoint=site.Climate_MonthlyValueSet(self.monthly_data_collection.dewpoints),\n            _sky=site.Climate_MonthlyValueSet(self.monthly_data_collection.sky_temps),\n        )\n\n    def _create_monthly_radiation(self):\n        # type: () -> site.Climate_MonthlyRadiationCollection\n\n        return site.Climate_MonthlyRadiationCollection(\n            _north=site.Climate_MonthlyValueSet(self.monthly_data_collection.north),\n            _east=site.Climate_MonthlyValueSet(self.monthly_data_collection.east),\n            _south=site.Climate_MonthlyValueSet(self.monthly_data_collection.south),\n            _west=site.Climate_MonthlyValueSet(self.monthly_data_collection.west),\n            _glob=site.Climate_MonthlyValueSet(self.monthly_data_collection.glob),\n        )\n\n    def _create_peak_load_value_set(self, _peak_load_data):\n        # type: (PeakLoadValueSet) -> site.Climate_PeakLoadValueSet\n\n        climate_peak_loads_ = site.Climate_PeakLoadValueSet(\n            _temp=_peak_load_data.air_temp,\n            _rad_north=_peak_load_data.north,\n            _rad_east=_peak_load_data.east,\n            _rad_south=_peak_load_data.south,\n            _rad_west=_peak_load_data.west,\n            _rad_global=_peak_load_data.glob,\n            _dewpoint_temp=_peak_load_data.dewpoint,\n            _sky_temp=_peak_load_data.sky_temp,\n            _ground_temp=_peak_load_data.ground_temp,\n        )\n        climate_peak_loads_.display_name = self.monthly_data_collection.display_name\n\n        return climate_peak_loads_\n\n    def _create_peak_loads(self):\n        # type: () -> site.Climate_PeakLoadCollection\n\n        climate_peak_loads_ = site.Climate_PeakLoadCollection(\n            self._create_peak_load_value_set(self.peak_load_data_collection.peak_heat_load_1),\n            self._create_peak_load_value_set(self.peak_load_data_collection.peak_heat_load_2),\n            self._create_peak_load_value_set(self.peak_load_data_collection.peak_cooling_load_1),\n            self._create_peak_load_value_set(self.peak_load_data_collection.peak_cooling_load_2),\n        )\n        return climate_peak_loads_\n\n    def _create_climate_data(self):\n        # type: () -> site.Climate\n\n        climate_data_ = site.Climate(\n            _display_name=self.monthly_data_collection.display_name,\n            _station_elevation=self.monthly_data_collection.station_elevation,\n            _daily_temp_swing=self.monthly_data_collection.daily_temp_swing,\n            _average_wind_speed=self.monthly_data_collection.average_wind_speed,\n            _monthly_temps=self._create_monthly_temps(),\n            _monthly_radiation=self._create_monthly_radiation(),\n            _peak_loads=self._create_peak_loads(),\n        )\n\n        return climate_data_\n\n    def run(self):\n        # type: () -> Optional[site.Site]\n        if not self.data:\n            return None\n\n        self._create_input_data_collection()\n\n        ph_site = site.Site(self._create_location(), self._create_climate_data())\n\n        return ph_site\n",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}