{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_CreateKnitNetworkDual.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_CreateKnitNetworkDual.py",
  "instruction": "Create the dual network of a KnitNetwork. The supplied network should consist\nof the finalized 'weft' and 'warp' edges. The resulting dual will have a node\nfor each cycle (quad or triangle) of the...",
  "code": "\"\"\"\nCreate the dual network of a KnitNetwork. The supplied network should consist\nof the finalized 'weft' and 'warp' edges. The resulting dual will have a node\nfor each cycle (quad or triangle) of the original network, each representing a\nstitch for the knitting pattern.\nCycles with two 'warp' and two 'weft' edges represent a regular stitch.\nCycles with one 'warp' and two 'weft' edges represent the start or the end of\na short row.\nCycles with two 'warp' edges and one 'weft' edge represent an increase or\ndecrease of stitches, relative to the previous or next row of\nstitches.\n---\n[NOTE] This algorithm relies on finding cycles (quads and triangles) for the\nsupplied network. This is not a trivial task in 3d space - at least to my\nknowlege. Assigning a geometrybase to the KnitNetwork on initialization\nand choosing cyclesmode 1 or 2 greatly improves reliability!\nNone the less, success is very dependent on the curvature of the original\nsurface or mesh used.\n---\n[WARNING] If the topology of the supplied network is not as \nexpected, it will yield unpredictable results.\n---\n[IMPLEMENTATION DETAIL] N-Gons are deliberately ignored. The output will be of\ntype KnitDiNetwork.\n    Inputs:\n        Toggle: Set to True to activate the component.\n                {item, bool}\n        KnitNetwork: The KnitNetwork to create the dual network to.\n                     {item, KnitNetwork}\n        CyclesMode: Determines how the neighbors of each node are sorted when\n                    finding the cycles of the network.\n                    [-1] equals to using the world XY plane (default)\n                    [0] equals to using a plane normal to the origin nodes \n                        closest point on the geometrybase\n                    [1] equals to using a plane normal to the average of the \n                        origin and neighbor nodes' closest points on the\n                        geometrybase\n                    [2] equals to using an average plane between a plane fit to \n                        the origin and its neighbor nodes and a plane normal to \n                        the origin nodes closest point on the geometrybase.\n                    Defaults to [-1].\n                    {item, int}\n        MergeAdjacentCreases: If True, will merge adjacent 'increase' and\n                              'decrease' nodes connected by a 'weft' edge into a\n                              single node. This effectively simplifies the\n                              pattern, as a decrease is unneccessary to perform\n                              if an increase is right beside it - both nodes\n                              can be replaced by a single regular node (stitch).\n                              Defaults to True.\n                              {item, bool}\n        MendTrailingRows: If True, will attempt to remove trailing rows at\n                          the left and right bounds of the network by moving\n                          increases and decreases that occur to the left or\n                          right of the previous row inside of the bounds.\n                          Defaults to False.\n                          {item, bool}\n    Outputs:\n        KnitNetworkDual: The dual network of the input KnitNetwork.\n                     {item, KnitNetwork}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200705\n\"\"\"\n\n# PYTHON STANDARD LIBRARY IMPORTS\nfrom __future__ import division\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"CreateKnitNetworkDual\"\nghenv.Component.NickName =\"CKND\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"06 KnitNetwork\"\n\n# LOCAL MODULE IMPORTS\ntry:\n    from cockatoo.exception import KnitNetworkTopologyError\nexcept ImportError:\n    errMsg = \"The Cockatoo python module seems to be not correctly \" + \\\n             \"installed! Please make sure the module is in you search \" + \\\n             \"path, see README for instructions!.\"\n    raise ImportError(errMsg)\n\nclass CreateKnitNetworkDual(component):\n    \n    def RunScript(self, Toggle, KnitNetwork, CyclesMode, MergeAdjacentCreases=True, MendTrailingRows=True):\n        \n        # sanitize inputs\n        if CyclesMode == None:\n            CyclesMode = -1\n        elif CyclesMode < 0:\n            CyclesMode = -1\n        elif CyclesMode > 2:\n            CyclesMode = 2\n        \n        # initialize Output\n        Dual = Grasshopper.DataTree[object]()\n        \n        if Toggle and KnitNetwork:\n            \n            if CyclesMode != -1 and not KnitNetwork.graph[\"reference_geometry\"]:\n                errMsg = \"KnitNetwork has no reference geometry \" + \\\n                         \"attached! Will fall back to World XY plane.\"\n                rml = self.RuntimeMessageLevel.Warning\n                self.AddRuntimeMessage(rml, errMsg)\n            \n            # CREATE DUAL ------------------------------------------------------\n            try:\n                Dual = KnitNetwork.create_dual(\n                                    mode=CyclesMode,\n                                    merge_adj_creases=MergeAdjacentCreases,\n                                    mend_trailing_rows=MendTrailingRows)\n            except NotImplementedError as e:\n                if MendTrailingRows:\n                    Dual = KnitNetwork.create_dual(\n                                    mode=CyclesMode,\n                                    merge_adj_creases=MergeAdjacentCreases,\n                                    mend_trailing_rows=False)\n                    rml = self.RuntimeMessageLevel.Warning\n                    rMsg = \"Not implemented option MendTrailingRows was ignored!\"\n                    self.AddRuntimeMessage(rml, rMsg)\n                    self.AddRuntimeMessage(rml, e.message)\n            except Exception as e:\n                rml = self.RuntimeMessageLevel.Error\n                rMsg = \"Dual could not be created for the input network!\"\n                self.AddRuntimeMessage(rml, rMsg)\n                self.AddRuntimeMessage(rml, e.message)\n        \n        elif Toggle and not KnitNetwork:\n            rml = self.RuntimeMessageLevel.Warning\n            rMsg = \"No KnitNetwork input!\"\n            self.AddRuntimeMessage(rml, rMsg)\n        \n        # return the result\n        return Dual\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}