{
  "source_url": "https://github.com/ladybug-tools/honeybee-legacy/blob/bd62af4862fe022801fb87dbc8794fdf1dff73a9/src/Honeybee_addHBGlz.py",
  "repo": "ladybug-tools/honeybee-legacy",
  "repo_stars": 129,
  "repo_description": ":bee: Honeybee is a free and open source plugin to connect Grasshopper3D to EnergyPlus, Radiance, Daysim and OpenStudio for building energy and daylighting simulation",
  "license": "NOASSERTION",
  "filepath": "src/Honeybee_addHBGlz.py",
  "instruction": "Use this component to add a custom glazing surface to a HBSurface or HBZone.",
  "code": "#\n# Honeybee: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n# \n# This file is part of Honeybee.\n# \n# Copyright (c) 2013-2020, Mostapha Sadeghipour Roudsari <mostapha@ladybug.tools> \n# Honeybee is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# Honeybee is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with Honeybee; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n\n\"\"\"\nUse this component to add a custom glazing surface to a HBSurface or HBZone.\n\n-\nProvided by Honeybee 0.0.66\n\n    Args:\n        _HBObj: A HBZone or HBSurface to which you would like to add a customized glazing surface.\n        _childSurfaces: A surface or list of surfaces that represent the custom window(s) that you would like to add.  Note that these surfaces should be co-planar to the connected HBSurface or one of the surfaces of the connected HBZones.\n        childSurfacesName_: An optional list of names for child surfaces. If names are provided the length of names should be the same as _childSurfaces.\n        EPConstructions_: An optional list of EnergyPlus constructions to set the material construction of the window added to the HBSurface or HBZone.  This can be either the name of a window construction from the OpenStudio library (coming out of the 'Honeybee_Call from EP Construction Library' component) or a custom window construction you created from the 'Honeybee_EnergyPlus Construction' component. The list should match with childSurfaces list. In case the list doesn't match the first construction will be used for all surfaces.\n        RADMaterials_: An optional Radiance material to set the material of the window added to the HBSurface or HBZone.  This can be either the name of a window material from the default Radaince library (coming out of the 'Honeybee_Call from Radiance Library' component) or a custom window material you created from any of the Radiance material components (like the 'Honeybee_Radiance Glass Material' component). The list should match with childSurfaces list. In case the list doesn't match the first material will be used for all surfaces.\n    Returns:\n        readMe!:...\n        HBObjWGLZ: The Honeybee surface or zone with assigned glazing (in case of success).\n\"\"\"\n\nimport rhinoscriptsyntax as rs\nimport Rhino as rc\nimport scriptcontext as sc\nimport os\nimport sys\nimport System\nimport Grasshopper.Kernel as gh\nimport uuid\n\nghenv.Component.Name = 'Honeybee_addHBGlz'\nghenv.Component.NickName = 'addHBGlz'\nghenv.Component.Message = 'VER 0.0.66\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"HB-Legacy\"\nghenv.Component.SubCategory = \"00 | Honeybee\"\n#compatibleHBVersion = VER 0.0.57\\nNOV_04_2016\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"3\"\nexcept: pass\n\ndef main(HBObject, childSurfaces, childSurfacesName, EPConstructions, RADMaterials, tolerance):\n\n    def addPotentialChildSurface(HBSurface):\n        \n        glzCount = 0\n        for srfCount, srf in enumerate(childSurfaces):\n            # check if the surface is located on the base surface\n            if HBSurface.isPossibleChild(srf, tolerance):\n                # if yes then create the child surface\n                guid = str(uuid.uuid4())\n                try:\n                    name = childSurfacesName[srfCount]\n                except:\n                   name = HBSurface.name + \"_glz_\" + str(glzCount) + \"_\" + \"\".join(guid.split(\"-\")[:-1])\n\n                number = guid.split(\"-\")[-1]\n                glzCount += 1\n                HBFenSrf = hb_EPFenSurface(srf, number, name, HBSurface, 5)\n                \n                # check normal direction\n                if not rc.Geometry.Vector3d.VectorAngle(HBFenSrf.normalVector, HBFenSrf.parent.normalVector)<sc.doc.ModelAngleToleranceRadians:\n                    HBFenSrf.geometry.Flip()\n                    HBFenSrf.normalVector.Reverse()\n                \n                if len(EPConstructions)!=0:\n                    \n                    try:\n                        EPConstruction = EPConstructions[srfCount]\n                    except:\n                        EPConstruction = EPConstructions[0]\n                    \n                    if EPConstruction == None: continue\n                        \n                    # if it is just the name of the material make sure it is already defined\n                    if len(EPConstruction.split(\"\\n\")) == 1:\n                        # if the material is not in the library add it to the library\n                        if not hb_EPObjectsAux.isEPConstruction(EPConstruction):\n                            warningMsg = \"Can't find \" + EPConstruction + \" in EP Construction Library.\\n\" + \\\n                                        \"Add the construction to the library and try again.\"\n                            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                            return \n                    else:\n                        # it is a full string.\n                        if EPConstruction.startswith('WindowMaterial:'):\n                            warningMsg = \"Your window construction, \" + EPConstruction.split('\\n')[1].split(',')[0] + \", is a window material and not a full window construction.\\n\" + \\\n                                        \"Pass this window material through a 'Honeybee_EnergyPlus Construction' component cand connect the construction to this one.\"\n                            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                            return \n                        added, EPConstruction = hb_EPObjectsAux.addEPObjectToLib(EPConstruction, overwrite = True)\n                        \n                        if not added:\n                            msg = EPConstruction + \" is not added to the project library!\"\n                            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                            print msg\n                            return \n                    \n                    try:\n                        HBFenSrf.setEPConstruction(EPConstruction)\n                    except:\n                        warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                        print warningMsg\n                        ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                        return -1\n                    \n                \n                \n                if len(RADMaterials)!= 0:\n                    \n                    try:\n                        RADMaterial = RADMaterials[srfCount]\n                    except:\n                        RADMaterial = RADMaterials[0]\n                    \n                    if RADMaterial == None: continue\n                    \n                    if len(RADMaterial.strip().split(\" \")) == 1:\n                        if not hb_RADMaterialAUX.isMatrialExistInLibrary(RADMaterial):\n                            warningMsg = \"Can't find \" + RADMaterial + \" in RAD Material Library.\\n\" + \\\n                                \"Add the material to the library and try again.\"\n                            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                            return\n                    \n                    addedToLib, HBFenSrf.RadMaterial = hb_RADMaterialAUX.analyseRadMaterials(RADMaterial, True)\n                    materialType = hb_RADMaterialAUX.getRADMaterialType(HBFenSrf.RadMaterial)\n                    if materialType == 'plastic':\n                        warningMsg = HBFenSrf.RadMaterial + \" is not a typical glass material. Are you sure you selected the right material?\"\n                        ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                        return\n    \n                # add it to the base surface \n                # Change BC 'Ground' and 'Adiabatic', to 'Outdoors'\n                if(HBSurface.BC.ToUpper()!= \"SURFACE\" and HBSurface.BC.ToUpper()!= \"OUTDOORS\"):\n                    warningMsg =  \"Windows cannot be attached on adiabatic surfaces, %s's boundary condition has been changed from %s to Outdoors.\" % (HBSurface.name, HBSurface.BC)\n                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                    HBSurface.BC= \"Outdoors\"\n                    HBSurface.sunExposure = \"SunExposed\"\n                    HBSurface.windExposure = \"WindExposed\"\n                HBSurface.addChildSrf(HBFenSrf)\n                HBSurface.calculatePunchedSurface()\n\n\n    # import the classes\n    if sc.sticky.has_key('honeybee_release'):\n        try:\n            if not sc.sticky['honeybee_release'].isCompatible(ghenv.Component): return -1\n            if sc.sticky['honeybee_release'].isInputMissing(ghenv.Component): return -1\n        except:\n            warning = \"You need a newer version of Honeybee to use this compoent.\" + \\\n            \"Use updateHoneybee component to update userObjects.\\n\" + \\\n            \"If you have already updated userObjects drag Honeybee_Honeybee component \" + \\\n            \"into canvas and try again.\"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, warning)\n            return -1\n            \n        # don't customize this part\n        hb_EPZone = sc.sticky[\"honeybee_EPZone\"]\n        hb_EPSrf = sc.sticky[\"honeybee_EPSurface\"]\n        hb_EPZoneSurface = sc.sticky[\"honeybee_EPZoneSurface\"]\n        hb_EPFenSurface = sc.sticky[\"honeybee_EPFenSurface\"]\n        hb_EPObjectsAux = sc.sticky[\"honeybee_EPObjectsAUX\"]()\n        hb_RADMaterialAUX = sc.sticky[\"honeybee_RADMaterialAUX\"]\n        \n        # if any of child surfaces is mesh, convert them to a surface\n        cleanChildSurfaces = []\n        for srf in childSurfaces:\n            try:\n                # check if this is a mesh\n                srf.Faces[0].IsQuad\n                # convert to brep\n                srf = rc.Geometry.Brep.CreateFromMesh(srf, False)\n            except:\n                pass\n            \n            # collect surfaces\n            cleanChildSurfaces.append(srf)\n        \n        # check number of faces and names\n        if len(childSurfacesName)!= 0:\n            if len(childSurfacesName)!=len(childSurfaces):\n                nameCount = len(childSurfacesName)\n                srfCount = len(childSurfaces)\n                raise Exception(\"Length of _childSurfaces [%s] should match length of childSurfacesName [%s]\"%(srfCount, nameCount))\n        \n        # call the surface from the hive\n        hb_hive = sc.sticky[\"honeybee_Hive\"]()\n        try:\n            HBObject = hb_hive.callFromHoneybeeHive([HBObject])[0]\n        except:\n            raise TypeError(\"Wrong input type for _HBObj. Connect a Honeybee Surface or a HoneybeeZone to HBObject input\")\n\n        # check if the object is a zone or a surface\n        if HBObject.objectType == \"HBZone\":\n            # add window for each surface\n            for HBSurface in HBObject.surfaces:\n                addPotentialChildSurface(HBSurface)\n        else:\n            # add window to the HBSurface\n            addPotentialChildSurface(HBObject)\n        \n        # add to the hive\n        HBObject  = hb_hive.addToHoneybeeHive([HBObject], ghenv.Component)\n        \n        return HBObject\n        \n    else:\n        print \"You should first let Honeybee fly...\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"You should first let Honeybee fly...\")\n        return -1\n\nif _HBObj!=None and len(_childSurfaces) and _childSurfaces[0]!=None:\n    \n    # if tolerance_==None:\n    tolerance_ = sc.doc.ModelAbsoluteTolerance\n        \n    results = main(_HBObj, _childSurfaces, childSurfacesName_, EPConstructions_, RADMaterials_, tolerance_)\n    \n    if results != -1:\n        HBObjWGLZ = results",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}