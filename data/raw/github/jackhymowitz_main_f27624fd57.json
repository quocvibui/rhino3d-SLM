{
  "source_url": "https://github.com/jackhymowitz/main/blob/7325131db23094f1a28bd184b6a68f864f41a729/01_GH_Components/py/BT_2PDF_TFAPlans.py",
  "repo": "jackhymowitz/main",
  "repo_stars": 0,
  "repo_description": "IDF2PH is a free open source toolkit for working with E+ and PHPP Energy Models",
  "license": "GPL-3.0",
  "filepath": "01_GH_Components/py/BT_2PDF_TFAPlans.py",
  "instruction": "Takes in a list of Honeybee zones and outputs print-ready (floor plan) objects for the Treated Floor Area (TFA). Will pull out any 'PHPP Room' information from the zones and create surfaces, color...",
  "code": "#\r\r\n# IDF2PHPP: A Plugin for exporting an EnergyPlus IDF file to the Passive House Planning Package (PHPP). Created by blgdtyp, llc\r\r\n# \r\r\n# This component is part of IDF2PHPP.\r\r\n# \r\r\n# Copyright (c) 2020, bldgtyp, llc <info@bldgtyp.com> \r\r\n# IDF2PHPP is free software; you can redistribute it and/or modify \r\r\n# it under the terms of the GNU General Public License as published \r\r\n# by the Free Software Foundation; either version 3 of the License, \r\r\n# or (at your option) any later version. \r\r\n# \r\r\n# IDF2PHPP is distributed in the hope that it will be useful,\r\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\r\n# GNU General Public License for more details.\r\r\n# \r\r\n# For a copy of the GNU General Public License\r\r\n# see <http://www.gnu.org/licenses/>.\r\r\n# \r\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\r\n#\r\r\n\"\"\"\r\r\nTakes in a list of Honeybee zones and outputs print-ready (floor plan) objects for the Treated Floor Area (TFA). Will pull out any 'PHPP Room' information from the zones and create surfaces, color them by TFA factor, and create room-tags based on the data. Be sure you've used the 'Create PHPP Rooms' to assign parameters to the zones and geometry correctly before trying to use this.\r\r\n-\r\r\nEM June 22, 2020\r\r\n    Args:\r\r\n        _HBZones: A list of the Honeybee zone objects which are being analyzed in the model.\r\r\n        colors_: <not used yet>\r\r\n    Returns:\r\r\n        filenames_: A list of autogenerated Filenames for use if you want.\r\r\n        geom_: A Tree of the TFA surfaces as Meshes, colored by TFA Factor. Each branch of the tree will become a separate page in the final PDF. Connect to the '_geomToBake' input on the '2PDF | Print' component\r\r\n        annotationTxt_: A Tree of Room Data tags for printing. Connect to the '_notesToBake' input on the '2PDF | Print' component\r\r\n        annotationCP_: A Tree of Room center points (X,Y,Z). Useful for locating Room Tag information. Connect to the '_noteLocations' input on the '2PDF | Print' component\r\r\n        tableHeaders_: A list of the Headers for the Data Table\r\r\n        tableData_: A Tree of all the data for the Data Table. Each Branch corresponds to one row in the table (one room)\r\r\n\"\"\"\r\r\nghenv.Component.Name = \"BT_2PDF_TFAPlans\"\r\r\nghenv.Component.NickName = \"2PDF | TFA Plans\"\r\r\nghenv.Component.Message = 'JUN_22_2020'\r\r\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\r\r\nghenv.Component.Category = \"BT\"\r\r\nghenv.Component.SubCategory = \"03 | PDF\"\r\r\n\r\r\nimport rhinoscriptsyntax as rs\r\r\nimport scriptcontext as sc\r\r\nimport Grasshopper.Kernel as ghK\r\r\nfrom System import Object\r\r\nfrom Grasshopper import DataTree\r\r\nfrom Grasshopper.Kernel.Data import GH_Path\r\r\nimport ghpythonlib.components as ghc\r\r\n\r\r\ndef roomCenterPt(_srfcs):\r\r\n    srfcCenters = []\r\r\n    for eachSrfc in _srfcs:\r\r\n        srfcCenters.append(ghc.Area(eachSrfc).centroid)\r\r\n    roomCenter = ghc.Average(srfcCenters)\r\r\n    \r\r\n    return roomCenter\r\r\n\r\r\ndef colorMeshFromRoom(_room):\r\r\n    \"\"\"Returns a mesh, colored by some logic\r\r\n    \r\r\n    Takes in a room, converts it to \r\r\n    a mesh and colors it depending on the srfcs TFA\r\r\n    \"\"\"\r\r\n    \r\r\n    room_srfcs_colored = []\r\r\n    for srfcCount, srfc in enumerate(_room.TFAsurface):\r\r\n        srfc_tfaFactor = _room.TFAfactors[srfcCount]\r\r\n        \r\r\n        if srfc_tfaFactor > 0.6:\r\r\n            color = ghc.ColourRGB(255,255,255,17)\r\r\n        elif srfc_tfaFactor <= 0.6 and srfc_tfaFactor > 0.5:\r\r\n            color = ghc.ColourRGB(255,189,103,107)\r\r\n            #color = ghc.ColourRGB(255,189,103,107)\r\r\n        elif srfc_tfaFactor <= 0.5 and srfc_tfaFactor > 0.3:\r\r\n            color = ghc.ColourRGB(255,154,205,50)\r\r\n        elif srfc_tfaFactor <= 0.5 and srfc_tfaFactor > 0.3:\r\r\n            color = ghc.ColourRGB(255,0,255,127)\r\r\n        elif srfc_tfaFactor == 0:\r\r\n            color = ghc.ColourRGB(255,238,130,238)\r\r\n        else:\r\r\n            color = ghc.ColourRGB(255,238,130,238)\r\r\n        \r\r\n        room_srfcs_colored.append( ghc.MeshColours(srfc, color) )\r\r\n    \r\r\n    return room_srfcs_colored\r\r\n\r\r\nhb_hive = sc.sticky[\"honeybee_Hive\"]()\r\r\nHBZoneObjects = hb_hive.callFromHoneybeeHive(_HBZones)\r\r\n\r\r\nfilenames_ = []\r\r\ngeom_ = DataTree[Object]()\r\r\nannotationCP_ = DataTree[Object]()\r\r\nannotationTxt_ = DataTree[Object]()\r\r\ntableHeaders_ = DataTree[Object]()\r\r\ntableData_ = DataTree[Object]()\r\r\n\r\r\nif HBZoneObjects:\r\r\n    # Sort the zones by name. Grr.....\r\r\n    HBZoneObjects_sorted = sorted(HBZoneObjects, key=lambda zone: zone.name)\r\r\n    \r\r\n    for zoneBranchNum, zone in enumerate(HBZoneObjects):\r\r\n        filenames_.append('TFA FLOOR PLANS {}'.format(zoneBranchNum+1))\r\r\n        \r\r\n        for roomBranchNum, room in enumerate(zone.PHPProoms):\r\r\n            # For each room, look at each surface in the room, convert it to\r\r\n            # a mesh, and re-color it based on the type of ventilation airflow\r\r\n            # (supply, extract, transfer). When done, add the new mesh to\r\r\n            # and output tree 'geom_' for passing\r\r\n            \r\r\n            \r\r\n            \r\r\n            geom_.AddRange(colorMeshFromRoom(room), GH_Path(zoneBranchNum))\r\r\n            \r\r\n            \r\r\n            # For each room, pull out the relevant data for a tag that will go\r\r\n            # right ontop of surface in the final PDF. Also get the\r\r\n            # Center Point for each annotation tag\r\r\n            \r\r\n            annotationTxt = \"{}-{}\\nTFA: {:.01f}m2\".format(room.RoomNumber, room.RoomName, room.FloorArea_TFA)\r\r\n            annotationTxt_.Add(annotationTxt, GH_Path(zoneBranchNum))\r\r\n            annotationCP_.Add(roomCenterPt(room.TFAsurface), GH_Path(zoneBranchNum))\r\r\n            \r\r\n            \r\r\n            # Get the Room's parameters and add to the Table\r\r\n            roomData = [[room.HostZoneName,'ZONE'],\r\r\n                            [room.RoomNumber, 'NUMBER'],\r\r\n                            [room.RoomName, 'NAME'],\r\r\n                            [room.FloorArea_Gross,'AREA (m2)'],\r\r\n                            [room.RoomTFAfactor,'TFA FACTOR'],\r\r\n                            [room.FloorArea_TFA,'TFA (m2)'],\r\r\n                            [room.RoomNetClearVolume,'Vn50 (m3)'],\r\r\n                            [room.RoomVentedVolume,'Vv (m3)'],\r\r\n                            [room.RoomClearHeight,'CLG HEIGHT (m)']\r\r\n                            ]\r\r\n            if tableHeaders_.BranchCount == 0:\r\r\n                tableHeaders_.AddRange([v[1] for i, v in enumerate(roomData)], GH_Path(0))\r\r\n            tableData_.AddRange([v[0] for i, v in enumerate(roomData)], GH_Path(tableData_.BranchCount+1))\r\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}