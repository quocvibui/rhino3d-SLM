{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/plugin_files/Bake_with_Attributes.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "plugin_files/Bake_with_Attributes.py",
  "instruction": "Bake with attributes",
  "code": "ï»¿from ghpythonlib.componentbase import dotnetcompiledcomponent as component\nimport Grasshopper, GhPython\nimport System, Rhino, os\nimport rhinoscriptsyntax as rs\nimport ghpythonlib.treehelpers as th\nimport ghpythonlib.components as ghcomp\nimport scriptcontext as sc\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\nrcdoc = Rhino.RhinoDoc.ActiveDoc\nghdoc = sc.doc\n\n\nclass MyComponent(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\n            \"Bake with Attributes\", \"BakeWithAttributes\", \"\"\"Bakes geometry with attributes into Rhino.\nThe geometry is baked by branch into specific layers.\nGeometry objects can have colors, widths, and materials as attributes.\nYou can group the baked objects and delete all the previous instances of the objects.\n    Typical usage example:\nInput geometry an separate (graph) them into branches of a data tree.\nProvide a list of layer names to each branch that will be baked. Input all the desired attributes.\nUse a 'make Material' LocalCode component to make and assign a material to each layer.\nToggle the 'Bake' boolean to activate the component.\"\"\", \"Extra\", \"LocalCode\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"19ed4779-7e63-46a2-9560-1ccf4600e90c\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"geometry\", \"geometry\", \"Geometry as a tree of objects\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.tree\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"layers\", \"layers\", \"Layer names as a list of strings\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"colors\", \"colors\", \"Color swatches as a list\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"widths\", \"widths\", \"List of floats\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"materials\", \"materials\", \"List of LocalCode Materials\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"delete\", \"delete\", \"Boolean to delete 'EVERY' previous instance of the geometry\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"group\", \"group\", \"Boolean to group all objects\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"Bake\", \"Bake\", \"Boolean that bakes the geometry with attributes into Rhino\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    \n    def RegisterOutputParams(self, pManager):\n        pass    \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        p1 = self.marshal.GetInput(DA, 1)\n        p2 = self.marshal.GetInput(DA, 2)\n        p3 = self.marshal.GetInput(DA, 3)\n        p4 = self.marshal.GetInput(DA, 4)\n        p5 = self.marshal.GetInput(DA, 5)\n        p6 = self.marshal.GetInput(DA, 6)\n        p7 = self.marshal.GetInput(DA, 7)\n        result = self.RunScript(p0, p1, p2, p3, p4, p5, p6, p7)\n\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAASESURBVEhLzVR9TNR1GCfwjoMD7o6Dg3jzkBfxeI9LuOOOu4MDTOaqRa1mZkRqaqzRpmFNbVNrmraMXtBFpdVyTaOmRW7oyLks1ppazA1IaJm8OYo8eRP49Dzf71Emx3pZf/TZPvv9fs/3eT7P8/s+z/fr939GNLFGrw9qVIcqX6P3lcRwXvgvUFWxxDDYfCwXvT2F+KHDig/ez8KSUkMvrT0qXf49tm3fmgKgmOgCJoqA6w75Trbnnk0G+WySrv8cO+r3pJFQCTBql+JTJD5Kz1/pm59wo2ZNAiexy5C/ByVxx0u7Fkrx6yzkwkC3FV3n8zHxs/zGVZnUM1iEhLjgUzLUN7KIGzQaZUNCgvpIiUvfeeidTBKhbSHxq1eKUPVQHGgdAQH+SE0OwYE30v9IQkU8WTOf/2KRULsJzz+2KmHqdKsZlzqtGL5so6qcMviaHdMTLlSUGzh4Fpuo0bIXThz/OIdta4g34pYXDuznStzCSWzFOJGERWXTTnzRkjdLeIbmXC2mxylu2oGedgtUKsUrZP8d7rraRCnu8QreTKrurQaTT3FmZIQKowPkRwmGf7IhPi74MNklEo3qM6ND3op9iTPpr1qbc32KM7PSwzA1Rn9AjR4ZtCM1JeQo2QUyNtYaSYAmhMfNlzhzxI7JUSfslnCfCQ6K7aUejNEg9NqQaAxuIrvAupZjOaJCn8KclNcoEBMODPxow7KKKJqgACEcZVDhxZ08wiTO20u96+2yIixM2SjUAwMVey9+VyAPja8EYw4ceS8LwocPE5/cKRc6zuaj7XMzhi7RpM2Isz8Vw3aSrhMJtFplY9/3FlGdqJanRowbXwdUOb1nmHRobsql91KZhMXEOk8c+d64tWSv372QExSLBEql4uXumT8g8UmPA1vqFtDlFYETn7CoG+VuA2wWPVaviqeTKgs4/G4mlpZF4LOPsinWu73exOUlEf0krRYJCOtb6GacqfbN100wpYXhibXzkZIcCky64bTrkZejQTrZNz+VKPqg1ajwwH0x0OmCcIW3iXtEZ6W9bTH3Z69XW8DER1tMEY3phbMF2FCbhPsro2FMUFOgC86iCHxzOo/2Ng9lxZFiYvhEA2VkN+NaPyXgC5A0Ku+KHidNo5T2IubWoJO/9EqHXduTkb6I/mCdEWmpYSKBqygS335lRlsrJSiJxNsN6Vi2NIr8y/Hph9no5x5SLF8XJLdZqv4Z5qoHY8npDqytjoU1PxzVdKH5+/tjyuOka0AHy2IdcjI12LppAS53F0KnVWF1dTzUwYHwDDlw4ZyFT/NJ0vKXkrPx+LYtSRjud2DF8mg8siIWz2xMhKfPhn31abjnTgNWLo/BCJ946tXB/SaUFofjzKnbce5rC29nG2lopdTceLjy7uihjnYriZR5yc3nkaQeCfI3k9fc2PeqCSHB8w5RbKiU+GvE881aXhbZs3NHKk7Q/dN5vgB9F62CHfR+/Ggunq5LQnaG5kvyv1eGzYLV+5wTQcRC4nqFQrFHr1c1MgMUAbvJxnf9bcS5MM/Pz6/rN3O1kPdwDpc/AAAAAElFTkSuQmCC\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    \n    def RunScript(self, geometry, layers, colors, widths, materials, delete, group, Bake):\n        #Call rhino document \n        rcdoc = Rhino.RhinoDoc.ActiveDoc\n        #Make a list of the geometry branches\n        geometryList = [geometry.Branch(b) for b in range(geometry.BranchCount)]\n        #Check if the number of layers is the same as the branches\n        if geometry == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add geometry in branches.\")\n        if Bake == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add a boolean toggle in the Bake input.\")\n        if len(layers) != geometry.BranchCount:\n            self.AddRuntimeMessage(RML.Warning, \"Add the same number of geometry branches and layers.\")\n            \n        if Bake:\n            \n            if delete:\n               for i in range(len(layers)):\n                sc.doc = rcdoc\n                if rs.IsLayer(layers[i]):\n                    allObjs_l = rs.ObjectsByLayer(layers[i])\n                    rs.DeleteObjects(allObjs_l)\n                sc.doc = ghdoc\n                    \n            num = len(geometryList)\n            for i in range(num):\n                currentLayer = layers[i]\n                if colors != [] and len(colors) == num:\n                    currentColor = colors[i]\n                else:\n                    currentColor = [0,0,0] \n                if materials != [] and len(materials) == num:\n                    currentMaterial  = materials[i]\n                else: \n                    currentMaterial = None\n                if widths != [] and len(widths) == num:\n                    currentWidth = widths[i]\n                else: currentWidth = 1.0\n                                \n                for id in geometryList[i]:\n                    sc.doc = ghdoc\n                    gh_to_rhino = rs.coercerhinoobject(id)                \n                    attributes = gh_to_rhino.Attributes\n                    geometryObj = gh_to_rhino.Geometry\n                    sc.doc = Rhino.RhinoDoc.ActiveDoc #we change the scriptcontext           \n                    rhino_brep = sc.doc.Objects.Add(geometryObj, attributes)#we add both the geometry and the attributes to the Rhino doc\n                    if(group):\n                        name = rs.AddGroup('bake_group')\n                        rs.AddObjectToGroup(rhino_brep, 'bake_group')\n                \n                    if not rs.IsLayer(currentLayer) and currentColor != None:\n                            rs.AddLayer(name=currentLayer)\n                            \n                    prevColor = rs.LayerColor(layer=currentLayer)\n                    if prevColor != currentColor: \n                        rs.LayerColor(currentLayer, color = currentColor)           \n                \n                    index = rs.LayerOrder(currentLayer)\n                    if currentMaterial != None:\n                        #print(currentMaterial.Name) \n                        sc.doc.RenderMaterials.Add(currentMaterial)                    \n                        sc.doc.Layers[index].RenderMaterial = currentMaterial\n                                        \n                    rs.LayerPrintWidth(currentLayer, float(currentWidth))     \n                    rs.ObjectLayer(rhino_brep, currentLayer) # add objects to rhino layer                    \n        sc.doc = ghdoc #we put back the original Grasshopper document as default\n                \n                                    \n                \n                \n        \n        # return outputs if you have them; here I try it for you:\n        return \n\n\nimport GhPython\nimport System\n\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\n    def get_AssemblyName(self):\n        return \"Bake with Attributes\"\n    \n    def get_AssemblyDescription(self):\n        return \"\"\"\"\"\"\n\n    def get_AssemblyVersion(self):\n        return \"0.1\"\n\n    def get_AuthorName(self):\n        return \"\"\n    \n    def get_Id(self):\n        return System.Guid(\"3ac6d17f-7e16-4c11-ad4c-4b82e1f6e54b\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}