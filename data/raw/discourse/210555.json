{
  "source_url": "https://discourse.mcneel.com/t/i-asked-chatgpt-to-do-a-pdf-merger-for-rhino/210555",
  "topic_id": 210555,
  "title": "I asked ChatGPT to do a PDF merger for Rhino",
  "question": "It did it in less than a minute!\n\nNow each time I have to place several images in one PDF or merge multiple PDFs I can simply call the script with an alias:\n\nAlias PDFmerge -RunPythonScript (C:\\RhinoPythonScripts\\RhinoPDFmerge.py)\n\nThis is a good example of automating boring stuff.\n\n\n#! python 3\n# requirements: pypdf\n# requirements: pillow\n#!/usr/bin/env python3\n# Combine PDFs and images into a single PDF (Rhino-safe, no CLI args)\n# Requires: pypdf, Pillow (PIL). \n\nimport os, io\nimport rhinoscriptsyntax as rs\n\n# --- third-party libs ---\nfrom pypdf import PdfReader, PdfWriter\nfrom PIL import Image, ImageSequence\n\nIMAGE_EXTS = {\".jpg\", \".jpeg\", \".png\", \".bmp\", \".tif\", \".tiff\", \".webp\"}\nPDF_EXT = \".pdf\"\n\ndef is_image(path):\n    return os.path.splitext(path.lower())[1] in IMAGE_EXTS\n\ndef is_pdf(path):\n    return path.lower().endswith(PDF_EXT)\n\ndef image_frames_to_pdf_bytes(img_path):\n    \"\"\"Return list of single-page PDF bytes (handles multi-page TIFFs).\"\"\"\n    pages = []\n    with Image.open(img_path) as im:\n        try:\n            frames = [frame.copy() for frame in ImageSequence.Iterator(im)]\n            if not frames:\n                frames = [im.copy()]\n        except Exception:\n            frames = [im.copy()]\n\n        for frame in frames:\n            # Flatten transparency, ensure RGB/L\n            if frame.mode in (\"RGBA\", \"LA\"):\n                bg = Image.new(\"RGB\", frame.size, (255, 255, 255))\n                bg.paste(frame, mask=frame.split()[-1])\n                frame = bg\n            elif frame.mode not in (\"RGB\", \"L\"):\n                frame = frame.convert(\"RGB\")\n\n            bio = io.BytesIO()\n            # Pillow embeds as a one-page PDF (size from pixels; set resolution for better print metadata)\n            frame.save(bio, format=\"PDF\", resolution=300)\n            pages.append(bio.getvalue())\n    return pages\n\ndef append_pdf_bytes(writer, pdf_bytes):\n    reader = PdfReader(io.BytesIO(pdf_bytes))\n    for page in reader.pages:\n        writer.add_page(pag...",
  "code_blocks": [
    {
      "code": "#! python 3\n# requirements: pypdf\n# requirements: pillow\n#!/usr/bin/env python3\n# Combine PDFs and images into a single PDF (Rhino-safe, no CLI args)\n# Requires: pypdf, Pillow (PIL). \n\nimport os, io\nimport rhinoscriptsyntax as rs\n\n# --- third-party libs ---\nfrom pypdf import PdfReader, PdfWriter\nfrom PIL import Image, ImageSequence\n\nIMAGE_EXTS = {\".jpg\", \".jpeg\", \".png\", \".bmp\", \".tif\", \".tiff\", \".webp\"}\nPDF_EXT = \".pdf\"\n\ndef is_image(path):\n    return os.path.splitext(path.lower())[1] in IMAGE_EXTS\n\ndef is_pdf(path):\n    return path.lower().endswith(PDF_EXT)\n\ndef image_frames_to_pdf_bytes(img_path):\n    \"\"\"Return list of single-page PDF bytes (handles multi-page TIFFs).\"\"\"\n    pages = []\n    with Image.open(img_path) as im:\n        try:\n            frames = [frame.copy() for frame in ImageSequence.Iterator(im)]\n            if not frames:\n                frames = [im.copy()]\n        except Exception:\n            frames = [im.copy()]\n\n        for frame in frames:\n            # Flatten transparency, ensure RGB/L\n            if frame.mode in (\"RGBA\", \"LA\"):\n                bg = Image.new(\"RGB\", frame.size, (255, 255, 255))\n                bg.paste(frame, mask=frame.split()[-1])\n                frame = bg\n            elif frame.mode not in (\"RGB\", \"L\"):\n                frame = frame.convert(\"RGB\")\n\n            bio = io.BytesIO()\n            # Pillow embeds as a one-page PDF (size from pixels; set resolution for better print metadata)\n            frame.save(bio, format=\"PDF\", resolution=300)\n            pages.append(bio.getvalue())\n    return pages\n\ndef append_pdf_bytes(writer, pdf_bytes):\n    reader = PdfReader(io.BytesIO(pdf_bytes))\n    for page in reader.pages:\n        writer.add_page(page)\n\ndef combine_files_to_pdf(files, output_pdf):\n    if not files:\n        rs.MessageBox(\"No files selected.\", 48, \"Combine to PDF\")\n        return False\n\n    writer = PdfWriter()\n    added = 0\n\n    for path in files:\n        ext = os.path.splitext(path)[1].lower()\n        if is_pdf(path):\n            try:\n                reader = PdfReader(path)\n                for page in reader.pages:\n                    writer.add_page(page)\n                added += len(reader.pages)\n            except Exception as e:\n                print(\"Skipped (PDF read error):\", path, \"-\", e)\n        elif is_image(path):\n            try:\n                for pdf_bytes in image_frames_to_pdf_bytes(path):\n                    append_pdf_bytes(writer, pdf_bytes)\n                    added += 1\n            except Exception as e:\n                print(\"Skipped (image error):\", path, \"-\", e)\n        else:\n            print(\"Skipped (unsupported type):\", path)\n\n    if added == 0:\n        rs.MessageBox(\"Nothing was added. Check file types.\", 48, \"Combine to PDF\")\n        return False\n\n    # Write output\n    with open(output_pdf, \"wb\") as f:\n        writer.write(f)\n\n    print(\"Done. Wrote:\", output_pdf, \"| pages:\", added)\n    rs.MessageBox(\"Created:\\n{}\".format(output_pdf), 64, \"Combine to PDF\")\n    return True\n\ndef pick_files():\n    # Multi-select files (PDFs + common image types)\n    flt = \"PDF and images (*.pdf;*.jpg;*.jpeg;*.png;*.bmp;*.tif;*.tiff;*.webp)|*.pdf;*.jpg;*.jpeg;*.png;*.bmp;*.tif;*.tiff;*.webp|All files (*.*)|*.*||\"\n    files = rs.OpenFileNames(\"Select PDFs and/or images (order is kept as selected folder view)\", filter=flt)\n    if not files: \n        return []\n    # Optional: natural-sort by name; or keep dialog order. Here we keep dialog order.\n    return list(files)\n\ndef pick_output(default_name=\"combined.pdf\"):\n    return rs.SaveFileName(\"Save combined PDF as\", filter=\"PDF (*.pdf)|*.pdf||\", filename=default_name)\n\n# --- MAIN ---\nif __name__ == \"__main__\":\n    # Option A: set FILES manually and skip the picker\n    FILES = []  # e.g. [\"C:\\\\temp\\\\scan1.jpg\", \"C:\\\\temp\\\\doc.pdf\"]\n\n    if not FILES:\n        FILES = pick_files()\n        if not FILES:\n            raise SystemExit\n\n    out = pick_output()\n    if not out:\n        raise SystemExit\n    if not out.lower().endswith(\".pdf\"):\n        out += \".pdf\"\n\n    # Confirm overwrite (Rhino doesn't warn by default)\n    if os.path.exists(out):\n        if rs.MessageBox(\"File exists. Overwrite?\\n{}\".format(out), 33, \"Confirm overwrite\") != 1:\n            raise SystemExit\n\n    combine_files_to_pdf(FILES, out)",
      "language": "python",
      "author": "Bogdan_Chipara",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinoscriptsyntax",
    "ui"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 1,
  "views": 96
}