{
  "source_url": "https://github.com/JWerbrouck/scan-to-graph/blob/bfab0a055404191929e6e3c19ab3c89638d81d0d/Scan-to-Graph_Plugin_Rhino6/Scan-to-Graph_Plugin.py",
  "repo": "JWerbrouck/scan-to-graph",
  "repo_stars": 4,
  "repo_description": "Repository containing the files created for a Thesis in Engineering: Architecture at Ghent University ",
  "license": "unknown",
  "filepath": "Scan-to-Graph_Plugin_Rhino6/Scan-to-Graph_Plugin.py",
  "instruction": "Scan to graph plugin",
  "code": "import System\r\nimport Rhino\r\nimport Rhino.UI\r\nimport Eto.Drawing as drawing\r\nimport Eto.Forms as forms\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\nimport csv\r\nimport subprocess\r\nimport ast\r\nimport os\r\nimport webbrowser\r\nfrom os import listdir,mkdir\r\nfrom os.path import isdir\r\nimport fnmatch\r\nimport shutil\r\nimport time\r\nfrom time import strftime, gmtime, sleep\r\n\r\nglobal pythonversion\r\npythonversion = str(\"C:/Python27/python.exe\")\r\n\r\nglobal cloudcompare_path\r\ncloudcompare_path = str(r\"C:\\Program Files\\CloudCompareStereo\\CloudCompare.exe\")\r\n\r\nglobal ProjectFolder\r\nProjectFolder = os.path.dirname(os.path.realpath(__file__)).encode('string-escape')\r\n\r\n#main class for the project info tab\r\nclass Project_Info(forms.Panel):\r\n    #main layout\r\n    def __init__(self):\r\n        self.MainInfo = self.MainInfo()\r\n        self.Topology = self.Topology()\r\n        \r\n        self.Topology.Visible = True\r\n        \r\n        \r\n        self.iTabLayout = forms.DynamicLayout()\r\n        self.iTabLayout.Padding = drawing.Padding(10)\r\n        self.iTabLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        self.iTabLayout.AddRow(self.MainInfo)\r\n        self.iTabLayout.AddRow(self.Topology)\r\n        self.iTabLayout.AddRow(\"\")\r\n        \r\n        self.Content = self.iTabLayout\r\n    \r\n    #layout for defining the storeys and spaces\r\n    def Topology(self):\r\n        self.TopoGroupBox = forms.GroupBox(Text = \"Project Topology\")\r\n        self.TopoGroupBox.Padding = drawing.Padding(10)\r\n        self.TopoLayout = forms.DynamicLayout()\r\n        self.TopoLayout.Padding = drawing.Padding(10)\r\n        self.TopoLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        self.StoreyLayout = forms.DynamicLayout()\r\n        self.StoreyLayout.Padding = drawing.Padding(10)\r\n        self.StoreyLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        self.SpaceLayout = forms.DynamicLayout()\r\n        self.SpaceLayout.Padding = drawing.Padding(10)\r\n        self.SpaceLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        self.StoreyLabel = forms.Label(Text = \"Storeys: \")\r\n        Project_Info.Storeys = []\r\n        Project_Info.StoreyBox = forms.ListBox(DataStore = Project_Info.Storeys)\r\n        self.AddStorey = forms.Button(Text = \"Add Storey\")\r\n        self.RemoveStorey = forms.Button(Text = \"Remove Storey\", Enabled = False)\r\n        Project_Info.TopoDict = {}\r\n        \r\n        self.AddStorey.Click += self.AddNewStorey\r\n        self.RemoveStorey.Click += self.RemoveExistingStorey\r\n        \r\n        self.SpaceLabel = forms.Label(Text = \"Spaces: \")\r\n        Project_Info.Spaces = []\r\n        Project_Info.SpaceBox = forms.ListBox(DataStore = Project_Info.Spaces)\r\n        Project_Info.StoreyBox.SelectedIndexChanged += self.ChangeSpaceDisplay\r\n        self.AddSpace = forms.Button(Text = \"Add Space\",Enabled = False)\r\n        self.RemoveSpace = forms.Button(Text = \"Remove Space\", Enabled = False)\r\n        \r\n        self.AddSpace.Click += self.AddNewSpace\r\n        self.RemoveSpace.Click += self.RemoveExistingSpace\r\n        \r\n        self.StoreyLayout.BeginVertical()\r\n        self.StoreyLayout.AddRow(self.StoreyLabel)\r\n        self.StoreyLayout.AddRow(Project_Info.StoreyBox)\r\n        self.StoreyLayout.EndVertical()\r\n        self.StoreyLayout.BeginVertical()\r\n        self.StoreyLayout.AddRow(self.AddStorey,\" \", self.RemoveStorey)\r\n        \r\n        self.SpaceLayout.BeginVertical()\r\n        self.SpaceLayout.AddRow(self.SpaceLabel)\r\n        self.SpaceLayout.AddRow(Project_Info.SpaceBox)\r\n        self.SpaceLayout.EndVertical()\r\n        self.SpaceLayout.BeginVertical()\r\n        self.SpaceLayout.AddRow(self.AddSpace,\" \",self.RemoveSpace)\r\n        \r\n        self.TopoLayout.AddRow(self.StoreyLayout,self.SpaceLayout)\r\n        self.TopoGroupBox.Content = self.TopoLayout\r\n        \r\n        return self.TopoGroupBox\r\n    \r\n    #this button allows to create a new space contained in the currently selected storey\r\n    def AddNewSpace(self,sender,e):\r\n        if len(Project_Info.Storeys)>0:\r\n            storey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n            rc, text  = Rhino.UI.Dialogs.ShowEditBox(\"Space Name\", \"Enter the name of the space\",None, 0)\r\n            if rc != True: return None\r\n            else:\r\n                if len(text)>0:\r\n                    Project_Info.TopoDict[storey].append(text)\r\n                    Project_Info.Spaces.append(text)\r\n                    Project_Info.SpaceBox.DataStore = Project_Info.TopoDict[storey]\r\n                    self.RemoveSpace.Enabled = True\r\n    \r\n    #this button deletes the currently selected space\r\n    def RemoveExistingSpace(self,sender,e):\r\n        if len(Project_Info.Spaces)>0:\r\n            storey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n            space = Project_Info.SpaceBox.DataStore[Project_Info.SpaceBox.SelectedIndex]\r\n            if space in Project_Info.TopoDict[storey]:\r\n                Project_Info.TopoDict[storey].remove(space)\r\n                Project_Info.Spaces.remove(space)\r\n                print space, \"removed\"\r\n            if len(Project_Info.TopoDict[storey])==0:\r\n                self.RemoveSpace.Enabled = False\r\n            try:\r\n                Project_Info.SpaceBox.DataStore = Project_Info.TopoDict[storey]\r\n            except: pass\r\n        else: \r\n            print \"no spaces left!\"\r\n            storey = Project_Info.SpaceBox.DataStore=[]\r\n    \r\n    #when another storey is selected in the storey list, the spaces it contains are displayed in the space list\r\n    def ChangeSpaceDisplay(self,sender,e):\r\n        storey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n        Project_Info.SpaceBox.DataStore = Project_Info.TopoDict[storey]\r\n    \r\n    #this button removes a storey and its constituting spaces\r\n    def RemoveExistingStorey(self,sender,e):\r\n        if len(Project_Info.Storeys)==0:\r\n            self.RemoveStorey.Enabled = False\r\n            print \"no storeys left!\" \r\n        else:\r\n            try:\r\n                storey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n                Project_Info.Storeys.remove(storey)\r\n                if storey in Project_Info.TopoDict:\r\n                    del Project_Info.TopoDict[storey]\r\n                if len(Project_Info.Storeys)==0:\r\n                    self.RemoveStorey.Enabled = False\r\n                    self.RemoveSpace.Enabled = False\r\n                    self.AddSpace.Enabled = False\r\n                    Project_Info.SpaceBox.DataStore = []\r\n                Project_Info.StoreyBox.DataStore = Project_Info.Storeys\r\n                Project_Info.StoreyBox.SelectedIndex = 0\r\n                newstorey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n                Project_Info.SpaceBox.DataStore = Project_Info.TopoDict[newstorey]\r\n\r\n            except: pass\r\n    \r\n    #this button allows to create a new storey and activates the create/delete buttons when at least one storey was created\r\n    def AddNewStorey(self, sender, e):\r\n        rc, text  = Rhino.UI.Dialogs.ShowEditBox(\"Storey Name\", \"Enter the name of the storey\", None, 0)\r\n        if rc != True: return None\r\n        else:\r\n            if len(text)>0:\r\n                Project_Info.Storeys.append(str(text))\r\n                Project_Info.StoreyBox.DataStore = Project_Info.Storeys\r\n                Project_Info.TopoDict[text] = []\r\n                self.RemoveStorey.Enabled = True\r\n                self.AddSpace.Enabled = True\r\n    \r\n    #layout for the main project info: sitename, buildingname, geocoordinates and geocoordinate system\r\n    def MainInfo(self):\r\n        Project_Info.ProjectInfo={}\r\n        self.InfoGroupBox = forms.GroupBox(Text = \"Main Project Info\")\r\n        self.InfoGroupBox.Padding = drawing.Padding(10)\r\n        self.Label_SiteName = forms.Label(Text = \"Sitename: \")\r\n        Project_Info.TextBox_SiteName = forms.TextBox()\r\n        Project_Info.TextBox_SiteName.LostFocus += self.setProjectInfo\r\n        \r\n        self.Label_BuildingName = forms.Label(Text = \"Buildingname: \")\r\n        Project_Info.TextBox_BuildingName = forms.TextBox()\r\n        Project_Info.TextBox_BuildingName.LostFocus += self.setProjectInfo\r\n        \r\n        self.Link_OpenGIS = forms.LinkButton(Text = \"Coordinate System: \")\r\n        self.Link_OpenGIS.Click += self.GCSClick\r\n        Project_Info.CoordinateSystem = forms.TextBox(Text = \"http://www.opengis.net/def/crs/EPSG/0/31370\")\r\n        Project_Info.CoordinateSystem.LostFocus += self.setProjectInfo\r\n        \r\n        Xlabel = forms.Label(Text = \"x-coordinates\")\r\n        Ylabel = forms.Label(Text = \"y-coordinates\")\r\n        Zlabel = forms.Label(Text = \"z-coordinates\")\r\n        Project_Info.Xcoord = forms.TextBox(Text = \"0\")\r\n        Project_Info.Ycoord = forms.TextBox(Text = \"0\")\r\n        Project_Info.Zcoord = forms.TextBox(Text = \"0\")\r\n        Project_Info.Xcoord.LostFocus += self.setProjectInfo\r\n        Project_Info.Ycoord.LostFocus += self.setProjectInfo\r\n        Project_Info.Zcoord.LostFocus += self.setProjectInfo\r\n        \r\n        Project_Info.ExportSTP = forms.CheckBox(Text = \"include STEP geometry in Graph\", Checked = False)\r\n        Project_Info.ImportSTP = forms.CheckBox(Text = \"import STEP geometry to an empty .3dm file (Unstable - graph info cannot be used)\", Checked = False)\r\n        \r\n        self.InfoLayout = forms.DynamicLayout()\r\n        self.InfoLayout.Padding = drawing.Padding(10)\r\n        self.InfoLayout.Spacing = drawing.Size(5, 5)\r\n        \r\n        self.InfoLayout.BeginVertical()\r\n        self.InfoLayout.AddRow(self.Label_SiteName,\"            \",Project_Info.TextBox_SiteName)\r\n        self.InfoLayout.AddRow(self.Label_BuildingName,\"     \",Project_Info.TextBox_BuildingName)\r\n        self.InfoLayout.AddRow(\"\")\r\n        self.InfoLayout.AddRow(self.Link_OpenGIS,\"     \",Project_Info.CoordinateSystem)\r\n        self.InfoLayout.AddRow(Xlabel,\"     \",Project_Info.Xcoord)\r\n        self.InfoLayout.AddRow(Ylabel,\"     \",Project_Info.Ycoord)\r\n        self.InfoLayout.AddRow(Zlabel,\"     \",Project_Info.Zcoord)\r\n        self.InfoLayout.AddRow(\"\")\r\n        self.InfoLayout.EndVertical()\r\n        self.InfoLayout.BeginVertical()\r\n        self.InfoLayout.AddRow(Project_Info.ExportSTP)\r\n        self.InfoLayout.AddRow(Project_Info.ImportSTP)\r\n        self.InfoLayout.EndVertical()\r\n        self.InfoGroupBox.Content = self.InfoLayout\r\n        \r\n        return self.InfoGroupBox\r\n    \r\n    #the Project Info is written to the Project info Dictionary when one of the project info buttons loses focus. Sorry for the abundancy...\r\n    def setProjectInfo(self,sender,e):\r\n        X = str(Project_Info.Xcoord.Text)\r\n        Y = str(Project_Info.Ycoord.Text)\r\n        Z = str(Project_Info.Zcoord.Text)\r\n        Project_Info.ProjectInfo[\"coordinates\"]=(X,Y,Z)\r\n        Project_Info.ProjectInfo[\"coordinateSystem\"] = Project_Info.CoordinateSystem.Text\r\n        Project_Info.ProjectInfo[\"SiteName\"] = Project_Info.TextBox_SiteName.Text\r\n        Project_Info.ProjectInfo[\"BuildingName\"] = Project_Info.TextBox_BuildingName.Text\r\n    \r\n    #an OpenGIS webpage with current GeoCoordinateSystems opens in the default webbrowser\r\n    def GCSClick(self,sender,e):\r\n        webbrowser.open(\"http://www.opengis.net/def/crs/EPSG/0\")\r\n\r\n#main class for the \"scan-to-Graph\" tab - element enrichment\r\nclass STG(forms.Panel):\r\n    def __init__(self):\r\n        self.STGLayout = forms.DynamicLayout()\r\n        self.STGLayout.Padding = drawing.Padding(10)\r\n        self.STGLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        STG.SOList = []\r\n        STG.SOList.append(\"self\")\r\n        STG.ProductTypes = self.GetProductTypes()\r\n        STG.InformationList = self.GetBasicInfo()\r\n        \r\n        self.Information = self.CoreWidget()\r\n        self.Information.Visible = False\r\n        \r\n        self.ObjectName = forms.Label(Text = \"Object (Layer): \")\r\n        STG.ObjectDropDown = forms.DropDown()\r\n        \r\n        self.StoreyLabel = forms.Label(Text = \"Storey: \")\r\n        self.SpaceLabel = forms.Label(Text = \"Space: \")\r\n        STG.StoreyDropDown = forms.DropDown(Enabled = False)\r\n        STG.StoreyDropDown.DropDownOpening += self.setStoreyList\r\n        STG.StoreyDropDown.SelectedIndexChanged += self.SaveObjectStorey\r\n        STG.StoreyDropDown.GotFocus += self.setSpaceList\r\n        \r\n        self.SpaceLabel = forms.Label(Text = \"Space: \")\r\n        self.SelectedSpace = forms.Label(Text = \"\")\r\n        self.SpaceButton = forms.Button(Text = \"Select Space\")\r\n        \r\n        STG.AssumptionDict = {}\r\n\r\n        STG.SpaceDropDown = forms.DropDown(Enabled = False)\r\n        STG.SpaceDropDown.SelectedIndexChanged += self.SaveObjectSpace\r\n        \r\n        STG.enableLOA = forms.CheckBox(Text = \"set LOA     \", Visible = False)\r\n        STG.enableLOA.CheckedChanged += self. LOAEnabled\r\n        STG.LevelOfAccuracy = forms.NumericUpDown(DecimalPlaces = 0, Increment = 10, MaxValue = 50, MinValue = 10, Value = 10, Width = 40, Enabled = False, Visible = False)\r\n        STG.MicroAnalysis = forms.CheckBox(Text = \"Micro-scale\", Enabled = False, Visible = False)\r\n        STG.LevelOfAccuracy.LostFocus += self.setLOA\r\n        STG.MicroAnalysis.CheckedChanged += self.setDeviationMethod\r\n\r\n        self.PrintButton = forms.Button(Text = \"Open currently set info in log.txt\", Enabled = True,Visible = True)\r\n        self.PrintButton.Click += self.Printer\r\n        \r\n        NewLayers = rs.LayerNames(sort = True)\r\n        NewLayers.remove(\"Default\")\r\n        STG.ObjectDropDown.DataStore = NewLayers\r\n        STG.ObjectDropDown.DropDownOpening += self.renewList\r\n        STG.ObjectDropDown.SelectedIndexChanged += self.Change_Properties\r\n        \r\n        self.HostedCheckBox = forms.CheckBox(Text = \"Hosted\", Checked = False, Enabled = False)\r\n        self.HostedCheckBox.CheckedChanged += self.HostedVisible\r\n        self.HostedDropDown = forms.DropDown()\r\n        self.HostedDropDown.Visible = False\r\n        self.HostedDropDown.DropDownOpening +=self.renewHostedList\r\n        self.HostedDropDown.SelectedIndexChanged += self.setHost\r\n        \r\n        self.AdjacentCheckBox = forms.CheckBox(Text = \"Adjacent\", Checked = False, Enabled = False)\r\n        self.AdjacentCheckBox.CheckedChanged += self.AdjacentVisible\r\n        self.AdjacentDropDown = forms.DropDown()\r\n        self.AdjacentDropDown.Visible = False\r\n        self.AdjacentDropDown.DropDownOpening +=self.renewAdjacentList\r\n        self.AdjacentDropDown.SelectedIndexChanged += self.setSpace2\r\n        \r\n        self.STGLayout.BeginVertical()\r\n        self.STGLayout.AddRow(self.ObjectName,STG.ObjectDropDown)\r\n        self.STGLayout.AddRow(self.StoreyLabel, STG.StoreyDropDown)\r\n        self.STGLayout.AddRow(self.SpaceLabel, STG.SpaceDropDown)\r\n        self.STGLayout.AddRow(self.AdjacentCheckBox, self.AdjacentDropDown)\r\n        self.STGLayout.AddRow(self.HostedCheckBox, self.HostedDropDown)\r\n        self.STGLayout.EndVertical()\r\n        self.STGLayout.BeginVertical()\r\n        self.STGLayout.AddRow(STG.enableLOA,STG.LevelOfAccuracy,\"    \", \"    \", STG.MicroAnalysis)\r\n        self.STGLayout.AddRow(\"\")\r\n        self.STGLayout.EndVertical()\r\n        self.STGLayout.AddRow(self.Information)\r\n        self.STGLayout.AddRow(self.PrintButton)\r\n        self.STGLayout.AddRow(\" \")\r\n        self.Content = self.STGLayout\r\n    \r\n    #responds to the LOA method checkbox: links the scale of the used deviation analysis to the element\r\n    def setDeviationMethod(self,sender,e):\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                if STG.MicroAnalysis.Checked == True:\r\n                    ObjectDict[\"DeviationMethod\"] = \"MICROSCALE\"\r\n                else:\r\n                    ObjectDict[\"DeviationMethod\"] = \"MACROSCALE\"\r\n    \r\n    #makes the LOA numeric widget  and the LOA deviation method checkbox visible, when the 'set LOA' checkbox is checked\r\n    def LOAEnabled(self,sender,e):\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        if STG.enableLOA.Checked == True:\r\n            STG.LevelOfAccuracy.Enabled = True\r\n            STG.LevelOfAccuracy.Visible = True\r\n            STG.MicroAnalysis.Enabled = True\r\n            STG.MicroAnalysis.Visible = True\r\n            STG.MicroAnalysis.Checked = False\r\n            \"\"\"for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                    ObjectDict[\"LOA\"] = str(10)\r\n                    ObjectDict[\"DeviationMethod\"] = 'MACROSCALE'\"\"\"\r\n            \r\n        else:\r\n            STG.LevelOfAccuracy.Enabled = False\r\n            STG.LevelOfAccuracy.Visible = False\r\n            STG.MicroAnalysis.Enabled = False\r\n            STG.MicroAnalysis.Visible = False\r\n            STG.MicroAnalysis.Checked = False\r\n            \r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                    if \"LOA\" in ObjectDict:\r\n                        del ObjectDict[\"LOA\"]\r\n                    if \"DeviationMethod\" in ObjectDict:\r\n                        del ObjectDict[\"DeviationMethod\"]\r\n    \r\n    #responds to the LOA numeric widget, links the LOA that was found in the deviation analysis to the element\r\n    def setLOA(self,sender,e):\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                ObjectDict[\"LOA\"] = int((STG.LevelOfAccuracy.Value/10))*10\r\n                if STG.MicroAnalysis.Checked == True:\r\n                    ObjectDict[\"DeviationMethod\"] = \"MICROSCALE\"\r\n                else:\r\n                    ObjectDict[\"DeviationMethod\"] = \"MACROSCALE\"\r\n                print ObjectDict\r\n    \r\n    #avoids an initialisation crash by disabling buttons before any object is selected in the ObjectDropdown (before the first object is picked)\r\n    global enableButtons\r\n    def enableButtons(self):\r\n        STG.SpaceDropDown.Enabled = True\r\n        STG.StoreyDropDown.Enabled = True\r\n        if len(STG.ObjectDropDown.DataStore)>=2:\r\n            self.HostedCheckBox.Enabled = True\r\n        else:\r\n            self.HostedCheckBox.Enabled = False\r\n        self.AdjacentCheckBox.Enabled = True\r\n        self.Information.Visible = True\r\n        self.PrintButton.Enabled = True\r\n        self.PrintButton.Visible = True\r\n        STG.enableLOA.Visible = True\r\n    \r\n    #renews the datastore in the Adjacent Object Dropdown when it is opened\r\n    def renewAdjacentList(self,sender,e):\r\n        Rooms = []\r\n        KeepSelected = \"\"\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for storey,rooms in Project_Info.TopoDict.iteritems():\r\n            for room in rooms:\r\n                Rooms.append(room)\r\n                \r\n        for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                    if \"Space2\" in ObjectDict:\r\n                        KeepSelected = ObjectDict[\"Space2\"]\r\n            \r\n        self.AdjacentDropDown.DataStore = Rooms\r\n        if KeepSelected in self.AdjacentDropDown.DataStore:\r\n                index = self.AdjacentDropDown.DataStore.index(KeepSelected)\r\n                self.AdjacentDropDown.SelectedIndex = index\r\n    \r\n    #renews the datastore in the Hosted Object Dropdown when it is opened\r\n    def renewHostedList(self,sender,e):\r\n        NewDataStore = []\r\n        KeepSelected = \"\"\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                    if \"isHostedBy\" in ObjectDict:\r\n                        KeepSelected = ObjectDict[\"isHostedBy\"]\r\n        for item in STG.ObjectDropDown.DataStore:\r\n            NewDataStore.append(item)\r\n        \r\n        self.HostedDropDown.DataStore = sorted(NewDataStore)\r\n        if KeepSelected in self.HostedDropDown.DataStore:\r\n                index = self.HostedDropDown.DataStore.index(KeepSelected)\r\n                self.HostedDropDown.SelectedIndex = index\r\n    \r\n    #The Adjacent Dropdown becomes visible when the checkbox is checked and there are rooms in the file (set in the Project Info Tab)\r\n    def AdjacentVisible(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        Rooms = []\r\n        for storey,rooms in Project_Info.TopoDict.iteritems():\r\n            for room in rooms:\r\n                Rooms.append(room)\r\n        if self.AdjacentCheckBox.Checked == True:\r\n            if len(Rooms)>0:\r\n                self.AdjacentDropDown.Enabled = True\r\n                self.AdjacentDropDown.Visible = True\r\n                \r\n                STG.renewAdjacentList(self,0,0)\r\n                for ObjectDict in STG.InformationList:\r\n                    if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                        if \"Space2\" in ObjectDict:\r\n                            if ObjectDict['Space2'] in self.AdjacentDropDown.DataStore:\r\n                                index = self.AdjacentDropDown.DataStore.index(ObjectDict[\"Space2\"])\r\n                                self.AdjacentDropDown.SelectedIndex = index\r\n                            else:\r\n                                print 'error looking up hostedElement in datastore'\r\n                        else:\r\n                            if len(self.AdjacentDropDown.DataStore) >= 0:\r\n                                self.AdjacentDropDown.SelectedIndex = 0\r\n                                ObjectDict['Space2'] = self.AdjacentDropDown.DataStore[self.AdjacentDropDown.SelectedIndex]\r\n                                ObjectDict['Adjacent'] = 'True'\r\n            else: print 'no rooms defined yet'\r\n        else:\r\n            self.AdjacentDropDown.Enabled = False\r\n            self.AdjacentDropDown.Visible = False\r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                    if \"Space2\" in ObjectDict:\r\n                        del ObjectDict[\"Space2\"]\r\n                    if \"Adjacent\" in ObjectDict:\r\n                        del ObjectDict[\"Adjacent\"]\r\n\r\n    #when the Checkbox for the element being hosted is checked, the HostedDropdown becomes visible\r\n    def HostedVisible(self, sender, e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        if self.HostedCheckBox.Checked == True:\r\n            self.HostedDropDown.Enabled = True\r\n            self.HostedDropDown.Visible = True\r\n            STG.renewHostedList(self,0,0)\r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                    if \"isHostedBy\" in ObjectDict:\r\n                        if ObjectDict['isHostedBy'] in self.HostedDropDown.DataStore:\r\n                            index = self.HostedDropDown.DataStore.index(ObjectDict[\"isHostedBy\"])\r\n                            self.HostedDropDown.SelectedIndex = index\r\n                        else:\r\n                            print 'error looking up hostedElement in datastore'\r\n                    else:\r\n                        if len(self.HostedDropDown.DataStore) >= 0:\r\n                            self.HostedDropDown.SelectedIndex = 0\r\n                            ObjectDict['isHostedBy'] = self.HostedDropDown.DataStore[self.HostedDropDown.SelectedIndex]\r\n        else:\r\n            self.HostedDropDown.Enabled = False\r\n            self.HostedDropDown.Visible = False\r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                    if \"isHostedBy\" in ObjectDict:\r\n                        del ObjectDict[\"isHostedBy\"]\r\n    \r\n    #The list with the spaces adapts to which storey is selected in the Storey Dropdown\r\n    def setSpaceList(self,sender,e):\r\n        if self.StoreyDropDown.SelectedIndex >= 0:\r\n            storey = self.StoreyDropDown.DataStore[self.StoreyDropDown.SelectedIndex]\r\n            self.SpaceDropDown.DataStore = Project_Info.TopoDict[storey]\r\n    \r\n    #all information that is already set is printed to an external log file, which opens in the default text editor. \r\n    #This happens when clicking the Print information button at the bottom of this tab\r\n    def Printer(self,sender,e):\r\n        logfile = str(ProjectFolder + r'\\\\' + \"log.txt\")\r\n        with open(logfile,\"w\") as log:\r\n            try:\r\n                print >>log,\"PROJECT INFO:\"\r\n                if len(Project_Info.ProjectInfo)>0:\r\n                    for key,value in Project_Info.ProjectInfo.iteritems():\r\n                        print >>log,\"    \",key,\":\",value\r\n                else: print >>log,'Project Info not set'\r\n                print >>log,' '\r\n                print >>log,\"PROJECT STOREYS/ROOMS:\"\r\n                if len(Project_Info.TopoDict)>0:\r\n                    for key, value in Project_Info.TopoDict.iteritems():\r\n                        print >>log,\"    \",'storey ',key,\" has rooms:\",value\r\n                else: print >>log,\"Storeys and rooms not set\"\r\n                print >>log,' '\r\n                print >>log,\"ASSUMPTIONS/OCCLUSIONS\"\r\n                if len(STG.AssumptionDict)>0:\r\n                    for key,value in STG.AssumptionDict.iteritems():\r\n                        if len(value)>0:\r\n                            print >>log, \"    \",key,\":\",value\r\n                else: print >>log,'No assumptions or occlusions made'\r\n                print >>log,\" \"\r\n                print >>log,\"OBJECT INFORMATION: \"\r\n                for item in STG.InformationList:\r\n                    print >>log,\" \"\r\n                    for key,value in item.iteritems():\r\n                        if key == \"Name\":\r\n                            print >>log,key, \":\", value\r\n                    for key,value in item.iteritems():\r\n                        if key != \"Name\":\r\n                            if key != \"Aggregates\":\r\n                                print >>log, \"     \",key,\":\", value\r\n                    for key,value in item.iteritems():\r\n                        if key == \"Aggregates\":\r\n                            print >>log,\"     \",key,\":\"\r\n                            for item in value:\r\n                                for SOkey,SOvalue in item.iteritems():\r\n                                    if SOkey == \"Name\":\r\n                                        print >>log,\"             \", SOkey,\" : \",SOvalue\r\n                                for SOkey,SOvalue in item.iteritems():\r\n                                    if SOkey != \"Name\":\r\n                                        print >>log,\"             \", SOkey,\" : \",SOvalue\r\n                                print >>log,\" \"\r\n                print >>log,\" \"\r\n                editor = os.getenv('EDITOR')\r\n                if editor:\r\n                    ps.system(editor + ' ' + logfile)\r\n                else:\r\n                    webbrowser.open(logfile)\r\n                    \r\n            except: print 'file writing did not succeed completely'\r\n            \r\n    #when the ObjectSpace changes in the DropDown list, this is immediately saved to the basic dictionary\r\n    def SaveObjectSpace(self,sender,e):\r\n        if STG.ObjectDropDown.SelectedIndex >= 0:\r\n            Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                    ObjectDict[\"Space\"] = STG.SpaceDropDown.DataStore[STG.SpaceDropDown.SelectedIndex]\r\n    \r\n    #layout widget for the object's additional information: type, subobjects and info about subobjects, geometry and remarks on geometries\r\n    def CoreWidget(self):\r\n        self.CoreGB = forms.GroupBox(Text = \"Object Information\")\r\n        self.CoreGB.Padding = drawing.Padding(10)\r\n        self.CoreLayout = forms.DynamicLayout()\r\n        self.CoreLayout.Padding = drawing.Padding(10)\r\n        self.CoreLayout.Spacing = drawing.Size(5,5)\r\n        \r\n        Label_type = forms.Label(Text = \"> Type: \")\r\n        Product_Ontology_types = STG.ProductTypes\r\n        self.DropDown_type = forms.DropDown(DataStore = STG.ProductTypes)\r\n        self.DropDown_type.SelectedIndexChanged += self.SaveObjectType\r\n        \r\n        Label_aggregates = forms.Label(Text = \"> Sub-Objects: \")\r\n        Aggregates = self.Aggregate_Objects()\r\n        Label_entities = forms.Label(Text = \"Sub-Object has Geometries: \")\r\n        Objects = self.SO_Geometry()\r\n        STG.select_Objects = forms.Button(Text = \"Select\")\r\n        STG.remove_Objects = forms.Button(Text = \"Remove\", Enabled = False)\r\n        STG.select_Objects.Click += self.ObjectSelector\r\n        STG.remove_Objects.Click += self.ObjectRemover\r\n        \r\n        STG.createAssumption = forms.Button(Text = \"Remark\", Enabled = False)\r\n        STG.createAssumption.Click += self.Assumption\r\n        \r\n        STG.OcclusionButton = forms.Button(Text = \"Occlusion\", Enabled = False)\r\n        STG.OcclusionButton.Click += self.Occlusion\r\n        \r\n        AssumptionWidget = self.AssumptionList()\r\n        \r\n        self.removeAssumptionButton = forms.Button(Text = \"Remove\", Enabled = False)\r\n        self.removeAssumptionButton.Click += self.removeAssumption\r\n        \r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(Label_type, self.DropDown_type, None, None)\r\n        self.CoreLayout.AddRow('')\r\n        self.CoreLayout.AddRow(Label_aggregates,None,None,None)\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(Aggregates)\r\n        self.CoreLayout.AddRow(' ')\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(Label_entities, None,None,None)\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(Objects)\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(STG.createAssumption,STG.OcclusionButton,None,STG.remove_Objects,STG.select_Objects)\r\n        self.CoreLayout.AddRow(\" \")\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(AssumptionWidget)\r\n        self.CoreLayout.EndVertical()\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreLayout.AddRow(None,None,None,self.removeAssumptionButton)\r\n        self.CoreLayout.BeginVertical()\r\n        self.CoreGB.Content = self.CoreLayout\r\n        return self.CoreGB\r\n    \r\n    #links a remark on an occluded geometry to the geometry in the STG.AssumptionDict\r\n    def Occlusion(self,sender,e):\r\n        DisplayList = []\r\n        index = self.SO_Geometry.SelectedIndex\r\n        OccludedObject = str(self.SO_Geometry.DataStore[index])\r\n        OccludedObject = OccludedObject.split(',')\r\n        OccludedObject = OccludedObject[0]\r\n        if OccludedObject in STG.AssumptionDict:\r\n            if \"OCCLUDED_AREA\" not in STG.AssumptionDict[OccludedObject]:\r\n                STG.AssumptionDict[OccludedObject].append(\"OCCLUDED_AREA\")\r\n        else:\r\n            STG.AssumptionDict[OccludedObject] = []\r\n            STG.AssumptionDict[OccludedObject].append(\"OCCLUDED_AREA\")\r\n        \r\n        ParentObject = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            for aggregate in SODict[\"Geometry\"]:\r\n                                if aggregate in STG.AssumptionDict:\r\n                                    DisplayText = str(aggregate)\r\n                                    DisplayList.append(DisplayText)\r\n                                    \r\n                                    List = []\r\n                                    for item in STG.AssumptionDict[aggregate]:\r\n                                        List.append(item)\r\n                                    self.AssumptionList.DataStore = List\r\n                                    self.removeAssumptionButton.Enabled = True\r\n                                    \r\n                                else:\r\n                                    DisplayList.append(aggregate)\r\n                                    \r\n                                self.SO_Geometry.DataStore = DisplayList\r\n                                \r\n                if \"Geometry\" in ObjectDict:\r\n                    for geometry in ObjectDict[\"Geometry\"]:\r\n                        if geometry in STG.AssumptionDict:\r\n                            DisplayText = str(geometry)\r\n                            DisplayList.append(DisplayText)\r\n                            \r\n                            List = []\r\n                            for item in STG.AssumptionDict[geometry]:\r\n                                List.append(item)\r\n                            self.AssumptionList.DataStore = List\r\n                            self.removeAssumptionButton.Enabled = True\r\n                            \r\n                        else:\r\n                            DisplayList.append(geometry)\r\n        self.SO_Geometry.SelectedIndex = index\r\n        \r\n        geometry = self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex]\r\n        if geometry in STG.AssumptionDict:\r\n            List = []\r\n            for item in STG.AssumptionDict[geometry]:\r\n                List.append(item)\r\n            self.AssumptionList.DataStore = List\r\n            self.removeAssumptionButton.Enabled = True\r\n        else:\r\n            self.removeAssumptionButton.Enabled = False\r\n            self.AssumptionList.DataStore = []\r\n        if len(self.AssumptionList.DataStore) == 0:\r\n            self.removeAssumptionButton.Enabled = False\r\n   \r\n    #links a general modelling remark (so not only 'assumptions', despite the name) to a geometry in the STG.AssumptionDict\r\n    def Assumption(self,sender,e):\r\n        index = self.SO_Geometry.SelectedIndex\r\n        DisplayList = []\r\n        rc, text  = Rhino.UI.Dialogs.ShowEditBox(\"Remark\", \"Add a modelling remark to this element:\", None, 0)\r\n        if rc != True: return None\r\n        else:\r\n            if len(text)>0:\r\n                AssumptionObject = str(self.SO_Geometry.DataStore[index])\r\n                AssumptionObject = AssumptionObject.split(',')\r\n                AssumptionObject = AssumptionObject[0]\r\n                if AssumptionObject in STG.AssumptionDict:\r\n                    STG.AssumptionDict[AssumptionObject].append(text)\r\n                else:\r\n                    STG.AssumptionDict[AssumptionObject] = []\r\n                    STG.AssumptionDict[AssumptionObject].append(text)\r\n                ParentObject = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n                for ObjectDict in STG.InformationList:\r\n                    if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                        if \"Aggregates\" in ObjectDict:\r\n                            for SODict in ObjectDict[\"Aggregates\"]:\r\n                                if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                                    for aggregate in SODict[\"Geometry\"]:\r\n                                        if aggregate in STG.AssumptionDict:\r\n                                            DisplayText = str(aggregate)\r\n                                            DisplayList.append(DisplayText)\r\n                                            \r\n                                            List = []\r\n                                            for item in STG.AssumptionDict[aggregate]:\r\n                                                List.append(item)\r\n                                            self.AssumptionList.DataStore = List\r\n                                            self.removeAssumptionButton.Enabled = True\r\n                                            \r\n                                        else:\r\n                                            DisplayList.append(aggregate)\r\n                                            \r\n                                        self.SO_Geometry.DataStore = DisplayList\r\n                                        \r\n                        if \"Geometry\" in ObjectDict:\r\n                            for geometry in ObjectDict[\"Geometry\"]:\r\n                                if geometry in STG.AssumptionDict:\r\n                                    DisplayText = str(geometry)\r\n                                    DisplayList.append(DisplayText)\r\n                                    \r\n                                    List = []\r\n                                    for item in STG.AssumptionDict[geometry]:\r\n                                        List.append(item)\r\n                                    self.AssumptionList.DataStore = List\r\n                                    self.removeAssumptionButton.Enabled = True\r\n                                    \r\n                                else:\r\n                                    DisplayList.append(geometry)\r\n                        \r\n                        \r\n        \r\n        self.SO_Geometry.SelectedIndex = index\r\n        \r\n        geometry = self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex]\r\n        if geometry in STG.AssumptionDict:\r\n            List = []\r\n            for item in STG.AssumptionDict[geometry]:\r\n                List.append(item)\r\n            self.AssumptionList.DataStore = List\r\n            self.removeAssumptionButton.Enabled = True\r\n        else:\r\n            self.removeAssumptionButton.Enabled = False\r\n            self.AssumptionList.DataStore = []\r\n        if len(self.AssumptionList.DataStore) == 0:\r\n            self.removeAssumptionButton.Enabled = False\r\n    \r\n    #Button to removes an object from the Geometries of a subobject (to remove a geometry from a main object, remove it from the layer)\r\n    def ObjectRemover(self,sender,e):\r\n        index = self.SO_Geometry.SelectedIndex\r\n        selectedGeometry = self.SO_Geometry.DataStore[index]\r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                for SODict in ObjectDict[\"Aggregates\"]:\r\n                    if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                        if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] != \"self\":\r\n                            if \"Geometry\" in SODict:\r\n                                if selectedGeometry in SODict[\"Geometry\"]:\r\n                                    SODict[\"Geometry\"].remove(selectedGeometry)\r\n                                    newList = []\r\n                                    for item in SODict[\"Geometry\"]:\r\n                                        newList.append(str(item))\r\n                                    self.SO_Geometry.DataStore = newList\r\n                            \r\n        if len(self.SO_Geometry.DataStore)>0:\r\n            STG.createAssumption.Enabled = True\r\n            STG.OcclusionButton.Enabled = True\r\n            STG.remove_Objects.Enabled = True\r\n        else: \r\n            STG.remove_Objects.Enabled = False\r\n            \r\n    #select the objects in the viewport that should be aggregated by the subobject. These geometries appear in the Geometry listbox of the subobject and can be selected or removed later on.\r\n    def ObjectSelector(self,sender,e):\r\n        STG.select_Objects.Enabled = False\r\n        CurrentLayer = rs.CurrentLayer()\r\n        activeLayers = []\r\n        visibleLayers = []\r\n        allLayers = rs.LayerNames()\r\n        for Layer in allLayers:\r\n            if rs.LayerLocked(Layer) == False:\r\n                activeLayers.append(Layer)\r\n            if rs.LayerVisible(Layer) == True:\r\n                visibleLayers.append(Layer)\r\n        \r\n        ParentObject = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        rs.CurrentLayer(ParentObject)\r\n\r\n        for Layer in allLayers:\r\n            if Layer != ParentObject and Layer != \"Default\":\r\n                rs.LayerLocked(Layer, True)\r\n        SelectedObjects = rs.GetObjects(\"Select parts of Subobject \" + self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex], group = True, preselect = False)\r\n        \r\n        if SelectedObjects is None:\r\n            STG.select_Objects.Enabled = True\r\n            return\r\n        else: \r\n            STG.select_Objects.Enabled = True\r\n            \r\n                \r\n        if sc.escape_test(False): return\r\n        \r\n        for Object in SelectedObjects:\r\n            if rs.ObjectLayer(Object) == \"Default\":\r\n                rs.ObjectLayer(Object, layer = ParentObject)\r\n                \r\n        SOName = self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                for SODict in ObjectDict[\"Aggregates\"]:\r\n                    if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                        if \"Geometry\" in SODict:\r\n                            already_present = list(SODict[\"Geometry\"])\r\n                            for objectID in SelectedObjects:\r\n                                if not str(objectID) in already_present:\r\n                                    if rs.ObjectType(objectID) != 2:\r\n                                        already_present.append(str(objectID))\r\n                            SODict[\"Geometry\"] = already_present\r\n                        else:\r\n                            items_to_add = []\r\n                            for item in SelectedObjects:\r\n                                if rs.ObjectType(item) != 2:\r\n                                    items_to_add.append(str(item))\r\n                            SODict[\"Geometry\"] = items_to_add\r\n                                \r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                for SODict in ObjectDict[\"Aggregates\"]:\r\n                    if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                        if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] == \"self\":\r\n                            geom_str = []\r\n                            for geom in rs.ObjectsByLayer(ObjectLayer):\r\n                                if rs.ObjectType(geom) != 2:\r\n                                    geom_str.append(str(geom))\r\n                            ObjectDict[\"Geometry\"]= geom_str\r\n                            self.SO_Geometry.DataStore = geom_str\r\n                            self.SO_Geometry.Enabled = False\r\n                            STG.select_Objects.Enabled = False\r\n                        else:\r\n                            DisplayList = []\r\n                            for aggregate in SODict[\"Geometry\"]:\r\n                                if aggregate in STG.AssumptionDict:\r\n                                    DisplayText = str(aggregate)\r\n                                    DisplayList.append(DisplayText)\r\n                                else:\r\n                                    DisplayList.append(aggregate)\r\n                                self.SO_Geometry.DataStore = DisplayList\r\n                            self.SO_Geometry.Enabled = True\r\n                            STG.select_Objects.Enabled = True\r\n                            \r\n        if len(self.SO_Geometry.DataStore)>0:\r\n            STG.createAssumption.Enabled = True\r\n            STG.OcclusionButton.Enabled = True\r\n            STG.remove_Objects.Enabled = True\r\n        else:\r\n            STG.remove_Objects.Enabled = False\r\n     \r\n    #layout for the object-geometry listbox\r\n    def SO_Geometry(self):\r\n        self.SO_Geometry = forms.ListBox(Height = 150)\r\n        Object_Info = []\r\n        self.SO_Geometry.DataStore = Object_Info\r\n        self.SO_Geometry.SelectedIndexChanged += self.SelectObjectInViewPort\r\n        return self.SO_Geometry\r\n    \r\n    #layout for the assumption listbox at the bottom of the tab\r\n    def AssumptionList(self):\r\n        self.AssumptionList = forms.ListBox(Height = 100)\r\n        Assumptions = []\r\n        self.AssumptionList.DataStore = Assumptions\r\n        return self.AssumptionList\r\n    \r\n    #when the remove button is pressed, the remark is deleted. A remark can be a general remark, an assumption , an 'INNERPART' remark or an occlusion. \r\n    def removeAssumption(self,sender,e):\r\n        index = self.AssumptionList.SelectedIndex\r\n        ParentObject = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            for geometry in SODict[\"Geometry\"]:\r\n                                if self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex] == geometry:\r\n                                    if geometry in STG.AssumptionDict:\r\n                                        STG.AssumptionDict[geometry].remove(self.AssumptionList.DataStore[index])\r\n                                        self.AssumptionList.DataStore = STG.AssumptionDict[geometry]\r\n                                    else:\r\n                                        self.removeAssumptionButton.Enabled = False\r\n                                    if len(self.AssumptionList.DataStore) == 0:\r\n                                        self.removeAssumptionButton.Enabled = False\r\n                                        del STG.AssumptionDict[geometry]\r\n                                        \r\n                if \"Geometry\" in ObjectDict:\r\n                    for geometry in ObjectDict[\"Geometry\"]:\r\n                        if self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex] == geometry:\r\n                            if geometry in STG.AssumptionDict:\r\n                                STG.AssumptionDict[geometry].remove(self.AssumptionList.DataStore[index])\r\n                                self.AssumptionList.DataStore = STG.AssumptionDict[geometry]\r\n                            else:\r\n                                self.removeAssumptionButton.Enabled = False\r\n                            if len(self.AssumptionList.DataStore) == 0:\r\n                                self.removeAssumptionButton.Enabled = False\r\n                                del STG.AssumptionDict[geometry]\r\n    \r\n   #when an element is selected in the subobject-geometry box, this element is also selected in the viewport and its remarks are displayed in the Remark Listbox\r\n    def SelectObjectInViewPort(self, sender, e):\r\n        try:\r\n            index = self.SO_Geometry.SelectedIndex\r\n            ParentObject = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n            for ObjectDict in STG.InformationList:\r\n                if ObjectDict[\"Identifier\"]==rs.LayerId(ParentObject):\r\n                    if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] == \"self\":\r\n                        geom_str = []\r\n                        for geom in rs.ObjectsByLayer(ParentObject):\r\n                            if rs.ObjectType(geom) != 2:\r\n                                geom_str.append(str(geom))\r\n                        ObjectDict[\"Geometry\"]= geom_str\r\n                        self.SO_Geometry.DataStore = geom_str\r\n                        for geometry in ObjectDict[\"Geometry\"]:\r\n                            if self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex] == geometry:\r\n                                if geometry in STG.AssumptionDict:\r\n                                    List = []\r\n                                    for item in STG.AssumptionDict[geometry]:\r\n                                        List.append(item)\r\n                                    self.AssumptionList.DataStore = List\r\n                                    self.removeAssumptionButton.Enabled = True\r\n                                else:\r\n                                    self.removeAssumptionButton.Enabled = False\r\n                                    self.AssumptionList.DataStore = []\r\n                                if len(self.AssumptionList.DataStore) == 0:\r\n                                    self.removeAssumptionButton.Enabled = False\r\n                                                \r\n                    if \"Aggregates\" in ObjectDict:\r\n                        for SODict in ObjectDict[\"Aggregates\"]:\r\n                            if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                                if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] != \"self\":\r\n                                    self.SO_Geometry.Enabled = True\r\n                                    for geometry in SODict[\"Geometry\"]:\r\n                                        if self.SO_Geometry.DataStore[self.SO_Geometry.SelectedIndex] == geometry:\r\n                                            if geometry in STG.AssumptionDict:\r\n                                                List = []\r\n                                                for item in STG.AssumptionDict[geometry]:\r\n                                                    List.append(item)\r\n                                                self.AssumptionList.DataStore = List\r\n                                                self.removeAssumptionButton.Enabled = True\r\n                                            else:\r\n                                                self.removeAssumptionButton.Enabled = False\r\n                                                self.AssumptionList.DataStore = []\r\n                                            if len(self.AssumptionList.DataStore) == 0:\r\n                                                self.removeAssumptionButton.Enabled = False\r\n    \r\n            if index >= 0:\r\n                item = str(self.SO_Geometry.DataStore[index])\r\n                Rhino.RhinoApp.RunScript(\"_SelNone\", False)\r\n                Rhino.RhinoApp.RunScript(\"_SelId \" + item + \" _Enter\", False)\r\n        except: print \"index out of range\"\r\n    \r\n    #layout for the subobject settings\r\n    def Aggregate_Objects(self):\r\n        self.SOLayout = forms.DynamicLayout()\r\n        self.SubObjectListBox = forms.ListBox(Height = 80)\r\n        self.SubObjectListBox.DataStore = STG.SOList\r\n        self.SubObjectListBox.SelectedIndexChanged += self.SaveSOProps\r\n        \r\n        self.SOInfo = forms.DynamicLayout()\r\n        self.SOInfo.Padding = drawing.Padding(10)\r\n        self.SOInfo.Spacing = drawing.Size(5,5)\r\n        \r\n        self.NewButton = forms.Button(Text = \"Construct New\")\r\n        self.NewButton.Click += self.addAggregate\r\n        \r\n        self.DeleteButton = forms.Button(Text = \"Delete\")\r\n        self.DeleteButton.Click += self.DeleteAggregate\r\n        \r\n        SOName = forms.Label(Text = \"Name: \")\r\n        self.SONameBox = forms.TextBox()\r\n        self.SONameBox.LostFocus += self.refreshSOList\r\n        \r\n        SOType = forms.Label(Text = \"Type: \")\r\n        self.SOTypeBox = forms.DropDown()\r\n        self.SOTypeBox.DataStore = STG.ProductTypes\r\n        self.SOTypeBox.SelectedIndexChanged += self.SOTypeboxChanges\r\n        \r\n        self.SORelationship = forms.Label(Text = \"Relationship with Parent: \")\r\n        self.SORelationBox = forms.DropDown()\r\n        self.RelationshipStore = [\"aggregated\",\"hosted\"]\r\n        self.SORelationBox.DataStore = self.RelationshipStore\r\n        self.SORelationBox.SelectedIndex = 0\r\n        self.SORelationBox.SelectedIndexChanged += self.SORelationChanges\r\n        \r\n        self.SOfromSOLabel = forms.Label(Text = \"(opt.) Part of Sub-Object\")\r\n        self.SOfromSODropDown = forms.DropDown(DataStore = [])\r\n        self.SOfromSODropDown.DropDownOpening += self.setSOfromSODataStore\r\n        self.SOfromSODropDown.SelectedIndexChanged += self.SaveSOfromSO\r\n        \r\n        self.SOInfo.BeginVertical()\r\n        self.SOInfo.AddRow(SOName,self.SONameBox)\r\n        self.SOInfo.AddRow(SOType,self.SOTypeBox)\r\n        self.SOInfo.AddRow(self.SORelationship,self.SORelationBox)\r\n        self.SOInfo.AddRow(self.SOfromSOLabel, self.SOfromSODropDown)\r\n        self.SOInfo.EndVertical()\r\n        self.SOInfo.BeginVertical()\r\n        self.SOInfo.AddRow('')\r\n        self.SOInfo.AddRow(None,self.NewButton,self.DeleteButton)\r\n        self.SOInfo.EndVertical()\r\n        \r\n        self.SOLayout.AddRow(self.SubObjectListBox,self.SOInfo)\r\n        return self.SOLayout\r\n    \r\n    #the 'subobject-from-subobject' datastore contains all other subobjects of a main object. An object cannot be a subobject from itself. \r\n    def setSOfromSODataStore(self, sender, e):\r\n        NewDataStore = []\r\n        for item in self.SubObjectListBox.DataStore:\r\n            NewDataStore.append(item)        \r\n        NewDataStore.append('-NONE-')\r\n        NewDataStore.remove('self')\r\n        CurrentSO = self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]\r\n        NewDataStore.remove(CurrentSO)\r\n        self.SOfromSODropDown.DataStore = sorted(NewDataStore)\r\n        \r\n    #initialisation of product types from the product Ontology (https://github.com/pipauwel/product)and the custom products from the custom_types.csv file in the installation directory\r\n    def GetProductTypes(self):\r\n        csvfile = str(ProjectFolder + r'\\\\' + \"product_ontology.csv\")\r\n        ProductTypes = [\"-not specified-\"]\r\n        with open(csvfile, 'rb') as csvreadfile:\r\n            read = csv.reader(csvreadfile, dialect = 'excel')\r\n            for item in read:\r\n                if len(item)>0:\r\n                    if \"http\" in item[0]:\r\n                        item = item[0].split(\"#\")\r\n                        item = item[-1]\r\n                        ProductTypes.append(\"product:\"+item)\r\n        \r\n        csvfile = str(ProjectFolder + r'\\\\' + \"custom_types.csv\")\r\n        with open(csvfile, 'rb') as csvreadfile:\r\n            read = csv.reader(csvreadfile, dialect = 'excel')\r\n            for item in read:\r\n                if len(item)>0:\r\n                    if \"http\" in item[0]:\r\n                        item = item[0].split(\"#\")\r\n                        item = item[-1]\r\n                        ProductTypes.append(\"stgp:\"+item)\r\n        return sorted(ProductTypes)\r\n\r\n    #initialisation of available information when the plugin is started, \r\n    #based on the info that is present in the Layers that exist prior to starting the plugin: Layername, Identifier, Point Clouds, Objects, Geometry. The type is guessed from the layer's name\r\n    def GetBasicInfo(self):\r\n        InformationList = []\r\n        ProjectLayers = rs.LayerNames()\r\n        ProjectLayers.remove(\"Default\")\r\n        for Layer in ProjectLayers:\r\n            LayerDict = {}\r\n            LayerDict[\"Name\"] = Layer\r\n            LayerDict[\"Identifier\"] = rs.LayerId(Layer)\r\n            \r\n            Layer_upper = Layer.upper()\r\n            \r\n            sortedlist = list(reversed(sorted(STG.ProductTypes, key = len)))\r\n            Types_upper = []\r\n            for type in sortedlist:\r\n                if ':' in type:\r\n                    type=type.split(':')\r\n                    type=type[1]\r\n                    type=type.upper()\r\n                    Types_upper.append(type)\r\n                else: Types_upper.append(type)\r\n            for typeupper,type in zip(Types_upper,sortedlist):\r\n                if typeupper in str(Layer_upper):\r\n                    LayerDict[\"Type\"] = type\r\n                    break\r\n            objects = rs.ObjectsByLayer(Layer)\r\n            PointCloud = rs.ObjectsByType(2)\r\n            pointclouds_in_layer = list(set(objects) & set(PointCloud))\r\n            if len(pointclouds_in_layer)>0:\r\n                #Point Cloud FileName => does not have URI yet!\r\n                LayerDict[\"PointCloud\"] = []\r\n                for PC in pointclouds_in_layer:\r\n                    LayerDict[\"PointCloud\"].append(str(rs.ObjectName(PC)))\r\n            InformationList.append(LayerDict)\r\n            \r\n        return InformationList\r\n    \r\n    #the Hosting Element is set when a new index is selected in the Hosted-Dropdown\r\n    def setHost(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                ObjectDict[\"isHostedBy\"] = self.HostedDropDown.DataStore[self.HostedDropDown.SelectedIndex]\r\n    \r\n    #the other space which is adjacent to an 'Adjacent element'. This hierarchy is fictional and exists purely in the plugin\r\n    def setSpace2(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                ObjectDict[\"Space2\"] = self.AdjacentDropDown.DataStore[self.AdjacentDropDown.SelectedIndex]\r\n                ObjectDict[\"Adjacent\"] = \"True\"\r\n    \r\n    #when the ObjectType changes in the TypeDropDown list, this type is immediately saved to the basic dictionary\r\n    def SaveObjectType(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                ObjectDict[\"Type\"] = self.DropDown_type.DataStore[self.DropDown_type.SelectedIndex]\r\n                \r\n    #when the ObjectStorey changes in the DropDown list, this is immediately saved to the basic dictionary\r\n    def SaveObjectStorey(self,sender,e):\r\n        if STG.ObjectDropDown.SelectedIndex >= 0:\r\n            try:\r\n                Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n                for ObjectDict in STG.InformationList:\r\n                    if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                        ObjectDict[\"Storey\"] = STG.StoreyDropDown.DataStore[STG.StoreyDropDown.SelectedIndex]\r\n                        STG.SpaceDropDown.DataStore = Project_Info.TopoDict[ObjectDict[\"Storey\"]]\r\n            except: \r\n                print 'error at selecting item in StoreyDropdown'\r\n    \r\n    #the datastore from the storey-dropdown is set to the storeys that were defined in the Project Info tab\r\n    def setStoreyList(self,sender,e):\r\n        copyList = []\r\n        for item in Project_Info.Storeys:\r\n            copyList.append(item)\r\n        STG.StoreyDropDown.DataStore = copyList\r\n                \r\n    #when a new object is selected in the object dropdown menu, all widgets need to be refreshed to correspond to the attributes of the newly selected element\r\n    def Change_Properties(self,sender,e):\r\n        enableButtons(self)\r\n        ObjectStore = []\r\n        for ObjectDict in STG.InformationList:\r\n            ObjectStore.append(ObjectDict[\"Name\"])\r\n        STG.ObjectDropDown.DataStore = ObjectStore\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        NewLayer = True\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                NewLayer = False\r\n                geom_str = []\r\n                for geom in rs.ObjectsByLayer(Layer):\r\n                    if rs.ObjectType(geom) != 2:\r\n                        geom_str.append(str(geom))\r\n                ObjectDict[\"Geometry\"]= geom_str\r\n                if ObjectDict[\"Name\"] != Layer:\r\n                    ObjectDict[\"Name\"] = Layer\r\n                if \"Type\" in ObjectDict:\r\n                    index = STG.ProductTypes.index(ObjectDict[\"Type\"])\r\n                    self.DropDown_type.SelectedIndex = index\r\n                else:\r\n                    Layer_upper = Layer.upper()\r\n                    sortedlist = list(reversed(sorted(STG.ProductTypes, key = len)))\r\n                    Types_upper = [type.upper() for type in sortedlist]\r\n                    for typeupper,type in zip(Types_upper,sortedlist):\r\n                        if typeupper in str(Layer_upper):\r\n                            ObjectDict[\"Type\"] = type\r\n                            index = STG.ProductTypes.index(\"  \")\r\n                            self.DropDown_type.SelectedIndex = index\r\n                            break\r\n                try:\r\n                    if \"Storey\" in ObjectDict:\r\n                        if \"Space\" in ObjectDict:\r\n                            #very strange bug changes also ObjectDict[\"Space\"]\r\n                            strangeBug = ObjectDict[\"Space\"]\r\n                            try:\r\n                                StoreyIndex = Project_Info.Storeys.index(ObjectDict[\"Storey\"])\r\n                                STG.StoreyDropDown.SelectedIndex = StoreyIndex\r\n                            except: print \"could not set storey\"\r\n                        if \"Space\" in ObjectDict:\r\n                            #ObjectDict[\"Space\"] is reassigned to the strangeBug variable\r\n                            ObjectDict[\"Space\"] = strangeBug\r\n                            try:\r\n                                STG.SpaceDropDown.DataStore = Project_Info.TopoDict[ObjectDict[\"Storey\"]]\r\n                                index = STG.SpaceDropDown.DataStore.index(ObjectDict[\"Space\"])\r\n                                STG.SpaceDropDown.SelectedIndex = index\r\n                            except: print \"could not set space\"\r\n                    else:\r\n                        if STG.StoreyDropDown.SelectedIndex>=0:\r\n                            ObjectDict[\"Storey\"] = STG.StoreyDropDown.DataStore[STG.StoreyDropDown.SelectedIndex]\r\n                except: print \"could not correctly set storey/space\"\r\n                try:\r\n                    if \"Space\" in ObjectDict:\r\n                        if \"Storey\" in ObjectDict:\r\n                            STG.SpaceDropDown.DataStore = Project_Info.TopoDict[ObjectDict[\"Storey\"]]\r\n                            index = Project_Info.TopoDict[ObjectDict[\"Storey\"]].index(ObjectDict[\"Space\"])\r\n                            STG.SpaceDropDown.SelectedIndex = index\r\n                            \r\n                    else: \r\n                        if \"Storey\" in ObjectDict:\r\n                            if len(STG.SpaceDropDown.DataStore)>0:\r\n                                ObjectDict[\"Space\"] = STG.SpaceDropDown.DataStore[STG.SpaceDropDown.SelectedIndex]\r\n                except: pass\r\n                \r\n                if \"isHostedBy\" in ObjectDict:\r\n                    self.HostedCheckBox.Checked = True\r\n                    STG.HostedVisible(self, 0, 0)\r\n                else:\r\n                    self.HostedCheckBox.Checked = False\r\n                \r\n                STG.SOList = [\"self\"]\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if \"Name\" in SODict:\r\n                            self.SOList.append(SODict[\"Name\"])\r\n                        \r\n                self.SubObjectListBox.DataStore = STG.SOList\r\n                self.SubObjectListBox.SelectedIndex = 0\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if \"Name\" in SODict == STG.SOList[0]:\r\n                            if \"Type\" in SODict:\r\n                                SOindex = STG.ProductTypes.index(SODict[\"Type\"])\r\n                                self.SOTypeBox.SelectedIndex = SOindex\r\n                                \r\n                if \"LOA\" in ObjectDict:\r\n                    STG.enableLOA.Checked = True\r\n                    STG.LevelOfAccuracy.Enabled = True\r\n                    STG.LevelOfAccuracy.Visible = True\r\n                    STG.MicroAnalysis.Enabled = True\r\n                    STG.MicroAnalysis.Visible = True\r\n                    STG.LevelOfAccuracy.Value = int(ObjectDict[\"LOA\"])\r\n                    if ObjectDict[\"DeviationMethod\"] == \"MACROSCALE\":\r\n                        STG.MicroAnalysis.Checked = False\r\n                    else:\r\n                        STG.MicroAnalysis.Checked = True\r\n                else:\r\n                    STG.enableLOA.Checked = False\r\n                    STG.LevelOfAccuracy.Enabled = False\r\n                    STG.LevelOfAccuracy.Visible = False\r\n                    STG.MicroAnalysis.Enabled = False\r\n                    STG.MicroAnalysis.Visible = False\r\n                \r\n                \r\n                if \"Adjacent\" in ObjectDict:\r\n                    if ObjectDict[\"Adjacent\"] == \"True\":\r\n                        self.AdjacentCheckBox.Checked = True\r\n                        self.AdjacentDropDown.Visible = True\r\n                        self.AdjacentDropDown.Enabled = True\r\n                        if \"Space2\" in ObjectDict:\r\n                            self.AdjacentDropDown.SelectedIndex = self.AdjacentDropDown.DataStore.index(ObjectDict[\"Space2\"])\r\n                else:\r\n                    self.AdjacentCheckBox.Checked = False\r\n                    self.AdjacentDropDown.Visible = False\r\n                    self.AdjacentDropDown.Enabled = False\r\n                            \r\n        if NewLayer == True:\r\n            LayerDict = {}\r\n            LayerDict[\"Name\"] = Layer\r\n            LayerDict[\"Identifier\"] = rs.LayerId(Layer)\r\n            Layer_upper = Layer.upper()\r\n            \r\n            sortedlist = list(reversed(sorted(STG.ProductTypes, key = len)))\r\n            Types_upper = [type.upper() for type in sortedlist]\r\n            for typeupper,type in zip(Types_upper,sortedlist):\r\n                if typeupper in str(Layer_upper):\r\n                    LayerDict[\"Type\"] = type\r\n            objects = rs.ObjectsByLayer(Layer)\r\n            PointCloud = rs.ObjectsByType(2)\r\n            pointclouds_in_layer = list(set(objects) & set(PointCloud))\r\n            if len(pointclouds_in_layer)>0:\r\n                #Point Cloud FileName => does not have URI yet!\r\n                LayerDict[\"PointCloud\"] = str(rs.ObjectName(pointclouds_in_layer[0])+\".e57\")\r\n            else:\r\n                LayerDict[\"PointCloud\"] = None\r\n            STG.InformationList.append(LayerDict)\r\n        \r\n        if len(self.SO_Geometry.DataStore)>0:\r\n            STG.createAssumption.Enabled = True\r\n            STG.OcclusionButton.Enabled = True\r\n            STG.remove_Objects.Enabled = True\r\n        else: \r\n            STG.createAssumption.Enabled = False\r\n            STG.OcclusionButton.Enabled = False\r\n            STG.remove_Objects.Enabled = False\r\n        \r\n        #blocking adaptations for \"self\"\r\n        if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] == \"self\":\r\n            self.SONameBox.Enabled = False\r\n            self.SOTypeBox.SelectedIndex = self.DropDown_type.SelectedIndex\r\n            self.SOTypeBox.Enabled = False\r\n            self.SOfromSODropDown.Enabled = False\r\n            self.SOfromSODropDown.Visible = False\r\n            self.SORelationship.Visible = False\r\n            self.SOfromSOLabel.Visible = False\r\n            self.SORelationBox.Enabled = False\r\n            self.SORelationBox.Visible = False\r\n            geom_str = []\r\n            for geom in rs.ObjectsByLayer(Layer):\r\n                if rs.ObjectType(geom) != 2:\r\n                    geom_str.append(str(geom))\r\n            ObjectDict[\"Geometry\"]= geom_str\r\n            self.SO_Geometry.DataStore = geom_str\r\n            self.SO_Geometry.Enabled = True\r\n            STG.select_Objects.Enabled = False\r\n            STG.remove_Objects.Enabled = False\r\n            \r\n        else:\r\n            self.SO_Geometry.Enabled = True\r\n            self.SONameBox.Enabled = True\r\n            self.SOTypeBox.Enabled = True\r\n            STG.select_Objects.Enabled = True\r\n            self.SOfromSODropDown.Enabled = True\r\n            self.SORelationBox.Enabled = True\r\n            self.SOfromSODropDown.Visible = True\r\n            self.SORelationBox.Visible = True\r\n            self.SORelationship.Visible = True\r\n            self.SOfromSOLabel.Visible = True\r\n            \r\n    #when the selected index from the SOfromSODropDown changes, this is saved to the Subobject information\r\n    def SaveSOfromSO(self, sender, e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            SODict[\"SOfromSO\"] = self.SOfromSODropDown.DataStore[self.SOfromSODropDown.SelectedIndex]\r\n    \r\n    #when the selected index from the SubObject list changes, all subobject widgets need to be refreshed to correspond to the attributes of the newly selected subobject\r\n    def SaveSOProps(self,sender,e):\r\n        self.SO_Geometry.Enabled = True\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        SOName = self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]\r\n\r\n        SOType = self.SOTypeBox.DataStore[self.SOTypeBox.SelectedIndex]\r\n        self.SONameBox.Text = str(SOName)      \r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            self.SONameBox.Text = SODict[\"Name\"]\r\n                            if \"Type\" in SODict:\r\n                                self.SOTypeBox.SelectedIndex = self.SOTypeBox.DataStore.index(SODict[\"Type\"])\r\n                            try:\r\n                                if \"Geometry\" in SODict:\r\n                                    DisplayList = []\r\n                                    for aggregate in SODict[\"Geometry\"]:\r\n                                        DisplayList.append(aggregate)\r\n                                        if aggregate in STG.AssumptionDict:\r\n                                            List = []\r\n                                            for item in STG.AssumptionDict[aggregate]:\r\n                                                List.append(item)\r\n                                            self.AssumptionList.DataStore = List\r\n                                            self.removeAssumptionButton.Enabled = True\r\n                                    self.SO_Geometry.DataStore = DisplayList\r\n                                else:\r\n                                    self.SO_Geometry.DataStore = []\r\n                            except: print \"error setting geometry\"\r\n                            try:\r\n                                if \"Relationship\" in SODict:\r\n                                    index = self.RelationshipStore.index(SODict[\"Relationship\"])\r\n                                    self.SORelationBox.SelectedIndex = index\r\n                                else:\r\n                                    self.SORelationBox.SelectedIndex = 0\r\n                                    \r\n                                if \"SOfromSO\" in SODict:\r\n                                    PreventChanging = SODict[\"SOfromSO\"]\r\n                                    STG.setSOfromSODataStore(self, 0,0)\r\n                                    SODict[\"SOfromSO\"]=PreventChanging\r\n                                    index = self.SOfromSODropDown.DataStore.index(SODict[\"SOfromSO\"])\r\n                                    self.SOfromSODropDown.SelectedIndex = index\r\n                                    SODict[\"SOfromSO\"] = PreventChanging\r\n                                else:\r\n                                    self.SOfromSODropDown.SelectedIndex = 0\r\n                            except: print \"error setting 'subobject from subobject'\"\r\n        try:\r\n            if len(self.SO_Geometry.DataStore)>0:\r\n                STG.createAssumption.Enabled = True\r\n                STG.OcclusionButton.Enabled = True\r\n                STG.remove_Objects.Enabled = True\r\n                self.AssumptionList.DataStore = []\r\n            else:\r\n                STG.createAssumption.Enabled = False\r\n                STG.OcclusionButton.Enabled = False\r\n                self.AssumptionList.DataStore = []\r\n                STG.remove_Objects.Enabled = False\r\n            \r\n            #blocking adaptations for \"self\"\r\n            if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] == \"self\":\r\n                self.SONameBox.Enabled = False\r\n                self.SOTypeBox.SelectedIndex = self.DropDown_type.SelectedIndex\r\n                self.SOTypeBox.Enabled = False\r\n                self.SOfromSODropDown.Enabled = False\r\n                self.SORelationBox.Enabled = False\r\n                geom_str = []\r\n                for geom in rs.ObjectsByLayer(Layer):\r\n                    if rs.ObjectType(geom) != 2:\r\n                        geom_str.append(str(geom))                \r\n                ObjectDict[\"Geometry\"]= geom_str\r\n                self.SO_Geometry.DataStore = geom_str\r\n                self.SO_Geometry.Enabled = True\r\n                STG.select_Objects.Enabled = False\r\n                self.SOfromSODropDown.Visible = False\r\n                self.SORelationBox.Visible = False\r\n                self.SORelationship.Visible = False\r\n                self.SOfromSOLabel.Visible = False\r\n                STG.remove_Objects.Enabled = False\r\n                \r\n            else:\r\n                self.SO_Geometry.Enabled = True\r\n                self.SONameBox.Enabled = True\r\n                self.SOTypeBox.Enabled = True\r\n                self.SOfromSODropDown.Enabled = True\r\n                STG.select_Objects.Enabled = True\r\n                self.SORelationBox.Enabled = True\r\n                self.SOfromSODropDown.Visible = True\r\n                self.SORelationBox.Visible = True\r\n                self.SORelationship.Visible = True\r\n                self.SOfromSOLabel.Visible = True\r\n        except: print 'enabling/disabling buttons failed'\r\n            \r\n    #when the SubObject textbox looses focus, the list needs to be refreshed in case of namechanges\r\n    def refreshSOList(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if \"SOfromSO\" in SODict:\r\n                            if SODict[\"SOfromSO\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                                SODict[\"SOfromSO\"] = self.SONameBox.Text\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            SODict[\"Name\"] = self.SONameBox.Text\r\n                \r\n        STG.SOList[self.SubObjectListBox.SelectedIndex] = self.SONameBox.Text\r\n        self.SubObjectListBox.DataStore = STG.SOList\r\n        STG.setSOfromSODataStore(self, 0,0)\r\n        \r\n    #when the SubObject TypeBox changes item, this is saved to the Subobject information\r\n    def SOTypeboxChanges(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            SODict[\"Type\"] = self.SOTypeBox.DataStore[self.SOTypeBox.SelectedIndex]\r\n    \r\n    #when the SubObject-Object RelationShip (bot:hostsElement/product:aggregates) changes, this is saved to the Subobject information\r\n    def SORelationChanges(self,sender,e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            SODict[\"Relationship\"] = self.SORelationBox.DataStore[self.SORelationBox.SelectedIndex]\r\n\r\n    #when the \"construct new\" button is pressed, a new subobject with a generic name 'undefined_aggregate' is constructed'\r\n    def addAggregate(self,sender,e):\r\n        unknown_aggregates = [0]\r\n        for item in STG.SOList:\r\n            if \"undefined_aggregate_\" in item:\r\n                itemsplit = item.split('_')\r\n                itemnumber = itemsplit[-1]\r\n                unknown_aggregates.append(itemnumber)\r\n        unknown_aggregates = sorted(unknown_aggregates)\r\n        last = str(int(unknown_aggregates[-1])+1)\r\n        newSO = str(\"undefined_aggregate\"+'_'+str(last))\r\n        STG.SOList.append(newSO)\r\n        \r\n        Object = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Object):\r\n                newSODict = {}\r\n                newSODict[\"Name\"] = newSO\r\n                newSODict[\"Type\"] = STG.ProductTypes[0]\r\n                newSODict[\"Relationship\"] = self.RelationshipStore[0]\r\n                \r\n                if \"Aggregates\" in ObjectDict:\r\n                    already_present = list(ObjectDict[\"Aggregates\"])\r\n                    already_present.append(newSODict)\r\n                    ObjectDict[\"Aggregates\"] = tuple(already_present)\r\n                else:\r\n                    ObjectDict[\"Aggregates\"] = (newSODict,)\r\n        self.SubObjectListBox.DataStore = STG.SOList\r\n        \r\n        #buttons are only enabled if they can work, to avoid a program crash\r\n        if len(self.SO_Geometry.DataStore)>0:\r\n            STG.createAssumption.Enabled = True\r\n            STG.OcclusionButton.Enabled = True\r\n            STG.remove_Objects.Enabled = True\r\n        else:\r\n            STG.remove_Objects.Enabled = False\r\n        \r\n        #you cannot change the name, type, relationship or 'subobject-from-subobject' from the 'self' object => this needs to be done at main object level\r\n        if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] == \"self\":\r\n            self.SONameBox.Enabled = False\r\n            self.SOTypeBox.SelectedIndex = self.DropDown_type.SelectedIndex\r\n            self.SOTypeBox.Enabled = False\r\n            self.SOfromSODropDown.Enabled = False\r\n            self.SORelationBox.Enabled = False\r\n            self.SO_Geometry.Enabled = True\r\n            STG.select_Objects.Enabled = False\r\n            self.SOfromSODropDown.Visible = False\r\n            self.SORelationBox.Visible = False\r\n            self.SORelationship.Visible = False\r\n            self.SOfromSOLabel.Visible = False\r\n            STG.remove_Objects.Enabled = False\r\n            \r\n        else:\r\n            self.SO_Geometry.Enabled = True\r\n            self.SONameBox.Enabled = True\r\n            self.SOTypeBox.Enabled = True\r\n            self.SOfromSODropDown.Enabled = True\r\n            STG.select_Objects.Enabled = True\r\n            self.SORelationBox.Enabled = True\r\n            self.SOfromSODropDown.Visible = True\r\n            self.SORelationBox.Visible = True\r\n            self.SORelationship.Visible = True\r\n            self.SOfromSOLabel.Visible = True\r\n        \r\n    #when the \"delete\" button is pressed, the aggregate is removed from the file\r\n    def DeleteAggregate(self, sender, e):\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if \"Aggregates\" in ObjectDict:\r\n                    for SODict in ObjectDict[\"Aggregates\"]:\r\n                        if SODict[\"Name\"] == self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex]:\r\n                            if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] != \"self\":\r\n                                if \"Aggregates\" in ObjectDict:\r\n                                    already_present = list(ObjectDict[\"Aggregates\"])\r\n                                    already_present.remove(SODict)\r\n                                    ObjectDict[\"Aggregates\"] = tuple(already_present)\r\n        \r\n        if self.SubObjectListBox.DataStore[self.SubObjectListBox.SelectedIndex] != \"self\":\r\n            del STG.SOList[self.SubObjectListBox.SelectedIndex]\r\n            self.SubObjectListBox.DataStore = STG.SOList\r\n        else: print \"'self' cannot be deleted\"\r\n                        \r\n    #when the Object DropDown opens, the list with layers should be refreshed and the SubObject aggregates saved to the basic dictionary\r\n    def renewList(self,sender,e):\r\n        NewLayers = rs.LayerNames(sort = True)\r\n        NewLayers.remove(\"Default\")\r\n        NewLayerIds = rs.LayerIds()\r\n        NewLayerIds_str = []\r\n        for fullid in NewLayerIds: \r\n            NewLayerIds_str.append(str(fullid))\r\n        STG.ObjectDropDown.DataStore = NewLayers\r\n        Layer = STG.ObjectDropDown.DataStore[STG.ObjectDropDown.SelectedIndex]\r\n        for ObjectDict in STG.InformationList:\r\n            if ObjectDict[\"Identifier\"] not in NewLayerIds_str:\r\n                STG.InformationList.remove(ObjectDict)\r\n            if ObjectDict[\"Identifier\"]==rs.LayerId(Layer):\r\n                if ObjectDict[\"Name\"] != Layer:\r\n                    ObjectDict[\"Name\"] = Layer\r\n\r\n#main class for the Point Cloud import Tab\r\nclass ImportPointCloud(forms.Panel):\r\n    #main layout\r\n    def __init__(self):\r\n        self.folderLayout = forms.DynamicLayout()\r\n        self.folder_label = forms.Label(Text = \"Locate folder with .e57-files\")\r\n        self.folder_textbox = forms.TextBox(Width = 360, Text = None)\r\n        self.folderButton = forms.Button(Width = 20, Text = \"...\")\r\n        self.folderButton.Click += self.OnFolderButtonClick\r\n        self.folderLayout.AddRow(None,self.folder_label,None,None)\r\n        self.folderLayout.AddRow(None,self.folder_textbox, self.folderButton,None)\r\n        \r\n        self.InfoLabel = forms.Label(Text = \"Octree Subdivision\")\r\n        \r\n        global SampleOptions\r\n        SampleOptions = [\"OCTREE\",\"SPATIAL\",\"RANDOM\"]\r\n        self.SampleOption_Dropdown = forms.DropDown(DataStore = SampleOptions, SelectedIndex = 0)\r\n        self.SampleOption_Dropdown.SelectedValueChanged += self.SetNumericOptions\r\n        self.Numeric_updown = forms.NumericUpDown(DecimalPlaces = 0, Increment = 1, MaxValue = 21, MinValue = 1, Value = 10)\r\n        self.Execute_Button = forms.Button(Text = \"Execute\", Enabled = False)\r\n        self.Execute_Button.Click += self.subsampler\r\n        \r\n        \r\n        self.OptionGroupBox=forms.GroupBox(Text = \"SubSampling Options\",Visible = False)\r\n        self.OptionGroupBox.Padding = drawing.Padding(10)\r\n        \r\n        self.OptionLayout = forms.DynamicLayout()        \r\n        self.OptionLayout.Spacing = drawing.Size(5,5)\r\n        self.OptionLayout.BeginVertical()\r\n        self.OptionLayout.AddRow(self.SampleOption_Dropdown, None, self.Numeric_updown, None, self.InfoLabel)\r\n        self.OptionLayout.AddRow(\"\")\r\n        self.OptionLayout.EndVertical()\r\n        self.OptionGroupBox.Content = self.OptionLayout\r\n        \r\n        self.EnableSubSampling = forms.CheckBox(Text = \"Enable Subsampling\", Checked = False)\r\n        self.EnableSubSampling.CheckedChanged += self.enableSubSampling\r\n        \r\n        #layout that groups different layouts together in the window\r\n        self.finalLayout = forms.DynamicLayout()\r\n        self.finalLayout.Spacing = drawing.Size(15,15)\r\n        self.finalLayout.BeginVertical()\r\n        self.finalLayout.AddRow(' ')\r\n        self.finalLayout.AddRow(self.folderLayout)\r\n        self.finalLayout.AddRow(self.EnableSubSampling)\r\n        self.finalLayout.AddRow(self.OptionGroupBox)\r\n        self.finalLayout.EndVertical()\r\n        self.finalLayout.BeginVertical()\r\n        self.finalLayout.AddRow(None,None,None,self.Execute_Button)\r\n        self.finalLayout.AddRow(\"\")\r\n        self.finalLayout.EndVertical()\r\n        self.finalLayout.Padding = drawing.Padding(10)\r\n        self.Content = self.finalLayout\r\n    \r\n    #when the subsampling checkbox is checked/unchecked, the subsampling options are made visible/invisible\r\n    def enableSubSampling(self,sender,e):\r\n        if self.EnableSubSampling.Checked == False:\r\n            self.OptionGroupBox.Visible = False\r\n        else:\r\n            self.OptionGroupBox.Visible = True\r\n    \r\n    #the numeric options for the subsampling process depend on the method used\r\n    def SetNumericOptions(self, sender, e):\r\n        #OCTREE\r\n        if self.SampleOption_Dropdown.SelectedIndex == 0:\r\n            \r\n            self.Numeric_updown.DecimalPlaces = 0\r\n            self.Numeric_updown.Increment = 1\r\n            self.Numeric_updown.MaxValue = 21\r\n            self.Numeric_updown.MinValue = 1\r\n            self.Numeric_updown.Value = 10\r\n            self.InfoLabel.Text = \"(Octree Subdivision)\"\r\n         \r\n        #SPATIAL\r\n        if self.SampleOption_Dropdown.SelectedIndex == 1:\r\n            \r\n            self.Numeric_updown.DecimalPlaces = 3\r\n            self.Numeric_updown.Increment = 0.01\r\n            self.Numeric_updown.MaxValue = 1\r\n            self.Numeric_updown.MinValue = 0\r\n            self.Numeric_updown.Value = 0.05\r\n            self.InfoLabel.Text = \"(step in m)\"\r\n            \r\n        #RANDOM\r\n        if self.SampleOption_Dropdown.SelectedIndex == 2:\r\n            \r\n            self.Numeric_updown.DecimalPlaces = 0\r\n            self.Numeric_updown.Increment = 50000\r\n            self.Numeric_updown.MaxValue = 2000000\r\n            self.Numeric_updown.MinValue = 1\r\n            self.Numeric_updown.Value = 200000\r\n            self.InfoLabel.Text = \"(Remaining points)\"\r\n    \r\n    #select the FOLDER where the point clouds (.e57) are located\r\n    def OnFolderButtonClick(self, sender, e):\r\n        Folder  = forms.SelectFolderDialog()\r\n        if Folder.ShowDialog(None) == forms.DialogResult.Cancel:\r\n            return\r\n        if Folder:\r\n            self.folder_textbox.Text = Folder.Directory\r\n        if os.path.isdir(self.folder_textbox.Text) == True:\r\n            self.Execute_Button.Enabled = True\r\n    \r\n    #Subsampling process. Make sure that the folder contains no other folders and files, only the pointclouds that need to be subsampled should be present\r\n    #otherwise, not all point clouds may be subsampled/imported (a future version may fix this)\r\n    #the subsampling is outsourced to CloudCompare Stereo, which needs to be located at the default folder of C:\\Program Files\\CloudCompareStereo\\CloudCompare.exe\r\n    #or the folder needs to be changed below in the code\r\n    def subsampler(self,sender,e):\r\n        \r\n        path = self.folder_textbox.Text\r\n        option = SampleOptions[self.SampleOption_Dropdown.SelectedIndex]\r\n        optionvalue = self.Numeric_updown.Value\r\n        if self.SampleOption_Dropdown.SelectedIndex ==0:\r\n            optionvalue = int(self.Numeric_updown.Value)\r\n        \r\n        files = listdir(path)\r\n        \r\n        files_in_folder = []\r\n        files_extended = []\r\n        for file in files:\r\n            fullpath = str(path+r\"\\\\\"+file)\r\n            #fullpath_raw = fullpath.encode('string-escape')\r\n            if fnmatch.fnmatch(file, '*.e57'):\r\n                files_in_folder.append(fullpath)\r\n                \r\n        if self.EnableSubSampling.Checked == True:\r\n            for file in files_in_folder:\r\n                cloudcompare_command = str(r'-C_EXPORT_FMT E57 -O' + ' ' + '\"' + file + '\"' + ' ' + r\"-SS\" + \" \" + option + \" \" + str(int(optionvalue)))\r\n                \r\n                passedstring = str('\"' + cloudcompare_path + '\"' + ' ' + cloudcompare_command)\r\n                print passedstring\r\n                command = subprocess.Popen(passedstring)\r\n                files_extended = listdir(path)\r\n            \r\n            #timeout = time.time() + 3*len(files_in_folder)\r\n            while (len(files_extended) < 2*len(files_in_folder)+1):\r\n                files_extended = listdir(path)\r\n                files_without_folders = []\r\n                for file in files_extended:\r\n                    if fnmatch.fnmatch(file, '*.e57'):\r\n                        files_without_folders.append(fullpath)\r\n                files_extended = files_without_folders\r\n                files_extended.append(\"dummy\")\r\n                #if time.time() > timeout: break\r\n                \r\n            \r\n            files_extended = listdir(path)\r\n            \r\n            newfolder = str(path + r'\\\\'+ \"subsampled\"+\"_\"+strftime(\"%Y-%m-%d_%Hh%M\", gmtime()))\r\n            if os.path.isdir(newfolder) == False:\r\n                os.mkdir(newfolder)\r\n            else: pass\r\n            \r\n            finalfolders = []\r\n            for file in files_extended:\r\n                if file not in files:\r\n                    try:\r\n                        shutil.move(str(path + r\"\\\\\" + file), str(newfolder + r\"\\\\\" + file))\r\n                    except:\r\n                        sleep(4)\r\n                        shutil.move(str(path + r\"\\\\\" + file), str(newfolder + r\"\\\\\" + file))\r\n                    finaldir = str(newfolder + r\"\\\\\" + file)\r\n                    finalfolders.append((finaldir,file))\r\n             \r\n            for finaldir,file in finalfolders:\r\n                FileName = finaldir\r\n                file = str(file)\r\n                LayerName_list = file.split(\"_\")\r\n                LayerName = ''\r\n                for part in LayerName_list[:2]:\r\n                        LayerName += part\r\n                        LayerName +='_'\r\n                LayerName = LayerName[:-1]\r\n                command = ('! _Import '+'\"'+FileName+'\"'+' SelLast Move 0 @-'+Project_Info.Xcoord.Text+',-'+Project_Info.Ycoord.Text+' SelLast _-ChangeLayer n ' + LayerName + ' -Layer f ' + LayerName + ' _Enter')\r\n                rs.Command(command)\r\n                \r\n        else:\r\n            for filepath in files_in_folder:\r\n                FileName = filepath\r\n                print FileName\r\n                LayerName_list = FileName.split(r\"\\\\\")\r\n                LayerName_ext = LayerName_list[-1]\r\n                LayerName_ext = LayerName_ext.split(\".\")\r\n                LayerName = LayerName_ext[0]\r\n                #command = ('! _Import '+'\"'+FileName+'\"'+' SelLast Move 0 @-104500,-194300 SelLast _-ChangeLayer n ' + LayerName + ' -Layer f ' + LayerName + ' _Enter')\r\n                command = ('! _Import '+'\"'+FileName+'\"'+' SelLast Move 0 @-'+Project_Info.Xcoord.Text+',-'+Project_Info.Ycoord.Text+' SelLast _-ChangeLayer n ' + LayerName + ' -Layer f ' + LayerName + ' _Enter')\r\n                rs.Command(command)\r\n\r\n#main class for the SPARQL query tab\r\nclass SPARQL(forms.Panel):\r\n    def __init__(self):\r\n        self.stardogLabel = forms.Label(Text = \"Name of the stardog database corresponding with this file: \")\r\n        SPARQL.stardogGraph = forms.TextBox(Text = \"\")\r\n        \r\n        SPARQL.QueryField = forms.TextArea(Text = \"SELECT ?ID ?s WHERE {?s stg:hasRhinoID ?ID}\", Height = 250)\r\n        \r\n        self.QueryLabel = forms.Label(Text = \"SPARQL SELECT Query\")\r\n        self.StardogWarning = forms.Label(Text = \"(Make sure a Stardog Server is Running!)\")\r\n        self.ReasoningButton = forms.CheckBox(Text = \"Enable Reasoning\",Checked = True)\r\n        SPARQL.QueryButton = forms.Button(Text = \"Query\")\r\n        SPARQL.QueryButton.Click +=self.Query\r\n        \r\n        self.ClearButton = forms.Button(Text = 'Clear display')\r\n        self.ClearButton.Click += self.ClearObjectDisplayModes\r\n        \r\n        self.resultLabel = forms.Label(Text = \"Query results\")\r\n        SPARQL.results = forms.GridView()\r\n        SPARQL.results.Height = 250\r\n        SPARQL.results.SelectedRowsChanged += self.SelectObject\r\n        \r\n        # create the main tablayout\r\n        qTabLayout = forms.DynamicLayout()\r\n        qTabLayout.DefaultSpacing = drawing.Size(5, 5)\r\n        qTabLayout.Padding = drawing.Padding(10)\r\n        qTabLayout.BeginVertical()\r\n        qTabLayout.AddRow(self.stardogLabel,SPARQL.stardogGraph)\r\n        qTabLayout.EndVertical()\r\n        qTabLayout.BeginVertical()\r\n        qTabLayout.AddRow(self.QueryLabel)\r\n        qTabLayout.AddRow(SPARQL.QueryField)\r\n        qTabLayout.EndVertical()\r\n        qTabLayout.BeginVertical()\r\n        qTabLayout.AddRow(self.StardogWarning, None, SPARQL.QueryButton, self.ReasoningButton)\r\n        qTabLayout.AddRow(\" \")\r\n        qTabLayout.EndVertical()\r\n        qTabLayout.BeginVertical()\r\n        qTabLayout.AddRow(self.resultLabel)\r\n        qTabLayout.AddRow(SPARQL.results)\r\n        qTabLayout.EndVertical()\r\n        qTabLayout.BeginVertical()\r\n        qTabLayout.AddRow(\" \")\r\n        qTabLayout.AddRow(None,None,None,self.ClearButton)\r\n        qTabLayout.EndVertical()\r\n        qTabLayout.AddRow(\" \")\r\n        self.Content = qTabLayout\r\n        \r\n    #selects possible geometrical results from a SPARQL query in the viewer\r\n    def SelectObject(self,sender,e):\r\n        Rhino.RhinoApp.RunScript(\"_SelNone\", False)\r\n        row = SPARQL.results.DataStore[SPARQL.results.SelectedRow]\r\n        AllObjects = rs.AllObjects()\r\n        AllObjects_str = []\r\n        for item in AllObjects:\r\n            AllObjects_str.append(str(item))\r\n        for item in row:\r\n            if item in AllObjects_str:\r\n                rs.SelectObject(item)\r\n        \r\n    #brings the display back to default mode - if elements were set to 'rendered' because of the SPARQL query\r\n    def ClearObjectDisplayModes(self,sender,e):\r\n        CMD = str('_ClearAllObjectDisplayModes a')\r\n        rs.Command(CMD,True)\r\n        \r\n    #grid that adapts to the amount of variables from the SPARQL query\r\n    global SPARQLgrid\r\n    def SPARQLgrid(n,URIdict):\r\n        try:\r\n            for pr,uri in URIdict.iteritems():\r\n                for row in n:\r\n                    rowindex = n.index(row)\r\n                    for item in row:\r\n                        itemindex = row.index(item)\r\n                        if uri in item:\r\n                            item = item.replace(str(uri),\"\")\r\n                            prefixed = str(pr+\":\"+item)\r\n                            n[rowindex][itemindex]= prefixed\r\n        except: print 'could not replace all namespaces correctly'\r\n                            \r\n        try:\r\n            Vars = n[0]\r\n            SPARQL.results.Columns.Clear()\r\n            for var in Vars:\r\n                index = Vars.index(var)\r\n                column = forms.GridColumn(AutoSize = True)\r\n                column.HeaderText = var\r\n                column.DataCell = forms.TextBoxCell(index)\r\n                SPARQL.results.Columns.Add(column)\r\n        except: print 'error'\r\n        try:\r\n            for row in n:\r\n                rowindex = n.index(row)\r\n                newrow = []\r\n                for item in row:\r\n                    newrow.append(item)\r\n                if len(row)<len(Vars):\r\n                    diff = len(Vars)-len(row)\r\n                    for i in range(diff):\r\n                        newrow.append(' ')\r\n                n[rowindex] = newrow\r\n                \r\n            SPARQL.results.DataStore = tuple(n[1:])\r\n        except: print 'error'\r\n        \r\n        Objects_query = []\r\n        AllObjects = rs.AllObjects()\r\n        AllObjects_str = []\r\n        for item in AllObjects:\r\n            AllObjects_str.append(str(item))\r\n        try:\r\n            for row in SPARQL.results.DataStore:\r\n                for item in row:\r\n                    if item in AllObjects_str:\r\n                        Objects_query.append(item)\r\n        except: print 'error'\r\n        if len(Objects_query)>=1:\r\n            rs.ViewDisplayMode(mode='Wireframe')\r\n            CMD = str('_ClearAllObjectDisplayModes a')\r\n            rs.Command(CMD,True)\r\n            \r\n            rs.SelectObjects(Objects_query)\r\n            ObjectDM = str(\"_SetObjectDisplayMode m r\")\r\n            rs.Command(ObjectDM,True)\r\n        \r\n    #queries the graph with stardog => a Stardog Database with the corresponding graph should be running\r\n    def Query(self, sender, e):\r\n        query = repr(SPARQL.QueryField.Text).replace(r'\\r\\n','')\r\n        query_upper = query.upper()\r\n        split_query_to_retrieve_variables=query_upper.split('WHERE')\r\n        firstPartOfQuery=split_query_to_retrieve_variables[0].split(' ')\r\n        SPARQLvariables=[]\r\n        for item in firstPartOfQuery:\r\n            if len(item)>0:\r\n                if item[0]=='?':\r\n                    item=item[1:]\r\n                    SPARQLvariables.append(item)\r\n        reasoning = '--reasoning '\r\n        if self.ReasoningButton.Checked == False:\r\n            reasoning = ' '\r\n        CMDcommand = str(\"stardog.bat query \"+reasoning+str(SPARQL.stardogGraph.Text)+' \"'+query+'\" -f CSV')\r\n        SeparateList = []\r\n        URIdict = {}\r\n        try:\r\n            p=subprocess.check_output(CMDcommand)\r\n            n = p.splitlines()\r\n            for item in n:\r\n                item = item.split(',')\r\n                SeparateList.append(item)\r\n                \r\n            CMD_get_namespaces = str(\"stardog.bat namespace export \"+str(SPARQL.stardogGraph.Text))\r\n        \r\n            prefix=subprocess.check_output(CMD_get_namespaces)\r\n            prefix=prefix.splitlines()\r\n            for item in prefix:\r\n                if 'stardog' in item:\r\n                    pass\r\n                else:\r\n                    item=item.split(\"<\")\r\n                    URI=item[-1].split(\">\")\r\n                    URI=URI[0]\r\n                    pr = item[0].split(\":\")\r\n                    pr = pr[0].split(\" \")\r\n                    pr = pr[-1]\r\n            \r\n                    URIdict[pr]=URI\r\n        except: print 'an error occured, please check Query and Stardog configurations (if necessary, perform query in Stardog Web Console or the command line)'\r\n        SPARQLgrid(SeparateList,URIdict)\r\n        \r\n        \r\n        \r\n        \r\n#the overall layout of the plugin, which groups the tabs\r\nclass WidgetLayout(forms.Form):\r\n    def __init__(self):\r\n        self.Title = 'GeometryGraph'\r\n        self.Padding = drawing.Padding(5)\r\n        self.Resizable = True\r\n        self.Maximizable = False\r\n        self.Minimizable = False\r\n        self.ShowInTaskbar = False\r\n        widget_width = 640\r\n        widget_height = 960\r\n        self.MinimumSize = drawing.Size(widget_width, widget_height)\r\n        \r\n        #layout for specifying the location of the Graph\r\n        self.folderLayout = forms.DynamicLayout()\r\n        self.graph_label = forms.Label(Text = \"   Project Name (C-disk):   \")\r\n        self.graph_textbox = forms.TextBox(Width = 350, Text = None)\r\n        \r\n        self.URI_label = forms.Label(Text = \"   Global URI:   \")\r\n        self.URI_textbox = forms.TextBox(Width = 350, Text = None)\r\n        \r\n        self.folderButton = forms.Button(Text = \"...\")\r\n        self.folderButton.Click += self.OnFolderButtonClick\r\n        \r\n        self.SerializeButton = forms.Button(Text = \"Serialize\",Enabled = False, Width = 120)\r\n        self.SerializeButton.Click += self.Serialize\r\n        self.SaveDictButton = forms.Button(Text = \"Save as TXT\",Enabled = False, Width = 120)\r\n        self.SaveDictButton.Click += self.SaveDict\r\n        \r\n        self.folderLayout.AddRow(\" \")\r\n        self.folderLayout.AddRow(self.graph_label,self.graph_textbox, self.folderButton,\"    \")\r\n        self.folderLayout.AddRow(self.URI_label,self.URI_textbox, self.SerializeButton,\"    \")\r\n        self.folderLayout.AddRow(\" \",\" \", self.SaveDictButton,\"    \")\r\n        \r\n        #layout for tabs\r\n        self.TabControl = self.MainTabs()\r\n        tab_items = forms.StackLayoutItem(self.TabControl, True)\r\n        self.tabLayout = forms.StackLayout()\r\n        self.tabLayout.Spacing = 5\r\n        self.tabLayout.HorizontalContentAlignment = forms.HorizontalAlignment.Stretch\r\n        self.tabLayout.Items.Add(tab_items)\r\n        \r\n        #layout that groups different layouts together in the window\r\n        self.finalLayout = forms.DynamicLayout()\r\n        self.finalLayout.Spacing = drawing.Size(15,15)\r\n        self.finalLayout.BeginVertical()\r\n        self.finalLayout.AddRow(self.folderLayout)\r\n        self.finalLayout.EndVertical()\r\n        self.finalLayout.BeginVertical()\r\n        self.finalLayout.AddRow(self.tabLayout)\r\n        self.finalLayout.EndVertical()\r\n        self.Content = self.finalLayout\r\n        \r\n        # FormClosed event handler\r\n        self.Closed += self.OnFormClosed\r\n    \r\n    #an internal save of the plugin's dictionaries\r\n    #all information is saved to a .txt file and can be retrieved directly when opening this file later\r\n    def SaveDict(self,sender,e):\r\n        GlobalURI = self.URI_textbox.Text\r\n        FileName = self.graph_textbox.Text\r\n        FileName = FileName.split(\".\")\r\n        FileName = FileName[0]\r\n        AllInfo = str(str(FileName)+'\\n'+str(Project_Info.ProjectInfo)+'\\n'+str(Project_Info.TopoDict)+'\\n'+str(STG.InformationList)+'\\n'+str(STG.AssumptionDict)+'\\n'+str(GlobalURI))\r\n        TXTfile = str(FileName+\".txt\")\r\n        try:\r\n            with open(TXTfile, 'w') as text_save:\r\n                text_save.write(AllInfo)\r\n            print 'save successful'\r\n        except: 'save failed - please check input'\r\n    \r\n    #when the serialize button is pressed, the RDF graph is created by an external Python 2.7 script (IronPython does not fully support rdflib, the module that is used for this proces)\r\n    #if the export STEP checkbox at the Project Info tab is checked, the graph will include STEP geometry\r\n    def Serialize(self, sender, e):\r\n        OpenDialog = self.graph_textbox.Text\r\n        GlobalURI = self.URI_textbox.Text\r\n        for Object in STG.InformationList:\r\n            IDsInObject = rs.ObjectsByLayer(Object[\"Name\"])\r\n        pythonfile = str(ProjectFolder + r'\\\\' + \"Dict-to-Graph.py\")\r\n        if Project_Info.ExportSTP.Checked == True:\r\n            ext = OpenDialog.split('.')\r\n            filePath = ext[0]\r\n            filePath += str(r\"\\\\GEOM\\\\\")\r\n            if not os.path.exists(filePath):\r\n                os.makedirs(filePath)\r\n            settingsList = {'GetSTPSettings': GetSTPSettings}\r\n            initExport(filePath, settingsList,\"stp\")\r\n        try:\r\n            OpenDialog = OpenDialog.split('.')\r\n            OpenDialog = OpenDialog[0]\r\n            OpenDialog += \".ttl\"\r\n            \r\n            arg1 = repr(OpenDialog)\r\n        except: print \"Please check Project Folder\"\r\n        try:\r\n            arg2 = str(Project_Info.ProjectInfo)\r\n        except: print \"Please check Project Info\"\r\n        try:\r\n            arg3 = str(Project_Info.TopoDict)\r\n        except: print \"Please check Project Topology\"\r\n        try:\r\n            arg4 = str(STG.InformationList)\r\n        except: print \"Please check if there are objects (layers)\"\r\n        try:\r\n            arg5 = str(STG.AssumptionDict)\r\n        except: print 'Assumption error'\r\n        try:\r\n            arg6 = GlobalURI\r\n        except: print \"Please enter global URI\"\r\n        try:\r\n            arg7 = rs.DocumentName()\r\n        except: print \"Rhinodocument needs to have a name\"\r\n        try:\r\n            passedstring=str('\"'+pythonversion+'\" \"'+pythonfile+'\" \"'+arg1+'\" \"'+arg2+'\" \"'+arg3+'\" \"'+arg4+'\" \"'+arg5+'\" \"'+arg6+'\" \"'+arg7+'\"')\r\n            print passedstring\r\n            g=subprocess.check_output(passedstring)\r\n        except: print 'serializing error'\r\n    \r\n    #this button states either the name of a new graph, in the selected folder, or loads an existing graph made by the plugin. TXT files (SaveDict function) can also be read.\r\n    #note that, when the name is not changed after loading the graph, the graph will be overwritten\r\n    #check the correct extension: when a .txt file is loaded, the extension needs to be changed to .ttl in order to be serialized to a Turtle file\r\n    def OnFolderButtonClick(self, sender, e):\r\n        New_ID_Dict = {}\r\n        global OpenDialog\r\n        OpenDialog  = rs.OpenFileName(\"Choose graph\", \"Turtle files or TXT-dictionaries (*.ttl; *.txt)|*.ttl;*.txt||\")\r\n        if OpenDialog:\r\n            self.graph_textbox.Text = OpenDialog\r\n            if os.path.exists(OpenDialog):\r\n                SPARQL.QueryButton.Enabled = True\r\n                pythonfile = pythonfile = str(ProjectFolder + r'\\\\' + \"load_graph.py\")\r\n                STEPpythonfile = str(ProjectFolder + r'\\\\' + \"STEPreconstruct.py\")\r\n                passedstring = str(pythonversion + ' \"' + pythonfile + '\" \"' + OpenDialog+'\"')\r\n                STEPstring = str(pythonversion + ' \"' + STEPpythonfile + '\" \"' + OpenDialog + '\"')\r\n                extension = OpenDialog.split(\".\")\r\n                extension = extension[-1]\r\n                if extension == \"ttl\":\r\n                    try:\r\n                        loadDicts = subprocess.check_output(passedstring)\r\n                        loadDicts = ast.literal_eval(loadDicts)\r\n                        Project_Info.ProjectInfo = loadDicts[0]\r\n                        Project_Info.TopoDict = loadDicts[1]\r\n                        STG.InformationList = loadDicts[2]\r\n                        STG.AssumptionDict = loadDicts[3]\r\n                    except: print \"subprocess failed\"\r\n                    \r\n                elif extension == \"txt\":\r\n                    try:\r\n                        with open(OpenDialog, 'r') as text_read:\r\n                            content = text_read.readlines()\r\n                            content = [x.strip() for x in content]\r\n                            Project_Info.ProjectInfo = ast.literal_eval(content[1])\r\n                            Project_Info.TopoDict = ast.literal_eval(content[2])\r\n                            STG.InformationList = ast.literal_eval(content[3])\r\n                            STG.AssumptionDict = ast.literal_eval(content[4])\r\n                            try:\r\n                                Global_URI = str(content[5])\r\n                            except:\r\n                                pass\r\n                    except: print \".txt file could not be read\"\r\n                        \r\n                NewLayers = rs.LayerNames(sort = True)\r\n                NewLayers.remove(\"Default\")\r\n                STG.ObjectDropDown.DataStore = NewLayers\r\n                \r\n                try:\r\n                    Project_Info.TextBox_SiteName.Text = str(Project_Info.ProjectInfo[\"SiteName\"])\r\n                    Project_Info.TextBox_BuildingName.Text = str(Project_Info.ProjectInfo[\"BuildingName\"])\r\n                    Project_Info.CoordinateSystem.Text = str(Project_Info.ProjectInfo[\"coordinateSystem\"])\r\n                    Project_Info.Xcoord.Text = Project_Info.ProjectInfo[\"coordinates\"][0]\r\n                    Project_Info.Ycoord.Text = Project_Info.ProjectInfo[\"coordinates\"][1]\r\n                    Project_Info.Zcoord.Text = Project_Info.ProjectInfo[\"coordinates\"][2]\r\n                except: print \"Error while setting Project Info\"\r\n                try:\r\n                    Project_Info.Storeys = []\r\n                    for storey,spaces in Project_Info.TopoDict.iteritems():\r\n                        Project_Info.Storeys.append(storey)\r\n                    Project_Info.StoreyBox.DataStore = Project_Info.Storeys\r\n                    storey = Project_Info.StoreyBox.DataStore[Project_Info.StoreyBox.SelectedIndex]\r\n                    Project_Info.SpaceBox.DataStore = Project_Info.TopoDict[storey]\r\n                except: print \"Error while setting storeys and spaces\"\r\n            StardogSuggestion = repr(OpenDialog)\r\n            StardogSuggestion = StardogSuggestion.split(r\"\\\\\")\r\n            StardogSuggestion = StardogSuggestion[-1]\r\n            StardogSuggestion = StardogSuggestion.split(\".\")\r\n            StardogSuggestion = StardogSuggestion[0]\r\n            SPARQL.stardogGraph.Text = StardogSuggestion\r\n            self.SerializeButton.Enabled = True\r\n            self.SaveDictButton.Enabled = True\r\n            try:\r\n                for ObjectDict in STG.InformationList:\r\n                    ObjectDict[\"Identifier\"] = rs.LayerId(ObjectDict[\"Name\"])\r\n            except: print \"imported objects could not be matched to a layer, make sure you have a correct .3dm file opened\"\r\n            \r\n            AllObjects = rs.AllObjects()\r\n            if Project_Info.ImportSTP.Checked == True:\r\n                if len(AllObjects) == 0 and extension == \"ttl\":\r\n                    try:\r\n                        STEP = subprocess.check_output(STEPstring)\r\n                        STEP = ast.literal_eval(STEP)\r\n                    except: print 'subprocess failed'\r\n                    try:\r\n                        for file in STEP:\r\n                            CMD = str('_import \"'+file+'\"')\r\n                            rs.Command(CMD)\r\n                            old_id = file.split(r\"\\\\\")\r\n                            old_id = old_id[-1].split(\".\")\r\n                            old_id = old_id[0]\r\n                            \r\n                            new_id = rs.LastCreatedObjects()\r\n                            if len(new_id)>1:\r\n                                IDs = []\r\n                                for item in new_id:\r\n                                    IDs.append(item)\r\n                                cmd2 = \"_join \"\r\n                                for item in IDs:\r\n                                    cmd2 += str(item)\r\n                                    cmd2 += \" \"\r\n                                rs.Command(cmd2)\r\n                                new_id = rs.LastCreatedObjects()\r\n                            new_id = new_id[0]\r\n                            if old_id not in New_ID_Dict:\r\n                                New_ID_Dict[old_id] = [str(new_id)]\r\n                            else:\r\n                                New_ID_Dict[old_id].append(str(new_id))\r\n                        for ObjectDict in STG.InformationList:\r\n                            if \"Geometry\" in ObjectDict:\r\n                                for geom in ObjectDict[\"Geometry\"]:\r\n                                    for old, new in New_ID_Dict.iteritems():\r\n                                        if geom == old:\r\n                                            geom = new\r\n                            if \"Aggregates\" in ObjectDict:\r\n                                for SODict in ObjectDict[\"Aggregates\"]:\r\n                                    if \"Geometry\" in SODict:\r\n                                        for geom in SODict[\"Geometry\"]:\r\n                                            for old, new in New_ID_Dict.iteritems():\r\n                                                if geom == old:\r\n                                                    geom = new\r\n                                                    \r\n                        NewLayers = rs.LayerNames(sort = True)\r\n                        NewLayers.remove(\"Default\")\r\n                        STG.ObjectDropDown.DataStore = NewLayers\r\n                    except: print 'fail'\r\n                \r\n            \r\n    #exporting function via mcneel/rhinoscriptsyntax\r\n    #https://github.com/mcneel/rhinoscriptsyntax/blob/master/Scripts/rhinoscript/layer.py\r\n    #Export settings for STP export\r\n    global GetSTPSettings\r\n    def GetSTPSettings():\r\n        e_str = \"_Schema=AP214AutomotiveDesign \"\r\n        e_str+= \"_ExportParameterSpaceCurves=No \"\r\n        e_str+= \"_SplitClosedSurfaces=No \"\r\n        e_str+= \"_LetImportingApplicationSetColorForBlackObjects=Yes \"\"\"\r\n        e_str+= \"_Enter _Enter\"\r\n        return e_str\r\n    #only Polysurfaces and Surfaces are exported to STEP: curves, points and pointclouds, for example, are not included\r\n    global initExport\r\n    def initExport(filePath, settingsList,fileType=\"stp\"):\r\n        #filter out the invalid objects (such as point clouds)\r\n        objs = rs.ObjectsByType(16)\r\n        if len(objs) > 0:\r\n            for obj in objs:\r\n                saveObjectsToFile(str(obj), [obj], fileType, filePath, settingsList)\r\n        objs_srf = rs.ObjectsByType(8)\r\n        if len(objs_srf) > 0:\r\n            for obj in objs_srf:\r\n                saveObjectsToFile(str(obj), [obj], fileType, filePath, settingsList)\r\n    global saveObjectsToFile\r\n    def saveObjectsToFile(name, objs, fileType, filePath, settingsList):\r\n        rs.EnableRedraw(False)\r\n        if len(objs) > 0:\r\n            settings = settingsList[\"Get\"+fileType.upper()+\"Settings\"]()\r\n            rs.UnselectAllObjects()\r\n            for obj in objs:\r\n                rs.SelectObject(obj)\r\n            name = \"\".join(name.split(\" \"))\r\n            command = '-_Export \"{}{}{}\" {}'.format(filePath, name, \".\"+fileType.lower(), settings)\r\n            try:\r\n                rs.Command(command, True)\r\n            except: print command\r\n            rs.EnableRedraw(True)\r\n            \r\n    # Create the tabs: Project Info, Semantic Enrichment tab, Point Cloud import tab and SPARQL query tab\r\n    def MainTabs(self):\r\n        # creates a tab control\r\n        control = self.CreateTabControl()\r\n        \r\n        # create and add a tab for defining Project Info\r\n        WidgetLayout.tab2 = forms.TabPage()\r\n        WidgetLayout.tab2.Text = \"Project Info\"  \r\n        WidgetLayout.tab2.Content = self.TabInfo()\r\n        control.Pages.Add(WidgetLayout.tab2)\r\n        # create and add the tab for Graph Construction\r\n        WidgetLayout.tab3 = forms.TabPage()\r\n        WidgetLayout.tab3.Enabled = True\r\n        WidgetLayout.tab3.Text = \"Semantics\"  \r\n        WidgetLayout.tab3.Content = self.TabSTG()\r\n        control.Pages.Add(WidgetLayout.tab3)\r\n        # create and add the tab for Point Cloud import\r\n        WidgetLayout.tab4 = forms.TabPage()\r\n        WidgetLayout.tab4.Text = \"Point Clouds\"  \r\n        WidgetLayout.tab4.Content = self.TabPC()\r\n        control.Pages.Add(WidgetLayout.tab4)\r\n        # create and add the tab for SPARQL Querying\r\n        tab1 = forms.TabPage()\r\n        tab1.Text = \"Query\"\r\n        tab1.Content = self.SPARQLtab()\r\n        control.Pages.Add(tab1)\r\n        return control\r\n\r\n    # Creates the tab control\r\n    def CreateTabControl(self):\r\n        tab = forms.TabControl()\r\n        # Orient the tabs at the top\r\n        tab.TabPosition = forms.DockPosition.Top\r\n        return tab\r\n\r\n    # Link tab to SPARQL class\r\n    def SPARQLtab(self):\r\n        control = forms.Panel()\r\n        control.Content = SPARQL()\r\n        return control\r\n\r\n    # Link tab to Project_Info class\r\n    def TabInfo(self):\r\n        control = forms.Panel()\r\n        control.Content = Project_Info()\r\n        return control\r\n        \r\n    # Link tab to STG class\r\n    def TabSTG(self):\r\n        control = forms.Panel()\r\n        control.Content = STG()\r\n        return control\r\n    \r\n    #link tab to ImportPointCloud class\r\n    def TabPC(self):\r\n        control = forms.Panel()\r\n        control.Content = ImportPointCloud()\r\n        return control\r\n        \r\n    # Form Closed event handler\r\n    def OnFormClosed(self, sender, e):\r\n        # Dispose of the form and remove it from the sticky dictionary\r\n        if sc.sticky.has_key('sample_modeless_form'):\r\n            form = sc.sticky['sample_modeless_form']\r\n            if form:\r\n                form.Dispose()\r\n                form = None\r\n            sc.sticky.Remove('sample_modeless_form')\r\n    \r\ndef TestWidgetLayout():\r\n    # See if the form is already visible\r\n    if sc.sticky.has_key('sample_modeless_form'):\r\n        return\r\n    \r\n    # Create and show form\r\n    form = WidgetLayout()\r\n    form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\r\n    form.Show()\r\n    # Add the form to the sticky dictionary so it\r\n    # survives when the main function ends.\r\n    sc.sticky['sample_modeless_form'] = form\r\n    \r\nif __name__ == '__main__':\r\n    TestWidgetLayout()",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}