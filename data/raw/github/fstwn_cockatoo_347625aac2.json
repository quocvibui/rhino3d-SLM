{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_RebuildPlanktonMesh.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_RebuildPlanktonMesh.py",
  "instruction": "Rebuilds the input mesh based on a variety of parameters using Plankton.\nTODO: Update docstring\n    Inputs:\n        RebuildNormals: {item, boolean}\n        CullUnusedVertices: {item, boolean}\n       ...",
  "code": "\"\"\"\nRebuilds the input mesh based on a variety of parameters using Plankton.\nTODO: Update docstring\n    Inputs:\n        RebuildNormals: {item, boolean}\n        CullUnusedVertices: {item, boolean}\n        CullDegenerateFaces: {item, boolean}\n        CombineIdentical: {item, boolean}\n        MendMeshHoles: {item, boolean}\n    Output:\n        PMesh: The result as Plankton Mesh {tree, mesh}\n        GHMesh: The result as Grasshopper Mesh {tree, mesh}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200705\n\"\"\"\n\n# PYTHON LIBRARY IMPORTS\nimport clr\nimport os\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# COMPONENT SETTINGS\nghenv.Component.Name = \"RebuildPlanktonMesh\"\nghenv.Component.NickName = \"RPM\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"02 Meshing & Remeshing\"\n\n\n# PLANKTON IMPORT\nif \"Plankton,\" in str(clr.References):\n    import Plankton\nelse:\n    try:\n        if os.name == \"nt\":\n            plankton_path = (os.path.expandvars(\"%userprofile%\") + \n                             \"/AppData/Roaming/\"\n                             \"Grasshopper/Libraries/Plankton.dll\")\n            clr.AddReferenceToFileAndPath(os.path.normpath(plankton_path))\n        elif os.name == \"posix\":\n            plankton_path = (\"/Library/Application Support/McNeel/Rhinoceros/\"\n                             \"6.0/Plug-ins/Grasshopper (b45a29b1-4343-4035-\"\n                             \"989e-044e8580d9cf)/Libraries/Plankton.dll\")\n            clr.AddReferenceToFileAndPath(os.path.normpath(plankton_path))\n        import Plankton\n    except (IOError, ImportError):\n        raise RuntimeError(\"Plankton could not be imported! Please install it.\")\nif \"PlanktonGh,\" in str(clr.References):\n    import PlanktonGh\nelse:\n    try:\n        if os.name == \"nt\":\n            planktongh_path = (os.path.expandvars(\"%userprofile%\") + \n                               \"/AppData/Roaming/\"\n                               \"Grasshopper/Libraries/PlanktonGh.dll\")\n            clr.AddReferenceToFileAndPath(os.path.normpath(planktongh_path))\n        elif os.name == \"posix\":\n            planktongh_path = (\"/Library/Application Support/McNeel/Rhinoceros/\"\n                               \"6.0/Plug-ins/Grasshopper (b45a29b1-4343-4035-\"\n                               \"989e-044e8580d9cf)/Libraries/PlanktonGh.dll\")\n            clr.AddReferenceToFileAndPath(os.path.normpath(planktongh_path))\n        import PlanktonGh\n    except (IOError, ImportError):\n        raise RuntimeError(\"PlanktonGh could not be imported!\"\n                           \"Please install it.\")\n\nclass RebuildPlanktonMesh(component):\n    \n    def rebuild_mesh(self, Mesh, RebuildNormals, CullUnusedVertices, CullDegenerateFaces, CombineIdentical):\n        \"\"\"\n        Rebuilds a mesh based on certain input parameters.\n        \"\"\"\n        \n        # rebuild normals if requested\n        if Mesh and RebuildNormals:\n            res = Mesh.Normals.ComputeNormals()\n        \n        # cull unused vertices from input mesh\n        if Mesh and CullUnusedVertices:\n            res = Mesh.Vertices.CullUnused()\n        \n        # cull duplicate faces\n        if Mesh and CullDegenerateFaces:\n            res = Mesh.Faces.ExtractDuplicateFaces()\n            res = Mesh.Faces.CullDegenerateFaces()\n        \n        # combine identical vertices\n        if Mesh and CombineIdentical:\n            res = Mesh.Vertices.CombineIdentical(False, True)\n        \n        return Mesh\n    \n    def RunScript(self, Mesh, RebuildNormals, CullUnusedVertices, CullDegenerateFaces, CombineIdentical, MendMeshHoles):\n        \n        PMesh = Grasshopper.DataTree[object]()\n        GHMesh = Grasshopper.DataTree[object]()\n        \n        if Mesh and Mesh.DataCount and list(Mesh.AllData()) != [None]:\n            for i, branch in enumerate(list(Mesh.Branches)):\n                for j, item in enumerate(list(branch)):\n                    inputMesh = item\n                    \n                    if str(type(inputMesh)) == \"<type 'PlanktonMesh'>\":\n                        inputMesh = PlanktonGh.RhinoSupport.ToRhinoMesh(inputMesh)\n            \n                    # get mesh vertexlist from mesh\n                    MVL = inputMesh.Vertices\n                    \n                    # rebuild the mesh according to the input parameters\n                    inputMesh = self.rebuild_mesh(inputMesh,\n                                                  RebuildNormals,\n                                                  CullUnusedVertices,\n                                                  CullDegenerateFaces,\n                                                  CombineIdentical)\n                    \n                    # get vertices as points\n                    V = [MVL[x] for x in range(MVL.Count)]\n                    \n                    # Create PlanktonMesh\n                    newPMesh = Plankton.PlanktonMesh()\n                    # create plankton points\n                    pxyz = [Plankton.PlanktonXYZ(v.X, v.Y, v.Z) for v in V]\n                    # add pxyz objects to pmesh vertexlist\n                    newPMesh.Vertices.AddVertices(pxyz)\n                    \n                    # make ghtype and objectwrapper for outputting to gh\n                    newPMesh = PlanktonGh.RhinoSupport.ToPlanktonMesh(inputMesh)\n                    newGHMesh = PlanktonGh.RhinoSupport.ToRhinoMesh(newPMesh)\n                    newPMesh = PlanktonGh.GH_PlanktonMesh(newPMesh)\n                    newPMesh = Grasshopper.Kernel.Types.GH_ObjectWrapper(newPMesh)\n                    \n                    PMesh.Add(newPMesh, Mesh.Paths[i])\n                    GHMesh.Add(newGHMesh, Mesh.Paths[i])\n        \n        # return outputs if you have them; here I try it for you:\n        return (PMesh, GHMesh)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}