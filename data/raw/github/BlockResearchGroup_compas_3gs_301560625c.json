{
  "source_url": "https://github.com/BlockResearchGroup/compas_3gs/blob/162cecfbeb8806340a55713ec3a0bce7cc932c89/examples/_old_examples/01_30_volmesh_reciprocation.py",
  "repo": "BlockResearchGroup/compas_3gs",
  "repo_stars": 11,
  "repo_description": "3D graphic statics add-on for the COMPAS framework",
  "license": "MIT",
  "filepath": "examples/_old_examples/01_30_volmesh_reciprocation.py",
  "instruction": "01 30 volmesh reciprocation",
  "code": "from __future__ import absolute_import\nfrom __future__ import print_function\nfrom __future__ import division\n\nimport compas\n\nfrom compas_3gs.diagrams import FormNetwork\nfrom compas_3gs.diagrams import ForceVolMesh\n\nfrom compas_3gs.algorithms import volmesh_dual_network\nfrom compas_3gs.algorithms import volmesh_reciprocate\n\nfrom compas_3gs.rhino import ReciprocationConduit\n\nfrom compas_rhino.utilities import volmesh_from_polysurfaces\n\nfrom compas_rhino.artists import NetworkArtist\nfrom compas_rhino.artists import VolMeshArtist\n\ntry:\n    import rhinoscriptsyntax as rs\nexcept ImportError:\n    compas.raise_if_ironpython()\n\n\n# ------------------------------------------------------------------------------\n# 1. make vomesh from rhino polysurfaces\n# ------------------------------------------------------------------------------\nlayer_force = 'force_volmesh'\n\nguids = rs.GetObjects(\"select polysurfaces\", filter=rs.filter.polysurface)\nrs.HideObjects(guids)\n\nforcediagram = ForceVolMesh()\nforcediagram = volmesh_from_polysurfaces(forcediagram, guids)\nforcediagram.layer = layer_force\nforcediagram.attributes['name'] = layer_force\n\nforce_artist = VolMeshArtist(forcediagram, layer=layer_force)\n\nforce_artist.draw_faces()\n\n\n# ------------------------------------------------------------------------------\n# 2. make dual network (form diagram)\n# ------------------------------------------------------------------------------\nlayer_form = 'form_network'\n\nformdiagram = volmesh_dual_network(forcediagram, cls=FormNetwork)\nformdiagram.layer = layer_form\nformdiagram.attributes['name'] = layer_form\n\n# move dual_network\noffset = 2\nwidth = formdiagram.bounding_box()[1][0] - formdiagram.bounding_box()[0][0]\nfor vkey in formdiagram.nodes():\n    x = formdiagram.node_attribute(vkey, 'x')\n    formdiagram.node_attribute(vkey, 'x', x + width * offset)\n\nform_artist = NetworkArtist(formdiagram, layer=layer_form)\n\nform_artist.draw_edges()\n\n\nrs.EnableRedraw(True)\n\n# ------------------------------------------------------------------------------\n# 3. get reciprocation weight factor\n# ------------------------------------------------------------------------------\nweight = rs.GetReal(\n    \"Enter weight factor : 1  = form only... 0 = force only...\", 1.0, 0)\n\n\n# ------------------------------------------------------------------------------\n# 4. reciprocate\n# ------------------------------------------------------------------------------\n\nforce_artist.clear_by_name()\nform_artist.clear_by_name()\n\n\n# conduit\nconduit = ReciprocationConduit(forcediagram, formdiagram)\n\n\ndef callback(forcediagram, formdiagram, k, args, refreshrate=2):\n    if k % refreshrate:\n        return\n    conduit.redraw()\n\n\n# reciprocation\nwith conduit.enabled():\n    volmesh_reciprocate(forcediagram,\n                        formdiagram,\n                        kmax=500,\n                        weight=weight,\n                        edge_min=0.5,\n                        edge_max=20,\n                        tolerance=0.01,\n                        callback=callback,\n                        print_result_info=True)\n\n# update / redraw\nforce_artist.draw_faces()\nform_artist.draw_edges()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}