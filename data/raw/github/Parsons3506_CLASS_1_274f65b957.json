{
  "source_url": "https://github.com/Parsons3506/CLASS_1/blob/2472545def76812f022755faeedf098c0ebd277a/class_1_app_branchingToSurface.py",
  "repo": "Parsons3506/CLASS_1",
  "repo_stars": 0,
  "repo_description": "class one demos",
  "license": "unknown",
  "filepath": "class_1_app_branchingToSurface.py",
  "instruction": "Class 1 app branching to surface",
  "code": "import rhinoscriptsyntax as rs\nimport math\nimport random\n\n\n\ndef main():\n    \n    attractorSurface = rs.GetObject(\"select Surface Please\",8)\n    if attractorSurface is None:return \n    \n    rs.EnableRedraw(False)\n    \n    \n    SurfaceTensor(attractorSurface,.5,.5)\n    \n    ptStart = rs.AddPoint(0,0,0)\n    vecDir = [0,0,1]\n    \n    minTwigCount = 5\n    maxTwigCount = 6\n    maxGen = 60\n    maxTwigLength = 100\n    lengthMutation = .5\n    maxTwigAngle = 180\n    angleMutation = .5\n    \n    \n    props = minTwigCount, maxTwigCount, maxGen, maxTwigLength, lengthMutation,maxTwigAngle, angleMutation\n    \n    RecursiveGrowth(ptStart, vecDir, props, 0,attractorSurface)\n    \n    rs.EnableRedraw(True)\n\ndef getClosestPointOnMesh(point, mesh):\n    data = rs.MeshClosestPoint(mesh,point)\n    return data[0]\n\ndef getClosestPointOnSurface(point, surface):\n    data = rs.BrepClosestPoint(surface,point)\n    return data[0]\n    \ndef getParameterOfClosestPt(point,surface):\n    data = rs.SurfaceClosestPoint(surface,point)\n    return data\n    \ndef AddArcDir(ptStart, ptEnd, vecDir):\n    vecBase = rs.PointSubtract(ptEnd, ptStart)\n    if rs.VectorLength(vecBase)==0.0: return\n    if rs.IsVectorParallelTo(vecBase, vecDir): return\n    vecBase = rs.VectorUnitize(vecBase)\n    vecDir = rs.VectorUnitize(vecDir)\n    vecBisector = rs.VectorAdd(vecDir, vecBase)\n    vecBisector = rs.VectorUnitize(vecBisector)\n    dotProd = rs.VectorDotProduct(vecBisector, vecDir)\n    midLength = (0.5*rs.Distance(ptStart, ptEnd))/dotProd\n    vecBisector = rs.VectorScale(vecBisector, midLength)\n    #return rs.AddArc3Pt(ptStart, rs.PointAdd(ptStart, vecBisector), ptEnd)\n    return rs.AddLine(ptStart,ptEnd)\n\n\n\ndef RandomPointInCone(origin, direction, minDistance, maxDistance, maxAngle):\n    vecTwig = rs.VectorUnitize(direction)\n    vecTwig = rs.VectorScale(vecTwig, minDistance + random.random()*(maxDistance-minDistance))\n    MutationPlane = rs.PlaneFromNormal((0,0,0), vecTwig)\n    vecTwig = rs.VectorRotate(vecTwig, random.random()*maxAngle, MutationPlane[1])\n    vecTwig = rs.VectorRotate(vecTwig, random.random()*360, direction)\n    return rs.PointAdd(origin, vecTwig)\n\n\n\ndef RecursiveGrowth(ptStart, vecDir, props, gen, srf):\n    minTwigCount, maxTwigCount, maxGen, maxTwigLength, lengthMutation,maxTwigAngle, angleMutation = props\n    \n    if gen > maxGen : return\n    \n    newProps = props\n    \n    maxTwigLength *= lengthMutation\n    maxTwigAngle *= angleMutation\n    \n    if maxTwigAngle>90:maxTwigAngle=90\n    \n    newProps = minTwigCount, maxTwigCount, maxGen, maxTwigLength, lengthMutation,maxTwigAngle, angleMutation\n    \n    maxN=int(minTwigCount+random.random()* (maxTwigCount-minTwigCount) )\n    \n    for n in range(0,maxN):\n        surfaceParamter = getParameterOfClosestPt(ptStart, srf)\n        srfVec = SurfaceTensor(srf, surfaceParamter[0],surfaceParamter[1])\n        srfPoint = rs.EvaluateSurface(srf,surfaceParamter[0],surfaceParamter[1])\n        \n        vecGrowth = rs.VectorCreate(srfPoint,ptStart)\n        \n        if vecGrowth.Length > 5 :\n            vecDir=vecGrowth\n        else:\n            vecDir = srfVec\n        \n        newPoint = RandomPointInCone(ptStart, vecDir, .25*maxTwigLength, maxTwigLength, maxTwigAngle)\n        newTwig = AddArcDir(ptStart, newPoint, vecDir)\n        if newTwig:\n            vecGrow = rs.CurveTangent(newTwig, rs.CurveDomain(newTwig)[1])\n            RecursiveGrowth(newPoint, vecGrow, newProps, gen+1,srf)\n            \n            \n            \n\ndef SurfaceTensor(idSrf,U, V):\n    localCurvature = rs.SurfaceCurvature(idSrf,(U,V))\n    vecDir = localCurvature[3]\n    return vecDir\n    \n    \n\n\nif __name__ == \"__main__\":\n    main()\n\n\n\n\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}