{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/rh_plugin_v6/PHPPexport%20%7B82540871-2420-4c7f-8efa-78b7d078cbfe%7D/dev/PHPP_SetDHW_Pipe_Recirc_cmd.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "rh_plugin_v6/PHPPexport {82540871-2420-4c7f-8efa-78b7d078cbfe}/dev/PHPP_SetDHW_Pipe_Recirc_cmd.py",
  "instruction": "Use this command on a selected line(s) to add DHW Recirculation parameters to \r\nthe curve. This includes pipe diameter, insultion, etc.. This data will be \r\nuseful later for the GH side tools to...",
  "code": "#\r\n# LBT2PH: A Plugin for creating Passive House Planning Package (PHPP) models from LadybugTools. Created by blgdtyp, llc\r\n# \r\n# This component is part of the PH-Tools toolkit <https://github.com/PH-Tools>.\r\n# \r\n# Copyright (c) 2020, bldgtyp, llc <phtools@bldgtyp.com> \r\n# LBT2PH is free software; you can redistribute it and/or modify \r\n# it under the terms of the GNU General Public License as published \r\n# by the Free Software Foundation; either version 3 of the License, \r\n# or (at your option) any later version. \r\n# \r\n# LBT2PH is distributed in the hope that it will be useful,\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\n# GNU General Public License for more details.\r\n# \r\n# For a copy of the GNU General Public License\r\n# see <http://www.gnu.org/licenses/>.\r\n# \r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\n#\r\n\"\"\"\r\nUse this command on a selected line(s) to add DHW Recirculation parameters to \r\nthe curve. This includes pipe diameter, insultion, etc.. This data will be \r\nuseful later for the GH side tools to read. This is for the RECIRCULATION pipes\r\nonly - not for the branch piping. That is all done in the GH tool only.\r\n-\r\nEM Mar. 29, 2020\r\n\"\"\"\r\n\r\nimport rhinoscriptsyntax as rs\r\nimport Rhino\r\nimport Eto\r\nimport json\r\n\r\n__commandname__ = \"PHPP_SetDHW_Pipe_Recirc\"\r\n\r\nclass Dialog_RecircPipe(Eto.Forms.Dialog):\r\n    \r\n    def OnCancelButtonClick(self, sender, e):\r\n        print('Canceled...')\r\n        self.Update = False\r\n        self.Close()\r\n    \r\n    def OnOKButtonClick(self, sender, e):\r\n        print('Applying Attributes to the Selected Object(s)')\r\n        self.Update = True\r\n        self.Close()\r\n    \r\n    def GetUserInput(self):\r\n        self.pipe_diam_ = self.pipe_diam_ComboBox.Text\r\n        self.insul_thickness_ = self.insul_thickness_ComboBox.Text \r\n        self.insul_conductivity_ = self.insul_lambda_TextBox.Text\r\n        self.insul_reflective_ = 'Yes' if self.insul_reflective_Checkbox.Checked==True else 'No'\r\n        \r\n        return self.pipe_diam_, self.insul_thickness_, self.insul_conductivity_, self.insul_reflective_\r\n    \r\n    def __init__(self, _exgDiam, _exgInsulThickness, _exgInsulReflective, _exgInsulConductivity):\r\n        \r\n        # Set up the options\r\n        self.diam_options = [\"8.255 (3/8in)\", \"12.700 (1/2in)\", \"15.875 (5/8in)\",  \"19.050 (3/4in)\", \"25.400 (1in)\", \"31.750 (1-1/4in)\", \"38.100 (1-1/2)\", \"50.800 (2in)\"]\r\n        self.insul_options = [\"8.255 (3/8in)\", \"12.700 (1/2in)\", \"15.875 (5/8in)\", \"19.050 (3/4in)\", \"25.400 (1in)\", \"31.750 (1-1/4in)\", \"38.100 (1-1/2)\", \"50.800 (2in)\"]\r\n        \r\n        self.diam_options_startI = 4\r\n        if _exgDiam != None:\r\n            self.diam_options_startI = 0\r\n            self.diam_options.insert(0, _exgDiam)\r\n        \r\n        self.insul_options_startI = 6\r\n        if _exgInsulThickness != None:\r\n            self.insul_options_startI = 0\r\n            self.insul_options.insert(0, _exgInsulThickness)\r\n        \r\n        insulLambda = _exgInsulConductivity if _exgInsulConductivity != None else 0.04\r\n        insulRefl = False if _exgInsulReflective=='No' else True\r\n        \r\n        # Set up the ETO Dialogue window \r\n        self.Title = \"Set Recirculation Pipe Parameters for Selected...\"\r\n        self.Resizable = False\r\n        self.Padding = Eto.Drawing.Padding(10) # Overall inset from window boundary\r\n        \r\n        # Controls\r\n        self.pipe_diam_Label = Eto.Forms.Label(Text = \"Pipe Diameter (mm):\")\r\n        self.pipe_diam_ComboBox = Eto.Forms.ComboBox()\r\n        self.pipe_diam_ComboBox.DataStore = self.diam_options\r\n        self.pipe_diam_ComboBox.SelectedIndex = self.diam_options_startI\r\n        \r\n        self.insul_thickness_Label = Eto.Forms.Label(Text = \"Insulation Thickness (mm):\")\r\n        self.insul_thickness_ComboBox = Eto.Forms.ComboBox()\r\n        self.insul_thickness_ComboBox.DataStore = self.insul_options\r\n        self.insul_thickness_ComboBox.SelectedIndex = self.insul_options_startI\r\n        \r\n        self.insul_reflective_Label = Eto.Forms.Label(Text = \"Insulation Reflective Coating?:\")\r\n        self.insul_reflective_Checkbox = Eto.Forms.CheckBox()\r\n        self.insul_reflective_Checkbox.Checked = insulRefl\r\n        \r\n        self.insul_lambda_Label = Eto.Forms.Label(Text = \"Insulation Conductivity (W/mk):\")\r\n        self.insul_lambda_TextBox = Eto.Forms.TextBox(Text = str(insulLambda) )\r\n        \r\n        # Layout\r\n        self.layout = Eto.Forms.DynamicLayout()\r\n        \r\n        # Group | Main\r\n        self.groupbox_Main = Eto.Forms.GroupBox(Text = 'PHPP Parameters:')\r\n        self.layout_Group_Main = Eto.Forms.TableLayout()\r\n        self.layout_Group_Main.Padding = Eto.Drawing.Padding(5) # Offfset from the outside of the Group Edge\r\n        self.layout_Group_Main.Spacing = Eto.Drawing.Size(10,5) # Spacing between elements\r\n        \r\n        # Cells\r\n        self.cell_01 = Eto.Forms.TableCell( self.pipe_diam_Label, True)\r\n        self.cell_02 = Eto.Forms.TableCell( self.pipe_diam_ComboBox, True )\r\n        self.cell_03 = Eto.Forms.TableCell( self.insul_thickness_Label, True)\r\n        self.cell_04 = Eto.Forms.TableCell( self.insul_thickness_ComboBox, True )\r\n        self.cell_05 = Eto.Forms.TableCell( self.insul_lambda_Label, True)\r\n        self.cell_06 = Eto.Forms.TableCell( self.insul_lambda_TextBox, True)\r\n        self.cell_07 = Eto.Forms.TableCell( self.insul_reflective_Label, True)\r\n        self.cell_08 = Eto.Forms.TableCell( self.insul_reflective_Checkbox, True)\r\n        \r\n        # Rows\r\n        self.Row01 = Eto.Forms.TableRow([self.cell_01, self.cell_02])\r\n        self.Row02 = Eto.Forms.TableRow([self.cell_03, self.cell_04])\r\n        self.Row03 = Eto.Forms.TableRow([self.cell_05, self.cell_06])\r\n        self.Row04 = Eto.Forms.TableRow([self.cell_07, self.cell_08])\r\n        self.Row01.ScaleHeight = True\r\n        self.Row02.ScaleHeight = True\r\n        self.Row03.ScaleHeight = True\r\n        self.Row04.ScaleHeight = True\r\n        \r\n        # Add Rows\r\n        self.layout_Group_Main.Rows.Add( self.Row01 )\r\n        self.layout_Group_Main.Rows.Add( self.Row02 )\r\n        self.layout_Group_Main.Rows.Add( self.Row03 )\r\n        self.layout_Group_Main.Rows.Add( self.Row04 )\r\n        \r\n        # Create the OK / Cancel Buttons\r\n        self.Button_OK = Eto.Forms.Button(Text = 'OK')\r\n        self.Button_OK.Click += self.OnOKButtonClick\r\n        self.Button_Cancel = Eto.Forms.Button(Text = 'Cancel')\r\n        self.Button_Cancel.Click += self.OnCancelButtonClick\r\n        \r\n        # Add Groups to Layout\r\n        self.groupbox_Main.Content = self.layout_Group_Main\r\n        self.layout.Add(self.groupbox_Main)\r\n        \r\n        # Add the Buttons at the bottom\r\n        self.vert = self.layout.BeginVertical()\r\n        self.vert.Padding = Eto.Drawing.Padding(10)\r\n        self.vert.Spacing = Eto.Drawing.Size(15,0)\r\n        self.layout.AddRow(None, self.Button_Cancel, self.Button_OK, None)\r\n        self.layout.EndVertical()\r\n        \r\n        # Set the dialog window Content\r\n        self.Content = self.layout\r\n\r\ndef getAttrs(_in, _key, _defaultVal):\r\n    # Takes in a list of Objects (_in) and the key to search for in \r\n    # User-Text. Returns '<varies>' if more than one value is found for the key\r\n    results = []\r\n    for each in _in:\r\n        if _key == 'Object Name':\r\n            results.append(rs.ObjectName(each))\r\n            # Get the objects Name\r\n        else:\r\n            # Get the User text info\r\n            if rs.IsUserText(each):\r\n                for eachKey in rs.GetUserText(each):\r\n                    if _key in eachKey:\r\n                        results.append(rs.GetUserText(each, _key) )\r\n                        break\r\n    \r\n    if len(set(results))>1:\r\n        return '<varies>'\r\n    else:\r\n        try:\r\n            return results[0]\r\n        except:\r\n            return _defaultVal\r\n\r\ndef setAttrs(_obj, _key, _val):\r\n    if _val != '<varies>':\r\n        rs.SetUserText(_obj, _key, _val)\r\n\r\ndef RunCommand( is_interactive ):\r\n    # First, get any properties of the existing object(s) selected\r\n    exg_pipe_diam = getAttrs( rs.SelectedObjects(), 'pipe_diameter', _defaultVal=None)\r\n    exg_pipe_insulThickness = getAttrs( rs.SelectedObjects(), 'insulation_thickness', _defaultVal=None)\r\n    exg_pipe_insulConductivity = getAttrs( rs.SelectedObjects(), 'insulation_conductivity', _defaultVal=None)\r\n    exg_pipe_insulReflective = getAttrs( rs.SelectedObjects(), 'insulation_reflective', _defaultVal=True)\r\n    \r\n    # Call the Dialog Window\r\n    dialog = Dialog_RecircPipe(exg_pipe_diam, exg_pipe_insulThickness, exg_pipe_insulReflective, exg_pipe_insulConductivity)\r\n    rc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\r\n    nw_diam, nw_thkns, nw_lambda, nw_reflec = dialog.GetUserInput()\r\n    \r\n    # Get the user-input data\r\n    try:\r\n        update = dialog.Update #True if 'OK', False if 'Cancel'\r\n    except:\r\n        update = False # on any error with the user input\r\n        print('Error. Not changing any object parameters.')\r\n    \r\n    # Apply the User Inputs to the Object's Attributes if update==True\r\n    if update:\r\n        for eachObj in rs.SelectedObjects():\r\n            if 'varies' not in [str(nw_diam),  str(nw_thkns)]:\r\n                setAttrs(eachObj, 'pipe_diameter', str(nw_diam) )\r\n                setAttrs(eachObj, 'insulation_thickness', str(nw_thkns) )\r\n                setAttrs(eachObj, 'insulation_conductivity', str(nw_lambda) )\r\n                setAttrs(eachObj, 'insulation_reflective', str(nw_reflec) )\r\n    \r\n    return 1\r\n\r\n# temp for debuggin in editor\r\n#RunCommand(True)",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}