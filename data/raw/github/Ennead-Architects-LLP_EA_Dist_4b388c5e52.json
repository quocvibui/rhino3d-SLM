{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/_rhino/Fun.tab/ennead_city.button/ennead_city_gui.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/_rhino/Fun.tab/ennead_city.button/ennead_city_gui.py",
  "instruction": "Ennead city gui",
  "code": "#!/usr/bin/python\r\n# -*- coding: utf-8 -*-\r\n\r\n__title__ = \"EnneadCity GUI\"\r\n__doc__ = \"EnneadCity - Work on your plot with GUI interface\"\r\n\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\nimport os\r\nimport sys\r\n\r\n# Import ETO forms\r\nimport Rhino.UI\r\nimport Eto.Forms as forms\r\nimport Eto.Drawing as drawing\r\n\r\n# Import EnneadTab modules\r\nfrom EnneadTab import ERROR_HANDLE, LOG\r\n\r\n# Get current script file directory\r\nmy_directory = os.path.dirname(os.path.realpath(__file__))\r\nsys.path.append(my_directory)\r\nimport city_utility # pyright: ignore\r\n\r\n\r\nclass EnneadCityForm(forms.Dialog[bool]):\r\n    \"\"\"Main EnneadCity GUI form\"\"\"\r\n    \r\n    def __init__(self):\r\n        self.InitializeComponent()\r\n        \r\n    def InitializeComponent(self):\r\n        \"\"\"Initialize the form components\"\"\"\r\n        # Form properties\r\n        self.Title = \"EnneadCity - Plot Management\"\r\n        self.Size = drawing.Size(400, 300)\r\n        self.Resizable = False\r\n        \r\n        # Main layout\r\n        self.main_layout = forms.TableLayout()\r\n        self.main_layout.Padding = drawing.Padding(10)\r\n        self.main_layout.Spacing = drawing.Size(5, 5)\r\n        \r\n        # Title label\r\n        self.title_label = forms.Label()\r\n        self.title_label.Text = \"EnneadCity Plot Management\"\r\n        self.title_label.Font = drawing.Font(\"Arial\", 14, drawing.FontStyle.Bold)\r\n        self.title_label.HorizontalAlign = forms.HorizontalAlign.Center\r\n        \r\n        # Current user info\r\n        self.user_info_label = forms.Label()\r\n        self.user_info_label.Text = \"Current User: {}\".format(city_utility.USER.USER_NAME)\r\n        self.user_info_label.Font = drawing.Font(\"Arial\", 10)\r\n        \r\n        # Current plot info\r\n        self.current_plot_label = forms.Label()\r\n        current_plot = city_utility.get_current_user_plot_file()\r\n        if current_plot and os.path.exists(current_plot):\r\n            self.current_plot_label.Text = \"Current Plot: {}\".format(os.path.basename(current_plot))\r\n            self.current_plot_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n        else:\r\n            self.current_plot_label.Text = \"No plot assigned\"\r\n            self.current_plot_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n        \r\n        # Buttons section\r\n        self.buttons_layout = forms.TableLayout()\r\n        self.buttons_layout.Rows.Add(forms.TableRow())\r\n        \r\n        # Open current plot button\r\n        self.open_current_btn = forms.Button()\r\n        self.open_current_btn.Text = \"Open My Current Plot\"\r\n        self.open_current_btn.Size = drawing.Size(150, 30)\r\n        self.open_current_btn.Click += self.OnOpenCurrentPlot\r\n        \r\n        # Select new plot button\r\n        self.select_plot_btn = forms.Button()\r\n        self.select_plot_btn.Text = \"Select New Plot\"\r\n        self.select_plot_btn.Size = drawing.Size(150, 30)\r\n        self.select_plot_btn.Click += self.OnSelectNewPlot\r\n        \r\n        # Load all plots button\r\n        self.load_all_btn = forms.Button()\r\n        self.load_all_btn.Text = \"Load All Plots (Session)\"\r\n        self.load_all_btn.Size = drawing.Size(150, 30)\r\n        self.load_all_btn.Click += self.OnLoadAllPlots\r\n        \r\n        # Available plots info\r\n        self.available_plots_label = forms.Label()\r\n        self.available_plots_label.Text = \"Available Plots:\"\r\n        self.available_plots_label.Font = drawing.Font(\"Arial\", 10, drawing.FontStyle.Bold)\r\n        \r\n        # Plots list\r\n        self.plots_list = forms.ListBox()\r\n        self.plots_list.Height = 100\r\n        self.plots_list.SelectionMode = forms.ListBoxSelectionMode.Single\r\n        self.UpdatePlotsList()\r\n        \r\n        # Status label\r\n        self.status_label = forms.Label()\r\n        self.status_label.Text = \"Ready\"\r\n        self.status_label.Font = drawing.Font(\"Arial\", 9)\r\n        self.status_label.TextColor = drawing.Color.FromArgb(0, 0, 255)  # Blue\r\n        \r\n        # Bottom buttons\r\n        self.bottom_layout = forms.TableLayout()\r\n        self.bottom_layout.Rows.Add(forms.TableRow())\r\n        \r\n        self.refresh_btn = forms.Button()\r\n        self.refresh_btn.Text = \"Refresh\"\r\n        self.refresh_btn.Click += self.OnRefresh\r\n        \r\n        self.close_btn = forms.Button()\r\n        self.close_btn.Text = \"Close\"\r\n        self.close_btn.Click += self.OnClose\r\n        \r\n        # Assemble layout\r\n        self.main_layout.Rows.Add(forms.TableRow(self.title_label))\r\n        self.main_layout.Rows.Add(forms.TableRow(self.user_info_label))\r\n        self.main_layout.Rows.Add(forms.TableRow(self.current_plot_label))\r\n        self.main_layout.Rows.Add(forms.TableRow())  # Spacer\r\n        \r\n        # Buttons row\r\n        button_row = forms.TableRow()\r\n        button_row.Cells.Add(self.open_current_btn)\r\n        button_row.Cells.Add(self.select_plot_btn)\r\n        self.main_layout.Rows.Add(button_row)\r\n        \r\n        self.main_layout.Rows.Add(forms.TableRow(self.load_all_btn))\r\n        self.main_layout.Rows.Add(forms.TableRow())  # Spacer\r\n        \r\n        self.main_layout.Rows.Add(forms.TableRow(self.available_plots_label))\r\n        self.main_layout.Rows.Add(forms.TableRow(self.plots_list))\r\n        self.main_layout.Rows.Add(forms.TableRow(self.status_label))\r\n        \r\n        # Bottom buttons row\r\n        bottom_row = forms.TableRow()\r\n        bottom_row.Cells.Add(self.refresh_btn)\r\n        bottom_row.Cells.Add(self.close_btn)\r\n        self.main_layout.Rows.Add(bottom_row)\r\n        \r\n        self.Content = self.main_layout\r\n        \r\n    def UpdatePlotsList(self):\r\n        \"\"\"Update the list of available plots\"\"\"\r\n        try:\r\n            empty_plots = city_utility.get_empty_plot_files()\r\n            occupied_plots = city_utility.get_occupied_plot_files()\r\n            \r\n            self.plots_list.Items.Clear()\r\n            \r\n            # Add empty plots\r\n            for plot in empty_plots:\r\n                plot_name = os.path.basename(plot).replace(\".3dm\", \"\")\r\n                self.plots_list.Items.Add(\"{} (Available)\".format(plot_name))\r\n            \r\n            # Add occupied plots\r\n            for plot in occupied_plots:\r\n                plot_name = os.path.basename(plot).replace(\".3dm\", \"\")\r\n                self.plots_list.Items.Add(\"{} (Occupied)\".format(plot_name))\r\n                \r\n        except Exception as e:\r\n            self.status_label.Text = \"Error loading plots: {}\".format(str(e))\r\n            self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n    \r\n    def OnOpenCurrentPlot(self, sender, e):\r\n        \"\"\"Handle opening current user's plot\"\"\"\r\n        try:\r\n            plot_file = city_utility.get_current_user_plot_file()\r\n            if plot_file and os.path.exists(plot_file):\r\n                import clr # pyright: ignore\r\n                is_open = clr.StrongBox[bool](False)\r\n                sc.doc.Open(plot_file, is_open)\r\n                self.status_label.Text = \"Opened current plot: {}\".format(os.path.basename(plot_file))\r\n                self.status_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n            else:\r\n                self.status_label.Text = \"No current plot assigned or file not found\"\r\n                self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n        except Exception as ex:\r\n            self.status_label.Text = \"Error opening plot: {}\".format(str(ex))\r\n            self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n    \r\n    def OnSelectNewPlot(self, sender, e):\r\n        \"\"\"Handle selecting a new plot\"\"\"\r\n        try:\r\n            empty_plots = city_utility.get_empty_plot_files()\r\n            if not empty_plots:\r\n                self.status_label.Text = \"No available plots found\"\r\n                self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n                return\r\n            \r\n            # Create plot selection dialog\r\n            plot_names = [os.path.basename(plot).replace(\".3dm\", \"\") for plot in empty_plots]\r\n            plot_number = rs.ListBox(plot_names, \r\n                                   message=\"Select a plot number from those available plots\", \r\n                                   title=\"EnneadCity - Select Plot\")\r\n            \r\n            if not plot_number:\r\n                self.status_label.Text = \"No plot selected\"\r\n                return\r\n            \r\n            # Set the selected plot\r\n            plot_file = os.path.join(city_utility.PLOT_FILES_FOLDER, \"{}.3dm\".format(plot_number))\r\n            city_utility.set_current_user_plot_file(plot_file)\r\n            \r\n            # Open the plot\r\n            import clr # pyright: ignore\r\n            is_open = clr.StrongBox[bool](False)\r\n            sc.doc.Open(plot_file, is_open)\r\n            rs.Command(\"_SetLinetypeScale 500 _Enter\")\r\n            \r\n            self.status_label.Text = \"Selected and opened plot: {}\".format(plot_number)\r\n            self.status_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n            \r\n            # Update current plot label\r\n            self.current_plot_label.Text = \"Current Plot: {}\".format(plot_number)\r\n            self.current_plot_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n            \r\n            # Refresh plots list\r\n            self.UpdatePlotsList()\r\n            \r\n        except Exception as ex:\r\n            self.status_label.Text = \"Error selecting plot: {}\".format(str(ex))\r\n            self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n    \r\n    def OnLoadAllPlots(self, sender, e):\r\n        \"\"\"Handle loading all plots into a session\"\"\"\r\n        try:\r\n            plot_files = city_utility.get_all_plot_files()\r\n            \r\n            file_string_link = \"\"\r\n            for file in plot_files:\r\n                if os.path.exists(file):\r\n                    file_string_link += \" Attach \\\"{}\\\"\".format(file)\r\n            \r\n            for file in city_utility.CITY_BACKGROUND_FILES:\r\n                if os.path.exists(file):\r\n                    file_string_link += \" Attach \\\"{}\\\"\".format(file)\r\n            \r\n            if file_string_link:\r\n                rs.Command(\"-WorkSession  {}  Enter\".format(file_string_link))\r\n                rs.ZoomExtents(view=None, all=True)\r\n                rs.Command(\"_SetLinetypeScale 500 _Enter\")\r\n                self.status_label.Text = \"Loaded all plots into session\"\r\n                self.status_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n            else:\r\n                self.status_label.Text = \"No plot files or background files found to attach\"\r\n                self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n                \r\n        except Exception as ex:\r\n            self.status_label.Text = \"Error loading all plots: {}\".format(str(ex))\r\n            self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n    \r\n    def OnRefresh(self, sender, e):\r\n        \"\"\"Handle refresh button click\"\"\"\r\n        try:\r\n            # Update current plot info\r\n            current_plot = city_utility.get_current_user_plot_file()\r\n            if current_plot and os.path.exists(current_plot):\r\n                self.current_plot_label.Text = \"Current Plot: {}\".format(os.path.basename(current_plot))\r\n                self.current_plot_label.TextColor = drawing.Color.FromArgb(0, 128, 0)  # Green\r\n            else:\r\n                self.current_plot_label.Text = \"No plot assigned\"\r\n                self.current_plot_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n            \r\n            # Update plots list\r\n            self.UpdatePlotsList()\r\n            \r\n            self.status_label.Text = \"Refreshed\"\r\n            self.status_label.TextColor = drawing.Color.FromArgb(0, 0, 255)  # Blue\r\n            \r\n        except Exception as ex:\r\n            self.status_label.Text = \"Error refreshing: {}\".format(str(ex))\r\n            self.status_label.TextColor = drawing.Color.FromArgb(255, 0, 0)  # Red\r\n    \r\n    def OnClose(self, sender, e):\r\n        \"\"\"Handle close button click\"\"\"\r\n        self.Close(True)\r\n\r\n\r\n@LOG.log(__file__, __title__)\r\n@ERROR_HANDLE.try_catch_error()\r\ndef ennead_city_gui():\r\n    \"\"\"Main function to show the EnneadCity GUI\"\"\"\r\n    try:\r\n        # Create and show the form\r\n        form = EnneadCityForm()\r\n        form.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\r\n        return True\r\n    except Exception as e:\r\n        print(\"Error showing EnneadCity GUI: {}\".format(str(e)))\r\n        return False\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    ennead_city_gui()\r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}