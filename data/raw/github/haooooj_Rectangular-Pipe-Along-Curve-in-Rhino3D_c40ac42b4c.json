{
  "source_url": "https://github.com/haooooj/Rectangular-Pipe-Along-Curve-in-Rhino3D/blob/09c2d61a9ee4c66c3fad52b72601cf69c46f23c6/rectangular_pipe.py",
  "repo": "haooooj/Rectangular-Pipe-Along-Curve-in-Rhino3D",
  "repo_stars": 0,
  "repo_description": null,
  "license": "MIT",
  "filepath": "rectangular_pipe.py",
  "instruction": "Rectangular pipe",
  "code": "# -*- Hao with gpt4 -*-\r\nimport rhinoscriptsyntax as rs\r\nimport Rhino\r\nimport math\r\n\r\ndef make_rectangle_curve(frame, width, height, angle_rad):\r\n    half_w = 0.5 * width\r\n    half_h = 0.5 * height\r\n    x_axis = frame.XAxis\r\n    y_axis = frame.YAxis\r\n\r\n    if abs(angle_rad) > 1e-9:\r\n        rot = Rhino.Geometry.Transform.Rotation(angle_rad, frame.ZAxis, frame.Origin)\r\n        x_axis.Transform(rot)\r\n        y_axis.Transform(rot)\r\n\r\n    pts = [\r\n        frame.Origin + x_axis * half_w + y_axis * half_h,\r\n        frame.Origin - x_axis * half_w + y_axis * half_h,\r\n        frame.Origin - x_axis * half_w - y_axis * half_h,\r\n        frame.Origin + x_axis * half_w - y_axis * half_h,\r\n        frame.Origin + x_axis * half_w + y_axis * half_h\r\n    ]\r\n\r\n    return Rhino.Geometry.Polyline(pts).ToNurbsCurve()\r\n\r\ndef project_vector_to_plane(vector, plane):\r\n    projection = vector - plane.ZAxis * (vector * plane.ZAxis)\r\n    if projection.IsTiny():\r\n        return None\r\n    projection.Unitize()\r\n    return projection\r\n\r\ndef compute_rotation_angle_in_plane(projected_vec, plane):\r\n    x_comp = projected_vec * plane.XAxis\r\n    y_comp = projected_vec * plane.YAxis\r\n    return math.atan2(y_comp, x_comp)\r\n\r\ndef rectangular_pipe():\r\n    rail_ids = rs.GetObjects(\"Select rail curve(s)\", rs.filter.curve, preselect=True)\r\n    if not rail_ids:\r\n        print(\"No rails selected. Operation cancelled.\")\r\n        return\r\n\r\n    width = rs.GetReal(\"Rectangle width (X-direction)\", 10.0, minimum=0.01)\r\n    if width is None:\r\n        return\r\n    height = rs.GetReal(\"Rectangle height (Y-direction)\", 5.0, minimum=0.01)\r\n    if height is None:\r\n        return\r\n\r\n    mode = rs.GetString(\"Choose rotation method\", \"Angle\", [\"Angle\", \"Vector\"])\r\n    if not mode:\r\n        return\r\n\r\n    use_fixed_angle = True\r\n    fixed_angle_rad = 0.0\r\n    world_reference_vector = None\r\n\r\n    if mode == \"Angle\":\r\n        angle_deg = rs.GetReal(\"Enter rotation angle (degrees, clockwise)\", 0.0)\r\n        if angle_deg is None:\r\n            return\r\n        fixed_angle_rad = math.radians(angle_deg)\r\n    else:\r\n        pts = rs.GetPoints(\"Pick two points to define direction vector (from â†’ to)\", max_points=2)\r\n        if not pts or len(pts) != 2:\r\n            print(\"Two points required for vector definition.\")\r\n            return\r\n        vec = pts[1] - pts[0]\r\n        if vec.IsTiny():\r\n            print(\"Zero-length vector. Operation cancelled.\")\r\n            return\r\n        vec.Unitize()\r\n        world_reference_vector = vec\r\n        use_fixed_angle = False\r\n\r\n    doc = Rhino.RhinoDoc.ActiveDoc\r\n    sweep = Rhino.Geometry.SweepOneRail()\r\n    sweep.AngleToleranceRadians = doc.ModelAngleToleranceRadians\r\n    sweep.ClosedSweep = True\r\n\r\n    created_count = 0\r\n\r\n    for rid in rail_ids:\r\n        rail_obj = doc.Objects.Find(rid)\r\n        if not rail_obj:\r\n            continue\r\n        rail = rail_obj.Geometry\r\n        if not isinstance(rail, Rhino.Geometry.Curve):\r\n            continue\r\n\r\n        success, frame = rail.PerpendicularFrameAt(rail.Domain.T0)\r\n        if not success:\r\n            print(\"Could not compute frame on rail. Skipping.\")\r\n            continue\r\n\r\n        if use_fixed_angle:\r\n            angle_rad = fixed_angle_rad\r\n        else:\r\n            projected = project_vector_to_plane(world_reference_vector, frame)\r\n            if not projected:\r\n                print(\"Reference vector is parallel to rail normal. Skipping this rail.\")\r\n                continue\r\n            angle_rad = compute_rotation_angle_in_plane(projected, frame)\r\n\r\n        profile = make_rectangle_curve(frame, width, height, angle_rad)\r\n        breps = sweep.PerformSweep(rail, profile)\r\n        if not breps:\r\n            print(\"Sweep failed on one rail.\")\r\n            continue\r\n\r\n        for b in breps:\r\n            doc.Objects.AddBrep(b)\r\n            created_count += 1\r\n\r\n    if created_count:\r\n        doc.Views.Redraw()\r\n        print(\"Created {} rectangular pipe(s).\".format(created_count))\r\n    else:\r\n        print(\"No pipes were created.\")\r\n\r\nif __name__ == \"__main__\":\r\n    rectangular_pipe()\r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}