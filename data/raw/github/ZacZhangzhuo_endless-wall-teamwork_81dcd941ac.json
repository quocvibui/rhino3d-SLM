{
  "source_url": "https://github.com/ZacZhangzhuo/endless-wall-teamwork/blob/7257f5f0a1ce359894a3dcd68962fbe23ae19ae7/simulation/simulation.py",
  "repo": "ZacZhangzhuo/endless-wall-teamwork",
  "repo_stars": 2,
  "repo_description": "This is the brick pick and place of UR5 robot group practice, ETH Zurich MAS dfab 2022-23",
  "license": "MIT",
  "filepath": "simulation/simulation.py",
  "instruction": "Simulation",
  "code": "from imp import reload\nimport Rhino.Geometry as rg\nimport simple_ur_script as ur\nreload(ur)\nimport simple_comm as c\nreload(c)\nimport math as m\nfrom compas.geometry import Frame\nfrom compas_rhino.conversions import frame_to_rhino\n\n\n# change these values if needed\n# ROBOT_IP = \"192.168.10.10\"\nSAFE_ROBOT_ACC = 0.3\nSAFE_ROBOT_VEL = 0.3\nIO = 0 # 0\nsleep_time = 0.2\n\ndef tcp(script):\n    # script += ur.set_tcp_by_angles(-0.35, 0.5, 89.08, m.radians(0.0), m.radians(3.1415),m.radians(0.0))\n    # script += ur.set_tcp_by_angles(-0.35, 0.5, 89.08, m.radians(0.0), m.radians(0),m.radians(0.0))\n    script += ur.set_tcp_by_angles(-0.35, 0.5, 89.08, 0.0, 3.1415, 1.57)\n    \n    return script\n\ndef set_robot_base():\n    pt_0 = rg.Point3d(-200 ,-320 ,-587.3) # base plane origin\n    # pt_1 = rg.Point3d(-206.2 ,-192.6 ,-587.3) # point on positive x axis\n    # pt_2 = rg.Point3d(456.4 ,-326.4 ,-587.3) # point on positive xy plane\n    pt_1 = rg.Point3d(-201.8 ,-519.9 ,-587.3) \n    pt_2 = rg.Point3d(200 ,-323.9 ,-587.3) \n    robot_base = rg.Plane(pt_0,pt_1-pt_0,pt_2-pt_0)\n    return robot_base\n\ndef rhino_to_robot_space(rhino_plane):\n    plane = rhino_plane.Clone()\n    robot_base_plane = set_robot_base()\n    rhino_matrix = rg.Transform.PlaneToPlane(rg.Plane.WorldXY,robot_base_plane)\n    plane.Transform(rhino_matrix)\n    return plane\n\ndef pickup_brick(script,pick_up_plane):\n    planes = []\n    #change the distance if needed\n    SAFE_DIST = 150\n    \n    safe_plane = pick_up_plane.Clone()\n    #safe_plane.Translate(rhinoplane.ZAxis*SAFE_DIST)\n    safe_plane.Translate(rg.Vector3d.ZAxis*SAFE_DIST)\n    \n    ## add to the path: go to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    ## add to the path: go to the pick up plane\n    script += ur.move_l(pick_up_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(pick_up_plane)\n    \n    ## add to the path: turn on the vacuum and wait 1 sec.\n    script += ur.set_digital_out(IO,True)\n    script += ur.sleep(sleep_time)\n\n    # add to the path: go back to the safe_plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    return script, planes\n\ndef place_brick(script, place_plane):\n    \n    planes = []\n    \n    SAFE_DIST = 100\n    safe_plane = place_plane.Clone()\n    safe_plane.Translate(rg.Vector3d.ZAxis*SAFE_DIST)\n    \n    # add to the path: go to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    # add to the path: go to the place plane\n    script += ur.move_l(place_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(place_plane)\n    \n    ## add to the path: turn off the vacuum and wait 1 second (hold the brick)\n    script += ur.set_digital_out(IO,False)\n    script += ur.sleep(sleep_time)\n    # add to the path: go back to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    return script,planes\n\ndef send(script):\n    script = c.concatenate_script(script)\n    c.send_script(script, ROBOT_IP)\n    return script \n\nscript = \"\"\nscript = tcp(script)\n\n#! ---------------------------------------------------------------- Test and navigation only: go to a point \ntest_plane = debug_plane.Clone()\nscript += ur.move_l(rhino_to_robot_space(test_plane), SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n#! ----------------------------------------------------------------\n\n\"\"\"\n#!  ---------------------------------------------------------------- Real run\n#Optional: location of a pick up station\n# pick_point = Frame.from_axis_angle_vector([2.403,2.421,-4.166],[677.46,-886.44,-492.82])\n\nfor i in range(len(brick_planes)):\n    script, p = pickup_brick(script,rhino_to_robot_space(picking_planes[i%len(picking_planes)]))\n    script, p = place_brick(script,rhino_to_robot_space(brick_planes[i]))\n#!  ---------------------------------------------------------------- \n\"\"\"\n#! Never touch\nif fabricate:\n    send(script)\nrobot_base_plane = set_robot_base()\n\n\n# Questions to ask:\n# Visualize gcode in GH\n# Robot position in GH\n# TCP\n# import compas\n# pose = compas.geometry.Frame([pose[3],pose[4],pose[5]],[pose[0],pose[1],pose[2]])\ndebug_plane = debug_plane",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": false
}