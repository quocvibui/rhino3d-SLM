{
  "source_url": "https://github.com/NoDoubtsKleve/rehopper/blob/b31afa39d1b20224d47297475a03f2554c29bb61/src/reload_grasshopper.py",
  "repo": "NoDoubtsKleve/rehopper",
  "repo_stars": 6,
  "repo_description": "Grasshopper plugin to reload canvas",
  "license": "MIT",
  "filepath": "src/reload_grasshopper.py",
  "instruction": "Reload grasshopper",
  "code": "#!/usr/bin/env ipy\n# -*- coding: utf-8 -*-\n\n__all__ = ['ReloadGrasshopper']\n\n# - - - - BUILT-IN IMPORTS\nimport Rhino, System\nimport clr, sys, traceback\n\n# - - - - GLOBALS\nIGNORE_LIST =   [   \n                    \"Rehopper\",\n                    \"rhinoscript.datetime\", \n                    \"Eto\", \n                    \"rhinoscript.System\", \n                    \"__main__\", \n                    \"rhinoscript.Rhino\", \n                    \"copy_reg\", \n                    \"rhinoscript.curve\", \n                    \"rhinoscript\", \n                    \"System\", \n                    \"rhinoscript.numbers\", \n                    \"rhinoscriptsyntax\", \n                    \"rhinoscript.linetype\", \n                    \"zipimport\", \n                    \"rhinoscript.geometry\", \n                    \"rhinoscript.string\", \n                    \"re\", \n                    \"rhinoscript.plane\", \n                    \"rhinoscript.selection\", \n                    \"scriptcontext\", \n                    \"Rhino\", \n                    \"string\", \n                    \"rhinoscript.mesh\", \n                    \"rhinoscript.toolbar\", \n                    \"rhinoscript.transformation\", \n                    \"time\", \n                    \"rhinoscript.layer\", \n                    \"rhinoscript.light\", \n                    \"rhinoscript.userdata\", \n                    \"rhinoscript.application\", \n                    \"rhinoscript.group\", \n                    \"__builtin__\", \n                    \"rhinoscript.hatch\", \n                    \"sys\", \n                    \"__future__\", \n                    \"numbers\", \n                    \"RhinoPython\", \n                    \"rhinoscript.math\", \n                    \"rhinoscript.RhinoPython\", \n                    \"rhinoscript.userinterface\", \n                    \"rhinoscript.line\", \n                    \"rhinoscript.pointvector\", \n                    \"types\", \n                    \"rhinoscript.grips\", \n                    \"rhinoscript.view\", \n                    \"rhinoscript.document\", \n                    \"rhinoscript.Eto\", \n                    \"_weakrefset\", \n                    \"rhinoscript.dimension\", \n                    \"_weakref\", \n                    \"rhinoscript.time\", \n                    \"datetime\", \n                    \"rhinoscript.surface\", \n                    \"rhinoscript.block\", \n                    \"rhinoscript.scriptcontext\", \n                    \"rhinoscript.object\", \n                    \"rhinoscript.utility\", \n                    \"math\", \n                    \"rhinoscript.material\", \n                    \"abc\",\n                ]\n\n# - - - - LIBRARY METHODS\ndef load_grasshopper(files = []):\n    grasshopper = Rhino.RhinoApp.GetPlugInObject( 'Grasshopper' )\n    import Grasshopper\n    Grasshopper.Instances.AutoShowBanner = False\n    grasshopper.LoadEditor()\n    \n    if len(files) > 0:\n        files.reverse()\n        for file in files:\n            Grasshopper.Instances.DocumentServer.AddDocument(file, True)\n    \n    grasshopper.ShowEditor()\n\ndef files_are_closed():\n    \"\"\"\n    Check for open Grasshopper document. \n    Aks to reload if open.\n    Return True or False. \n    \"\"\"\n    clr.AddReference(\"Grasshopper\")\n    import Grasshopper\n    doc_open = Grasshopper.Instances.DocumentServer.DocumentCount\n    if doc_open > 0:\n        message = [\"You have some documents open in Grasshopper.\",\n                  \"You will loose all not saved progress.\",\n                  \"Do you want to continue?\"]\n        rc = System.Windows.Forms.MessageBox.Show(\n                \"\\n\".join(message),\n                \"Warning\",\n                System.Windows.Forms.MessageBoxButtons.OKCancel,\n                System.Windows.Forms.MessageBoxIcon.Warning)\n        \n        return int(rc) == 6 or str(rc).lower() == \"ok\"\n    else:\n        return True\n\ndef close_gh_docs(gh_files):\n    \"\"\"\n    Recursive: close documents ans save to paths to list.\n    \"\"\"\n    clr.AddReference(\"Grasshopper\")\n    import Grasshopper\n    if Grasshopper.Instances.DocumentServer.DocumentCount != 0:\n        doc = Grasshopper.Instances.DocumentServer[0]\n        \n        close = Grasshopper.Instances.DocumentServer.SafeRemoveDocument(doc)\n        if not close:\n            #Stop the process if canseled\n            return False\n        \n        if doc.FilePath:\n            gh_files.append(doc.FilePath)\n        \n        return close_gh_docs(gh_files)\n    else:\n        return True\n\ndef reload_grasshopper():\n\n    if files_are_closed():\n        gh_files = []\n        close_gh_docs(gh_files)\n        \n        clr.AddReference(\"Grasshopper\")\n        import Grasshopper\n        Grasshopper.Instances.ComponentServer.Clear()\n        Grasshopper.Instances.UnloadAllObjects()\n\n        modules = sys.modules.copy()\n\n        for module in modules:\n            if not module in IGNORE_LIST:\n                sys.modules.pop(module)\n\n        load_grasshopper(gh_files)\n        return\n\n    else:\n        return\n\ndef ReloadGrasshopper():\n\n    try:\n        if \"Grasshopper\" in sys.modules.keys():\n            reload_grasshopper()\n        else:\n            clr.AddReference(\"Grasshopper\")\n            load_grasshopper()\n    except:\n        System.Windows.Forms.MessageBox.Show(traceback.format_exc(), 'Failed to reload Grasshopper!')\n\n# - - - - RUNSCRIPT\nif __name__ == \"__main__\":\n    ReloadGrasshopper()\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}