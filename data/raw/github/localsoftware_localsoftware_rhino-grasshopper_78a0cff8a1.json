{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/python/CreatePickleView.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "python/CreatePickleView.py",
  "instruction": "Serializes Rhino view data into a binary file.",
  "code": "\"\"\"Serializes Rhino view data into a binary file.\n\nReturns a pickled file with view information to be set up in Rhino.\nBased on the work of Jackie Berry.\n\n    Typical usage:\n        Input a geometry (make sure to only input one geometry), and Azimuth and Altitude angles for the view.\n        Set a path with a panel to export the Pickled View to. Finally use a Boolean Toggle to activate the component.\n        You can use the componentâ€™s outputs to set a view and visualize the results of the parameters used to create the view.\n\n\n    Inputs:\n        data: geometry or data to serialize\n        azimuth: rotation in XY of camera angle.\n        altitude: vertical rotation of camera angle.\n        siteNumber: local code site number (sort of optional)\n        path: path of directory for target binary file.\n        layer: name of file\n        write: boolean\n\n    Outputs:\n        geometry: if successful, a data tree with serialized geometry\n        view_vector: a vector specifying the camera angle\n        view_target: a 3D point specifying the camera target (center of geom bbox)\"\"\"\n\n__author__ = \"palomagr\"\n__version__ = \"2020.07.09\"\n\n#ghenv.Component.Name = \"Create Pickle View\"\n#ghenv.Component.NickName = \"Create Pickle View\"\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython, System, Rhino, os, math\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport cPickle as pickle\n\nclass MyComponent(component):\n\n    def RunScript(self, data, azimuth, altitude, siteNumber, layer, path, write):\n        geometry, view_vector, view_target, status = None, None, None, None\n\n        if path!=None and len(data)>0 and write==True and azimuth!=None and altitude!=None:\n            bbox = rs.BoundingBox(data)\n            centroid = [0,0,0]\n            for pt in bbox:\n                centroid = [centroid[0]+pt[0]/8, centroid[1]+pt[1]/8, centroid[2]+pt[2]/8]\n            target = rs.AddPoint(centroid)\n            target = rs.coerce3dpoint(target)\n\n            # convert angles to radians\n            azimuth = azimuth*2*math.pi/360\n            altitude = altitude*2*math.pi/360\n            X = centroid[0] + math.cos(azimuth)\n            Y = centroid[1] + math.sin(azimuth)\n            Z = centroid[2] + math.sin(altitude)\n            cam_pos = [X, Y, Z]\n\n            vector = rs.VectorCreate(centroid, cam_pos)\n            vector = rs.coerce3dvector(vector)\n\n            try:\n                if siteNumber!=None:\n                    filename = os.path.join(path,str(int(siteNumber))+layer)\n                else:\n                    filename = os.path.join(path,layer)\n\n                outdata=[]\n                outdata+=data\n                outdata+=[target]\n                outdata+=[vector]\n\n                f = open(filename, 'wb')\n                pickle.dump(outdata, f, -1)\n\n                f.close()\n                fcheck = open(filename,'rb')\n                checkdata = pickle.load(fcheck)\n                if len(checkdata)>2:\n                    geometry=checkdata[:-2]\n                    view_target=checkdata[-2]\n                    view_vector=checkdata[-1]\n                    status = \"View and geometry pickled successfully.\"\n                else:\n                    status = \"It looks like the file didn't save correctly. \\nTry the pickleData and UnpickleData components to debug.\"\n                fcheck.close()\n            except:\n                status = \"Unable to pickle the view file. \\nThe path your provided may be invalid.\"\n        else:\n            if not len(data)>0:\n                status = \"specify objects (data) in view to pickle.\"\n            if azimuth==None:\n                status = \"specify view angle azimuth.\"\n            if altitude==None:\n                status = \"specify view angle altitude.\"\n            if layer==None:\n                status = \"specify file layer name.\"\n            if path==None:\n                status = \"specify path to target directory\"\n            if write!=True:\n                status = \"set write to True to pickle view\"\n\n        # return outputs\n        return (geometry, view_vector, view_target, status)\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}