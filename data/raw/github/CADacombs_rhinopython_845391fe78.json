{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/xBrep_findMatchingFace.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "xBrep_findMatchingFace.py",
  "instruction": "160531-0602: Created by importing functions from other scripts.\r\n160607: Addition.\r\n160609: Mod.\r\n160611: Major additions for removeTrim.\r\n160612: Bug fix in addOuterLoop.\r\n160623: Added...",
  "code": "\"\"\"\r\n160531-0602: Created by importing functions from other scripts.\r\n160607: Addition.\r\n160609: Mod.\r\n160611: Major additions for removeTrim.\r\n160612: Bug fix in addOuterLoop.\r\n160623: Added retrimOneFaceBrep() and trimOneFaceBrepWithCurves().\r\n160630: Added some functions.\r\n160706: Moved some functions to another script.\r\n160707: Some functions now try to matching bounding boxes at ModelAbsoluteTolerance then, if necessary, 10*ModelAbsoluteTolerance.\r\n        Added a function.\r\n160708: Added a function.\r\n160725: Added a function.\r\n160819: Added indicesOfInvalidBrepFaces().\r\n160824: Fixed bug in orderedLists_AdjFLT_perSelFBorders and renamed to orderedLists_AdjacentFLT_perSelFBorders.\r\n160826: trimOneFaceBrepWithCurves(): Default value of bShrinkFaces changed from True to False.\r\n160829: removeTrim: Fixed initializing list bug.\r\n        Renamed ptOnFaceMinDistFromBorder() to ptOnFaceNotOnBorder and added default value for fDistMin.\r\n160831: Moved addOuterLoop, indicesOfTrimsNotToRemove, removeTrim to untrimLocal.py\r\n160901: Updated debugging.\r\n160902: tryExistingEdgeMatchingCurvx: Replaced length comparison with curve deviation check.\r\n160911: Moved orderedLists_AdjacentFLT_perSelFBorders to another script.\r\n170630: ptOnFaceNotOnBorder: Now skips faces whose AreaMassProperties.Compute's output is None.\r\n181020: Removed indicesOfInvalidBrepFaces.\r\n181029: addSenwEdgeTrimToLooX: Added code with intrvl.Swap() to avoid\r\n190128: Moved indicesOfContiguousFilletFaces to spbBrep.py.\r\n190129: Updated a comment.\r\n190201: Copied some code from spb_rc5\\brep.py.\r\n190505, 200107, 200401: Modified this history log.\r\n200505: Simplified a function.\r\n200522: Bug fix.\r\n\"\"\"\r\n\r\nimport Rhino\r\nimport Rhino.Geometry as rg\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\n\r\ndef epsilonEqualsBoundingBox(bBoxA, bBoxB, fTol=sc.doc.ModelAbsoluteTolerance):\r\n    \"\"\"\r\n    Created because BoundingBox structure does not contain an EpsilonEquals method.\r\n    \"\"\"\r\n    boxA = Rhino.Geometry.Box(bBoxA)\r\n    if not boxA: return\r\n    boxB = Rhino.Geometry.Box(bBoxB)\r\n    if not boxB: return\r\n    return boxA.EpsilonEquals(boxB, fTol)\r\n\r\n\r\ndef usingBoundingBoxOfBrep(rgBrep_toSearch, rgBrep_ForBBox, bDebug=False):\r\n    \"\"\"\r\n    rgBrep_ForBBox will most likely be a brep or a face.\r\n    \"\"\"\r\n    if bDebug: print 'xBrep_findMatchingFace.usingBoundingBoxOfBrep()...'\r\n    \r\n    rgBbox_B0 = rgBrep_ForBBox.GetBoundingBox(True)\r\n    \r\n    for e in 0,1:\r\n        fEpsEqTol = sc.doc.ModelAbsoluteTolerance * 10.**e\r\n        idx_rgFace_Pos = None\r\n        \r\n        # Test one bounding box of each face against bounding box of original brep.\r\n        for f, rgFace in enumerate(rgBrep_toSearch.Faces):\r\n            rgBrep1_1F = rgFace.DuplicateFace(False)\r\n            if rgBrep1_1F is None:\r\n                if bDebug: sPrint = 'rgBrep1_1F'; print sPrint + ':', eval(sPrint)\r\n                return\r\n            \r\n            bBox_SplitF = rgBrep1_1F.GetBoundingBox(True)\r\n            rgBrep1_1F.Dispose()\r\n            if bDebug:\r\n                sc.doc.Objects.AddBrep(rg.Brep.CreateFromBox(bBox_SplitF))\r\n                sc.doc.Views.Redraw()\r\n            \r\n            if epsilonEqualsBoundingBox(rgBbox_B0, bBox_SplitF, fEpsEqTol): # From geometry.py.\r\n                if idx_rgFace_Pos is None: idx_rgFace_Pos = f\r\n                else:\r\n                    idx_rgFace_Pos = None\r\n                    break\r\n        \r\n        if idx_rgFace_Pos is not None: return idx_rgFace_Pos\r\n\r\n\r\ndef usingBoundingBoxOfEdges(rgBrep_toSearch, rgBrep0_1F, bDebug=False):\r\n    if bDebug: print 'xBrep_findMatchingFace.usingBoundingBoxOfEdges()...'\r\n    \r\n    rgCrvs_B0Edges = rgBrep0_1F.DuplicateEdgeCurves() # Includes seams\r\n    \r\n    rgBbox_B0Crvs = None\r\n    for rgCrv in rgCrvs_B0Edges:\r\n        rgBbox = rgCrv.GetBoundingBox(True)\r\n        rgCrv.Dispose()\r\n        if rgBbox_B0Crvs is None: rgBbox_B0Crvs = rgBbox\r\n        else: rgBbox_B0Crvs.Union(rgBbox)\r\n    \r\n    for e in (0,1):\r\n        fEpsEqTol = sc.doc.ModelAbsoluteTolerance * 10.**e\r\n        idx_rgFace_Pos = None\r\n        \r\n        for f, rgFace in enumerate(rgBrep_toSearch.Faces):\r\n            rgBrep1_1F = rgFace.DuplicateFace(False)\r\n            rgFace.Dispose()\r\n            if rgBrep1_1F is None:\r\n                if bDebug: sPrint = 'rgBrep1_1F'; print sPrint + ':', eval(sPrint)\r\n                return\r\n            \r\n            rgCrvs_B1Edges = rgBrep1_1F.DuplicateEdgeCurves()\r\n            \r\n            rgBrep1_1F.Dispose()\r\n            \r\n            \"\"\" Test one bounding box for each complete set of edges of each face\r\n            against the bounding box of the splitting curves.\"\"\"\r\n            bBox_SplitEs = None\r\n            for rgCrv in rgCrvs_B1Edges:\r\n                rgBbox = rgCrv.GetBoundingBox(True)\r\n                rgCrv.Dispose()\r\n                if bBox_SplitEs is None: bBox_SplitEs = rgBbox\r\n                else: bBox_SplitEs.Union(rgBbox)\r\n            \r\n            if epsilonEqualsBoundingBox(rgBbox_B0Crvs, bBox_SplitEs, fEpsEqTol): # From geometry.py.\r\n                if idx_rgFace_Pos is None: idx_rgFace_Pos = f\r\n                else:\r\n                    idx_rgFace_Pos = None\r\n                    break\r\n        \r\n        if idx_rgFace_Pos is not None: return idx_rgFace_Pos\r\n\r\n\r\ndef usingPointOnFace(rgBrep_toSearch, ptOnFace, bDebug=False):\r\n    \"\"\"\r\n    Returns face index.\r\n    \"\"\"\r\n    for rgFace in rgBrep_toSearch.Faces:\r\n        b, u, v = rgFace.ClosestPoint(ptOnFace)\r\n        if b:\r\n            print rgFace.IsPointOnFace(u, v)\r\n            if rgFace.IsPointOnFace(u, v):\r\n                return rgFace.FaceIndex\r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}