{
  "source_url": "https://github.com/fstwn/ghautoknit/blob/5ca6d07df601d34be5a67fe6c76a942daef50a85/usrobj_src/GHAutoknit_RunAutoknitFromFiles.py",
  "repo": "fstwn/ghautoknit",
  "repo_stars": 3,
  "repo_description": "A prototypical bridge between Grasshopper and Autoknit.",
  "license": "MIT",
  "filepath": "usrobj_src/GHAutoknit_RunAutoknitFromFiles.py",
  "instruction": "Run Autoknit as a threaded subprocess from specified files.\nTODO: update docstring\n    Inputs:\n        Run: Connect a button and set to true to start the autoknit instance {item, boolean}\n       ...",
  "code": "\"\"\"\nRun Autoknit as a threaded subprocess from specified files.\nTODO: update docstring\n    Inputs:\n        Run: Connect a button and set to true to start the autoknit instance {item, boolean}\n        obj: Path to the *.obj file to read the model from {item, str}\n        constraints: Path to the *.cons file to read the constraints from {item, str}\n        obj_scale: {item, float}\n        stitch_width: {item, float}\n        stitch_height: {item, float}\n        save_traced: Path where the traced file (*.st) should be saved when peeling is finished {item, str}\n        peel_step: Number of steps to peel the model. -1 will peel the whole model {item, int}\n    Outputs:\n        R: Boolean identifying if this autoknit instance is currently running or not {item, bpolean}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 211029\n\"\"\"\n\n# PYTHON STANDARD LIBRARY IMPORTS\nfrom __future__ import division\nimport subprocess\nimport threading\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# CUSTOM RHINO IMPORTS\nfrom scriptcontext import sticky as st\n\n# LOCAL MODULE IMPORTS\nimport ghautoknit as ghak\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"RunAutoknitFromFiles\"\nghenv.Component.NickName =\"RAFF\"\nghenv.Component.Category = \"GHAutoknit\"\nghenv.Component.SubCategory = \"3 Run Autoknit\"\n\nclass RunAutoknitFromFiles(component):\n    \n    def RunScript(self, Run, obj, constraints, obj_scale, stitch_width, stitch_height, save_traced, peel_step):\n        \n        # SETUP CODE -----------------------------------------------------------\n        \n        running_key, reset_key = ghak.Engine.InitializeComponentInterface(self)\n        \n        if running_key not in st:\n            st[running_key] = False\n        if reset_key not in st:\n            st[reset_key] = False\n        \n        # THREADED FUNCTION DEFINTION ------------------------------------------\n        \n        # define threaded call function\n        def threaded_call():\n            retcode = subprocess.call(Command)\n            st[running_key] = False\n            st[reset_key] = True\n            \n            self.ExpireSolution(True)\n            return retcode\n        \n        # COMMAND COMPILATION --------------------------------------------------\n        \n        Command = ghak.Engine.CompileCommand(obj,\n                                            constraints,\n                                            obj_scale,\n                                            stitch_width,\n                                            stitch_height,\n                                            save_traced,\n                                            peel_step)\n        \n        # throw runtime message and abort if path is not set correctly!\n        if not Command:\n            rml = self.RuntimeMessageLevel.Warning\n            self.AddRuntimeMessage(rml, \"_AK_RAW_PATH_ is not set correctly! \" +\n                                        \"Please open Environment.py and set \" +\n                                        \"the path to your autoknit \" +\n                                        \"installation.\\nCurrent path is:\\n\" +\n                                        ghak.Environment._AK_PATH_)\n            return False\n        \n        # START AUTOKNIT THREAD ------------------------------------------------\n        \n        if Run and st[running_key] is False:\n            # make thread and start it\n            thread = threading.Thread(target=threaded_call)\n            thread.start()\n            # set keys\n            st[running_key] = True\n            st[reset_key] = False\n        \n        if st[reset_key] is True:\n            st[running_key] = False\n        \n        # return info about running autoknit thread\n        R = st[running_key]\n        self.Message = \"Autoknit Running: \" + str(st[running_key])\n        \n        # return outputs if you have them; here I try it for you:\n        return R",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}