{
  "source_url": "https://github.com/ladybug-tools/honeybee-legacy/blob/bd62af4862fe022801fb87dbc8794fdf1dff73a9/src/Honeybee_generationsystem.py",
  "repo": "ladybug-tools/honeybee-legacy",
  "repo_stars": 129,
  "repo_description": ":bee: Honeybee is a free and open source plugin to connect Grasshopper3D to EnergyPlus, Radiance, Daysim and OpenStudio for building energy and daylighting simulation",
  "license": "NOASSERTION",
  "filepath": "src/Honeybee_generationsystem.py",
  "instruction": "Use this component to create a Honeybee generator system.",
  "code": "#\n# Honeybee: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n# \n# This file is part of Honeybee.\n# \n# Copyright (c) 2013-2020, Anton Szilasi - Icon by Djordje Spasic <ajszilas@gmail.com> \n# Honeybee is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# Honeybee is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with Honeybee; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n\n\"\"\"\n\nUse this component to create a Honeybee generator system.\n\n-\nProvided by Honeybee 0.0.66\n\n    Args:\n        _GeneratorSystemName: The name of this Honeybee generation system please make it unique!\n        _MaintenanceCost: The annual cost of maintaining this Honeybee generation system in US dollars (Other currencies will be available in the future)\n        PVHBSurfaces_: The Honeybee/context surfaces that contain PV generators to be included in this generation system\n        HBGenerationObjects_: Honeybee batteries or wind turbines to be included in this generation system \n            \n    Returns:\n        HBGeneratorSystem: The Honeybee generation system - connect this to the input HB_generators on the Honeybee_Run Energy Simulation component to include this generation system in an EnergyPlus simulaton\n        \n\"\"\"\n\nghenv.Component.Name = \"Honeybee_generationsystem\"\nghenv.Component.NickName = 'generationsystem'\nghenv.Component.Message = 'VER 0.0.66\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"HB-Legacy\"\nghenv.Component.SubCategory = \"09 | Energy | HVACSystems\"\n#compatibleHBVersion = VER 0.0.56\\nFEB_01_2015\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"0\"\nexcept: pass\n\nimport scriptcontext as sc\n\nimport scriptcontext as sc\nimport uuid\nimport Grasshopper.Kernel as gh\nimport itertools\n\nglobal _MaintenanceCost\n_MaintenanceCost = 300\n\n\ndef checHBgenobjects(PVHBSurfaces_,HBGenerationObjects_):\n    \n    try:\n        PV_generation = hb_hive.callFromHoneybeeHive(PVHBSurfaces_)\n        \n    except:\n        \n        print \"Only PVHBSurfaces_ from the Honeybee_Generator_PV component can be connected to PVHBSurfaces_!\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"Only PVHBSurfaces_ from the Honeybee_Generator_PV component can be connected to PVHBSurfaces_!\")\n        return -1\n        \n    try:\n        HB_generation = hb_hivegen.callFromHoneybeeHive(HBGenerationObjects_)\n        \n    except:\n        print \"Only HB_batteries and HB_windturbines can be connected to HBGenerationObjects_!\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"Only HB_batteries and HB_windturbines can be connected to HBGenerationObjects_!\")\n        return -1\n\ndef checktheinputs(_GeneratorSystemName,PVHBSurfaces_,HBGenerationObjects_,_MaintenanceCost):\n    \n    if not sc.sticky.has_key(\"honeybee_release\") or not sc.sticky.has_key(\"honeybee_ScheduleLib\"):\n        print \"You should first let the Honeybee fly...\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"You should first let the Honeybee fly...\")\n\n        return -1\n\n    try:\n        if not sc.sticky['honeybee_release'].isCompatible(ghenv.Component): return -1\n        if sc.sticky['honeybee_release'].isInputMissing(ghenv.Component): return -1\n    except:\n        \n        warning = \"You need a newer version of Honeybee to use this compoent.\" + \\\n        \"Use updateHoneybee component to update userObjects.\\n\" + \\\n        \"If you have already updated userObjects drag Honeybee_Honeybee component \" + \\\n        \"into canvas and try again.\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, warning)\n        return -1    \n        \n    if _GeneratorSystemName == None:\n        \n        print \"Please specify a name for this generator system and make sure it is not the same as another generation system!  \"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"Please specify a name for this generator system and make sure it is not the same as another generation system!\")\n        return -1\n    \n\n    # If no inputs do not let the component run and output something other than Null\n    # will cause problems in Run Energy Simulation \n    if PVHBSurfaces_ == [] and HBGenerationObjects_ == []:\n        \n        warn =  \"A Honeybee generation system cannot be created without Honeybee generators! \\n\"+ \\\n        \"Please connect Wind turbines to HBGenerationObjects_ or PV generators to PVHBSurfaces_ to create a Honeybee generation system.\"\n        \n        print warn\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, warn)\n        \n        return -1\n    \n    # Must also check that the first item is not a none otherwise will output a HB generator\n    # when the first item is None and cause Energy Plus to crash!\n    try:\n        if PVHBSurfaces_[0] == None:\n            return -1\n    except:\n        pass\n        \n    try:\n        if HBGenerationObjects_[0] == None:\n            return -1\n    except:\n        pass\n        \n\n\n            \ndef checkbattery(HB_generation):\n    \n    # Check that there is only one battery connected to this component\n    batterycount = 0\n    \n    for HBgenobject in HB_generation: \n        \n        if HBgenobject.type == 'Battery:simple': \n            \n            batterycount = batterycount +1 \n            \n        \"\"\"\n        if isinstance(HBgenobject,sc.sticky[\"battery\"]): # XXX need to create ElectricLoadCenter:Storage:Battery\n            \n            batterycount = batterycount +1\n        \"\"\"\n            \n    if batterycount > 1:\n        print \"There can only be one battery for each generation system. Please make sure only one battery is connected to this component\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"There can only be one battery for each generation system! Please make sure only one battery is connected to this component\")\n        return -1\n        \n\n    \n    # Need a check only generators of certain types can be in the same list - AC,DC\n        \n       \n# check only one inverter for this generation system\n# Make sure that all the inverters for all the PV generators connected to this simulation are the same.\n\n\ndef main(PV_generation,HB_generation,_MaintenanceCost):\n    \n    simulationinverters = []  # The inverter for this generator system - (only one)\n    PVgenerators = [] \n    windgenerators = []\n    fuelgenerators = []\n    \n    HBgencontextsurfaces = []\n    HBzonesurfaces = []\n    \n    battery = None\n    HB_generators = [] # Called HB_generators even though will only ever be one Honeybee_generator\n    \n    # For Honeybee surfaces with PV generators attached to them append PVgenerators and inverter to HB_generator object\n    # XXX rework code so PV generators and other generators can share the same input.\n    \n    for HBgenobject in PV_generation:\n        \n        #print HBgenobject\n        if HBgenobject.containsPVgen == True:\n            \n            try:\n                HBgenobject.type\n                \n                if HBgenobject.type == 6:\n                    \n                    HBgencontextsurfaces.append(HBgenobject)\n\n                else:\n                    \n                    HBzonesurfaces.append(HBgenobject)\n                    \n            except AttributeError:\n                pass\n\n            for PVgen in HBgenobject.PVgenlist:\n\n                PVgenerators.append(PVgen)\n                \n                # Append the inverter of each PV generator to the list\n                simulationinverters.extend(PVgen.inverter)\n    \n    def checkduplicatesPVgenerators(PVgenerators):\n        \n        seen = set(PVgenerators)\n        uniq = []\n        for PVgen in PVgenerators:\n            if PVgen not in seen:\n                uniq.append(x)\n                seen.add(x)\n                \n        if len(PVgenerators) != len(seen):\n            print \"Duplicate PVgenerators detected,Please make sure you are not connecting the same PV generators twice!\"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, \"Duplicate PVgenerators detected,Please make sure you are not connecting the same PV generators twice! \")\n            return -1 \n            \n    def checkinverter(simulationinverters): \n        if all(inverter.ID == simulationinverters[0].ID for inverter in simulationinverters) == False: \n            print \"Each generator system can only have one inverter servicing all the PV generators, make sure all connected PV have the same inverter! \"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, \"Each generator system can only have one inverter servicing all the PV generators, make sure all connected PV have the same inverter!\")\n            return -1\n\n    # Check for duplicate PVgenerators\n    if checkduplicatesPVgenerators(PVgenerators) != -1:\n\n    # Checking that all PV generators have the same inverter if not component will stop\n        if checkinverter(simulationinverters) != -1:\n            \n            for HBgenobject in HB_generation:\n                \n                if HBgenobject.type == 'Battery:simple':  \n                    # The battery for this generation system (only one)\n                    \n                    global battery\n                    battery = HBgenobject\n                    \n                if HBgenobject.type == 'Generator:WindTurbine':\n                    \n                    windgenerators.append(HBgenobject)\n                    \n                # XXX if fuel generator append to fuelgenerator list\n    \n            # Make sure that PV generators, Wind generators and Fuel generatos CANNOT be in the same list as according to EnergyPlus documentation\n        \n            def PVwindandbattery(PVgenerators,windgenerators,battery):\n        \n                if PVgenerators == [] and windgenerators == [] and battery != None:\n                    \n                    print \"Only a battery has been detected please connect generators to this component! \"\n                    w = gh.GH_RuntimeMessageLevel.Warning\n                    ghenv.Component.AddRuntimeMessage(w, \"Only a battery has been detected please connect generators to this component! \")\n                    return -1 \n                \n            def PVandwind(PVgenerators,windgenerators):\n                \n                if PVgenerators != [] and windgenerators != []:\n                    \n                    print \"Please ensure that only one type of generator (PV or Wind) is connected to this component \"\n                    w = gh.GH_RuntimeMessageLevel.Warning\n                    ghenv.Component.AddRuntimeMessage(w, \"Please ensure that only one type of generator (PV or Wind) is connected to this component \")\n                    return -1\n            \n            def windandfuel(windgenerators,fuelgenerators):\n                \n                if windgenerators != [] and fuelgenerators != []:\n                    \n                    print \"Please ensure that only one type of generator (PV or Wind) is connected to this component \"\n                    w = gh.GH_RuntimeMessageLevel.Warning\n                    ghenv.Component.AddRuntimeMessage(w, \"Please ensure that only one type of generator (PV or Wind) is connected to this component \")\n                    return -1\n            \n            def PVandfuel(PVgenerators,fuelgenerators):\n                \n                if PVgenerators != [] and fuelgenerators != []:\n            \n                    print \"Please ensure that only one type of generator (PV or Wind) is connected to this component \"\n                    w = gh.GH_RuntimeMessageLevel.Warning\n                    ghenv.Component.AddRuntimeMessage(w, \"Please ensure that only one type of generator (PV or Wind) is connected to this component \")\n                    return -1\n                \n            def windandbat(windgenerators,battery):\n                \n                if windgenerators != [] and battery != None:\n                    \n                    print \"Batteries cannot be connected to an AC system please disconnect the battery from this component!\"\n                    w = gh.GH_RuntimeMessageLevel.Warning\n                    ghenv.Component.AddRuntimeMessage(w, \"Batteries cannot be connected to an AC system please disconnect the battery from this component!\")\n                    return -1\n                    \n            if PVwindandbattery(PVgenerators,windgenerators,battery) != -1:\n                    \n                    if PVandwind(PVgenerators,windgenerators) != -1:\n                        \n                        if windandfuel(windgenerators,fuelgenerators) != -1:\n                            \n                            if PVandfuel(PVgenerators,fuelgenerators) != -1:\n                                \n                                if windandbat(windgenerators,battery) != -1:\n\n                                    HB_generators.append(HB_generator(_GeneratorSystemName,simulationinverters,battery,windgenerators,PVgenerators,fuelgenerators,HBgencontextsurfaces,HBzonesurfaces,_MaintenanceCost))\n\n                                    HB_generator1 = hb_hivegen.addToHoneybeeHive(HB_generators,ghenv.Component.InstanceGuid.ToString() + str(uuid.uuid4()))\n                                    \n                                    return HB_generator1\n        \n\nif checktheinputs(_GeneratorSystemName,PVHBSurfaces_,HBGenerationObjects_,_MaintenanceCost) != -1:\n\n    hb_hive = sc.sticky[\"honeybee_Hive\"]()\n    hb_hivegen = sc.sticky[\"honeybee_generationHive\"]()\n    HB_generator = sc.sticky[\"HB_generatorsystem\"]\n    wind_generator = sc.sticky[\"wind_generator\"]\n\n    if checHBgenobjects(PVHBSurfaces_,HBGenerationObjects_) != -1:\n   \n        PV_generation = hb_hive.callFromHoneybeeHive(PVHBSurfaces_)\n        \n        HB_generation = hb_hivegen.callFromHoneybeeHive(HBGenerationObjects_)\n\n        if checkbattery(HB_generation) != -1:\n        \n                HBGeneratorSystem = main(PV_generation,HB_generation,_MaintenanceCost)\n\n",
  "language": "python",
  "imports": [
    "scriptcontext"
  ],
  "has_docstring": true
}