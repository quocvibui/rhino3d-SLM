{
  "source_url": "https://discourse.mcneel.com/t/extrusion-bounding-box-behaviour-different-in-rhino-7-and-rhino-8/210720",
  "topic_id": 210720,
  "title": "Extrusion Bounding Box behaviour different in Rhino 7 and Rhino 8",
  "question": "Hi,\n\n\nWe are working on upgrading one of our Rhino plugins from Rhino 7 to Rhino 8. We came across this bug with extrusion objects and bounding boxes.\n\n\nIf you run the code below on Rhino 7 you will get a a bounding box that correctly fits the geometry. However, if you run the same code in Rhino 8, you get an incorrect bounding box that is way too big.\n\n\n\t\tvar rhinoDoc = RhinoDoc.ActiveDoc;\n\n\t\tvar polylineCurve = new PolylineCurve(new Polyline()\n\t\t{\n\t\t\tnew(0, 0, 0),\n\t\t\tnew (3271, 1947, 0),\n\t\t\tnew (3348, 1993, 0),\n\t\t\tnew (3339, 2368, 0),\n\t\t\tnew (-7217, 2368, 0),\n\t\t\tnew (-8527, 1295, 0),\n\t\t\tnew (-5107, 0, 0),\n\t\t\tnew (0, 0, 0),\n\t\t});\n\t\tvar extrusion = Extrusion.Create(polylineCurve, 37, true);\n\n\t\tvar localPlane = new Plane(\n\t\t\tPoint3d.Origin,\n\t\t\tnew Vector3d(0.8592956334680628, 0.5114792413214057, 0),\n\t\t\tnew Vector3d(-0.5114792413214057, 0.859295633468062, 0)\n\t\t);\n\n\t\tvar grainPlane = new Plane(localPlane);\n\t\tgrainPlane.Rotate(5.2093745710934982, Vector3d.ZAxis);\n\n\t\tvar transform = Transform.ChangeBasis(Plane.WorldXY, localPlane);\n\t\textrusion.Transform(transform);\n\n\t\tvar id = rhinoDoc.Objects.Add(extrusion);\n\t\t// extrusion = rhinoDoc.Objects.FindGeometry(id) as Extrusion;\n\n\t\tvar box = new Box(grainPlane, extrusion);\n\t\tvar brep = box.ToBrep();\n\n\t\trhinoDoc.Objects.Add(brep);\n\n\n\nOn Rhino 7 it will look like this. The bounding box is in green.\n\n\nimage\n1294×1021 33.4 KB\n\n\nOn Rhino 8 it will instead look like this.\n\n\nimage\n1630×1500 107 KB\n\n\nIt seems to resolve itself if you retrieve the object that was added to the rhinoDoc. You can do so by uncommenting the commented line in the code above.\n\n\nI checked the breps generated by the extrusion and the second extrusion created when added to the Rhino document. Both seem identical according to GeometryBase.GeometryEquals. Our internal brep hashing code also shows that they are identical. I also tried to generate the box with Extrusion.GetBoundingBox but is has the same result.\n\n\nIn case it matters, this was tested on Rhino 8.19.25...",
  "code_blocks": [
    {
      "code": "var rhinoDoc = RhinoDoc.ActiveDoc;\n\n\t\tvar polylineCurve = new PolylineCurve(new Polyline()\n\t\t{\n\t\t\tnew(0, 0, 0),\n\t\t\tnew (3271, 1947, 0),\n\t\t\tnew (3348, 1993, 0),\n\t\t\tnew (3339, 2368, 0),\n\t\t\tnew (-7217, 2368, 0),\n\t\t\tnew (-8527, 1295, 0),\n\t\t\tnew (-5107, 0, 0),\n\t\t\tnew (0, 0, 0),\n\t\t});\n\t\tvar extrusion = Extrusion.Create(polylineCurve, 37, true);\n\n\t\tvar localPlane = new Plane(\n\t\t\tPoint3d.Origin,\n\t\t\tnew Vector3d(0.8592956334680628, 0.5114792413214057, 0),\n\t\t\tnew Vector3d(-0.5114792413214057, 0.859295633468062, 0)\n\t\t);\n\n\t\tvar grainPlane = new Plane(localPlane);\n\t\tgrainPlane.Rotate(5.2093745710934982, Vector3d.ZAxis);\n\n\t\tvar transform = Transform.ChangeBasis(Plane.WorldXY, localPlane);\n\t\textrusion.Transform(transform);\n\n\t\tvar id = rhinoDoc.Objects.Add(extrusion);\n\t\t// extrusion = rhinoDoc.Objects.FindGeometry(id) as Extrusion;\n\n\t\tvar box = new Box(grainPlane, extrusion);\n\t\tvar brep = box.ToBrep();\n\n\t\trhinoDoc.Objects.Add(brep);",
      "language": "csharp",
      "author": "SK-Structurecraft",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "geometry",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 9,
  "views": 154
}