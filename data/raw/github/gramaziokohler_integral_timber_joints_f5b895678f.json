{
  "source_url": "https://github.com/gramaziokohler/integral_timber_joints/blob/d543a28ccfaeb8a56ff692a29d5510c3e649477f/src/integral_timber_joints/rhino/debug_planning_not_reaching_target.py",
  "repo": "gramaziokohler/integral_timber_joints",
  "repo_stars": 11,
  "repo_description": "Robotic Assembled Timber Structures with Integral Timber Joints",
  "license": "MIT",
  "filepath": "src/integral_timber_joints/rhino/debug_planning_not_reaching_target.py",
  "instruction": "Debug planning not reaching target",
  "code": "import Rhino  # type: ignore\nimport rhinoscriptsyntax as rs\nimport scriptcontext\nimport re\nimport os\n\nfrom integral_timber_joints.rhino.process_artist import ProcessArtist\nfrom integral_timber_joints.rhino.load import get_process, get_process_artist, process_is_none, get_activedoc_process_path\nfrom integral_timber_joints.rhino.assembly_artist import AssemblyNurbsArtist\nfrom integral_timber_joints.process import RobotClampAssemblyProcess\nfrom integral_timber_joints.process import ComputationalResult\nfrom integral_timber_joints.assembly import BeamAssemblyMethod\nfrom integral_timber_joints.process import Movement, RobotClampAssemblyProcess, RoboticMovement\n\nfrom compas_rhino.utilities import clear_layer, delete_objects, draw_mesh\n\ntry:\n    from typing import Dict, List, Optional, Tuple\n\n    from integral_timber_joints.process import RFLPathPlanner\nexcept:\n    pass\n\nfrom compas.geometry import Transformation, Frame\n\nif __name__ == '__main__':\n    process = get_process()\n    artist = get_process_artist()\n    from integral_timber_joints.rhino.visualize_trajectory import load_selected_external_movment_if_exist\n\n    # * Load all external movements\n    for i, movement in enumerate(process.movements):\n        print (\"Loading Movement #%s\" % i)\n\n        external_movement_path = os.path.join(get_activedoc_process_path(), '..\\\\results')\n        process.load_external_movement(external_movement_path, movement, subdir='movements', verbose=False)\n\n\n    # * Check Final trajectory point and\n\n    for i, movement in enumerate(process.movements):\n        # if i > 500:\n        #     continue\n\n        if not isinstance(movement, RoboticMovement):\n            continue\n\n        if movement.trajectory is None:\n            print (\"Movement #%s (%s) is RoboticMovement but no Trajectory\" % (i, movement.movement_id))\n            continue\n\n        # * Forward Kinematics from robot Config\n        configuration = movement.trajectory.points[-1]\n        configuration = process.robot_initial_config.merged(configuration)\n        trajectory_frame = process.robot_model.forward_kinematics(configuration.scaled(1000), process.ROBOT_END_LINK)\n\n        # * Compare with Robot Target Frame\n        target_frame = movement.target_frame\n        distance = target_frame.point.distance_to_point(trajectory_frame.point)\n        distance_threshold = 0.5 # mm scale\n        if distance> distance_threshold:\n            print (\"Movement #%s (%s) Target to FK distance : %smm\" % (i, movement.movement_id, distance))\n            print (\" - %s\" % (movement.tag) )\n\n        # * Compare with tool_changer Target Frame\n        target_frame = process.get_movement_end_scene(movement)['tool_changer', 'f']\n        distance = target_frame.point.distance_to_point(trajectory_frame.point)\n        distance_threshold = 0.5 # mm scale\n        if distance> distance_threshold:\n            print (\"Movement #%s (%s) Target to FK distance : %smm\" % (i, movement.movement_id, distance))\n            print (\" - %s\" % (movement.tag) )\n\n        # * Compare Robot Target Frame and Tool Changer Frame\n        # target_frame_tc = process.get_movement_end_scene(movement)['tool_changer', 'f']\n        # target_frame_rob = process.get_movement_end_scene(movement)['robot', 'f']\n        # distance = target_frame_tc.point.distance_to_point(target_frame_rob.point)\n        # distance_threshold = 0.01 # mm scale\n        # if distance> distance_threshold:\n        #     print (\"Movement #%s (%s) Rob Target to TC Target : %smm\" % (i, movement.movement_id, distance))\n        #     print (\" - %s\" % (movement.tag) )\n\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}