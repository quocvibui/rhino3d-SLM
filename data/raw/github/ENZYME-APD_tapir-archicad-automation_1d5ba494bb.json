{
  "source_url": "https://github.com/ENZYME-APD/tapir-archicad-automation/blob/3cc4d67228a62381d6cf7d9c0c3897171044ace2/sandbox/grasshopper-plugin/src/wip.py",
  "repo": "ENZYME-APD/tapir-archicad-automation",
  "repo_stars": 94,
  "repo_description": "The easiest way to use the JSON/Python API from Archicad without knowing how to code.",
  "license": "MIT",
  "filepath": "sandbox/grasshopper-plugin/src/wip.py",
  "instruction": null,
  "code": "#!/usr/bin/env ipy\n# -*- coding: utf-8 -*-\n\n__all__ = [\"ExportCode_Component\",\n           \"StealIcon_Component\",\n           \"ClassificationItem_Component\"]\n\n# - - - - - - - - BUILT-IN IMPORTS\nimport System\nimport os, traceback\n\n# - - - - - - - - LOCAL IMPORTS\nimport tapir, tapir_py\n\n# - - - - - - - - RH/GH IMPORTS\nfrom  ghpythonlib.componentbase import dotnetcompiledcomponent as component\nfrom ghpythonlib.treehelpers import list_to_tree\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\nimport Rhino, Grasshopper, GhPython\n        \n# - - - - - - - - COMPONENT\nclass ExportCode_Component(component):\n    \n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls, \"ExportCode\", \"ExportCode\", \"\"\"Extracts code from a GhPython Script component, and provides option to export to .py file.\"\"\", \"tAPIr\", \"00 WIP\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"d2a22074-0167-4365-a93b-924680662805\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n\n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"GhPython\", \"G\", \"GhPython Script component.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"Code\", \"C\", \"Code as multiline text.\")\n        self.Params.Output.Add(p)\n        \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        result = self.RunScript(p0)\n\n        if result is not None:\n            self.marshal.SetOutput(result, DA, 0, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKCSURBVHgB3ZWxbxJxFMff73pWht6FmJCQXmKOBY4cFRzExEUC1c3YzUUL/4HdLMWhThonh1ZXIc5yHY09pGMPE2oq5UiHdmh1IRFhtffz/a45ShSOa3Cxn4Tc7/fu3ff9fu+9PAD+d8ioF9Fo7LEFkOMAZArgR8cO7g/BIqut1u4GTIKizN1OZ+7S7W2Dvi9rlNHtdunHTZ0mb976IcsJv1ctboQ9lEzewEAKGEbNNgiCAPOZNNrCfp/vVwI8MjW4kWXZHwxefQBgpQRRTFz2TYMkzYIoiCCKgu2jaRtwdPS9EwgEg4HAlU673f7pFoB3FnhamRC+fn/hXv/6hvHZfkqzkh3IYf5OaknAoLpeYelMmebuFowjEo2Vi8USHcdiNmfXhvEW/SORWNlNlxtYpDKYYzeOj7/ZPyddrCaEo6716KeItaIkSf0Xa+uvoVR6B71er29jhV589NAuPuPUn8ieArA+RzE/EymiMMuvvvnBFh1Ft9tjB+u4BeAGbrBjGIa9rlR0yC8/cRVn6JUKNhxUwcsNgJLV5y9eVptmy87zIGxf1rS/PmYta1nWM/AS4LTVpkLra2+yGC2HJvnMjZ6dGlPX3GtphMAObrf29/fYE+uiHphmIwReUKKxT04rOuRXCva4WM4XKIplh3xDh2kNHRXU4rSVwlMwarW+LZ1OQ9M0oYY2Qqar4JGR01RRrmUJZy3NzAgJ1vesY7DLqtQir4ZNU3YDs/mVwHlhk5ONkXETdFSKJiISUevhsBofDKCqahzHTt3x4WACeB7/kDjQnCBM/ATrx3OXco7P+XP2B7boCWhYeRnlDqc4fqHRqH+BfwkLokTnDlT1ehwuHL8BoJMgDHftTCsAAAAASUVORK5CYII=\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    def __init__(self):\n        self.code = \"\"\n    \n    def RunScript(self, component):\n        self.code = \"\"\n        if self.Params.Input.Count == 0 or self.Params.Input[0].Sources.Count == 0:\n            self.AddRuntimeMessage(RML.Warning, \"Connect a GhPython Script component.\")\n            \n        else:\n            input_sources = self.Params.Input[0].Sources\n            target_component = None\n            \n            if input_sources[0].Attributes.IsTopLevel:\n                target_component = input_sources[0]\n            else:\n                target_component = input_sources[0].Attributes.GetTopLevel.DocObject\n            \n            if isinstance(target_component, GhPython.Component.ZuiPythonComponent):\n                self.code = target_component.Code\n            else:\n                self.AddRuntimeMessage(RML.Error, \"Input is not a GhPython Script component.\")\n        \n        return self.code\n    \n    def OnExportClick(self, sender, args):\n        file_dialog = Rhino.UI.SaveFileDialog()\n        file_dialog.Title = \"Export Python FIle\"\n        file_dialog.Filter = \"Python files (*.py)|*.py\";\n        file_dialog.ShowDialog()\n\n        if file_dialog.FileName != \"\":\n            with open(file_dialog.FileName, 'wt') as file:\n                file.write(self.code)\n            Rhino.RhinoApp.WriteLine(\"File Exported Successfully!\\n{}\".format(file_dialog.FileName))\n    \n    def AppendAdditionalMenuItems(self, items):\n        component.AppendAdditionalMenuItems(self , items)\n        if self.code == \"\":\n            return\n        try:\n            export_menu_item = items.Items.Add('Export Python FIle', None, self.OnExportClick)\n        except Exception as ex:\n            System.Windows.Forms.MessageBox.Show(traceback.format_exc(), ex)\n\nclass StealIcon_Component(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls, \"StealIcon\", \"StealIcon\", \"\"\"Extracts 24x24 icon from input component.\"\"\", \"tAPIr\", \"00 WIP\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"503f8223-189d-4a84-8e32-6ebf10afeab6\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_String()\n        self.SetUpParam(p, \"file\", \"source\", \"Script variable Python\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"stream\", \"stream\", \"Script output stream.\")\n        self.Params.Output.Add(p)\n        \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        result = self.RunScript(p0)\n\n        if result is not None:\n            self.marshal.SetOutput(result, DA, 0, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIOSURBVHgB3VW/T9tAFH4X+cxCoswNg2mp1DBlqenY4mQm6V6ZuQW1WyEg8R/wQyHMiRgQDBB2AqwwZYIx+Q9AZMJn5fHOcHF+YZwwwSed/PTO/r6753ffAbx1sKBJRIwLIWxk7DtjLEUJ42mqhgANhljRdb0Mo8B13TlHiBsaGDTuHafuOI49FDl9uPEScZ+QEGuhyOWLw5J3jI1ePtZTFruFWJJxs9n0ctFoFIZBhLGspmnHAwUc162rH/ljNgPTyS+wuPiHRGKQSHyAkLjlmjZJTXHbJbC+vmWPR8dL1eopXF1ft3egIHcynUyCZc1CJmORYOJ5CcR/1F1bXQLGp6kjQJaFkPiZy3q7GyRELVwZ4zwn40g722JGEKHcgVy9wuFRxStjoVDse5fOR0rFvgCDVAA/fJsxYXVluS9f2C7C/6V8j4K/WL9EHz8jvALz9i/I5/0F6Jx73JEO2QaMANVdpfIuXFxcqnRNBR0latVgCJjmV9gpFuDs9AQWFn57uZNq1XtKn2rTqoBK9JcemxCwUtM0YYaI0+k0xGLdB/DurunnEOeVCfoChhGHCK9TGM9RC6YtC5J00CQmJgJ6vgfkwI0xXZ8cOGkYU3N7+wf4Ci/CF51VjOCkaoiwjipGcFQxwEkDIZ1Vml8I8ht5OT3Hw8II0Y+THmVQ+z2edsbkdVmj/DnnvKyc833iAbpECjpFWScMAAAAAElFTkSuQmCC\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    def set_icon(self, bitmap):\n        self.SetIconOverride(bitmap)\n        memory_stream = System.IO.MemoryStream()\n        bitmap.Save(memory_stream, System.Drawing.Imaging.ImageFormat.Png)\n        stream = System.Convert.ToBase64String(memory_stream.ToArray())\n        return stream\n    \n    def RunScript(self, source):\n        \n        sources = self.Params.Input[0].Sources\n        \n        if source and os.path.isfile(source):\n            bitmap = System.Drawing.Bitmap(source)\n            return self.set_icon(bitmap)\n        \n        elif sources:\n            source = sources[0].Attributes.GetTopLevel.DocObject\n            bitmap = source.Icon_24x24\n            return self.set_icon(bitmap)\n        \n        else:\n            bitmap = None\n            self.set_icon(self.get_Internal_Icon_24x24())\n            self.AddRuntimeMessage(RML.Warning, \"No Input\")\n            return \n\nclass ClassificationItem_Component(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls, \"ClassificationItem\", \"ClassificationItem\", \"\"\"ClassificationItem\"\"\", \"tAPIr\", \"00 WIP\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"608cd6d6-01be-4ef2-87cb-8760dcf4c859\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"classification\", \"classification\", \"Script variable Python\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.tree\n        self.Params.Input.Add(p)\n        \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"children\", \"children\", \"Script output children.\")\n        self.Params.Output.Add(p)\n        \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        result = self.RunScript(p0)\n\n        if result is not None:\n            self.marshal.SetOutput(result, DA, 0, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAALEgAACxIB0t1+/AAAAZ1JREFUSEvdlT1PwlAUhvkJ/IQrgpsxcSVE/wGbEh0YDOpG1Dijzlp01Tj7sTCJ7OrcRHZbdqEzt02u5zSn3NIe+uHIm7xJc3rPc+5XTwvLLaVUUUrZnrpuT3qeJV1XkU0/JmWThuaX53l1ADkhKOuplFbuQpDYjYLSDCvqUHqycCAHyOguYXjBtjSDwePJxHcoOZNxawkXV/ggq7Vt1To8Vt/DobLsUQyUYAcvByG1DOOuef/wqHYb+2p9Y1OJUmXOGMN3OMaybQ6sDTePsFpitdyLQpN8ena+sBBeYcJqiZWKyYEC4woOWkex+I1xGy8CV5ewWtHEqPE8cMbcuxNYTbQIYbW4xDy+uLxKK7BmcYlprta2Zs8fn19BAZOwWnkPeaexp/rvAx94bXT9WIdWwR9yqdIOA6LGmeJeP7+8qt9x/AOci3G9SQhRBJCDMAS99Qfqx7J9h0FpxuZHyLiEKNefYIZcYmandVb3H500MORm66g4kAMkGSdG6dnkd9b5v9giO4kdNE1YCGbXA5szKBTGGDY1tnMukQqFP73q7HDtm/LxAAAAAElFTkSuQmCC\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    \n    def RunScript(self, classification):    \n        items = []\n        tree = classification\n        archicad = tapir.Plugin.Archicad\n        \n        for branch_index in range(tree.BranchCount):\n            branch = tree.Branch(branch_index)\n            branch_item = []\n            for leaf in branch:\n                \n                if isinstance(leaf, tapir_py.core.Command):\n                    objects = leaf.GetAllClassificationSystems()\n                    branch_item.append(objects)\n                \n                elif isinstance(leaf, tapir_py.parts.ClassificationSystem):\n                    objects = archicad.GetAllClassificationsInSystem(leaf)\n                    branch_item.append(objects)\n            \n                elif isinstance(leaf, tapir_py.parts.ClassificationItem):\n                    objects = leaf.children\n                    branch_item.append(objects)\n            \n            items.append(branch_item)\n        \n        items = list_to_tree(items)\n        children = items\n        \n        # return outputs if you have them; here I try it for you:\n        return children\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib"
  ],
  "has_docstring": false
}