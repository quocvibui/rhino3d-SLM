{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/xBrepFace_pointOnInterior.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "xBrepFace_pointOnInterior.py",
  "instruction": "If the BrepFace's centroid or mid of its Surface Domains are not on the Face's interior,\r\na random point is generated.\r\n\r\n200108-10: Created.",
  "code": "\"\"\"\r\nIf the BrepFace's centroid or mid of its Surface Domains are not on the Face's interior,\r\na random point is generated.\r\n\r\n200108-10: Created.\r\n\"\"\"\r\n\r\nimport Rhino\r\nimport Rhino.Geometry as rg\r\nimport Rhino.Input as ri\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\nfrom System import Guid\r\nfrom System import Random\r\n\r\n\r\nclass Opts:\r\n\r\n    keys = []\r\n    values = {}\r\n    names = {}\r\n    riOpts = {}\r\n    riAddOpts = {}\r\n    stickyKeys = {}\r\n\r\n\r\n    def addOptionDouble(key, names, riOpts):\r\n        return lambda getObj: ri.Custom.GetBaseClass.AddOptionDouble(\r\n            getObj, englishName=names[key], numberValue=riOpts[key])\r\n\r\n\r\n    def addOptionInteger(key, names, riOpts):\r\n        return lambda getObj: ri.Custom.GetBaseClass.AddOptionInteger(\r\n            getObj, englishName=names[key], intValue=riOpts[key])\r\n\r\n\r\n    def addOptionList(key, names, listValues, values):\r\n        return lambda getObj: ri.Custom.GetBaseClass.AddOptionList(\r\n            getObj,\r\n            englishOptionName=names[key],\r\n            listValues=listValues,\r\n            listCurrentIndex=values[key])\r\n\r\n\r\n    def addOptionToggle(key, names, riOpts):\r\n        return lambda getObj: ri.Custom.GetBaseClass.AddOptionToggle(\r\n            getObj, englishName=names[key], toggleValue=riOpts[key])\r\n\r\n\r\n    key = 'fMinDistFromBorder'; keys.append(key)\r\n    values[key] = 10.0 * sc.doc.ModelAbsoluteTolerance\r\n    names[key] = key[1:]\r\n    riOpts[key] = ri.Custom.OptionDouble(initialValue=values[key])\r\n    riAddOpts[key] = addOptionDouble(key, names, riOpts)\r\n    stickyKeys[key] = '{}({})({})'.format(key, __file__, sc.doc.Name)\r\n    \r\n    key = 'bEcho'; keys.append(key)\r\n    values[key] = True\r\n    names[key] = key[1:]\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    riAddOpts[key] = addOptionToggle(key, names, riOpts)\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n    \r\n    key = 'bDebug'; keys.append(key)\r\n    values[key] = False\r\n    names[key] = key[1:]\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    riAddOpts[key] = addOptionToggle(key, names, riOpts)\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n    \r\n    # Load sticky.\r\n    for key in stickyKeys:\r\n        if stickyKeys[key] in sc.sticky:\r\n            if key in riOpts:\r\n                riOpts[key].CurrentValue = values[key] = sc.sticky[stickyKeys[key]]\r\n            else:\r\n                values[key] = sc.sticky[stickyKeys[key]]\r\n\r\n\r\n    @classmethod\r\n    def setValues(cls):\r\n        for key in cls.keys:\r\n            if key in cls.riOpts:\r\n                cls.values[key] = cls.riOpts[key].CurrentValue\r\n\r\n\r\n    @classmethod\r\n    def saveSticky(cls):\r\n        for key in cls.stickyKeys:\r\n            if key in cls.riOpts:\r\n                sc.sticky[cls.stickyKeys[key]] = cls.riOpts[key].CurrentValue\r\n            else:\r\n                sc.sticky[cls.stickyKeys[key]] = cls.values[key]\r\n\r\n\r\ndef getInput(bDebug=False):\r\n    \"\"\"\r\n    \"\"\"\r\n    \r\n    go = ri.Custom.GetObject()\r\n\r\n    go.SetCommandPrompt(\"Select face\")\r\n\r\n    go.GeometryFilter = Rhino.DocObjects.ObjectType.Surface\r\n    go.GeometryAttributeFilter = (\r\n            ri.Custom.GeometryAttributeFilter.SubSurface) # Doesn't allow single surfaces to be selected.\r\n    \r\n    go.AcceptNumber(enable=True, acceptZero=True)\r\n    go.EnableClearObjectsOnEntry(False) # If not set to False, faces will be unselected when result == ri.GetResult.Object \r\n    \r\n    while True:\r\n        go.AddOptionDouble(Opts.names['fMinDistFromBorder'], Opts.riOpts['fMinDistFromBorder'])\r\n        go.AddOptionToggle(Opts.names['bEcho'], Opts.riOpts['bEcho'])\r\n        go.AddOptionToggle(Opts.names['bDebug'], Opts.riOpts['bDebug'])\r\n        \r\n        res = go.Get()\r\n        \r\n        if res == ri.GetResult.Cancel:\r\n            go.Dispose()\r\n            return\r\n        elif res == ri.GetResult.Object:\r\n            objref = go.Object(0)\r\n            go.Dispose()\r\n            return [objref] + [Opts.values[key] for key in Opts.keys]\r\n        \r\n        # An option was selected or a number was entered.\r\n        \r\n        if res == ri.GetResult.Number:\r\n            Opts.riOpts['fMinDistFromBorder'].CurrentValue = go.Number()\r\n        \r\n        if Opts.riOpts['fMinDistFromBorder'].CurrentValue < 0.0:\r\n            Opts.riOpts['fMinDistFromBorder'].CurrentValue = Opts.riOpts['fMinDistFromBorder'].InitialValue\r\n        \r\n        Opts.setValues()\r\n        Opts.saveSticky()\r\n        go.ClearCommandOptions()\r\n\r\n\r\ndef createPoint3d(rgFace, fMinDistFromBorder=None, bDebug=False):\r\n    \"\"\"\r\n    Parameters:\r\n        rgFace: BrepFace\r\n        fMinDistFromBorder: float\r\n    Returns:\r\n        Point3d on success, None on failure\r\n    \"\"\"\r\n    \r\n    if fMinDistFromBorder is None:\r\n        fMinDistFromBorder = 10.0 * sc.doc.ModelAbsoluteTolerance\r\n    \r\n    rgBrep = rgFace.Brep\r\n    \r\n    iDomainU = rgFace.Domain(0)\r\n    iDomainV = rgFace.Domain(1)\r\n\r\n    areaMassProp = Rhino.Geometry.AreaMassProperties.Compute(rgFace)\r\n    if areaMassProp is None:\r\n        print \"Face[{}]'s AreaMassProperties cannot be calculated.\".format(\r\n            rgFace.FaceIndex)\r\n        u = iDomainU.Mid\r\n        v = iDomainV.Mid\r\n    else:\r\n        ptCentrdW = areaMassProp.Centroid\r\n        bSuccess, u, v = rgFace.ClosestPoint(ptCentrdW)\r\n    \r\n    rgEdges = [rgBrep.Edges[idxEdge] for idxEdge in rgFace.AdjacentEdges()]\r\n\r\n    rand = Random()\r\n    \r\n    for i in xrange(10000):\r\n        pointFaceRelation = rgFace.IsPointOnFace(u, v)\r\n\r\n        if bDebug: sEval = \"pointFaceRelation\"; print sEval+':',eval(sEval)\r\n\r\n        if pointFaceRelation == rg.PointFaceRelation.Interior:\r\n            pt = rgFace.PointAt(u, v)\r\n\r\n            # If point is not at least fMinDistFromBorder from border (all edges),\r\n            # continue searching.\r\n            for rgEdge in rgEdges:\r\n                b, t = rgEdge.ClosestPoint(pt)\r\n                if b:\r\n                    dist = pt.DistanceTo(rgEdge.PointAt(t))\r\n                    if dist < fMinDistFromBorder:\r\n                        break # to get another u and v.\r\n            else: # Good point\r\n                map(lambda x: x.Dispose(), rgEdges)\r\n                rgFace.Dispose()\r\n                return pt\r\n\r\n        # Get new parameters for point.\r\n        u = rand.NextDouble() * iDomainU.Length + iDomainU.Min\r\n        v = rand.NextDouble() * iDomainV.Length + iDomainV.Min\r\n\r\n\r\ndef main(bEcho=True, bDebug=False):\r\n    \r\n    rc = getInput()\r\n    if rc is None: return\r\n    (\r\n            objref0,\r\n            fMinDistFromBorder,\r\n            bEcho,\r\n            bDebug,\r\n    ) = rc\r\n    if objref0 is None: return\r\n    \r\n    gBrep0 = objref0.ObjectId\r\n    rdBrep0 = objref0.Object()\r\n    rgBrep0 = objref0.Brep()\r\n\r\n    if rgBrep0.Faces.Count == 1:\r\n        rgFace0 = rgBrep0.Faces[0]\r\n    else:\r\n        idx_CompIdx = objref0.GeometryComponentIndex.Index\r\n        if idx_CompIdx == -1:\r\n            rgFace0 = rgBrep0.Faces[0]\r\n        else:\r\n            rgFace0 = objref0.Face()\r\n\r\n    pt3d = createPoint3d(\r\n        rgFace=rgFace0,\r\n        fMinDistFromBorder=fMinDistFromBorder,\r\n        bDebug=bDebug)\r\n\r\n    if not pt3d:\r\n        print \"A point on the face could not be found.\"\r\n        return\r\n\r\n    gPt = sc.doc.Objects.AddPoint(pt3d)\r\n    if gPt != Guid.Empty:\r\n        print \"Point on face was added to document.\"\r\n        sc.doc.Views.Redraw()\r\n\r\n\r\nif __name__ == '__main__': main(bEcho=bool(1), bDebug=bool(0))",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}