{
  "source_url": "https://github.com/StrucEng-Library-kfmresearch/strucenglib-snippets/blob/2e4b498eaa5b2928c1766e9ed99bf6493e5fe056/strucenglib/prepost_functions/verification.py",
  "repo": "StrucEng-Library-kfmresearch/strucenglib-snippets",
  "repo_stars": 1,
  "repo_description": "StrucEng Library (snippets) for Rhinoceros",
  "license": "unknown",
  "filepath": "strucenglib/prepost_functions/verification.py",
  "instruction": "Author(s): Marius  Weber (ETHZ, HSLU T&A)",
  "code": "# Author(s): Marius  Weber (ETHZ, HSLU T&A)\n\nimport rhinoscriptsyntax as rs\nfrom compas_fea.structure import Structure\nfrom compas_fea.cad import rhino\nfrom compas.geometry import scale_vector\nfrom compas.geometry import add_vectors\nimport Rhino\nimport scriptcontext\nimport System.Guid, System.Drawing.Color\n\ndef verification(mdl, layer, check=None):\n    \n    # Basic definitions\n    #-------------------------------------------------------\n    # Tolerance for the plane check  \n    R_tol=5    \n    \n    # Layer with curve which define the Nachweisschnitt\n    NS_layer_V=layer \n    \n    # Create layername with elements inside Nachweisschnitt\n    NS_layer_ele_centroids=NS_layer_V+'_Elementmittelpunkte'\n    NS_layer_ele_centroids_temp='temp'\n\n\n    # Aufstellung der Grundlagen fur die Ebenengleichung\n    # ---------------------------------------------------------------------------------\n    # Extract Point coor from the curve in load_layer\n    x_coor_all=[]\n    y_coor_all=[]\n    z_coor_all=[]\n\n    curve=rs.ObjectsByLayer(NS_layer_V)\n    if rs.IsCurve(curve):\n        points=rs.CurvePoints(curve)\n    \n    # Determine three points of the curve\n    for i in range(0,3):\n        \n        x_coor=points[i][0]\n        y_coor=points[i][1]\n        z_coor=points[i][2]\n        x_coor_all.append(x_coor)\n        y_coor_all.append(y_coor)\n        z_coor_all.append(z_coor)\n    \n    # Define the three points A=x_A,y_A,z_A; B=x_B,y_B,z_B; C=x_C,y_C,z_C\n    x_A=x_coor_all[0]\n    y_A=y_coor_all[0]\n    z_A=z_coor_all[0]\n    \n    x_B=x_coor_all[1]\n    y_B=y_coor_all[1]\n    z_B=z_coor_all[1]\n\n    x_C=x_coor_all[2]\n    y_C=y_coor_all[2]\n    z_C=z_coor_all[2]\n\n    # Vectors AB=[AB_x, AB_y, AB_z] and AC=[AC_x, AC_y, AC_z]\n    AB_x=x_B-x_A\n    AB_y=y_B-y_A\n    AB_z=z_B-z_A\n\n    AC_x=x_C-x_A\n    AC_y=y_C-y_A\n    AC_z=z_C-z_A \n\n\n    # Normalvektor via corrsproduct (N=AB x AC)\n    N_x=AB_y*AC_z-AB_z*AC_y\n    N_y=AB_z*AC_x-AB_x*AC_z\n    N_z=AB_x*AC_y-AB_y*AC_x\n    AN=x_A*N_x + y_A*N_y + z_A*N_z    \n    \n    \n    # Create points at centroid of the elements\n    # ---------------------------------------------------------------------------------\n    \n    # Definition eines neues Layers fur die Elementmittelpunkte innerhalb des Nachweisschnittes\n    if rs.IsLayer(NS_layer_ele_centroids):\n        rs.PurgeLayer(NS_layer_ele_centroids)\n        scriptcontext.doc.Layers.Add(NS_layer_ele_centroids, System.Drawing.Color.Green)\n    else:\n        scriptcontext.doc.Layers.Add(NS_layer_ele_centroids, System.Drawing.Color.Green)\n\n    # Definition eines neues Layers temporar (wird wieder geloscht)\n    if rs.IsLayer(NS_layer_ele_centroids_temp):\n        rs.PurgeLayer(NS_layer_ele_centroids_temp)\n        scriptcontext.doc.Layers.Add(NS_layer_ele_centroids_temp, System.Drawing.Color.Green)\n    else:\n        scriptcontext.doc.Layers.Add(NS_layer_ele_centroids_temp, System.Drawing.Color.Green)\n\n    # Bestimmung der Elementmittelpunkte\n    for element_num, element in mdl.elements.items(): # fangt bei elemntnummer 0 an\n        \n        xyz=mdl.element_centroid(element=element_num)  # return the centroid of element\n        elemen_num_backend=element_num+1 # return element number\n        rs.CurrentLayer(NS_layer_ele_centroids_temp)\n        rs.AddPoint( (xyz[0],xyz[1],xyz[2]) )\n        \n\n    # Extract points at element centroid and extract curve layer\n    # ---------------------------------------------------------------------------------\n    selectpt = rs.ObjectsByLayer(NS_layer_ele_centroids_temp)\n    rec=rs.ObjectsByLayer(NS_layer_V)\n    xyz_coor_NS_centroid_points=[]\n    \n    \n     # Checks Punkt innerhalb des Nachweisschnittes\n    # ---------------------------------------------------------------------------------\n   \n    for i in selectpt:\n    \n        # Check 1: Point is inside aufgespannter area_load Kurve \n        insidept = rs.PointInPlanarClosedCurve(i,rec, plane=rs.CurvePlane(rec), tolerance=10) \n        \n        if insidept==0: # The point is NOT inside the closed surve\n            pass\n        else: # The point IS inside the closed surve\n            # Koordinaten des Punktes \n            coor=rs.PointCoordinates(i)\n            coorx=coor[0]\n            coory=coor[1]\n            coorz=coor[2]          \n            \n            # Check if point is inside curve-plane (mit Ebenegleichung)\n\n            # Koordiantenform (XN= AN ----> N_x*coorx + N_y*coor_y + N_z*coor_z = x_A*N_x + y_A*N_y + z_A*N_z)\n            XN=N_x*coorx+N_y*coory+N_z*coorz \n\n            if XN >= AN-R_tol and XN < AN+R_tol: \n                # Abspeichern im Layer fur alle belastetne Elemente \n                rs.CurrentLayer(NS_layer_ele_centroids)\n                rs.AddPoint( (coorx,coory,coorz) ) \n                xyz_coor_NS_centroid_points.append([coorx,coory,coorz])\n            else:\n                pass\n\n\n    # Bestimmung der Nummern der Elemente welche belastet sind\n    NS_element_numbers=[]\n    for element_num, element in mdl.elements.items():\n        \n        xyz=mdl.element_centroid(element=element_num)  # return the centroid of element        \n        if [xyz[0],xyz[1],xyz[2]] in xyz_coor_NS_centroid_points:\n            NS_element_numbers.append(element_num+1)\n            \n        else:\n            pass\n    rs.CurrentLayer(NS_layer_ele_centroids)   \n    rs.PurgeLayer(NS_layer_ele_centroids_temp)\n\n    \n    # add elements to the structure using add_set\n    if check == 'V':\n        name_type='Nachweisschnitt_'+check\n        mdl.add_set(name=NS_layer_V, type=name_type, selection=NS_element_numbers)  # add an element set 'elset_shell'\n    else:\n        pass\n\n    return NS_element_numbers\n                ",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}