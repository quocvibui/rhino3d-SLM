{
  "source_url": "https://discourse.mcneel.com/t/grasshopper-api-help-python-script-triggering-breakpoints/189984",
  "topic_id": 189984,
  "title": "Grasshopper API Help - Python Script Triggering Breakpoints",
  "question": "Hello, I’m encountering some breakpoint messages that I would like to avoid. I believe this is because I am making changes prior to solution completion, but I am not familiar with the methods required to manage this safely & effectively. \nOther than these breakpoint messages, the script is working functionally as intended.\n\n\nThe below sample is a snippet extracted a larger project that is still in progress. I have aimed to keeping the sample code as simple and well-commented as possible for easier review. Apologies in advance if the sample is verbose and messy! Thanks in advance. \n\n\nSample File\n:\n\n\nExample.gh\n (18.8 KB)\n\n\nVideo Clip\n:\n\n\n\n\n\n\nDescription\n:\n\n\n\n\nContext\n: Rhino8 Python 3 Script Editor\n\n\nObjectives\n: Modify component output parameters based on a dictionary of \n{key : value}\n pairs (simulated in the sample as a Grasshopper data tree, input into the \n_data\n input node). Disconnect downstream nodes if there is any update to the data structure.\n\n\nIssues\n:\n\n\n\n\n\n\nDisconnecting downstream nodes triggers a breakpoint, leading to errors such as “Panel () object expired during solution” and “An exception was thrown during a solution: Component Panel,” or “Collection was modified; enumeration operation may not execute.”\n\n\n\n\n\n\nModifying the input data structure—specifically when reducing the number of \n{key:value}\n pairs relative to the previous input—triggers a breakpoint. An example error message is: “Output parameters Index[5] too high or too low for Component Python 3 Script.”",
  "code_blocks": [
    {
      "code": "# -----------------------------------------------------------------------------\n# Import libraries\n# -----------------------------------------------------------------------------\n\nimport Grasshopper as gh\nimport System\nimport RhinoCodePluginGH.Parameters as rcpg\nimport Grasshopper.Kernel as kernel\n\n# -----------------------------------------------------------------------------\n# Define functions\n# -----------------------------------------------------------------------------\n\ndef warning_message():\n    ghenv.Component.AddRuntimeMessage(gh.Kernel.GH_RuntimeMessageLevel.Warning, \"Required input missing or invalid.\")\n\n# Define a function to add dynamic output parameters\ndef add_param(name,ind):\n    param = rcpg.ScriptVariableParam()  # Constructor method\n    param.NickName = name # Add nickname\n    param.Name = name # Add name\n    param.Access = kernel.GH_ParamAccess.list\n    index = ind # Set position\n    ghenv.Component.Params.RegisterOutputParam(param)\n    ghenv.Component.Params.OnParametersChanged()\n\n# Define a function to disconnect sources whenever the component is modified\ndef remove_sources():\n    # Get the current Grasshopper document / component info\n    doc = ghenv.Component.OnPingDocument()\n    component = ghenv.Component\n    output_params = component.Params.Output\n\n    output_comp_guids = []\n    for n in output_params:\n        output_comp_guids.append(n.InstanceGuid)\n\n    output_comp_guids_02 = []\n    for i in output_params:\n        recipients = list(i.Recipients)\n        for r in recipients:\n            output_comp_guids_02.append(r.InstanceGuid)\n            print(r.InstanceGuid)\n\n    removals = []\n\n    for obj in doc.Objects:\n        # Components\n        if hasattr(obj, 'Params') and hasattr(obj.Params, 'Input'):\n            for param_input in obj.Params.Input:\n                if param_input.InstanceGuid in output_comp_guids_02:\n                    for item in output_comp_guids:\n                        key = param_input\n                        value = item\n                        tuple_ = (key,value)\n                        removals.append(tuple_)\n        # Parameters & Panels\n        elif hasattr(obj, 'Sources'):\n            sources = list(obj.Sources)\n            for param_input in sources:\n                if param_input.InstanceGuid in output_comp_guids:\n                    key = obj\n                    value = param_input.InstanceGuid\n                    tuple_ = (key,value)\n                    removals.append(tuple_)\n        else:\n            pass\n\n    # Perform your modifications\n    for item in removals:\n        item[0].RemoveSource(item[1])\n        item[0].ExpireSolution(False)\n\n# -----------------------------------------------------------------------------\n# Execute operations\n# -----------------------------------------------------------------------------\n\n# [0] Process & validate inputs\n# ---------------------------------------------------------\n\n# Split the key-value pairs\ntry:\n    keys = []\n    values = []\n    for branch in _data.Branches:\n        keys.append(str(branch[0]))\n        values.append(float(branch[1]))\nexcept:\n    # Clear old outputs\n    remove_sources()\n    ghenv.Component.Params.Output.Clear()\n    warning_message()\n\n# Ensure inputs are available, each value has a unique keyname, each keyname is unique\nif any([x==None,keys==[None],values==[None],len(keys) != len(values),len(list(set(keys))) != len(keys)]):\n    remove_sources()\n    ghenv.Component.Params.Output.Clear()\n    warning_message()\n\n# [1] Update the Grasshopper component\n# ---------------------------------------------------------\n\nelse: # Validation passed\n\n    # Get a list of the previous outputs\n    previous_outputs = [param.Name for param in ghenv.Component.Params.Output]\n\n    # Create a list of desired outputs\n    current_outputs = keys\n\n    # Check if there are existing outputs\n    if len(previous_outputs)>0:\n        print(\"len(previous_outputs)>0\")\n\n        # Check if existing outputs are not the same as the current\n        if set(previous_outputs) != set(current_outputs):\n            print(\"set(previous_outputs) != set(current_outputs)\")\n\n            # Disconnect components\n            remove_sources()\n\n            # Clear old outputs\n            ghenv.Component.Params.Output.Clear()\n\n            # Create new outputs\n            for ind, item in enumerate (current_outputs):\n                add_param(item,ind)\n\n        # Skip if the existing and current are the same\n        else:\n            print(\"set(previous_outputs) == set(current_outputs)\")\n            # pass\n\n    # Check if there are no existing outputs\n    else:\n        print(\"len(previous_outputs)==0\")\n\n        # Create new outputs\n        for ind, item in enumerate (current_outputs):\n            add_param(item,ind)\n\n\n    # [2] Now that the component is updated, apply output values\n    # ---------------------------------------------------------\n\n    # Iterate for each output\n    for index, item in enumerate(current_outputs):\n\n        # Calculate each output value\n        output_value = x + values[index]\n\n        # Set the output result by accessing the newly created output parameter\n        ghenv.Component.Params.Output[index].AddVolatileData(gh.Kernel.Data.GH_Path(0), 0, output_value)",
      "language": "python",
      "author": "Adelina_Koleva",
      "post_number": 2,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "grasshopper",
    "python",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 2,
  "views": 105
}