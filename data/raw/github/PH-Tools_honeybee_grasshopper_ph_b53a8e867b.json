{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/visualize_spaces.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/visualize_spaces.py",
  "instruction": "GHCompo Interface: HBPH - Visualize Spaces.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Visualize Spaces.\"\"\"\n\nfrom uuid import uuid4\n\ntry:\n    from typing import Any, List, Optional, Tuple\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from Grasshopper import DataTree  # type: ignore\n    from Grasshopper.Kernel.Data import GH_Path  # type: ignore\n    from Rhino.Geometry import Brep  # type: ignore\n    from System import Object  # type: ignore\nexcept ImportError:\n    pass  # Outside Rhino\n\ntry:\n    from ladybug_rhino.color import color_to_color\n    from ladybug_rhino.fromgeometry import from_face3d, from_face3d_to_wireframe, from_face3ds_to_colored_mesh\n    from ladybug_rhino.fromobjects import legend_objects\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee.colorobj import ColorFace\n    from honeybee.face import Face, Face3D\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph.space import Space\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_utils.input_tools import input_to_int\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_utils:\\n\\t{}\".format(e))\n\n\nclass TempFace(Face):\n    \"\"\"A temporary subclass of Honeybee.face.Face so that we can add custom attributes\n\n    This is required since the base Face class using __slots__\n    \"\"\"\n\n    def __init__(self, geometry):\n        super(TempFace, self).__init__(str(uuid4()), geometry)\n\n\nclass GHCompo_VisualizeSpaces(object):\n    \"\"\"Transform HBPH Spaces into Rhino geometry which can be visualized.\"\"\"\n\n    def __init__(self, _IGH, _spaces, _attribute, *args, **kwargs):\n        # type: (gh_io.IGH, List[Space], Optional[str], Any, Any) -> None\n        self.IGH = _IGH\n        self.spaces = _spaces\n        self.attribute = _attribute\n\n    def get_floor_segment_faces_as_datatree(self):\n        # type: () -> DataTree[List[Face3D]]\n        \"\"\"Return a DataTree of the space floor-segment LBT-faces. One Space per branch.\"\"\"\n        space_floor_segments_ = DataTree[Object]()\n        for i, space in enumerate(self.spaces):\n            for j, floor_segment_surface in enumerate(space.floor_segment_surfaces):\n                space_floor_segments_.AddRange(floor_segment_surface, GH_Path(i, j))\n        return space_floor_segments_\n\n    def get_space_volume_faces_as_datatree(self):\n        # type: () -> DataTree[List[Face3D]]\n        \"\"\"Return a DataTree of the space volume LBT-faces. One Space per branch.\"\"\"\n        space_volume_faces_ = DataTree[Object]()\n        for i, space in enumerate(self.spaces):\n            for j, volume in enumerate(space.volumes):\n                space_volume_faces_.AddRange(volume.geometry, GH_Path(i, j))\n        return space_volume_faces_\n\n    def convert_to_rhino_surfaces(self, _data_tree):\n        # type: (DataTree[List[Face3D]]) -> DataTree[List[Brep]]\n        \"\"\"Return a DataTree of the space LBT-faces as Rhino surfaces. One Space per branch.\"\"\"\n        output_tree_ = DataTree[Object]()\n        for i, branch in enumerate(_data_tree.Branches):\n            for lbt_face in branch:\n                output_tree_.Add(from_face3d(lbt_face), GH_Path(i))\n        return output_tree_\n\n    def get_floor_segment_surfaces_as_HB_Faces(self):\n        # type: () -> List[TempFace]\n        \"\"\"Return a flat list of all the floor-segments as 'TempFace' objects.\"\"\"\n        hb_faces_ = []\n        for space in self.spaces:\n            for floor_segment in space.floor_segments:\n                if not floor_segment.geometry:\n                    continue\n\n                # -- Create the new Face, and store the attributes from the space/floor-segment\n                # -- so that they can be accessed later by the visualization component.\n                hb_face = TempFace(floor_segment.geometry)\n                setattr(hb_face, \"display_name\", space.full_name)\n                setattr(hb_face, \"weighting_factor\", floor_segment.weighting_factor)\n                setattr(hb_face, \"weighted_floor_area\", floor_segment.weighted_floor_area)\n                setattr(hb_face, \"floor_area\", floor_segment.floor_area)\n                hb_faces_.append(hb_face)\n        return hb_faces_\n\n    def run(self):\n        # type: () -> Tuple[DataTree[List], DataTree[List], Optional[List], Optional[List], Optional[Tuple]]\n        # -------------------------------------------------------------------------------\n        space_floor_segments_faces_ = DataTree[Object]()\n        space_volume_faces_ = DataTree[Object]()\n\n        if not self.spaces:\n            return (space_floor_segments_faces_, space_volume_faces_, None, None, None)\n\n        # -------------------------------------------------------------------------------\n        # -- If there is NO attribute input, just return the LBT-Faces as Rhino-surfaces\n        if not self.attribute:\n            # -- Get the LBT-Face geometry as organized DataTrees\n            space_floor_segments_faces_ = self.get_floor_segment_faces_as_datatree()\n            space_volume_faces_ = self.get_space_volume_faces_as_datatree()\n\n            return (\n                self.convert_to_rhino_surfaces(space_floor_segments_faces_),\n                self.convert_to_rhino_surfaces(space_volume_faces_),\n                None,\n                None,\n                None,\n            )\n\n        # -------------------------------------------------------------------------------\n        # -- If there is an attribute input, return Rhino-Meshes colored by the attribute value\n        # -- Create the ColorFace visualization object\n        floor_segment_faces = self.get_floor_segment_surfaces_as_HB_Faces()\n        color_obj = ColorFace(floor_segment_faces, self.attribute)\n        graphic = color_obj.graphic_container\n        values = color_obj.attributes_original\n        flat_geo = color_obj.flat_geometry\n\n        # -------------------------------------------------------------------------------\n        # -- Output the visualization geometry\n        mesh = [from_face3ds_to_colored_mesh([fc], col) for fc, col in zip(flat_geo, graphic.value_colors)]\n        wire_frame = []\n        for face in color_obj.flat_faces:\n            wire_frame.extend(from_face3d_to_wireframe(face.geometry))\n        legend = legend_objects(graphic.legend)\n\n        return (mesh, space_volume_faces_, wire_frame, legend, values)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}