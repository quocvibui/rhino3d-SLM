{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/trajectory.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/trajectory.py",
  "instruction": "Create a robot trajectory between for a plate module.",
  "code": "\"\"\"Create a robot trajectory between for a plate module.\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport rhinoscriptsyntax as rs\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Robot trajectory\", \"Robot trajectory\", \"\"\"Create a robot trajectory between for a plate module.\"\"\", \"Manis\", \"Robotics\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"22f1e7f4-3036-42d8-a4e5-51a8ec2bd477\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"stack_module\", \"stack_module\", \"The plate module stacked in range of the robotic arm.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"goal_module\", \"goal_module\", \"The plate module to assemble in range of the robotic arm.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_String()\r\n        self.SetUpParam(p, \"plates_id\", \"plates_id\", \"(Optional) List of plates to assemble with a robot.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Plane()\r\n        self.SetUpParam(p, \"safe_spot\", \"safe_spot\", \"A plane where the robot can safely move between the assembly of each plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"up_dist\", \"up_dist\", \"The distance above the assembly where the robot should travel.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"retreat_dist\", \"retreat_dist\", \"The distance that the robot should travel to retreat after the insertion of the plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n\r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_Plane()\r\n        self.SetUpParam(p, \"planes\", \"planes\", \"The list of planes for the robot trajectory.\")\r\n        self.Params.Output.Add(p)\r\n\r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        p2 = self.marshal.GetInput(DA, 2)\r\n        p3 = self.marshal.GetInput(DA, 3)\r\n        p4 = self.marshal.GetInput(DA, 4)\r\n        p5 = self.marshal.GetInput(DA, 5)\r\n        result = self.RunScript(p0, p1, p2, p3, p4, p5)\r\n\r\n        if result is not None:\r\n            self.marshal.SetOutput(result, DA, 0, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAEVSURBVEhLrY7rDYMwDIT7sytU6hQMy7rUF3zpOXECSLH0EUzuwes4jkdcTBEEfVgSQcvFjAv8kgSRcjGdlyY6w6lC111N52uNcRFhoxtNLdj2/QCtcUkBw2sBsEUFBQ2nZgb8dgaCGQI88A40nJoM+nDajvflBZgSDOwbsU3MLqhGDadmwPm3Es6cYObgHWg4NQk1lGhGMNuUv3Awb+NDcQID03AwKijDO9UIXbh/DwQzxHjw1HBqnC4cer8LBHMzXYmbboeDWQEG5q+LNfBWOGj/7n8hY3sN5envna9lWFAuz4AaDGTv9BnTAkMDlUybMiuo4QTBHNtvMSqYhmPs2y2ygi7c0PtHtAVLw4EWLA/f9v31A49phgrTyfm7AAAAAElFTkSuQmCC\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n\r\n    def RunScript(self, stack_module, goal_module, plates_id, safe_spot, up_dist, retreat_dist):\r\n\r\n        planes = None\r\n\r\n        if goal_module and stack_module:\r\n\r\n            #default param\r\n            if safe_spot is None: safe_spot = rs.PlaneFromNormal((1230,-1350,2020),(0,0,1))\r\n            if up_dist is None: up_dist = 100\r\n            if retreat_dist is None: retreat_dist = 10\r\n\r\n            # initialization\r\n            planes = []\r\n            bases = []\r\n            goals = []\r\n            normals = []\r\n            foam_dist = 20 # foam height on Joulin\r\n\r\n            #auto-flip plates in stack\r\n            for i in range(goal_module.count):\r\n                if stack_module.plates[i].top_center[2] < stack_module.plates[i].bottom_center[2] :\r\n                    bases.append(stack_module.plates[i].bottom_plane)\r\n                    goals.append(goal_module.plates[i].bottom_plane)\r\n                    normals.append(goal_module.plates[i].bottom_normal)\r\n                else :\r\n                    bases.append(stack_module.plates[i].top_plane)\r\n                    goals.append(goal_module.plates[i].top_plane)\r\n                    normals.append(goal_module.plates[i].top_normal)\r\n\r\n            if len(bases) != len(goals):\r\n                self.AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Error, 'start and goal model should have the same number of plates') \r\n\r\n            # plane and text list\r\n            else:\r\n                for i in range(goal_module.count):\r\n                    flag = True\r\n                    if (plates_id != []) and (plates_id != 'all') and (plates_id != None):\r\n                        flag = False\r\n                        for j in range(len(plates_id)):\r\n                            if str(i) == plates_id[j]: flag = True\r\n                    if flag == True:\r\n\r\n                        #-------------------- SAFE PART (World) --------------------\r\n            \r\n                        # safe_spot\r\n                        planes.append(safe_spot)\r\n            \r\n                        #-------------------- BASE PART (model) --------------------\r\n            \r\n                        # above_base\r\n                        above_base_point = rs.CopyObject(bases[i].Origin, (0,0,up_dist))\r\n                        above_base_plane = rs.PlaneFromFrame(above_base_point, bases[i].XAxis, bases[i].YAxis)\r\n                        planes.append(above_base_plane)\r\n            \r\n                        # near_base\r\n                        near_base_point = rs.CopyObject(bases[i].Origin, (0,0,retreat_dist))\r\n                        near_base_plane = rs.PlaneFromFrame(near_base_point, bases[i].XAxis, bases[i].YAxis)\r\n                        planes.append(near_base_plane)\r\n            \r\n                        #------------------- BASE PART (picture) -------------------\r\n            \r\n                        # near_base\r\n                        planes.append(near_base_plane)\r\n            \r\n                        # to_plate\r\n                        to_plate_point = rs.CopyObject(bases[i].Origin, (0,0, foam_dist))\r\n                        to_plate_plane = rs.PlaneFromFrame(to_plate_point, bases[i].XAxis, bases[i].YAxis)\r\n                        planes.append(to_plate_plane)\r\n            \r\n                        # near_base\r\n                        planes.append(near_base_plane)\r\n            \r\n                        # above_base\r\n                        planes.append(above_base_plane)\r\n            \r\n                        #-------------------- SAFE PART (World) --------------------\r\n            \r\n                        # safe_spot\r\n                        planes.append(safe_spot)\r\n            \r\n                        #------------------- GOAL PART (picture) -------------------\r\n                       \r\n                        # above_goal\r\n            \r\n                        if goal_module.assembly_vectors[i] == 'gravity': \r\n                            near_goal_point = rs.CopyObject(goals[i].Origin, -retreat_dist * rs.VectorCreate((0,0,-1),(0,0,0)))\r\n                        else: near_goal_point = rs.CopyObject(goals[i].Origin, -retreat_dist * goal_module.assembly_vectors[i])\r\n                        above_goal_point = rs.CopyObject(near_goal_point, (0,0,up_dist))\r\n                        above_goal_plane = rs.PlaneFromFrame(above_goal_point, goals[i].XAxis,goals[i].YAxis)\r\n                        planes.append(above_goal_plane)\r\n            \r\n                        # near_goal\r\n                        near_goal_plane = rs.PlaneFromFrame(near_goal_point, goals[i].XAxis,goals[i].YAxis)\r\n                        planes.append(near_goal_plane)\r\n            \r\n            \r\n                        # to_insert\r\n                        planes.append(goals[i])\r\n            \r\n                        # retreat\r\n                        retreat_point = rs.CopyObject(goals[i].Origin, retreat_dist * normals[i])\r\n                        retreat_plane = rs.PlaneFromFrame(retreat_point, goals[i].XAxis, goals[i].YAxis)\r\n                        planes.append(retreat_plane)\r\n            \r\n                        # above_retreat\r\n                        above_retreat = rs.CopyObject(retreat_point, (0,0,up_dist))\r\n                        retreat_plane = rs.PlaneFromFrame(above_retreat, goals[i].XAxis, goals[i].YAxis)\r\n                        planes.append(retreat_plane)\r\n\r\n        return (planes)\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Robot trajectory\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"16004be3-3e5c-4683-a78d-d0b4b1611328\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}