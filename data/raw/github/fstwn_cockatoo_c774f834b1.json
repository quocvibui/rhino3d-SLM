{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_MakePatternData.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_MakePatternData.py",
  "instruction": "Make knitting pattern data from a KnitNetwork dual. This will convert the input\ndual network into a directed acyclic graph by grouping all 'weft' edge chains\nand 'warp' edge chains. Then, a...",
  "code": "\"\"\"\nMake knitting pattern data from a KnitNetwork dual. This will convert the input\ndual network into a directed acyclic graph by grouping all 'weft' edge chains\nand 'warp' edge chains. Then, a topological sort is performed on that graph to\nsort the stitches into rows and columns.\n---\n[NOTE] If this fails, something is wrong with the topology or geometry of the\ndual network or the underlying KnitNetwork and thus it can not be represented as\na directed acyclic graph.\n---\n[WARNING]\nSAVE YOUR FILE before activating this! It can crash rhino and grasshopper for\nreasons currently unknown. \n---\nFor more details on the underlying concepts see\nhttps://en.wikipedia.org/wiki/Directed_acyclic_graph\nhttps://en.wikipedia.org/wiki/Topological_sorting\n    Inputs:\n        Toggle: Set to True to activate the component. {item, boolean}\n        KnitNetworkDual: The input dual network of the KnitNetwork.\n                         {item, KnitDiNetwork}\n        Consolidate: If True, will try to consolidate the pattern data\n                     Defaults to False.\n                     {item, bool}\n        ColorMode: Determines how node colors wil be treated when generating\n                   the pattern data.\n                   [0] will prioritize colors for instructions like increases\n                       or decreases over the 'color' attribute of the node if\n                       set.\n                   [1] will prioritize the 'color' attribute of the node if set.\n                   [2] will create a blended color between the instruction color\n                       and the node color specified through the 'color'\n                       attribute.\n                   Defaults to [0].\n                   {item, int}\n        FillerColor: Color to use for filling pixels without stitch information.\n                     Defaults to Black.\n                     {item, System.Drawing.Color}\n        StitchColor: Color to use for regular stitch pixels if no 'color'\n                     attribute is assigned to the node.\n                     Defaults to White.\n                     {item, System.Drawing.Color}\n        IncreaseColor: Color to use for stitch pixels marked as 'increase'.\n                       Defaults to Green.\n                       {item, System.Drawing.Color}\n        DecreaseColor: Color to use for stitch pixels marked as 'decrease'.\n                       Defaults to Orange.\n                       {item, System.Drawing.Color}\n        EndColor: Color to use for stitch pixels marked as 'end'.\n                  Defaults to Blue.\n                  {item, System.Drawing.Color}\n    Outputs:\n        PatternData: The 2d pattern data as a matrix of rows and columns.\n                     Contains the node indices. The value '-1' is used as a\n                     filler.\n                     {tuple, int}\n        PixelData: The 2d pixel data as a matrix of rows and columns.\n                   Contains the colors of each stitch as as System Color.\n                   {tuple, System.Drawing.Color}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200813\n\"\"\"\n\n# PYTHON STANDARD LIBRARY IMPORTS\nfrom __future__ import division\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# THIRD PARTY MODULE IMPORTS\nfrom ghpythonlib import treehelpers as th\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"MakePatternData\"\nghenv.Component.NickName =\"MPD\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"09 Pattern Data\"\n\n# LOCAL MODULE IMPORTS\ntry:\n    import cockatoo\nexcept ImportError:\n    errMsg = \"The Cockatoo python module seems to be not correctly \" + \\\n             \"installed! Please make sure the module is in you search \" + \\\n             \"path, see README for instructions!.\"\n    raise ImportError(errMsg)\n\nclass MakePatternData(component):\n    \n    def RunScript(self, Toggle, DualNetwork, Consolidate, ColorMode, FillerColor, StitchColor, IncreaseColor, DecreaseColor, EndColor):\n        \n        # set defaults and snitize inputs\n        if Consolidate == None:\n            Consolidate=False\n        if ColorMode == None or ColorMode < 0:\n            ColorMode = 0\n        elif ColorMode > 2:\n            ColorMode = 2\n        if FillerColor == None:\n            FillerColor = System.Drawing.Color.Black\n        if StitchColor == None:\n            StitchColor = System.Drawing.Color.White\n        if IncreaseColor == None:\n            IncreaseColor = System.Drawing.Color.Green\n        if DecreaseColor == None:\n            DecreaseColor = System.Drawing.Color.Orange\n        if EndColor == None:\n            EndColor = System.Drawing.Color.Blue\n        \n        PatternData = Grasshopper.DataTree[object]()\n        PixelData = Grasshopper.DataTree[object]()\n        \n        if Toggle and DualNetwork:\n            # CREATE PATTERN DATA (ROWS AND COLUMNS) ---------------------------\n            \n            try:\n                PatternData = DualNetwork.make_pattern_data(\n                                                    consolidate=Consolidate)\n                PatternData = tuple([tuple(row) for row in PatternData])\n            except Exception as e:\n                rml = self.RuntimeMessageLevel.Error\n                rMsg = \"Could not perform topological sort on input network!\"\n                self.AddRuntimeMessage(rml, rMsg)\n                print(e.message)\n            \n            # CONVERT PATTERN DATA TO PIXELS -----------------------------------\n            try:\n                PixelData = []\n                for i, row in enumerate(PatternData):\n                    pixel_row = []\n                    for node in row:\n                        # set filler color if this is not a valid node\n                        if node < 0:\n                            pixel_row.append(FillerColor)\n                            continue\n                        \n                        # get node data and color\n                        node_data = DualNetwork.node[node]\n                        node_col = node_data[\"color\"]\n                        \n                        # END NODE PIXEL COLOR ---------------------------------\n                        if node_data[\"end\"]:\n                            if node_col and ColorMode == 1:\n                                syscol = System.Drawing.Color.FromArgb(\n                                                            *node_col)\n                                pixel_row.append(syscol)\n                            elif node_col and ColorMode == 2:\n                                rgbcol = (EndColor.R,\n                                          EndColor.G,\n                                          EndColor.B)\n                                blend = cockatoo.utilities.blend_colors(\n                                                    rgbcol,\n                                                    node_col)\n                                sysblend = System.Drawing.Color.FromArgb(\n                                                            *blend)\n                                pixel_row.append(sysblend)\n                            else:\n                                if node_data[\"increase\"]:\n                                    pixel_row.append(IncreaseColor)\n                                elif node_data[\"decrease\"]:\n                                    pixel_row.append(DecreaseColor)\n                                else:\n                                    pixel_row.append(EndColor)\n                        \n                        # INCREASE NODE PIXEL COLOR ----------------------------\n                        elif node_data[\"increase\"]:\n                            if node_col and ColorMode == 1:\n                                syscol = System.Drawing.Color.FromArgb(\n                                                            *node_col)\n                                pixel_row.append(syscol)\n                            elif node_col and ColorMode == 2:\n                                rgbcol = (IncreaseColor.R,\n                                          IncreaseColor.G,\n                                          IncreaseColor.B)\n                                blend = cockatoo.utilities.blend_colors(\n                                                    rgbcol,\n                                                    node_col)\n                                sysblend = System.Drawing.Color.FromArgb(\n                                                            *blend)\n                                pixel_row.append(sysblend)\n                            else:\n                                pixel_row.append(IncreaseColor)\n                        \n                        # DECREASE NODE PIXEL COLOR ----------------------------\n                        elif node_data[\"decrease\"]:\n                            if node_col and ColorMode == 1:\n                                syscol = System.Drawing.Color.FromArgb(\n                                                            *node_col)\n                                pixel_row.append(syscol)\n                            elif node_col and ColorMode == 2:\n                                rgbcol = (DecreaseColor.R,\n                                          DecreaseColor.G,\n                                          DecreaseColor.B)\n                                blend = cockatoo.utilities.blend_colors(\n                                                    rgbcol,\n                                                    node_col)\n                                sysblend = System.Drawing.Color.FromArgb(\n                                                            *blend)\n                                pixel_row.append(sysblend)\n                            else:\n                                pixel_row.append(DecreaseColor)\n                        \n                        # REGULAR NODE PIXEL COLOR -----------------------------\n                        else:\n                            if node_col:\n                                syscol = System.Drawing.Color.FromArgb(\n                                                                *node_col)\n                                pixel_row.append(syscol)\n                            else:\n                                pixel_row.append(StitchColor)\n                    \n                    # append row to pixel data\n                    PixelData.append(pixel_row)\n                \n                PixelData = tuple([tuple(row) for row in PixelData])\n                \n            except Exception as e:\n                rml = self.RuntimeMessageLevel.Error\n                rMsg = \"Could not convert pattern data to pixel colors!\"\n                self.AddRuntimeMessage(rml, rMsg)\n                print(e.message)\n        \n        elif Toggle and not DualNetwork:\n            rml = self.RuntimeMessageLevel.Warning\n            rMsg = \"No DualNetwork input!\"\n            self.AddRuntimeMessage(rml, rMsg)\n        \n        return PatternData, PixelData",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}