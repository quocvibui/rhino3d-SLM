{
  "source_url": "https://github.com/Gaspard-Bourgeois/rhino-picksoul/blob/9431b8335b62d43ec3539852d1a1af603f0ce1c5/dev/selection/selectNextOrigin.py",
  "repo": "Gaspard-Bourgeois/rhino-picksoul",
  "repo_stars": 1,
  "repo_description": "Generic plugin to manage blocs, materials and trajectories in rhino.",
  "license": "Apache-2.0",
  "filepath": "dev/selection/selectNextOrigin.py",
  "instruction": "Author: Gaspard BOURGEOIS <gaspard.github.io@free.fr>\nVersion: 1.0\nDate: 08/01/26",
  "code": "\"\"\"\nAuthor: Gaspard BOURGEOIS <gaspard.github.io@free.fr>\nVersion: 1.0\nDate: 08/01/26\n\"\"\"\nimport rhinoscriptsyntax as rs\nimport re\n\ndef get_program_from_selection(selected_ids):\n    \"\"\"Retrouve les programmes liés aux éléments sélectionnés\"\"\"\n    target_layers = set()\n    for s_id in selected_ids:\n        lyr = rs.ObjectLayer(s_id)\n        if lyr:\n            target_layers.add(lyr)\n            parent = rs.ParentLayer(lyr)\n            if parent: target_layers.add(parent)\n    \n    all_objs = rs.ObjectsByType(4096) # Instances de blocs\n    programs = []\n    if all_objs:\n        for obj in all_objs:\n            if rs.GetUserText(obj, \"type\") == \"program\":\n                if rs.ObjectLayer(obj) in target_layers:\n                    programs.append(obj)\n    return list(set(programs))\n\n\ndef select_next_program_element():\n    # Récupérer les objets actuellement sélectionnés\n    selected = rs.GetObjects(\"Sélectionnez les éléments actuels\", preselect=True)\n    \n    if not selected:\n        print(\"Aucune sélection active.\")\n        return\n\n    next_objects_to_select = []\n    \n    # On désélectionne tout pour préparer la nouvelle sélection\n    rs.UnselectAllObjects()\n    \n    curve_selected = set()\n    pose_selected = set()\n    for obj_id in selected:\n        obj_type = rs.ObjectType(obj_id)\n        if obj_type == rs.filter.instance and rs.BlockInstanceName(obj_id) == \"Pose\":\n            pose_selected.add(str(obj_id))\n        else:\n            curve_selected.add(str(obj_id))\n    \n    # print(pose_selected, curve_selected)\n    \n    print(\"Analyse de la selection utilisateur ({} objets)...\".format(len(selected)))\n    target_programs = get_program_from_selection(selected)\n    if not target_programs:\n        print(\"ERREUR: Aucun programme associe a la selection.\")\n        return\n    \n    next_curves = []\n    next_poses = []\n    for prog_id in target_programs:\n        prog_layer = rs.ObjectLayer(prog_id)\n        print(\"\\n>>> TRAITEMENT PROGRAMME: {}\".format(prog_layer))\n    \n        # --- Identification des courbes via UserStrings ---\n        original_crv_uuids = []\n        select_next_curve = False\n        i = 0\n        while True:\n            # Attention: Utilisation stricte du formatage Crv_0000\n            key = \"Crv_{:04d}\".format(i)\n            u = rs.GetUserText(prog_id, key)\n            if not u: break\n            if rs.IsObject(u):\n                original_crv_uuids.append(u)\n            else:\n                print(\"DEBUG: Courbe referencee {} introuvable (supprimee?).\".format(u))\n            if select_next_curve:\n                select_next_curve = False\n                next_curves.append(u)\n            if u in curve_selected:\n                select_next_curve = True\n                curve_selected.remove(u)\n            if  not len(pose_selected) and not len(curve_selected) and not select_next_curve:\n                break\n            i += 1\n        \n\n        # --- Identification des poses via UserStrings ---\n        last_pose = None\n        select_next_pose = False\n        for curve_uuid in original_crv_uuids:\n            p_idx = 0\n            while True:\n                orig_pose_uuid = rs.GetUserText(curve_uuid, \"UUID_{:04d}\".format(p_idx))\n                if not orig_pose_uuid: break                   \n                p_idx += 1\n                if orig_pose_uuid == last_pose:\n                    continue\n                last_pose = orig_pose_uuid\n                # print(orig_pose_uuid)\n                if select_next_pose:\n                    select_next_pose = False\n                    next_poses.append(orig_pose_uuid)\n                if orig_pose_uuid in pose_selected:\n                    select_next_pose = True\n                    pose_selected.remove(orig_pose_uuid)\n                if  not len(pose_selected) and not len(curve_selected) and not select_next_pose:\n                    break\n    next_objects_to_select = next_curves + next_poses\n    \n    if next_objects_to_select:\n        rs.SelectObjects(next_objects_to_select)\n        print(\"{} éléments suivants sélectionnés.\".format(len(next_objects_to_select)))\n    else:\n        print(\"Aucun élément suivant trouvé.\")\n\nif __name__ == \"__main__\":\n    select_next_program_element()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}