{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/_rhino/Block.tab/fall_geos_on_geo.button/fall_geos_on_geo_left.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/_rhino/Block.tab/fall_geos_on_geo.button/fall_geos_on_geo_left.py",
  "instruction": "Fall geos on geo left",
  "code": "__title__ = \"FallGeosOnGeo\"\r\n__doc__ = \"\"\"Project objects onto target geometry.\r\n\r\nFeatures:\r\n- Projects blocks using insertion points\r\n- Projects other objects using bounding box centers\r\n- Supports both top and bottom face projections\r\n- Works with surfaces, polysurfaces and meshes\r\n- Maintains object properties during projection\"\"\"\r\n__is_popular__ = True\r\nimport rhinoscriptsyntax as rs\r\nfrom EnneadTab.RHINO import RHINO_OBJ_DATA\r\nfrom EnneadTab import ERROR_HANDLE, LOG\r\n\r\n\r\n@LOG.log(__file__, __title__)\r\n@ERROR_HANDLE.try_catch_error()\r\ndef fall_geos_on_geo():\r\n\r\n    # get the blocks\r\n    #blocks = rs.GetObjects(\"Pick blocks to project.\", rs.filter.instance)\r\n    objs = rs.GetObjects(\"Pick objs to project.\", preselect=True)\r\n    if not objs:\r\n        return\r\n\r\n    # get surf or poly surf or mesh, 8 and 16 and 32 are internal defined object type enum\r\n    landing_geo = rs.GetObject(\"Pick surface or polysurface or mesh to fall onto.\", filter = 8 + 16 + 32)\r\n    if not landing_geo:\r\n        return\r\n\r\n    face_opts = [\"Top face\", \"Bottom face\"]\r\n    face_pick = rs.ListBox(items = face_opts, \r\n                           message = \"Project them to the top surface or bottom surface?\",\r\n                           title=\"EnneadTab Fall Objs Magic\")\r\n    if not face_pick: return\r\n    is_top_face = face_pick == face_opts[0]\r\n\r\n\r\n    # disable viewport refreshing to save time.\r\n    rs.EnableRedraw(False)\r\n\r\n\r\n    # process each block from the block selection\r\n    for obj in objs:\r\n        process_obj(obj, landing_geo, is_top_face)\r\n\r\ndef process_obj(obj, landing_geo,is_top_face):\r\n    # get block point insertion\r\n    if rs.IsBlockInstance(obj):\r\n        pt = rs.BlockInstanceInsertPoint(obj)\r\n    else:\r\n        pt = RHINO_OBJ_DATA.get_obj_min_center_pt(obj)\r\n\r\n\r\n\r\n    # get project to landing_geo pt\r\n    try:\r\n        #proejct block pt to the geometry\r\n        if rs.IsMesh(landing_geo):\r\n\r\n            project_pts = list(rs.ProjectPointToMesh(pt, landing_geo, (0,0,-1)))\r\n        else:\r\n            project_pts = list(rs.ProjectPointToSurface(pt, landing_geo, (0,0,-1)))\r\n\r\n\r\n\r\n        # sort result intersection pts by Z value from highest to lowest\r\n        project_pts.sort(key = lambda x: x[2], reverse = is_top_face)\r\n\r\n        # only get the highest pt\r\n        project_pt = project_pts[0]\r\n    except Exception as e:\r\n        print (e)\r\n        print (\"Cannot project this block over. Skipping.\")\r\n        # terminate this action early.\r\n        return\r\n\r\n    # move block over\r\n    vector = project_pt - pt\r\n    rs.MoveObject(obj, vector)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    fall_geos_on_geo()",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}