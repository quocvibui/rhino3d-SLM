{
  "source_url": "https://github.com/compas-dev/compas/blob/HEAD/src/compas_rhino/geometry/brep/edge.py",
  "repo": "compas-dev/compas",
  "repo_stars": 352,
  "repo_description": "Main library of the COMPAS framework and CAD integrations for Rhino/GH and Blender.",
  "license": "MIT",
  "filepath": "src/compas_rhino/geometry/brep/edge.py",
  "instruction": null,
  "code": "from __future__ import absolute_import\nfrom __future__ import division\nfrom __future__ import print_function\n\nimport Rhino  # type: ignore\n\nfrom compas.geometry import Arc\nfrom compas.geometry import BrepEdge\nfrom compas.geometry import Circle\nfrom compas.geometry import Ellipse\nfrom compas.geometry import Frame\nfrom compas.geometry import Line\nfrom compas_rhino.conversions import arc_to_compas\nfrom compas_rhino.conversions import arc_to_rhino\nfrom compas_rhino.conversions import circle_to_compas\nfrom compas_rhino.conversions import circle_to_rhino\nfrom compas_rhino.conversions import curve_to_compas_line\nfrom compas_rhino.conversions import ellipse_to_compas\nfrom compas_rhino.conversions import ellipse_to_rhino\nfrom compas_rhino.conversions import frame_to_rhino_plane\nfrom compas_rhino.conversions import line_to_rhino\nfrom compas_rhino.conversions import plane_to_compas_frame\nfrom compas_rhino.conversions import point_to_compas\nfrom compas_rhino.geometry import RhinoNurbsCurve\n\nfrom .vertex import RhinoBrepVertex\n\n\nclass RhinoBrepEdge(BrepEdge):\n    \"\"\"A wrapper for Rhino.Geometry.BrepEdge.\n\n    The expected native type here is a Rhino.Geometry.BrepTrim.\n    a BrepTrim holds a reference to its associated BrepEdge as well as its start a end vertices\n    in a correct topological order (!).\n\n    Attributes\n    ----------\n    curve : :class:`Rhino.Geometry.Curve3D`\n        The underlying geometry of this edge.\n    start_vertex : :class:`compas_rhino.geometry.RhinoBrepVertex`, read-only\n        The start vertex of this edge (taken from BrepTrim).\n    end_vertex : :class:`compas_rhino.geometry.RhinoBrepVertex`, read-only\n        The end vertex of this edge (taken from BrepTrim).\n    vertices : list[:class:`compas_rhino.geometry.RhinoBrepVertex`], read-only\n        The list of vertices which comprise this edge (start and end)\n    is_circle : bool, read-only\n        True if the geometry of this edge is a circle, False otherwise.\n    is_line : bool, read-only\n        True if the geometry of this edge is a line, False otherwise.\n    native_edge : :class:`Rhino.Geometry.BrepEdge`\n        The underlying BrepEdge object.\n\n    \"\"\"\n\n    def __init__(self, rhino_edge=None):\n        super(RhinoBrepEdge, self).__init__()\n        self._edge = None\n        self._curve = None\n        self._curve_type = None\n        self._start_vertex = None\n        self._end_vertex = None\n        self._mass_props = None\n        if rhino_edge:\n            self.native_edge = rhino_edge\n\n    # ==============================================================================\n    # Data\n    # ==============================================================================\n\n    @property\n    def __data__(self):\n        curve_type, curve, plane, domain = self._get_curve_geometry()\n        return {\n            \"curve_type\": curve_type,\n            \"curve\": curve.__data__,\n            \"frame\": plane_to_compas_frame(plane).__data__,\n            \"start_vertex\": self._edge.StartVertex.VertexIndex,\n            \"end_vertex\": self._edge.EndVertex.VertexIndex,\n            \"domain\": domain,\n        }\n\n    @classmethod\n    def __from_data__(cls, data, builder):\n        \"\"\"Construct an object of this type from the provided data.\n\n        Parameters\n        ----------\n        data : dict\n            The data dictionary.\n        builder : :class:`compas_rhino.geometry.BrepBuilder`\n            The object reconstructing the current Brep.\n\n        Returns\n        -------\n        :class:`compas.data.Data`\n            An instance of this object type if the data contained in the dict has the correct schema.\n\n        \"\"\"\n        instance = cls()\n        edge_curve = cls._create_curve__from_data__(data[\"curve_type\"], data[\"curve\"], data[\"frame\"], data[\"domain\"])\n        instance.native_edge = builder.add_edge(edge_curve, data[\"start_vertex\"], data[\"end_vertex\"])\n        return instance\n\n    # ==============================================================================\n    # Properties\n    # ==============================================================================\n\n    @property\n    def centroid(self):\n        return point_to_compas(self._mass_props.Centroid)\n\n    @property\n    def curve(self):\n        return self._curve\n\n    @property\n    def native_edge(self):\n        return self._edge\n\n    @native_edge.setter\n    def native_edge(self, value):\n        self._edge = value\n        self._mass_props = Rhino.Geometry.LengthMassProperties.Compute(value.EdgeCurve)\n        self._curve = RhinoNurbsCurve.from_rhino(value.EdgeCurve.ToNurbsCurve())\n        self._start_vertex = RhinoBrepVertex(value.StartVertex)\n        self._end_vertex = RhinoBrepVertex(value.EndVertex)\n\n    @property\n    def start_vertex(self):\n        return self._start_vertex\n\n    @property\n    def end_vertex(self):\n        return self._end_vertex\n\n    @property\n    def vertices(self):\n        return [self.start_vertex, self.end_vertex]\n\n    @property\n    def is_circle(self):\n        return self._edge.EdgeCurve.IsCircle()\n\n    @property\n    def is_line(self):\n        return self._edge.EdgeCurve.IsLinear()\n\n    @property\n    def is_ellipse(self):\n        return self._edge.EdgeCurve.IsEllipse()\n\n    @property\n    def length(self):\n        return self._mass_props.Length\n\n    # ==============================================================================\n    # Methods\n    # ==============================================================================\n\n    def _get_curve_geometry(self):\n        curve = self._edge.EdgeCurve\n        domain = [self._edge.Domain[0], self._edge.Domain[1]]\n        _, frame = curve.FrameAt(0)\n        if isinstance(curve, Rhino.Geometry.LineCurve):\n            return \"line\", curve_to_compas_line(curve), frame, domain\n        if isinstance(curve, Rhino.Geometry.NurbsCurve):\n            return \"nurbs\", RhinoNurbsCurve.from_rhino(curve), frame, domain\n        if isinstance(curve, Rhino.Geometry.ArcCurve):\n            if not curve.IsClosed:\n                return \"arc\", arc_to_compas(curve.Arc), curve.Arc.Plane, domain\n            is_circle, circle = curve.TryGetCircle()\n            if is_circle:\n                return \"circle\", circle_to_compas(circle), circle.Plane, domain\n            is_ellipse, ellipse = curve.TryGetEllipse()\n            if is_ellipse:\n                return \"ellipse\", ellipse_to_compas(ellipse), ellipse.Plane, domain\n            return \"nurbs\", curve.ToNurbsCurve(), frame, domain\n        raise ValueError(\"Unknown curve type: {}\".format(curve.__class__.__name__))\n\n    @staticmethod\n    def _create_curve__from_data__(curve_type, curve_data, frame_data, domain):\n        frame = Frame.__from_data__(frame_data)\n        if curve_type == \"line\":\n            line = Line.__from_data__(curve_data)\n            curve = Rhino.Geometry.LineCurve(line_to_rhino(line))\n        elif curve_type == \"circle\":\n            circle = circle_to_rhino(Circle.__from_data__(curve_data))\n            circle.Plane = frame_to_rhino_plane(frame)\n            curve = Rhino.Geometry.ArcCurve(circle)\n        elif curve_type == \"ellipse\":\n            ellipse = ellipse_to_rhino(Ellipse.__from_data__(curve_data))\n            ellipse.Plane = frame_to_rhino_plane(frame)\n            curve = Rhino.Geometry.NurbsCurve.CreateFromEllipse(ellipse)\n        elif curve_type == \"arc\":\n            arc = arc_to_rhino(Arc.__from_data__(curve_data))\n            curve = Rhino.Geometry.ArcCurve(arc)\n        elif curve_type == \"nurbs\":\n            curve = RhinoNurbsCurve.__from_data__(curve_data).rhino_curve\n        else:\n            raise ValueError(\"Unknown curve type: {}\".format(curve_type))\n        curve.Domain = Rhino.Geometry.Interval(*domain)\n        return curve\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": false
}