{
  "source_url": "https://discourse.mcneel.com/t/python3-component-runscript-parameter-names-changing/194348",
  "topic_id": 194348,
  "title": "Python3 component RunScript() parameter names changing",
  "question": "hello, a couple questions here. We had some great components that would change the input parameters of the GH component based on selections in the context menu and a \n*args\n input in the \nRunScript\n method. This was working great in Rhino7 and we had basically based our entire workflow on this.\n\n\nI am trying to update our code for Rhino8 and Python 3, and there are a few things I haven’t figured out.\n\n\n\n\nFirst off, when I change an input name on the component, it automatically changes the \nRunScript()\n signature. Is there a way to turn this off so that the code can adapt to different input parameters? The previous method of using the arguments positionally was preferrable. I see the documentation about it \nhere\n\n\nAfter some testing, there is some funny behavior. When I add an input parameter via the script, it does not change the \nRunScript\n input parameters. This is what I want, but then I don’t see how to access the value from that input. If I put a \n*args\n as an input parameter in the \nRunScript\n method, it just creates a component input named \n*args\n.\n\n\nThe Python 3 script component inherits from GH_ScriptInstance, but I want to use some GH_Component functions, for example I wanted to try using the \nCollectData()\n toget the input data without going through the \nRunScript\n signature. can I inherit from GH_Component, or is that only when we develop proper plugins?\n\n\nthe \nAppendAdditionalMenuItems()\n override doesn’t seem to be implemented. Is this the case? are there plans to implement?\n\n\n\n\nThanks for any help you can offer!",
  "code_blocks": [
    {
      "code": "from ghpythonlib.componentbase import executingcomponent as component\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Error\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Warning\nimport Grasshopper\n\n\nclass DirectJointRule(component):\n    def __init__(self):\n        super(DirectJointRule, self).__init__()\n\n        if ghenv.Component.Params.Output[0].NickName == \"out\":\n            self._type = None\n        else:\n            self._type = ghenv.Component.Params.Output[0].NickName\n\n    def RunScript(self, *args):\n        if not self._type:\n            ghenv.Component.Message = \"Select type from context menu (right click)\"\n            self.AddRuntimeMessage(Warning, \"Select type from context menu (right click)\")\n            return None\n        else:\n            ghenv.Component.Message = self._type\n            input_names = self.arg_names()[self._type]\n            input_values = args\n            string = \"inputs are: {}\".format(zip(input_names, input_values))\n\n            return string\n\n    def arg_names(self):\n        return  {\"a\": [\"arg_1\"], \"b\": [\"arg_1\",\"arg_5\"],\"c\": [\"arg_1\",\"arg_8\",\"arg_9\"]}\n\n    def AppendAdditionalMenuItems(self, menu):\n        for name in self.arg_names().keys():\n            item = menu.Items.Add(name, None, self.on_item_click)\n            if self._type and name == self._type:\n                item.Checked = True\n\n    def on_item_click(self, sender, event_info):\n        self._type = str(sender)\n        rename_gh_output(self._type, 0, ghenv)\n        manage_dynamic_params(self.arg_names()[self._type], ghenv, rename_count=0, permanent_param_count=0)\n        ghenv.Component.ExpireSolution(True)\n\n\n\n\ndef add_gh_param(\n    name, io, ghenv, index=None\n):  # we could also make beam_names a dict with more info e.g. NickName, Description, Access, hints, etc. this would be defined in joint_options components\n    \"\"\"Adds a parameter to the Grasshopper component.\n\n    Parameters\n    ----------\n    name : str\n        The name of the parameter.\n    io : str\n        The direction of the parameter. Either \"Input\" or \"Output\".\n    ghenv : object\n        The Grasshopper environment object.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    assert io in (\"Output\", \"Input\")\n    params = [param.NickName for param in getattr(ghenv.Component.Params, io)]\n    if name not in params:\n        param = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        param.NickName = name\n        param.Name = name\n        param.Description = name\n        param.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        param.Optional = True\n        if not index:\n            index = getattr(ghenv.Component.Params, io).Count\n\n        registers = dict(Input=\"RegisterInputParam\", Output=\"RegisterOutputParam\")\n        getattr(ghenv.Component.Params, registers[io])(param, index)\n        ghenv.Component.Params.OnParametersChanged()\n\n\n\ndef clear_gh_params(ghenv, permanent_param_count=1):\n    \"\"\"Clears all input parameters from the component.\n\n    Parameters\n    ----------\n    ghenv : object\n        The Grasshopper environment object.\n    permanent_param_count : int, optional\n        The number of parameters that should not be deleted. Default is 1.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    changed = False\n    while len(ghenv.Component.Params.Input) > permanent_param_count:\n        ghenv.Component.Params.UnregisterInputParameter(\n            ghenv.Component.Params.Input[len(ghenv.Component.Params.Input) - 1], True\n        )\n        changed = True\n    ghenv.Component.Params.OnParametersChanged()\n    return changed\n\n\ndef rename_gh_input(input_name, index, ghenv):\n    \"\"\"Renames a parameter in the Grasshopper component.\n\n    Parameters\n    ----------\n    ghenv : object\n        The Grasshopper environment object.\n    input_name : str\n        The new name of the parameter.\n    index : int\n        The index of the parameter to rename.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    param = ghenv.Component.Params.Input[index]\n    param.NickName = input_name\n    param.Name = input_name\n    param.Description = input_name\n    ghenv.Component.Params.OnParametersChanged()\n\n\ndef rename_gh_output(output_name, index, ghenv):\n    \"\"\"Renames a parameter in the Grasshopper component.\n\n    Parameters\n    ----------\n    output_name : str\n        The new name of the parameter.\n    index : int\n        The index of the parameter to rename.\n    ghenv : object\n        The Grasshopper environment object.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    param = ghenv.Component.Params.Output[index]\n    param.NickName = output_name\n    param.Name = output_name\n    param.Description = output_name\n    ghenv.Component.Params.OnParametersChanged()\n\n\ndef manage_dynamic_params(input_names, ghenv, rename_count=0, permanent_param_count=1, keep_connections=True):\n    \"\"\"Clears all input parameters from the component.\n\n    Parameters\n    ----------\n    input_names : list(str)\n        The names of the input parameters.\n    ghenv : object\n        The Grasshopper environment object.\n    permanent_param_count : int, optional\n        The number of parameters that should not be deleted. Default is 1.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    if not input_names:  # if no names are input\n        clear_gh_params(ghenv, permanent_param_count)\n        return\n    else:\n        if keep_connections:\n            to_remove = []\n            for param in ghenv.Component.Params.Input[permanent_param_count + rename_count :]:\n                if param.Name not in input_names:\n                    to_remove.append(param)\n            for param in to_remove:\n                param.IsolateObject()\n                ghenv.Component.Params.UnregisterInputParameter(param, True)\n            for i, name in enumerate(input_names):\n                if i < rename_count:\n                    rename_gh_input(name, i + permanent_param_count, ghenv)\n                elif name not in [param.Name for param in ghenv.Component.Params.Input]:\n                    add_gh_param(name, \"Input\", ghenv, index=i + permanent_param_count)\n\n        else:\n            register_params = False\n            if (\n                len(ghenv.Component.Params.Input) == len(input_names) + permanent_param_count\n            ):  # if param count matches beam_names count\n                for i, name in enumerate(input_names):\n                    if (\n                        ghenv.Component.Params.Input[i + permanent_param_count].Name != name\n                    ):  # if param names don't match\n                        register_params = True\n                        break\n            else:\n                register_params = True\n            if register_params:\n                clear_gh_params(\n                    ghenv, permanent_param_count + rename_count\n                )  # we could consider renaming params if we don't want to disconnect GH component inputs\n                for i, name in enumerate(input_names):\n                    if i < permanent_param_count:\n                        continue\n                    elif i < rename_count:\n                        rename_gh_input(name, i, ghenv)\n                    else:\n                        add_gh_param(name, \"Input\", ghenv)",
      "language": "python",
      "author": "OBucklin",
      "post_number": 4,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "grasshopper",
    "python",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 6,
  "views": 242
}