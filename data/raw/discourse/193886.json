{
  "source_url": "https://discourse.mcneel.com/t/rhinoscriptsyntax-addpictureframe-filepath-issue/193886",
  "topic_id": 193886,
  "title": "RhinoScriptSyntax.AddPictureFrame() FilePath issue",
  "question": "when calling rs.AddPictureFrame(plane, path, size[0], size[1], use_alpha = True) uing python3 in GH rhino8, i got the following exception:\n\n\nTraceback (most recent call last):\n\nFile “rhinocode:///grasshopper/1/f4f105bb-6ee7-4f13-a2b3-dc7b8652bf87/c59d8042-f099-416c-af12-ce53ee2b548e”, line 121, in \n\nFile “rhinocode:///grasshopper/1/f4f105bb-6ee7-4f13-a2b3-dc7b8652bf87/c59d8042-f099-416c-af12-ce53ee2b548e”, line 67, in InsertHero\n\nFile “C:\\Users\\Steven.rhinocode\\py39-rh8\\site-rhinopython\\rhinoscript\\geometry.py”, line 90, in AddPictureFrame\n\nif type(filename) is not System.String or not System.IO.File.Exists(filename): raise Exception(‘\"{0}\" does not exist or is not a file name’.format(filename))\n\nException: “C:\\Users\\Steven\\Desktop\\xxxxxxx\\Arcosanti\\png_BW\\cropped\\0.png” does not exist or is not a file name\n\n\nI’m very sure that “C:\\Users\\Steven\\Desktop\\xxxxxxx\\Arcosanti\\png_BW\\cropped\\0.png” exists. Any clue what could have caused this?",
  "code_blocks": [
    {
      "code": "# requirements: numpy\n# requirements: pillow\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext as sc\nimport math\nimport os\nimport numpy as np\nimport System.Drawing as Drawing\nfrom PIL import Image\nimport textwrap\n\n\n\n# Store the current document\nghdoc = sc.doc\n# Switch to Rhino document context to insert the block\nsc.doc = Rhino.RhinoDoc.ActiveDoc\n\ndef rename_space(input_path):\n    output_path = input_path.replace(\" \",\"\")\n    os.rename(input_path, output_path)\n    return output_path\n\ndef webp_to_jpg(input_path):\n    output_path = os.path.splitext(input_path)[0] + \".jpg\"\n    Image.open(input_path).convert(\"RGB\").save(output_path, \"JPEG\")\n    if os.path.exists(input_path):\n        os.remove(input_path)\n    return output_path\n\ndef crop_to_square(input_path):\n    # Open the image\n    img = Image.open(input_path)\n    \n    # Get image dimensions\n    width, height = img.size\n    \n    # Determine the shortest dimension and calculate crop dimensions\n    new_size = min(width, height)\n    left = (width - new_size) / 2\n    top = (height - new_size) / 2\n    right = (width + new_size) / 2\n    bottom = (height + new_size) / 2\n    \n    # Crop the image to the calculated box\n    img_cropped = img.crop((left, top, right, bottom))\n    \n    directory = os.path.dirname(input_path)\n    cropped_directory = os.path.join(directory, \"cropped\")\n    os.makedirs(cropped_directory, exist_ok=True)\n    \n    # Define the output path as a PNG in the cropped folder\n    file_root = os.path.splitext(os.path.basename(input_path))[0]\n    output_path = os.path.join(cropped_directory, f\"{file_root}.png\")\n    \n    # Save the cropped image as PNG\n    img_cropped.save(output_path, \"PNG\")\n    return output_path\n\ndef InsertImage(path,centre):\n    FRAMESIZE = 6\n    bitmap = Drawing.Bitmap(path)\n    size = np.array((bitmap.Width, bitmap.Height))\n    \n    size = size * FRAMESIZE / np.max(size)\n\n    try:\n        pt1 = centre + np.array((-size[0]/2,size[1]/2,0))\n        pt2 = centre + np.array((size[0]/2,-size[1]/2,0))\n        cmd = \"_-Picture \" + path + \" \" + \"{},{},{}\".format(pt1[0],pt1[1],pt1[2]) + \" \" + \"{},{},{}\".format(pt2[0],pt2[1],pt2[2]) + \" \" + \"_EnterEnd\"\n        rs.Command(cmd,True)\n        guid = rs.LastCreatedObjects()[0]\n    except:\n        guid = None\n\n    '''plane = rs.MovePlane(rs.WorldXYPlane(), centre - np.array((size[0],size[1],0)))\n    guid = rs.AddPictureFrame(plane, path, size[0], size[1], use_alpha = True)'''\n    return guid\n\ndef InsertHero(path,centre):\n    FRAMESIZE = 20\n    path = crop_to_square(path)\n    bitmap = Drawing.Bitmap(path)\n    size = np.array((bitmap.Width, bitmap.Height))\n    \n    size = size * FRAMESIZE / np.min(size)\n\n    try:\n        pt1 = centre + np.array((-size[0]/2,size[1]/2,0))\n        pt2 = centre + np.array((size[0]/2,-size[1]/2,0))\n        cmd = \"_-Picture \" + path + \" \" + \"{},{},{}\".format(pt1[0],pt1[1],pt1[2]) + \" \" + \"{},{},{}\".format(pt2[0],pt2[1],pt2[2]) + \" \" + \"_EnterEnd\"\n        rs.Command(cmd,True)\n        guid = rs.LastCreatedObjects()[0]\n    except:\n        guid = None\n\n    '''plane = rs.MovePlane(rs.WorldXYPlane(), centre - np.array((size[0],size[1],0)))\n    guid = rs.AddPictureFrame(plane, path, size[0], size[1], use_alpha = True)'''\n    return guid\n\nTYPE_ICON = np.array((4,18,0))\nSTATUS_ICON = np.array((2,13,0))\nPROGRAM_ICON = np.array((4,13,0))\nSCALE_ICON = np.array((6,13,0))\nIMAGESTART = np.array((32,18,0))\nHERO = np.array((18,11,0))\nTITLE = np.array((0,23,0))\nDCSP = np.array((1.5,10.5,0))\nDCSP2 = np.array((1.5,13.5,0))\n\nroot_path = root\nitem_count = 0\n\nfor content_folder_name in os.listdir(root_path):\n\n    image_paths = []\n    path = os.path.join(root_path, content_folder_name)\n    folder_path = path\n    meta_path = path + \"\\meta.txt\"\n    supported_extensions = [\".jpg\", \".jpeg\", \".png\", \".bmp\", \".tif\", \".tiff\", \".jfif\"]\n    webp = [\".webp\"]\n\n    base = np.array((0,item_count * 30,0))\n    item_count += 1\n\n    for file_name in os.listdir(folder_path):\n        # Get full path\n        file_path = os.path.join(folder_path, file_name)\n        \n        # Check if the file is an image\n        if os.path.isfile(file_path) and os.path.splitext(file_name)[1].lower() in supported_extensions:\n            image_paths.append(rename_space(file_path))\n        elif os.path.isfile(file_path) and os.path.splitext(file_name)[1].lower() in webp:\n            image_paths.append(rename_space(webp_to_jpg(file_path)))\n        \n\n    with open(meta_path, 'r', encoding='utf-8', errors='replace') as meta:\n        lines = meta.read().splitlines()\n        content_name = lines[0]\n        content_type = lines[1]\n        content_status = lines[2]\n        content_program = lines[3]\n        content_scale = lines[4]\n        content_dcsp = lines[5]\n\n    group_name = rs.AddGroup(content_name)\n\n    rs.AddObjectsToGroup(\n        [\n            rs.InsertBlock(content_type,base + TYPE_ICON),\n            rs.AddText(content_name, base + TITLE, height = 1.5, justification = 131073)\n        ],\n        group_name\n    )\n\n    if content_type == 'Project':\n\n        frame_width = (len(image_paths)-2)//3\n\n        rs.AddObjectsToGroup(\n            [\n                rs.AddRectangle(rs.MovePlane(rs.WorldXYPlane(), base), 29 + (frame_width + 1) * 7, 22),\n                rs.AddText(textwrap.fill(content_dcsp, width = 30), base + DCSP, height = .25, justification = 262145),\n                rs.InsertBlock(content_status, base + STATUS_ICON),\n                rs.InsertBlock(content_program, base + PROGRAM_ICON),\n                rs.InsertBlock(content_scale, base + SCALE_ICON),\n                rs.InsertBlock('HeroFrame', base),\n                rs.InsertBlock('ProgramFrame', base),\n                rs.InsertBlock('ProgramDcspFrame', base),\n                InsertHero(image_paths[0], base + HERO)\n            ],\n            group_name\n        )\n        i_x, i_y = 0,0\n        for image_path in image_paths[1:]:\n            rs.AddObjectsToGroup(\n                [\n                    #rs.InsertBlock('ImageFrame', base + IMAGESTART + np.array((7 * i_x, -7 * i_y, 0))),\n                    InsertImage(image_path, base + IMAGESTART + np.array((7 * i_x, -7 * i_y, 0)))\n                ],\n                group_name\n            )\n            i_x += 1\n            if i_x > frame_width:\n                i_y += 1\n                i_x = 0\n\n    else:\n        rs.AddObjectsToGroup(\n            [\n                rs.AddRectangle(rs.MovePlane(rs.WorldXYPlane(), base), 29, 22),\n                rs.AddText(textwrap.fill(content_dcsp, width = 30), base + DCSP2, height = .25, justification = 262145),\n                rs.InsertBlock('HeroFrame', base),\n                rs.InsertBlock('ProgramDcspFrame2', base),\n                InsertHero(image_paths[0], base + HERO)\n            ],\n            group_name\n        )",
      "language": "python",
      "author": "Shengtao_Xia",
      "post_number": 4,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "grasshopper",
    "python",
    "rhinoscriptsyntax",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 6,
  "views": 3903
}