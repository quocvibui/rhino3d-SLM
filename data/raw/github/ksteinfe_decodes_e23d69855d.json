{
  "source_url": "https://github.com/ksteinfe/decodes/blob/b876d6d01ea23ccbf4558182582a822b008cf2b8/src/decodes/io/rhinoscript/block.py",
  "repo": "ksteinfe/decodes",
  "repo_stars": 43,
  "repo_description": "a platform agnostic generative design library for 3d designers",
  "license": "GPL-3.0",
  "filepath": "src/decodes/io/rhinoscript/block.py",
  "instruction": null,
  "code": "import Rhino\nimport scriptcontext\nfrom . import utility as rhutil\nimport math\nimport System.Guid\n\ndef __InstanceObjectFromId( id, raise_if_missing ):\n    rhobj = rhutil.coercerhinoobject(id, True, raise_if_missing)\n    if isinstance(rhobj, Rhino.DocObjects.InstanceObject): return rhobj\n    if raise_if_missing: raise ValueError(\"unable to find InstanceObject\")\n\n\ndef BlockContainerCount(block_name):\n    \"\"\"Returns number of block definitions that contain a specified\n    block definition\n    Parameters:\n      block_name = the name of an existing block definition\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if idef is None: return 0\n    containers = idef.GetContainers()\n    if not containers: return 0\n    return len(containers)\n\n\ndef BlockContainers(block_name):\n    \"\"\"Returns names of the block definitions that contain a specified block\n    definition.\n    Parameters:\n      block_name = the name of an existing block definition\n    Returns:\n      A list of block definition names\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    containers = idef.GetContainers()\n    rc = []\n    for item in containers:\n        if not item.IsDeleted: rc.append(item.Name)\n    return rc\n\n\ndef BlockCount():\n    \"Returns the number of block definitions in the document\"\n    return scriptcontext.doc.InstanceDefinitions.ActiveCount\n\n\ndef BlockDescription(block_name, description=None):\n    \"\"\"Returns or sets the description of a block definition\n    Parameters:\n      block_name = the name of an existing block definition\n      description[opt] = The new description.\n    Returns:\n      if description is not specified, the current description\n      if description is specified, the previous description\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    rc = idef.Description\n    if description: table.Modify( idef, idef.Name, description )\n    return rc\n\n\ndef BlockInstanceCount(block_name):\n    \"\"\"Counts number of instances of the block in the document.\n    Nested instances are not included in the count.\n    Parameters:\n      block_name = the name of an existing block definition\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    refs = idef.GetReferences()\n    return len(refs)\n\n\ndef BlockInstanceInsertPoint(object_id):\n    \"\"\"Returns the insertion point of a block instance.\n    Parameters:\n      object_id = The identifier of an existing block insertion object\n    Returns:\n      list representing 3D point if successful\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    xf = instance.InstanceXform\n    pt = Rhino.Geometry.Point3d.Origin\n    pt.Transform(xf)\n    return pt\n\n\ndef BlockInstanceName(object_id):\n    \"\"\"Returns the block name of a block instance\n    Parameters:\n      object_id = The identifier of an existing block insertion object\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    idef = instance.InstanceDefinition\n    return idef.Name\n\n\ndef BlockInstances(block_name):\n    \"\"\"Returns the identifiers of the inserted instances of a block.\n    Parameters:\n      block_name = the name of an existing block definition\n    Returns:\n      list of guids identifying the instances of a block\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    instances = idef.GetReferences(0)\n    return [item.Id for item in instances]\n\n\ndef BlockInstanceXform(object_id):\n    \"\"\"Returns the location of a block instance relative to the world coordinate\n    system origin (0,0,0). The position is returned as a 4x4 transformation\n    matrix\n    Parameters:\n      object_id = The identifier of an existing block insertion object  \n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    return instance.InstanceXform\n\n\ndef BlockNames( sort=False ):\n    \"\"\"Returns the names of all block definitions in the document\n    Parameters:\n      sort = return a sorted list\n    \"\"\"\n    ideflist = scriptcontext.doc.InstanceDefinitions.GetList(True)\n    rc = [item.Name for item in ideflist]\n    if(sort): rc.sort()\n    return rc\n\n\ndef BlockObjectCount(block_name):\n    \"\"\"Returns the number of objects that make up a block definition\n    Parameters:\n      block_name = name of an existing block definition\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.ObjectCount\n\n\ndef BlockObjects(block_name):\n    \"\"\"Returns the identifiers of the objects that make up a block definition\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      list of identifiers on success\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    rhobjs = idef.GetObjects()\n    return [obj.Id for obj in rhobjs]\n\n\ndef BlockPath(block_name):\n    \"\"\"Returns the path to the source of a linked or embedded block definition.\n    A linked or embedded block definition is a block definition that was\n    inserted from an external file.\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      path to the linked block on success\n      None on error\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.SourceArchive\n\n\ndef DeleteBlock(block_name):\n    \"\"\"Deletes a block definition and all of it's inserted instances.\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      True or False indicating success or failure  \n    \"\"\"\n    return scriptcontext.doc.InstanceDefinitions.Delete(index, True, False)\n\n\ndef ExplodeBlockInstance(object_id):\n    \"\"\"Explodes a block instance into it's geometric components. The\n    exploded objects are added to the document\n    Parameters:\n      object_id = The identifier of an existing block insertion object  \n    Returns:\n      list of identifiers for the newly exploded objects on success\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    subobjects = instance.GetSubObjects()\n    persistSelect = (instance.IsSelected(False)>=2)\n    instance.Select(False, True)\n    rc = []\n    for item in subobjects:\n        id = scriptcontext.doc.Objects.AddObject(item)\n        if id!=System.Guid.Empty:\n            rc.append(id)\n            if persistSelect:\n                rhobj = scriptcontext.doc.Objects.Find(id)\n                rhobj.Select(True, True)\n    if rc:\n        scriptcontext.doc.Objects.Delete(instance)\n        scriptcontext.doc.Views.Redraw()\n    return rc\n\n\ndef InsertBlock( block_name, insertion_point, scale=(1,1,1), angle_degrees=0, rotation_normal=(0,0,1) ):\n    \"\"\"Inserts a block whose definition already exists in the document\n    Parameters:\n      block_name = name of an existing block definition\n      insertion_point = insertion point for the block\n      scale [opt] = x,y,z scale factors\n      angle_degrees [opt] = rotation angle in degrees\n      rotation_normal [opt] = the axis of rotation.\n    Returns:\n      id for the block that was added to the doc\n    \"\"\"\n    insertion_point = rhutil.coerce3dpoint(insertion_point, True)\n    rotation_normal = rhutil.coerce3dvector(rotation_normal, True)\n    angle_radians = math.radians(angle_degrees)\n    trans = Rhino.Geometry.Transform\n    move = trans.Translation(insertion_point[0],insertion_point[1],insertion_point[2])\n    scale = trans.Scale(Rhino.Geometry.Plane.WorldXY, scale[0], scale[1], scale[2])\n    rotate = trans.Rotation(angle_radians, rotation_normal, Rhino.Geometry.Point3d.Origin)\n    xform = move * scale * rotate\n    return InsertBlock2( block_name, xform )\n\n\ndef InsertBlock2(block_name, xform):\n    \"\"\"Inserts a block whose definition already exists in the document\n    Parameters:\n      block_name = name of an existing block definition\n      xform = 4x4 transformation matrix to apply\n    Returns:\n      id for the block that was added to the doc on success\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    xform = rhutil.coercexform(xform, True)\n    id = scriptcontext.doc.Objects.AddInstanceObject(idef.Index, xform )\n    if id!=System.Guid.Empty:\n        scriptcontext.doc.Views.Redraw()\n        return id\n\n\ndef IsBlock(block_name):\n    \"\"\"Verifies the existence of a block definition in the document.\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      True or False\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    return (idef is not None)\n\n\ndef IsBlockEmbedded(block_name):\n    \"\"\"Verifies a block definition is embedded, or linked, from an external file.\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      True or False\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    ut = Rhino.DocObjects.InstanceDefinitionUpdateType\n    return (idef.UpdateType==ut.Embedded or idef.UpdateType==ut.LinkedAndEmbedded)\n\n\ndef IsBlockInstance( object_id ):\n    \"\"\"Verifies an object is a block instance\n    Parameters:\n      object_id = The identifier of an existing block insertion object\n    Returns:\n      True or False\n    \"\"\"\n    return  __InstanceObjectFromId(object_id, False) is not None\n\n\ndef IsBlockInUse( block_name, where_to_look=0 ):\n    \"\"\"Verifies that a block definition is being used by an inserted instance\n    Parameters:\n      block_name = name of an existing block definition\n      where_to_look [opt] = One of the following values\n           0 = Check for top level references in active document\n           1 = Check for top level and nested references in active document\n           2 = Check for references in other instance definitions\n    Returns:\n      True or False\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.InUse(where_to_look)\n\n\ndef IsBlockReference(block_name):\n    \"\"\"Verifies that a block definition is from a reference file.\n    Parameters:\n      block_name = name of an existing block definition\n    Returns:\n      True or False\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.IsReference\n\n\ndef RenameBlock( block_name, new_name ):\n    \"\"\"Renames an existing block definition\n    Parameters:\n      block_name = name of an existing block definition\n      new_name = name to change to\n    Returns:\n      True or False indicating success or failure\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name, True)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    description = idef.Description\n    rc = scriptcontext.doc.InstanceDefinitions.Modify(idef, new_name, description, False)\n    return rc\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": false
}