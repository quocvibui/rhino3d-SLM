{
  "source_url": "https://discourse.mcneel.com/t/ghpython-make-material-component-makes-infinite-materials/106376",
  "topic_id": 106376,
  "title": "GHPython Make Material Component makes infinite materials",
  "question": "I wrote a ‘make material’ and a ‘bake material’ component, based in the work of many discussion at the forum. It creates the material very well but it creates infinite versions of the same material if I press ‘create’ and bake. Attached you will find the definition and the scripts. For example, if I do a material called ‘r1’ and assign it to a layer, it will create ‘r1(1)’ if I create the material again with my component. What I need is to reset the original material instead of creating so many.\n\n\n\"\"\"Creates a new Material.\n\nReturns a new Material, a Render Material and a GH Preview Material using the parameters set as inputs.\nTo bake into Rhino you need to use the 'Bake with Attributes' LocalCode component. The material will be baked into a layer.\nBased on the work of Chris Hanley.\n\n    Typical usage:\n        Input a name string and a diffuse color and create a material.\n        The rest of the inputs are optional.\n        Connect the 'Material' output to assign the material to a geometry.\n        Connect the 'GHMaterial' to a 'Preview' component to visualize your material with GH objects.\n\n    Inputs:\n        Name: name string\n        diffuseColor: diffuse color\n        specularColor: specular color\n        emissioColor: emission color\n        transparency: transparency from 0 to 1\n        reflectionRange: reflection range from 0 to 1\n        glossiness: glossiness from 0 to 1\n\n    Outputs:\n        Material: Render material for Rhino geometry\n        GHMaterial: Material for GH preview \"\"\"\n\n__author__ = \"palomagr\"\n__version__ = \"2020.07.09\"\n\n#ghenv.Component.Name = \"Make Material\"\n#ghenv.Component.NickName = \"Make Material\"\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Grasshopper as gh\nimport scriptcontext as sc\n\n\nclass MyComponent(component):\n\n    def RunScript(self, Name, diffuseColor, specularColor, emissionColor, transparency,\n               ...",
  "code_blocks": [
    {
      "code": "\"\"\"Creates a new Material.\n\nReturns a new Material, a Render Material and a GH Preview Material using the parameters set as inputs.\nTo bake into Rhino you need to use the 'Bake with Attributes' LocalCode component. The material will be baked into a layer.\nBased on the work of Chris Hanley.\n\n    Typical usage:\n        Input a name string and a diffuse color and create a material.\n        The rest of the inputs are optional.\n        Connect the 'Material' output to assign the material to a geometry.\n        Connect the 'GHMaterial' to a 'Preview' component to visualize your material with GH objects.\n\n    Inputs:\n        Name: name string\n        diffuseColor: diffuse color\n        specularColor: specular color\n        emissioColor: emission color\n        transparency: transparency from 0 to 1\n        reflectionRange: reflection range from 0 to 1\n        glossiness: glossiness from 0 to 1\n\n    Outputs:\n        Material: Render material for Rhino geometry\n        GHMaterial: Material for GH preview \"\"\"\n\n__author__ = \"palomagr\"\n__version__ = \"2020.07.09\"\n\n#ghenv.Component.Name = \"Make Material\"\n#ghenv.Component.NickName = \"Make Material\"\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Grasshopper as gh\nimport scriptcontext as sc\n\n\nclass MyComponent(component):\n\n    def RunScript(self, Name, diffuseColor, specularColor, emissionColor, transparency,\n                  reflectionColor, glossiness, create):\n        GHMaterial = None\n        Material = None\n        newMat = ''\n\n        def IsMaterial(mat_index):\n            \"Verifies if a material exists in a given index\"\n            if mat_index >= 0 and mat_index < sc.doc.Materials.Count:\n                mat = sc.doc.Materials[mat_index]\n                a = not mat.IsDeleted\n                b = mat.IsDeleted\n                print(b, \"sdfsdfsfs\")\n                return not mat.IsDeleted\n            return False\n\n        if create:\n            sc.doc = Rhino.RhinoDoc.ActiveDoc\n            num = sc.doc.RenderMaterials.Count\n\n            for i in range(num):\n                mat_from_table = rs.MaterialName(i)\n                # print(Name, 'inputname',mat_from_table, 'this is the name')\n\n                if IsMaterial(i):\n                    print\n                    'yes'\n                if Name == mat_from_table:\n                    print('yes yes')\n                    rs.ResetMaterial(i)\n                    newMat = sc.doc.Materials[i]\n                else:\n                    newMat = Rhino.DocObjects.Material()\n\n\n\n            Reflection = min(max(reflectionColor, 0), 1);\n            Smoothness = min(max(glossiness, 0), 1);\n    \n            newMat = Rhino.DocObjects.Material()\n    \n            newMat.DiffuseColor = diffuseColor\n            newMat.SpecularColor = specularColor\n            newMat.AmbientColor = diffuseColor\n            newMat.EmissionColor = emissionColor\n            newMat.Transparency = transparency\n            newMat.ReflectionColor = specularColor\n            newMat.Reflectivity = Reflection\n            newMat.ReflectionGlossiness = Smoothness\n            newMat.Name = Name\n            material_gh = Rhino.Render.RenderMaterial.CreateBasicMaterial(newMat)\n            GHMaterial = gh.Kernel.Types.GH_Material(material_gh)  # GH preview material\n            Material = material_gh  # Rhino Material\n\n        # return outputs if you have them; here I try it for you:\n        return (Material, GHMaterial)\n\n\"\"\"Bake Material\"\"\"\n\nimport Rhino\nimport scriptcontext as sc\n\nif B:\n    sc.doc.RenderMaterials.Add(M)",
      "language": "python",
      "author": "palomagr",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "grasshopper",
    "layers",
    "materials",
    "python",
    "rhinoscriptsyntax"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 4,
  "views": 786
}