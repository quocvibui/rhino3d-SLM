{
  "source_url": "https://github.com/bryankuo/lab/blob/f40963dd99d22ffc4d6c034d1cc963dcaf22aaad/python/uno_kicks.py",
  "repo": "bryankuo/lab",
  "repo_stars": 0,
  "repo_description": "personal lab collection",
  "license": "unknown",
  "filepath": "python/uno_kicks.py",
  "instruction": "python3 uno_kicks.py [ticker] [quote] return a list to caller",
  "code": "#!/usr/bin/python3\n\n# python3 uno_kicks.py [ticker] [quote]\n# return a list to caller\n\n# calc uno playground\n\n# reference doc:\n# shorturl.at/EIJV1\n# https://wiki.documentfoundation.org/Macros/Python_Guide/Calc/Calc_sheets\n\n# import socket  # only needed on win32-OOo3.0.0\nimport uno, sys, time\nfrom datetime import datetime\nfrom com.sun.star.uno import RuntimeException\n\n# https://bit.ly/3sQRR4C\n# import msgbox\n# from pythonscript import ScriptContext\n\n# /Applications/LibreOffice.app/Contents/Resources/python \\\n#   uno_kicks.py 1101 45.05\n\n# /Applications/LibreOffice.app/Contents/Resources/python \\\n#   uno_kicks.py 1101 45.05 name qdi fund retail total\n#                per ph52 pl52 peer\n\ndef context():\n    # set global variables for context\n    global desktop\n    global model\n    global sheet0\n    # get the doc from the scripting context\n    # which is made available to all scripts\n    desktop = XSCRIPTCONTEXT.getDesktop()\n    model = desktop.getCurrentComponent()\n    sheet0 = model.Sheets.getByName(\"20231211\")\n\nMAX_ARG_LEN = 22\nif ( len(sys.argv) >= MAX_ARG_LEN ):\n    ticker = sys.argv[1]\n    quote = sys.argv[2]\n    corp_name = sys.argv[3]\n    qdi       = sys.argv[4]\n    fund      = sys.argv[5]\n    retail    = sys.argv[6]\n    d5total   = sys.argv[7]\n    per       = sys.argv[8]\n    per_hi52  = sys.argv[9]\n    per_lo52  = sys.argv[10]\n    per_peer  = sys.argv[11]\n    r52l      = sys.argv[12]\n    r52l_p    = sys.argv[13]\n    r52h      = sys.argv[14]\n    r52h_p    = sys.argv[15]\n    cap_e     = sys.argv[16]\n    sma5      = sys.argv[17]\n    sma5_d    = sys.argv[18] # direction is TBD\n    sma20     = sys.argv[19]\n    sma20_d   = sys.argv[20]\n    sma60     = sys.argv[21]\n    sma60_d   = sys.argv[22]\nelif ( len(sys.argv) < MAX_ARG_LEN and len(sys.argv) >= 3 ):\n    ticker = sys.argv[1]\n    quote = sys.argv[2]\nelse:\n    print('illegal #')\n    sys.exit(0)\n\n# try:\n# get the uno component context from the PyUNO runtime\nlocalContext = uno.getComponentContext()\n\n# create the UnoUrlResolver\nresolver = localContext.ServiceManager\\\n    .createInstanceWithContext( \\\n        \"com.sun.star.bridge.UnoUrlResolver\", localContext )\n\n# connect to the running office\nctx = resolver.resolve(\n    \"uno:socket,host=localhost,port=2002;urp;StarOffice.ComponentContext\" )\nsmgr = ctx.ServiceManager\n\n# get the central desktop object\ndesktop = smgr.createInstanceWithContext( \"com.sun.star.frame.Desktop\",ctx)\n# @see https://www.openoffice.org/api/docs/common/ref/com/sun/star/sheet/module-ix.html\n# access the current writer document\nmodel = desktop.getCurrentComponent()\n# try to move cursor to the center of sheet\n#cursor = desktop.getCurrentComponent() \\\n#    .getCurrentController().getViewCursor()\n\n# @see http://christopher5106.github.io/office/2015/12/06/openoffice-libreoffice-automate-your-office-tasks-with-python-macros.html\n# sheet_name = \"20231211\"\n# sheet = model.Sheets.getByName(sheet_name)\n# model.getCurrentController.setActiveSheet(sheet) # set the sheet active\n\n# access the active sheet\n# sheet0 = model.CurrentController.ActiveSheet\nsheet0 = model.Sheets.getByName(\"20231211\")\n\n# access cell C4\n# cell1 = sheet0.getCellRangeByName(\"j501\")\n\n# set text inside\n# cell1.String = ticker # \"28.42\" # \"Hello world\"\n# cell1.CellBackColor=0xFF0000 # (red)\n\n# other example with a value\n# cell2 = sheet0.getCellRangeByName(\"E6\")\n# cell2.Value = cell2.Value + 1\n\n# loop over existing rows @see shorturl.at/flzIR\n# range/range source: @see shorturl.at/uwOWX\n# oRangeSource = sheet0.getCellRangeByName('A1:A10')\n# print(oRangeSource.getDataArray())\n#sys.exit(0)\n\n# oSelection = model.getCurrentSelection()\n# oArea = oSelection.getRangeAddress()\n# store the attribute of CellRangeAddress\n# nLeft = oArea.StartColumn\n# nTop = oArea.StartRow\n# nRight = oArea.EndColumn\n# nBottom = oArea.EndRow\n# print(str(nLeft) + \", \" + str(nTop) + \\\n#     \", \" + str(nRight) + \", \" + str(nBottom))\n# sys.exit(0)\n\n# assume no more than 3000 listed.\nguessRange = sheet0.getCellRangeByPosition(0, 2, 0, 3000)\n# look up the actual used area within the guess area\ncursor = sheet0.createCursorByRange(guessRange)\ncursor.gotoEndOfUsedArea(False)\ncursor.gotoStartOfUsedArea(True)\nguessRange = sheet0.getCellRangeByPosition(0, 2, 0, len(cursor.Rows))\n# print(guessRange.getDataArray())\nlast_row = len(cursor.Rows)\n# print(last_row)\n\n'''\ncursor = sheet0.createCursor()\ncursor.gotoEndOfUsedArea(False)\ncursor.gotoStartOfUsedArea(True)\nlast_row = len(cursor.Rows)\nsys.exit(0)\n'''\n\n# set number format. is ( model, doc ) interchangable in terms?\ndoc = None\nnumbers = None\nlocale = None\nnl = None\n# trying:\n# @see https://ask.libreoffice.org/t/why-does-desktop-getcurrentcomponent-return-none-in-pyuno/59902/5\nwhile doc is None:\n    doc = desktop.getCurrentComponent()\n    numbers = doc.NumberFormats\n    locale = doc.CharLocale\n# instead of\n# @see https://ask.libreoffice.org/t/formatting-data-cell-from-macro-in-calc/23740\n# doc = XSCRIPTCONTEXT.getDocument()\ntry:\n    nl = numbers.addNew( \"###0.00\",  locale )\nexcept RuntimeException:\n    nl = numbers.queryKey(\"###0.00\", locale, False)\n\naddr_q     = \"J1\" # initial\naddr_52lo  = \"K1\"\naddr_r52lp = \"L1\"\naddr_52hi  = \"M1\"\naddr_r52hp = \"N1\"\naddr_resist = \"G1\"\naddr_support = \"H1\"\naddr_cheap = \"I1\"\naddr_x = \"A1\"\naddr_n = \"B1\"\naddr_qdi = \"C1\"\naddr_fund = \"D1\"\naddr_retail = \"E1\"\naddr_5dtotal = \"F1\"\naddr_per = \"O1\"\naddr_per_h52 = \"P1\"\naddr_per_l52 = \"Q1\"\naddr_per_peer = \"R1\"\n\n# caller uno_eps.sh, uno_status.sh -> uno_eps.py\n# addr_2021q4 = \"S1\"\n# addr_2021q3 = \"T1\"\n# addr_2021q2 = \"U1\"\n# addr_2021q1 = \"V1\"\n\n# addr_2020q4 = \"W1\"\n# addr_2020q3 = \"X1\"\n# addr_2020q2 = \"Y1\"\n# addr_2020q1 = \"Z1\"\n\n# addr_2019q4 = \"AA1\"\n# addr_2019q3 = \"AB1\"\n# addr_2019q2     = \"AC1\"\n\naddr_stalk      = \"AE1\"\naddr_cape       = \"AL1\"\n\naddr_sma5       = \"AN1\"\naddr_sma20      = \"AO1\"\naddr_sma60      = \"AP1\"\naddr_last       = \"BH1\"\n\ndef set_value():\n    if ( len(sys.argv) >= MAX_ARG_LEN ):\n        cell_ticker = sheet0.getCellRangeByName(addr_n)\n        cell_ticker.String = corp_name\n        cell_ticker = sheet0.getCellRangeByName(addr_qdi)\n        cell_ticker.Value = int(qdi)\n        cell_ticker = sheet0.getCellRangeByName(addr_fund)\n        cell_ticker.Value = int(fund)\n        cell_ticker = sheet0.getCellRangeByName(addr_retail)\n        cell_ticker.Value = int(retail)\n        cell_ticker = sheet0.getCellRangeByName(addr_5dtotal)\n        cell_ticker.String = d5total\n        cell_ticker = sheet0.getCellRangeByName(addr_per)\n        cell_ticker.String = per\n        cell_ticker = sheet0.getCellRangeByName(addr_per_h52)\n        cell_ticker.String = per_hi52\n        cell_ticker = sheet0.getCellRangeByName(addr_per_l52)\n        cell_ticker.String = per_lo52\n        cell_ticker = sheet0.getCellRangeByName(addr_per_peer)\n        cell_ticker.String = per_peer\n        cell_ticker = sheet0.getCellRangeByName(addr_52lo)\n        cell_ticker.String = r52l\n        cell_ticker = sheet0.getCellRangeByName(addr_r52lp)\n        cell_ticker.String = r52l_p\n        cell_ticker = sheet0.getCellRangeByName(addr_52hi)\n        cell_ticker.String = r52h\n        cell_ticker = sheet0.getCellRangeByName(addr_r52hp)\n        cell_ticker.String = r52h_p\n        cell_ticker = sheet0.getCellRangeByName(addr_cape)\n        cell_ticker.Value = float(cap_e)\n        cell_ticker = sheet0.getCellRangeByName(addr_sma5)\n        cell_ticker.Value = float(sma5)\n        cell_ticker = sheet0.getCellRangeByName(addr_sma20)\n        cell_ticker.Value = float(sma20)\n        cell_ticker = sheet0.getCellRangeByName(addr_sma60)\n        cell_ticker.Value = float(sma60)\n\ncellq = sheet0.getCellRangeByName(addr_q)\nfor i in range(2, last_row):\n    addr_x = \"A\" + str(i)\n    cellx = sheet0.getCellRangeByName(addr_x)\n    if ( cellx.String == ticker ):\n        addr_q = \"J\" + str(i)\n        addr_resist = \"G\" + str(i)\n        addr_support = \"H\" + str(i)\n        addr_cheap = \"I\" + str(i)\n        addr_52lo = \"K\" + str(i)\n        addr_r52lp = \"L\" + str(i)\n        addr_52hi = \"M\" + str(i)\n        addr_r52hp = \"N\" + str(i)\n        addr_ticker = \"A\" + str(i)\n        addr_n = \"B\" + str(i)\n        addr_qdi = \"C\" + str(i)\n        addr_fund = \"D\" + str(i)\n        addr_retail = \"E\" + str(i)\n        addr_5dtotal = \"F\" + str(i)\n        addr_per = \"O\" + str(i)\n        addr_per_h52 = \"P\" + str(i)\n        addr_per_l52 = \"Q\" + str(i)\n        addr_per_peer = \"R\" + str(i)\n        addr_stalk = \"AE\" + str(i)\n        addr_cape = \"AL\" + str(i)\n        addr_sma5     = \"AN\" + str(i)\n        addr_sma20    = \"AO\" + str(i)\n        addr_sma60    = \"AP\" + str(i)\n        addr_last     = \"BH\" + str(i)\n        break\n\nif ( addr_q == \"J1\" ):\n    # print(ticker + corp_name + \" not found in sheet, add entry,\")\n    addr_x = \"A\" + str( last_row + 1 )\n    addr_n = \"B\" + str( last_row + 1 )\n    addr_qdi = \"C\" + str( last_row + 1 )\n    addr_fund = \"D\" + str( last_row + 1 )\n    addr_retail = \"E\" + str( last_row + 1 )\n    addr_5dtotal = \"F\" + str( last_row + 1 )\n    addr_q = \"J\" + str( last_row + 1 )\n    addr_resist = \"G\" + str( last_row + 1 )\n    addr_support = \"H\" + str( last_row + 1 )\n    addr_cheap = \"I\" + str( last_row + 1 )\n    addr_52lo = \"K\" + str( last_row + 1 )\n    addr_r52lp = \"L\" + str( last_row + 1 )\n    addr_52hi = \"M\" + str( last_row + 1 )\n    addr_r52hp = \"N\" + str( last_row + 1 )\n    addr_per = \"O\" + str( last_row + 1 )\n    addr_per_h52 = \"P\" + str( last_row + 1 )\n    addr_per_l52 = \"Q\" + str( last_row + 1 )\n    addr_per_peer = \"R\" + str( last_row + 1 )\n    addr_stalk = \"AE\" + str( last_row + 1 )\n    addr_cape     = \"AL\" + str( last_row + 1 )\n    addr_sma5     = \"AN\" + str( last_row + 1 )\n    addr_sma20    = \"AO\" + str( last_row + 1 )\n    addr_sma60    = \"AP\" + str( last_row + 1 )\n    addr_last     = \"BH\" + str( last_row + 1 )\n    cell_ticker = sheet0.getCellRangeByName(addr_x)\n    cell_ticker.String = ticker\n\nset_value()\n\ncellq = sheet0.getCellRangeByName(addr_q)\ncellq.Value = float(quote)\ncellq.NumberFormat = nl\ncellq.CellBackColor = 0xFFFF00\ntime.sleep(.6)\ncellq.CellBackColor = 0xFFFFFF\nout_of_spec = 0\n\ncell   = sheet0.getCellRangeByName(addr_support)\ncell_r = sheet0.getCellRangeByName(addr_resist)\n# @see https://stackoverflow.com/a/9573283\nif ( cell.String and cell.String != \"n/a\" and cell.String != \"\" ):\n    support = float(cell.String)\n    if ( support > float(quote) ):\n        cell_r.String = support\n        cell_r.CellBackColor = 0xFFFF00\n        cell.String = \"\"\n        # cell.CellBackColor = 0xFFFFFF\n        out_of_spec = out_of_spec + 1 # become resistance\n\nif ( cell_r.String and cell_r.String != \"n/a\" and cell_r.String != \"\" ):\n    resist = float(cell_r.String)\n    if ( resist < float(quote) ):\n        cell.String = resist\n        # cell.CellBackColor = 0xFFFF00\n        cell_r.String = \"\"\n        cell_r.CellBackColor = 0xFFFFFF\n        out_of_spec = out_of_spec + 2 # become support\n\ncell = sheet0.getCellRangeByName(addr_52lo)\nif ( cell.String and cell.String != \"n/a\" ):\n    if ( float(cell.String) > float(quote) ):\n        cell.CellBackColor = 0xFFFF00\n        out_of_spec = out_of_spec + 4\n    else:\n        cell.CellBackColor = 0xFFFFFF\n\ncell = sheet0.getCellRangeByName(addr_cheap)\nif ( cell.String and cell.String != \"n/a\" ):\n    if ( float(cell.String) > float(quote) ):\n        cell.CellBackColor = 0xFFFF00\n        out_of_spec = out_of_spec + 8\n    else:\n        cell.CellBackColor = 0xFFFFFF\n\ncell = sheet0.getCellRangeByName(addr_52hi)\nif ( cell.String and cell.String != \"n/a\" ):\n    if ( float(cell.String) < float(quote) ):\n        cell.CellBackColor = 0xFFFF00\n        out_of_spec = out_of_spec + 16\n    else:\n        cell.CellBackColor = 0xFFFFFF\n\n# cell_name   = sheet0.getCellRangeByName(addr_n)\n# color_name = cell_name.CellBackColor\n# cell_ticker = sheet0.getCellRangeByName(addr_x)\n# color_ticker = cell_ticker.CellBackColor\n\n# if out of spec or marking as 'watching' then set 'stalking' to 1 else 0\n# if ( color_name != 0xFFFFFF ):\n# cell_stalk.Value= 1\n\ncell_stalk = sheet0.getCellRangeByName(addr_stalk)\nif ( 0 < out_of_spec ):\n    cell_stalk.Value = 1\nelse:\n    cell_stalk.String = \"\"\n# @see ref: shorturl.at/lsuHT\n\ncell = sheet0.getCellRangeByName(addr_last)\ncell.Value = int('{:%Y%m%d}'.format(datetime.now()))\n\nolist = [ out_of_spec ]\nprint(olist)\n\n# //TODO: multithreading\n\n# //TODO: support and resistance\n# @see https://www.cnyes.com/twstock/Pressure24.aspx?code=1258\n# 24d, type 2, 4\n# @see https://www.capital.com.tw/stock/fetw/sup_res.asp\n# https://www.capital.com.tw/stock/fetw/sup_res.asp?xy=4&xt=6\n# @see https://www.wantgoo.com/stock/future-index-calculator\n\n'''\n// TODO: to dig more @see https://selenium-python.readthedocs.io/api.html\nexcept NoConnectException e:\n    print \"The OpenOffice.org process is not started or does not listen on the resource (\"+e.Message+\")\"\nexcept IllegalArgumentException e:\n    print \"The url is invalid ( \"+ e.Message+ \")\"\nexcept RuntimeException e:\n    print \"An unknown error occurred: \" + e.Message\nexcept NoConnectException as ex:\n    print(ex.Message)\n    print('make sure calc UNO bridge is ready.')\nfinally:\n'''\nsys.exit(0)\n",
  "language": "python",
  "imports": [],
  "has_docstring": true
}