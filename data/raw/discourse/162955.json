{
  "source_url": "https://discourse.mcneel.com/t/custom-ui-elements-with-eto-forms/162955",
  "topic_id": 162955,
  "title": "Custom UI Elements with Eto.Forms",
  "question": "Hey everyone,\n\n\n@sonderskovmathias\n asked me to share some experience with building custom UI elements with Eto.Forms. Instead of spamming the \noriginal thread\n, let’s start a dedicated conversation here.\n\n\nHere is a sneak peek at our upcoming Rhino plugin called \nShape\n. It makes terrain modelling fun, interactive, and super productive! But that’s a separate story…\n\n\n\n\n\n\nIn the process of making it, \n@Wiley\n and I have learned a lot. Everything you see above are custom UI elements written on top of \nEto.Forms.Drawable\n (side panel) or hacks deep into the \nDisplayPipeline\n (HUD elements).\n\n\nFeel free to ask specific questions and we’ll try to answer to the best of our abilities.\n\n\nI also wanted to ask \n@bobmcneel\n if there are any plans of increasing McNeel’s involvement in the Eto project. Obviously, \n@curtisw\n is putting a lot of effort into further developing the repo but it has grown beyond what one person can reasonably maintain. I believe \n@dale\n and \n@stevebaer\n are doing work on the UI for the WIP version but these contributions don’t seem to find their way into the open-source codebase. Since Eto is the officially recommended UI framework for cross-platform Rhino plugin development, it would be nice to understand McNeel’s commitment level to the project. As it is now, Rhino is not even listed as an app \nusing the framework\n:\n\n\nSkærmbillede 2023-07-18 132107\n825×414 22.1 KB\n\n\nTagging a few people, who expressed interest in custom UIs in the past.\n\n\n@DavidRutten\n, \n@AndersDeleuran\n, \n@aramon\n, \n@lando.schumpich\n, \n@mlukasz87\n, \n@matteo1\n, \n@Felipe_Penagos\n, \n@maxsoder\n, \n@Holo\n, \n@johannavarro.art\n, \n@D-W\n, \n@jordanmathers.jm",
  "code_blocks": [
    {
      "code": "<ResourceDictionary xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n                    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n                    xmlns:eto=\"clr-namespace:Eto.Wpf.Forms.Controls;assembly=Eto.Wpf\" \n                    xmlns:rwr=\"clr-namespace:RhinoWindows.Runtime\">\n\n    <SolidColorBrush x:Key=\"Button.Static.Background\" Color=\"{DynamicResource RhinoTheme.Button.Enabled.Background}\"/>\n    <SolidColorBrush x:Key=\"Button.Static.Border\" Color=\"{DynamicResource RhinoTheme.Button.Enabled.Border}\"/>\n    <SolidColorBrush x:Key=\"Button.Foreground\" Color=\"{DynamicResource RhinoTheme.Button.Enabled.Text}\"/>\n    <SolidColorBrush x:Key=\"Button.MouseOver.Background\" Color=\"{DynamicResource RhinoTheme.Button.EnabledHover.Background}\"/>\n    <SolidColorBrush x:Key=\"Button.MouseOver.Border\" Color=\"{DynamicResource RhinoTheme.Button.EnabledHover.Border}\"/>\n    <SolidColorBrush x:Key=\"Button.MouseOver.Foreground\" Color=\"{DynamicResource RhinoTheme.Button.EnabledHover.Text}\"/>\n    <SolidColorBrush x:Key=\"Button.Pressed.Background\" Color=\"{DynamicResource RhinoTheme.Button.EnabledPressed.Background}\"/>\n    <SolidColorBrush x:Key=\"Button.Pressed.Border\" Color=\"{DynamicResource RhinoTheme.Button.EnabledPressed.Border}\"/>\n    <SolidColorBrush x:Key=\"Button.Disabled.Background\" Color=\"{DynamicResource RhinoTheme.Button.Disabled.Background}\"/>\n    <SolidColorBrush x:Key=\"Button.Disabled.Border\" Color=\"{DynamicResource RhinoTheme.Button.Disabled.Border}\"/>\n    <SolidColorBrush x:Key=\"Button.Disabled.Foreground\" Color=\"{DynamicResource RhinoTheme.Button.Disabled.Text}\"/>\n\n    <Style x:Key=\"ButtonStyle\" TargetType=\"ButtonBase\">\n        <Setter Property=\"Background\" Value=\"{DynamicResource Button.Static.Background}\"/>\n        <Setter Property=\"BorderBrush\" Value=\"{DynamicResource Button.Static.Border}\"/>\n        <Setter Property=\"BorderThickness\" Value=\"1\"/>\n        <Setter Property=\"HorizontalContentAlignment\" Value=\"Center\"/>\n        <Setter Property=\"VerticalContentAlignment\" Value=\"Center\"/>\n        <Setter Property=\"Padding\" Value=\"1\"/>\n        <Setter Property=\"Template\">\n            <Setter.Value>\n                <ControlTemplate TargetType=\"ButtonBase\">\n                    <Border x:Name=\"border\" Background=\"{TemplateBinding Background}\" BorderBrush=\"{TemplateBinding BorderBrush}\" BorderThickness=\"{TemplateBinding BorderThickness}\" SnapsToDevicePixels=\"true\">\n                        <ContentPresenter x:Name=\"contentPresenter\" Focusable=\"False\" HorizontalAlignment=\"{TemplateBinding HorizontalContentAlignment}\" Margin=\"{TemplateBinding Padding}\" RecognizesAccessKey=\"True\" SnapsToDevicePixels=\"{TemplateBinding SnapsToDevicePixels}\" VerticalAlignment=\"{TemplateBinding VerticalContentAlignment}\" />\n                    </Border>\n                    <ControlTemplate.Triggers>\n                        <Trigger Property=\"rwr:EtoStyles.IsBorderless\" Value=\"True\">\n                            <Setter Property=\"Background\" TargetName=\"border\" Value=\"Transparent\"/>\n                            <Setter Property=\"BorderThickness\" TargetName=\"border\" Value=\"0\"/>\n                            <Setter Property=\"BorderBrush\" TargetName=\"border\" Value=\"{x:Null}\"/>\n                        </Trigger>\n                        <!-- since we have no border, set the image opacity when not enabled -->\n                        <MultiTrigger>\n                            <MultiTrigger.Conditions>\n                                <Condition Property=\"IsEnabled\" Value=\"False\"></Condition>\n                                <Condition Property=\"rwr:EtoStyles.IsBorderless\" Value=\"True\"></Condition>\n                            </MultiTrigger.Conditions>\n                            <Setter Property=\"Opacity\" TargetName=\"border\" Value=\"0.5\"/>\n                        </MultiTrigger>\n\n                        <!-- Defaults -->\n                        <Trigger Property=\"IsMouseOver\" Value=\"true\">\n                            <Setter Property=\"Background\" TargetName=\"border\" Value=\"{DynamicResource Button.MouseOver.Background}\"/>\n                            <Setter Property=\"BorderBrush\" TargetName=\"border\" Value=\"{DynamicResource Button.MouseOver.Border}\"/>\n                        </Trigger>\n                        <Trigger Property=\"IsPressed\" Value=\"true\">\n                            <Setter Property=\"Background\" TargetName=\"border\" Value=\"{DynamicResource Button.Pressed.Background}\"/>\n                            <Setter Property=\"BorderBrush\" TargetName=\"border\" Value=\"{DynamicResource Button.Pressed.Border}\"/>\n                        </Trigger>\n                        <Trigger Property=\"IsEnabled\" Value=\"false\">\n                            <Setter Property=\"Background\" TargetName=\"border\" Value=\"{DynamicResource Button.Disabled.Background}\"/>\n                            <Setter Property=\"BorderBrush\" TargetName=\"border\" Value=\"{DynamicResource Button.Disabled.Border}\"/>\n                            <Setter Property=\"TextElement.Foreground\" TargetName=\"contentPresenter\" Value=\"{DynamicResource Button.Disabled.Foreground}\"/>\n                        </Trigger>\n                    </ControlTemplate.Triggers>\n                </ControlTemplate>\n            </Setter.Value>\n        </Setter>\n        <Style.Resources>\n            <Style TargetType=\"Label\">\n                <Setter Property=\"Foreground\" Value=\"{DynamicResource Button.Foreground}\"/>\n                <Style.Triggers>\n                    <Trigger Property=\"IsMouseOver\" Value=\"True\">\n                        <Setter Property=\"Foreground\" Value=\"{DynamicResource Button.MouseOver.Foreground}\"/>\n                    </Trigger>\n                    <Trigger Property=\"IsEnabled\" Value=\"False\">\n                        <Setter Property=\"Foreground\" Value=\"{DynamicResource Button.Disabled.Foreground}\"/>\n                    </Trigger>\n                </Style.Triggers>\n            </Style>\n        </Style.Resources>\n\n    </Style>\n\n    <Style TargetType=\"eto:EtoButton\" BasedOn=\"{StaticResource ButtonStyle}\">\n        <Style.Triggers>\n            <Trigger Property=\"IsDefaulted\" Value=\"true\">\n                <Setter Property=\"BorderBrush\" Value=\"{DynamicResource {x:Static SystemColors.HighlightBrushKey}}\"/>\n            </Trigger>\n        </Style.Triggers>\n    </Style>\n\n    <Style TargetType=\"Button\" BasedOn=\"{StaticResource ButtonStyle}\">\n        <Style.Triggers>\n            <Trigger Property=\"IsDefaulted\" Value=\"true\">\n                <Setter Property=\"BorderBrush\" Value=\"{DynamicResource {x:Static SystemColors.HighlightBrushKey}}\"/>\n            </Trigger>\n        </Style.Triggers>\n    </Style>\n\n    <Style x:Key=\"ButtonSpinnerRepeatButton\" TargetType=\"{x:Type RepeatButton}\" BasedOn=\"{StaticResource ButtonStyle}\">\n        <Setter Property=\"rwr:EtoStyles.IsBorderless\" Value=\"true\"/>\n    </Style>\n\n\n</ResourceDictionary>",
      "language": "csharp",
      "author": "curtisw",
      "post_number": 15,
      "is_solution": false
    },
    {
      "code": "public static class StyleSetter\n    {\n        public static void SetStyles()\n        {\n            Eto.Style.Add<Eto.Forms.Panel>(\"Transpar2\", control =>\n            {\n                var wpfwnd = (System.Windows.Window)control.ControlObject;\n                wpfwnd.AllowsTransparency = true;\n                wpfwnd.Background = System.Windows.Media.Brushes.Transparent;\n                wpfwnd.Opacity = 0.5;\n                wpfwnd.Topmost = true;\n               // wpfwnd.ShowActivated = true;\n            });\n\n        }\n    }\n\n    public class PopupMenu : Form\n    {\n        private Timer timer;\n        private int sectorCount = 12;\n        private int hoveredSector = -1; // -1 indicates no hover\n        private int clickedSector = -1; // -1 indicates no click\n        private PointF[] middlePoints;\n        private float hoverRadius = 18; // Adjust this radius to increase the area for mouse hover\n\n        private float scale = 0.1f;\n        private const float scaleIncrement = 0.1f; // Adjust this for the speed of the animation\n        private float rot = 0;\n        private const float rotcof = 18;\n        int size = 194;\n\n        Drawable drawable;\n\n        public PopupMenu()\n        {\n            StyleSetter.SetStyles();\n\n            WindowStyle = Eto.Forms.WindowStyle.None;\n            Style = \"Transpar2\";\n            //Opacity = 0.5;\n            ClientSize = new Size(size, size);\n            Padding = 0;\n\n            timer = new Timer\n            {\n                Interval = 100\n            };\n            timer.Start();\n            timer.Elapsed += Send;\n\n            drawable = new Drawable\n            {\n                Size = new Size(size, size),\n              \n               \n            };\n            BackgroundColor = Colors.Transparent;\n            drawable.Paint += CircleMenu;\n            drawable.MouseMove += Drawable_MouseMove;\n            drawable.MouseDown += Drawable_MouseDown;\n            drawable.MouseUp += Drawable_MouseUp;\n\n            StackLayout st1 = new StackLayout()\n            {\n                Orientation = Orientation.Horizontal,\n                HorizontalContentAlignment = HorizontalAlignment.Center,\n                VerticalContentAlignment = VerticalAlignment.Bottom,\n            };\n            st1.Items.Add(drawable);\n\n            Content = st1;\n\n            //  var center = Screen.PrimaryScreen.WorkingArea.Center;\n            //  center.X -= 194 / 2;\n            //  center.Y -= 194 / 2;\n            // Location = new Point(center);\n        }\n\n        private void Send(object sender, ElapsedEventArgs e)\n        {\n            Application.Instance.Invoke(() =>\n            {\n                scale += scaleIncrement;\n                rot -= rotcof;\n\n                // Ensure the rotation does not exceed 180 degrees\n                if (rot <= -180)\n                {\n                    rot = 0;\n                    timer.Stop();\n                    timer.Dispose();\n                }\n\n                // Limit the scale to not exceed 1\n                if (scale > 1)\n                {\n                    scale = 1;\n                }\n\n                Invalidate();\n            });\n        }\n\n        private void CircleMenu(object sender, PaintEventArgs e)\n        {\n            Graphics g = e.Graphics;\n           \n            // Calculate the center of the scaled outer circle bounds\n      \n            float centerX = (float)size / 2f;\n            float centerY = (float)size / 2f;\n\n            // Transform center\n            g.TranslateTransform(centerX, centerY);\n            g.ScaleTransform(scale);\n            g.RotateTransform(rot);\n            g.TranslateTransform(-centerX,- centerY);\n\n            RectangleF outerCircleBounds = new RectangleF(10, 10, 180, 180);\n            RectangleF innerCircleBounds = new RectangleF(outerCircleBounds.Left + outerCircleBounds.Width / 3, outerCircleBounds.Top + outerCircleBounds.Height / 3, outerCircleBounds.Width / 3, outerCircleBounds.Height / 3);\n\n            // g.FillEllipse(Brushes.LightGrey, outerCircleBounds);\n        }",
      "language": "csharp",
      "author": "taraskydon",
      "post_number": 38,
      "is_solution": false
    },
    {
      "code": "public static Win32Window rhino_win32Window = new Win32Window(RhinoApp.MainWindowHandle());\n\n        public static Win32Window _viewportWindow = Win32Window.rhino_win32Window.Children[0];  // main viewport window",
      "language": "csharp",
      "author": "Wiley",
      "post_number": 48,
      "is_solution": false
    },
    {
      "code": "protected override void DrawForeground(DrawEventArgs e)\n{\n    //Disable if not active RhinoDoc (fixes issue when using render panel)\n    //Disable if not parent view (stops displaying for block manager preview window)\n    //Disable if creating view capture IsInViewCapture\n    //Disable in layout/detail views\n    //Only show in \"Top\" viewport\n    if (e.RhinoDoc is null ||\n        e.Viewport.ParentView == null ||\n        e.Display.IsInViewCapture ||\n        e.Viewport.ViewportType != ViewportType.StandardModelingViewport ||\n        e.Display.Viewport.Name != \"Top\")\n        return;\n\n    var viewportBounds = e.Viewport.Bounds;\n    var textPosition = new Point2d(viewportBounds.Left + 20, viewportBounds.Bottom - 20);\n    e.Display.Draw2dText(_displayText, System.Drawing.Color.Black, textPosition, false);\n}",
      "language": "csharp",
      "author": "Lukxf",
      "post_number": 64,
      "is_solution": false
    }
  ],
  "tags": [
    "geometry",
    "materials",
    "python",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 63,
  "views": 9335
}