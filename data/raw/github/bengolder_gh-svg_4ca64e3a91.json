{
  "source_url": "https://github.com/bengolder/gh-svg/blob/7cc3c79ff8c980f76b9b4208f21c2f550d6e87c5/svg-export.py",
  "repo": "bengolder/gh-svg",
  "repo_stars": 23,
  "repo_description": "A Plugin for exporting geometry from Grasshopper/Rhino to SVG data format",
  "license": "unknown",
  "filepath": "svg-export.py",
  "instruction": "Svg export",
  "code": "try:\n    import Rhino\n    import scriptcontext\n    import System\n    GH=True\nexcept:\n    GH=False\n\n'''This module is currently just a rough shot for sketching out ideas about svg\nexport.'''\n\n\nFEATURE_TRANSLATOR = (\n        'Point', 'Point3d'\n        'MultiPoint', 'Point3d'\n        'LineString', 'Curve', 'Polyline'\n        'MultiLineString','Curve', 'Polyline'\n        'Polygon',\n        'MultiPolygon',\n        )\n\ndef conversion_lookup(g):\n    if isinstance(g, Rhino.Geometry.Point3d):\n        return to_svg_point\n    elif isinstance(g, Rhino.Geometry.Polyline):\n        return to_svg_polyline\n    elif isinstance(g, Rhino.Geometry.Curve):\n        return to_svg_curve\n    else:\n        try:\n            to_svg_curve\n        except:\n            print 'This geometry could not be converted:'\n            print type(g)\n            raise\n\ndef to_svg_point(vp, g, atts):\n    x, y = viewPoint(g, vp)\n    return svgCircle(x,y)\n\ndef to_svg_polyline(vp, g, atts):\n    polyline = g.TryGetPolyline()[1]\n    # get points from polyline\n    pts = [pt for pt in polyline]\n    # convert them to path coords\n    coords = [viewPoint(p, vp) for p in pts]\n    return svgPolyline(coords, atts)\n\ndef to_svg_curve(vp, g, atts):\n    poly = g.ToPolyline(0,0,0.01, 0.1, tol, 0, 0, True, g.Domain)\n    return to_svg_polyline(vp, poly, atts)\n\ndef viewPoint(point3d, viewport):\n    point2d = viewport.WorldToClient(point3d)\n    return point2d.X, point2d.Y\n\n\ndef xml_attributes(**kwargs):\n    att_mask = '%s=\"%s\"'\n    atts = []\n    for key in ('id', 'class'):\n        if key in kwargs:\n            atts.append((key, kwargs.pop(key)))\n    for k in kwargs:\n        atts.append((k, kwargs[k]))\n    return ' '.join([att_mask % a for a in atts])\n\ndef to_svg(**kwargs):\n    tag = kwargs.pop('tag')\n    return '<%s %s />' % (tag, xml_attributes(**kwargs))\n\nclass svgRenderable(object):\n    def render(self):\n        if self.tag:\n            d = vars(self)\n            # blend attributes into dictionary\n            d.update(d.pop('attributes'))\n            return to_svg(**d)\n        else:\n            print 'ERROR: no tag name'\n            return\n\nclass svgCircle(svgRenderable):\n    def __init__(self, cx, cy, attributes):\n        self.tag = 'circle'\n        self.cx = cx\n        self.cy = cy\n        self.attributes = attributes\n\nclass svgPolyline(svgRenderable):\n    def __init__(self, coords, attributes):\n        self.tag = 'path'\n        self.d = self.parse_coords(coords)\n        self.attributes = attributes\n    def parse_coords(self, coords):\n        coord_pairs = ['%s %s' % (c[0], c[1]) for c in coords]\n        return 'M %s' % ' L '.join(coord_pairs)\n\ndef svg_wrap(svgs):\n    wrapper = '''<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\">\n%s\n</svg>'''\n    return wrapper % '\\n'.join(svgs)\n\ndef html_wrap(svg, title='Grasshopper Export', css='', js=''):\n    wrapper = '''\n<html lang=\"en\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <title>%s</title>\n        <style type=\"text/css\">\n        %s\n        </style>\n    </head>\n    <body>\n        <div id=\"container\">\n        %s\n        </div>\n        <script type=\"text/javascript\">\n        %s\n        </script>\n    </body>\n</html>'''\n    return wrapper % (title, css, svg_wrap(svg), js)\n\ndef build_svg_text(geometry, atts, viewport):\n    out = []\n    for i, g in enumerate(geometry):\n        svg = conversion_lookup(g)(viewport, g, atts[i])\n        txt = svg.render()\n        out.append(txt)\n    return out\n\nif GH:\n    '''This part only runs if this code is pasted in a Grasshopper python\n    component.\n    '''\n    if geometry and create_svg:\n        # run the script\n        if attribute_dictionaries:\n            # unwrap the attribute dictionaries, just get their normal\n            # dictionaries\n            atts = [a.d for a in attribute_dictionaries]\n        else:\n            atts = []\n        if not viewport:\n            viewport = scriptcontext.doc.Views.ActiveView.ActiveViewport\n        tol = polyline_tol\n        svg_text = html_wrap(build_svg_text(geometry, atts, viewport), title, css, js)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": false
}