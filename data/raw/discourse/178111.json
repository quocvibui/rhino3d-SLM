{
  "source_url": "https://discourse.mcneel.com/t/eto-forms-ui-that-stays-with-an-object-as-the-viewport-moves/178111",
  "topic_id": 178111,
  "title": "Eto.Forms - UI that stays with an object as the viewport moves",
  "question": "Hello,\n\n\nAnother Eto question from me…\n\n\nI’m attempting to use the WorldToClient method to translate a Point3d location in World Space to 2D Screen Space and spawn an Eto.Form at the location of this point object in World Space.\n\nThe point object in this example is the midpoint of an arc curve but I’m trying to understand how to achieve this with any 3d point.\n\n\nHow can I ensure that the Eto UI location is updated in real-time so that it is always at the point3d location even as the viewport/camera moves/rotates/pans?\n\n\nI’ve added a simple Rhino file and Grasshopper script for a prototype mockup.\n\n\nNote how the text dot is always at the mid point of the door swing arc. (I realize this uses different location code under the hood, it’s just a visual example of where I want the UI to be)\n\n\nI would like to replace the text dot with am Eto.Form UI that I can “do things with” but have this form stay visually locked to the original location point as the camera moves. The form would be closed after the object is no longer selected or an action that triggers a close is performed.\n\n\nThank you all for your help!\n\n\nNothing Selected:\n\n\nimage\n947×782 49.4 KB\n\n\nDoor “Guiding Point” Selected (Note that text dot appears at arc midpoint):\n\n\nimage\n937×811 64.6 KB\n\n\nEto.Form at object location:\n\n\nimage\n686×712 49.1 KB\n\n\nEto.Form after viewport moved (still at the original location, not the current location of the object):\n\n\nimage\n486×606 30.4 KB\n\n\nimport Rhino\nimport scriptcontext as sc\nimport System\n\nimport Eto.Forms as forms\nimport Eto.Drawing as drawing\n\nsc.doc = Rhino.RhinoDoc.ActiveDoc\n\n# Global variable to hold the form instance\nform_instance = None\n\ndef GetScreenLocation(Location):\n    # Convert world coordinates to screen coordinates\n    view = Rhino.UI.RhinoEtoApp.MainWindow.Screen.WorkingArea\n    screen_location = view.ActiveViewport.WorldToClient(Location)\n    return screen_location\n\nclass SampleTransparentEtoForm(forms.Form):\n    def __init__(self):\n\n        self.WindowStyl...",
  "code_blocks": [
    {
      "code": "import Rhino\nimport scriptcontext as sc\nimport System\n\nimport Eto.Forms as forms\nimport Eto.Drawing as drawing\n\nsc.doc = Rhino.RhinoDoc.ActiveDoc\n\n# Global variable to hold the form instance\nform_instance = None\n\ndef GetScreenLocation(Location):\n    # Convert world coordinates to screen coordinates\n    view = Rhino.UI.RhinoEtoApp.MainWindow.Screen.WorkingArea\n    screen_location = view.ActiveViewport.WorldToClient(Location)\n    return screen_location\n\nclass SampleTransparentEtoForm(forms.Form):\n    def __init__(self):\n\n        self.WindowStyle = forms.WindowStyle.None\n        \n        self.Styles.Add[forms.Panel](\"transparent\", self.MyFormStyler)\n        self.Style = \"transparent\"\n        \n        self.AutoSize = False\n        self.Resizable = True\n        self.TopMost = True\n        self.ShowActivated = False\n        self.Size = drawing.Size(50, 70)  # Adjust the size as needed\n        self.Padding = drawing.Padding(10)\n        self.MovableByWindowBackground = False\n\n        # Convert world coordinates to screen coordinates\n        view = scriptcontext.doc.Views.ActiveView\n        screen_location = view.ActiveViewport.WorldToClient(Location)\n\n        self.Location = drawing.Point(screen_location.X, screen_location.Y)\n        \n        self.Button = forms.Button(Text=Angle, BackgroundColor=drawing.Colors.Transparent)\n        self.TextBox = forms.TextBox(Text=Angle)\n        self.TextBox.TextChanged += self.OnTextChanged\n        self.TextBox.KeyDown += self.OnTextBoxKeyDown\n        self.TextBox.Visible = False\n        self.updated_angle = None\n        \n        # Event handler for button click\n        self.Button.Click += self.OnButtonClick\n        \n        self.layout = forms.DynamicLayout()\n        self.layout.AddRow(self.Button)\n        self.layout.AddRow(self.TextBox)\n        \n        # Add ImageView to the layout\n        self.layout.AddRow(self.DrawImage())  # Call DrawImage method and add it to the layout\n        \n        self.Content = self.layout\n\n    def MyFormStyler(self, control):\n        self.BackgroundColor = drawing.Colors.Transparent\n        window = control.ControlObject\n        if hasattr(window, \"AllowsTransparency\"):\n            window.AllowsTransparency = True\n        if hasattr(window, \"Background\"):\n            brush = window.Background.Clone()\n            brush.Opacity = 0\n            window.Background = brush\n        else:\n            color = window.BackgroundColor\n            window.BackgroundColor = color.FromRgba(0,0,0,0)\n\n    def DrawImage(self):\n        my_image = forms.ImageView()\n        my_image.Size = drawing.Size(10, 10)\n        # Use a raw string for the file path or replace \\ with \\\\\n        my_image.Image = drawing.Bitmap(r\"user set image path\")\n        return my_image\n\n    def OnTextChanged(self, sender, e):\n        # Update button text with the new value from the text box\n        self.updated_angle = self.TextBox.Text\n        self.Button.Text = self.TextBox.Text\n        # Optionally, perform other actions based on the new text value\n        print(\"Text changed:\", self.TextBox.Text)\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == forms.Keys.Enter:\n            # Update angle and hide text box when Enter key is pressed\n            self.updated_angle = self.TextBox.Text\n            self.TextBox.Visible = False\n            self.Button.Text = self.TextBox.Text\n            print(\"Angle updated:\", self.updated_angle)\n\n    def OnButtonClick(self, sender, e):\n        # Show the text box when the button is clicked\n        self.TextBox.Visible = True\n\ndef DoSomething():\n    global form_instance\n    \n    # Check if form instance exists and clean it up\n    if form_instance:\n        form_instance.Cleanup()\n\n    # Create new instance of the form\n    form_instance = SampleTransparentEtoForm()\n    form_instance.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n    form_instance.Show()\n\nif __name__==\"__main__\":\n    DoSomething()\n\nsc.doc = ghdoc",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "grasshopper",
    "python",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 3,
  "views": 466
}