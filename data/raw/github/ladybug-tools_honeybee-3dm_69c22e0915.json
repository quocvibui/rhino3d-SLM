{
  "source_url": "https://github.com/ladybug-tools/honeybee-3dm/blob/256976aa1b173591f00699addf73f4377bcba142/honeybee_3dm/model.py",
  "repo": "ladybug-tools/honeybee-3dm",
  "repo_stars": 2,
  "repo_description": "üêù ü¶è3DM - Honeybee extension for creating HBJSON model from Rhino 3dm",
  "license": "AGPL-3.0",
  "filepath": "honeybee_3dm/model.py",
  "instruction": "Creating Honeybee model objects from rhino3dm surfaces and closed volumes",
  "code": "\"\"\"Creating Honeybee model objects from rhino3dm surfaces and closed volumes\"\"\"\nimport os\nimport rhino3dm\n\nfrom honeybee.model import Model\n\nfrom .face import import_objects, import_objects_with_config\nfrom .helper import get_unit_system, check_parent_in_config\nfrom .layer import child_parent_dict, visible_layers\nfrom .config import check_config\n\n\ndef import_3dm(path, name=None, *, config_path=None):\n    \"\"\"Import a rhino3dm file as a Honeybee model.\n\n    This function outputs a Honeybee model from the faces, shades, apertures, and doors\n    on a rhino3dm file. By default, all the rhino objects will be converted to Honeybee\n    Faces based on the objects normal direction. A config file can be used to assign\n    objects to specific Honeybee face types and Honeybee object types.\n\n    Args:\n        path: A text string for the path to the rhino3dm file.\n        name: A text string that will be used as the name of the Honeybee\n            model. Default will be the same as Rhino file name.\n        config_path: A text string path to the config file on disk.\n            Defaults to not using a config file.\n\n    Returns:\n        A Honeybee model.\n    \"\"\"\n    # RHINO FILE\n    if not os.path.isfile(path):\n        raise FileNotFoundError(\n            'The path to rhino file is not valid.'\n            )\n    rhino3dm_file = rhino3dm.File3dm.Read(path)\n    if not rhino3dm_file:\n        raise ValueError(f'Input Rhino file: {path} returns None object.')\n\n    # CONFIG FILE\n    if config_path:\n        if not os.path.isfile(config_path):\n            raise FileNotFoundError(\n                'The path is not a valid path.'\n                ' If file exists, try using double backslashes in file path'\n                ' and try again.'\n            )\n        # Validate the config file and get it as a directory\n\n        config = check_config(rhino3dm_file, config_path)\n    else:\n        config = None\n\n    # Extracting unit parameters from rhino\n    model_tolerance = rhino3dm_file.Settings.ModelAbsoluteTolerance\n    model_angle_tolerance = rhino3dm_file.Settings.ModelAngleToleranceDegrees\n    model_unit = get_unit_system(rhino3dm_file)\n\n    # Place holders\n    hb_rooms, hb_faces, hb_shades, hb_apertures, hb_doors, hb_grids = tuple(\n            [[] for _ in range(6)])\n\n    # A dictionary with child layer : parent layer structure\n    child_to_parent = child_parent_dict(rhino3dm_file)\n\n    # Get all the visible layers from rhino\n    if visible_layers(rhino3dm_file):\n        rhino_visible_layers = visible_layers(rhino3dm_file)\n        rhino_visible_layer_names = [layer.Name for layer in rhino_visible_layers]\n    else:\n        raise ValueError(\n            'Please turn on the layers in rhino you wish to import objects from.'\n        )\n\n    # If config is provided\n    if config:\n        \n        for layer in rhino3dm_file.Layers:\n\n            # If the layer is not in config and not \"on\" in rhino, ignore\n            if layer.Name not in config['layers'] and \\\n                layer.Name not in rhino_visible_layer_names:\n                continue\n\n            # Import objects from each layer in the config file\n            elif layer.Name in config['layers']:\n                hb_objs = import_objects_with_config(\n                    rhino3dm_file, layer, model_tolerance, config=config)\n                hb_faces.extend(hb_objs[0])\n                hb_shades.extend(hb_objs[1])\n                hb_apertures.extend(hb_objs[2])\n                hb_doors.extend(hb_objs[3])\n                hb_grids.extend(hb_objs[4])\n\n            # skip child layers that might already have been imported\n            elif check_parent_in_config(rhino3dm_file, config,\n                layer.Name, child_to_parent[layer.Name]):\n                continue\n\n            # Import objects from each layer not in the config file\n            elif layer.Name in rhino_visible_layer_names:\n                hb_faces.extend(import_objects(rhino3dm_file, layer,\n                    tolerance=model_tolerance))\n    \n    else:  # If config is not provided\n        # Only use layers that are \"on\" in rhino\n        for layer in rhino_visible_layers:\n            hb_faces.extend(import_objects(rhino3dm_file, layer,\n                tolerance=model_tolerance))\n    \n    # Honeybee model name\n    name = name or '.'.join(os.path.basename(path).split('.')[:-1])\n\n    # Honeybee Model\n    hb_model = Model(\n        identifier=name,\n        rooms=hb_rooms,\n        orphaned_faces=hb_faces,\n        orphaned_shades=hb_shades,\n        orphaned_apertures=hb_apertures,\n        orphaned_doors=hb_doors,\n        units=model_unit,\n        tolerance=model_tolerance,\n        angle_tolerance=model_angle_tolerance\n    )\n    # Assigning grids to Honeybee model\n    hb_model.properties.radiance.sensor_grids = hb_grids\n    # Returning a Honeybee model\n    return hb_model\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": true
}