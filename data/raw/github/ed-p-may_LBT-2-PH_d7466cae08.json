{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/scripts/LBT2PH/xl_connect.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "scripts/LBT2PH/xl_connect.py",
  "instruction": "Xl connect",
  "code": "import os\nfrom shutil import copyfile\nimport Grasshopper.Kernel as ghK\nimport scriptcontext as sc\n\nimport clr\nclr.AddReferenceByName('Microsoft.Office.Interop.Excel')\nfrom System.Runtime.InteropServices import Marshal\nfrom Microsoft.Office.Interop import Excel\n\nclass FileManager:\n    \"\"\"Methods used to create, copy and clean the PHPP files and paths \"\"\"\n    @staticmethod\n    def clean_file_path(_input):\n        \"\"\"Tries to clean user-input strings into valid paths\"\"\"\n        \n        if not _input:\n            return None\n        \n        input = unicode(_input).lstrip().rstrip()\n        input = os.path.splitext(input)[0]\n        if '\\\\' in input:\n            filepath_items = input.split('\\\\')\n            filepath = os.path.sep.join(filepath_items)\n            filepath += '.xlsx'\n            return filepath\n        elif '/' in input:\n            filepath_items = input.split('/')\n            filepath = os.path.sep.join(filepath_items)\n            filepath += '.xlsx'\n            return filepath\n        else:\n            return os.path.abspath(input)\n    \n    @staticmethod\n    def get_path_target_file(_input_path, _ghenv):\n        filepath = FileManager.clean_file_path(_input_path)\n        \n        if not filepath:\n            msg = 'Please supply a valid path to a location for the new PHPP file to be saved to.\\n'\n            _ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Remark, msg )\n            return None\n        \n        return filepath\n    \n    @staticmethod\n    def get_path_source_file(_filepath, _ghenv):\n        filepath = FileManager.clean_file_path(_filepath)\n        \n        if not filepath:\n            msg = 'Please supply a valid path to the source PHPP file to use.\\n'\n            _ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Remark, msg )\n            return None\n        if not os.path.isfile(filepath):\n            msg = 'I cannnot find the source PHPP file at < {} >?\\n'\\\n                  'Please check your path input is correct?' .format( unicode(filepath) )\n            _ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, msg )\n        \n        return filepath   \n\n    @staticmethod\n    def make_target_file(_source_path, _target_path, _ghenv):\n        \"\"\"Copies file from source to target path. Makes a new dir if needed\"\"\"\n        \n        if not _source_path and _target_path:\n            return None\n        \n        target_dir = os.path.split(_target_path)[0]\n\n        if not os.path.isdir(target_dir):\n            os.mkdir( target_dir )\n        \n        if not os.path.isfile( _target_path ):\n            copyfile(_source_path, _target_path)\n\n        if not os.path.isfile( _target_path ):\n            msg = 'Something went wrong copying the source file < {} > into the target\\n'\\\n                'directory < {} >? Check your path inputs and make sure you can write\\n'\\\n                'to the target location?'.format(_source_path, _target_path)\n            _ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, msg )\n\n\nclass ExcelInstance:\n    \"\"\"Wrapper for the Excel Application Instance with some useful methods \"\"\"\n\n    def __init__(self):\n        self.excel_app = None\n        self.active_workbook = None\n        self.active_workbook_name = ''\n        self.sheets_dict = {}\n    \n    def start_new_instance(self, _filename):\n        self.excel_app = Excel.ApplicationClass()\n        self.excel_app.DisplayAlerts = False\n        self.excel_app.EnableEvents = False\n        self.excel_app.Visible = True\n        self.excel_app.ScreenUpdating = True\n        self.filename = _filename\n\n    def open_workbook(self):\n        self.active_workbook_name = self.filename\n        self.active_workbook = self.excel_app.Workbooks.Open(self.filename)\n    \n    def load_sheets(self):\n        self.excel_app.ScreenUpdating = False\n\n        for sheet in self.active_workbook.Worksheets:\n            sheet.Unprotect()\n            self.sheets_dict[sheet.Name] = sheet\n        \n        self.excel_app.ScreenUpdating = True\n\n    def save_and_quit(self):\n        self.active_workbook = None\n        self.active_workbook_name = ''\n        \n        if self.excel_app:\n            self.excel_app.activeWorkbook.Save()\n            self.excel_app.activeWorkbook.Close()\n            self.excel_app.Quit()\n            self.excel = None\n    \n    def __unicode__(self):\n        return u\"Excel Instance | Active Worksheet: {}\".format(self.active_workbook_name)\n    def __str__(self):\n        return unicode(self).encode(\"utf-8\")\n    def __repr__(self):\n        return \"{}()\".format(\n               self.__class__.__name__ )\n    def ToString(self):\n        return str(self)\n",
  "language": "python",
  "imports": [
    "scriptcontext"
  ],
  "has_docstring": false
}