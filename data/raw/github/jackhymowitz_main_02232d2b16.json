{
  "source_url": "https://github.com/jackhymowitz/main/blob/7325131db23094f1a28bd184b6a68f864f41a729/01_GH_Components/py/BT_2PDF_VentPlans.py",
  "repo": "jackhymowitz/main",
  "repo_stars": 0,
  "repo_description": "IDF2PH is a free open source toolkit for working with E+ and PHPP Energy Models",
  "license": "GPL-3.0",
  "filepath": "01_GH_Components/py/BT_2PDF_VentPlans.py",
  "instruction": "Takes in a list of Honeybee zones and outputs print-ready (floor plan) objects for the Ventilation areas. Will pull out any 'PHPP Room' information from the zones and create surfaces, color them by...",
  "code": "#\r\r\n# IDF2PHPP: A Plugin for exporting an EnergyPlus IDF file to the Passive House Planning Package (PHPP). Created by blgdtyp, llc\r\r\n# \r\r\n# This component is part of IDF2PHPP.\r\r\n# \r\r\n# Copyright (c) 2020, bldgtyp, llc <info@bldgtyp.com> \r\r\n# IDF2PHPP is free software; you can redistribute it and/or modify \r\r\n# it under the terms of the GNU General Public License as published \r\r\n# by the Free Software Foundation; either version 3 of the License, \r\r\n# or (at your option) any later version. \r\r\n# \r\r\n# IDF2PHPP is distributed in the hope that it will be useful,\r\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\r\n# GNU General Public License for more details.\r\r\n# \r\r\n# For a copy of the GNU General Public License\r\r\n# see <http://www.gnu.org/licenses/>.\r\r\n# \r\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\r\n#\r\r\n\"\"\"\r\r\nTakes in a list of Honeybee zones and outputs print-ready (floor plan) objects for the Ventilation areas. Will pull out any 'PHPP Room' information from the zones and create surfaces, color them by fresh-air ventilation airflow type (supply, extract, transfer), and create room-tags based on the data. Be sure you've used the 'Create PHPP Rooms' to assign parameters to the zones and geometry correctly before trying to use this.\r\r\n-\r\r\nEM June. 22, 2020\r\r\n    Args:\r\r\n        _HBZones: A list of the Honeybee zone objects which are being analyzed in the model.\r\r\n        units_: <Optional> Enter either 'IP' or 'SI'. Default if nothing is input is 'SI'.\r\r\n        colors_: <not used yet>\r\r\n    Returns:\r\r\n        filenames_: A list of autogenerated Filenames for use if you want.\r\r\n        geom_: A Tree of the surfaces as Meshes, colored by Ventilation Type. Each branch of the tree will become a separate page in the final PDF. Connect to the '_geomToBake' input on the '2PDF | Print' component\r\r\n        annotationTxt_: A Tree of Room Data tags for printing. Connect to the '_notesToBake' input on the '2PDF | Print' component\r\r\n        annotationCP_: A Tree of Room center points (X,Y,Z). Useful for locating Room Tag information. Connect to the '_noteLocations' input on the '2PDF | Print' component\r\r\n        tableHeaders_: A list of the Headers for the Data Table\r\r\n        tableData_: A Tree of all the data for the Data Table. Each Branch corresponds to one row in the table (one room)\r\r\n\"\"\"\r\r\nghenv.Component.Name = \"BT_2PDF_VentPlans\"\r\r\nghenv.Component.NickName = \"2PDF | Vent Plans\"\r\r\nghenv.Component.Message = 'JUN_22_2020'\r\r\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\r\r\nghenv.Component.Category = \"BT\"\r\r\nghenv.Component.SubCategory = \"03 | PDF\"\r\r\n\r\r\nimport rhinoscriptsyntax as rs\r\r\nimport scriptcontext as sc\r\r\nimport Grasshopper.Kernel as ghK\r\r\nfrom System import Object\r\r\nfrom Grasshopper import DataTree\r\r\nfrom Grasshopper.Kernel.Data import GH_Path\r\r\nimport ghpythonlib.components as ghc\r\r\n\r\r\ndef roomCenterPt(_srfcs):\r\r\n    srfcCenters = []\r\r\n    for eachSrfc in _srfcs:\r\r\n        srfcCenters.append(ghc.Area(eachSrfc).centroid)\r\r\n    roomCenter = ghc.Average(srfcCenters)\r\r\n    \r\r\n    return roomCenter\r\r\n\r\r\ndef colorMeshFromRoom(_room):\r\r\n    \"\"\"Returns a mesh, colored by some logic\r\r\n    \r\r\n    Takes in a room, converts it to \r\r\n    a mesh and colors it depending on the type of \r\r\n    fresh-air venilation flow (Sup, Ext, Mixed)\r\r\n    \"\"\"\r\r\n    \r\r\n    room_srfcs_colored = []\r\r\n    for srfcCount, srfc in enumerate(_room.TFAsurface):\r\r\n        if _room.V_sup > 0 and _room.V_eta == 0:\r\r\n            color = ghc.ColourRGB(255,183,227,238) # Blueish\r\r\n        elif _room.V_sup == 0 and _room.V_eta > 0:\r\r\n            color = ghc.ColourRGB(255,246,170,154) # Redish\r\r\n        elif _room.V_sup > 0 and _room.V_eta > 0:\r\r\n            color = ghc.ColourRGB(255,234,192,240) # White\r\r\n        else:\r\r\n            color = ghc.ColourRGB(255,235,235,235) # White\r\r\n        \r\r\n        room_srfcs_colored.append( ghc.MeshColours(srfc, color) )\r\r\n    \r\r\n    return room_srfcs_colored\r\r\n\r\r\nhb_hive = sc.sticky[\"honeybee_Hive\"]()\r\r\nHBZoneObjects = hb_hive.callFromHoneybeeHive(_HBZones)\r\r\n\r\r\nfilenames_ = []\r\r\ngeom_ = DataTree[Object]()\r\r\nannotationCP_ = DataTree[Object]()\r\r\nannotationTxt_ = DataTree[Object]()\r\r\ntableHeaders_ = DataTree[Object]()\r\r\ntableData_ = DataTree[Object]()\r\r\n\r\r\ntry:\r\r\n    if units_.upper() == 'IP' or units_.upper() == 'CFM':\r\r\n        unitFactor_flow = 0.588577779 #m3/h ---> cfm\r\r\n        unitFactor_area = 10.76391042 #m2---> ft2\r\r\n        unitFactor_vol = 35.31466672 #m3---> ft3\r\r\n        unit_Flow = 'cfm'\r\r\n        unit_Area = 'ft2'\r\r\n        unit_Vol = 'ft3'\r\r\nexcept:\r\r\n    unitFactor_flow = 1.0\r\r\n    unitFactor_area = 1.0\r\r\n    unitFactor_vol = 1.0\r\r\n    unit_Flow = 'm3/h'\r\r\n    unit_Area = 'm2'\r\r\n    unit_Vol = 'm3'\r\r\n\r\r\nif HBZoneObjects:\r\r\n    # Sort the zones by name. Grr.....\r\r\n    HBZoneObjects_sorted = sorted(HBZoneObjects, key=lambda zone: zone.name)\r\r\n    \r\r\n    for zoneBranchNum, zone in enumerate(HBZoneObjects_sorted):\r\r\n        filenames_.append('VENTILATION PLAN {}'.format(zoneBranchNum+1))\r\r\n        \r\r\n        for roomBranchNum, room in enumerate(zone.PHPProoms):\r\r\n            # For each room, look at each surface in the room, convert it to\r\r\n            # a mesh, and re-color it based on the type of ventilation airflow\r\r\n            # (supply, extract, transfer). When done, add the new mesh to\r\r\n            # and output tree 'geom_' for passing\r\r\n            \r\r\n            geom_.AddRange(colorMeshFromRoom(room), GH_Path(zoneBranchNum))\r\r\n            \r\r\n            \r\r\n            # For each room, pull out the relevant data for a tag that will go\r\r\n            # right ontop of surface in the final PDF. Also get the\r\r\n            # Center Point for each annotation tag\r\r\n            \r\r\n            annotationTxt = \"{}-{}\\nVsup: {:.0f} {}\\nVeta: {:.0f} {}\".format(room.RoomNumber, room.RoomName, room.V_sup*unitFactor_flow, unit_Flow, room.V_eta*unitFactor_flow, unit_Flow)\r\r\n            annotationTxt_.Add(annotationTxt, GH_Path(zoneBranchNum))\r\r\n            annotationCP_.Add(roomCenterPt(room.TFAsurface), GH_Path(zoneBranchNum))\r\r\n            \r\r\n            # Get the Room's parameters and add to the Table\r\r\n            roomData = [[room.HostZoneName, 'Zone'],\r\r\n                        [room.RoomNumber, 'Zone'],\r\r\n                        [room.RoomName, 'NAME'],\r\r\n                        [room.FloorArea_TFA*unitFactor_area,'TFA ({})'.format(unit_Area)],\r\r\n                        [room.RoomVentedVolume*unitFactor_vol,'Vv ({})'.format(unit_Vol)],\r\r\n                        [room.V_sup*unitFactor_flow, 'Sup {}'.format(unit_Flow)],\r\r\n                        [room.V_eta*unitFactor_flow, 'Eta {}'.format(unit_Flow)],\r\r\n                        [room.V_trans*unitFactor_flow, 'Tran {}'.format(unit_Flow)],\r\r\n                        [room.VentSystemName, 'Unit']\r\r\n                        ]\r\r\n            if tableHeaders_.BranchCount == 0:\r\r\n                tableHeaders_.AddRange([v[1] for i, v in enumerate(roomData)], GH_Path(0))\r\r\n            tableData_.AddRange([v[0] for i, v in enumerate(roomData)], GH_Path(tableData_.BranchCount+1))\r\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}