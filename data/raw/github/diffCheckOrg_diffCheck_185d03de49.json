{
  "source_url": "https://github.com/diffCheckOrg/diffCheck/blob/8f668b1f273e8d81a282c6115ba3eae07eef9235/src/gh/components/DF_fast_global_registration/code.py",
  "repo": "diffCheckOrg/diffCheck",
  "repo_stars": 15,
  "repo_description": "diffCheck is a CAD-integrated tool for evaluating digital timber fabrication processes.",
  "license": "GPL-3.0",
  "filepath": "src/gh/components/DF_fast_global_registration/code.py",
  "instruction": null,
  "code": "#! python3\n\n\nimport Rhino\nfrom ghpythonlib.componentbase import executingcomponent as component\n\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\nfrom diffCheck import diffcheck_bindings\nfrom diffCheck import df_cvt_bindings\n\n\nclass DFFastGlobalRegistration(component):\n    def RunScript(self,\n            i_cloud_source: Rhino.Geometry.PointCloud,\n            i_cloud_target: Rhino.Geometry.PointCloud,\n            i_radius_kd_search: float,\n            i_neighbours_kd_search: int,\n            i_max_corrspondence_dist: float,\n            i_iteration_number: int,\n            i_max_tuple_count: int) -> Rhino.Geometry.Transform:\n        if i_cloud_source is None or i_cloud_target is None:\n            ghenv.Component.AddRuntimeMessage(RML.Warning, \"Please provide both objects of type point clouds to align\")  # noqa: F821\n            return None\n        if not i_cloud_source.ContainsNormals or not i_cloud_target.ContainsNormals:\n            ghenv.Component.AddRuntimeMessage(RML.Error, \"Please compute cloud's normals with a component before\")  # noqa: F821\n\n        # set default values\n        if i_radius_kd_search is None:\n            i_radius_kd_search = 0.8\n        if i_neighbours_kd_search is None:\n            i_neighbours_kd_search = 50\n        if i_max_corrspondence_dist is None:\n            i_max_corrspondence_dist = 0.05\n        if i_iteration_number is None:\n            i_iteration_number = 128\n        if i_max_tuple_count is None:\n            i_max_tuple_count = 1000\n\n        df_cloud_source = df_cvt_bindings.cvt_rhcloud_2_dfcloud(i_cloud_source)\n        df_cloud_target = df_cvt_bindings.cvt_rhcloud_2_dfcloud(i_cloud_target)\n\n        df_xform = diffcheck_bindings.dfb_registrations.DFGlobalRegistrations.O3DFastGlobalRegistrationFeatureMatching(\n            source=df_cloud_source,\n            target=df_cloud_target,\n            voxelize=False,  # set as default\n            voxel_size=0.1,  # set as default\n            radius_kd_tree_search=i_radius_kd_search,\n            max_neighbor_kd_tree_search=i_neighbours_kd_search,\n            max_correspondence_distance=i_max_corrspondence_dist,\n            iteration_number=i_iteration_number,\n            max_tuple_count=i_max_tuple_count\n        )\n        print(\"-------------------\")\n        print(\"Estimated transformation matrix:\")\n        print(df_xform.transformation_matrix)\n        print(\"-------------------\")\n\n        # cvt df xform to rhino xform\n        df_xform_matrix = df_xform.transformation_matrix\n        rh_form = Rhino.Geometry.Transform()\n        for i in range(4):\n            for j in range(4):\n                rh_form[i, j] = df_xform_matrix[i, j]\n        if rh_form == Rhino.Geometry.Transform.Identity:\n            ghenv.Component.AddRuntimeMessage(RML.Warning, \"The transformation matrix is identity, no transformation is applied\")  # noqa: F821\n            return None\n\n        o_x_form = rh_form\n\n        return o_x_form\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib"
  ],
  "has_docstring": false
}