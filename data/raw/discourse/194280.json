{
  "source_url": "https://discourse.mcneel.com/t/unique-data-for-polycurve-polyline-segment-where-to-store/194280",
  "topic_id": 194280,
  "title": "ü§î Unique Data For PolyCurve/PolyLine Segment - Where To Store?",
  "question": "Hello everyone,\n\n\nI‚Äôm returning to something that has been plaguing me for over a year.\n\n\nHow can I use an existing Rhino.Geometry class or create a new class that acts like a polyline, edits(vertices/segments), adds/deletes like a polyline, and looks like a polyline but retains metadata/user text attributes \nper segment\n.\n\n\nThe reason this is important (from our perspective) is that having the ability to ‚Äúdrive‚Äù advanced workflows (such as Grasshopper scripts or scripting functions with the polyline as an input) often requires a more nuanced understanding and retention of the overall data at the ‚Äúsegment‚Äù level.\n\n\nOf course there is \nExplode\n and \nShatter\n or only ever utilizing single line segments with user data attached and then post rationalizing ‚Äúwhich are connected in a continuous chain‚Äù but this makes editing of said polyline/chain a bit of a UX and dictionary keeping nightmare.\n\n\nThe code below, when ran, will allow you to pick points and create a pseudo \nPolyCurve\n object that prints out the following:\n\n-uuid for each curve segment\n\n-polycurve_id for the overall polycurve that the segment belongs to\n\n-the user text attributes assigned on  per segment instance\n\n\nHere is a visual example of the desired behavior, where a single polyline controls the overall ‚Äúform‚Äù but each segment has unique metadata driving it‚Äôs behavior (in this case a very basic extrusion in Z direction of metadata key=height, value=‚Äúunique value per segment here‚Äù scenario)\n\n\nimage\n577√ó704 70 KB\n\n\nSo it may seem pretty obvious that this is ‚Äúalready acheivable‚Äù but the issue is that the exploding works on an index system meaning, if a segment is added or deleted, it ‚Äúshifts‚Äù the data and you may now end up with one segment inheriting incorrect data from the segment that was added/removed because it now has a different index value.\n\n\nMaintaining a UUID for each segment would prevent this (I believe?) but my issue is that there is no where I can find to actually store this information within ...",
  "code_blocks": [
    {
      "code": "mport Rhino\nimport scriptcontext as sc\n\npoint0 = Rhino.Geometry.Point3d(0, 0, 0)\npoint1 = Rhino.Geometry.Point3d(5, 0, 0)\npoint2 = Rhino.Geometry.Point3d(5, 5, 0)\npoint3 = Rhino.Geometry.Point3d(0, 5, 0)\n\nline_curve0 = Rhino.Geometry.LineCurve(point0, point1)\nline_curve1 = Rhino.Geometry.LineCurve(point1, point2)\nline_curve2 = Rhino.Geometry.LineCurve(point2, point3)\n\npolycurve = Rhino.Geometry.PolyCurve()\npolycurve.AppendSegment(line_curve0)\npolycurve.AppendSegment(line_curve1)\npolycurve.AppendSegment(line_curve2)\n\nid = sc.doc.Objects.AddCurve(polycurve)\nsc.doc.Objects.Select(id)\nsc.doc.Views.Redraw()\nRhino.RhinoApp.RunScript(\"_What\", True)",
      "language": "python",
      "author": "dale",
      "post_number": 12,
      "is_solution": false
    },
    {
      "code": "import Rhino\nimport rhinoscriptsyntax as rs\nimport uuid\nimport scriptcontext as sc\n\n\nclass CustomPolyCurve:\n    def __init__(self, points):\n        self.control_points = points\n        self.polycurve_id = str(uuid.uuid4())  # Unique ID for the entire polycurve\n        self.segment_metadata = []  # List to store segment data (UUIDs and other info)\n        self.polycurve = Rhino.Geometry.PolyCurve()  # Rhino PolyCurve to hold segments\n        self._initialize_segments()\n\n    def _initialize_segments(self):\n        \"\"\"Initialize segments within the PolyCurve and assign UUIDs and metadata to each.\"\"\"\n        for i in range(len(self.control_points) - 1):\n            segment_uuid = str(uuid.uuid4())\n            start_point = self.control_points[i]\n            end_point = self.control_points[i + 1]\n            # Create a line segment between points and add to the PolyCurve\n            line = Rhino.Geometry.LineCurve(start_point, end_point)\n            self.polycurve.Append(line)  # Add the line to the PolyCurve\n\n            # Store metadata for each segment\n            self.segment_metadata.append({\n                \"uuid\": segment_uuid,\n                \"polycurve_id\": self.polycurve_id,\n                \"user_text\": {}\n            })\n\n        # Add the PolyCurve to the document as a single entity\n        self.polycurve_id = sc.doc.Objects.AddCurve(self.polycurve)\n        sc.doc.Views.Redraw()\n\n    def add_point(self, point):\n        \"\"\"Add a point to extend the polycurve with a new segment and UUID.\"\"\"\n        if self.control_points:\n            last_point = self.control_points[-1]\n            line = Rhino.Geometry.LineCurve(last_point, point)\n            self.polycurve.Append(line)\n\n            # Update control points and metadata\n            segment_uuid = str(uuid.uuid4())\n            self.segment_metadata.append({\n                \"uuid\": segment_uuid,\n                \"polycurve_id\": self.polycurve_id,\n                \"user_text\": {}\n            })\n\n        self.control_points.append(point)\n        # Update the PolyCurve in the document to reflect changes\n        sc.doc.Objects.Replace(self.polycurve_id, self.polycurve)\n        sc.doc.Views.Redraw()\n\n    def get_segment_metadata(self, index):\n        \"\"\"Retrieve metadata for a specific segment.\"\"\"\n        if 0 <= index < len(self.segment_metadata):\n            return self.segment_metadata[index]\n        return None\n\n    def set_segment_metadata(self, index, key, value):\n        \"\"\"Set custom metadata for a specific segment.\"\"\"\n        if 0 <= index < len(self.segment_metadata):\n            self.segment_metadata[index][\"user_text\"][key] = value\n\n    def redraw(self):\n        \"\"\"Redraw the PolyCurve in the document if control points or segments change.\"\"\"\n        sc.doc.Objects.Replace(self.polycurve_id, self.polycurve)\n        sc.doc.Views.Redraw()\n\n\n# Example usage\npoints = rs.GetPoints(True)  # Prompt user to draw polycurve in Rhino viewport\n\nif points:\n    polycurve = CustomPolyCurve(points)\n    polycurve.set_segment_metadata(0, \"developer status\", \"seeking help\")\n    polycurve.set_segment_metadata(3, \"animal\", \"unicorn\")\n    polycurve.set_segment_metadata(1, \"best software company\", \"McNeel\")\n    polycurve.redraw()  # Redraw the polycurve if control points were modified\n\n    # Print segment metadata for verification\n    print(f\">PolyCurve Metadata:\\n>>>{polycurve.get_segment_metadata(0)}\\n>>>{polycurve.get_segment_metadata(1)}\\n>>>{polycurve.get_segment_metadata(3)}\\n<End PolyCurve Metadata\")",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "grasshopper",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 24,
  "views": 339
}