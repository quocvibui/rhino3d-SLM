{
  "source_url": "https://discourse.mcneel.com/t/eto-form-flow-layout/175979",
  "topic_id": 175979,
  "title": "ETO Form Flow Layout",
  "question": "Hello,\n\n\nI’m working on a user tagging capability that has an Eto Forms Dialog where the user can add additional “tags” to a Rhino object.\n\n\nCurrently I can only get this working in a StackLayout configuration but I’m trying to get it to first fill up with rows and when the tags exceed or get close to exceeding the width of the dialogue window, a new row should be created for the additional tags, for as many times as this step is necessary.\n\n\nHere’s my dialog currently:\n\n\nimage\n1920×1188 126 KB\n\n\nAnd I’m trying to get it to layout like this:\n\n\neto_intent_for_panel_layout\n2020×1250 459 KB\n\n\nI believe I need to use DynamicLayout for this but I can’t seem to get it working regardless of the methods I use. I think I’m fundamentally not understanding how to “nest” multiple items per row or something along those lines.\n\n\nAny help is greatly appreciated!\n\n\nHere is my full working Python code thus far:\n\n\nimport Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport rhinoscriptsyntax as rs\n\nclass RoundedPanel(forms.Panel):\n    def __init__(self):\n        super(RoundedPanel, self).__init__()\n        self.radius = 5\n\n    def OnPaint(self, e):\n        rect = drawing.RectangleF(0, 0, self.Width, self.Height)\n        brush = drawing.SolidBrush(self.BackgroundColor)\n        e.Graphics.FillRoundedRectangle(brush, rect, self.radius)\n        brush.Dispose()\n\nclass SimpleEtoDialog(forms.Dialog):\n\n    def __init__(self):\n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.ClientSize = drawing.Size(300, 200)\n        self.Padding = drawing.Padding(5)\n        self.Resizable = False\n\n        # Initialize tag_text as an empty string\n        self.tag_text = \"\"\n\n        # Label\n        self.label = forms.Label()\n        self.labelBox = forms.TextBox(PlaceholderText=\"Enter tag here\")  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBox...",
  "code_blocks": [
    {
      "code": "import Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport rhinoscriptsyntax as rs\n\nclass RoundedPanel(forms.Panel):\n    def __init__(self):\n        super(RoundedPanel, self).__init__()\n        self.radius = 5\n\n    def OnPaint(self, e):\n        rect = drawing.RectangleF(0, 0, self.Width, self.Height)\n        brush = drawing.SolidBrush(self.BackgroundColor)\n        e.Graphics.FillRoundedRectangle(brush, rect, self.radius)\n        brush.Dispose()\n\nclass SimpleEtoDialog(forms.Dialog):\n\n    def __init__(self):\n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.ClientSize = drawing.Size(300, 200) #Fixed Sizing, Comment Out For Automatic Sizing\n        self.Padding = drawing.Padding(5)\n        self.Resizable = False\n\n        # Initialize tag_text as an empty string\n        self.tag_text = \"\"\n\n        # TextBox\n        self.labelBox = forms.TextBox(PlaceholderText=\"Enter tag here\")  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n\n        # Content panel for buttons\n        self.content_panel = forms.StackLayout()  # Use StackLayout instead of FlowLayout\n        self.content_panel.Spacing = 5  # Set spacing between controls\n\n        # Layout\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.labelBox)\n        scrollable_content_panel = forms.Scrollable()\n        scrollable_content_panel.Content = self.content_panel\n        layout.AddRow(scrollable_content_panel)  # Wrap content_panel in a Scrollable control\n\n        self.Content = layout\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n\n        # Populate existing tags\n        self.populate_existing_tags()\n\n    def populate_existing_tags(self):\n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            # Iterate over selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the dialog\n                    tags_list = existing_tags.split(\",\")\n                    for tag in tags_list:\n                        self.add_tag_label(tag.strip())\n\n    def add_tag_label(self, tag_text):\n\n        button_color = drawing.Color(220,220,220)\n        # Create a panel to contain the label and delete button with padding\n        panel = forms.Panel(BackgroundColor=button_color, Padding=drawing.Padding(5))\n\n        # Create a new label with rounded corners\n        label = forms.Label(Text=tag_text, BackgroundColor=button_color)\n        \n        # Create a label with \"X\" text\n        delete_label = forms.Button(Text=\"X\", BackgroundColor=button_color, Width=25)\n        delete_label.Click += lambda s, e: self.remove_tags(tag_text, panel)\n\n        # Create a horizontal stack layout to contain the label and delete button\n        horizontal_layout = forms.StackLayout()\n        horizontal_layout.Orientation = forms.Orientation.Horizontal\n        horizontal_layout.Spacing = 5\n        horizontal_layout.Items.Add(label)\n        horizontal_layout.Items.Add(delete_label)\n\n        # Add the horizontal layout to the panel\n        panel.Content = horizontal_layout\n\n        # Add the panel to the content panel\n        self.content_panel.Items.Add(panel)\n\n    def remove_tags(self, tag_text, panel):\n        print(\"Removing tag:\", tag_text)\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n\n        # Remove the controls from the panel and update the UI\n        panel.Content.RemoveAll()\n        self.content_panel.Items.Remove(panel)\n\n        # Update the layout to fill the space and adjust positions\n        self.update_layout()\n\n    def update_layout(self):\n        # Clear the current layout\n        self.content_panel.Items.Clear()\n\n        # Populate existing tags again to re-add them to the layout\n        self.populate_existing_tags()\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == forms.Keys.Enter:\n            # Get the text entered into the text box\n            new_tag_text = self.labelBox.Text.strip()\n            if new_tag_text:\n                # Add the new tag to the dialog\n                self.add_tag_label(new_tag_text)\n\n                # Clear the text box\n                self.labelBox.Text = \"\"\n\n                # Append tags to selected objects\n                selected_objs = rs.SelectedObjects()\n                if selected_objs:\n                    tags = [new_tag_text]\n                    for obj in selected_objs:\n                        append_tags(obj, tags)\n                else:\n                    print(\"No objects selected.\")\n\ndef append_tags(obj, additional_values):\n    existing_value = rs.GetUserText(obj, \"Tags\")\n    if existing_value:\n        existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n        new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n        if new_values:\n            new_value = \",\".join(existing_values + new_values)\n            rs.SetUserText(obj, \"Tags\", new_value)\n            print(\"Tags appended successfully.\")\n        else:\n            print(\"No new tags added. Tags already exist.\")\n    else:\n        lowercased_values = [val.lower() for val in additional_values]\n        rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n        print(\"Tags set successfully.\")\n\n################################################################################\n# Creating a dialog instance and displaying the dialog.\n################################################################################\ndef TestSampleEtoDialog():\n    dialog = SimpleEtoDialog()\n    dialog.Icon = drawing.Icon(r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\")\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\n################################################################################\n# Check to see if this file is being executed as the \"main\" python\n# script instead of being used as a module by some other python script\n# This allows us to use the module which ever way we want.\n################################################################################\nif __name__ == \"__main__\":\n    TestSampleEtoDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 2,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Eto\nimport Eto.Drawing as drawing\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self):\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 200)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.Location = Eto.Drawing.Point(220,220)\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        \n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates !\n\n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(PlaceholderText=\"Add tag here\")  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        \n        self.UpdateDynamicLayout()\n        \n        self.Content = self.layout\n        \n        \n        self.SizeChanged += self.MyOnSizeChangedEvent\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n        \n        # Populate existing tags\n        self.UpdateDynamicLayout()\n    \n    \n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            # Clear the layout\n            self.layout.Clear()\n\n            controls = List[Eto.Forms.Control]()\n            row_width = 0\n            \n            # Create a new row for the text box\n            self.layout.BeginHorizontal()\n            self.layout.Add(self.labelBox)\n            self.layout.EndHorizontal()\n            \n            # Initialize tags_list\n            tags_list = []\n            \n            # Iterate over selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the tags_list variable\n                    tags_list.extend(existing_tags.split(\",\"))\n        \n            # Iterate over existing tags\n            for tag in tags_list: \n                delete_button_text = (tag +  str(\"   X\"))\n                delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n                delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n                delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n                delete_button.Tag = tag  # Set the tag text as Tag for the button\n                delete_button.Click += self.OnDeleteButtonClick\n                \n                if row_width < self.layout.Width:\n                    controls.Add(delete_button)\n                    row_width += delete_button_width\n                else:\n                    controls.Add(None)\n                    self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n                    controls.Clear()\n                    controls.Add(delete_button)\n                    row_width = delete_button_width\n            \n            if controls.Count != 0:\n                controls.Add(None)\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n            \n            self.layout.AddSpace()\n            \n            self.layout.Create()\n\n    def append_tags(self, obj, additional_values):\n        existing_value = rs.GetUserText(obj, \"Tags\")\n        if existing_value:\n            existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n            new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n            if new_values:\n                new_value = \",\".join(existing_values + new_values)\n                rs.SetUserText(obj, \"Tags\", new_value)\n                print(\"Tags appended successfully.\")\n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n\n    def remove_tags(self, tag_text):\n        print(\"Removing tag:\", tag_text)\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n        \n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n            \n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box\n            new_tag_text = self.labelBox.Text.strip()\n            if new_tag_text:\n                # Append tags to selected objects\n                selected_objs = rs.SelectedObjects()\n                if selected_objs:\n                    tags = [new_tag_text]\n                    for obj in selected_objs:\n                        self.append_tags(obj, tags)  # Corrected here\n                else:\n                    print(\"No objects selected.\")\n                \n                # Add the new tag to the dialog\n                self.UpdateDynamicLayout()\n\n                # Clear the text box\n                self.labelBox.Text = \"\"\n\n\n            \n\ndef EstablishDialog():\n        \n    dialog = MyDialog()\n    icon_path = r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\"\n    dialog.Icon = drawing.Icon(icon_path)\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 9,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Eto\nimport Eto.Drawing as drawing\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self):\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 200)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.Location = Eto.Drawing.Point(220,220)\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        \n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates !\n\n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(PlaceholderText=\"Add tag here\")  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        \n        self.UpdateDynamicLayout()\n        \n        self.Content = self.layout\n        \n        \n        self.SizeChanged += self.MyOnSizeChangedEvent\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n        \n        # Populate existing tags\n        self.UpdateDynamicLayout()\n    \n    \n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            # Clear the layout\n            self.layout.Clear()\n\n            controls = List[Eto.Forms.Control]()\n            row_controls = []\n            row_width = 0\n            # button_width = 120  # Fixed button width\n            max_row_width = self.layout.Width  # Maximum row width based on layout width\n            \n            # Create a new row for the text box\n            self.layout.BeginHorizontal()\n            self.layout.Add(self.labelBox)\n            self.layout.EndHorizontal()\n            \n            # Initialize tags_list\n            tags_list = []\n            \n            # Iterate over selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the tags_list variable\n                    tags_list.extend(existing_tags.split(\",\"))\n        \n            # Iterate over existing tags\n            for tag in tags_list: \n                delete_button_text = (tag +  str(\"   X\"))\n                delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n                delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n                delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n                delete_button.Tag = tag  # Set the tag text as Tag for the button\n                delete_button.Click += self.OnDeleteButtonClick\n                \n                if row_width + delete_button_width > max_row_width:  # Check if adding the next control exceeds the width\n                    row_controls.append(None)  # Add a placeholder control for spacing\n                    controls.AddRange(row_controls)  # Add row controls to the main controls list\n                    self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                    controls.Clear()  # Clear the controls list for the next row\n                    # Clear the row controls list for the next row\n                    row_controls = []\n                    row_width = 0  # Reset row width\n                \n                row_controls.append(delete_button)  # Add the button to the row controls\n                row_width += delete_button_width  # Update the row width\n            \n            if row_controls:  # Add the remaining row controls if any\n                controls.AddRange(row_controls)\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n            \n            self.layout.AddSpace()\n            \n            self.layout.Create()\n\n\n    def append_tags(self, obj, additional_values):\n        existing_value = rs.GetUserText(obj, \"Tags\")\n        if existing_value:\n            existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n            new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n            if new_values:\n                new_value = \",\".join(existing_values + new_values)\n                rs.SetUserText(obj, \"Tags\", new_value)\n                print(\"Tags appended successfully.\")\n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n\n    def remove_tags(self, tag_text):\n        print(\"Removing tag:\", tag_text)\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n        \n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n            \n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box\n            new_tag_text = self.labelBox.Text.strip()\n            if new_tag_text:\n                # Append tags to selected objects\n                selected_objs = rs.SelectedObjects()\n                if selected_objs:\n                    tags = [new_tag_text]\n                    for obj in selected_objs:\n                        self.append_tags(obj, tags)  # Corrected here\n                else:\n                    print(\"No objects selected.\")\n                \n                # Add the new tag to the dialog\n                self.UpdateDynamicLayout()\n\n                # Clear the text box\n                self.labelBox.Text = \"\"\n\n\n            \n\ndef EstablishDialog():\n        \n    dialog = MyDialog()\n    icon_path = r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\"\n    dialog.Icon = drawing.Icon(icon_path)\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 11,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\nimport Eto\nimport Eto.Drawing as drawing\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self):\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 200)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n\n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n\n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates !\n\n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(PlaceholderText=\"Add tag here...\",ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # Timer for delayed UI update\n        self.update_timer = None\n        self.update_delay = 0.5  # Adjust the delay time as needed\n        \n        self.Content = self.layout\n        \n        self.SizeChanged += self.MyOnSizeChangedEvent\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n        \n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # print(\"Updating dynamic layout...\")\n\n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n\n        # Clear the layout\n        self.layout.Clear()\n\n        # print(\"Layout cleared.\")\n\n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n        # button_width = 120  # Fixed button width\n        max_row_width = self.layout.Width  # Maximum row width based on layout width\n        \n        # Create a new row for the search box\n        self.layout.BeginHorizontal()\n        self.searchBox.PlaceholderText = \"Search tags...\"\n        self.layout.Add(self.searchBox, True)  # Add search box with horizontal expansion\n        self.layout.EndHorizontal()\n\n        # Create a new row for the text box\n        self.layout.BeginHorizontal()\n        self.labelBox.PlaceholderText = \"Add tag here...\"\n        self.labelBox.ShowBorder = False\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.layout.Add(self.labelBox, True)  # Add text box with horizontal expansion\n        self.layout.EndHorizontal()\n        \n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        # print(\"Selected objects:\", selected_objs)\n        \n        if selected_objs:\n            # Initialize unique tags set\n            unique_tags = set()\n            \n            # Collect all tags from all selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the unique_tags set\n                    unique_tags.update(existing_tags.split(\",\"))\n        \n           # Add newly added or appended tags from the text box if they are not already in unique_tags\n            new_tag_text = self.labelBox.Text.strip()\n            # Check if the new tag contains commas\n            if new_tag_text and ',' not in new_tag_text:\n                # Only add the new tag if it's not already in unique_tags\n                if new_tag_text not in unique_tags:\n                    unique_tags.add(new_tag_text)\n            # print(\"Unique tags:\", unique_tags)\n            \n            # Filter tags based on the search text if it's not empty\n            search_text = self.search_text\n            # print(\"Search text:\", search_text)\n            if search_text:\n                filtered_tags = [tag for tag in unique_tags if search_text in tag.lower()]\n                # print(\"Filtered tags:\", filtered_tags)\n            else:\n                filtered_tags = list(unique_tags)\n                # print(\"No search text. Showing all tags.\")\n            \n            # Iterate over filtered tags and populate the UI\n            for tag in filtered_tags: \n                delete_button_text = (tag +  str(\"   X\"))\n                delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n                delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n                delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n                delete_button.Tag = tag  # Set the tag text as Tag for the button\n                delete_button.Click += self.OnDeleteButtonClick\n                \n                if row_width + delete_button_width > max_row_width:  # Check if adding the next control exceeds the width\n                    row_controls.append(None)  # Add a placeholder control for spacing\n                    controls.AddRange(row_controls)  # Add row controls to the main controls list\n                    self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                    controls.Clear()  # Clear the controls list for the next row\n                    # Clear the row controls list for the next row\n                    row_controls = []\n                    row_width = 0  # Reset row width\n                \n                row_controls.append(delete_button)  # Add the button to the row controls\n                row_width += delete_button_width  # Update the row width\n            \n            if row_controls:  # Add the remaining row controls if any\n                controls.AddRange(row_controls)\n                controls.Add(None) # Add an empty item which gets scaled\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n        \n        self.layout.AddSpace()\n        \n        self.layout.Create()\n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Check if the search box text is empty and it's not already in the process of updating\n        if not sender.Text.strip() and not self.is_updating_layout:\n            # Set the flag to indicate that the layout is being updated\n            self.is_updating_layout = True\n            # If the search box is empty, update the layout to show all tags\n            self.UpdateDynamicLayout()\n            # Reset the flag after the layout update is complete\n            self.is_updating_layout = False\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n\n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n\n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n\n\n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n        \n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n            \n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box and split it by commas\n            tag_texts = self.labelBox.Text.strip().split(\",\")\n            for tag_text in tag_texts:\n                tag_text = tag_text.strip()  # Remove leading and trailing spaces\n                if tag_text:\n                    # Append tags to selected objects\n                    selected_objs = rs.SelectedObjects()\n                    if selected_objs:\n                        tags = [tag_text]\n                        self.append_tags(selected_objs, tags)  # Pass selected_objs as a list\n                        # Update the UI tag list\n                        self.UpdateDynamicLayout()\n                    else:\n                        print(\"No objects selected.\")\n            # Clear the text box\n            self.labelBox.Text = \"\"\n\n\ndef EstablishDialog():\n        \n    dialog = MyDialog()\n    icon_path = r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\"\n    dialog.Icon = drawing.Icon(icon_path)\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 18,
      "is_solution": false
    },
    {
      "code": "#! python 2\n\nimport math\nimport System.Collections.Generic\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Eto\nimport Eto.Drawing as drawing\n\nimport base64\nimport tempfile\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self):\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 200)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n\n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n\n        self.layout = Eto.Forms.DynamicLayout()\n        self.scrollcontent = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates !\n\n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(PlaceholderText=\"Add tag here...\",ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # Timer for delayed UI update\n        self.update_timer = None\n        self.update_delay = 0.5  # Adjust the delay time as needed\n        \n        # Scrollable Content Area\n        scrollable_content_panel = Eto.Forms.Scrollable()\n        scrollable_content_panel.ExpandContentHeight = True\n        scrollable_content_panel.ExpandContentWidth = True       \n        scrollable_content_panel.Border = Eto.Forms.BorderType.None\n        scrollable_content_panel.Content = self.layout\n\n        self.Content = scrollable_content_panel\n        \n        self.SizeChanged += self.MyOnSizeChangedEvent\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n        \n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # print(\"Updating dynamic layout...\")\n\n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n\n        # Clear the layout\n        self.layout.Clear()\n        #print(\"Layout cleared.\")\n\n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n        max_row_width = (self.Content.VisibleRect.Width - 4) # Maximum row width based on Visible Scrollable Width - Fudge Factor (4px)\n        \n        # Create a new row for the search box\n        self.layout.BeginHorizontal()\n        self.searchBox.PlaceholderText = \"Search tags...\"\n        self.layout.Add(self.searchBox, True)  # Add search box with horizontal expansion\n        self.layout.EndHorizontal()\n\n        # Create a new row for the text box\n        self.layout.BeginHorizontal()\n        self.labelBox.PlaceholderText = \"Add tag here...\"\n        self.labelBox.ShowBorder = False\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.layout.Add(self.labelBox, True)  # Add text box with horizontal expansion\n        self.layout.EndHorizontal()\n        \n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        # print(\"Selected objects:\", selected_objs)\n        \n        if selected_objs:\n            # Initialize unique tags set\n            unique_tags = set()\n            \n            # Collect all tags from all selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the unique_tags set\n                    unique_tags.update(existing_tags.split(\",\"))\n        \n           # Add newly added or appended tags from the text box if they are not already in unique_tags\n            new_tag_text = self.labelBox.Text.strip()\n            # Check if the new tag contains commas\n            if new_tag_text and ',' not in new_tag_text:\n                # Only add the new tag if it's not already in unique_tags\n                if new_tag_text not in unique_tags:\n                    unique_tags.add(new_tag_text)\n            # print(\"Unique tags:\", unique_tags)\n            \n            # Filter tags based on the search text if it's not empty\n            search_text = self.search_text\n            # print(\"Search text:\", search_text)\n            if search_text:\n                filtered_tags = [tag for tag in unique_tags if search_text in tag.lower()]\n                # print(\"Filtered tags:\", filtered_tags)\n            else:\n                filtered_tags = list(unique_tags)\n                # print(\"No search text. Showing all tags.\")\n            \n            # Iterate over filtered tags and populate the UI\n            for tag in filtered_tags: \n                delete_button_text = (tag +  str(\"   X\"))\n                delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 15\n                delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n                delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n                delete_button.Tag = tag  # Set the tag text as Tag for the button\n                delete_button.Click += self.OnDeleteButtonClick\n                \n                if row_width + delete_button_width >= max_row_width:  # Check if adding the next control exceeds the width\n                    row_controls.append(None)  # Add a placeholder control for spacing\n                    controls.AddRange(row_controls)  # Add row controls to the main controls list\n                    self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                    controls.Clear()  # Clear the controls list for the next row\n                    # Clear the row controls list for the next row\n                    row_controls = []\n                    row_width = 0  # Reset row width\n                \n                row_controls.append(delete_button)  # Add the button to the row controls\n                row_width += delete_button_width  # Update the row width\n            \n            if row_controls:  # Add the remaining row controls if any\n                controls.AddRange(row_controls)\n                controls.Add(None) # Add an empty item which gets scaled\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n\n        self.layout.AddSpace()\n        self.layout.Create()        \n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Check if the search box text is empty and it's not already in the process of updating\n        if not sender.Text.strip() and not self.is_updating_layout:\n            # Set the flag to indicate that the layout is being updated\n            self.is_updating_layout = True\n            # If the search box is empty, update the layout to show all tags\n            self.UpdateDynamicLayout()\n            # Reset the flag after the layout update is complete\n            self.is_updating_layout = False\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n\n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n\n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n\n\n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n        \n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n            \n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box and split it by commas\n            tag_texts = self.labelBox.Text.strip().split(\",\")\n            for tag_text in tag_texts:\n                tag_text = tag_text.strip()  # Remove leading and trailing spaces\n                if tag_text:\n                    # Append tags to selected objects\n                    selected_objs = rs.SelectedObjects()\n                    if selected_objs:\n                        tags = [tag_text]\n                        self.append_tags(selected_objs, tags)  # Pass selected_objs as a list\n                        # Update the UI tag list\n                        self.UpdateDynamicLayout()\n                    else:\n                        print(\"No objects selected.\")\n            # Clear the text box\n            self.labelBox.Text = \"\"\n\ndef EstablishDialog():       \n    dialog = MyDialog()\n    #icon_path = r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\"\n    dialog.Icon = drawing.Icon(GetIconImagePath())\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\ndef GetIconImagePath():\n\n    # Decode Image from Base64 String\n    imageAsBase64String = r'iVBORw0KGgoAAAANSUhEUgAAAUIAAADiCAIAAAC0pFmRAAAAAXNSR0IArs4c6QAAAARnQU1uCX/FnkI4NCByIzgnqds1...'\n    image_64_decode = base64.b64decode(imageAsBase64String)\n\n     # Create temporary file for Image\n    with tempfile.NamedTemporaryFile(delete=False) as f:\n        image_result = open(f.name, 'wb')\n        image_result.write(image_64_decode)\n        image_result.close()\n        return f.name;\n\nEstablishDialog()",
      "language": "python",
      "author": "jstevenson",
      "post_number": 19,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\nimport Eto\nimport Eto.Drawing as drawing\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self, selected_objs):\n        \n        # the selected objects as class wide variable\n        self.selected_objs = selected_objs\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        # self.Size = Eto.Drawing.Size(300, 200) # do not define a fixed size\n        self.MinimumSize = Eto.Drawing.Size(300, 200)\n        self.MaximumSize = Eto.Drawing.Size(300, -1)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.AutoSize = True\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        # searchBox\n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n        \n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.PlaceholderText = \"Search tags...\"\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n        \n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.PlaceholderText = \"Add tag here...\"\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # the layout for tags\n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates\n        \n        # create a stack layout which has 2 sections, top section holds the searchbox\n        # and text box, bottom section holds a scrollable which contains dynamic layout\n        self.stack_layout = Eto.Forms.StackLayout()\n        self.stack_layout.Orientation = Eto.Forms.Orientation.Vertical\n        self.stack_layout.HorizontalContentAlignment = Eto.Forms.HorizontalAlignment.Stretch\n        self.stack_layout.Padding = Eto.Drawing.Padding(0,0)\n        self.stack_layout.Spacing = 4\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.searchBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.labelBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.layout, True)) # True means it does stretch vertically\n        \n        self.Content = self.stack_layout\n        \n        # add events\n        self.SizeChanged += self.MyOnSizeChangedEvent\n        self.Load += self.OnDialogLoad\n        self.Closing += self.OnDialogClosing\n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):       \n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n        \n        # Clear the layout\n        self.layout.Clear()\n        \n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n        # button_width = 120  # Fixed button width\n        max_row_width = self.layout.Width  # Maximum row width based on layout width\n        \n        # Initialize unique tags set\n        unique_tags = set()\n        \n        # Collect all tags from all selected objects\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                # Split existing tags and add them to the unique_tags set\n                unique_tags.update(existing_tags.split(\",\"))\n        \n       # Add newly added or appended tags from the text box if they are not already in unique_tags\n        new_tag_text = self.labelBox.Text.strip()\n        # Check if the new tag contains commas\n        if new_tag_text and ',' not in new_tag_text:\n            # Only add the new tag if it's not already in unique_tags\n            if new_tag_text not in unique_tags:\n                unique_tags.add(new_tag_text)\n        \n        # Filter tags based on the search text if it's not empty\n        search_text = self.search_text\n        # print(\"Search text:\", search_text)\n        if search_text:\n            filtered_tags = [tag for tag in unique_tags if search_text in tag.lower()]\n\n        else:\n            filtered_tags = list(unique_tags)\n        \n        # Iterate over filtered tags and populate the UI\n        for tag in filtered_tags: \n            delete_button_text = (tag +  str(\"   X\"))\n            delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n            delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n            delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n            delete_button.Tag = tag  # Set the tag text as Tag for the button\n            delete_button.Click += self.OnDeleteButtonClick\n            \n            if row_width + delete_button_width > max_row_width:  # Check if adding the next control exceeds the width\n                row_controls.append(None)  # Add a placeholder control for spacing\n                controls.AddRange(row_controls)  # Add row controls to the main controls list\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                controls.Clear()  # Clear the controls list for the next row\n                # Clear the row controls list for the next row\n                row_controls = []\n                row_width = 0  # Reset row width\n            \n            row_controls.append(delete_button)  # Add the button to the row controls\n            row_width += delete_button_width  # Update the row width\n        \n        if row_controls:  # Add the remaining row controls if any\n            controls.AddRange(row_controls)\n            controls.Add(None) # Add an empty item which gets scaled\n            self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n        \n        self.layout.AddSpace()\n        \n        self.layout.Create()\n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Update layout UI in real-time when search box  is typed in\n        self.UpdateDynamicLayout()\n\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n        \n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n        \n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n        \n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                if tag_text in existing_tags:\n                    existing_tags.remove(tag_text)\n                    rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box and split it by commas\n            tag_texts = self.labelBox.Text.strip().split(\",\")\n            for tag_text in tag_texts:\n                tag_text = tag_text.strip()  # Remove leading and trailing spaces\n                if tag_text:\n                    # Append tags to selected objects\n                    if self.selected_objs:\n                        tags = [tag_text]\n                        self.append_tags(self.selected_objs, tags)  # Pass selected_objs as a list\n                        # Update the UI tag list\n                        self.UpdateDynamicLayout()\n                    else:\n                        print(\"No objects selected.\")\n            # Clear the text box\n            self.labelBox.Text = \"\"\n\n    def OnDialogLoad(self, sender, e):\n        \n        # restores dialog location from last use\n        key = \"MC_TagObjects_DialogLocation\"\n        if scriptcontext.sticky.has_key(key): self.Location = scriptcontext.sticky[key]\n        \n        # set focus to the tag entering labelBox\n        self.labelBox.Focus()\n\n    def OnDialogClosing(self, sender, e):\n        \n        # save dialog location for next use\n        scriptcontext.sticky[\"MC_TagObjects_DialogLocation\"] = self.Location\n\ndef GetIcon():\n    \n    # create bitmap from bytestring\n    bytes = System.Convert.FromBase64String(\"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAF9SURBVDhPpdFLSwJRFAfwcy7kpiSwqE3R7JRGgxa9xkqjktpUEqHWOlrVpkXQIoq+QJC76EFgkNrLhJBAP0O10jZBtHfhxkpP9yoTzgOLWvyZ4cL/N3fOASL6V75fpDZIensw45Gr8Tox43Zg2iuDb7YfYKZPGz8/0wAbfqT8BaPCGaOPKKN8hNHrIaOVSXz0yCDN6RADsBPEPKUZ5cKsfLqGn8VzRpTkEAeXJ4yIEQhw4I5RQIFcezPsnqxiSQB0Y44YgG0B3DOKrmNhaRSes/tYpmtGpbg5YgC2FrAoALpi9M5nIJ6irKYW4YOV5gd0gGKHWDaMlf+mS23ZBHkYk2FcA9iawOK2Q1xFzIBSjCMpRslNpF4JEhqgowXA1ggNw3UQSjB646sNKpjydYPLAHTWQSrlI76lIUhNO8G6OKibgQqYIXRb/bIoT/FyiJcD+i3UAioy4oD40x7SywGjkKIt/wiItFrB4uqCYz6wiCiLa6tlA/DXmB7+PgRf7QIEb+tmZQoAAAAASUVORK5CYII=\")\n    bitmap = Eto.Drawing.Bitmap(bytes)\n    \n    # save bitmap in memory stream\n    stream = System.IO.MemoryStream()\n    bitmap.Save(stream, Eto.Drawing.ImageFormat.Png)\n    \n    # create icon from it\n    icon = Eto.Drawing.Icon(stream)\n    \n    return icon\n\ndef EstablishDialog():\n    \n    # get or prompt for objects to tag, do not open dialog if no selection is made\n    selected_objs = rs.GetObjects(\"Select object(s) to tag\", rs.filter.allobjects, preselect=True, select=True)\n    if not selected_objs: return  \n    \n    # open dialog and pass object ids\n    dialog = MyDialog(selected_objs)\n    dialog.Icon = GetIcon()\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 24,
      "is_solution": false
    },
    {
      "code": "import math\nimport System.Collections.Generic\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport Eto\nimport Eto.Drawing as drawing\n\nimport base64\nimport tempfile\n\nfrom System.Collections.Generic import List\n\nclass MyDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self):\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 200)\n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n\n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n\n        self.layout = Eto.Forms.DynamicLayout()\n        self.scrollcontent = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates !\n\n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(PlaceholderText=\"Add tag(s) here...\",ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # Scrollable Content Area\n        scrollable_content_panel = Eto.Forms.Scrollable()\n        scrollable_content_panel.ExpandContentHeight = True\n        scrollable_content_panel.ExpandContentWidth = False\n        scrollable_content_panel.Border = Eto.Forms.BorderType.None\n        scrollable_content_panel.Content = self.layout\n\n        self.Content = scrollable_content_panel\n        \n        self.SizeChanged += self.MyOnSizeChangedEvent\n\n        # Check if any objects are selected, if not, prompt the user to select an object\n        selected_objs = rs.SelectedObjects()\n        if not selected_objs:\n            selected_objs = rs.GetObjects(\"Select object(s) to tag\", preselect=True, select=True)\n            if not selected_objs:\n                return  # Exit if the user cancels object selection\n        \n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n\n        # Clear the layout\n        self.layout.Clear()\n        #print(\"Layout cleared.\")\n\n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n        max_row_width = (self.Content.VisibleRect.Width - 4) # Maximum row width based on Visible Scrollable Width - Fudge Factor (4px)\n        \n        # Create a new row for the search box\n        self.layout.BeginHorizontal()\n        self.searchBox.PlaceholderText = \"Search...\"\n        self.layout.Add(self.searchBox, True)  # Add search box with horizontal expansion\n        self.layout.EndHorizontal()\n\n        # Create a new row for the text box\n        self.layout.BeginHorizontal()\n        self.labelBox.PlaceholderText = \"Add tag(s) here...\"\n        self.labelBox.ShowBorder = False\n        self.layout.Add(self.labelBox, True)  # Add text box with horizontal expansion\n        self.layout.EndHorizontal()\n        \n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        # print(\"Selected objects:\", selected_objs)\n        \n        if selected_objs:\n            # Initialize unique tags set\n            unique_tags = set()\n            \n            # Collect all tags from all selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the unique_tags set\n                    unique_tags.update(existing_tags.split(\",\"))\n        \n           # Add newly added or appended tags from the text box if they are not already in unique_tags\n            new_tag_text = self.labelBox.Text.strip()\n            # Check if the new tag contains commas\n            if new_tag_text and ',' not in new_tag_text:\n                # Only add the new tag if it's not already in unique_tags\n                if new_tag_text not in unique_tags:\n                    unique_tags.add(new_tag_text)\n            # print(\"Unique tags:\", unique_tags)\n            \n            # Filter tags based on the search text if it's not empty\n            search_text = self.search_text\n            # print(\"Search text:\", search_text)\n            if search_text:\n                filtered_tags = [tag for tag in unique_tags if search_text in tag.lower()]\n                # print(\"Filtered tags:\", filtered_tags)\n            else:\n                filtered_tags = list(unique_tags)\n                # print(\"No search text. Showing all tags.\")\n            \n            # Iterate over filtered tags and populate the UI\n            for tag in filtered_tags: \n                delete_button_text = (tag +  str(\"   X\"))\n                delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 15\n                delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n                delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n                delete_button.Tag = tag  # Set the tag text as Tag for the button\n                delete_button.Click += self.OnDeleteButtonClick\n                \n                if row_width + delete_button_width >= max_row_width:  # Check if adding the next control exceeds the width\n                    row_controls.append(None)  # Add a placeholder control for spacing\n                    controls.AddRange(row_controls)  # Add row controls to the main controls list\n                    self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                    controls.Clear()  # Clear the controls list for the next row\n                    # Clear the row controls list for the next row\n                    row_controls = []\n                    row_width = 0  # Reset row width\n                \n                row_controls.append(delete_button)  # Add the button to the row controls\n                row_width += delete_button_width  # Update the row width\n            \n            if row_controls:  # Add the remaining row controls if any\n                controls.AddRange(row_controls)\n                controls.Add(None) # Add an empty item which gets scaled\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n\n        self.layout.AddSpace()\n        self.layout.Create()        \n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Real-Time search feedback\n         self.UpdateDynamicLayout()\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n\n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n\n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n\n\n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                    if tag_text in existing_tags:\n                        existing_tags.remove(tag_text)\n                        rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n        \n        # Update the user text immediately\n        rs.ObjectName(obj, rs.GetUserText(obj, \"Tags\"))\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n\n    def OnTextBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text from the text box\n            text = sender.Text.strip()\n            if text:\n                # Split the text by comma to get individual tags\n                tags = [tag.strip() for tag in text.split(\",\")]\n                # Get selected objects\n                selected_objs = rs.SelectedObjects()\n                if selected_objs:\n                    # Append the tags to the selected objects\n                    self.append_tags(selected_objs, tags)\n                    # Clear the text box after adding tags\n                    sender.Text = \"\"\n                    # Update the layout to reflect the changes\n                    self.UpdateDynamicLayout()\n\n\ndialog = MyDialog()\ndialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 30,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\nimport Eto\n\nfrom System.Collections.Generic import List\n\nclass ObjectTaggingDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self, selected_objs):\n        \n        # the selected objects as class wide variable\n        self.selected_objs = selected_objs\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 220) \n        self.MinimumSize = Eto.Drawing.Size(320, 165)\n        self.MaximumSize = Eto.Drawing.Size(320, -1)\n        \n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.AutoSize = False\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        # searchBox\n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n        \n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.PlaceholderText = \"Search...\"\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n        \n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.PlaceholderText = \"Add tag(s) here...\"\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # the layout for tags\n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates\n        self.layout.Padding = Eto.Drawing.Padding(0, 6, 0, 0) # controls the gap above the tags\n        \n        # scrollable \n        self.scrollable = Eto.Forms.Scrollable()\n        self.scrollable.ExpandContentHeight = True\n        self.scrollable.ExpandContentWidth = True\n        self.scrollable.ScrollSize = Eto.Drawing.Size(260, -1) # 260 or smaller prevents that the horizontal scroll bar comes up\n        self.scrollable.Border = Eto.Forms.BorderType.None\n        self.scrollable.Content = self.layout\n        \n        # create a stack layout which has 2 sections, top section holds the searchbox\n        # and text box, bottom section holds a scrollable which contains dynamic layout\n        self.stack_layout = Eto.Forms.StackLayout()\n        self.stack_layout.Orientation = Eto.Forms.Orientation.Vertical\n        self.stack_layout.HorizontalContentAlignment = Eto.Forms.HorizontalAlignment.Stretch\n        self.stack_layout.Padding = Eto.Drawing.Padding(0,0)\n        self.stack_layout.Spacing = 2\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.searchBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.labelBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.scrollable, True)) # True means it does stretch vertically\n        \n        self.Content = self.stack_layout\n        \n        # add events\n        self.SizeChanged += self.MyOnSizeChangedEvent\n        self.Load += self.OnDialogLoad\n        self.Closing += self.OnDialogClosing\n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n        \n        # Clear the layout\n        self.layout.Clear()\n\n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n\n        # button_width = 120  # Fixed button width\n        max_row_width = self.layout.Width  # Maximum row width based on layout width\n        \n        # Initialize unique tags set\n        unique_tags = set()\n        \n        # Collect all tags from all selected objects\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                # Split existing tags and add them to the unique_tags set\n                unique_tags.update(existing_tags.lower().split(\",\"))  # Convert tags to lowercase before adding\n        \n        # Add newly added or appended tags from the text box if they are not already in unique_tags\n        new_tag_text = self.labelBox.Text.strip()\n        # Check if the new tag contains commas\n        if new_tag_text and ',' not in new_tag_text:\n            # Only add the new tag if it's not already in unique_tags\n            if new_tag_text.lower() not in unique_tags:\n                unique_tags.add(new_tag_text.lower())  # Convert new tag to lowercase before adding\n        \n        # Filter tags based on the search text if it's not empty\n        search_text = self.search_text\n        # print(\"Search text:\", search_text)\n        if search_text:\n            filtered_tags = [tag for tag in unique_tags if search_text in tag]\n            # print(\"Filtered tags:\", filtered_tags)\n        else:\n            filtered_tags = list(unique_tags)\n            # print(\"No search text. Showing all tags.\")\n        \n        # Iterate over filtered tags and populate the UI\n        for tag in filtered_tags: \n            delete_button_text = (tag +  str(\"   X\"))\n            delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n            delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n            delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n            delete_button.Tag = tag  # Set the tag text as Tag for the button\n            delete_button.Click += self.OnDeleteButtonClick\n            \n            if row_width + delete_button_width > max_row_width:  # Check if adding the next control exceeds the width\n                row_controls.append(None)  # Add a placeholder control for spacing\n                controls.AddRange(row_controls)  # Add row controls to the main controls list\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                controls.Clear()  # Clear the controls list for the next row\n                # Clear the row controls list for the next row\n                row_controls = []\n                row_width = 0  # Reset row width\n            \n            row_controls.append(delete_button)  # Add the button to the row controls\n            row_width += delete_button_width  # Update the row width\n        \n        if row_controls:  # Add the remaining row controls if any\n            controls.AddRange(row_controls)\n            controls.Add(None) # Add an empty item which gets scaled\n            self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n        \n        self.layout.AddSpace()\n        \n        self.layout.Create()\n\n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Real-Time search feedback\n        self.UpdateDynamicLayout()\n\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n        \n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n        \n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n        \n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                if tag_text in existing_tags:\n                    existing_tags.remove(tag_text)\n                    rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box and split it by commas\n            tag_texts = self.labelBox.Text.strip().split(\",\")\n            for tag_text in tag_texts:\n                tag_text = tag_text.strip()  # Remove leading and trailing spaces\n                if tag_text:\n                    # Append tags to selected objects\n                    if self.selected_objs:\n                        tags = [tag_text]\n                        self.append_tags(self.selected_objs, tags)  # Pass selected_objs as a list\n                        # Update the UI tag list\n                        self.UpdateDynamicLayout()\n                    else:\n                        print(\"No objects selected.\")\n            # Clear the text box\n            self.labelBox.Text = \"\"\n\n    def OnDialogLoad(self, sender, e):\n        \n        # restores dialog location from last use\n        key = \"MC_TagObjects_DialogLocation\"\n        if scriptcontext.sticky.has_key(key): self.Location = scriptcontext.sticky[key]\n        \n        # set focus to the tag entering labelBox\n        self.labelBox.Focus()\n\n    def OnDialogClosing(self, sender, e):\n        \n        # save dialog location for next use\n        scriptcontext.sticky[\"MC_TagObjects_DialogLocation\"] = self.Location\n\ndef GetIcon():\n    \n    # create bitmap from bytestring\n    bytes = System.Convert.FromBase64String(\"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAF9SURBVDhPpdFLSwJRFAfwcy7kpiSwqE3R7JRGgxa9xkqjktpUEqHWOlrVpkXQIoq+QJC76EFgkNrLhJBAP0O10jZBtHfhxkpP9yoTzgOLWvyZ4cL/N3fOASL6V75fpDZIensw45Gr8Tox43Zg2iuDb7YfYKZPGz8/0wAbfqT8BaPCGaOPKKN8hNHrIaOVSXz0yCDN6RADsBPEPKUZ5cKsfLqGn8VzRpTkEAeXJ4yIEQhw4I5RQIFcezPsnqxiSQB0Y44YgG0B3DOKrmNhaRSes/tYpmtGpbg5YgC2FrAoALpi9M5nIJ6irKYW4YOV5gd0gGKHWDaMlf+mS23ZBHkYk2FcA9iawOK2Q1xFzIBSjCMpRslNpF4JEhqgowXA1ggNw3UQSjB646sNKpjydYPLAHTWQSrlI76lIUhNO8G6OKibgQqYIXRb/bIoT/FyiJcD+i3UAioy4oD40x7SywGjkKIt/wiItFrB4uqCYz6wiCiLa6tlA/DXmB7+PgRf7QIEb+tmZQoAAAAASUVORK5CYII=\")\n    bitmap = Eto.Drawing.Bitmap(bytes)\n    \n    # save bitmap in memory stream\n    stream = System.IO.MemoryStream()\n    bitmap.Save(stream, Eto.Drawing.ImageFormat.Png)\n    \n    # create icon from it\n    icon = Eto.Drawing.Icon(stream)\n    \n    return icon\n\ndef EstablishDialog():\n    \n    # get or prompt for objects to tag, do not open dialog if no selection is made\n    selected_objs = rs.GetObjects(\"Select object(s) to tag\", rs.filter.allobjects, preselect=True, select=True)\n    if not selected_objs: return  \n    \n    # open dialog and pass object ids\n    dialog = ObjectTaggingDialog(selected_objs)\n    dialog.Icon = GetIcon()\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 32,
      "is_solution": false
    },
    {
      "code": "import System\nimport Rhino\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\nimport Eto\n\nfrom System.Collections.Generic import List\n\nclass ObjectTaggingDialog(Eto.Forms.Dialog[bool]):\n    def __init__(self, selected_objs):\n        \n        # the selected objects as class wide variable\n        self.selected_objs = selected_objs\n        \n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.Size = Eto.Drawing.Size(300, 220) \n        self.MinimumSize = Eto.Drawing.Size(320, 165)\n        self.MaximumSize = Eto.Drawing.Size(320, -1)\n        \n        self.Padding = Eto.Drawing.Padding(10)\n        self.Resizable = True\n        self.AutoSize = False\n        self.Font = Eto.Drawing.SystemFonts.Default()\n        \n        # searchBox\n        self.search_text = \"\"  # Store the search text\n        self.is_updating_layout = False  # Flag to indicate whether layout update is in progress\n        \n        self.searchBox = Eto.Forms.SearchBox()  # Define searchBox here\n        self.searchBox.PlaceholderText = \"Search...\"\n        self.searchBox.TextChanged += self.OnSearchBoxTextChanged  # Handle text changed event\n        self.searchBox.KeyDown += self.OnSearchBoxKeyDown  # Handle key down event\n        \n        # Create TextBox For Tag Entries\n        self.labelBox = Eto.Forms.TextBox(ShowBorder=False)  # Provide the placeholder text\n        self.labelBox.PlaceholderText = \"Add tag(s) here...\"\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n        \n        # the layout for tags\n        self.layout = Eto.Forms.DynamicLayout()\n        self.layout.DefaultSpacing = Eto.Drawing.Size(4,4) # propagates\n        self.layout.Padding = Eto.Drawing.Padding(0, 6, 0, 0) # controls the gap above the tags\n        \n        # scrollable \n        self.scrollable = Eto.Forms.Scrollable()\n        self.scrollable.ExpandContentHeight = True\n        self.scrollable.ExpandContentWidth = True\n        self.scrollable.ScrollSize = Eto.Drawing.Size(260, -1) # 260 or smaller prevents that the horizontal scroll bar comes up\n        self.scrollable.Border = Eto.Forms.BorderType.None\n        self.scrollable.Content = self.layout\n        \n        # create a stack layout which has 2 sections, top section holds the searchbox\n        # and text box, bottom section holds a scrollable which contains dynamic layout\n        self.stack_layout = Eto.Forms.StackLayout()\n        self.stack_layout.Orientation = Eto.Forms.Orientation.Vertical\n        self.stack_layout.HorizontalContentAlignment = Eto.Forms.HorizontalAlignment.Stretch\n        self.stack_layout.Padding = Eto.Drawing.Padding(0,0)\n        self.stack_layout.Spacing = 2\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.searchBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.labelBox, False))\n        self.stack_layout.Items.Add(Eto.Forms.StackLayoutItem(self.scrollable, True)) # True means it does stretch vertically\n        \n        self.Content = self.stack_layout\n        \n        # add events\n        self.SizeChanged += self.MyOnSizeChangedEvent\n        self.Load += self.OnDialogLoad\n        self.Closing += self.OnDialogClosing\n\n    def MyOnSizeChangedEvent(self, sender, e):\n        try:\n            self.UpdateDynamicLayout()\n        except Exception as ex:\n            print ex\n            return\n\n    def UpdateDynamicLayout(self):\n        # Store the search text before clearing the layout\n        self.search_text = self.searchBox.Text.strip().lower()\n        \n        # Clear the layout\n        self.layout.Clear()\n\n        controls = List[Eto.Forms.Control]()\n        row_controls = []\n        row_width = 0\n\n        # button_width = 120  # Fixed button width\n        max_row_width = self.layout.Width  # Maximum row width based on layout width\n        \n        # Initialize unique tags set\n        unique_tags = set()\n        \n        # Collect all tags from all selected objects\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                # Split existing tags and add them to the unique_tags set\n                unique_tags.update(existing_tags.lower().split(\",\"))  # Convert tags to lowercase before adding\n        \n        # Add newly added or appended tags from the text box if they are not already in unique_tags\n        new_tag_text = self.labelBox.Text.strip()\n        # Check if the new tag contains commas\n        if new_tag_text and ',' not in new_tag_text:\n            # Only add the new tag if it's not already in unique_tags\n            if new_tag_text.lower() not in unique_tags:\n                unique_tags.add(new_tag_text.lower())  # Convert new tag to lowercase before adding\n        \n        # Filter tags based on the search text if it's not empty\n        search_text = self.search_text\n        # print(\"Search text:\", search_text)\n        if search_text:\n            filtered_tags = [tag for tag in unique_tags if search_text in tag]\n            # print(\"Filtered tags:\", filtered_tags)\n        else:\n            filtered_tags = list(unique_tags)\n            # print(\"No search text. Showing all tags.\")\n        \n        # Iterate over filtered tags and populate the UI\n        for tag in filtered_tags: \n            delete_button_text = (tag +  str(\"   X\"))\n            delete_button_width = Eto.Drawing.Font.MeasureString(self.Font, delete_button_text).Width + 30\n            delete_button = Eto.Forms.Button(Text=delete_button_text, BackgroundColor=Eto.Drawing.Colors.DimGray, Width=delete_button_width)\n            delete_button.BackgroundColor = Eto.Drawing.Colors.Transparent\n            delete_button.Tag = tag  # Set the tag text as Tag for the button\n            delete_button.Click += self.OnDeleteButtonClick\n            \n            extraSpaceBetweenRowControls = len(row_controls) * 4 # 4px between each Tag button\n            if row_width + delete_button_width + extraSpaceBetweenRowControls >= max_row_width:  # Check if adding the next control exceeds the width\n                row_controls.append(None)  # Add a placeholder control for spacing\n                controls.AddRange(row_controls)  # Add row controls to the main controls list\n                self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))  # Add controls as a separate row\n                controls.Clear()  # Clear the controls list for the next row\n                # Clear the row controls list for the next row\n                row_controls = []\n                row_width = 0  # Reset row width\n            \n            row_controls.append(delete_button)  # Add the button to the row controls\n            row_width += delete_button_width  # Update the row width\n        \n        if row_controls:  # Add the remaining row controls if any\n            controls.AddRange(row_controls)\n            controls.Add(None) # Add an empty item which gets scaled\n            self.layout.AddSeparateRow(System.Array[Eto.Forms.Control](controls))\n        \n        self.layout.AddSpace()\n        \n        self.layout.Create()\n\n\n    def OnSearchBoxKeyDown(self, sender, e):\n        # Check if Enter key is pressed\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Call the layout update function\n            self.UpdateDynamicLayout()\n\n    def OnSearchBoxTextChanged(self, sender, e):\n        # Real-Time search feedback\n        self.UpdateDynamicLayout()\n\n\n    def append_tags(self, objs, additional_values):\n        appended_count = 0\n        existing_count = 0\n        \n        # Ensure objs is a list, even if it contains only one object\n        if not isinstance(objs, list):\n            objs = [objs]\n        \n        for obj in objs:\n            existing_value = rs.GetUserText(obj, \"Tags\")\n            if existing_value:\n                existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n                new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n                if new_values:\n                    new_value = \",\".join(existing_values + new_values)\n                    rs.SetUserText(obj, \"Tags\", new_value)\n                    appended_count += 1\n                else:\n                    existing_count += 1  # Increment existing count if tag already exists for this object\n            else:\n                lowercased_values = [val.lower() for val in additional_values]\n                rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n                appended_count += 1\n        \n        # Print concise statement\n        if appended_count > 0 or existing_count > 0:\n            message = \"\"\n            if appended_count > 0:\n                message += \"Tag added to {} objects\".format(appended_count)\n            if existing_count > 0:\n                if message:\n                    message += \", \"\n                message += \"Tag already exists in {} objects\".format(existing_count)\n            print(message)\n        \n        else:\n            lowercased_values = [val.lower() for val in additional_values]\n            rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n            print(\"Tags set successfully.\") \n\n    def remove_tags(self, tag_text):\n        print('\"' + str(tag_text) + '\"' + \" tag removed successfully.\")\n\n        # Remove the tag from the user text list\n        for obj in self.selected_objs:\n            existing_tags = rs.GetUserText(obj, \"Tags\")\n            if existing_tags:\n                existing_tags = [tag.strip() for tag in existing_tags.split(\",\")]\n                if tag_text in existing_tags:\n                    existing_tags.remove(tag_text)\n                    rs.SetUserText(obj, \"Tags\", \",\".join(existing_tags))\n\n\n    def OnDeleteButtonClick(self, sender, e):\n        # Get the tag text from the button's Tag property\n        tag_text = sender.Tag\n        if tag_text:\n            # Remove the tag from the UI\n            self.remove_tags(tag_text)\n            # Update the layout to reflect the changes\n            self.UpdateDynamicLayout()\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == Eto.Forms.Keys.Enter:\n            # Get the text entered into the text box and split it by commas\n            tag_texts = self.labelBox.Text.strip().split(\",\")\n            for tag_text in tag_texts:\n                tag_text = tag_text.strip()  # Remove leading and trailing spaces\n                if tag_text:\n                    # Append tags to selected objects\n                    if self.selected_objs:\n                        tags = [tag_text]\n                        self.append_tags(self.selected_objs, tags)  # Pass selected_objs as a list\n                        # Update the UI tag list\n                        self.UpdateDynamicLayout()\n                    else:\n                        print(\"No objects selected.\")\n            # Clear the text box\n            self.labelBox.Text = \"\"\n\n    def OnDialogLoad(self, sender, e):\n        \n        # restores dialog location from last use\n        key = \"MC_TagObjects_DialogLocation\"\n        if scriptcontext.sticky.has_key(key): self.Location = scriptcontext.sticky[key]\n        \n        # set focus to the tag entering labelBox\n        self.labelBox.Focus()\n\n    def OnDialogClosing(self, sender, e):\n        \n        # save dialog location for next use\n        scriptcontext.sticky[\"MC_TagObjects_DialogLocation\"] = self.Location\n\ndef GetIcon():\n    \n    # create bitmap from bytestring\n    bytes = System.Convert.FromBase64String(\"iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAF9SURBVDhPpdFLSwJRFAfwcy7kpiSwqE3R7JRGgxa9xkqjktpUEqHWOlrVpkXQIoq+QJC76EFgkNrLhJBAP0O10jZBtHfhxkpP9yoTzgOLWvyZ4cL/N3fOASL6V75fpDZIensw45Gr8Tox43Zg2iuDb7YfYKZPGz8/0wAbfqT8BaPCGaOPKKN8hNHrIaOVSXz0yCDN6RADsBPEPKUZ5cKsfLqGn8VzRpTkEAeXJ4yIEQhw4I5RQIFcezPsnqxiSQB0Y44YgG0B3DOKrmNhaRSes/tYpmtGpbg5YgC2FrAoALpi9M5nIJ6irKYW4YOV5gd0gGKHWDaMlf+mS23ZBHkYk2FcA9iawOK2Q1xFzIBSjCMpRslNpF4JEhqgowXA1ggNw3UQSjB646sNKpjydYPLAHTWQSrlI76lIUhNO8G6OKibgQqYIXRb/bIoT/FyiJcD+i3UAioy4oD40x7SywGjkKIt/wiItFrB4uqCYz6wiCiLa6tlA/DXmB7+PgRf7QIEb+tmZQoAAAAASUVORK5CYII=\")\n    bitmap = Eto.Drawing.Bitmap(bytes)\n    \n    # save bitmap in memory stream\n    stream = System.IO.MemoryStream()\n    bitmap.Save(stream, Eto.Drawing.ImageFormat.Png)\n    \n    # create icon from it\n    icon = Eto.Drawing.Icon(stream)\n    \n    return icon\n\ndef EstablishDialog():\n    \n    # get or prompt for objects to tag, do not open dialog if no selection is made\n    selected_objs = rs.GetObjects(\"Select object(s) to tag\", rs.filter.allobjects, preselect=True, select=True)\n    if not selected_objs: return  \n    \n    # open dialog and pass object ids\n    dialog = ObjectTaggingDialog(selected_objs)\n    dialog.Icon = GetIcon()\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\nEstablishDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 34,
      "is_solution": false
    },
    {
      "code": "import Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport rhinoscriptsyntax as rs\n\nclass RoundedPanel(forms.Panel):\n    def __init__(self):\n        super(RoundedPanel, self).__init__()\n        self.radius = 5\n\n    def OnPaint(self, e):\n        rect = drawing.RectangleF(0, 0, self.Width, self.Height)\n        brush = drawing.SolidBrush(self.BackgroundColor)\n        e.Graphics.FillRoundedRectangle(brush, rect, self.radius)\n        brush.Dispose()\n\nclass SimpleEtoDialog(forms.Dialog):\n\n    def __init__(self):\n        Rhino.UI.EtoExtensions.UseRhinoStyle(self)\n        self.Title = \"Tag Object\"\n        self.ClientSize = drawing.Size(300, 200)\n        self.Padding = drawing.Padding(5)\n        self.Resizable = False\n\n        # Initialize tag_text as an empty string\n        self.tag_text = \"\"\n\n        # Label\n        self.label = forms.Label()\n        self.labelBox = forms.TextBox(PlaceholderText=\"Enter tag here\")  # Provide the placeholder text\n        self.labelBox.Height = 25  # Adjust the height of the text box\n        self.labelBox.KeyDown += self.OnTextBoxKeyDown\n\n        # Content panel for text labels\n        self.content_panel = forms.StackLayout()  # Use StackLayout instead of FlowLayout\n        self.content_panel.Spacing = 5  # Set spacing between controls\n\n        # Layout\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.label)\n        layout.AddRow(self.labelBox)\n        layout.AddRow(self.content_panel)  # Add content_panel to the layout\n        self.Content = layout\n\n        # Populate existing tags\n        self.populate_existing_tags()\n\n    def populate_existing_tags(self):\n        # Get selected objects\n        selected_objs = rs.SelectedObjects()\n        if selected_objs:\n            # Iterate over selected objects\n            for obj in selected_objs:\n                existing_tags = rs.GetUserText(obj, \"Tags\")\n                if existing_tags:\n                    # Split existing tags and add them to the dialog\n                    tags_list = existing_tags.split(\",\")\n                    for tag in tags_list:\n                        self.add_tag_label(tag.strip())\n\n    def add_tag_label(self, tag_text):\n        # Create a new panel for the text label with rounded corners and background color\n        label_panel = RoundedPanel()\n        label_panel.Padding = drawing.Padding(5)\n        label_panel.BackgroundColor = drawing.Color(220,220,220)  # Set background color\n        label_panel.Content = forms.Label(Text=tag_text)\n\n        # Add the panel to the content panel\n        self.content_panel.Items.Add(label_panel)\n\n    def OnTextBoxKeyDown(self, sender, e):\n        if e.Key == forms.Keys.Enter:\n            # Get the text entered into the text box\n            new_tag_text = self.labelBox.Text.strip()\n            if new_tag_text:\n                # Add the new tag to the dialog\n                self.add_tag_label(new_tag_text)\n\n                # Clear the text box\n                self.labelBox.Text = \"\"\n\n                # Append tags to selected objects\n                selected_objs = rs.SelectedObjects()\n                if selected_objs:\n                    tags = [new_tag_text]\n                    for obj in selected_objs:\n                        append_tags(obj, tags)\n                else:\n                    print(\"No objects selected.\")\n\ndef append_tags(obj, additional_values):\n    existing_value = rs.GetUserText(obj, \"Tags\")\n    if existing_value:\n        existing_values = existing_value.lower().split(\",\")  # Convert existing values to lowercase and split them\n        new_values = [val.lower() for val in additional_values if val.lower() not in existing_values]\n        if new_values:\n            new_value = \",\".join(existing_values + new_values)\n            rs.SetUserText(obj, \"Tags\", new_value)\n            print(\"Tags appended successfully.\")\n        else:\n            print(\"No new tags added. Tags already exist.\")\n    else:\n        lowercased_values = [val.lower() for val in additional_values]\n        rs.SetUserText(obj, \"Tags\", \",\".join(lowercased_values))\n        print(\"Tags set successfully.\")\n\n################################################################################\n# Creating a dialog instance and displaying the dialog.\n################################################################################\ndef TestSampleEtoDialog():\n    dialog = SimpleEtoDialog()\n    dialog.Icon = drawing.Icon(r\"C:\\Users\\micha\\OneDrive - Michael Vollrath\\TOYBLOCK\\PROJECTS\\PROJECT_ENDGAME\\ICONS\\ICO_Tag_Object.ico\")\n    dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n\n################################################################################\n# Check to see if this file is being executed as the \"main\" python\n# script instead of being used as a module by some other python script\n# This allows us to use the module which ever way we want.\n################################################################################\nif __name__ == \"__main__\":\n    TestSampleEtoDialog()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinoscriptsyntax",
    "selection",
    "transformation"
  ],
  "has_accepted_answer": true,
  "category_id": 3,
  "posts_count": 35,
  "views": 1959
}