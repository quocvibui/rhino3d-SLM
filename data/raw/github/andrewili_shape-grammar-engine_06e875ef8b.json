{
  "source_url": "https://github.com/andrewili/shape-grammar-engine/blob/2859d8021442542561bdd1387deebc85e26f2d03/rhino-translators/importer.py",
  "repo": "andrewili/shape-grammar-engine",
  "repo_stars": 1,
  "repo_description": null,
  "license": "unknown",
  "filepath": "rhino-translators/importer.py",
  "instruction": "importer.py",
  "code": "#   importer.py\n\nfrom . import derivation\nfrom . import grammar\n# import numpy                                  ##  consider\n##### import rhinoscriptsyntax as rs\nfrom . import rule\nfrom . import shape\n# import text_test\n\n##  Labels. Use text objects? \n##  Implement abort method\n\nclass Importer(object):\n    def __init__(self):\n        self.shape_size = [32, 32, 0]\n        self.arrow_size = [16, 8, 0]\n        self.padding = [8, 8, 0]\n        self.padded_shape_size = self._add_vectors(\n            self.shape_size, \n            self.padding)\n        self.padded_arrow_size = self._add_vectors(\n            self.arrow_size,\n            self.padding)\n        self.padded_next_shape_size = [\n            self.padded_arrow_size[0] + self.padded_shape_size[0], \n            self.padded_shape_size[1], \n            0]\n        self.padded_rule_size = [\n            (   self.padded_shape_size[0] + \n                self.padded_arrow_size[0] + \n                self.padded_shape_size[0]),\n            self.padded_shape_size[1],\n            0]\n\n    ###\n    def import_derivation(self):                ##  Draws the grammar?\n        \"\"\"Prompts for a drv file. Draws the derivation. \n        \"\"\"\n        drv_text_lines = self._get_text_lines_from_drv_file()\n        derivation_in = (\n            derivation.Derivation.new_from_drv_text_lines(drv_text_lines))\n        self._draw_derivation(derivation_in)\n\n    def _draw_derivation(self, derivation_in):  ##  _draw_simple_derivation\n        \"\"\"Receives: \n            Derivation\n        Lays out and draws the derivation. For now, left to right in the upper \n        right quadrant.\n        \"\"\"\n        origin = [0, 0, 0]                      ##  redundant\n        double_arrow_width = 10\n        shape_width = 32\n        double_arrow_and_shape_width = double_arrow_width + shape_width\n        offset_increment = [double_arrow_and_shape_width, 0, 0]\n                                                ##  generalize for y-dim\n        i = 0\n\n        # for shape in derivation_in.next_shapes:\n        #     offset = self._calculate_offset(offset_increment, i)\n        #     if i == 0:\n        #         self._draw_shape(shape, offset)\n        #     else:\n        #         self._draw_shape(shape, offset) ##  double arrow disabled\n        #         # self._draw_derivation_arrow_and_shape(\n        #         #     shape, offset, double_arrow_width)\n        #         print('shape %i: %s' % (i, shape.name))\n        #     i = i + 1\n\n        for shape_i in derivation_in.derivation_shapes:\n            position = self._get_item_position(origin, offset_increment, i)\n            self._draw_shape(shape_i, position)\n            i += 1\n\n    def _calculate_offset(self, offset_increment, i):\n        \"\"\"Receives an offset increment and an index:\n            [num, num, num]\n            int\n        Returns an offset, i.e., vector or local origin:\n            [num, num, num]\n        \"\"\"\n        offset = [coord_offset * i for coord_offset in offset_increment]\n        return offset\n\n    ###\n    def import_grammar(self):\n        \"\"\"Prompts for a drv file. Draws the grammar.\n        \"\"\"\n        drv_text_lines = self._get_text_lines_from_drv_file()\n        grammar_in = grammar.Grammar.new_from_drv_text_lines(drv_text_lines)\n        self._draw_grammar(grammar_in)\n\n    def _draw_grammar(self, grammar_in):\n        \"\"\"Receives: \n            Grammar\n        Draws the grammar. For now, top to bottom in the lower right quadrant.\n        \"\"\"\n        origin = [0, 0, 0]\n        offset_direction = [0, -1, 0]\n        offset_increment = self._multiply_vectors(\n            self.padded_rule_size, offset_direction)\n        i = 1\n                                                ##  Multiple initial shapes\n        for shape_i in grammar_in.initial_shapes:\n            position = self._get_item_position(origin, offset_increment, i)\n            self._draw_shape(shape_i, position)\n            i += 1\n        for rule_i in grammar_in.rules:\n            position = self._get_item_position(origin, offset_increment, i)\n            self._draw_rule(rule_i, position)\n            i += 1\n\n        # initial_shapes_location = self._add_vectors(\n        #     origin, \n        #     self._multiply_vector_scalar(offset_increment, i))\n        # self._draw_shape(grammar_in.initial_shape, initial_shapes_location)\n        # i = i + 1\n        # for rule_i in grammar_in.rules:\n        #     offset_multiplier = self._calculate_offset(offset_direction, i)\n        #     rule_location = self._add_vectors(\n        #         origin,\n        #         self._multiply_vector_scalar(offset_increment, i))\n        #     self._draw_rule(rule_i, rule_location)\n        #     i = i + 1\n\n    def _get_item_position(self, origin, offset_increment, i):\n        \"\"\"Receives origin, offset increment, and index:\n            [num, num, num]\n            [num, num, num]\n            int\n        Returns the position of the item:\n            [num, num, num]\n        \"\"\"\n        net_offset = self._multiply_vector_scalar(offset_increment, i)\n        position = self._add_vectors(origin, net_offset)\n        return position\n\n    def _multiply_vectors(self, v1, v2):        ##  right name?\n        \"\"\"Receives two vectors:\n            [num, num, num]\n            [num, num, num]\n        Returns a vector whose components are products of the corresponding \n        components:\n            [num, num, num]\n        \"\"\"\n        product = map(self._multiply, v1, v2)\n        return product\n\n    def _multiply(self, num1, num2):\n        product = num1 * num2\n        return product\n\n    def _multiply_vector_scalar(self, vector_in, scalar):\n        \"\"\"Receives:\n            [num, num, num]\n            num\n        Returns a vector:\n            [num, num, num]\n        \"\"\"\n        vector_out = []\n        for coord_in in vector_in:\n            coord_out = coord_in * scalar\n            vector_out.append(coord_out)\n        return vector_out\n\n    def _get_initial_shape_location(self, i):\n        \"\"\"Receives:\n            int\n        Returns the origin of the initial shape:\n            [num, num, num]\n        \"\"\"\n\n        return [x, y, z]\n\n    def _draw_rule(self, rule_in, location_rule=[0, 0, 0]):\n        \"\"\"Receives a rule and a location:\n            Rule\n            [num, num, num]\n        Draws the rule at the location.\n        \"\"\"\n        location_name, location_left, location_arrow, location_right = (\n            self._calculate_rule_part_locations(location_rule))\n        self._write_shape_name(rule_in.name, location_name)     ##\n        self._draw_shape(rule_in.left_shape, location_left)\n        self._draw_rule_arrow(location_arrow)                   ##\n        self._draw_shape(rule_in.right_shape, location_right)\n\n    def _calculate_rule_part_locations(self, location_rule):\n        \"\"\"Receives the rule's location:\n            [num, num, num]\n        Returns the origins of the rule's name, left shape, arrow, and \n        right shape:\n            (   [num, num, num], \n                [num, num, num], \n                [num, num, num], \n                [num, num, num])\n        \"\"\"\n        offset_rule_left = [0, 0, 0]\n        offset_rule_name = [self.padded_shape_size[0], 0, 0]    ##  temp\n        offset_rule_arrow = [\n            self.padded_shape_size[0], \n            (self.shape_size[1] - self.arrow_size[1]) / 2, \n            0]\n        offset_rule_right = [\n            offset_rule_arrow[0] + self.padded_arrow_size[0], \n            0, \n            0]\n        location_name = self._add_vectors(location_rule, offset_rule_name)\n        location_left = self._add_vectors(location_rule, offset_rule_left)\n        location_arrow = self._add_vectors(location_rule, offset_rule_arrow)\n        location_right = self._add_vectors(location_rule, offset_rule_right)\n        return (\n            location_name, \n            location_left, \n            location_arrow, \n            location_right)\n\n    def _add_vectors(self, v1, v2):\n        \"\"\"Receives two vectors or points:\n            [num, num, num]\n            [num, num, num]\n        Returns the sum:\n            [num, num, num]\n        \"\"\"\n        vector_sum = map(self._add, v1, v2)\n        return vector_sum\n\n    def _add(self, num1, num2):\n        total = num1 + num2\n        return total\n\n    ###\n    def import_final_shape(self):\n        \"\"\"Prompts for a drv file. Draws the final shape in the derivation.\n        \"\"\"\n        drv_text_lines = self._get_text_lines_from_drv_file()\n        final_shape_text_lines = (\n            shape.Shape.get_final_shape_text_lines_from_drv_text_lines(\n                drv_text_lines))\n        final_shape = shape.Shape.new_from_is_text_lines(\n            final_shape_text_lines)\n        self._draw_shape(final_shape)\n\n    def _get_text_lines_from_drv_file(self):\n        \"\"\"Prompts for a drv file. Returns its text lines:\n            [drv_text_line, ...]\n        \"\"\"\n        filter = \"Derivation files (*.drv)|*.drv|All files (*.*)|*.*||\"\n        filename = rs.OpenFileName('Open derivation file', filter)\n        if not filename:\n            return\n        file = open(filename, 'r')\n        drv_text_lines = file.readlines()\n        file.close()\n        return drv_text_lines\n\n    ###\n    def import_rule(self):\n        rule_in = self._read_rule_file()\n        source_shape = rule_in.get_source_shape()\n        self._draw_shape(source_shape)\n\n    def _read_rule_file(self):\n        \"\"\"Prompts for a file. Returns:\n            Rule\n        \"\"\"\n        #   prompt the user for a file to import\n        filter = \"Rule files (*.rul)|*.rul|All files (*.*)|*.*||\"\n        filename = rs.OpenFileName(\"Open rule file\", filter)\n        if not filename: \n            return\n        \n        #   read each line from the file\n        file = open(filename, \"r\")\n        contents = file.readlines()\n        file.close()\n\n        new_rule = rule.Rule.new_from_rul_text_lines(contents)\n        return new_rule\n\n    ###\n    def import_initial_shape(self):\n        shape_in = self._read_shape_file()\n        self._draw_shape(shape_in)\n\n    def _read_shape_file(self):\n        \"\"\"Prompts for a file. Returns:\n            Shape\n        \"\"\"\n        #   prompt the user for a file to import\n        filter = \"Shape files (*.is)|*.is|All files (*.*)|*.*||\"\n        filename = rs.OpenFileName(\"Open shape file\", filter)\n        if not filename: return\n        \n        #   read each line from the file\n        file = open(filename, \"r\")\n        contents = file.readlines()\n        file.close()\n\n        new_shape = shape.Shape.new_from_is_text_lines(contents)\n        return new_shape\n\n    def _write_shape_name(self, name, offset=[0, 0, 0]):\n        \"\"\"\n        \"\"\"\n        print('In lieu of writing a shape name')\n\n    def _draw_rule_arrow(self, location=[0, 0, 0]):\n        \"\"\"Receives the global location:\n            [num, num, num]\n        Draws a rule arrow at that location.\n        \"\"\"\n        p12 = [0, 4, 0]\n        p21 = [12, 0, 0]\n        p23 = [12, 8, 0]\n        p32 = [16, 4, 0]\n        self._draw_line(p12, p32, location)\n        self._draw_line(p21, p32, location)\n        self._draw_line(p23, p32, location)\n        print('In addition to drawing a rule arrow')\n\n    def _draw_derivation_arrow_and_shape(       ##  not called\n        self, shape, offset, double_arrow_width\n    ):\n        \"\"\"Receives:\n            Shape\n            [num, num, num]\n            num\n        Draws a double arrow and the shape at the offset locations.\n        \"\"\"\n        self._draw_derivation_arrow(offset)\n        shape_offset = [offset[0] + double_arrow_width, offset[1], offset[2]]\n        self._draw_shape(shape, shape_offset)   ##\n\n    def _draw_derivation_arrow(self, offset):\n        \"\"\"Receives an offset:\n            [num, num, num]\n        Draws a derivation arrow at that offset.\n        \"\"\"\n        p12 = [1, 2, 0]\n        p14 = [1, 4, 0]\n        p60 = [6, 0, 0]\n        p66 = [6, 6, 0]\n        p82 = [8, 2, 0]\n        p84 = [8, 4, 0]\n        p86 = [8, 8, 0]\n        p93 = [9, 3, 0]\n        self._draw_line(p12, p82, offset)\n        self._draw_line(p14, p84, offset)\n        self._draw_line(p60, p93, offset)\n        self._draw_line(p66, p93, offset)\n\n    def _draw_shape(self, shape, location=[0, 0, 0]):\n        \"\"\"Receives a shape and a list denoting the local origin: \n            Shape\n            [num, num, num]\n        Draws the shape in Rhino at the location.\n        \"\"\"\n        rhino_lines = shape.get_line_specs_as_lists()\n        for rhino_line in rhino_lines:\n            rhino_p1, rhino_p2 = rhino_line\n            self._draw_line(rhino_p1, rhino_p2, location)\n        rhino_lpoints = shape.get_rhino_lpoints()\n        for rhino_lpoint in rhino_lpoints:\n            label, rhino_point = rhino_lpoint\n            self._draw_rhino_lpoint(label, rhino_point, location)\n\n    def _draw_shape_ground(self, location=[0, 0, 0]):\n        \"\"\"Receives a location:\n            [num, num, num]\n        Draws a square at the location.\n        \"\"\"\n        dx = self.padded_shape_size[0]\n        dy = self.padded_shape_size[1]\n        p00 = [0, 0, 0]\n        p01 = [0, dy, 0]\n        p10 = [dx, 0, 0]\n        p11 = [dx, dy, 0]\n        self._draw_line(p00, p01, location)\n        self._draw_line(p00, p10, location)\n        self._draw_line(p01, p11, location)\n        self._draw_line(p10, p11, location)\n\n    def _draw_line(self, p1, p2, offset):\n        p1a = map(self._offset_coord, p1, offset)\n        p2a = map(self._offset_coord, p2, offset)\n        rs.AddLine(p1a, p2a)\n\n    def _draw_lpoint(self):                     ##  draw point\n        pass\n\n    def _draw_rhino_lpoint(self, label, rhino_point, offset):\n        offset_rhino_point = map(self._offset_coord, rhino_point, offset)\n        # rs.AddTextDot(label, offset_rhino_point)\n        rs.AddText(label, offset_rhino_point)\n\n    def _offset_coord(self, coord, offset):\n        return coord + offset\n\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}