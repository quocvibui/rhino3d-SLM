{
  "source_url": "https://github.com/ESteelEx/gcode2cutsim/blob/95aa5678ec3848954cd855838198d3c5a8802a51/RhinoInterface/MWPackager.py",
  "repo": "ESteelEx/gcode2cutsim",
  "repo_stars": 2,
  "repo_description": "- gcode 2 cutsim code for 3D Simulation with Verifier Engine",
  "license": "unknown",
  "filepath": "RhinoInterface/MWPackager.py",
  "instruction": "Mwpackager",
  "code": "try:\n    import rhinoscriptsyntax as rs\nexcept:\n    print 'You have to execute this script inside Rhino environment'\n\nimport sys, os, threading, zipfile, shutil\nimport adjustINI\nreload(adjustINI)\n\n\n# ----------------------------------------------------------------------------------------------------------------------\ndef package_flist():\n    package = {}\n    #package['calc_core'] = 'mwAdditive3DPrinter.exe'\n    #package['simulation_core'] = 'gcode2cutsimFDM.exe'\n    package['workpiece'] = 'Mesh.stl'\n    package['simulation_file_AddSim'] = 'Mesh.cl'\n    package['simulation_file_MachSim'] = 'Mesh.sim'\n    package['gcode'] = 'Mesh.gcode'\n    package['build_space'] = 'buildspace.3dm'\n    package['config_file'] = 'Mesh.ini'\n\n    return package\n\n\n\nclass MWPackager(threading.Thread):\n    def __init__(self, pluginPath, corePath, command='save'):\n        self.pluginPath = pluginPath\n        self.corePath = corePath\n        self.cachePath = 'Cache'\n        self.command = command\n        threading.Thread.__init__(self)\n\n    # ------------------------------------------------------------------------------------------------------------------\n    def run(self):\n        if self.command == 'save':\n            self.copy_core()\n        else:\n            self.load_package()\n\n    # ------------------------------------------------------------------------------------------------------------------\n    def copy_core(self):\n        sys.path.append(self.pluginPath)\n        package = package_flist()\n\n        print 'Creating archive ...'\n        fileName = rs.SaveFileName(title='Enter or select MW 3D package', filter='MW3D|*.mw3D', extension='mw3D')\n\n        if fileName is not None:\n\n            print 'Packing archive to -> ' + fileName\n\n            print 'Preparing buildspace ...'\n            if os.path.isfile(package['build_space']):\n                os.remove(package['build_space'])\n\n            rs.Command('_-SaveAs ' + self.corePath + '\\\\' + package['build_space'])\n\n            zf = zipfile.ZipFile(fileName, mode='w')\n            for key, file in package.iteritems():\n                file_abs = self.corePath + '\\\\' + file\n                if os.path.isfile(file_abs):\n                    try:\n                        print 'Adding ' + key + ' - ' + file\n                        zf.write(file_abs, arcname=file, compress_type=zipfile.ZIP_DEFLATED)\n                    except:\n                        print 'Something went wrong while zipping'\n                        zf.close()\n                else:\n                    print 'File not found: ' + str(file)\n\n            print 'Closing package'\n            zf.close()\n            # if os.path.isfile(package['build_space']):\n            #     print 'Removing TMP data ...'\n            #     os.remove(package['build_space'])\n\n            print 'MW Package stored.'\n            print 'FINISHED'\n\n    # ------------------------------------------------------------------------------------------------------------------\n    def load_package(self):\n        sys.path.append(self.pluginPath)\n        fileName = rs.OpenFileName(title='Enter or select MW 3D package', filter='MW3D|*.mw3D', extension='mw3D')\n\n        if fileName is not None:\n            packageFileNames = []\n\n            try:\n                fh = open(fileName, 'rb')\n                z = zipfile.ZipFile(fh)\n                for name in z.namelist():\n                    packageFileNames.append(name.split('/')[-1])\n                    outputPath = name.split('/')[:-1]\n                    if len(outputPath) == 0:\n                        outputPath = ['']\n                    packageFolder = fileName.split('\\\\')[-1].split('.')[0]\n                    extractionPath = self.corePath + '\\\\' + self.cachePath + '\\\\' + packageFolder + '\\\\' + outputPath[0]\n\n                    print 'Extracting : ' + packageFolder + '\\\\' + name\n\n                    if not os.path.isdir(extractionPath):\n                        os.mkdir(extractionPath)\n\n                    outfile = open(self.corePath + '\\\\' + self.cachePath + '\\\\' + packageFolder + '\\\\' + name, 'wb')\n                    outfile.write(z.read(name))\n                    outfile.close()\n\n                fh.close()\n\n                # load buildspace with workpiece and tool path etc.\n                for file in packageFileNames:\n                    if file.split('.')[-1] == '3dm':\n                        rs.Command(r'_-Open ' + extractionPath + r'/' + file +\n                                   r' N ' +\n                                   extractionPath + r'/' + file + r' _Enter')\n\n                # copy settings to core\n                for file in packageFileNames:\n                    if file.split('.')[-1] == 'stl' or file.split('.')[-1] == 'ini' or  \\\n                                    file.split('.')[-1] == 'cl' or file.split('.')[-1] == 'gcode':\n\n                        shutil.copy(extractionPath + '\\\\' + file,\n                                    self.corePath + '\\\\' + file)\n\n                print 'Adjusting INI File ...'\n                AI = adjustINI.adjustINI(self.pluginPath, self.corePath)\n                AI.adjust_abs_folder()\n\n                print 'FINISHED'\n\n            except:\n                print 'ERROR. Could not open MW3D package.'\n\n\n\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}