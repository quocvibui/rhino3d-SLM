{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_NodesByCurveProximity.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_NodesByCurveProximity.py",
  "instruction": "Select KnitNetwork Nodes by proximity by selecting all nodes that are closer\nthan the specified Tolerance to the given SamplePoints.\n    Inputs:\n        KnitNetwork: The KnitNetwork to select nodes...",
  "code": "\"\"\"\nSelect KnitNetwork Nodes by proximity by selecting all nodes that are closer\nthan the specified Tolerance to the given SamplePoints.\n    Inputs:\n        KnitNetwork: The KnitNetwork to select nodes from.\n                     {item, KnitNetworkBase}\n        SampleCurves: Curve for proximity search.\n                      {list, point3d}\n        Tolerance: All nodes closer to the sample curves than this value will\n                   be selected by the component.\n                   Defaults to [0.01] units.\n                   {item, float}\n    Outputs:\n        NodeIndices: The indices (identifiers) of the found nodes within the\n                     network.\n                     {list, int}\n        Nodes: The found nodes as node-2-tuples consisting of (index, data).\n               {list, nodes}\n        NodePoints: The Point3d geometry of the selected nodes within the\n                    network.\n                    {list, point3d}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200705\n\"\"\"\n\n# PYTHON STANDARD LIBRARY IMPORTS\nfrom __future__ import division\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"NodesByCurveProximity\"\nghenv.Component.NickName =\"NBCP\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"07 KnitNetwork Editing\"\n\n# LOCAL MODULE IMPORTS\ntry:\n    import cockatoo\nexcept ImportError:\n    errMsg = \"The Cockatoo python module seems to be not correctly \" + \\\n             \"installed! Please make sure the module is in you search \" + \\\n             \"path, see README for instructions!.\"\n    raise ImportError(errMsg)\n\nclass NodesByCurveProximity(component):\n    \n    def __init__(self):\n        super(NodesByCurveProximity, self).__init__()\n        \n        self.drawing_nodes = []\n        self.skip_invalid = False\n    \n    def is_point_within_tolerance_to_crv(self, data_tuple):\n        node, sample_crvs, tol = data_tuple\n        for j, samplecrv in enumerate(sample_crvs):\n            if samplecrv == None:\n                continue\n            curve_cp = samplecrv.ClosestPoint(node[1][\"geo\"], tol)\n            if curve_cp[0]:\n                return True\n        return False\n    \n    def RunScript(self, KnitNetwork, SampleCurves, Tolerance=0.01):\n        \n        # set defaults and catch None values\n        if Tolerance == None:\n            Tolerance = 0.01\n        \n        # initialize outputs\n        NodeIndices = Grasshopper.DataTree[object]()\n        Nodes = Grasshopper.DataTree[object]()\n        NodePoints = Grasshopper.DataTree[object]()\n        \n        # filter nodes according to input\n        if KnitNetwork and SampleCurves:\n            \n            # get all the nodes of the network\n            network_nodes = KnitNetwork.nodes(data=True)\n            \n            data_list = []\n            for i, node in enumerate(network_nodes):\n                data_tuple = (node, SampleCurves, Tolerance)\n                data_list.append(data_tuple)\n            \n            results = GhPython.ScriptHelpers.Parallel.Run(\n                                self.is_point_within_tolerance_to_crv,\n                                data_list,\n                                False)\n            \n            Nodes = [network_nodes[i] for i, val in enumerate(results) if val]\n            NodeIndices = [n[0] for n in Nodes]\n            NodePoints = [n[1][\"geo\"] for n in Nodes]\n        \n        # catch missing inputs\n        if not KnitNetwork:\n            errMsg = \"No KnitNetwork input!\"\n            rml = self.RuntimeMessageLevel.Warning\n            self.AddRuntimeMessage(rml, errMsg)\n        if not SampleCurves:\n            errMsg = \"No SampleCurves input!\"\n            rml = self.RuntimeMessageLevel.Warning\n            self.AddRuntimeMessage(rml, errMsg)\n        \n        # return results\n        return NodeIndices, Nodes, NodePoints\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}