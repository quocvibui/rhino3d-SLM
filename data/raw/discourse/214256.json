{
  "source_url": "https://discourse.mcneel.com/t/unrollwithtextcoords-rvb-for-rhino-6-is-not-running-on-rhino-8/214256",
  "topic_id": 214256,
  "title": "UnrollWithTextCoords.rvb for Rhino 6 is not running on Rhino 8",
  "question": "Hi\n\nIâ€™ve been using this script for unrolling multiple surfaces, copiing it ran only as administrator in Rhino 7 and now that i use Rino 8 the script just stopped working. Note that the script is originally written in .rvb so i wonder if it is possible to rewrite it for python\n\n\nHere is the Script:\n\n\nOption Explicit\n\n'Script written by Jaroslaw Bieda\n\n\nCall Main()\n\nSub Main()\n\n\nOn Error Resume Next\n\n'get surfaces to unroll\nDim arrM : arrM = Rhino.GetObjects(\"Surfaces to Unroll?\", 8)\nIf isnull(arrM) Then Exit Sub\n\n'get unroll start point\nDim arrBP : arrBP = Rhino.GetPoint(\"Unroll start point?\")\nIf isnull(arrBP) Then arrBP = array(0, 0, 0)\n\nDim x : x = 0\nDim arrBB\n\nDim idM\nDim i,j,arrMV,arrDots(),arrNewMV(),arrUnrolled, idNewMesh\nDim c : c = 0\nDim arrNewMeshes()\n\nDim strTmpPath : strTmpPath = GetApplicationDataFolder() & \"tmp.obj\"\n\nCall Rhino.EnableRedraw(False)\nCall Rhino.StatusBarProgressMeter(\"Processing...\", 0, Ubound(arrM), True, True)\n\n'process each surface\nFor i=0 To Ubound(arrM)\n\n\tCall Rhino.StatusBarProgressMeter(i)\n\t\n\tIf Rhino.IsSurfaceUnrollable(arrM(i)) Then\n\t\n\t\t'get underlying mesh\n\t\tidM = Rhino.ExtractRenderMesh(arrM(i))\n\t\tRhino.UnselectAllObjects\n\t\t\n\t\t'export/import as OBJ to 'Bake' texture coordinates\n\t\tCall Rhino.SelectObject(idM)\n\t\tCall Rhino.Command(\"-_Export \" & strTmpPath & \" _ExportMeshTextureCoordinates=Yes _Enter _Enter\", False)\n\t\tCall Rhino.DeleteObject(idM)\n\t\tCall Rhino.Command(\"_-Import \" & strTmpPath & \" _Enter\", False)\n\t\tidM = Rhino.SelectedObjects()(0)\n\t\t\n\t\t'draw dot for each mesh vertex with number on the source surface\n\t\tarrMV = Rhino.MeshVertices(idM)\n\t\tReDim arrDots(Ubound(arrMV))\n\t\tFor j=0 To Ubound(arrMV)\n\t\t\tarrDots(j) = Rhino.AddTextDot(Cstr(j), Rhino.EvaluateSurface(arrM(i), Rhino.SurfaceClosestPoint(arrM(i), arrMV(j))))\n\t\tNext\n\t\n\t\t'select original surface and dots from mesh verts\n\t\tCall Rhino.UnselectAllObjects()\n\t\tCall Rhino.SelectObjects(arrDots)\n\t\tCall Rhino.SelectObject(arrM(i))\n\t\n\t\t'unroll...\n\t\tCall Rhino.Command(\"_UnrollSrf...",
  "code_blocks": [
    {
      "code": "On Error Resume Next\n\n'get surfaces to unroll\nDim arrM : arrM = Rhino.GetObjects(\"Surfaces to Unroll?\", 8)\nIf isnull(arrM) Then Exit Sub\n\n'get unroll start point\nDim arrBP : arrBP = Rhino.GetPoint(\"Unroll start point?\")\nIf isnull(arrBP) Then arrBP = array(0, 0, 0)\n\nDim x : x = 0\nDim arrBB\n\nDim idM\nDim i,j,arrMV,arrDots(),arrNewMV(),arrUnrolled, idNewMesh\nDim c : c = 0\nDim arrNewMeshes()\n\nDim strTmpPath : strTmpPath = GetApplicationDataFolder() & \"tmp.obj\"\n\nCall Rhino.EnableRedraw(False)\nCall Rhino.StatusBarProgressMeter(\"Processing...\", 0, Ubound(arrM), True, True)\n\n'process each surface\nFor i=0 To Ubound(arrM)\n\n\tCall Rhino.StatusBarProgressMeter(i)\n\t\n\tIf Rhino.IsSurfaceUnrollable(arrM(i)) Then\n\t\n\t\t'get underlying mesh\n\t\tidM = Rhino.ExtractRenderMesh(arrM(i))\n\t\tRhino.UnselectAllObjects\n\t\t\n\t\t'export/import as OBJ to 'Bake' texture coordinates\n\t\tCall Rhino.SelectObject(idM)\n\t\tCall Rhino.Command(\"-_Export \" & strTmpPath & \" _ExportMeshTextureCoordinates=Yes _Enter _Enter\", False)\n\t\tCall Rhino.DeleteObject(idM)\n\t\tCall Rhino.Command(\"_-Import \" & strTmpPath & \" _Enter\", False)\n\t\tidM = Rhino.SelectedObjects()(0)\n\t\t\n\t\t'draw dot for each mesh vertex with number on the source surface\n\t\tarrMV = Rhino.MeshVertices(idM)\n\t\tReDim arrDots(Ubound(arrMV))\n\t\tFor j=0 To Ubound(arrMV)\n\t\t\tarrDots(j) = Rhino.AddTextDot(Cstr(j), Rhino.EvaluateSurface(arrM(i), Rhino.SurfaceClosestPoint(arrM(i), arrMV(j))))\n\t\tNext\n\t\n\t\t'select original surface and dots from mesh verts\n\t\tCall Rhino.UnselectAllObjects()\n\t\tCall Rhino.SelectObjects(arrDots)\n\t\tCall Rhino.SelectObject(arrM(i))\n\t\n\t\t'unroll...\n\t\tCall Rhino.Command(\"_UnrollSrf _Labels=No _Enter\", False)\n\t\n\t\t'reconstructing mesh vertext locations from dots\n\t\tReDim arrNewMV(Ubound(arrMV))\n\t\tarrUnrolled = Rhino.LastCreatedObjects()\n\t\tFor j=0 To Ubound(arrUnrolled)\n\t\t\tIf Rhino.ObjectType(arrUnrolled(j)) = 8192 Then\n\t\t\t\tarrNewMV(CInt(Rhino.TextDotText(arrUnrolled(j)))) = Rhino.TextDotPoint(arrUnrolled(j))\n\t\t\tEnd If\n\t\tNext\n\n\t\t'reconstruct unrolled mesh based on original vertices and text. coords\n\t\tidNewMesh = Rhino.AddMesh(arrNewMV, Rhino.MeshFaceVertices(idM),, Rhino.MeshTextureCoordinates(idM))\n\t\tCall Rhino.MatchMaterial(arrM(i), array(idNewMesh))\n\t\t\n\t\tReDim Preserve arrNewMeshes(c)\n\t\tarrNewMeshes(c) = idNewMesh\n\t\tc = c + 1\n\t\t\n\t\t'move mesh no the new unroll location / arrange \n\t\tarrBB = Rhino.BoundingBox(idNewMesh)\n\t\tCall Rhino.MoveObject(idNewMesh, arrBB(0), array(arrBP(0) + x, arrBP(1), arrBP(2)))\n\t\tx = x + Rhino.Distance(arrBB(0), arrBB(1))\n\t\t\n\t\t'cleanup \n\t\tCall Rhino.DeleteObjects(arrUnrolled)\n\t\tCall Rhino.DeleteObject(idM)\n\t\tCall Rhino.DeleteObjects(arrDots)\n\t\t\n\t\t'refresh view\n\t\tCall Rhino.EnableRedraw(True)\n\t\tCall Rhino.EnableRedraw(False)\n\t\t\n\tElse 'mark non-unrollable surface as RED\n\t\tCall Rhino.ObjectColor(arrM(i), vbRed) \n\tEnd If\n\t\n\t\n\t\nNext\n\n'finalize\nCall Rhino.UnselectAllObjects()\nIf c > 0 Then Call Rhino.SelectObjects(arrNewMeshes)\nCall Rhino.EnableRedraw(True)\nCall Rhino.StatusBarProgressMeter()",
      "language": "python",
      "author": "Alejandro_Velasco",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "materials",
    "mesh",
    "python",
    "selection",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 7,
  "views": 95
}