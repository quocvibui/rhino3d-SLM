{
  "source_url": "https://github.com/BlockResearchGroup/compas_3gs/blob/162cecfbeb8806340a55713ec3a0bce7cc932c89/examples/_old_examples/01_40_volmesh_planarisation.py",
  "repo": "BlockResearchGroup/compas_3gs",
  "repo_stars": 11,
  "repo_description": "3D graphic statics add-on for the COMPAS framework",
  "license": "MIT",
  "filepath": "examples/_old_examples/01_40_volmesh_planarisation.py",
  "instruction": "01 40 volmesh planarisation",
  "code": "from __future__ import absolute_import\nfrom __future__ import print_function\nfrom __future__ import division\n\nimport compas\n\nfrom compas_rhino.utilities import volmesh_from_polysurfaces\n\nfrom compas_3gs.rhino import VolMeshSelector\n\nfrom compas.utilities import i_to_red\n\nfrom compas_3gs.diagrams import ForceVolMesh\n\nfrom compas_3gs.algorithms import volmesh_planarise\n\nfrom compas_3gs.rhino import VolmeshConduit\n\nfrom compas_3gs.utilities import compare_initial_current\nfrom compas_3gs.utilities import volmesh_face_flatness\n\nfrom compas_3gs.rhino import bake_cells_as_polysurfaces\n\ntry:\n    import rhinoscriptsyntax as rs\n\nexcept ImportError:\n    compas.raise_if_ironpython()\n\n\n# ------------------------------------------------------------------------------\n# 1. make vomesh from rhino polysurfaces\n# ------------------------------------------------------------------------------\nlayer = 'force_volmesh'\n\nguids = rs.GetObjects(\"select polysurfaces\", filter=rs.filter.polysurface)\nrs.HideObjects(guids)\n\nforcediagram = ForceVolMesh()\nforcediagram = volmesh_from_polysurfaces(forcediagram, guids)\nforcediagram.layer = layer\nforcediagram.attributes['name'] = layer\n\nforcediagram.draw()\n\n\n# ------------------------------------------------------------------------------\n# 2. pick vertices to fix\n# ------------------------------------------------------------------------------\nrs.EnableRedraw(True)\n\nvkeys = VolMeshSelector.select_vertices(forcediagram,\n                                        message='Select vertices to fix:')\n\n\n# ------------------------------------------------------------------------------\n# 3. planarise\n# ------------------------------------------------------------------------------\nforcediagram.clear()\n\ninitial_flatness = volmesh_face_flatness(forcediagram)\n\n# conduit\nconduit = VolmeshConduit(forcediagram)\n\n\ndef callback(forcediagram, k, args, refreshrate=10):\n    if k % refreshrate:\n        return\n    current_flatness = volmesh_face_flatness(forcediagram)\n    face_colordict = compare_initial_current(current_flatness,\n                                             initial_flatness,\n                                             color_scheme=i_to_red)\n    conduit.face_colordict = face_colordict\n    conduit.redraw()\n\n\n# planarise\nwith conduit.enabled():\n    volmesh_planarise(forcediagram,\n                      kmax=500,\n                      fix_vkeys=vkeys,\n                      fix_boundary_normals=False,\n                      tolerance_flat=0.05,\n                      callback=callback,\n                      print_result_info=True)\n\n# update / redraw\n# forcediagram.draw()\n\nbake_cells_as_polysurfaces(forcediagram)\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}