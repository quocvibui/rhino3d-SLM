{
  "source_url": "https://github.com/Guanda0120/Geometry_Acoustic_Simu/blob/fe0e445521fcfee6406f3605783387410ec1848c/FileIO/ReadRhino.py",
  "repo": "Guanda0120/Geometry_Acoustic_Simu",
  "repo_stars": 2,
  "repo_description": null,
  "license": "unknown",
  "filepath": "FileIO/ReadRhino.py",
  "instruction": "Read rhino",
  "code": "import rhino3dm as rhino3dm\nimport numpy as np\n\n\nclass Read3dm:\n    \"\"\"\n    This module is for read rhino3dm file\n    Read as layer, some specific layer is below\n    receiver: rhino3dm.Point3d\n    source: rhino3dm.Point3d\n    all the other layer is sort as material\n    \"\"\"\n\n    def __init__(self, file_dir: str):\n        \"\"\"\n        Get the direction of the rhino file\n        :param file_dir: absolute direction of rhino\n        \"\"\"\n        self.file_dir = file_dir\n\n    def convert_file(self):\n        \"\"\"\n        Convert the rhino file into structure data\n        :return: A dict have material info, receiver ndarray, source ndarray\n        \"\"\"\n        # Read the Rhino File\n        model = rhino3dm.File3dm.Read(self.file_dir)\n\n        # Creat a Dictionary match the layer name and object\n        receiver = []\n        tmp_polygon_cen = []\n        tmp_direc_line = []\n        source = None\n        model_dict = {}\n        for lay in model.Layers:\n            if lay.Name not in [\"Receiver\", \"Source\", \"Center_pt\", \"Direc_line\"]:\n                model_dict[lay.Name] = []\n\n        # Match the Geometry object to the dictionarygras\n        for rh_obj in model.Objects:\n            lay_idx = rh_obj.Attributes.LayerIndex\n            dict_key = model.Layers[lay_idx].Name\n\n            # Add material to dict\n            if dict_key not in [\"Receiver\", \"Source\", \"Center_pt\", \"Direc_line\"]:\n                model_dict[dict_key].append(rh_obj)\n\n            # Add receiver point in receiver list\n            elif dict_key == \"Receiver\":\n                receiver.append(np.array([rh_obj.Geometry.Location.X, rh_obj.Geometry.Location.Y, rh_obj.Geometry.Location.Z]))\n\n            # Change the source\n            elif dict_key == \"Source\":\n                source = np.array([rh_obj.Geometry.Location.X, rh_obj.Geometry.Location.Y, rh_obj.Geometry.Location.Z])\n\n            # Plane Center Point\n            elif dict_key == \"Center_pt\":\n                cen_pt = np.array([rh_obj.Geometry.Location.X, rh_obj.Geometry.Location.Y, rh_obj.Geometry.Location.Z])\n                tmp_polygon_cen.append(cen_pt)\n\n            # Direction Line\n            # TODO Analytical Solution of this\n            elif dict_key == \"Direc_line\":\n                # Transform Curve into Polyline\n                tmp_polyline = rh_obj.Geometry.TryGetPolyline()\n                # Cache the Start Point and End Point\n                pt_list = []\n                # Get the Rhino start point and end point\n                rh_start_pt = tmp_polyline.PointAt(0)\n                rh_end_pt = tmp_polyline.PointAt(1)\n                # Numpy array point\n                start_pt = np.asarray([rh_start_pt.X, rh_start_pt.Y, rh_start_pt.Z])\n                end_pt = np.asarray([rh_end_pt.X, rh_end_pt.Y, rh_end_pt.Z])\n                # 2D Array\n                tmp_line = np.asarray([start_pt, end_pt])\n                tmp_direc_line.append(tmp_line)\n\n        assert source is not None\n        assert len(receiver) != 0\n        receiver = np.asarray(receiver)\n        tmp_polygon_cen = np.asarray(tmp_polygon_cen)\n        tmp_direc_line = np.asarray(tmp_direc_line)\n\n        # Correct the normal direction\n        direc_line = []\n        for cen_pt in tmp_polygon_cen:\n            for tmp_line in tmp_direc_line:\n                if (cen_pt == tmp_line[0]).all():\n                    direc_line.append(tmp_line)\n                    break\n                elif (cen_pt == tmp_line[1]).all():\n                    direc_line.append(np.asarray([tmp_line[1],tmp_line[0]]))\n                    break\n        direc_line = np.asarray(direc_line)\n\n        return model_dict, source, receiver, direc_line\n\n\nif __name__ == \"__main__\":\n    path = r\"C:\\\\Users\\\\李冠达\\\\Desktop\\\\Simulation\\\\Test_File\\\\Simple_Test.3dm\"\n    model = Read3dm(path)\n    a,b,c,d = model.convert_file()\n    print(f\"Direct line is {d}\")\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}