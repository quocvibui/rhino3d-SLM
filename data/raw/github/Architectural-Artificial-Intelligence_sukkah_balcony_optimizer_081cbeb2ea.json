{
  "source_url": "https://github.com/Architectural-Artificial-Intelligence/sukkah_balcony_optimizer/blob/9a5b2c405830837a9c56778fd08cab6d65513974/convertToRhinoRemoveInvalid.py",
  "repo": "Architectural-Artificial-Intelligence/sukkah_balcony_optimizer",
  "repo_stars": 0,
  "repo_description": null,
  "license": "MIT",
  "filepath": "convertToRhinoRemoveInvalid.py",
  "instruction": "Convert to rhino remove invalid",
  "code": "import sys \nimport json\nimport numpy as np\nfrom shapely import geometry, get_parts, unary_union, to_geojson\n\n\ndef fileWrite(f,txt):\n    f.seek(0,2)\n    f.write(txt+\"\\n\\r\")\n\n\ndef readFile(fileName):\n\n    input = open(fileName, 'r')\n    levels = json.load(input)\n    data = []\n    for level in levels:\n        poly = []\n        polygon = geometry.shape(json.loads(level))\n        data.append(polygon)\n    return data\n\ndef polygonRSformatter(points):\n\n    print(points)\n    l = len(points)-1\n\n    if points[0].x!= points[l].x or points[0].y!=points[l].y:\n        points= np.append(points, points[0])\n    ptsArr = []\n\n    for point in points:\n        ptsArr.append(\"(%s,%s,%s)\"%(point.x,point.y,point.z))\n    return ', '.join(ptsArr)\n\ndef setZ(pointsArray,z):\n    data = []\n    for pt in pointsArray:\n        pt.append(z)\n        data.append(pt)\n    return data\n\ndef computeLevel(topLevels, balcony):\n\n    level = []\n    # Get roof\n    try:\n        roof = unary_union(topLevels)\n    except:\n        print(\"unary_union failed with\") \n        return False;\n\n    try:\n        rest = balcony.difference(roof)\n\n    except:\n        print(\"difference failed with\") \n\n    \n    if not rest.length:\n        return False;\n    \n\n    bal = []\n    balconiesItems = get_parts(rest).tolist()\n    for balcony in balconiesItems:\n        if balcony.area>2000:\n            bal.append(balcony.area)\n    \n    if (len(bal) <= 0):\n        return False\n    \n    return balcony\n\n\n\nfilename = sys.argv[1]\n\nlevels = readFile('generated/'+filename+'.json')\n\n# remove invalid levels\n# start with roof\nnewBuilding = [levels[0:1:]]\n\n#  loop without roof\nfor index in range(len(levels) - 1):\n    topLevels = levels[0:index+1:]\n    building = levels[index+1]\n    \n    if computeLevel(topLevels,building):\n        print(\"Level \"+ str(index)+\" OK\")\n    else:\n        print(\"Level \"+ str(index)+\" Fail\")\n\n# f = open('generated/'+filename+'.py', 'w')\n# fileWrite(f,\"import rhinoscriptsyntax as rs\")\n# fileWrite(f, \"rs.EnableRedraw(False)\")\n# fileWrite(f, \"curves=[]\")\n\n# y = 0\n# z = 0\n\n# for level in newBuilding:\n#     data = to_geojson(level)\n#     print(\"--\")\n#     print(data[0])\n\n#     data= json.loads(data[0])\n#     print(data)\n    \n#     for polygons in data['coordinates']:\n\n#         # fileWrite(f, \"strPath = rs.AddLine([0,0,0], [0,0,-\"+str(z+3)+\"])\")\n#         fileWrite(f, \"strPath = rs.AddLine([0,0,0], [0,0,-300])\")\n\n#         if (hasattr(polygons[0][0], \"__len__\")):\n#             for polygon in polygons:\n#                 polygon = setZ(polygon, z)\n\n#                 fileWrite(f, \"curve\"+str(y)+\" = rs.AddPolyline(\"+json.dumps(polygon)+\")\")\n#                 # fileWrite(f, \"rs.RebuildCurve ( curve\"+str(y)+\", degree=3, point_count=10)\")\n#                 fileWrite(f, \"curves.append(curve\"+str(y)+\")\")\n#                 fileWrite(f, \"rs.AddPlanarSrf(curve\"+str(y)+\")\")\n#                 fileWrite(f, \"rs.ExtrudeCurve(curve\"+str(y)+\", strPath)\")\n#                 y+=1\n#         else:\n#             polygons = setZ(polygons, z)\n#             fileWrite(f, \"curve\"+str(y)+\" = rs.AddPolyline(\"+json.dumps(polygons)+\")\")\n#             # fileWrite(f, \"rs.RebuildCurve ( curve\"+str(y)+\", degree=3, point_count=10)\")\n#             fileWrite(f, \"curves.append(curve\"+str(y)+\")\")\n#             fileWrite(f, \"rs.AddPlanarSrf(curve\"+str(y)+\")\")\n#             fileWrite(f, \"rs.ExtrudeCurve(curve\"+str(y)+\", strPath)\")\n#             y+=1\n#     z=z+300\n\n# fileWrite(f, \"rs.EnableRedraw(True)\")\n\nf.close()",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}