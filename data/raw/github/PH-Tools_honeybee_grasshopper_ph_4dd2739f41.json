{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/shading/shade_create_bldg_shd.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/shading/shade_create_bldg_shd.py",
  "instruction": "GHCompo Interface: HBPH - Create Building Shading.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Create Building Shading.\"\"\"\n\ntry:\n    from typing import Collection, List, Optional, Tuple\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    import Rhino.Geometry as rg  # type: ignore\nexcept ImportError:\n    pass\n\ntry:\n    from honeybee import aperture, room\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee:\\n\\t{}\".format(e))\n\ntry:\n    from ladybug_rhino.fromgeometry import from_face3d\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from ladybug_geometry.geometry3d import Face3D\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_geometry:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph.properties.aperture import AperturePhProperties\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from ph_units.converter import convert\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ph_units:\\n\\t{}\".format(e))\n\n\ndef create_punched_geometry(_hb_rooms):\n    # type: (Collection[room.Room]) -> List[rg.Brep]\n    \"\"\"Return a list of all of the 'punched' surfaces from the HB-Model.\"\"\"\n\n    envelope_surfaces_punched = []\n    for hb_room in _hb_rooms:\n        for face in hb_room.faces:\n            rh_geom = from_face3d(face.punched_geometry)  # type: Optional[rg.Brep]\n\n            if rh_geom:\n                rh_geom.SetUserString(\"display_name\", face.display_name)\n                envelope_surfaces_punched.append(rh_geom)\n\n    return envelope_surfaces_punched\n\n\ndef create_inset_aperture_surface(_hb_aperture, _rh_units_name):\n    # type: (aperture.Aperture, str) -> Optional[rg.Brep]\n    \"\"\"Return Rhino.Geometry.Brep of an aperture's face, inset.\"\"\"\n    ap_prop_ph = _hb_aperture.properties.ph  # type: AperturePhProperties # type: ignore\n    ap_install_depth_in_m = ap_prop_ph.install_depth\n    ap_install_depth_in_r_units = convert(ap_install_depth_in_m, \"M\", _rh_units_name)\n    extrusion_vector = _hb_aperture.geometry.normal.reverse() * ap_install_depth_in_r_units\n    inset_face = from_face3d(_hb_aperture.geometry.move(extrusion_vector))  # type: Optional[rg.Brep]\n\n    if inset_face:\n        inset_face.SetUserString(\"display_name\", _hb_aperture.display_name)\n\n    return inset_face\n\n\ndef create_inset_aperture_surfaces(_hb_rooms, _rh_units_name):\n    # type: (Collection[room.Room], str) -> List[rg.Brep]\n    \"\"\"Return a list of aperture Rhino.Geometry.Brep surfaces, inset.\"\"\"\n\n    inset_window_surfaces = []\n    for room in _hb_rooms:\n        for face in room.faces:\n            for aperture in face.apertures:\n                inset_window_surfaces.append(create_inset_aperture_surface(aperture, _rh_units_name))\n    return inset_window_surfaces\n\n\ndef create_window_reveal(_hb_aperture, _rh_units_name):\n    # type: (aperture.Aperture, str) -> List[rg.Brep]\n    \"\"\"Return a list of the Aperture 'reveal' surfaces.\"\"\"\n\n    # -- Convert the Aperture's install depth (m) to Rhino units\n    try:\n        ap_prop_ph = _hb_aperture.properties.ph  # type: AperturePhProperties # type: ignore\n        ap_install_depth_in_m = ap_prop_ph.install_depth\n        ap_install_depth_in_r_units = convert(ap_install_depth_in_m, \"M\", _rh_units_name)\n    except Exception as e:\n        msg = \"Error converting Aperture's install depth to Rhino units: {}?\\t{}\".format(_rh_units_name, e)\n        raise Exception(msg)\n\n    # -- Extrude the aperture's edges to create the reveals\n    rhino_faces_ = []\n    extrusion_vector = _hb_aperture.normal.reverse() * ap_install_depth_in_r_units\n    if extrusion_vector.magnitude == 0:\n        return []\n\n    for seg in _hb_aperture.geometry.boundary_segments:\n        rhino_face = from_face3d(Face3D.from_extrusion(seg, extrusion_vector))\n        if rhino_face:\n            rhino_faces_.append(rhino_face)\n\n    return rhino_faces_\n\n\ndef create_window_reveals(_hb_rooms, _rh_units_name):\n    # type: (Collection[room.Room], str) -> List[rg.Brep]\n    \"\"\"Return a list of all the aperture 'reveals' in the Honeybee-Model\"\"\"\n\n    reveals = []\n    for room in _hb_rooms:\n        for face in room.faces:\n            for aperture in face.apertures:\n                reveals.extend(create_window_reveal(aperture, _rh_units_name))\n    return reveals\n\n\nclass GHCompo_CreateBuildingShading(object):\n    def __init__(self, _IGH, _hb_rooms):\n        # type: (gh_io.IGH, List[room.Room]) -> None\n        self.IGH = _IGH\n        self.hb_rooms = _hb_rooms\n\n    def run(self):\n        # type: () -> Tuple[List[rg.Brep], List[rg.Brep], List[room.Room]]\n\n        rh_units_name = self.IGH.get_rhino_unit_system_name()\n        shading_surfaces_ = []\n        shading_surfaces_.extend(create_punched_geometry(self.hb_rooms))\n        shading_surfaces_.extend(create_window_reveals(self.hb_rooms, rh_units_name))\n\n        window_surfaces_ = create_inset_aperture_surfaces(self.hb_rooms, rh_units_name)\n        hb_rooms_ = self.hb_rooms\n\n        return (window_surfaces_, shading_surfaces_, hb_rooms_)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}