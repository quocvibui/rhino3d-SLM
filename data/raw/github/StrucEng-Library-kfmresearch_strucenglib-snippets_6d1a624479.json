{
  "source_url": "https://github.com/StrucEng-Library-kfmresearch/strucenglib-snippets/blob/2e4b498eaa5b2928c1766e9ed99bf6493e5fe056/strucenglib/standalone/standalone_area_load_generator.py",
  "repo": "StrucEng-Library-kfmresearch/strucenglib-snippets",
  "repo_stars": 1,
  "repo_description": "StrucEng Library (snippets) for Rhinoceros",
  "license": "unknown",
  "filepath": "strucenglib/standalone/standalone_area_load_generator.py",
  "instruction": "Standalone area load generator",
  "code": " \r\nimport rhinoscriptsyntax as rs\r\nfrom compas_fea.structure import Structure\r\nfrom compas_fea.cad import rhino\r\nfrom compas.geometry import scale_vector\r\nfrom compas.geometry import add_vectors\r\nimport Rhino\r\nimport scriptcontext\r\nimport System.Guid, System.Drawing.Color\r\n\r\n\r\n\r\ndef area_load_generator(mdl, layer, assoc_load_layer=None, fx=0, fy=0, fz=0, mx=0, my=0, mz=0, scale=1.0):\r\n    \r\n    numbers_of_loaded_nodes=0\r\n\r\n    # Preapre for grafical oputput\r\n\r\n    v = scale_vector([fx, fy, fz], -scale * 0.001)\r\n    \r\n    # check associated layer  (Ein Layer von mehrer in einer ebene liegende Layer genuegt)\r\n   \r\n    guid_assoc_load_layer= rs.ObjectsByLayer(assoc_load_layer)\r\n    vertices = rs.MeshVertices(guid_assoc_load_layer)\r\n    vertice_lauf=-1\r\n    vertice_save=[]\r\n    for vertice in vertices:\r\n        vertice_save.append(vertice[2])\r\n    \r\n    if vertice_lauf>0:\r\n        if vertice_save[vertice_lauf-1]==vertice_save[vertice_lauf]:\r\n            pass\r\n        else:\r\n            print('load generator for inclined meshes or meshes in x,y plane is not implemented')\r\n\r\n    vertice_check=vertice_save[0]\r\n    R_tol=10\r\n\r\n    # Layer with curve which define the loaded area\r\n    load_layer=layer \r\n    \r\n    # Create layername with loaded nodes\r\n    load_layer_nodes=load_layer+'_loaded_nodes'\r\n    load_layer_nodes_arrows=load_layer+'_loaded_nodes_arrows'\r\n    # extract all points from all associated layers\r\n    rs.Command('_ExtractPt _Selmesh _Enter')\r\n\r\n    # set current layer to load_layewr\r\n    rs.CurrentLayer(load_layer)\r\n\r\n    # Select layer with polycon\r\n    rec=rs.ObjectsByLayer(load_layer)\r\n    \r\n    # Definition of the new layer with arrows\r\n    if rs.IsLayer(load_layer_nodes_arrows):\r\n        rs.PurgeLayer(load_layer_nodes_arrows)\r\n        scriptcontext.doc.Layers.Add(load_layer_nodes_arrows, System.Drawing.Color.Black)\r\n        rs.CurrentLayer(load_layer_nodes_arrows)\r\n    else:\r\n        scriptcontext.doc.Layers.Add(load_layer_nodes_arrows, System.Drawing.Color.Black)\r\n        rs.CurrentLayer(load_layer_nodes_arrows)    \r\n\r\n    # Definition of the new layer with the loaded nodes\r\n    if rs.IsLayer(load_layer_nodes):\r\n        rs.PurgeLayer(load_layer_nodes)\r\n        scriptcontext.doc.Layers.Add(load_layer_nodes, System.Drawing.Color.Black)\r\n        rs.CurrentLayer(load_layer_nodes)\r\n    else:\r\n        scriptcontext.doc.Layers.Add(load_layer_nodes, System.Drawing.Color.Black)\r\n        rs.CurrentLayer(load_layer_nodes)\r\n\r\n    \r\n\r\n    # Filter and save all control points inside polycon\r\n    points=[]\r\n    coor_x=[]\r\n    coor_y=[]\r\n    coor_z=[]\r\n    selectpt = rs.ObjectsByType(rs.filter.point)\r\n\r\n    i_lauf=-1\r\n    test_lauf=0\r\n    for i in selectpt:\r\n        points.append(i)\r\n        i_lauf=i_lauf+1\r\n\r\n        insidept = rs.PointInPlanarClosedCurve(points[i_lauf],rec, plane=None, tolerance=10)\r\n        if insidept==0:\r\n            #print(\"The point is NOT inside the closed surve\") \r\n            pass\r\n        else: \r\n            #print (\"The point is on the closed curve.\")\r\n            #test_lauf=test_lauf+1\r\n            coor=rs.PointCoordinates(i)\r\n            # if coor[0] in coor_x and coor[1] in coor_y and coor[2] in coor_z\r\n               # print(\"The object already exists.\")\r\n               # pass            \r\n            #else:\r\n            if vertice_check>=coor[2]-R_tol and vertice_check<coor[2]+R_tol:\r\n                #print(\"The object does not exist.\")\r\n                numbers_of_loaded_nodes=numbers_of_loaded_nodes+1\r\n                rs.CurrentLayer(load_layer_nodes)    \r\n                coor_x.append(coor[0])\r\n                coor_y.append(coor[1])\r\n                coor_z.append(coor[2])\r\n                coorx=coor[0]\r\n                coory=coor[1]\r\n                coorz=coor[2]\r\n                xyz=[coorx, coory, coorz]\r\n                rs.AddPoint( (coorx,coory,coorz) )\r\n                   \r\n                rs.CurrentLayer(load_layer_nodes_arrows) \r\n                line = rs.AddLine(xyz, add_vectors(xyz, v))\r\n                rs.CurveArrows(line, 1)\r\n                rs.CurrentLayer(load_layer_nodes) \r\n            else:\r\n                pass\r\n                \r\n                            \r\n    rs.Command('_Delete') # Del selected control point\r\n    \r\n    return load_layer_nodes, numbers_of_loaded_nodes",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}