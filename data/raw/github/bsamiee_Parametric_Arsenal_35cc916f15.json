{
  "source_url": "https://github.com/bsamiee/Parametric_Arsenal/blob/54ec3f5a7fc2c671cb7bc4601772820e625a1904/rhino/plugins/ArchBuilder/commands/FourCenterArch.py",
  "repo": "bsamiee/Parametric_Arsenal",
  "repo_stars": 0,
  "repo_description": "Rhino 8 Plugins and Scripts - A comprehensive monorepo for architectural automation, parametric design, and creative workflows",
  "license": "MIT",
  "filepath": "rhino/plugins/ArchBuilder/commands/FourCenterArch.py",
  "instruction": "Title         : FourCenterArch.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/ArchBuilder/commands/FourCenterArch.py",
  "code": "# r: numpy\n\"\"\"\nTitle         : FourCenterArch.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/ArchBuilder/commands/FourCenterArch.py\n\nDescription\n----------------------------------------------------------------------------\nCommand for creating four-center (depressed) arches.\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import Any\n\nimport Rhino.Geometry as rg\nfrom libs.command_base import ArchCommandBase\nfrom libs.geometry.profiles import ProfileSegments, four_center_profile\nfrom libs.solvers import solve_four_center_parameters\nfrom libs.specs import ArchFamily, ArchSpec, FourCenterArchOptions\nfrom libs.ui import ProfileSelection\nfrom libs.utils import ArchBuilderUtils\n\nimport Rhino\n\n\n# --- Four-Center Command Class --------------------------------------------\nclass FourCenterArchCommand(ArchCommandBase):\n    \"\"\"Four-center arch command using traditional geometric proportions.\"\"\"\n\n    options_type = FourCenterArchOptions\n\n    def __init__(self) -> None:\n        super().__init__(ArchFamily.FOUR_CENTER, self.build_four_center)\n\n    def collect_parameters(self, profile: ProfileSelection) -> dict[str, Any] | None:\n        \"\"\"Calculate traditional four-center arch proportions from geometry.\"\"\"\n        tolerance = ArchBuilderUtils.model_absolute_tolerance()\n        default_options = self.options_type.from_geometry(profile.span, profile.rise)\n\n        try:\n            params = solve_four_center_parameters(\n                profile.span,\n                profile.rise,\n                shoulder_ratio=default_options.shoulder_ratio,\n                shoulder_height_ratio=default_options.shoulder_height_ratio,\n                tolerance=tolerance,\n            )\n        except ValueError as exc:\n            raise RuntimeError(\n                \"Unable to derive four-center proportions for the selected opening \"\n                f\"(span={profile.span:.3f}, rise={profile.rise:.3f}): {exc}\"\n            ) from exc\n\n        half_span = profile.span * 0.5\n        shoulder_ratio = params.tangent_x / half_span if half_span else default_options.shoulder_ratio\n        shoulder_height_ratio = (\n            params.tangent_y / profile.rise if profile.rise else default_options.shoulder_height_ratio\n        )\n\n        clamped_ratio = max(0.05, min(0.95, shoulder_ratio))\n        clamped_height = max(0.2, min(0.95, shoulder_height_ratio))\n\n        if (\n            abs(clamped_ratio - default_options.shoulder_ratio) > 1e-3\n            or abs(clamped_height - default_options.shoulder_height_ratio) > 1e-3\n        ):\n            Rhino.RhinoApp.WriteLine(\n                \"ArchBuilder: adjusted four-center shoulder parameters to \"\n                f\"sr={clamped_ratio:.3f}, sh={clamped_height:.3f} to satisfy geometry.\"\n            )\n\n        options = self.options_type(\n            shoulder_ratio=clamped_ratio,\n            shoulder_height_ratio=clamped_height,\n        )\n        return options.to_metadata()\n\n    def build_four_center(self, spec: ArchSpec) -> rg.Curve:\n        \"\"\"Return the closed four-center profile for the requested spec.\"\"\"\n        tolerance = ArchBuilderUtils.model_absolute_tolerance()\n        options = self.options_type.from_metadata(spec.metadata)\n\n        try:\n            profile: ProfileSegments = four_center_profile(\n                spec.span,\n                spec.rise,\n                options,\n                tolerance,\n            )\n        except ValueError as exc:\n            raise RuntimeError(\n                \"Failed to construct four-center profile with resolved parameters \"\n                f\"(span={spec.span:.3f}, rise={spec.rise:.3f}): {exc}\"\n            ) from exc\n        return ArchBuilderUtils.close_with_baseline(\n            profile.segments,\n            profile.start,\n            profile.end,\n            tolerance,\n        )\n\n\n# --- Command Entry Points -------------------------------------------------\ndef FourCenterArch() -> None:\n    \"\"\"Execute the FourCenterArch command.\"\"\"\n    command = FourCenterArchCommand()\n    if command.execute():\n        Rhino.RhinoApp.WriteLine(\"ArchBuilder: FourCenterArch created.\")\n\n\ndef RunCommand(is_interactive: bool) -> int:\n    try:\n        FourCenterArch()\n        return 0  # noqa: TRY300\n    except RuntimeError as exc:\n        Rhino.RhinoApp.WriteLine(f\"ArchBuilder cancelled: {exc}\")\n        return 0\n\n\nif __name__ == \"__main__\":\n    FourCenterArch()\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}