{
  "source_url": "https://discourse.mcneel.com/t/a-bug-in-addrevsrf/26248",
  "topic_id": 26248,
  "title": "A bug in AddRevSrf?",
  "question": "Hi,\n\n\nI appear to have run into a bug in AddRevSurf. Here is how to reproduce: open \nbadRevolveExample.3dm\n (28.1 KB). Then run the following script, which creates (what should be) the same revolved surface via a macro and via AddRevSrf, and a simple sphere.\n\n\nNow if you try to eg BooleanSplit the sphere with the surface created via the macro, it works fine. However, if you try the same thing using the surface generated by AddRevSrf, the split fails - the surface appears to have some subtle issue.\n\n\nIs this a bug or am I missing something?\n\n\nThanks a lot,\n\nEgor\n\n\nimport rhinoscriptsyntax as rs\n\nrevline=rs.ObjectsByName(\"_revline\")\n\n# create a revolved surface via AddRevSrf\naxis=rs.AddLine([0,0,0],[0,0,1])\nsurf1=rs.AddRevSrf(revline,axis)\nrs.ObjectLayer(surf1,rs.AddLayer(\"AddRevSrf\"))\n\n# create another via a macro\nrs.Command(\"SelNone\")\nrs.SelectObject(revline)\nrs.Command(\"Revolve 0 Enter Enter Enter SelNone SelLast\")\nrs.UnselectObject(revline)\nsurf2=rs.SelectedObjects()\nsurf2=surf2[0]\nrs.ObjectLayer(surf2,rs.AddLayer(\"macro\"))\n\nsphere=rs.AddSphere([0,0,0],20)",
  "code_blocks": [
    {
      "code": "import math\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext\n\ndef AddRevSrfEx(curve_id, axis, start_angle=0.0, end_angle=360.0):\n    curve = rs.coercecurve(curve_id, -1, True)\n    axis = rs.coerceline(axis, True)\n    start_angle = math.radians(start_angle)\n    end_angle = math.radians(end_angle)\n    srf = Rhino.Geometry.RevSurface.Create(curve, axis, start_angle, end_angle)\n    if not srf: return scriptcontext.errorhandler()\n    ns = srf.ToNurbsSurface()\n    if not ns: return scriptcontext.errorhandler()\n    rc = scriptcontext.doc.Objects.AddSurface(ns)\n    scriptcontext.doc.Views.Redraw()\n    return rc",
      "language": "python",
      "author": "dale",
      "post_number": 3,
      "is_solution": false
    },
    {
      "code": "import Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext\n\ndef OffsetSrf(distance, tolerance=None, both_sides=False, create_solid=False):\n    brep = rs.coercebrep(id, True)\n    face = None\n    if (1 == brep.Faces.Count): face = brep.Faces[0]\n    if face is None: return scriptcontext.errorhandler()\n    if tolerance is None: tolerance = scriptcontext.doc.ModelAbsoluteTolerance\n    newbrep = Rhino.Geometry.Brep.CreateFromOffsetFace(\n                face, distance, tolerance, both_sides, create_solid)\n    \n    scriptcontext.doc.Objects.AddBrep(newbrep)\n    scriptcontext.doc.Views.Redraw()\n    \nif __name__==\"__main__\":\n    id = rs.GetObject(\"surface to offset\", 8, True, False)\n    if id:\n        OffsetSrf(distance=10, both_sides=False, create_solid=True)",
      "language": "python",
      "author": "clement",
      "post_number": 5,
      "is_solution": false
    },
    {
      "code": "import rhinoscriptsyntax as rs\n\nsrf=rs.ObjectsByName(\"test\")\n# This call fails\noffsetSrf=rs.OffsetSurface(surface_id=srf,distance=2,create_solid=True)\n# This one succeeds\nrs.Command(\"_SelNone\")\nrs.SelectObject(srf)\nrs.Command(\"_OffsetSrf _Distance 2 _Enter\")\nrs.Command(\"_SelLast\")\ntmp=rs.SelectedObjects()",
      "language": "python",
      "author": "ZmeiGorynych",
      "post_number": 6,
      "is_solution": false
    },
    {
      "code": "import rhinoscriptsyntax as rs\n\nrevline=rs.ObjectsByName(\"_revline\")\n\n# create a revolved surface via AddRevSrf\naxis=rs.AddLine([0,0,0],[0,0,1])\nsurf1=rs.AddRevSrf(revline,axis)\nrs.ObjectLayer(surf1,rs.AddLayer(\"AddRevSrf\"))\n\n# create another via a macro\nrs.Command(\"SelNone\")\nrs.SelectObject(revline)\nrs.Command(\"Revolve 0 Enter Enter Enter SelNone SelLast\")\nrs.UnselectObject(revline)\nsurf2=rs.SelectedObjects()\nsurf2=surf2[0]\nrs.ObjectLayer(surf2,rs.AddLayer(\"macro\"))\n\nsphere=rs.AddSphere([0,0,0],20)",
      "language": "python",
      "author": "ZmeiGorynych",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "file-io",
    "geometry",
    "layers",
    "nurbs",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "selection"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 9,
  "views": 1693
}