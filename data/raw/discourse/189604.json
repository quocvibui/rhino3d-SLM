{
  "source_url": "https://discourse.mcneel.com/t/use-the-progress-bar-in-a-python-script/189604",
  "topic_id": 189604,
  "title": "Use the progress bar in a Python script",
  "question": "I have written a python script that exports thousands of objects to ai files and it takes a few minutes.  I’d like to use the progress bar in my script, but I can’t quite seem to get it to work. Would anyone have a small example script of how I can show progress of a python script?  Thanks.",
  "code_blocks": [
    {
      "code": "import Rhino\nimport scriptcontext as sc\nimport System\n\ndef test_progressbar():\n    sn = sc.doc.RuntimeSerialNumber\n    min = 0\n    max = 100\n    percent = False\n    Rhino.UI.StatusBar.ShowProgressMeter(sn, min, max, \"Starting\", True, percent)\n    for i in range(min, max + 1):\n        Rhino.RhinoApp.Wait()\n        System.Threading.Thread.Sleep(100)\n        if i == 10:\n            Rhino.UI.StatusBar.UpdateProgressMeter(\"Calculating\", i, True)\n        elif i == 50:\n            Rhino.UI.StatusBar.UpdateProgressMeter(\"Processing\", i, True)\n        elif i == 90:\n            Rhino.UI.StatusBar.UpdateProgressMeter(\"Finishing\", i, True)\n        else:\n            Rhino.UI.StatusBar.UpdateProgressMeter(i, True)\n    System.Threading.Thread.Sleep(750) #ms\n    Rhino.UI.StatusBar.HideProgressMeter(sn)\n\nif __name__ == \"__main__\":\n    test_progressbar()",
      "language": "python",
      "author": "dale",
      "post_number": 2,
      "is_solution": false
    },
    {
      "code": "import Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport re\nimport os\nfrom fractions import Fraction\n\n_nsre = re.compile('([0-9]+)')\ndef natural_sort_key(s):\n    return [int(text) if text.isdigit() else text.lower()\n        for text in re.split(_nsre, s)]   \n\ndef test():\n    categories = {}\n\n    max = 0\n    ids = rs.AllObjects()\n    for id in ids:\n        if rs.IsText(id):\n            text = rs.TextObjectText(id)\n            idx = text.find(\"-\")\n            if idx != -1:\n                name = text[:idx-1]\n                rs.ObjectName(id, name)\n                cat = rs.GetUserText(id, 'Cat')\n                subcat = rs.GetUserText(id, 'SubCat')\n                max = max + 1\n                if not cat:\n                    rs.MessageBox(text + ' does not have a Cat tag.')\n                if not subcat:\n                    subcat = '---'\n                if cat:\n                    if not categories.has_key(cat):\n                        categories[cat] = {}\n                    if not categories[cat].has_key(subcat):\n                        categories[cat][subcat] = [id]\n                    else:\n                        categories[cat][subcat].append(id)\n\n    Rhino.UI.StatusBar.ShowProgressMeter(sc.doc.RuntimeSerialNumber, 0, max, \"Processing\", True, True)\n\n    count = 0\n    csv_txt = 'Category,Subcategory,Order,Filename,Profile Name,Height,Width\\n';    \n\n    rs.EnableRedraw(True)\n    export_root = rs.WorkingFolder() + \"/exports\"\n\n    # loop over each category\n    for cat in categories:\n        for subcat in categories[cat]:\n            ids = categories[cat][subcat]\n            if not ids: return\n\n            dict = {}\n            distances = []\n   \n            names = set([rs.ObjectName(id) for id in ids])\n            for name in names:\n                # parse the text object text to get the long dimension then sort by that number\n                ids = rs.ObjectsByName(name)\n                if not ids: continue\n                if len(ids) != 2: continue\n                bb = rs.BoundingBox(ids)\n                for id in ids:\n                    if rs.IsText(id):\n                        text = rs.TextObjectText(id).splitlines()[0]\n                        # get the last element in the split array, don't read the last character either\n                        widthText = text.split(\"x \")[-1][:-1]\n                        dist = float(sum(Fraction(s) for s in widthText.split()))\n                if dict.has_key(dist):\n                    temp = dict[dist]\n                    temp = temp + \",\" + name\n                else:\n                    temp = name\n                dict[dist] = temp\n    \n            partList = sorted(dict.keys())\n\n            # for now, we just prompt the user for a category and subcategory name, later we can put these in the attributes on each text object instead\n            export_folder = export_root\n\n            units = rs.UnitSystemName()\n            for item in partList:\n                test = dict[item]\n                names = dict[item].split(\",\")\n                names.sort(key=natural_sort_key)\n                for name in names:\n                    ids = rs.ObjectsByName(name)\n                    fileName = str(count) + \"_\" + name + \".ai\"\n                    if not ids: continue\n                    if len(ids) != 2: continue\n                    bb = rs.BoundingBox(ids)\n                    vecDir  = Rhino.Geometry.Point3d(0,0,0) - bb[0]\n                    rs.MoveObjects(ids, vecDir)\n                    rs.UnselectAllObjects()\n                    rs.SelectObjects(ids)\n\n                    if not os.path.exists(export_folder):\n                        os.makedirs(export_folder)\n                    rs.Command(\"-Export \" + chr(34) + export_folder + \"/\" + fileName  + chr(34) + \" PreserveUnits=Yes  AIScale=1  Unit=\" + units + \"  RhinoScale=1  Enter\")\n                    vecDir.Reverse()\n                    rs.MoveObjects(ids, vecDir)\n                    count = count + 1\n                    w = h = 0\n                    # we need to check the 2 objects to find out which is the text label\n                    for id in ids:\n                        if rs.IsText(id):\n                            # we found the text so let's break out the width and height values\n                            text = rs.TextObjectText(id)\n                            idx = text.find(\" - \")\n                            if idx != -1:\n                                dimension_str = text[idx+3:]\n                                w = dimension_str.split(\" x \")[1][:-1]\n                                h = dimension_str.split(\" x \")[0][:-1]\n                    csv_txt += cat + ',' + subcat + ',' + str(count) + ',\"' + fileName + '\",\"' + name + '\",' + str(h) + ',' + str(w) + '\\n'\n\n            Rhino.UI.StatusBar.UpdateProgressMeter(\"Processing\", count, True)\n#     Rhino.UI.StatusBar.UpdateProgressMeter(count, True)\n\n    rs.EnableRedraw(True)\n\n    Rhino.UI.StatusBar.HideProgressMeter(sc.doc.RuntimeSerialNumber)\n\n    # write out the CSV string to the target CSV file\n    file = open(export_root + \"/indesign_data.csv\", \"w\") \n    file.write(csv_txt)\n    file.close()\n\nif __name__ == \"__main__\":\n    test()",
      "language": "python",
      "author": "dustin",
      "post_number": 3,
      "is_solution": false
    },
    {
      "code": "import Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport re\nimport os\nimport os.path as op\nfrom fractions import Fraction\n\n_nsre = re.compile('([0-9]+)')\ndef natural_sort_key(s):\n    return [int(text) if text.isdigit() else text.lower()\n        for text in re.split(_nsre, s)]   \n\ndef test():\n    categories = {}\n\n    max = 0\n    ids = rs.AllObjects()\n    for obj_id in ids:\n        if rs.IsText(obj_id):\n            text = rs.TextObjectText(obj_id)\n            idx = text.find(\"-\")\n            if idx != -1:\n                name = text[:idx-1]\n                rs.ObjectName(obj_id, name)\n                cat = rs.GetUserText(obj_id, 'Cat')\n                subcat = rs.GetUserText(obj_id, 'SubCat')\n                max = max + 1\n                if not cat:\n                    rs.MessageBox(text + ' does not have a Cat tag.')\n                if not subcat:\n                    subcat = '---'\n                if cat:\n                    if cat not in categories:\n                        categories[cat] = {}\n                    if subcat not in categories[cat]:\n                        categories[cat][subcat] = [obj_id]\n                    else:\n                        categories[cat][subcat].append(obj_id)\n\n    Rhino.UI.StatusBar.ShowProgressMeter(sc.doc.RuntimeSerialNumber, 0, max, \"Processing\", True, True)\n\n    count = 0\n    csv_txt = 'Category,Subcategory,Order,Filename,Profile Name,Height,Width\\n';    \n\n    rs.EnableRedraw(False)\n    export_dir = op.dirname(__file__)\n    export_root = op.join(export_dir, \"exports\")\n    if not op.exists(export_root):\n        os.makedirs(export_root)\n\n    # loop over each category\n    for cat in categories:\n        for subcat in categories[cat]:\n            ids = categories[cat][subcat]\n            if not ids: return\n\n            dict = {}\n            distances = []\n   \n            names = set([rs.ObjectName(obj_id) for obj_id in ids])\n            for name in names:\n                # parse the text object text to get the long dimension then sort by that number\n                ids = rs.ObjectsByName(name)\n                if not ids: continue\n                if len(ids) != 2: continue\n                bb = rs.BoundingBox(ids)\n                for obj_id in ids:\n                    if rs.IsText(obj_id):\n                        text = rs.TextObjectText(obj_id).splitlines()[0]\n                        # get the last element in the split array, don't read the last character either\n                        widthText = text.split(\"x \")[-1][:-1]\n                        dist = float(sum(Fraction(s) for s in widthText.split()))\n                if dict.has_key(dist):\n                    temp = dict[dist]\n                    temp = temp + \",\" + name\n                else:\n                    temp = name\n                dict[dist] = temp\n    \n            partList = sorted(dict.keys())\n\n            # for now, we just prompt the user for a category and subcategory name, later we can put these in the attributes on each text object instead\n            export_folder = export_root\n\n            units = rs.UnitSystemName()\n            for item in partList:\n                test = dict[item]\n                names = dict[item].split(\",\")\n                names.sort(key=natural_sort_key)\n                for name in names:\n                    ids = rs.ObjectsByName(name)\n                    fileName = str(count) + \"_\" + name + \".ai\"\n                    if not ids: continue\n                    if len(ids) != 2: continue\n                    bb = rs.BoundingBox(ids)\n                    vecDir  = Rhino.Geometry.Point3d(0,0,0) - bb[0]\n                    rs.MoveObjects(ids, vecDir)\n                    rs.UnselectAllObjects()\n                    rs.SelectObjects(ids)\n\n                    if not os.path.exists(export_folder):\n                        os.makedirs(export_folder)\n                    rs.Command(\"-Export \" + chr(34) + export_folder + \"/\" + fileName  + chr(34) + \" PreserveUnits=Yes  AIScale=1  Unit=\" + units + \"  RhinoScale=1  Enter\")\n                    vecDir.Reverse()\n                    rs.MoveObjects(ids, vecDir)\n                    count = count + 1\n                    w = h = 0\n                    # we need to check the 2 objects to find out which is the text label\n                    for obj_id in ids:\n                        if rs.IsText(obj_id):\n                            # we found the text so let's break out the width and height values\n                            text = rs.TextObjectText(obj_id)\n                            idx = text.find(\" - \")\n                            if idx != -1:\n                                dimension_str = text[idx+3:]\n                                w = dimension_str.split(\" x \")[1][:-1]\n                                h = dimension_str.split(\" x \")[0][:-1]\n                    csv_txt += cat + ',' + subcat + ',' + str(count) + ',\"' + fileName + '\",\"' + name + '\",' + str(h) + ',' + str(w) + '\\n'\n\n            Rhino.UI.StatusBar.UpdateProgressMeter(\"Processing\", count, True)\n    Rhino.UI.StatusBar.UpdateProgressMeter(count, True)\n\n    rs.EnableRedraw(True)\n\n    Rhino.UI.StatusBar.HideProgressMeter(sc.doc.RuntimeSerialNumber)\n\n    # write out the CSV string to the target CSV file\n    with open(op.join(export_root, \"indesign_data.csv\"), \"w\") as f:\n        f.write(csv_txt)\n\nif __name__ == \"__main__\":\n    test()",
      "language": "python",
      "author": "eirannejad",
      "post_number": 4,
      "is_solution": false
    },
    {
      "code": "import rhinoscriptsyntax as rs\nfrom Rhino import RhinoApp\n\nMAX = 1000\nrs.StatusBarProgressMeterShow(\"Progress\", 0, MAX)\n\nfor i in range(0, MAX):\n    rs.StatusBarProgressMeterUpdate(i)\n    RhinoApp.Wait()\n\nrs.StatusBarProgressMeterHide()",
      "language": "python",
      "author": "eirannejad",
      "post_number": 4,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "transformation",
    "ui"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 5,
  "views": 492
}