{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_DataCache.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_DataCache.py",
  "instruction": "Caches some Data by storing it as Persistent Data (aka internalising it) in a connected Param.\n    Inputs:\n        LiveData: The Data that should be cached (internalised) {tree, data}\n       ...",
  "code": "\"\"\"\nCaches some Data by storing it as Persistent Data (aka internalising it) in a connected Param.\n    Inputs:\n        LiveData: The Data that should be cached (internalised) {tree, data}\n        CachedData: Connect a Data Param here where the Data can be internalised {list, data}\n        Toggle: If True, Data will be cached by internalising it into the Param connected to IntData. {item, boolean}\n    Outputs:\n        Data: If Toggle is True the internalised Data, otherwise the incoming Live-Data {list, data}}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200705\n\"\"\"\nghenv.Component.Name = \"DataCache\"\nghenv.Component.NickName = \"DC\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"10 Utilities\"\n\n# GHPYTHON SDK MODE IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# CUSTOM IMPORTS\nfrom scriptcontext import sticky as st\n\nclass DataCache(component):\n    \n    def RunScript(self, LiveData, CachedData, Toggle):\n        \n        # get the gh document\n        ghDoc = ghenv.Component.OnPingDocument()\n        \n        # get the guid of this instance to ensure private sticky entries\n        ig = self.InstanceGuid\n        \n        # define a marker for the state of caching/internalisation\n        Flag = str(ig) + \"___INTERNALISEDFLAG\"\n        if not Flag in st:\n            if CachedData:\n                st[Flag] = True\n            else:\n                st[Flag] = None\n        \n        # PARAM HANDLING -------------------------------------------------------\n        LiveDataParam = ghenv.Component.Params.Input[0]\n        CachedDataParam = ghenv.Component.Params.Input[1]\n        \n        # try to get the connected param, otherwise set a warning and return\n        if CachedDataParam.Sources:\n            CachedSrc = CachedDataParam.Sources[0]\n        else:\n            rmlevel = self.RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(rmlevel, \"Please connect a Data\" +\n                                              \" Param to the IntData input!\")\n            return None\n        \n        \n        # HANDLING OF CACHED DATA ----------------------------------------------\n        if CachedData and Toggle:\n            for i, D in enumerate(CachedData):\n                if D == str(ig) + \"___NONE___\":\n                    CachedData[i] = None\n            self.Message = \"Streaming CachedData\"\n            Data = CachedData\n            return Data\n        else:\n            self.Message = \"Streaming LiveData\"\n            Data = LiveData\n        \n        \n        # CACHING OF DATA ------------------------------------------------------\n        if LiveData and Toggle and not st[Flag]:\n            # sanitize the none values\n            for i, D in enumerate(LiveData):\n                if D == None:\n                    LiveData[i] = str(ig) + \"___NONE___\"\n            # create a dotnet list and add all the data items to it\n            dList = System.Collections.Generic.List[object]()\n            [dList.Add(o) for o in LiveData]\n            # switch the marker and set message\n            st[Flag] = True\n            \n            # define delegate for adding persistent data between solutions\n            def sln_delegate(doc):\n                CachedSrc.Script_AddPersistentData(dList)\n                ghenv.Component.ExpireSolution(False)\n            \n            # schedule new solutin using the defined delegate\n            ghDoc.ScheduleSolution(1, sln_delegate)\n        \n        # # RESET OF CACHED DATA ON FALSE TOGGLE -------------------------------\n        elif Toggle == False:\n            if st[Flag] == True:\n                # set the marker\n                st[Flag] = None\n                # clear the persistent data and set message\n                CachedSrc.Script_ClearPersistentData()\n                # expire the solution so everything gets updated\n                CachedSrc.ExpireSolution(True)\n        \n        # return outputs if you have them; here I try it for you:\n        return Data",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}