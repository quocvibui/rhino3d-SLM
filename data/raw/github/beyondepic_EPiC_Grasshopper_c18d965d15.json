{
  "source_url": "https://github.com/beyondepic/EPiC_Grasshopper/blob/dbd60529a190cebf1d0af4d6c2e0ec91e110e388/epic/src/EPiC_Analysis_Component.py",
  "repo": "beyondepic/EPiC_Grasshopper",
  "repo_stars": 18,
  "repo_description": "EPiC Grasshopper plug-in",
  "license": "GPL-3.0",
  "filepath": "epic/src/EPiC_Analysis_Component.py",
  "instruction": "Calculates Embodied Environmental Flows and plots a stacked bar chart of the results, with the ability to generate a csv report\r\n\r\n    Inputs:\r\n\r\n        Analysis_Name: Name for the Analysis Report\r\n...",
  "code": "# -*- coding: UTF-8 -*-\r\n# EPiC Grasshopper: A Plugin for analysing embodied environmental flows\r\n#\r\n# Copyright (c) 2023, EPiC Grasshopper.\r\n# You should have received a copy of the GNU General Public License\r\n# along with EPiC Grasshopper; If not, see <http://www.gnu.org/licenses/>.\r\n#\r\n# Further information about the EPiC Database can be found at <https://bit.ly/EPiC_Database>\r\n# To download a full copy of the database, goto <http://doi.org/10.26188/5dc228ef98c5a>\r\n#\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\n\r\n\"\"\"\r\nCalculates Embodied Environmental Flows and plots a stacked bar chart of the results, with the ability to generate a csv report\r\n\r\n    Inputs:\r\n\r\n        Analysis_Name: Name for the Analysis Report\r\n        ***Optional***\r\n\r\n        **EPiC_Assemblies_or_Built_Assets: Input EPiC_Assembly and/or EPiC_Built_Asset items for built_assets\r\n        (**REQUIRED)\r\n\r\n        Comparison_Values_(EPiC_Assemblies): Input EPiC_Assembly items to compare (not shown in .csv report)\r\n        ***Optional***\r\n\r\n        Period_of_Analysis_(Years): The period of analysis to be used for calculations.\r\n        Default value of None - indicating that no recurrent calculations will be made.\r\n        ***Optional***\r\n\r\n        >>Connect_Button_to_Load_Analysis_Types: Connect and activate a button.\r\n        This will generate a dropdown list for the Analysis Type input\r\n\r\n        Analysis_Type: Input the type of built_assets to be used for graph visualisations.\r\n        Possible inputs include: 'total', 'by_material', 'by_assembly', or 'by_assembly_and_material'\r\n        Defaults to: 'total'\r\n        ***Optional***\r\n\r\n        Graph_Origin_Point: Specify the origin point for graph visualisations. Defaults to 0,0,0.\r\n        ***Optional***\r\n\r\n        Graph_Scale: Specify the scale of the graph visualisations. 1=normal size, 0.5=half size, 2=double size\r\n        ***Optional***\r\n\r\n        csv_Folder_location: Folder location for generation of a csv report. Use the 'path' object in grasshopper\r\n        (**REQUIRED for report generation)\r\n\r\n        >>Connect_Button_to_Generate_csv: Connect a Button to Generate the csv. report\r\n\r\n    Outputs:\r\n        Detailed_Report_Information: Detailed report information\r\n        ***Connect that output to a panel for a summary***\r\n\r\n        Graph_Outputs: Outputs a list of bakeable geometry for the graph visualisation\r\n\r\n        Output_Breakdown: Text detailing the flow outputs, depending on the analysis type.\r\n        For 'by_assembly_and_by_material' this will be a nested list\r\n\r\n        Initial_Embodied_Energy_(MJ): Initial Embodied Energy (MJ)\r\n        This includes wastage\r\n\r\n        Initial_Wastage_Embodied_Energy_(MJ): Initial Wastage Embodied Energy (MJ)\r\n\r\n        Recurrent_Embodied_Energy_(MJ): Recurrent Embodied Energy (MJ)\r\n        This includes wastage\r\n\r\n        Recurrent_Wastage_Embodied_Energy_(MJ): Recurrent Wastage Embodied Energy (MJ)\r\n\r\n        Life_Cycle_Embodied_Energy_(MJ): Life Cycle Embodied Energy (MJ)\r\n        This includes initial, recurrent, and wastage flows\r\n\r\n        Life_Cycle_Wastage_Embodied_Energy_(MJ): Life Cycle Wastage Embodied Energy (MJ)\r\n\r\n        Initial_Embodied_Water_(L): Initial Embodied Water (L)\r\n        This includes wastage\r\n\r\n        Initial_Wastage_Embodied_Water_(L): Initial Wastage Embodied Water (L)\r\n\r\n        Recurrent_Embodied_Water_(L): Recurrent Embodied Water (L)\r\n        This includes wastage\r\n\r\n        Recurrent_Wastage_Embodied_Water_(L): Recurrent Wastage Embodied Water (L)\r\n\r\n        Life_Cycle_Embodied_Water_(L): Life Cycle Embodied Water (L)\r\n        This includes initial, recurrent, and wastage flows\r\n\r\n        Life_Cycle_Wastage_Embodied_Water_(L): Life Cycle Wastage Embodied Water (L)\r\n\r\n        Initial_Embodied_GHG_(kgCO₂e): Initial Embodied GHG (kgCO₂e)\r\n        This includes wastage\r\n\r\n        Initial_Wastage_Embodied_GHG_(kgCO₂e): Initial Wastage Embodied GHG (kgCO₂e)\r\n\r\n        Recurrent_Embodied_GHG_(kgCO₂e): Recurrent Embodied GHG (kgCO₂e)\r\n        This includes wastage\r\n\r\n        Recurrent_Wastage_Embodied_GHG_(kgCO₂e): Recurrent Wastage Embodied GHG (kgCO₂e)\r\n\r\n        Life_Cycle_Embodied_GHG_(kgCO₂e): Life Cycle Embodied GHG (kgCO₂e)\r\n        This includes initial, recurrent, and wastage flows\r\n\r\n        Life_Cycle_Wastage_Embodied_GHG_(kgCO₂e): Life Cycle Wastage Embodied GHG (kgCO₂e)\r\n\r\n        Geometry_by_Assembly: A collection of all selected geometries for each EPiC Assembly (including within EPiC Built Assets)\r\n\r\n\"\"\"\r\n\r\nimport os.path as path\r\nfrom collections import OrderedDict\r\n\r\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\r\nimport Grasshopper.Kernel.Data as ghp\r\nfrom Rhino import RhinoApp\r\nfrom ghpythonlib.componentbase import executingcomponent as component\r\nimport ghpythonlib.treehelpers as th\r\nfrom scriptcontext import sticky as st\r\n\r\nimport epic\r\n\r\n# Allow realtime feedback with external python files in grasshopper\r\nepic = reload(epic)\r\nno_inputs_warning = \"No assemblies nor built assets linked, please input assemblies and/or built assets\"\r\n\r\n\r\nclass EPiCAnalysisComponent(component):\r\n    def RunScript(self,\r\n                  report_name,\r\n                  epic_inputs,\r\n                  period_of_analysis,\r\n                  _null,\r\n                  analysis_button,\r\n                  analysis_type,\r\n                  graph_origin,\r\n                  graph_scale,\r\n                  _null2,\r\n                  folder_location,\r\n                  button):\r\n\r\n        # Component and version information\r\n        __author__ = epic.__author__\r\n        __version__ = \"1.02\"\r\n        if __version__ == epic.__version__:\r\n            ghenv.Component.Message = epic.__message__\r\n        else:\r\n            ghenv.Component.Message = epic.version_mismatch(__version__)\r\n            ghenv.Component.AddRuntimeMessage(RML.Remark, ghenv.Component.Message)\r\n        ghenv.Component.Name = \"EPiC Analysis\"\r\n        ghenv.Component.NickName = \"EPiC Analysis\"\r\n\r\n        # Convert inputs to flat list\r\n        epic_inputs.Flatten(ghp.GH_Path(0))\r\n        epic_inputs = th.tree_to_list(epic_inputs)\r\n\r\n        # Remove any file names from folder path\r\n        if folder_location:\r\n            folder_location = path.dirname(folder_location)\r\n\r\n        # Component variables\r\n        analysis_types = OrderedDict([('Total', 'total'),\r\n                                      ('By Material', 'by_material'),\r\n                                      ('By Assembly', 'by_assembly'),\r\n                                      ('By Assembly and material', 'by_assembly_and_material')])\r\n\r\n        # Default name for built_assets report\r\n        report_name = 'EPiC Analysis' if not report_name else report_name\r\n\r\n        # Default name for EPiC_Assembly inputs\r\n        epic_assemblies_name = 'Assembly Collection'\r\n        if analysis_button:\r\n            epic.make_value_list_input_component(5, analysis_types.values(), ghenv,\r\n                                                 valuelist_names=analysis_types.keys(),\r\n                                                 xloc=-170,\r\n                                                 yloc=10)\r\n\r\n        if epic_inputs:\r\n            # Process the built_assets inputs and create an EPiCAnalysis class instance\r\n            epic_analysis, epic_inputs = epic.EPiCAnalysis.process_inputs(epic_inputs,\r\n                                                                          analysis_type,\r\n                                                                          graph_origin=graph_origin,\r\n                                                                          graph_scale=graph_scale,\r\n                                                                          period_of_analysis=period_of_analysis,\r\n                                                                          report_name=report_name,\r\n                                                                          epic_assemblies_name=epic_assemblies_name)\r\n\r\n            # Stop report from printing whenever component is updated (if toggle is connected).\r\n            if 'report_exporting' not in st:\r\n                st['report_exporting'] = True\r\n\r\n            # Button / toggle must return to 'False' before a new report is printed\r\n            elif not button:\r\n                st['report_exporting'] = False\r\n\r\n            # Create CSV report when button is pressed\r\n            if button and folder_location and not st['report_exporting']:\r\n                st['report_exporting'] = True\r\n                message = epic.print_csv(report_name, folder_location, period_of_analysis, epic_analysis, epic_inputs)\r\n                RhinoApp.WriteLine(message)\r\n\r\n            # Hide output geometry\r\n            ghenv.Component.Params.Output[25].Hidden = True\r\n\r\n            # Generate component outputs depending on the analysis_type\r\n            return epic_analysis.generate_analysis_breakdown_for_outputs(analysis_type=analysis_type)\r\n        else:\r\n            ghenv.Component.AddRuntimeMessage(RML.Warning,\r\n                                              \"Input EPiCAssembly or EPiCBuiltAsset items for built_assets\")",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "scriptcontext"
  ],
  "has_docstring": true
}