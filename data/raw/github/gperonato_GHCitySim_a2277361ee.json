{
  "source_url": "https://github.com/gperonato/GHCitySim/blob/05bf431de75f867ff67262b44c8d46742dfb3e65/src/Honeybee_CitySim-Solar.py",
  "repo": "gperonato/GHCitySim",
  "repo_stars": 14,
  "repo_description": "Set of Grasshopper components for interfacing with CitySim. ©2016-2018 EPFL-LIPID",
  "license": "unknown",
  "filepath": "src/Honeybee_CitySim-Solar.py",
  "instruction": "Honeybee city sim solar",
  "code": "﻿# GH-CitySim: an interface to CitySim started by Giuseppe Peronato\n#\n# © All rights reserved. Ecole polytechnique fédérale de Lausanne (EPFL), Switzerland,\n# Laboratory of Integrated Performance in Design (LIPID), 2016-2017\n# Developer: Giuseppe Peronato, <giuseppe.peronato@epfl.ch>\n#\n# CitySim is a software developed and distributed by the\n# Laboratory of Solar Energy and Building Physics (LESO-PB)\n# http://citysim.epfl.ch/\n\n\"\"\"\nThis component imports the geometry and runs the simulation for solar radiation.\n\n-\nThis component will hopefully be part of\nLadybug: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n\n@license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n-\n\n    \n    Args:\n        _Geometry: Tree of curves {building;surfaces}\n        _Reflectance: Tree of reflectance (same structure as geometry)\n        _CSobjs: list of CitySim objects\n        dir: Directory\n        name: name of the project\n        Write: Boolean to write the XML file\n        Run: Boolean to start the simulation\n    Returns:\n        Out: nothing\n\"\"\"\n\nghenv.Component.Name = \"Honeybee_CitySim-Solar\"\nghenv.Component.NickName = 'CitySim-Solar'\nghenv.Component.Message = 'VER 0.0.3\\nAVR_01_2017'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"Honeybee\"\nghenv.Component.SubCategory = \"14 | CitySim\"\n#compatibleHBVersion = VER 0.0.56\\nFEB_03_2016\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\nghenv.Component.AdditionalHelpFromDocStrings = \"1\"\n\n\nimport Rhino as rc\nimport scriptcontext as sc\nimport os\nimport System\nimport Grasshopper.Kernel as gh\nimport math\nimport shutil\nimport collections\nimport subprocess\nimport copy\n\n\n# written by Giulio Piacentino, giulio@mcneel.com\ndef tree_to_list(input, retrieve_base = lambda x: x[0]):\n    \"\"\"Returns a list representation of a Grasshopper DataTree\"\"\"\n    def extend_at(path, index, simple_input, rest_list):\n        target = path[index]\n        if len(rest_list) <= target: rest_list.extend([None]*(target-len(rest_list)+1))\n        if index == path.Length - 1:\n            rest_list[target] = list(simple_input)\n        else:\n            if rest_list[target] is None: rest_list[target] = []\n            extend_at(path, index+1, simple_input, rest_list[target])\n    all = []\n    for i in range(input.BranchCount):\n        path = input.Path(i)\n        extend_at(path, 0, input.Branch(path), all)\n    return retrieve_base(all)\n    \ndef getCSobjs(CSobjs):\n    climate = \"\"\n    horizon = \"\"\n    shading = \"\"\n    terrain = \"\"\n    for path in CSobjs:\n        if path != None and path.split(\".\")[1] == \"cli\":\n            climate = path\n        elif path != None and path.split(\".\")[1] == \"hor\":\n            horizon = path\n        elif path != None and path.split(\".\")[1] == \"shd\":\n            shading = path\n        elif path != None and path.split(\".\")[1] == \"gnd\":\n            terrain = path\n    return terrain,horizon,shading,climate\n\n#Create XML files in CitySim format\ndef createXML(geometry,reflectance):\n    xml = '''\n\t\t    <Composite id=\"21\" name=\"Simple wall\" category=\"Wall\">\n\t\t\t    <Layer Thickness=\"0.1500\" Conductivity=\"200.0000\" Cp=\"418\" Density=\"8900\" nre=\"0\" gwp=\"0\" ubp=\"0\"/>\n\t\t    </Composite>\n    '''\n\n    #Add geometry to the XML file\n    for b in xrange(len(geometry)):\n        xml += '''<Building Name=\"GROUP_1\" id=\"'''+ str(b) + '''\" key=\"1\" Vi=\"1123.5\" Ninf=\"0.15\" BlindsLambda=\"0.2\" BlindsIrradianceCutOff=\"100\" Simulate=\"true\">\n                <HeatTank V=\"0.01\" phi=\"20\" rho=\"1000\" Cp=\"4180\" Tmin=\"20\" Tmax=\"35\"/>\n\t\t\t    <CoolTank V=\"0.01\" phi=\"20\" rho=\"1000\" Cp=\"4180\" Tmin=\"5\" Tmax=\"20\"/>\n\t\t\t    <HeatSource beginDay=\"1\" endDay=\"365\">\n\t\t\t\t    <HeatPump Pmax=\"1000\" eta_tech=\"0.3\" Ttarget=\"55\" Tsource=\"ground\" depth=\"5\" alpha=\"0.0700000003\" position=\"vertical\" z1=\"10\" />\n\t\t\t    </HeatSource>\n\t\t\t    <CoolSource beginDay=\"1\" endDay=\"365\">\n\t\t\t\t    <HeatPump Pmax=\"10000000\" eta_tech=\"0.3\" Ttarget=\"5\" Tsource=\"ground\" depth=\"5\" alpha=\"0.0700000003\" position=\"vertical\" z1=\"10\" />\n\t\t\t    </CoolSource>\n\t\t\t    <Zone id=\"1\" volume=\"1123.5\" psi=\"0.2\" Tmin=\"21\" Tmax=\"27\" groundFloor=\"true\" >\n\t\t\t\t    <Occupants n=\"9\" d=\"0.06\" type=\"2\"/>'''\n        for s in xrange(len(geometry[b])):\n            #xml += '<' + attributes[1][b][0][s] + ' id=\"'+str(s)+'\" type=\"21\" ShortWaveReflectance=\"' + attributes[1][b][1][s] + '\" GlazingRatio=\"0.25\" GlazingGValue=\"0.7\" GlazingUValue=\"1.1\" OpenableRatio=\"0\">\\n'\n            xml += '<' + 'Wall' + ' id=\"'+str(s)+'\" type=\"21\" ShortWaveReflectance=\"' + str(reflectance[b][s]) + '\" GlazingRatio=\"0.25\" GlazingGValue=\"0.7\" GlazingUValue=\"1.1\" OpenableRatio=\"0\">\\n'\n            for p in range(geometry[b][s].Count):\n            #srfpts = rs.CurvePoints(geometry[b][s])\n            #for i in xrange(len(srfpts)):\n                #print '<V' + str(i) + ' x=\"' + str(srfpts[i][0]) +'\" y=\"' + str(srfpts[i][1]) +'\" z=\"' + str(srfpts[i][2])+'\"/> \\n'\n                xml+= '<V' + str(p) + ' x=\"' + str(geometry[b][s].X[p]) +'\" y=\"' + str(geometry[b][s].Y[p]) +'\" z=\"' + str(geometry[b][s].Z[p])+'\"/> \\n'\n            xml+= '</' + 'Wall' + '>'        \n            #xml+= '</' + attributes[1][b][0][s] + '>'\n        xml+= '''   </Zone>\n                </Building>'''\n    return xml\n\ndef createHeader():\n    xml = '''<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n    <CitySim name=\"test\">\n\t    <Simulation beginMonth=\"1\" endMonth=\"12\" beginDay=\"1\" endDay=\"31\"/>'''\n\n    xml += '<Climate location=\"' + climate + ' \"city=\"Unknown\"/>'\n    xml += \"\t<District>\"\n    return xml\n    \ndef createFooter():\n    xml = \"\"\n    xml+= '''</District>\n\t\t   </CitySim> '''\n    return xml\n\n\n#Write XML file\ndef writeXML(xml, path, name):\n    xmlpath = path+name+\".xml\"\n    out_file = open(xmlpath,\"w\")\n    out_file.write(xml)\n    out_file.close()\n    \ngeometry = tree_to_list(geometry, lambda x: x)\nreflectance = tree_to_list(reflectance, lambda x: x)\n\nterrain,horizon,shading,climate = getCSobjs(_CSobjs)\nif dir != None:\n    dir += \"\\\\\" #Add \\ in case is missing\n\nif climate == \"\":\n    warning = \"Missing climate file: add one as CSobj.\"\n    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warning)\n    print warning\n    \nif Write:\n    xml = createXML(geometry,reflectance)\n    writeXML(xml,dir,name+\"_main\")\n    header = createHeader()\n    footer = createFooter()\n    writeXML(header,dir,name+\"_head\")\n    writeXML(footer,dir,name+\"_foot\")\n\n    xmlpath = dir+name+'.xml'\n\n    #Create copy command\n    join = \"copy \"+dir+name+\"_head.xml\"\n    if horizon != \"\":\n        join += \"+\" + horizon \n    join += \"+\" +dir+name+\"_main.xml\"\n    if terrain != \"\":\n        join += \"+\" + terrain\n    if shading != \"\":\n        join += \"+\" + shading\n    join += \"+\" +dir+name+\"_foot.xml\"\n    join += \" \" +dir+name+\".xml\"\n    \n    #Merge files\n    os.chdir(dir)\n    os.system(join)\n\n#Run the simulation\nif Run:\n    simulation = Solver + ' -I ' + xmlpath #only solar irradiation\n    os.chdir(dir)\n    os.system(simulation)",
  "language": "python",
  "imports": [
    "Rhino",
    "scriptcontext"
  ],
  "has_docstring": false
}