{
  "source_url": "https://github.com/compas-dev/compas/blob/HEAD/src/compas_rhino/scene/graphobject.py",
  "repo": "compas-dev/compas",
  "repo_stars": 352,
  "repo_description": "Main library of the COMPAS framework and CAD integrations for Rhino/GH and Blender.",
  "license": "MIT",
  "filepath": "src/compas_rhino/scene/graphobject.py",
  "instruction": "Graphobject",
  "code": "from __future__ import absolute_import\nfrom __future__ import division\nfrom __future__ import print_function\n\nimport Rhino  # type: ignore\nimport scriptcontext as sc  # type: ignore\n\nimport compas_rhino\nimport compas_rhino.objects\nfrom compas.geometry import Line\nfrom compas.scene import GraphObject\nfrom compas_rhino.conversions import line_to_rhino\nfrom compas_rhino.conversions import point_to_rhino\n\nfrom .sceneobject import RhinoSceneObject\n\n\nclass RhinoGraphObject(RhinoSceneObject, GraphObject):\n    \"\"\"Scene object for drawing graph data structures.\n\n    Parameters\n    ----------\n    nodegroup : str, optional\n        The name of the group for the nodes.\n    edgegroup : str, optional\n        The name of the group for the edges.\n    edgedirection : bool, optional\n        Flag for drawing the edges with an arrow indicating the direction.\n    **kwargs : dict, optional\n        Additional keyword arguments.\n\n    \"\"\"\n\n    def __init__(self, nodegroup=None, edgegroup=None, edgedirection=False, **kwargs):\n        super(RhinoGraphObject, self).__init__(**kwargs)\n        self._guids_nodes = None\n        self._guids_edges = None\n        self._guids_nodelabels = None\n        self._guids_edgelabels = None\n        self._guids_spheres = None\n        self._guids_pipes = None\n        self.nodegroup = nodegroup\n        self.edgegroup = edgegroup\n        self.edgedirection = edgedirection\n\n    # ==========================================================================\n    # clear\n    # ==========================================================================\n\n    def clear(self):\n        \"\"\"Delete all objects drawn by this scene object.\n\n        Returns\n        -------\n        None\n\n        \"\"\"\n        compas_rhino.objects.delete_objects(self.guids, purge=True)\n\n    def clear_nodes(self):\n        \"\"\"Delete all nodes drawn by this scene object.\n\n        Returns\n        -------\n        None\n\n        \"\"\"\n        compas_rhino.objects.delete_objects(self._guids_nodes, purge=True)\n\n    def clear_edges(self):\n        \"\"\"Delete all edges drawn by this scene object.\n\n        Returns\n        -------\n        None\n\n        \"\"\"\n        compas_rhino.objects.delete_objects(self._guids_edges, purge=True)\n\n    # ==========================================================================\n    # draw\n    # ==========================================================================\n\n    def draw(self):\n        \"\"\"Draw the graph using the chosen visualisation settings.\n\n        Returns\n        -------\n        list[System.Guid]\n            The GUIDs of the created Rhino objects.\n\n        \"\"\"\n        guids = self.draw_nodes()\n        guids += self.draw_edges()\n\n        self._guids = guids\n        return self.guids\n\n    def draw_nodes(self):\n        \"\"\"Draw a selection of nodes.\n\n        Returns\n        -------\n        list[System.Guid]\n            The GUIDs of the created Rhino point objects.\n\n        \"\"\"\n        guids = []\n\n        nodes = list(self.graph.nodes()) if self.show_nodes is True else self.show_nodes or []\n\n        if nodes:\n            for node in nodes:\n                name = \"{}.node.{}\".format(self.graph.name, node)\n                attr = self.compile_attributes(name=name, color=self.nodecolor[node])\n                geometry = point_to_rhino(self.node_xyz[node])\n\n                guid = sc.doc.Objects.AddPoint(geometry, attr)\n                guids.append(guid)\n\n        if guids:\n            if self.nodegroup:\n                self.add_to_group(self.nodegroup, guids)\n            elif self.group:\n                self.add_to_group(self.group, guids)\n\n        self._guids_nodes = guids\n        return guids\n\n    def draw_edges(self):\n        \"\"\"Draw a selection of edges.\n\n        Returns\n        -------\n        list[System.Guid]\n            The GUIDs of the created Rhino objects.\n\n        \"\"\"\n        guids = []\n\n        edges = list(self.graph.edges()) if self.show_edges is True else self.show_edges or []\n        edgedirection = \"end\" if self.edgedirection else False\n\n        if edges:\n            for edge in edges:\n                u, v = edge\n\n                color = self.edgecolor[edge]\n                name = \"{}.edge.{}-{}\".format(self.graph.name, u, v)\n                attr = self.compile_attributes(name=name, color=color, arrow=edgedirection)\n                geometry = line_to_rhino((self.node_xyz[u], self.node_xyz[v]))\n\n                guid = sc.doc.Objects.AddLine(geometry, attr)\n                guids.append(guid)\n\n        if guids:\n            if self.edgegroup:\n                self.add_to_group(self.edgegroup, guids)\n            elif self.group:\n                self.add_to_group(self.group, guids)\n\n        self._guids_edges = guids\n        return guids\n\n    # =============================================================================\n    # draw labels\n    # =============================================================================\n\n    def draw_nodelabels(self, text, color=None, group=None, fontheight=10, fontface=\"Arial Regular\"):\n        \"\"\"Draw labels for a selection of nodes.\n\n        Parameters\n        ----------\n        text : dict[int, str]\n            A dictionary of node labels as node-text pairs.\n        color : :class:`compas.colors.Color` | dict[int, :class:`compas.colors.Color`], optional\n            Color of the labels.\n        group : str, optional\n            The name of a group to add the labels to.\n        fontheight : float, optional\n            Font height of the labels.\n        fontface : str, optional\n            Font face of the labels.\n\n        Returns\n        -------\n        list[System.Guid]\n            The GUIDs of the created Rhino text objects.\n\n        \"\"\"\n        guids = []\n\n        self.nodecolor = color\n\n        for node in text:\n            name = \"{}.node.{}.label\".format(self.graph.name, node)  # type: ignore\n            attr = self.compile_attributes(name=name, color=self.nodecolor[node])\n\n            point = point_to_rhino(self.node_xyz[node])\n\n            dot = Rhino.Geometry.TextDot(str(text[node]), point)\n            dot.FontHeight = fontheight\n            dot.FontFace = fontface\n\n            guid = sc.doc.Objects.AddTextDot(dot, attr)\n            guids.append(guid)\n\n        if group:\n            self.add_to_group(group, guids)\n\n        self._guids_nodelabels = guids\n\n        return guids\n\n    def draw_edgelabels(self, text, color=None, group=None, fontheight=10, fontface=\"Arial Regular\"):\n        \"\"\"Draw labels for a selection of edges.\n\n        Parameters\n        ----------\n        text : dict[tuple[int, int], str]\n            A dictionary of edge labels as edge-text pairs.\n        color : :class:`compas.colors.Color` | dict[tuple[int, int], :class:`compas.colors.Color`], optional\n            Color of the labels.\n        group : str, optional\n            The name of a group to add the labels to.\n        fontheight : float, optional\n            Font height of the labels.\n        fontface : str, optional\n            Font face of the labels.\n\n        Returns\n        -------\n        list[System.Guid]\n            The GUIDs of the created Rhino text objects.\n\n        \"\"\"\n        guids = []\n\n        self.edgecolor = color\n\n        for edge in text:\n            u, v = edge\n\n            color = self.edgecolor[edge]\n            name = \"{}.edge.{}-{}.label\".format(self.graph.name, u, v)  # type: ignore\n            attr = self.compile_attributes(name=name, color=color)\n\n            line = Line(self.node_xyz[u], self.node_xyz[v])\n            point = point_to_rhino(line.midpoint)\n\n            dot = Rhino.Geometry.TextDot(str(text[edge]), point)\n            dot.FontHeight = fontheight\n            dot.FontFace = fontface\n\n            guid = sc.doc.Objects.AddTextDot(dot, attr)\n            guids.append(guid)\n\n        if group:\n            self.add_to_group(group, guids)\n\n        self._guids_edgelabels = guids\n\n        return guids\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": false
}