{
  "source_url": "https://github.com/Guanda0120/Geometry_Acoustic_Simu/blob/fe0e445521fcfee6406f3605783387410ec1848c/RoomGeometry/Plane.py",
  "repo": "Guanda0120/Geometry_Acoustic_Simu",
  "repo_stars": 2,
  "repo_description": null,
  "license": "unknown",
  "filepath": "RoomGeometry/Plane.py",
  "instruction": null,
  "code": "import numpy as np\nimport rhino3dm as rhino3dm\nfrom Graphic.BaseGeometry import BaseGeometry\nfrom Acoustic.Material import Material\n\n\nclass Plane:\n    \"\"\"\n    This is the object to Construct room\n    \"\"\"\n\n    def __init__(self, rhino_plane: rhino3dm.Brep, material: Material):\n        \"\"\"\n        Init plane\n        :param rhino_plane: A rhino Brep object\n        :param material: The material object of this plane\n        \"\"\"\n        self.rhino_plane = rhino_plane\n        self.material = material\n        self.material_name = material.name\n        self.diffuse_abs_coe = material.diffuse_abs\n        self.normal_abs_coe = material.normal_abs\n        self.ref_coe = material.ref_0\n        self.sca_coe = material.scatter\n        self.array_plane = []\n\n        # Change the rhino data to Ndarray with shape (n,3)\n        for idx in range(len(rhino_plane.Geometry.Edges)):\n            # TODO BUG is Here: The point is not in the order\n            # No closed polygon\n            pt_1 = rhino_plane.Geometry.Edges[idx].PointAtStart\n            tmp_pt1 = np.array([pt_1.X, pt_1.Y, pt_1.Z])\n            pt_2 = rhino_plane.Geometry.Edges[idx].PointAtEnd\n            tmp_pt2 = np.array([pt_2.X, pt_2.Y, pt_2.Z])\n            tmp_pt = np.array([tmp_pt1, tmp_pt2])\n            # Get the start point and end point, append it into array_plane\n            self.array_plane.append(tmp_pt)\n        # print(f\"Array Plane: {self.array_plane}\")\n        # Switch the right order of the first item\n        # if (self.array_plane[0][0,:] == self.array_plane[1][0,:]).all():\n        #     self.array_plane[0] = np.array([self.array_plane[0][1,:],self.array_plane[0][0,:]])\n        # elif (self.array_plane[0][0,:] == self.array_plane[1][1,:]).all():\n        #     self.array_plane[0] = np.array([self.array_plane[0][1, :], self.array_plane[0][0, :]])\n        tmp_plane = [self.array_plane[0]]\n        rest_plane = self.array_plane[1:]\n        while len(rest_plane) != 0:\n            compare_pt = tmp_plane[-1][1, :]\n            for idx in range(len(rest_plane)):\n                if np.allclose(compare_pt, rest_plane[idx][0, :]):\n                    tmp_plane.append(rest_plane[idx])\n                    del rest_plane[idx]\n                    break\n                elif np.allclose(compare_pt, rest_plane[idx][1, :]):\n                    tmp_plane.append(np.array([rest_plane[idx][1, :], rest_plane[idx][0, :]]))\n                    del rest_plane[idx]\n                    break\n        self.array_plane = tmp_plane\n        # print(f\"Array Plane: {self.array_plane}\")\n\n        # polygon is the list contain the unique point\n        polygon = []\n        for i in range(len(self.array_plane)):\n            polygon.append(self.array_plane[i][0,:])\n\n        # Struct the polygon\n        polygon = np.array(polygon)\n        self.polygon = polygon\n\n        self.array_plane = np.array(self.array_plane)\n        self.planar_state = BaseGeometry.is_planar(self.polygon)\n        self.normal_direc, self.cen_pt, self.intercept_d = BaseGeometry.normal_direction(self.polygon)\n        self.area = BaseGeometry.area(polygon, self.cen_pt)\n\n    def __str__(self):\n        return f\"The plane is {self.polygon}. The material is {self.material_name}\"\n\n\nif __name__ == \"__main__\":\n    from FileIO.ReadRhino import Read3dm\n    path = \"/Users/liguanda/Desktop/MasterReasearch/MasterFinal/code/Simu/Test_File/Test_Theater.3dm\"\n    rhino_file = Read3dm(path)\n    plane_dict, _, _ = rhino_file.convert_file()\n    plane_list = []\n    for key in plane_dict.keys():\n        for rh_plane in plane_dict[key]:\n            tmp_plane = Plane(rh_plane,np.asarray([0.1,0.1,0.1,0.1,0.1]),np.asarray([0.1,0.1,0.1,0.1,0.1]),key)\n            plane_list.append(tmp_plane)\n            print(f\"Array: {tmp_plane.polygon}, is planar: {tmp_plane.planar_state}, \"\n                  f\"normal direction is: {tmp_plane.normal_direc}\")\n    print(f\"Total {len(plane_list)} planes\")",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}