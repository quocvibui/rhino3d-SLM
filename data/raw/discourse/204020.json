{
  "source_url": "https://discourse.mcneel.com/t/capturing-detail-viewport-on-a-layout-page/204020",
  "topic_id": 204020,
  "title": "Capturing detail viewport on a layout page",
  "question": "Hi Python Gurus,\n\n\nI’m writing a python script for capturing an image of a detail view on the layout page. So far this proves to be a challenge to identify the viewport and its correct location on the layout page to do the print-screen. I have gotten the method to work for specifying that I click the top left and bottom right corner of the detail view to determine the location and size of the capturing. However, this method can be quite tedious, and I want to simplify it even more where I can just select a detail view and capture it with its correct viewport size (ratio).\n\n\nAlso, the resolution of the image is limited by the DPI of the screen for doing a print-screen like capture. Would it be possible for Rhino to do a viewport print-screen with a specify resolution ignoring the DPI of the screen?\n\n\nI’m writing a Python script to capture an image of a detail view on a layout page in Rhino. I currently have a method that works by manually clicking the top-left and bottom-right corners of the detail view to determine the capture area. However this process is quite tedious, so I want to simplify it by clicking to select a detail view and capturing it at its correct viewport size (aspect ratio).\n\n\nAlso, the resolution of the captured image is currently limited by the screen’s DPI (72) since it’s doing a print-screen capture. Is there a way in Rhino to capture a viewport image at a specified resolution (ignoring the screen DPI)?\n\n\nPlease see my sample script. Any advice? Thanks in Advance.\n\n\nimport Rhino\nimport scriptcontext as sc\nimport rhinoscriptsyntax as rs\nimport System.Drawing as sd\n\ndef capture_selected_detail():\n    # Select a detail view object\n    detail_id = rs.GetObject(\"Select a detail viewport\", rs.filter.detail)\n    if not detail_id:\n        print(\"No detail selected.\")\n        return\n\n    selected_obj = sc.doc.Objects.Find(detail_id)\n    if not isinstance(selected_obj, Rhino.DocObjects.DetailViewObject):\n        print(\"Not a valid detail view.\")\n        r...",
  "code_blocks": [
    {
      "code": "import Rhino\nimport scriptcontext as sc\nimport rhinoscriptsyntax as rs\nimport System.Drawing as sd\n\ndef capture_selected_detail():\n    # Select a detail view object\n    detail_id = rs.GetObject(\"Select a detail viewport\", rs.filter.detail)\n    if not detail_id:\n        print(\"No detail selected.\")\n        return\n\n    selected_obj = sc.doc.Objects.Find(detail_id)\n    if not isinstance(selected_obj, Rhino.DocObjects.DetailViewObject):\n        print(\"Not a valid detail view.\")\n        return\n\n    # Find the layout view that owns this detail\n    layout_view = None\n    matched_detail = None\n    for view in sc.doc.Views:\n        if isinstance(view, Rhino.Display.RhinoPageView):\n            for detail in view.GetDetailViews():\n                if detail.Id == selected_obj.Id:\n                    layout_view = view\n                    matched_detail = detail\n                    break\n        if layout_view:\n            break\n\n    if not layout_view or not matched_detail:\n        print(\"Could not find parent layout for detail.\")\n        return\n\n    # Use the detail geometry's bounding box\n    bbox = matched_detail.Geometry.GetBoundingBox(True)\n    if not bbox.IsValid:\n        print(\"Invalid bounding box.\")\n        return\n\n    # Transform bounding box to page coordinates\n    xform = matched_detail.WorldToPageTransform\n    pt1 = xform * bbox.Min\n    pt2 = xform * bbox.Max\n\n    # Debug: Print transformed points\n    print(\"Transformed points: pt1 = \" + str(pt1) + \", pt2 = \" + str(pt2))\n\n    # Create crop rectangle\n    x = int(min(pt1.X, pt2.X))\n    y = int(min(pt1.Y, pt2.Y))\n    width = int(abs(pt2.X - pt1.X))\n    height = int(abs(pt2.Y - pt1.Y))\n    crop_rect = sd.Rectangle(x, y, width, height)\n\n    # Debug: Print crop rectangle\n    print(\"Crop rectangle: \" + str(crop_rect))\n\n    # A3 size at 300 DPI\n    dpi = 300\n    media_width = int(420.0 * dpi / 25.4)\n    media_height = int(297.0 * dpi / 25.4)\n\n    # Simplified capture settings for the layout\n    settings = Rhino.Display.ViewCaptureSettings(layout_view, dpi)\n    settings.SetLayout(sd.Size(media_width, media_height), crop_rect)\n\n    # Save the image\n    filename = rs.SaveFileName(\"Save captured detail\", \"PNG Files (*.png)|*.png||\")\n    if not filename:\n        print(\"No file selected.\")\n        return\n\n    print(\"Attempting to capture the image...\")\n    \n    try:\n        # Perform the capture\n        bitmap = Rhino.Display.ViewCapture.CaptureToBitmap(settings)\n        \n        if bitmap:\n            print(\"Capture successful!\")\n            # Save the captured bitmap\n            bitmap.Save(filename, sd.Imaging.ImageFormat.Png)\n            print(\"Saved image to: \" + filename)\n        else:\n            print(\"Failed to capture image - bitmap is None.\")\n    except Exception as e:\n        print(\"Error during image capture: \" + str(e))\n\n# Run the script\ncapture_selected_detail()",
      "language": "python",
      "author": "IceTea",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinoscriptsyntax",
    "selection",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 1,
  "views": 55
}