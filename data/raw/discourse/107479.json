{
  "source_url": "https://discourse.mcneel.com/t/override-createattributes-for-ghpython-component/107479",
  "topic_id": 107479,
  "title": "Override CreateAttributes for ghpython component",
  "question": "Hi,\n\n\nI’m trying to create a button on a ghpython component, and I don’t want it as a drop down button.  I’ve been trying to override the methods for Render and Layout to create the button according to similar examples in c# online, among others these guides: \nhttps://developer.rhino3d.com/guides/grasshopper/custom-attributes/\n\n\nhttps://www.grasshopper3d.com/forum/topics/button\n\n\nHowever nothing happens to the component. I’ve been trying to create the equivalent code for the ghpython node, but I am not sure if I have understood the c# code correctly. Is it possible to override these methods for a ghpython node to change the appearance of the node? Any help is highly appreciated. The code below is the same as the code in the attached .gh file.\n\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nfrom System.Windows.Forms import MessageBox\nfrom System.Windows.Forms import MessageBoxButtons\n\nclass Attributes_Custom(Grasshopper.Kernel.Attributes.GH_ComponentAttributes): # inherits all methods of GH_ComponentAttributes\n    def Layout(self): # override inherited method Layout\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Layout() # run layout before changing the definition\n        rec0 = Grasshopper.Kernel.GH_Convert.ToRectangle(self.Bounds) #System.Drawing.Rectangle \n        rec0.Height += 22\n        rec1 = rec0\n        rec1.Y = rec1.Bottom - 22\n        rec1.Height = 22\n        rec1.Inflate(-2, -2)\n        Bounds = rec0\n        self.Bounds=Bounds\n        ButtonBounds = rec1\n        self.ButtonBounds=ButtonBounds\n    \n    def Render(self,canvas, graphics, channel): # Override Render method\n        MessageBox.Show(\"Render running\", \"Render\", MessageBoxButtons.OK)\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Render(canvas, graphics, channel) # run render before changing the definition\n        if channel == Grasshopper.GUI.Canvas.GH_CanvasC...",
  "code_blocks": [
    {
      "code": "#python\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nfrom System.Windows.Forms import MessageBox\nfrom System.Windows.Forms import MessageBoxButtons\n\nclass Attributes_Custom(Grasshopper.Kernel.Attributes.GH_ComponentAttributes): # inherits all methods of GH_ComponentAttributes\n    def Layout(self): # override inherited method Layout\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Layout(self) # run render before changing the definition\n        rec0 = Grasshopper.Kernel.GH_Convert.ToRectangle(self.Bounds) #System.Drawing.Rectangle \n        rec0.Height += 22\n        rec1 = rec0\n        rec1.Y = rec1.Bottom - 22\n        rec1.Height = 22\n        rec1.Inflate(-2, -2)\n        Bounds = rec0\n        self.Bounds=Bounds\n        ButtonBounds = rec1\n        self.ButtonBounds=ButtonBounds\n    \n    def Render(self,canvas, graphics, channel): # Override Render method\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Render(self, canvas, graphics, channel) # run render before changing the definition\n        if channel == Grasshopper.GUI.Canvas.GH_CanvasChannel.Objects:\n            button = Grasshopper.GUI.Canvas.GH_Capsule.CreateTextCapsule(self.ButtonBounds, self.ButtonBounds, Grasshopper.GUI.Canvas.GH_Palette.Black, \"Button\", 2, 0)\n            button.Render(graphics, self.Selected, self.Owner.Locked, False)\n            button.Dispose()\n    \n    def RespondToMouseDown(self,sender,e):\n        if e.Button == System.Windows.Forms.MouseButtons.Left:\n            rec = self.ButtonBounds\n            if rec.Contains(e.CanvasLocation):\n                MessageBox.Show(\"The button was clicked\", \"Button\", MessageBoxButtons.OK)\n                return  Grasshopper.GUI.Canvas.GH_ObjectResponse.Handled\n        self.sender=sender\n        self.e=e\n        self.RespondToMouseDown(sender, e)\n\nclass MyComponent(component):\n    def CreateAttributes(self): # Override inherited method create attributes\n        self.m_attributes=Attributes_Custom(self) \n    \n    def RunScript(self, x, y):\n        a=1\n        return a",
      "language": "python",
      "author": "amoe",
      "post_number": 6,
      "is_solution": false
    },
    {
      "code": "from ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\n\nclass Button_UI(Grasshopper.Kernel.Attributes.GH_ComponentAttributes): # inherits all methods of GH_ComponentAttributes\n    def __init__(self, owner):\n        super(Button_UI, self).__init__(owner)\n        self.component = owner\n        self.button_down = False\n                \n    def Layout(self): # override inherited method Layout\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Layout(self)\n        component_rect = Grasshopper.Kernel.GH_Convert.ToRectangle(self.Bounds) \n        component_rect.Height += 22\n        self.button_rect = System.Drawing.Rectangle(component_rect.X, component_rect.Bottom-22, component_rect.Width, 22)\n        self.button_rect.Inflate(-2, -2)\n        Bounds = component_rect\n        self.Bounds=Bounds\n        ButtonBounds = self.button_rect\n        self.ButtonBounds=ButtonBounds\n            \n    def Render(self,canvas, graphics, channel): # Override Render method\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Render(self, canvas, graphics, channel)\n        if channel == Grasshopper.GUI.Canvas.GH_CanvasChannel.Objects:\n            color = Grasshopper.GUI.Canvas.GH_Palette.Grey if self.button_down else Grasshopper.GUI.Canvas.GH_Palette.Black\n            button = Grasshopper.GUI.Canvas.GH_Capsule.CreateTextCapsule(self.ButtonBounds, self.ButtonBounds, color, \"Button\", 2, 0)\n            button.Render(graphics, self.Selected, self.Owner.Locked, False)\n            button.Dispose()\n            \n    def RespondToMouseDown(self,sender,e):\n        if e.Button == System.Windows.Forms.MouseButtons.Left:\n            rec = self.button_rect\n            pt = System.Drawing.Point.Round(e.CanvasLocation)\n            if not self.button_down:\n                if pt.X > rec.X and pt.X < rec.X+rec.Width and pt.Y > rec.Y and pt.Y < rec.Y+rec.Height:\n                    self.button_down = True\n                    self.component.OnDisplayExpired(False)\n                    return  Grasshopper.GUI.Canvas.GH_ObjectResponse.Capture\n        return super(Button_UI, self).RespondToMouseDown(sender, e)\n        \n    def RespondToMouseUp(self,sender,e):\n        if e.Button == System.Windows.Forms.MouseButtons.Left:\n            if self.button_down:\n                self.button_down = False\n                self.component.OnDisplayExpired(False)\n                rec = self.button_rect\n                pt = System.Drawing.Point.Round(e.CanvasLocation)\n                if pt.X > rec.X and pt.X < rec.X+rec.Width and pt.Y > rec.Y and pt.Y < rec.Y+rec.Height:\n                    self.component.click_response()\n            return  Grasshopper.GUI.Canvas.GH_ObjectResponse.Release\n        return super(Button_UI, self).RespondToMouseUp(sender, e)\n        \nclass MyComponent(component):\n    def __init__(self):\n        self.click_count = 0\n    \n    def CreateAttributes(self): # Override inherited method create attributes\n        self.m_attributes=Button_UI(self) \n            \n    def RunScript(self, x, y):\n        return self.click_count\n        \n    def click_response(self):\n        self.click_count += 1\n        self.ExpireSolution(True)",
      "language": "python",
      "author": "OBucklin",
      "post_number": 11,
      "is_solution": false
    },
    {
      "code": "from ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nfrom System.Windows.Forms import MessageBox\nfrom System.Windows.Forms import MessageBoxButtons\n\nclass Attributes_Custom(Grasshopper.Kernel.Attributes.GH_ComponentAttributes): # inherits all methods of GH_ComponentAttributes\n    def Layout(self): # override inherited method Layout\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Layout() # run layout before changing the definition\n        rec0 = Grasshopper.Kernel.GH_Convert.ToRectangle(self.Bounds) #System.Drawing.Rectangle \n        rec0.Height += 22\n        rec1 = rec0\n        rec1.Y = rec1.Bottom - 22\n        rec1.Height = 22\n        rec1.Inflate(-2, -2)\n        Bounds = rec0\n        self.Bounds=Bounds\n        ButtonBounds = rec1\n        self.ButtonBounds=ButtonBounds\n    \n    def Render(self,canvas, graphics, channel): # Override Render method\n        MessageBox.Show(\"Render running\", \"Render\", MessageBoxButtons.OK)\n        Grasshopper.Kernel.Attributes.GH_ComponentAttributes.Render(canvas, graphics, channel) # run render before changing the definition\n        if channel == Grasshopper.GUI.Canvas.GH_CanvasChannel.Objects:\n            button = GH_Capsule.CreateTextCapsule(self.ButtonBounds, self.ButtonBounds, Grasshopper.GUI.Canvas.GH_Palette.Black, \"Button\", 2, 0)\n            button.Render(graphics, self.Selected, self.Owner.Locked, False)\n            button.Dispose()\n    \n    def RespondToMouseDown(self,sender,e):\n        if e.Button == System.Windows.Forms.MouseButtons.Left:\n            rec = self.ButtonBounds\n            if rec.Contains(e.CanvasLocation):\n                MessageBox.Show(\"The button was clicked\", \"Button\", MessageBoxButtons.OK)\n                return  Grasshopper.GUI.Canvas.GH_ObjectResponse.Handled\n        self.sender=sender\n        self.e=e\n        self.RespondToMouseDown(sender, e)\n\nclass MyComponent(component):\n    def CreateAttributes(self): # Override inherited method create attributes\n        m_attributes=Attributes_Custom(ghenv.Component)\n    \n    def RunScript(self, x, y):\n        a=1\n        return a`",
      "language": "python",
      "author": "amoe",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "csharp",
    "file-io",
    "geometry",
    "grasshopper",
    "materials",
    "python",
    "rhinoscriptsyntax",
    "ui"
  ],
  "has_accepted_answer": true,
  "category_id": 8,
  "posts_count": 12,
  "views": 2257
}