{
  "source_url": "https://github.com/TTM-KK/voronoi/blob/fbd950eda81840c343df12d2c568719577652364/Main02.py",
  "repo": "TTM-KK/voronoi",
  "repo_stars": 1,
  "repo_description": "voronoi & GA",
  "license": "unknown",
  "filepath": "Main02.py",
  "instruction": "coding: utf-8 import Rhino import scriptcontext import rhinoscriptsyntax as rs",
  "code": "# coding: utf-8\n# import Rhino\n# import scriptcontext\n# import rhinoscriptsyntax as rs\nimport time\n\nfrom voronoi_module import Triangle\nfrom voronoi_module import Point\nfrom voronoi_module import Voronoi\nfrom voronoi_module import Delaunay\nfrom convexhull_module import ConvexHull\n\nfrom GA import Generator\nfrom GA import Evaluate\nfrom GA import Selection\nfrom GA import Crossover\nfrom GA import Mutation\n\n\npoints_obj_list = []  # Pointのオブジェクトを保持。\ndelaunay_triangles = []  # このリストに三角形分割を保持していく。[p1, p2, p3]\noriginal_points = []  # TODO とりあえずの応急処置。Pointクラスインスタンスを保持するリストを作成し、Triangleクラスは各Pointクラスインスタンスのインデックスを参照するようにする。\n\n# GAに関するパラメーター\neach_generation_optimize_gene = []\neach_generation_optimize_evaluation_value = []\n\n\ngeneration_num = 2\npop_num = 1\nx_range = 2000\ny_range = 2000\n\n# 選択のパラメータ\ntournament_size = 10\ntournament_select_num = 2\nelite_select_num = 1\n\n# 交叉の確率\ncrossover_prob = 50\n\n# 突然変異の確率\nmutation_prob = 3\n\n\ndef save_optimize_pop(all_pop, evaluate_value):\n    '''優良個体の評価値と遺伝子配列をリターン'''\n    max_value = max(evaluate_value)\n    max_index = evaluate_value.index(max_value)\n    superior_pop = all_pop[max_index]\n\n    return max_value, superior_pop\n\n\ndef draw_result(pop, loop):\n    points_obj_list = []\n    original_points = []\n    for point in pop:\n        p = Point.Point(point)\n        p.change_coordinate()\n        points_obj_list.append(p)\n        original_points.append(p)\n\n    # ドロネー分割を行う。\n    delaunay = Delaunay.Delaunay()\n    delaunay.points_to_delaunay(points_obj_list)\n    # delaunay.draw_delaunay()\n\n    # ボロノイ図を作成。各領域のインスタンスを取得。\n    voronoi = Voronoi.Voronoi()\n    voronoi.delaunay_to_voronoi(original_points, delaunay.each_triangles)\n    voronoi.draw_voronoi()\n\n    # 2Dの凸包図形作成。\n    original_points_coordinate = [point.coordinate for point in original_points]\n    convexhull_points = ConvexHull.convex_hull(original_points_coordinate)\n    # convexhull_line = ConvexHull.make_line(convexhull_points)\n    ConvexHull.draw_rhino(convexhull_points)\n\n    # 凸包図形を使用してボロノイをトリミング\n    # voronoi.rebuild_voronoi_by_convexhull(convexhull_line)\n    # voronoi.reculculate_voronoi_area()\n    # voronoi.draw_voronoi_loop(loop, x_range)\n\n\n# Time Start\nt_start = time.time()\n\n# 初期個体生成\nall_pop = []\nfor i in range(pop_num):\n    points = Generator.generator(10, x_range, y_range)\n    all_pop.append(points)\n\n\n# 初期評価\nevaluate_value = Evaluate.evaluate(all_pop)\nmax_value, superior = save_optimize_pop(all_pop, evaluate_value)\neach_generation_optimize_evaluation_value.append(int(max_value))\neach_generation_optimize_gene.append(superior)\n\n#\n# for loop in range(generation_num):\n#     # 選択\n#     select_pop, elite_pop = Selection.selection(\n#         all_pop, evaluate_value, tournament_select_num, tournament_size, elite_select_num, ascending=True)\n#\n#     # 選択した個体の中から2個体選択し交叉や突然変異を適用する。\n#     next_pop = []\n#     while True:\n#         # 交叉\n#         pop_1, pop_2 = Crossover.one_point_crossover(select_pop, crossover_prob)\n#         # 突然変異\n#         # pop_1 = mutation(pop_1, mutation_prob)\n#         # pop_2 = mutation(pop_2, mutation_prob)\n#\n#         next_pop.append(pop_1)\n#         next_pop.append(pop_2)\n#\n#         if len(next_pop) >= pop_num - elite_select_num:\n#             break\n#\n#     # エリート主義。優良個体を次世代へ継承。\n#     next_pop.extend(elite_pop)\n#\n#     # 評価\n#     evaluate_value = Evaluate.evaluate(next_pop, loop=loop + 1)\n#     max_value, superior = save_optimize_pop(all_pop, evaluate_value)\n#     each_generation_optimize_evaluation_value.append(int(max_value))\n#     each_generation_optimize_gene.append(superior)\n#\n#     # 更新\n#     all_pop = next_pop\n#\n#\n\n# 結果をRhinoに描画\n# loop = 0\n# for each_pop_gene in each_generation_optimize_gene:\n#     draw_result(each_pop_gene, loop)\n#     loop += 1\n\n# for i in range(len(points)):\n#     point = Point.Point(points[i])\n#     point.change_coordinate()\n#\n#     points_obj_list.append(point)\n#     original_points.append(point)\n#\n#\n# # ドロネー分割を行う。\n# delaunay = Delaunay.Delaunay()\n# delaunay.points_to_delaunay(points_obj_list)\n# # delaunay.draw_delaunay()\n#\n#\n# # ボロノイ図を作成。各領域のインスタンスを取得。\n# voronoi = Voronoi.Voronoi()\n# voronoi.delaunay_to_voronoi(original_points, delaunay.each_triangles)\n#\n#\n# # 2Dの凸包図形作成。\n# original_points_coordinate = [point.coordinate for point in original_points]\n# convexhull_points = ConvexHull.convex_hull(original_points_coordinate)\n# convexhull_line = ConvexHull.make_line(convexhull_points)\n# ConvexHull.draw_rhino(convexhull_points)\n#\n#\n# # 凸包図形を使用してボロノイをトリミング\n# voronoi.rebuild_voronoi_by_convexhull(convexhull_line)\n# voronoi.reculculate_voronoi_area()\n# voronoi.draw_voronoi()\n#\n#\n# # 遺伝的アルゴリズム開始。\n\n\n# Time Fin\nt_fin = time.time()\nprint('Evaluate Value : {}'.format(each_generation_optimize_evaluation_value))\nprint('Fin Time : {}'.format(t_fin - t_start))\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}