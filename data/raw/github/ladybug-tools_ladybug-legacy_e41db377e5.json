{
  "source_url": "https://github.com/ladybug-tools/ladybug-legacy/blob/d90db02f2776febbb38100dea26ec0c93e77aa53/src/Ladybug_selectSkyMtx.py",
  "repo": "ladybug-tools/ladybug-legacy",
  "repo_stars": 202,
  "repo_description": ":beetle: Ladybug is an environmental plugin for Grasshopper.",
  "license": "NOASSERTION",
  "filepath": "src/Ladybug_selectSkyMtx.py",
  "instruction": "Use this component to select a specific sky matrix (skyMxt) for an hour of the year or for an analysis period.",
  "code": "# Select GenCumulativeSkyMtx\n#\n# Ladybug: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n# \n# This file is part of Ladybug.\n# \n# Copyright (c) 2013-2020, Mostapha Sadeghipour Roudsari <mostapha@ladybug.tools> \n# Ladybug is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# Ladybug is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with Ladybug; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n\n\"\"\"\nUse this component to select a specific sky matrix (skyMxt) for an hour of the year or for an analysis period.\n\n-\nProvided by Ladybug 0.0.69\n    \n    Args:\n        _cumulativeSkyMtx: The output from a GenCumulativeSkyMtx component.\n        HOY_: An hour of the year or list of hours of the year for which you would like to select a sky.  This must be a value between 1 and 8760.\n        _analysisPeriod_: An analysis period from Analysis Period component.  This will override an input HOY (hour of the year).\n        removeDiffuse_: Set to \"True\" if you want to remove the diffuse component of the selected sky.\n        removeDirect_: Set to \"True\" if you want to remove the direct component of the selected sky.\n    Returns:\n        readMe!: ...\n        selectedSkyMtx: The selected sky matrix (SkyMtx) for the input hour of the year or an analysis period.\n\"\"\"\n\nghenv.Component.Name = \"Ladybug_selectSkyMtx\"\nghenv.Component.NickName = 'selectSkyMtx'\nghenv.Component.Message = 'VER 0.0.69\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"LB-Legacy\"\nghenv.Component.SubCategory = \"2 | VisualizeWeatherData\"\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"2\"\nexcept: pass\n\n\nimport scriptcontext as sc\nimport Grasshopper.Kernel as gh\nimport System\nfrom Grasshopper import DataTree\nfrom Grasshopper.Kernel.Data import GH_Path\n\n\ndef getHourlySky(daylightMtxDict, HOY):\n    # for presentation\n    lb_preparation = sc.sticky[\"ladybug_Preparation\"]()\n    HOY.sort()\n    stDate = lb_preparation.hour2Date(HOY[0], 1)\n    if len(HOY) == 1:\n        analysisP = ((stDate[1]+1, stDate[0], stDate[2]-1),(stDate[1]+1, stDate[0], stDate[2]))\n    else:\n        endDate = lb_preparation.hour2Date(HOY[-1], 1)\n        analysisP = ((stDate[1]+1, stDate[0], stDate[2]-1),(endDate[1]+1, endDate[0], endDate[2]-1))\n    \n    hourlyMtx = []\n    for patchNumber in daylightMtxDict.keys():\n        cumulativeDifValue = 0\n        cumulativeDirValue = 0\n        # adding upp the values\n        try:\n            for hoy in HOY:\n                difValue, dirValue = daylightMtxDict[patchNumber][hoy]\n                cumulativeDifValue += difValue\n                cumulativeDirValue += dirValue \n        except Exception, e:\n            warning = 'One of the HOYs is less than 1 or greater than 8760.'\n            print warning\n            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warning)\n        \n        hourlyMtx.append([cumulativeDifValue/1000, cumulativeDirValue/1000])\n    \n    return hourlyMtx, analysisP\n\ndef getCumulativeSky(daylightMtxDict, runningPeriod):\n    \n    lb_preparation = sc.sticky[\"ladybug_Preparation\"]()\n    \n    def selectHourlyData(dataList, analysisPeriod):\n        # read analysis period\n        stMonth, stDay, stHour, endMonth, endDay, endHour = lb_preparation.readRunPeriod(analysisPeriod, False)\n        \n        selHourlyData =[];\n        \n        # select data\n        stAnnualHour = lb_preparation.date2Hour(stMonth, stDay, stHour)\n        endAnnualHour = lb_preparation.date2Hour(endMonth, endDay, endHour)\n        \n        # check it goes from the end of the year to the start of the year\n        if stAnnualHour < endAnnualHour:\n            for i, item in enumerate(dataList[stAnnualHour-1:endAnnualHour+1]):\n                if stHour-1 <= (i + stHour - 1)%24 <= endHour-1: selHourlyData.append(item)\n            type = True\n        else:\n            for i, item in enumerate(dataList[stAnnualHour-1:]):\n                if stHour-1 <= (i + stHour - 1)%24 <= endHour-1: selHourlyData.append(item)\n            for i, item in enumerate(dataList[:endAnnualHour + 1]):\n                if stHour-1 <= i %24 <= endHour-1: selHourlyData.append(item)\n            type = False\n        \n        return selHourlyData\n    \n    HOYS = selectHourlyData(range(8760), runningPeriod)\n    \n    hourlyMtx = []\n    for patchNumber in daylightMtxDict.keys():\n        cumulativeDifValue = 0\n        cumulativeDirValue = 0\n        # adding upp the values\n        try:\n            for HOY in HOYS:\n                difValue, dirValue = daylightMtxDict[patchNumber][HOY + 1]\n                cumulativeDifValue += difValue\n                cumulativeDirValue += dirValue \n        except Exception, e:\n            print `e`\n            \n        hourlyMtx.append([cumulativeDifValue/1000, cumulativeDirValue/1000])\n    \n    return hourlyMtx\n\ndef prepareLBList(skyMtxLists, analysisPeriod, locName, unit, removeDiffuse, removeDirect):\n    lb_preparation = sc.sticky[\"ladybug_Preparation\"]()\n    \n    # prepare the final output\n    stMonth, stDay, stHour, endMonth, endDay, endHour = lb_preparation.readRunPeriod(analysisPeriod, False)\n    totalRad = [lb_preparation.strToBeFound, locName, \"Sky Patches' Total Radiation\", unit, 'NA', (stMonth, stDay, stHour), (endMonth, endDay, endHour)]\n    diffuseRad = [lb_preparation.strToBeFound, locName, \"Sky Patches' Diffuse Radiation\", unit, 'NA', (stMonth, stDay, stHour), (endMonth, endDay, endHour)]\n    directRad = [lb_preparation.strToBeFound, locName, \"Sky Patches' Direct Radiation\", unit, 'NA', (stMonth, stDay, stHour), (endMonth, endDay, endHour)]\n    \n    for radValues in skyMtxLists:\n        if not removeDiffuse and not removeDirect:\n            totalRad.append(sum(radValues))\n            diffuseRad.append(radValues[0])\n            directRad.append(radValues[1])\n        elif removeDiffuse and removeDirect:\n            totalRad.append(0)\n            diffuseRad.append(0)\n            directRad.append(0)\n        elif removeDirect:\n            totalRad.append(radValues[0])\n            diffuseRad.append(radValues[0])\n            directRad.append(0)\n        elif removeDiffuse:\n            totalRad.append(radValues[1])\n            diffuseRad.append(0)\n            directRad.append(radValues[1])\n    \n    return totalRad + diffuseRad + directRad\n\ndef isLadybugFlying():\n    # import the classes\n    if sc.sticky.has_key('ladybug_release'):\n        try:\n            if not sc.sticky['ladybug_release'].isCompatible(ghenv.Component): return False\n            if sc.sticky['ladybug_release'].isInputMissing(ghenv.Component): return -1\n        except:\n            warning = \"You need a newer version of Ladybug to use this compoent.\" + \\\n            \"Use updateLadybug component to update userObjects.\\n\" + \\\n            \"If you have already updated userObjects drag Ladybug_Ladybug component \" + \\\n            \"into canvas and try again.\"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, warning)\n            return False\n        return True\n    else:\n        print \"You should first let the Ladybug fly...\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"You should first let the Ladybug fly...\")\n        return False\n        \n\nskyMtxLists = []\nif _cumulativeSkyMtx and HOY_ and isLadybugFlying:\n    skyMtxLists, _analysisPeriod_ = getHourlySky(_cumulativeSkyMtx.d, HOY_)\n    unit = 'kWh/m2'\nelif _cumulativeSkyMtx and isLadybugFlying:\n    skyMtxLists = getCumulativeSky(_cumulativeSkyMtx.d, _analysisPeriod_)\n    unit = 'kWh/m2'\n\nselectedSkyMtx = []\nif len(skyMtxLists)!=0:\n    selectedSkyMtx = prepareLBList(skyMtxLists, _analysisPeriod_, _cumulativeSkyMtx.location, unit, removeDiffuse_, removeDirect_)\nelse:\n    print \"cumulativeSkyMtx failed to collect data.\"\n",
  "language": "python",
  "imports": [
    "scriptcontext"
  ],
  "has_docstring": true
}