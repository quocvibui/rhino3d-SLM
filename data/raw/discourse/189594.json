{
  "source_url": "https://discourse.mcneel.com/t/an-exception-occurs-when-the-input-is-deleted/189594",
  "topic_id": 189594,
  "title": "An exception occurs when the input is deleted",
  "question": "I am creating a component that adds and deletes Inputs based on the number of Geometry faces.\n\n\nAdding Inputs is fine, but when an Input is deleted, the following exception occurs.\n\n\nIndex was out of range. Must be non-negative and less than the size of the collection.\n\n\n\nI donâ€™t know what is causing the exception, but is it necessary after deleting the Input?\n\n\n\n\n\n\nDynamicInput01Component.cs\n (4.8 KB)",
  "code_blocks": [
    {
      "code": "using System;\nusing System.Collections.Generic;\n\nusing Grasshopper.Kernel;\nusing Grasshopper.Kernel.Parameters;\nusing Rhino.Geometry;\nusing System.Drawing;\nusing Grasshopper;\n\nnamespace MyGrasshopperAssembly1.DynamicInput\n{\n    public class DynamicInput02Component : GH_Component, IGH_VariableParameterComponent\n    {\n        /// <summary>\n        /// Initializes a new instance of the DynamicInput02Component class.\n        /// </summary>\n        public DynamicInput02Component()\n          : base(\"Dynamic Input 02\", \"DInp\",\n              \"Description\",\n               \"MyGHA\", \"Primitive\")\n        {\n            VariableParameterMaintenance();\n        }\n\n        /// <summary>\n        /// Registers all the input parameters for this component.\n        /// </summary>\n        protected override void RegisterInputParams(GH_Component.GH_InputParamManager pManager)\n        {\n            pManager.AddGeometryParameter(\"Geometry\", \"G\", \"Input Geometry\", GH_ParamAccess.item);\n        }\n\n\n        /// <summary>\n        /// Registers all the output parameters for this component.\n        /// </summary>\n        protected override void RegisterOutputParams(GH_Component.GH_OutputParamManager pManager)\n        {\n            pManager.AddGeometryParameter(\"Result\", \"R\", \"Result\", GH_ParamAccess.item);\n            pManager.AddTextParameter(\"Info\", \"I\", \"Info\", GH_ParamAccess.item);\n        }\n        \n        \n        private int faceCount = 0;\n\n        /// <summary>\n        /// This is the method that actually does the work.\n        /// </summary>\n        /// <param name=\"DA\">The DA object is used to retrieve from inputs and store in outputs.</param>\n        protected override void SolveInstance(IGH_DataAccess DA) \n        {\n            try\n            {\n                var geo = new Brep();\n                if (!DA.GetData(0, ref geo)) return;\n\n                int newFaceCount = geo.Faces.Count;\n                if (newFaceCount != faceCount)\n                {\n                    //faceCount = newFaceCount;\n                    GH_Document gdoc = Instances.ActiveCanvas.Document;\n                    gdoc.ScheduleSolution(0, CallBack);\n                    faceCount = newFaceCount;\n                }\n                else\n                {\n                    List<Color> colors = new List<Color>();\n                    for (int i = 0; i < faceCount; i++)\n                    {\n                        Color color = Color.White;\n                        DA.GetData(i + 1, ref color); // Face count is 1-based\n                        colors.Add(color);\n                    }\n\n                    DA.SetData(0, geo);\n\n                    string result = \"Received \" + colors.Count + \" colors.\";\n                    // color to strings\n                    foreach (Color color in colors)\n                    {\n                        result += \"\\n\" + color.ToString();\n                    }\n                    DA.SetData(1, result);\n                }\n            }\n            catch (Exception e)\n            {\n                AddRuntimeMessage(GH_RuntimeMessageLevel.Error, e.Message);\n            }\n        }\n\n        public void CallBack(GH_Document gH_Document)\n        {\n            //Variable Parameter Maintenance            \n\n            // Remove all existing inputs\n            while (Params.Input.Count > 1)\n            {\n                var i = Params.Input.Count - 1;\n                Params.Input[i].Sources.Clear();\n                Params.UnregisterInputParameter(Params.Input[i]);\n                Params.OnParametersChanged();\n            }\n\n            // Add new inputs\n            for (int i = 0; i < faceCount; i++)\n            {\n                // Create and add a new Input\n                var inp = new Param_Colour()\n                {\n                    Name = \"Color \" + (i + 1),\n                    NickName = \"C\" + (i + 1),\n                    Description = \"Color for face \" + (i + 1),\n                    Access = GH_ParamAccess.item,\n                    Optional = true\n                };\n                Params.RegisterInputParam(inp);\n            }\n\n            Params.OnParametersChanged();\n            VariableParameterMaintenance();\n            this.ExpireSolution(true);\n        }\n\n        public override void AddedToDocument(GH_Document document)\n        {\n            base.AddedToDocument(document);\n        }\n\n        public bool CanInsertParameter(GH_ParameterSide side, int index)\n        {\n            return false;\n        }\n\n        public bool CanRemoveParameter(GH_ParameterSide side, int index)\n        {\n            return false;\n        }\n\n        public IGH_Param CreateParameter(GH_ParameterSide side, int index)\n        {\n            return new Param_GenericObject();\n        }\n\n        public bool DestroyParameter(GH_ParameterSide side, int index)\n        {\n            return true;\n        }\n        public void VariableParameterMaintenance()\n        {\n            //for (int i = 1; i < this.Params.Input.Count; i++)\n            //{\n            //    this.Params.Input[i].Name = (i - 1).ToString();\n            //    this.Params.Input[i].NickName = (i - 1).ToString();\n            //}\n        }\n\n        /// <summary>\n        /// Provides an Icon for the component.\n        /// </summary>\n        protected override System.Drawing.Bitmap Icon\n        {\n            get\n            {\n                //You can add image files to your project resources and access them like this:\n                // return Resources.IconForThisComponent;\n                return null;\n            }\n        }\n\n        /// <summary>\n        /// Gets the unique ID for this component. Do not change this ID after release.\n        /// </summary>\n        public override Guid ComponentGuid\n        {\n            get { return new Guid(\"CF6292BC-A312-425D-B51C-1D1897B73E52\"); }\n        }\n    }\n}",
      "language": "csharp",
      "author": "yasuda",
      "post_number": 2,
      "is_solution": true
    }
  ],
  "tags": [
    "csharp",
    "geometry",
    "grasshopper",
    "python",
    "rhinocommon",
    "transformation"
  ],
  "has_accepted_answer": true,
  "category_id": 8,
  "posts_count": 2,
  "views": 79
}