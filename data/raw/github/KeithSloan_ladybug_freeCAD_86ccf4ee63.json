{
  "source_url": "https://github.com/KeithSloan/ladybug_freeCAD/blob/7b40cdc3178b4a1d533375b21132a82c2cc05fa2/ladybug_freeCAD/text.py",
  "repo": "KeithSloan/ladybug_freeCAD",
  "repo_stars": 0,
  "repo_description": "Ladybug FreeCAD",
  "license": "AGPL-3.0",
  "filepath": "ladybug_freeCAD/text.py",
  "instruction": "Functions to add text to the Rhino scene and create Grasshopper text objects.",
  "code": "\"\"\"Functions to add text to the Rhino scene and create Grasshopper text objects.\"\"\"\nfrom __future__ import division\nimport math\n\nfrom .fromgeometry import from_plane\nfrom .color import black\n\ntry:\n    import System.Guid as guid\nexcept ImportError as e:\n    print(\"Failed to import System\\n{}\".format(e))\n\ntry:\n    import Rhino as rh\nexcept ImportError as e:\n    raise ImportError(\"Failed to import Rhino.\\n{}\".format(e))\n\ntry:\n    import Grasshopper as gh\nexcept ImportError:\n    pass\n\n\ndef text_objects(text, plane, height, font='Arial',\n                 horizontal_alignment=0, vertical_alignment=5):\n    \"\"\"Generate a Bake-able Grasshopper text object from a text string and ladybug Plane.\n\n    Args:\n        text: A text string to be converted to a a Grasshopper text object.\n        plane: A Ladybug Plane object to locate and orient the text in the Rhino scene.\n        height: A number for the height of the text in the Rhino scene.\n        font: An optional text string for the font in which to draw the text.\n        horizontal_alignment: An optional integer to specify the horizontal alignment\n             of the text. Choose from: (0 = Left, 1 = Center, 2 = Right)\n        vertical_alignment: An optional integer to specify the vertical alignment\n             of the text. Choose from: (0 = Top, 1 = MiddleOfTop, 2 = BottomOfTop,\n             3 = Middle, 4 = MiddleOfBottom, 5 = Bottom, 6 = BottomOfBoundingBox)\n    \"\"\"\n    txt = rh.Display.Text3d(text, from_plane(plane), height)\n    txt.FontFace = font\n    txt.HorizontalAlignment = AlignmentTypes.horizontal(horizontal_alignment)\n    txt.VerticalAlignment = AlignmentTypes.vertical(vertical_alignment)\n    return TextGoo(txt)\n\n\n\"\"\"____________EXTRA HELPER OBJECTS____________\"\"\"\n\n\nclass TextGoo(gh.Kernel.Types.GH_GeometricGoo[rh.Display.Text3d],\n              gh.Kernel.IGH_BakeAwareData, gh.Kernel.IGH_PreviewData):\n    \"\"\"A Text object that can be baked and transformed in Grasshopper.\n\n    The code for this entire class was taken from David Rutten and Giulio Piacentino's\n    script described here:\n    https://discourse.mcneel.com/t/creating-text-objects-and-outputting-them-as-normal-rhino-geometry/47834/7\n\n    Args:\n        text: A Rhino Text3d object.\n    \"\"\"\n\n    def __init__(self, text):\n        \"\"\"Initialize Bake-able text.\"\"\"\n        self.m_value = text\n\n    @staticmethod\n    def DuplicateText3d(original):\n        if original is None:\n            return None\n        text = rh.Display.Text3d(original.Text, original.TextPlane, original.Height)\n        text.Bold = original.Bold\n        text.Italic = original.Italic\n        text.FontFace = original.FontFace\n        return text\n\n    def DuplicateGeometry(self):\n        return TextGoo(TextGoo.DuplicateText3d(self.m_value))\n\n    def get_TypeName(self):\n        return \"3D Text\"\n\n    def get_TypeDescription(self):\n        return \"3D Text\"\n\n    def get_Boundingbox(self):\n        if self.m_value is None:\n            return rh.Geometry.BoundingBox.Empty\n        return self.m_value.BoundingBox\n\n    def GetBoundingBox(self, xform):\n        if self.m_value is None:\n            return rh.Geometry.BoundingBox.Empty\n        box = self.m_value.BoundingBox\n        corners = xform.TransformList(box.GetCorners())\n        return rh.Geometry.BoundingBox(corners)\n\n    def Transform(self, xform):\n        text = TextGoo.DuplicateText3d(self.m_value)\n        if text is None:\n            return TextGoo(None)\n\n        plane = text.TextPlane\n        point = plane.PointAt(1, 1)\n\n        plane.Transform(xform)\n        point.Transform(xform)\n        dd = point.DistanceTo(plane.Origin)\n\n        text.TextPlane = plane\n        text.Height *= dd / math.sqrt(2)\n        new_text = TextGoo(text)\n\n        new_text.m_value.Bold = self.m_value.Bold\n        new_text.m_value.Italic = self.m_value.Italic\n        new_text.m_value.FontFace = self.m_value.FontFace\n        return new_text\n\n    def Morph(self, xmorph):\n        return self.DuplicateGeometry()\n\n    def get_ClippingBox(self):\n        return self.get_Boundingbox()\n\n    def DrawViewportWires(self, args):\n        if self.m_value is None:\n            return\n        color = black() if black is not None else args.Color\n        args.Pipeline.Draw3dText(self.m_value, color)\n\n    def DrawViewportMeshes(self, args):\n        # Do not draw in meshing layer.\n        pass\n\n    def BakeGeometry(self, doc, att, id):\n        id = guid.Empty\n        if self.m_value is None:\n            return False, id\n        if att is None:\n            att = doc.CreateDefaultAttributes()\n        original_plane = None\n        d_txt = self.m_value.Text\n        nl_count = len(d_txt.split('\\n')) - 1\n        if nl_count > 1 and str(self.m_value.VerticalAlignment) == 'Bottom':\n            y_ax = rh.Geometry.Vector3d(self.m_value.TextPlane.YAxis)\n            txt_h = self.m_value.Height * (3 / 2)\n            m_vec = rh.Geometry.Vector3d.Multiply(y_ax, txt_h * -nl_count)\n            original_plane = self.m_value.TextPlane\n            new_plane = rh.Geometry.Plane(self.m_value.TextPlane)\n            new_plane.Translate(m_vec)\n            self.m_value.TextPlane = new_plane\n        self.m_value.Height = self.m_value.Height\n        doc.ModelSpaceAnnotationScalingEnabled = False  # disable model scale\n        id = doc.Objects.AddText(self.m_value, att)\n        self.m_value.Height = self.m_value.Height\n        if original_plane is not None:\n            self.m_value.TextPlane = original_plane\n        return True, id\n\n    def ScriptVariable(self):\n        \"\"\"Overwrite Grasshopper ScriptVariable method.\"\"\"\n        return self\n\n    def ToString(self):\n        \"\"\"Overwrite .NET ToString method.\"\"\"\n        return self.__repr__()\n\n    def __repr__(self):\n        if self.m_value is None:\n            return \"<null>\"\n        return self.m_value.Text\n\n\nclass AlignmentTypes(object):\n    \"\"\"Enumeration of text alignment types.\"\"\"\n\n    _HORIZONTAL = (rh.DocObjects.TextHorizontalAlignment.Left,\n                   rh.DocObjects.TextHorizontalAlignment.Center,\n                   rh.DocObjects.TextHorizontalAlignment.Right)\n\n    _VERTICAL = (rh.DocObjects.TextVerticalAlignment.Top,\n                 rh.DocObjects.TextVerticalAlignment.MiddleOfTop,\n                 rh.DocObjects.TextVerticalAlignment.BottomOfTop,\n                 rh.DocObjects.TextVerticalAlignment.Middle,\n                 rh.DocObjects.TextVerticalAlignment.MiddleOfBottom,\n                 rh.DocObjects.TextVerticalAlignment.Bottom,\n                 rh.DocObjects.TextVerticalAlignment.BottomOfBoundingBox)\n\n    @classmethod\n    def horizontal(cls, field_number):\n        \"\"\"Get a Rhino horizontal alignment object by its integer field number.\n\n        * 0 - Left\n        * 1 - Center\n        * 2 - Right\n\n        \"\"\"\n        return cls._HORIZONTAL[field_number]\n\n    @classmethod\n    def vertical(cls, field_number):\n        \"\"\"Get a Rhino vertical alignment object by its integer field number.\n\n        * 0 - Top\n        * 1 - MiddleOfTop\n        * 2 - BottomOfTop\n        * 3 - Middle\n        * 4 - MiddleOfBottom\n        * 5 - Bottom\n        * 6 - BottomOfBoundingBox\n\n        \"\"\"\n        return cls._VERTICAL[field_number]\n",
  "language": "python",
  "imports": [
    "Rhino"
  ],
  "has_docstring": true
}