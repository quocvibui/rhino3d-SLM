{
  "source_url": "https://github.com/chriswmackey/lbt-rhino/blob/d650b6631f4a5708f4472427d076c2343c569ac2/libraries/ladybug_rhino/fromgeometry.py",
  "repo": "chriswmackey/lbt-rhino",
  "repo_stars": 0,
  "repo_description": "A set of Rhino scripts that run Ladybug Tools as commands.",
  "license": "AGPL-3.0",
  "filepath": "libraries/ladybug_rhino/fromgeometry.py",
  "instruction": "Functions to translate from Ladybug geometries to Rhino geometries.",
  "code": "\"\"\"Functions to translate from Ladybug geometries to Rhino geometries.\"\"\"\nfrom .config import tolerance\nfrom .color import color_to_color, gray\n\ntry:\n    import Rhino.Geometry as rg\nexcept ImportError as e:\n    raise ImportError('Failed to import Rhino Geometry.\\n{}'.format(e))\n\ntry:\n    from ladybug_geometry.geometry2d import LineSegment2D, Polygon2D\nexcept ImportError as e:\n    raise ImportError('Failed to import ladybug_geometry.\\n{}'.format(e))\n\n\n\"\"\"____________2D GEOMETRY TRANSLATORS____________\"\"\"\n\n\ndef from_vector2d(vector):\n    \"\"\"Rhino Vector3d from ladybug Vector2D.\"\"\"\n    return rg.Vector3d(vector.x, vector.y, 0)\n\n\ndef from_point2d(point, z=0):\n    \"\"\"Rhino Point3d from ladybug Point2D.\"\"\"\n    return rg.Point3d(point.x, point.y, z)\n\n\ndef from_ray2d(ray, z=0):\n    \"\"\"Rhino Ray3d from ladybug Ray2D.\"\"\"\n    return rg.Ray3d(from_point2d(ray.p, z), from_vector2d(ray.v))\n\n\ndef from_linesegment2d(line, z=0):\n    \"\"\"Rhino LineCurve from ladybug LineSegment2D.\"\"\"\n    return rg.LineCurve(from_point2d(line.p1, z), from_point2d(line.p2, z))\n\n\ndef from_arc2d(arc, z=0):\n    \"\"\"Rhino Arc from ladybug Arc2D.\"\"\"\n    if arc.is_circle:\n        return rg.Circle(from_point2d(arc.c, z), arc.r)\n    else:\n        pts = (arc.p1, arc.midpoint, arc.p2)\n        return rg.Arc(*(from_point2d(pt, z) for pt in pts))\n\n\ndef from_polygon2d(polygon, z=0):\n    \"\"\"Rhino closed PolyLineCurve from ladybug Polygon2D.\"\"\"\n    return rg.PolylineCurve(\n        [from_point2d(pt, z) for pt in polygon.vertices] + [from_point2d(polygon[0], z)])\n\n\ndef from_polyline2d(polyline, z=0):\n    \"\"\"Rhino closed PolyLineCurve from ladybug Polyline2D.\"\"\"\n    rhino_pts = [from_point2d(pt, z) for pt in polyline.vertices]\n    if polyline.interpolated:\n        return rg.Curve.CreateInterpolatedCurve(\n            rhino_pts, 3, rg.CurveKnotStyle.UniformPeriodic)\n    else:\n        return rg.PolylineCurve(rhino_pts)\n\n\ndef from_mesh2d(mesh, z=0):\n    \"\"\"Rhino Mesh from ladybug Mesh2D.\"\"\"\n    pt_function = _get_point2d_function(z)\n    return _translate_mesh(mesh, pt_function)\n\n\ndef _get_point2d_function(z_val):\n    def point2d_function(pt):\n        return from_point2d(pt, z_val)\n    return point2d_function\n\n\n\"\"\"____________3D GEOMETRY TRANSLATORS____________\"\"\"\n\n\ndef from_vector3d(vector):\n    \"\"\"Rhino Vector3d from ladybug Vector3D.\"\"\"\n    return rg.Vector3d(vector.x, vector.y, vector.z)\n\n\ndef from_point3d(point):\n    \"\"\"Rhino Point3d from ladybug Point3D.\"\"\"\n    return rg.Point3d(point.x, point.y, point.z)\n\n\ndef from_ray3d(ray):\n    \"\"\"Rhino Ray3d from ladybug Ray3D.\"\"\"\n    return rg.Ray3d(from_point3d(ray.p), from_vector3d(ray.v))\n\n\ndef from_linesegment3d(line):\n    \"\"\"Rhino LineCurve from ladybug LineSegment3D.\"\"\"\n    return rg.LineCurve(from_point3d(line.p1), from_point3d(line.p2))\n\n\ndef from_plane(pl):\n    \"\"\"Rhino Plane from ladybug Plane.\"\"\"\n    return rg.Plane(from_point3d(pl.o), from_vector3d(pl.x), from_vector3d(pl.y))\n\n\ndef from_arc3d(arc):\n    \"\"\"Rhino Arc from ladybug Arc3D.\"\"\"\n    if arc.is_circle:\n        return rg.Circle(from_plane(arc.plane), from_point3d(arc.c), arc.radius)\n    else:\n        pts = (arc.p1, arc.midpoint, arc.p2)\n        return rg.Arc(*(from_point3d(pt) for pt in pts))\n\n\ndef from_polyline3d(polyline):\n    \"\"\"Rhino closed PolyLineCurve from ladybug Polyline3D.\"\"\"\n    rhino_pts = [from_point3d(pt) for pt in polyline.vertices]\n    if polyline.interpolated:\n        return rg.Curve.CreateInterpolatedCurve(\n            rhino_pts, 3, rg.CurveKnotStyle.UniformPeriodic)\n    else:\n        return rg.PolylineCurve(rhino_pts)\n\n\ndef from_mesh3d(mesh):\n    \"\"\"Rhino Mesh from ladybug Mesh3D.\"\"\"\n    return _translate_mesh(mesh, from_point3d)\n\n\ndef from_face3d(face):\n    \"\"\"Rhino Brep from ladybug Face3D.\"\"\"\n    segs = [from_linesegment3d(seg) for seg in face.boundary_segments]\n    try:\n        brep = rg.Brep.CreatePlanarBreps(segs, tolerance)[0]\n    except TypeError:  # not planar in Rhino model tolerance; maybe from another model\n        print('Brep not planar in Rhino model tolerance. Ignoring tolerance.')\n        try:\n            brep = rg.Brep.CreatePlanarBreps(segs)[0]\n        except TypeError:  # it must be a zero-area geometry\n            return None\n    if face.has_holes:\n        for hole in face.hole_segments:\n            trim_crvs = [from_linesegment3d(seg) for seg in hole]\n            brep.Loops.AddPlanarFaceLoop(0, rg.BrepLoopType.Inner, trim_crvs)\n    return brep\n\n\ndef from_polyface3d(polyface):\n    \"\"\"Rhino Brep from ladybug Polyface3D.\"\"\"\n    rh_faces = [from_face3d(face) for face in polyface.faces]\n    brep = rg.Brep.JoinBreps(rh_faces, tolerance)\n    if len(brep) == 1:\n        return brep[0]\n\n\ndef from_sphere(sphere):\n    \"\"\"Rhino Sphere from ladybug Sphere.\"\"\"\n    return rg.Sphere(from_point3d(sphere.center), sphere.radius)\n\n\ndef from_cone(cone):\n    \"\"\"Rhino Cone from ladybug Cone.\"\"\"\n    plane = rg.Plane(from_point3d(cone.vertex), from_vector3d(cone.axis.normalize()))\n    return rg.Cone(plane, cone.height, cone.radius)\n\n\ndef from_cylinder(cylinder):\n    \"\"\"Rhino Cone from ladybug Cone.\"\"\"\n    return rg.Cylinder(from_arc3d(cylinder.base_bottom), cylinder.height)\n\n\n\"\"\"________ADDITIONAL 3D GEOMETRY TRANSLATORS________\"\"\"\n\n\ndef from_polyline2d_to_joined_polyline(polylines, z=0):\n    \"\"\"Rhino PolylineCurve made by joining list of Polyline2D.\n\n    Args:\n        polylines: An array of Ladybug Polyline2D or LineSegment2D to be joined\n            into a polyline. This can also be an array with a single Polygon2D.\n        z: A number for the Z-coordinate. (Default: 0).\n\n    Returns:\n        A Rhino brep constructed from the polygon and the offset distance. If offset\n        is unsuccessful, just the polyline will be returned.\n    \"\"\"\n    line_crv = []\n    for pl in polylines:\n        if isinstance(pl, Polygon2D):\n            return from_polygon2d(pl)\n        if isinstance(pl, LineSegment2D):\n            line_crv.append(from_linesegment2d(pl))\n        else:\n            line_crv.append(from_polyline2d(pl))\n    return rg.Curve.JoinCurves(line_crv)[0]\n\n\ndef from_polyline2d_to_offset_brep(polylines, offset, z=0):\n    \"\"\"Rhino Brep made by offsetting a joined list of Polyline2D inward.\n\n    Args:\n        polylines: An array of Ladybug Polyline2D or LineSegment2D to be joined\n            and translated to an offset Brep. This can also be an array with\n            a single Polygon2D.\n        offset: A number for the distance to offset the Polygon inward.\n        z: A number for the Z-coordinate. (Default: 0).\n\n    Returns:\n        A Rhino brep constructed from the polygon and the offset distance. If offset\n        is unsuccessful, just the polyline will be returned.\n    \"\"\"\n    curve = from_polyline2d_to_joined_polyline(polylines, z)\n    crv_style = rg.CurveOffsetCornerStyle.Sharp\n    all_curves = [curve]\n    off_curves = curve.Offset(rg.Plane.WorldXY, -offset, tolerance, crv_style)\n    if off_curves is not None:\n        all_curves.extend(off_curves)\n        offset_brep = rg.Brep.CreatePlanarBreps(all_curves)\n        if len(offset_brep) == 1:\n            if offset_brep[0].Loops.Count == 2:\n                return offset_brep[0]\n    return curve\n\n\ndef from_face3d_to_wireframe(face):\n    \"\"\"Rhino PolyLineCurves from ladybug Face3D.\n\n    Args:\n        face: A Ladybug Face3D object to be translated to a wireframe.\n\n    Returns:\n        A list of Rhino polyline curves for the boundary and holes in the face.\n    \"\"\"\n    boundary = [_polyline_points(face.boundary)]\n    if face.has_holes:\n        return boundary + [_polyline_points(tup) for tup in face.holes]\n    return boundary\n\n\ndef from_polyface3d_to_wireframe(polyface):\n    \"\"\"Rhino PolyLineCurve from ladybug Polyface3D.\"\"\"\n    return [f for face in polyface.faces for f in from_face3d_to_wireframe(face)]\n\n\ndef from_face3d_to_solid(face, offset):\n    \"\"\"Rhino Solid Brep from a ladybug Face3D and an offset from the base face.\n\n    Args:\n        face: Ladybug geometry Face3D object.\n        offset: Number for the offset distance from the base face.\n    \"\"\"\n    srf_brep = from_face3d(face)\n    return rg.Brep.CreateFromOffsetFace(\n        srf_brep.Faces[0], offset, tolerance, False, True)\n\n\ndef from_face3ds_to_joined_brep(faces):\n    \"\"\"A list of joined Breps from an array of ladybug Face3D.\"\"\"\n    return rg.Brep.JoinBreps([from_face3d(face) for face in faces], tolerance)\n\n\ndef from_face3ds_to_colored_mesh(faces, color):\n    \"\"\"Colored Rhino mesh from an array of ladybug Face3D and ladybug Color.\n\n    This is used in workflows such as coloring Model geometry with results.\n    \"\"\"\n    joined_mesh = rg.Mesh()\n    for face in faces:\n        try:\n            joined_mesh.Append(from_mesh3d(face.triangulated_mesh3d))\n        except Exception:\n            pass  # failed to create a Rhino Mesh from the Face3D\n    joined_mesh.VertexColors.CreateMonotoneMesh(color_to_color(color))\n    return joined_mesh\n\n\ndef from_mesh2d_to_outline(mesh, z=0):\n    \"\"\"Rhino Polylines from the faces of ladybug Mesh2D.\"\"\"\n    pt_function = _get_point2d_function(z)\n    verts = [pt_function(pt) for pt in mesh.vertices]\n    face_plines = []\n    for face in mesh.faces:\n        outline = [verts[f] for f in face] + [verts[face[0]]]\n        face_plines.append(rg.PolylineCurve(outline))\n    return face_plines\n\n\ndef from_mesh3d_to_outline(mesh):\n    \"\"\"Rhino Mesh and Polylines from the ladybug Mesh3D.\n\n    Returns:\n        A tuple with two items - a Rhino Mesh first followed by outline curves\n        of the Mesh.\n    \"\"\"\n    rh_mesh = from_mesh3d(mesh)\n    return rh_mesh, rh_mesh.GetNakedEdges()\n\n\n\"\"\"________________EXTRA HELPER FUNCTIONS________________\"\"\"\n\n\ndef _translate_mesh(mesh, pt_function):\n    \"\"\"Translates both 2D and 3D meshes to Rhino\"\"\"\n    rhino_mesh = rg.Mesh()\n    if mesh.is_color_by_face:  # Mesh is constructed face-by-face\n        _f_num = 0\n        for face in mesh.faces:\n            for pt in tuple(mesh[i] for i in face):\n                rhino_mesh.Vertices.Add(pt_function(pt))\n            if len(face) == 4:\n                rhino_mesh.Faces.AddFace(\n                    _f_num, _f_num + 1, _f_num + 2, _f_num + 3)\n                _f_num += 4\n            else:\n                rhino_mesh.Faces.AddFace(_f_num, _f_num + 1, _f_num + 2)\n                _f_num += 3\n        if mesh.colors is not None:\n            rhino_mesh.VertexColors.CreateMonotoneMesh(gray())\n            _f_num = 0\n            for i, face in enumerate(mesh.faces):\n                col = color_to_color(mesh.colors[i])\n                rhino_mesh.VertexColors[_f_num] = col\n                rhino_mesh.VertexColors[_f_num + 1] = col\n                rhino_mesh.VertexColors[_f_num + 2] = col\n                if len(face) == 4:\n                    rhino_mesh.VertexColors[_f_num + 3] = col\n                    _f_num += 4\n                else:\n                    _f_num += 3\n    else:  # Mesh is constructed vertex-by-vertex\n        for pt in mesh.vertices:\n            rhino_mesh.Vertices.Add(pt_function(pt))\n        for face in mesh.faces:\n            rhino_mesh.Faces.AddFace(*face)\n        if mesh.colors is not None:\n            rhino_mesh.VertexColors.CreateMonotoneMesh(gray())\n            for i, col in enumerate(mesh.colors):\n                rhino_mesh.VertexColors[i] = color_to_color(col)\n    return rhino_mesh\n\n\ndef _polyline_points(tup):\n    \"\"\"Convert a tuple of Ladybug Geometry points to a Rhino Polyline.\"\"\"\n    return rg.PolylineCurve([from_point3d(pt) for pt in tup] + [from_point3d(tup[0])])\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}