{
  "source_url": "https://github.com/beyondepic/EPiC_Grasshopper/blob/dbd60529a190cebf1d0af4d6c2e0ec91e110e388/epic/src/EPiC_Material_Component.py",
  "repo": "beyondepic/EPiC_Grasshopper",
  "repo_stars": 18,
  "repo_description": "EPiC Grasshopper plug-in",
  "license": "GPL-3.0",
  "filepath": "epic/src/EPiC_Material_Component.py",
  "instruction": "Select a material from the EPiC Database\r\n\r\n    Inputs:\r\n        >>**Connect_Toggle_Switch_to_Activate: Connect a toggle switch and set to 'True' to activate this component.\r\n        (**REQUIRED)\r\n\r\n...",
  "code": "# -*- coding: UTF-8 -*-\r\n# EPiC Grasshopper: A Plugin for analysing embodied environmental flows\r\n#\r\n# Copyright (c) 2023, EPiC Grasshopper.\r\n# You should have received a copy of the GNU General Public License\r\n# along with EPiC Grasshopper; If not, see <http://www.gnu.org/licenses/>.\r\n#\r\n# Further information about the EPiC Database can be found at <https://bit.ly/EPiC_Database>\r\n# To download a full copy of the database, goto <http://doi.org/10.26188/5dc228ef98c5a>\r\n#\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\n\r\n\"\"\"\r\nSelect a material from the EPiC Database\r\n\r\n    Inputs:\r\n        >>**Connect_Toggle_Switch_to_Activate: Connect a toggle switch and set to 'True' to activate this component.\r\n        (**REQUIRED)\r\n\r\n        **Material_Category: Once the EPiC Material component has been activated,\r\n        a value list will be automatically generated with pre-filled categories wired to this input.\r\n        *** To reset this input, delete any connected wires, and re-activate the button ***\r\n\r\n        **Selected_Material: Once the EPiC Material component has been activated,\r\n        a value list will be automatically generated with pre-filled materials, based on the selected category (above).\r\n        *** To reset this input, delete any connected wires, and re-activate the button ***\r\n\r\n        Wastage_Coefficient_(%): Estimated wastage percentage (%) for the material.\r\n        This will use the default value for the material (if it exists in the database), otherwise it will default to 0.\r\n        0 indicates no wastage, 100 indicates 100% wastage.\r\n        ***Optional***\r\n\r\n        Material_Service_Life_(Years): Estimated service_life (in years) for the material.\r\n        This will use the default value for the material (if it exists in the database), otherwise it will default to 0.\r\n        0 indicates that the material will never need to be replaced.\r\n        ***Optional***\r\n\r\n        Energy_Reduction_Factor_(%): Reduce the value of the energy coefficient by a percentage\r\n        0(%) indicates no change, 50(%) half of the value, and 100(%) reduces the energy coefficient to zero\r\n        ***Optional***\r\n\r\n        Water_Reduction_Factor_(%): Reduce the value of the water coefficient by a percentage\r\n        0(%) indicates no change, 50(%) half of the value, and 100(%) reduces the water coefficient to zero\r\n        ***Optional***\r\n\r\n        GHG_Reduction_Factor_(%): Reduce the value of the GHG emissions coefficient by a percentage\r\n        0(%) indicates no change, 50(%) half of the value, and 100(%) reduces the GHG emissions coefficient to zero\r\n        ***Optional***\r\n        Comments: Comments about the material - these will appear in the printed/exported reports.\r\n        ***Optional***\r\n\r\n        >>Connect_Toggle_Switch_to_Open_EPiC_Database: Connect a toggle switch and set to True.\r\n        This will open https://bit.ly/EPiC_Database in a web browser\r\n\r\n    Outputs:\r\n        EPiC_Material: Outputs a class object (EPiCMaterial) containing all of the embedded material attributes:\r\n        (name, energy, water, ghg, functional_unit, doi, category, material_id, wastage, service_life, comments)\r\n        ***Connect that output to a panel for a summary***\r\n\r\n        Embodied_Energy_Coefficient_(MJ/FU): The Embodied Energy Coefficient for this material.\r\n        Values are imported from the EPiC Database\r\n        ***Note this does not include wastage in the calculation***\r\n\r\n        Embodied_Water_Coefficient_(L/FU): The Embodied Water Coefficient for this material.\r\n        Values are imported from the EPiC Database.\r\n        ***Note this does not include wastage in the calculation***\r\n\r\n        Embodied_GHG_Coefficient_(kgCO₂e/FU): The Embodied Greenhouse Gas Emissions Coefficient for this material.\r\n        Values are imported from the EPiC Database.\r\n        ***Note this does not include wastage in the calculation***\r\n\r\n        Digital Object Identifier (DOI): A link to the material information sheet in the EPiC Database\r\n\r\n        Density_(kg/m³): Material density, as provided in the EPiC Database\r\n\r\n        Functional_Unit: Functional Unit, as provided in the EPiC Database\r\n\r\n        Wastage_Coefficient_(%): Estimated wastage percentage (%) for the material.\r\n        This will use the default value for the material (if it exists in the database), otherwise it will default to 0.\r\n        0 indicates no wastage, 100 indicates 100% wastage\r\n\r\n        Material_Service_Life_(Years): Estimated service_life (in years) for the material.\r\n        This will use the default value for the material (if it exists in the database), otherwise it will default to 0.\r\n        0 indicates that the material will never need to be replaced\r\n\r\n        Disclaimer: Disclaimer of the authors associated with the use of the EPiC Grasshopper plugin\r\n\"\"\"\r\n\r\nimport webbrowser\r\nfrom Grasshopper.Kernel.Special import GH_NumberSlider\r\nfrom Grasshopper import Folders\r\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\r\nfrom ghpythonlib.componentbase import executingcomponent as component\r\nfrom scriptcontext import sticky as st\r\n\r\nimport epic\r\n\r\n# Allow realtime feedback with external python files in grasshopper\r\nepic = reload(epic)\r\n\r\n\r\nclass EPiCMaterialComponent(component):\r\n\r\n    def RunScript(self,\r\n                  connect_button,\r\n                  material_category,\r\n                  material_id,\r\n                  comments,\r\n                  _null,\r\n                  wastage,\r\n                  service_life,\r\n                  _null2,\r\n                  energy_reduction,\r\n                  water_reduction,\r\n                  ghg_reduction,\r\n                  _null3,\r\n                  epic_help):\r\n\r\n        # Component and version information\r\n        __author__ = epic.__author__\r\n        __version__ = \"1.02\"\r\n        if __version__ == epic.__version__:\r\n            ghenv.Component.Message = epic.__message__\r\n        else:\r\n            ghenv.Component.Message = epic.version_mismatch(__version__)\r\n            ghenv.Component.AddRuntimeMessage(RML.Remark, ghenv.Component.Message)\r\n        ghenv.Component.Name = \"EPiC Material\"\r\n        ghenv.Component.NickName = \"EPiC Material\"\r\n\r\n        # Setup a global sticky variable for the component, ensuring sliders component are not continuously generated.\r\n        component_id = ghenv.Component.InstanceGuid\r\n        if component_id not in st:\r\n            st[component_id] = material_id\r\n\r\n        # Open the EPiC Database or EPiC Grasshopper Bugs / Suggestions Google Form\r\n        if epic_help:\r\n            webbrowser.open(\"https://bit.ly/EPiC_Database\", new=1)\r\n\r\n        # Specify the directory where the EPiC Database is stored (usually the grasshopper library folder), only load once into sticky dictionary\r\n        if 'epic_db' not in st:\r\n            st['epic_db'] = epic.EPiCDatabase(Folders.DefaultAssemblyFolder)\r\n        epic_db = st['epic_db']\r\n\r\n        if material_category:\r\n            if isinstance(material_category, list):\r\n                material_category = material_category[0]\r\n            if ':' in material_category:\r\n                material_category = material_category.split(': ')[1]\r\n\r\n        # Generate a material and category list when button is turned on\r\n        if connect_button:\r\n            if not material_id or not material_category:\r\n                if material_category:\r\n                    epic.EPiCMaterial.generate_material_and_category_dropdown_list(ghenv.Component, ghenv, epic_db,\r\n                                                                                   category=material_category)\r\n                else:\r\n                    epic.EPiCMaterial.generate_material_and_category_dropdown_list(ghenv.Component, ghenv, epic_db)\r\n                # Reset the global sticky value\r\n                st[component_id] = None\r\n\r\n        # Make sure that a material category & material have been selected\r\n        if material_id and material_category:\r\n\r\n            # Flatten material category list and remove number from start of string\r\n\r\n            # Test if the selected material is in the selected category\r\n            if material_id not in epic_db.dict_of_categories[material_category]:\r\n\r\n                # Test if material is in old database\r\n                legacy_material = epic_db._query_for_name_or_old_mat_id(material_id)\r\n                if legacy_material:\r\n                    material_id = legacy_material\r\n                    ghObject = ghenv.Component.Params.Input[2].Sources[0]\r\n                    epic.EPiCMaterial.recreate_material_list(epic_db, ghObject, material_category, ghenv.Component,\r\n                                                             set_material=material_id)\r\n                else:\r\n                    ghObject = ghenv.Component.Params.Input[2].Sources[0]\r\n                    epic.EPiCMaterial.recreate_material_list(epic_db, ghObject, material_category, ghenv.Component)\r\n            # Load the material values from the database\r\n            energy, water, ghg, functional_unit, name, doi, category, density = \\\r\n                epic_db.query(material_id, ['Energy', 'Water', 'GHG', 'Functional Unit', 'name',\r\n                                            'DOI', 'Category', 'Density'])\r\n            process_shares = {flow: epic_db.query(material_id, 'hybrid_process_proportion_' + str(flow)) for\r\n                              flow in epic.DEFINED_FLOWS.keys()}\r\n\r\n            # Only run this code if the material selection has changed. Uses global sticky to track material choice.\r\n            if material_id != st[component_id]:\r\n                # Fetch the wastage/service life coefficient from the EPiCDB (if exists)\r\n                try:\r\n                    # In db, wastage coefficient of 1 = 0%, 1.1 = 10%. Scale accordingly\r\n                    # In db, service life of -1 = no service life.\r\n                    epic_wastage = (epic_db.query(material_id, 'Wastage') - 1) * 100\r\n                    epic_service_life = (epic_db.query(material_id, 'Service Life'))\r\n                    if epic_service_life == -1 or not epic_service_life:\r\n                        epic_service_life = 0\r\n                except TypeError:\r\n                    epic_wastage = 0\r\n                    epic_service_life = 0\r\n\r\n                # Generate a slider input and set wastage/service life. If one already exists, change the value to new material.\r\n                for input in [(5, epic_wastage), (6, epic_service_life)]:\r\n                    if not ghenv.Component.Params.Input[input[0]].Sources:\r\n                        epic.EPiCMaterial.generate_slider_input(ghenv.Component, None, input[1], input[0])\r\n                    else:\r\n                        list_object = ghenv.Component.Params.Input[input[0]].Sources[0]\r\n                        # Only change value if input is a number slider, otherwise leave untouched\r\n                        if isinstance(list_object, GH_NumberSlider):\r\n                            ghenv.Component.OnPingDocument().ScheduleSolution(5,\r\n                                                                              ScheduleCallback(list_object, input[1]))\r\n\r\n                # Reset global sticky value to the current material selection choice\r\n                st[component_id] = material_id\r\n\r\n            # Include reduction factor for materials\r\n            if water and ghg and energy:\r\n                energy = energy if not energy_reduction and energy_reduction != 0 \\\r\n                    else energy / 100 * abs(100 - energy_reduction)\r\n                water = water if not water_reduction and water_reduction != 0 else water / 100 * abs(\r\n                    100 - water_reduction)\r\n                ghg = ghg if not ghg_reduction and ghg_reduction != 0 else ghg / 100 * abs(100 - ghg_reduction)\r\n\r\n            # Create the EPiCMaterial class object\r\n            output_epic_material = epic.EPiCMaterial(name=name, water=water, ghg=ghg, energy=energy,\r\n                                                     functional_unit=functional_unit, doi=doi, category=category,\r\n                                                     material_id=material_id, wastage=wastage,\r\n                                                     service_life=service_life,\r\n                                                     comments=comments,\r\n                                                     density=density,\r\n                                                     process_shares=process_shares)\r\n\r\n            # Component outputs\r\n            return output_epic_material, None, output_epic_material.energy, output_epic_material.water, \\\r\n                output_epic_material.ghg, None, output_epic_material.doi, output_epic_material.density, \\\r\n                output_epic_material.functional_unit, wastage, service_life, epic.DISCLAIMER\r\n\r\n        # Raise error when there is no material and category selected\r\n        else:\r\n            warning = 'Connect a button to the first input, and activate to generate a material & category list'\r\n            ghenv.Component.AddRuntimeMessage(RML.Warning, warning)\r\n            return [warning] * 11 + [epic.DISCLAIMER]\r\n\r\n\r\ndef ScheduleCallback(obj, val=0):\r\n    if val:\r\n        if val > 100:\r\n            obj.Slider.Maximum = val\r\n        obj.Slider.Value = val",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "scriptcontext"
  ],
  "has_docstring": true
}