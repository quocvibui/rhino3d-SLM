{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/spb_NurbsObjs_SelGrips_AddInterior.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "spb_NurbsObjs_SelGrips_AddInterior.py",
  "instruction": "This script will select grips interior of those already selected in NURBS curves and surfaces.",
  "code": "\"\"\"\r\nThis script will select grips interior of those already selected in NURBS curves and surfaces.\r\n\"\"\"\r\n\r\n#! python 2  Must be on a line number less than 32.\r\nfrom __future__ import absolute_import, division, print_function, unicode_literals\r\n\r\n\"\"\"\r\n250129: Created.\r\n\r\nApparently, overloads for GripObject.Select for syncHighlight and persistentSelect are not needed\r\nfor both to be true after script completes. Was there a modification to the method since V5?\r\n\"\"\"\r\n\r\nimport Rhino.DocObjects as rd\r\nimport Rhino.Geometry as rg\r\nimport scriptcontext as sc\r\n\r\n\r\ndef _getOwnersOfSelectedGrips():\r\n    gOwners = []\r\n    rdOwners = []\r\n    rdSelected = list(sc.doc.Objects.GetSelectedObjects(includeLights=False, includeGrips=True))\r\n    for rdObj in rdSelected:\r\n        if rdObj.ObjectType != rd.ObjectType.Grip:\r\n            continue\r\n        gOwner = rdObj.OwnerId\r\n        if gOwner in gOwners:\r\n            continue\r\n        rdOwner = sc.doc.Objects.FindId(gOwner)\r\n        if rdOwner.ObjectType not in (rd.ObjectType.Brep, rd.ObjectType.Curve):\r\n            continue\r\n        rgOwner = rdOwner.Geometry\r\n        if not isinstance(rgOwner, (rg.Brep, rg.NurbsCurve)):\r\n            continue\r\n        if isinstance(rgOwner, rg.Brep):\r\n            if rgOwner.Faces.Count != 1:\r\n                continue\r\n            if not isinstance(rgOwner.Faces[0].UnderlyingSurface(), rg.NurbsSurface):\r\n                continue\r\n        gOwners.append(gOwner)\r\n        rdOwners.append(rdOwner)\r\n\r\n    return rdOwners\r\n\r\n\r\ndef _addInteriorGripsToSelected_NurbsCrv(rdCurve):\r\n\r\n    idxs_CPs_All = []\r\n    rdGrips = rdCurve.GetGrips()\r\n    for rdGrip in rdGrips:\r\n        if rdGrip.IsSelected(checkSubObjects=False):\r\n            iCt_Cps, idxs_CPs_Now = rdGrip.GetCurveCVIndices()\r\n            for i in idxs_CPs_Now:\r\n                if i not in idxs_CPs_All:\r\n                    idxs_CPs_All.append(i)\r\n\r\n    if len(idxs_CPs_All) < 2:\r\n        return []\r\n\r\n    nc = rdCurve.CurveGeometry\r\n\r\n    rdGrips_Added = []\r\n\r\n    for i in range(min(idxs_CPs_All)+1, max(idxs_CPs_All)):\r\n        rdGrip = rdGrips[i]\r\n        if not rdGrip.IsSelected(checkSubObjects=False):\r\n            if rdGrip.Select(True):\r\n                rdGrips_Added.append(rdGrip)\r\n\r\n    return rdGrips_Added\r\n\r\n\r\ndef _addInteriorGripsToSelection_Brep_1Face(rdBrep):\r\n\r\n    iVs_perU = {}\r\n    iUs_perV = {}\r\n    rdGrips = rdBrep.GetGrips()\r\n    for rdGrip in rdGrips:\r\n        if rdGrip.IsSelected(checkSubObjects=False):\r\n            iCt_Cps, idxs_UVs = rdGrip.GetSurfaceCVIndices()\r\n            for idxs_UV in idxs_UVs:\r\n                iU, iV = idxs_UV\r\n                if iU not in iVs_perU:\r\n                    iVs_perU[iU] = [iV]\r\n                else:\r\n                    iVs_perU[iU].append(iV)\r\n                if iV not in iUs_perV:\r\n                    iUs_perV[iV] = [iU]\r\n                else:\r\n                    iUs_perV[iV].append(iU)\r\n\r\n    if not iVs_perU and not iUs_perV:\r\n        return []\r\n\r\n    ns = rdBrep.BrepGeometry.Faces[0].UnderlyingSurface()\r\n\r\n    rdGrips_Added = []\r\n\r\n    for iU in iVs_perU:\r\n        if len(iVs_perU[iU]) == 1:\r\n            continue\r\n        for iV in range(min(iVs_perU[iU])+1, max(iVs_perU[iU])):\r\n            rdGrip = rdGrips[iU*ns.Points.CountV + iV]\r\n            if not rdGrip.IsSelected(checkSubObjects=False):\r\n                if rdGrip.Select(True):\r\n                    rdGrips_Added.append(rdGrip)\r\n\r\n    for iV in iUs_perV:\r\n        if len(iUs_perV[iV]) == 1:\r\n            continue\r\n        for iU in range(min(iUs_perV[iV])+1, max(iUs_perV[iV])):\r\n            rdGrip = rdGrips[iU*ns.Points.CountV + iV]\r\n            if not rdGrip.IsSelected(checkSubObjects=False):\r\n                if rdGrip.Select(True):\r\n                    rdGrips_Added.append(rdGrip)\r\n\r\n    return rdGrips_Added\r\n\r\n\r\ndef _addInteriorGripsToSelected(rdOwner):\r\n    if isinstance(rdOwner, rd.BrepObject):\r\n        return _addInteriorGripsToSelection_Brep_1Face(rdBrep=rdOwner)\r\n    elif isinstance(rdOwner, rd.CurveObject):\r\n        return _addInteriorGripsToSelected_NurbsCrv(rdCurve=rdOwner)\r\n    else:\r\n        raise Exception(\"{} not suppored input for _addInteriorGripsToSelected.\".format(rdOwner))\r\n\r\n\r\ndef main():\r\n\r\n    rdOwners = _getOwnersOfSelectedGrips()\r\n    if not rdOwners: return\r\n    \r\n    rdGrips_Added_All = []\r\n\r\n    for rdOwner in rdOwners:\r\n        rdGrips_Added_All.extend(_addInteriorGripsToSelected(rdOwner))\r\n\r\n    if not rdGrips_Added_All:\r\n        print(\"No grips were selected.\")\r\n        return\r\n\r\n    print(\"{} surface grips are selected.\".format(len(rdGrips_Added_All)))\r\n\r\n    sc.doc.Views.Redraw()\r\n\r\n\r\nif __name__ == '__main__': main()",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}