{
  "source_url": "https://github.com/jongarrison/splint_geo_processor/blob/b4a410b94aa8ddd9dad7ee8d35d452964254ef41/generators/src/BrepInspect.py",
  "repo": "jongarrison/splint_geo_processor",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "generators/src/BrepInspect.py",
  "instruction": "Grasshopper Python Component: Brep Inspection Validator",
  "code": "\"\"\"\nGrasshopper Python Component: Brep Inspection Validator\n\nINPUTS:\n    Brep: Brep to inspect (Brep)\n    Verbose: Print detailed diagnostic info (bool, default: True)\n\nOUTPUTS:\n    IsValid: True if brep is usable for boolean operations (bool)\n\"\"\"\n\nimport Rhino.Geometry as rg\nimport scriptcontext as sc\nfrom splintcommon import log\n\ndef inspect_solid_brep(brep, verbose=True):\n    \"\"\"\n    Inspect a brep and determine if it's usable for boolean unions.\n    \n    Args:\n        brep: Rhino.Geometry.Brep to inspect\n        verbose: Print detailed diagnostic information\n    \n    Returns:\n        bool: True if usable for boolean operations\n    \"\"\"\n    \n    if not brep:\n        log(\"ERROR: No brep provided\")\n        return False\n    \n    # Track usability\n    is_usable = True\n    \n    log(\"=\" * 60)\n    log(\"BREP INSPECTION\")\n    log(\"=\" * 60)\n    log(\"Faces: {}\".format(brep.Faces.Count))\n    log(\"Valid: {}\".format(brep.IsValid))\n    log(\"Solid: {}\".format(brep.IsSolid))\n    log(\"Manifold: {}\".format(brep.IsManifold))\n    \n    # Check basic requirements\n    if not brep.IsValid:\n        is_usable = False\n        log(\"  -> UNUSABLE: Brep is not valid\")\n    if not brep.IsSolid:\n        is_usable = False\n        log(\"  -> UNUSABLE: Brep is not solid\")\n    if not brep.IsManifold:\n        is_usable = False\n        log(\"  -> UNUSABLE: Brep is not manifold\")\n    \n    # Check for self-intersections between faces (only if verbose)\n    if verbose:\n        log(\"\")\n        log(\"=\" * 60)\n        log(\"SELF-INTERSECTION CHECK\")\n        log(\"=\" * 60)\n    \n    interior_intersections_found = []\n    \n    for i, faceA in enumerate(brep.Faces):\n        for j, faceB in enumerate(brep.Faces):\n            if i < j:\n                try:\n                    result = rg.Intersect.Intersection.SurfaceSurface(\n                        faceA.UnderlyingSurface(), \n                        faceB.UnderlyingSurface(), \n                        0.01\n                    )\n                    if result[0]:\n                        curves = result[1]\n                        if curves and len(curves) > 0:\n                            # Check if intersection is at edge (normal) or interior (problem)\n                            for crv in curves:\n                                if crv:\n                                    is_at_edge = True\n                                    for t in [0.0, 0.5, 1.0]:\n                                        test_pt = crv.PointAt(crv.Domain.ParameterAt(t))\n                                        \n                                        closest_edge_dist = float('inf')\n                                        for edge in brep.Edges:\n                                            edge_param = edge.ClosestPoint(test_pt, 0.0)[1]\n                                            edge_pt = edge.PointAt(edge_param)\n                                            dist = test_pt.DistanceTo(edge_pt)\n                                            closest_edge_dist = min(closest_edge_dist, dist)\n                                        \n                                        if closest_edge_dist > 0.1:\n                                            is_at_edge = False\n                                            break\n                                    \n                                    if not is_at_edge:\n                                        interior_intersections_found.append((i, j))\n                                        is_usable = False\n                                        break\n                except:\n                    pass\n    \n    if len(interior_intersections_found) > 0:\n        log(\"INTERIOR SELF-INTERSECTIONS: {}\".format(len(interior_intersections_found)))\n        log(\"  -> UNUSABLE: Interior self-intersections detected\")\n    elif verbose:\n        log(\"No interior self-intersections detected\")\n    \n    # Check edges\n    naked_edges = [e for e in brep.Edges if e.Valence == rg.EdgeAdjacency.Naked]\n    \n    if len(naked_edges) > 0:\n        is_usable = False\n        log(\"  -> UNUSABLE: {} naked edges (solid should have none)\".format(len(naked_edges)))\n    \n    # Final verdict\n    log(\"\")\n    log(\"=\" * 60)\n    if is_usable:\n        log(\"VERDICT: USABLE for boolean unions\")\n    else:\n        log(\"VERDICT: NOT USABLE - see issues above\")\n    log(\"=\" * 60)\n    \n    return is_usable\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}