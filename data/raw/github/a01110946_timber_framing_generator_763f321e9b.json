{
  "source_url": "https://github.com/a01110946/timber_framing_generator/blob/0b689e23c0ee24a9cfbdf280b219f659a54afd43/scripts/gh_assembly_view_config.py",
  "repo": "a01110946/timber_framing_generator",
  "repo_stars": 3,
  "repo_description": "A Python tool bridging Revit and Rhino through Rhino.Inside.Revit to automate timber frame design. Processes Revit walls to generate complete framing solutions including studs, plates, headers, and cripples. Features intelligent wall decomposition, opening analysis, and automated documentation generation.",
  "license": "unknown",
  "filepath": "scripts/gh_assembly_view_config.py",
  "instruction": "Assembly View Config Builder for Grasshopper.",
  "code": "# File: scripts/gh_assembly_view_config.py\n\"\"\"Assembly View Config Builder for Grasshopper.\n\nBuilds a view_config_json string for the Revit Assembly Creator component.\nEach AssemblyViewConfig option is exposed as a separate GH input with sensible\ndefaults, so users can configure assembly views without hand-writing JSON.\n\nKey Features:\n1. One Input per Config Option\n   - Boolean toggles for each view type (3D, 6 elevations, material takeoff,\n     structural schedules, sheet)\n   - String inputs for Detail Level, Display Style, schedule fields, templates,\n     and title block name\n   - All inputs are optional; defaults match AssemblyViewConfig\n\n2. Validated Output\n   - Validates Detail Level and Display Style against allowed values\n   - Warns on invalid values and falls back to defaults\n   - Outputs compact JSON ready to connect to Assembly Creator\n\nEnvironment:\n    Rhino 8\n    Grasshopper\n    Python component (CPython 3)\n\nDependencies:\n    - Grasshopper: Component framework and runtime messages\n\nPerformance Considerations:\n    - Lightweight component, no Revit or geometry dependencies\n    - Instant execution, no toggle required\n\nUsage:\n    1. Drop the component onto the canvas\n    2. Optionally adjust inputs (all have defaults)\n    3. Connect 'view_config_json' output to Assembly Creator's\n       'View Config JSON' input\n\nInput Requirements:\n    Include 3D (include_3d) - bool:\n        Create a 3D orthographic assembly view.\n        Required: No (defaults to True)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Front Elevation (include_front) - bool:\n        Create a front elevation section view.\n        Required: No (defaults to True)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Top Elevation (include_top) - bool:\n        Create a top elevation section view.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Material Takeoff (include_takeoff) - bool:\n        Create a material takeoff schedule.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Detail Level (detail_level) - str:\n        View detail level. One of: \"Coarse\", \"Medium\", \"Fine\".\n        Required: No (defaults to \"Fine\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Display Style (display_style) - str:\n        View display style. One of: \"Wireframe\", \"HiddenLine\", \"Shaded\",\n        \"Shaded with Edges\", \"Consistent Colors\", \"Realistic\",\n        \"Realistic with Edges\".\n        Required: No (defaults to \"HiddenLine\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Include Back Elevation (include_back) - bool:\n        Create a back elevation section view.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Bottom Elevation (include_bottom) - bool:\n        Create a bottom elevation section view.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Left Elevation (include_left) - bool:\n        Create a left elevation section view.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Right Elevation (include_right) - bool:\n        Create a right elevation section view.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Column Schedule (include_col_sched) - bool:\n        Create a structural column schedule.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Framing Schedule (include_frm_sched) - bool:\n        Create a structural framing schedule.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Schedule Fields (schedule_fields) - str:\n        Comma-separated field names for structural schedules.\n        Empty = defaults (Family, Type, Cut Length).\n        Required: No (defaults to \"\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Schedule Template (schedule_template) - str:\n        View template name to apply to structural schedules.\n        Required: No (defaults to \"\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Takeoff Fields (takeoff_fields) - str:\n        Comma-separated field names for material takeoff.\n        Empty = defaults (Type, Count, Material: Name, Material: Area).\n        Required: No (defaults to \"\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Takeoff Template (takeoff_template) - str:\n        View template name to apply to material takeoff.\n        Required: No (defaults to \"\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\n    Hide Section Markers (hide_markers) - bool:\n        Hide section markers in elevation views.\n        Required: No (defaults to True)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Include Sheet (include_sheet) - bool:\n        Create a sheet per assembly with all views as viewports.\n        Required: No (defaults to False)\n        Access: Item\n        Type hint: bool (set via GH UI)\n\n    Titleblock Name (titleblock_name) - str:\n        Title block family name for sheet creation. Empty = no title block.\n        Required: No (defaults to \"\")\n        Access: Item\n        Type hint: str (set via GH UI)\n\nOutputs:\n    View Config JSON (view_config_json) - str:\n        JSON string with assembly view configuration, ready to connect\n        to the Assembly Creator component's View Config JSON input.\n\n    Info (info) - str:\n        Summary of the current configuration.\n\nTechnical Details:\n    - No Revit or RhinoCommon dependency -- pure Python JSON builder\n    - Reads inputs by parameter index (NickName injection is unreliable)\n    - Validates string inputs against allowed values\n\nError Handling:\n    - Invalid detail_level: warns and falls back to \"Fine\"\n    - Invalid display_style: warns and falls back to \"HiddenLine\"\n    - Missing inputs: uses defaults silently\n\nAuthor: Fernando Maytorena\nVersion: 2.0.0\n\"\"\"\n\nimport json\n\n# =============================================================================\n# .NET / CLR\n# =============================================================================\n\nimport clr\n\nclr.AddReference('Grasshopper')\n\n# =============================================================================\n# Rhino / Grasshopper\n# =============================================================================\n\nimport Grasshopper\n\n# =============================================================================\n# Constants\n# =============================================================================\n\nCOMPONENT_NAME = \"Assembly View Config\"\nCOMPONENT_NICKNAME = \"ViewCfg\"\nCOMPONENT_MESSAGE = \"v2.0\"\nCOMPONENT_CATEGORY = \"TFG\"\nCOMPONENT_SUBCATEGORY = \"Revit\"\n\nVALID_DETAIL_LEVELS = (\"Coarse\", \"Medium\", \"Fine\")\nVALID_DISPLAY_STYLES = (\n    \"Wireframe\", \"HiddenLine\", \"Shaded\", \"Shaded with Edges\",\n    \"Consistent Colors\", \"Realistic\", \"Realistic with Edges\",\n)\n\n# =============================================================================\n# Logging Utilities\n# =============================================================================\n\ndef log_message(message: str, level: str = \"info\") -> None:\n    \"\"\"Log to console and optionally add GH runtime message.\n\n    Args:\n        message: The message to log (ASCII only -- no unicode)\n        level: One of \"info\", \"debug\", \"warning\", \"error\", \"remark\"\n    \"\"\"\n    print(\"[%s] %s\" % (level.upper(), message))\n\n    if level == \"warning\":\n        ghenv.Component.AddRuntimeMessage(\n            Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, message)\n    elif level == \"error\":\n        ghenv.Component.AddRuntimeMessage(\n            Grasshopper.Kernel.GH_RuntimeMessageLevel.Error, message)\n    elif level == \"remark\":\n        ghenv.Component.AddRuntimeMessage(\n            Grasshopper.Kernel.GH_RuntimeMessageLevel.Remark, message)\n\n\ndef log_info(message: str) -> None:\n    \"\"\"Log info message (console only).\"\"\"\n    print(\"[INFO] %s\" % message)\n\n\ndef log_warning(message: str) -> None:\n    \"\"\"Log warning message (console + GH UI).\"\"\"\n    log_message(message, \"warning\")\n\n\n# =============================================================================\n# Component Setup\n# =============================================================================\n\ndef setup_component() -> None:\n    \"\"\"Initialize and configure the Grasshopper component.\n\n    Sets component metadata, input parameters, and output parameters.\n\n    Note: Output[0] is reserved for GH's internal 'out' - start from Output[1].\n\n    IMPORTANT: Type Hints cannot be set programmatically in Rhino 8.\n    They must be configured via UI: Right-click input -> Type hint -> Select type.\n    Required type hints:\n        Inputs 0-3, 6-9, 10-11, 16-17: bool\n        Inputs 4-5, 12-15, 18: str\n    \"\"\"\n    # Component metadata\n    ghenv.Component.Name = COMPONENT_NAME\n    ghenv.Component.NickName = COMPONENT_NICKNAME\n    ghenv.Component.Message = COMPONENT_MESSAGE\n    ghenv.Component.Category = COMPONENT_CATEGORY\n    ghenv.Component.SubCategory = COMPONENT_SUBCATEGORY\n\n    # Configure inputs\n    inputs = ghenv.Component.Params.Input\n\n    input_config = [\n        # Idx 0-5: Original inputs (backward-compatible positions)\n        (\"Include 3D\", \"include_3d\",\n         \"Create 3D orthographic view (default True)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Front Elevation\", \"include_front\",\n         \"Create front elevation view (default True)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Top Elevation\", \"include_top\",\n         \"Create top elevation view (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Material Takeoff\", \"include_takeoff\",\n         \"Create material takeoff schedule (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Detail Level\", \"detail_level\",\n         \"Coarse, Medium, or Fine (default Fine)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Display Style\", \"display_style\",\n         \"Wireframe, HiddenLine, Shaded, etc. (default HiddenLine)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 6-9: New elevations\n        (\"Include Back Elevation\", \"include_back\",\n         \"Create back elevation view (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Bottom Elevation\", \"include_bottom\",\n         \"Create bottom elevation view (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Left Elevation\", \"include_left\",\n         \"Create left elevation view (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Right Elevation\", \"include_right\",\n         \"Create right elevation view (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 10-11: Structural schedules\n        (\"Include Column Schedule\", \"include_col_sched\",\n         \"Create structural column schedule (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Include Framing Schedule\", \"include_frm_sched\",\n         \"Create structural framing schedule (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 12-13: Schedule config\n        (\"Schedule Fields\", \"schedule_fields\",\n         \"Comma-separated field names for schedules (default: Family, Type, Cut Length)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Schedule Template\", \"schedule_template\",\n         \"View template name for structural schedules (optional)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 14-15: Takeoff config\n        (\"Takeoff Fields\", \"takeoff_fields\",\n         \"Comma-separated field names for takeoff (default: Type, Count, Material: Name, Material: Area)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Takeoff Template\", \"takeoff_template\",\n         \"View template name for material takeoff (optional)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 16: Section markers\n        (\"Hide Section Markers\", \"hide_markers\",\n         \"Hide section markers in elevation views (default True)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        # Idx 17-18: Sheet\n        (\"Include Sheet\", \"include_sheet\",\n         \"Create sheet per assembly with viewports (default False)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n        (\"Titleblock Name\", \"titleblock_name\",\n         \"Title block family name for sheets (optional)\",\n         Grasshopper.Kernel.GH_ParamAccess.item),\n    ]\n\n    for i, (name, nick, desc, access) in enumerate(input_config):\n        if i < inputs.Count:\n            inputs[i].Name = name\n            inputs[i].NickName = nick\n            inputs[i].Description = desc\n            inputs[i].Access = access\n\n    # Configure outputs (start from index 1, as 0 is reserved for 'out')\n    outputs = ghenv.Component.Params.Output\n\n    output_config = [\n        (\"View Config JSON\", \"view_config_json\",\n         \"JSON string for Assembly Creator view_config_json input\"),\n        (\"Info\", \"info\",\n         \"Configuration summary\"),\n    ]\n\n    for i, (name, nick, desc) in enumerate(output_config):\n        idx = i + 1  # Skip Output[0]\n        if idx < outputs.Count:\n            outputs[idx].Name = name\n            outputs[idx].NickName = nick\n            outputs[idx].Description = desc\n\n\n# =============================================================================\n# Helper Functions\n# =============================================================================\n\ndef _get_first_branch(param):\n    \"\"\"Get the first branch of data from a GH parameter's VolatileData.\n\n    Args:\n        param: A GH input parameter object\n\n    Returns:\n        List-like branch data, or None if empty\n    \"\"\"\n    data = param.VolatileData\n\n    if hasattr(data, 'Branch'):\n        try:\n            return data.Branch(0)\n        except Exception:\n            pass\n\n    if hasattr(data, 'get_Branch'):\n        try:\n            return data.get_Branch(0)\n        except Exception:\n            pass\n\n    if hasattr(data, 'Branches'):\n        try:\n            branches = list(data.Branches)\n            if branches:\n                return branches[0]\n        except Exception:\n            pass\n\n    if hasattr(data, 'AllData'):\n        try:\n            return data.AllData(True)\n        except Exception:\n            pass\n\n    return None\n\n\ndef _read_bool_input(inputs, index, default=False):\n    \"\"\"Read a boolean value from a GH input by parameter index.\n\n    Args:\n        inputs: ghenv.Component.Params.Input collection\n        index: Zero-based parameter index\n        default: Default value if input is empty\n\n    Returns:\n        bool\n    \"\"\"\n    if index >= inputs.Count:\n        return default\n    if inputs[index].VolatileDataCount == 0:\n        return default\n    branch = _get_first_branch(inputs[index])\n    if branch is None or len(branch) == 0:\n        return default\n    item = branch[0]\n    val = item.Value if hasattr(item, 'Value') else item\n    if val is None:\n        return default\n    return bool(val)\n\n\ndef _read_string_input(inputs, index):\n    \"\"\"Read a string value from a GH input by parameter index.\n\n    Args:\n        inputs: ghenv.Component.Params.Input collection\n        index: Zero-based parameter index\n\n    Returns:\n        str or None if input is empty or missing\n    \"\"\"\n    if index >= inputs.Count:\n        return None\n    if inputs[index].VolatileDataCount == 0:\n        return None\n    branch = _get_first_branch(inputs[index])\n    if branch is None or len(branch) == 0:\n        return None\n    item = branch[0]\n    val = item.Value if hasattr(item, 'Value') else item\n    if val is None:\n        return None\n    return str(val)\n\n\n# =============================================================================\n# Main Function\n# =============================================================================\n\ndef main():\n    \"\"\"Main entry point for the Assembly View Config component.\n\n    Reads individual config inputs, validates string values, builds\n    a config dictionary, and serializes to JSON.\n\n    Returns:\n        tuple: (view_config_json, info)\n    \"\"\"\n    # -----------------------------------------------------------------\n    # Read inputs by parameter index (NickName injection is unreliable)\n    # -----------------------------------------------------------------\n    inputs = ghenv.Component.Params.Input\n\n    # Original inputs (idx 0-5)\n    include_3d_val = _read_bool_input(inputs, 0, default=True)\n    include_front_val = _read_bool_input(inputs, 1, default=True)\n    include_top_val = _read_bool_input(inputs, 2, default=False)\n    include_takeoff_val = _read_bool_input(inputs, 3, default=False)\n    detail_level_val = _read_string_input(inputs, 4)\n    display_style_val = _read_string_input(inputs, 5)\n\n    # New elevations (idx 6-9)\n    include_back_val = _read_bool_input(inputs, 6, default=False)\n    include_bottom_val = _read_bool_input(inputs, 7, default=False)\n    include_left_val = _read_bool_input(inputs, 8, default=False)\n    include_right_val = _read_bool_input(inputs, 9, default=False)\n\n    # Structural schedules (idx 10-11)\n    include_col_sched_val = _read_bool_input(inputs, 10, default=False)\n    include_frm_sched_val = _read_bool_input(inputs, 11, default=False)\n\n    # Schedule config (idx 12-13)\n    schedule_fields_val = _read_string_input(inputs, 12)\n    schedule_template_val = _read_string_input(inputs, 13)\n\n    # Takeoff config (idx 14-15)\n    takeoff_fields_val = _read_string_input(inputs, 14)\n    takeoff_template_val = _read_string_input(inputs, 15)\n\n    # Section markers (idx 16)\n    hide_markers_val = _read_bool_input(inputs, 16, default=True)\n\n    # Sheet (idx 17-18)\n    include_sheet_val = _read_bool_input(inputs, 17, default=False)\n    titleblock_name_val = _read_string_input(inputs, 18)\n\n    # -----------------------------------------------------------------\n    # Setup component metadata (display only, AFTER inputs are captured)\n    # -----------------------------------------------------------------\n    setup_component()\n\n    # -----------------------------------------------------------------\n    # Validate and apply defaults for string inputs\n    # -----------------------------------------------------------------\n    if detail_level_val and detail_level_val in VALID_DETAIL_LEVELS:\n        detail_level = detail_level_val\n    else:\n        if detail_level_val:\n            log_warning(\n                \"Invalid detail_level '%s'. Valid: %s. Using 'Fine'.\"\n                % (detail_level_val, \", \".join(VALID_DETAIL_LEVELS))\n            )\n        detail_level = \"Fine\"\n\n    if display_style_val and display_style_val in VALID_DISPLAY_STYLES:\n        display_style = display_style_val\n    else:\n        if display_style_val:\n            log_warning(\n                \"Invalid display_style '%s'. Valid: %s. Using 'HiddenLine'.\"\n                % (display_style_val, \", \".join(VALID_DISPLAY_STYLES))\n            )\n        display_style = \"HiddenLine\"\n\n    # -----------------------------------------------------------------\n    # Build config dict and serialize\n    # -----------------------------------------------------------------\n    config = {\n        \"include_3d\": include_3d_val,\n        \"include_front_elevation\": include_front_val,\n        \"include_top_elevation\": include_top_val,\n        \"include_material_takeoff\": include_takeoff_val,\n        \"detail_level\": detail_level,\n        \"display_style\": display_style,\n        \"include_back_elevation\": include_back_val,\n        \"include_bottom_elevation\": include_bottom_val,\n        \"include_left_elevation\": include_left_val,\n        \"include_right_elevation\": include_right_val,\n        \"include_column_schedule\": include_col_sched_val,\n        \"include_framing_schedule\": include_frm_sched_val,\n        \"schedule_fields\": schedule_fields_val or \"\",\n        \"schedule_template_name\": schedule_template_val or \"\",\n        \"takeoff_fields\": takeoff_fields_val or \"\",\n        \"takeoff_template_name\": takeoff_template_val or \"\",\n        \"hide_section_markers\": hide_markers_val,\n        \"include_sheet\": include_sheet_val,\n        \"titleblock_name\": titleblock_name_val or \"\",\n    }\n\n    view_config_json = json.dumps(config)\n\n    # -----------------------------------------------------------------\n    # Build info summary\n    # -----------------------------------------------------------------\n    info_lines = [\n        \"Assembly View Config v2.0\",\n        \"=\" * 30,\n        \"Views:\",\n        \"  3D Orthographic:  %s\" % (\"ON\" if include_3d_val else \"OFF\"),\n        \"  Front Elevation:  %s\" % (\"ON\" if include_front_val else \"OFF\"),\n        \"  Back Elevation:   %s\" % (\"ON\" if include_back_val else \"OFF\"),\n        \"  Top Elevation:    %s\" % (\"ON\" if include_top_val else \"OFF\"),\n        \"  Bottom Elevation: %s\" % (\"ON\" if include_bottom_val else \"OFF\"),\n        \"  Left Elevation:   %s\" % (\"ON\" if include_left_val else \"OFF\"),\n        \"  Right Elevation:  %s\" % (\"ON\" if include_right_val else \"OFF\"),\n        \"\",\n        \"Schedules:\",\n        \"  Material Takeoff: %s\" % (\"ON\" if include_takeoff_val else \"OFF\"),\n        \"  Column Schedule:  %s\" % (\"ON\" if include_col_sched_val else \"OFF\"),\n        \"  Framing Schedule: %s\" % (\"ON\" if include_frm_sched_val else \"OFF\"),\n        \"\",\n        \"Settings:\",\n        \"  Detail Level:      %s\" % detail_level,\n        \"  Display Style:     %s\" % display_style,\n        \"  Hide Sec. Markers: %s\" % (\"ON\" if hide_markers_val else \"OFF\"),\n        \"\",\n        \"Sheet:\",\n        \"  Include Sheet:  %s\" % (\"ON\" if include_sheet_val else \"OFF\"),\n        \"  Titleblock:     %s\" % (titleblock_name_val or \"(none)\"),\n    ]\n\n    # Show schedule/takeoff field config if relevant\n    if include_col_sched_val or include_frm_sched_val:\n        info_lines.append(\"\")\n        info_lines.append(\"Schedule Fields: %s\" % (schedule_fields_val or \"(defaults)\"))\n        if schedule_template_val:\n            info_lines.append(\"Schedule Template: %s\" % schedule_template_val)\n\n    if include_takeoff_val:\n        info_lines.append(\"\")\n        info_lines.append(\"Takeoff Fields: %s\" % (takeoff_fields_val or \"(defaults)\"))\n        if takeoff_template_val:\n            info_lines.append(\"Takeoff Template: %s\" % takeoff_template_val)\n\n    info = \"\\n\".join(info_lines)\n    log_info(\"Config built: %s\" % view_config_json)\n\n    return (view_config_json, info)\n\n\n# =============================================================================\n# Execution\n# =============================================================================\n\nif __name__ == \"__main__\":\n    view_config_json, info = main()\n    if info:\n        print(info)\n",
  "language": "python",
  "imports": [
    "RhinoCommon"
  ],
  "has_docstring": true
}