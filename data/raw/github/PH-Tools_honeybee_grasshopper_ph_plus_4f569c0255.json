{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph_plus/blob/b89f9887488d9c10eb732ffafe910cec70be0752/honeybee_ph_plus_rhino/gh_compo_io/hb_tools/win_rebuild_rh_geom.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph_plus",
  "repo_stars": 2,
  "repo_description": "Additional Honeybe-PH Grasshopper Components",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_plus_rhino/gh_compo_io/hb_tools/win_rebuild_rh_geom.py",
  "instruction": "GHCompo Interface: HBPH+ - Rebuild Window Surfaces.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH+ - Rebuild Window Surfaces.\"\"\"\n\ntry:\n    from Rhino.Geometry import Surface\n    from System import Guid\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import Rhino:\\n\\t{}\".format(e))\n\ntry:\n    from typing import Dict, List, Tuple, Union\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from ph_units.converter import convert\n    from ph_units.parser import parse_input\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ph_units:\\n\\t{}\".format(e))\n\n\nclass GHCompo_RebuildWindowSurfaces(object):\n    def __init__(self, _IGH, _surfaces_guids, _widths, _heights, *args, **kwargs):\n        # type: (gh_io.IGH, List[Guid], List[float], List[float], List, Dict) -> None\n        self.IGH = _IGH\n        self.surface_guids = _surfaces_guids\n        self.widths = _widths\n        self.heights = _heights\n\n    def get_height(self, i):\n        # type: (int) -> Union[int, float]\n        \"\"\"Get the user-supplied height of the i-th window surface, handle unit conversions.\"\"\"\n        val, unit = parse_input(self.widths[i])\n        if not unit:\n            return float(val)\n\n        rh_unit = self.IGH.get_rhino_unit_system_name()\n        result = convert(val, unit, rh_unit)\n        if not result:\n            msg = \"Failed to convert the input width from {} to {}?\".format(unit, rh_unit)\n            raise Exception(msg)\n        print(\"Converted height {} {} to {} {}\".format(val, unit, result, rh_unit))\n        return result\n\n    def get_width(self, i):\n        # type: (int) -> Union[int, float]\n        \"\"\"Get the user-supplied width of the i-th window surface, handle unit conversions.\"\"\"\n        val, unit = parse_input(self.heights[i])\n        if not unit:\n            return float(val)\n\n        rh_unit = self.IGH.get_rhino_unit_system_name()\n        result = convert(val, unit, rh_unit)\n        if not result:\n            msg = \"Failed to convert the input width from {} to {}?\".format(unit, rh_unit)\n            raise Exception(msg)\n        print(\"Converted width {} {} to {} {}\".format(val, unit, result, rh_unit))\n        return result\n\n    @property\n    def names(self):\n        # type: () -> List[str]\n        \"\"\"Return a list of the names of the window surfaces.\"\"\"\n        try:\n            return self.names_rh7\n        except Exception:\n            return self.names_rh8\n\n    @property\n    def names_rh7(self):\n        # type: () -> List[str]\n        \"\"\"Get the names of the window surfaces using Rhino-7 command.\"\"\"\n        with self.IGH.context_rh_doc():\n            return [str(self.IGH.ghc.ObjectDetails(s).name) for s in self.surface_guids]\n\n    @property\n    def names_rh8(self):\n        # type: () -> List[str]\n        \"\"\"Get the names of the window surfaces using Rhino-8 command.\"\"\"\n        with self.IGH.context_rh_doc():\n            return [str(self.IGH.ghc.ContentDetails(s).path) for s in self.surface_guids]\n\n    def rebuild_surface(self, _surface_guid, _i):\n        # type: (Guid, int) -> Surface\n\n        RADIUS = 0\n\n        # -- Get info of the original geometry\n        plane = self.IGH.ghc.IsPlanar(_surface_guid, True).plane\n        old_centroid = self.IGH.ghc.Area(_surface_guid).centroid\n\n        # -- Build the new Geometry\n        new_perimeter = self.IGH.ghc.Rectangle(plane, self.get_width(_i), self.get_height(_i), RADIUS).rectangle\n        new_surface = self.IGH.ghc.BoundarySurfaces(new_perimeter)\n\n        # -- Align new geom to old geom\n        new_centroid = self.IGH.ghc.Area(new_surface).centroid\n        move_vector = self.IGH.ghc.Vector2Pt(new_centroid, old_centroid, False).vector\n\n        return self.IGH.ghc.Move(new_surface, move_vector).geometry\n\n    def run(self):\n        # type: () -> Tuple[List[Surface], List[str]]\n\n        if not self.surface_guids:\n            return [], []\n\n        if not self.widths or not self.heights:\n            return self.surface_guids, self.names\n\n        if not len(self.surface_guids) == len(self.widths) == len(self.heights):\n            msg = \"Error: The lengths of the inputs do not match?\"\n            self.IGH.error(msg)\n            return [], []\n\n        new_surfaces_ = []\n        for i, surface in enumerate(self.surface_guids):\n            new_surfaces_.append(self.rebuild_surface(surface, i))\n\n        return new_surfaces_, self.names\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}