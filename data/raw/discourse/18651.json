{
  "source_url": "https://discourse.mcneel.com/t/python-atom-mac-obj-file-export-density-possible-defect/18651",
  "topic_id": 18651,
  "title": "Python/Atom/Mac .obj file export Density, possible defect",
  "question": "Hey all,\n\n\nThanks for the help so far!\n\n\nI had a previous discussion here \nPython Export obj files - set polygon density variable\n which led to getting most of the issues straightened out and the code well on the way. However it didn’t address the original issue of Density being ignored. I have tested and found the density variable needs to be set to zero in python before setting it to some other value. This fixes the issue and my script is now functioning how I want, but I thought it might be helpful to others and the Mac devs to know.\n\n\nI have taken screen shots to show the difference. I have run this on a few different 3dm files and it’s consistent.\n\n\nSet the Density to zero before setting to .45:\n\n\n\n\nDon’t set the Density first before attempting to set it to .45\n\n\n\n\nMy full script is here:\n\n\nimport os\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\n\nprint \"//export run started/////////////\"\n\n# this function via mcneel/rhinoscriptsyntax\n#https://github.com/mcneel/rhinoscriptsyntax/blob/master/Scripts/rhinoscript/layer.py\ndef layerNames(sort=False):\n    rc = []\n    for layer in scriptcontext.doc.Layers:\n        if not layer.IsDeleted: rc.append(layer.FullPath)\n    if sort: rc.sort()\n    return rc\n\ndef GetDAESettings():\n    e_str = \"\"\n    return e_str\n\ndef GetOBJSettings():\n    e_str = \"_Geometry=_Mesh \"\n    e_str+= \"_EndOfLine=CRLF \"\n    e_str+= \"_ExportRhinoObjectNames=_ExportObjectsAsOBJGroups \"\n    e_str+= \"_ExportMeshTextureCoordinates=_Yes \"\n    e_str+= \"_ExportMeshVertexNormals=_No \"\n    e_str+= \"_CreateNGons=_No \"\n    e_str+= \"_ExportMaterialDefinitions=_No \"\n    e_str+= \"_YUp=_No \"\n    e_str+= \"_WrapLongLines=Yes \"\n    e_str+= \"_VertexWelding=_Welded \"\n    e_str+= \"_WritePrecision=4 \"\n    e_str+= \"_Enter \"\n\n    e_str+= \"_DetailedOptions \"\n    e_str+= \"_JaggedSeams=_No \"\n    e_str+= \"_PackTextures=_No \"\n    e_str+= \"_Refine=_Yes \"\n    e_str+= \"_SimplePlane=_No \"\n\n    e_str+= \"_AdvancedOptions \"\n    e_str+= \"_Angle=50 \"\n    e_str+= \"_AspectRatio=0 \"\n   ...",
  "code_blocks": [
    {
      "code": "import os\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\n\nprint \"//export run started/////////////\"\n\n# this function via mcneel/rhinoscriptsyntax\n#https://github.com/mcneel/rhinoscriptsyntax/blob/master/Scripts/rhinoscript/layer.py\ndef layerNames(sort=False):\n    rc = []\n    for layer in scriptcontext.doc.Layers:\n        if not layer.IsDeleted: rc.append(layer.FullPath)\n    if sort: rc.sort()\n    return rc\n\ndef GetDAESettings():\n    e_str = \"\"\n    return e_str\n\ndef GetOBJSettings():\n    e_str = \"_Geometry=_Mesh \"\n    e_str+= \"_EndOfLine=CRLF \"\n    e_str+= \"_ExportRhinoObjectNames=_ExportObjectsAsOBJGroups \"\n    e_str+= \"_ExportMeshTextureCoordinates=_Yes \"\n    e_str+= \"_ExportMeshVertexNormals=_No \"\n    e_str+= \"_CreateNGons=_No \"\n    e_str+= \"_ExportMaterialDefinitions=_No \"\n    e_str+= \"_YUp=_No \"\n    e_str+= \"_WrapLongLines=Yes \"\n    e_str+= \"_VertexWelding=_Welded \"\n    e_str+= \"_WritePrecision=4 \"\n    e_str+= \"_Enter \"\n\n    e_str+= \"_DetailedOptions \"\n    e_str+= \"_JaggedSeams=_No \"\n    e_str+= \"_PackTextures=_No \"\n    e_str+= \"_Refine=_Yes \"\n    e_str+= \"_SimplePlane=_No \"\n\n    e_str+= \"_AdvancedOptions \"\n    e_str+= \"_Angle=50 \"\n    e_str+= \"_AspectRatio=0 \"\n    e_str+= \"_Distance=0.0\"\n    e_str+= \"_Density=0 \" '''this is needed to set Density'''\n    e_str+= \"_Density=0.45 \"\n    e_str+= \"_Grid=0 \"\n    e_str+= \"_MaxEdgeLength=0 \"\n    e_str+= \"_MinEdgeLength=0.0001 \"\n\n    e_str+= \"_Enter _Enter\" '''remove the last _Enter to check Density is set'''\n\n    return e_str\n\ndef GetSTLSettings():\n    eStr = \"_ExportFileAs=_Binary \"\n    eStr+= \"_ExportUnfinishedObjects=_Yes \"\n    eStr+= \"_UseSimpleDialog=_No \"\n    eStr+= \"_UseSimpleParameters=_No \"\n    eStr+= \"_Enter _DetailedOptions \"\n    eStr+= \"_JaggedSeams=_No \"\n    eStr+= \"_PackTextures=_No \"\n    eStr+= \"_Refine=_Yes \"\n    eStr+= \"_SimplePlane=_No \"\n    eStr+= \"_AdvancedOptions \"\n    eStr+= \"_Angle=15 \"\n    eStr+= \"_AspectRatio=0 \"\n    eStr+= \"_Distance=0.01 \"\n    eStr+= \"_Grid=16 \"\n    eStr+= \"_MaxEdgeLength=0 \"\n    eStr+= \"_MinEdgeLength=0.0001 \"\n    eStr+= \"_Enter _Enter\"\n    return eStr\n\nsettingsList = {\n    'GetDAESettings': GetDAESettings,\n    'GetOBJSettings': GetOBJSettings,\n    'GetSTLSettings': GetSTLSettings\n}\n\n\n\n\nfileName = rs.DocumentName()\nfilePath = rs.DocumentPath().rstrip(fileName)\n\narrLayers = layerNames(False)\n\n\n\ndef initExportByLayer(fileType=\"obj\", visibleonly=False, byObject=False):\n    for layerName in arrLayers:\n        layer = scriptcontext.doc.Layers.FindByFullPath(layerName, True)\n        if layer >= 0:\n            layer = scriptcontext.doc.Layers[layer]\n            save = True;\n            if visibleonly:\n                if not layer.IsVisible:\n                    save = False\n            if  rs.IsLayerEmpty(layerName):\n                save = False\n            if save:\n                cutName = layerName.split(\"::\")\n                cutName = cutName[len(cutName)-1]\n                objs = scriptcontext.doc.Objects.FindByLayer(cutName)\n                if len(objs) > 0:\n                    if byObject:\n                        i=0\n                        for obj in objs:\n                            i= i+1\n                            saveObjectsToFile(cutName+\"_\"+str(i), [obj], fileType)\n                    else:\n                        saveObjectsToFile(cutName, objs, fileType)\n\n\n\ndef saveObjectsToFile(name, objs, fileType):\n    rs.EnableRedraw(False)\n    if len(objs) > 0:\n        settings = settingsList[\"Get\"+fileType.upper()+\"Settings\"]()\n        rs.UnselectAllObjects()\n        for obj in objs:\n            obj.Select(True)\n        name = \"\".join(name.split(\" \"))\n        command = '-_Export \"{}{}{}\" {}'.format(filePath, name, \".\"+fileType.lower(), settings)\n        rs.Command(command, True)\n        rs.EnableRedraw(True)\n\n\ninitExportByLayer(\"obj\",True, False)\n\n\nprint \"//export run ended/////////////\"",
      "language": "python",
      "author": "radio412",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "layers",
    "materials",
    "mesh",
    "python",
    "rhinoscriptsyntax",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 5,
  "posts_count": 5,
  "views": 1562
}