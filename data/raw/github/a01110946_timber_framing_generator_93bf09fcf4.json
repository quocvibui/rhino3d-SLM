{
  "source_url": "https://github.com/a01110946/timber_framing_generator/blob/0b689e23c0ee24a9cfbdf280b219f659a54afd43/src/timber_framing_generator/utils/data_extractor.py",
  "repo": "a01110946/timber_framing_generator",
  "repo_stars": 3,
  "repo_description": "A Python tool bridging Revit and Rhino through Rhino.Inside.Revit to automate timber frame design. Processes Revit walls to generate complete framing solutions including studs, plates, headers, and cripples. Features intelligent wall decomposition, opening analysis, and automated documentation generation.",
  "license": "unknown",
  "filepath": "src/timber_framing_generator/utils/data_extractor.py",
  "instruction": "File: timber_framing_generator/utils/data_extractor.py",
  "code": "# File: timber_framing_generator/utils/data_extractor.py\n\nimport ghpythonlib.treehelpers as th\nfrom Grasshopper import DataTree\nfrom Grasshopper.Kernel.Data import GH_Path\n\n\ndef extract_wall_assembly_keys(all_walls_data):\n    \"\"\"\n    Given a list of wall data dictionaries (each containing keys for the wall,\n    its openings, and its cells), this function extracts the values for a set of\n    keys and returns a dictionary mapping each key to a list of values.\n\n    The keys extracted are:\n      - wall_base_curve\n      - wall_base_elevation\n      - wall_top_elevation\n      - base_plane\n      - is_exterior_wall\n      - opening_type\n      - opening_location_point\n      - rough_width\n      - rough_height\n      - base_elevation_relative_to_wall_base\n      - cell_type\n      - u_start\n      - u_end\n      - v_start\n      - v_end\n      - corner_points\n\n    Args:\n        all_walls_data (list): A list of wall data dictionaries.\n\n    Returns:\n        dict: A dictionary where each key (as above) maps to a list of extracted values.\n    \"\"\"\n    wall_base_curves = []\n    wall_base_elevations = []\n    wall_top_elevations = []\n    base_planes = []\n    is_exterior_walls = []\n\n    opening_types = []\n    opening_location_points = []\n    rough_widths = []\n    rough_heights = []\n    base_elevations_relative = []\n\n    cell_types = []\n    u_starts = []\n    u_ends = []\n    v_starts = []\n    v_ends = []\n    all_corner_points = []  # each entry is typically a list of four Rhino.Point3d\n\n    # Loop through each wall data dictionary.\n    for wall in all_walls_data:\n        # Extract wall-level keys.\n        wall_base_curves.append(wall.get(\"wall_base_curve\"))\n        wall_base_elevations.append(wall.get(\"wall_base_elevation\"))\n        wall_top_elevations.append(wall.get(\"wall_top_elevation\"))\n        base_planes.append(wall.get(\"base_plane\"))\n        is_exterior_walls.append(wall.get(\"is_exterior_wall\"))\n\n        # Openings: each wall may have a list of opening dictionaries.\n        openings = wall.get(\"openings\", [])\n        for op in openings:\n            opening_types.append(op.get(\"opening_type\"))\n            opening_location_points.append(op.get(\"opening_location_point\"))\n            rough_widths.append(op.get(\"rough_width\"))\n            rough_heights.append(op.get(\"rough_height\"))\n            base_elevations_relative.append(\n                op.get(\"base_elevation_relative_to_wall_base\")\n            )\n\n        # Cells: each wall may have a list of cell dictionaries.\n        cells = wall.get(\"cells\", [])\n        for cell in cells:\n            cell_types.append(cell.get(\"cell_type\"))\n            u_starts.append(cell.get(\"u_start\"))\n            u_ends.append(cell.get(\"u_end\"))\n            v_starts.append(cell.get(\"v_start\"))\n            v_ends.append(cell.get(\"v_end\"))\n            all_corner_points.append(cell.get(\"corner_points\"))\n\n    return {\n        \"wall_base_curve\": wall_base_curves,\n        \"wall_base_elevation\": wall_base_elevations,\n        \"wall_top_elevation\": wall_top_elevations,\n        \"base_plane\": base_planes,\n        \"is_exterior_wall\": is_exterior_walls,\n        \"opening_type\": opening_types,\n        \"opening_location_point\": opening_location_points,\n        \"rough_width\": rough_widths,\n        \"rough_height\": rough_heights,\n        \"base_elevation_relative_to_wall_base\": base_elevations_relative,\n        \"cell_type\": cell_types,\n        \"u_start\": u_starts,\n        \"u_end\": u_ends,\n        \"v_start\": v_starts,\n        \"v_end\": v_ends,\n        \"corner_points\": all_corner_points,\n    }\n\n\ndef convert_all_walls_data_to_nested_lists(all_walls_data):\n    \"\"\"\n    Converts a list of wall data dictionaries into a dictionary of nested lists,\n    one branch per wall, for each key. This organizes the data so that every wall\n    gets its own branch in the output DataTrees.\n\n    Expected keys per wall dictionary:\n      - Wall-level keys (one value per wall):\n            \"wall_base_curve\", \"wall_base_elevation\", \"wall_top_elevation\",\n            \"base_plane\", \"is_exterior_wall\"\n      - Opening keys (list per wall; may be empty if no openings):\n            \"opening_type\", \"opening_location_point\", \"rough_width\",\n            \"rough_height\", \"base_elevation_relative_to_wall_base\"\n      - Cell keys (list per wall; may be empty):\n            \"cell_type\", \"u_start\", \"u_end\", \"v_start\", \"v_end\", \"corner_points\"\n\n    Returns:\n        dict: A dictionary where each key maps to a nested list structured as:\n              [[wall1_value(s)], [wall2_value(s)], ...]\n    \"\"\"\n    wall_base_curves = []\n    wall_base_elevations = []\n    wall_top_elevations = []\n    base_planes = []\n    is_exterior_walls = []\n\n    opening_types = []\n    opening_location_points = []\n    rough_widths = []\n    rough_heights = []\n    base_elevations_relative = []\n\n    cell_types = []\n    u_starts = []\n    u_ends = []\n    v_starts = []\n    v_ends = []\n    corner_points_all = []\n\n    # Iterate through each wall data dictionary.\n    for wall in all_walls_data:\n        # Wall-level keys: each branch gets a single-element list.\n        wall_base_curves.append([wall.get(\"wall_base_curve\")])\n        wall_base_elevations.append([wall.get(\"wall_base_elevation\")])\n        wall_top_elevations.append([wall.get(\"wall_top_elevation\")])\n        base_planes.append([wall.get(\"base_plane\")])\n        is_exterior_walls.append([wall.get(\"is_exterior_wall\")])\n\n        # Opening keys: for each wall, append the entire list (even if empty).\n        openings = wall.get(\"openings\", [])\n        ot_list = []\n        olp_list = []\n        rw_list = []\n        rh_list = []\n        ber_list = []\n        for op in openings:\n            ot_list.append(op.get(\"opening_type\"))\n            olp_list.append(op.get(\"opening_location_point\"))\n            rw_list.append(op.get(\"rough_width\"))\n            rh_list.append(op.get(\"rough_height\"))\n            ber_list.append(op.get(\"base_elevation_relative_to_wall_base\"))\n        opening_types.append(ot_list)\n        opening_location_points.append(olp_list)\n        rough_widths.append(rw_list)\n        rough_heights.append(rh_list)\n        base_elevations_relative.append(ber_list)\n\n        # Cell keys: for each wall, append the entire list of cell values.\n        cells = wall.get(\"cells\", [])\n        ct_list = []\n        us_list = []\n        ue_list = []\n        vs_list = []\n        ve_list = []\n        cp_list = []\n        for cell in cells:\n            ct_list.append(cell.get(\"cell_type\"))\n            us_list.append(cell.get(\"u_start\"))\n            ue_list.append(cell.get(\"u_end\"))\n            vs_list.append(cell.get(\"v_start\"))\n            ve_list.append(cell.get(\"v_end\"))\n            cp_list.append(cell.get(\"corner_points\"))\n        cell_types.append(ct_list)\n        u_starts.append(us_list)\n        u_ends.append(ue_list)\n        v_starts.append(vs_list)\n        v_ends.append(ve_list)\n        corner_points_all.append(cp_list)\n\n    return {\n        \"wall_base_curve\": wall_base_curves,\n        \"wall_base_elevation\": wall_base_elevations,\n        \"wall_top_elevation\": wall_top_elevations,\n        \"base_plane\": base_planes,\n        \"is_exterior_wall\": is_exterior_walls,\n        \"opening_type\": opening_types,\n        \"opening_location_point\": opening_location_points,\n        \"rough_width\": rough_widths,\n        \"rough_height\": rough_heights,\n        \"base_elevation_relative_to_wall_base\": base_elevations_relative,\n        \"cell_type\": cell_types,\n        \"u_start\": u_starts,\n        \"u_end\": u_ends,\n        \"v_start\": v_starts,\n        \"v_end\": v_ends,\n        \"corner_points\": corner_points_all,\n    }\n",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}