{
  "source_url": "https://github.com/jlopezbi/DLA_heatSink/blob/f082fb5c84ff5c72b0f1797b9d6370120bdfd9ad/meshDLA.py",
  "repo": "jlopezbi/DLA_heatSink",
  "repo_stars": 5,
  "repo_description": "grow coral shapes",
  "license": "unknown",
  "filepath": "meshDLA.py",
  "instruction": "DLA on a mesh. http://wiki.mcneel.com/developer/rhinocommonsamples/closestpoint?s[]=rtree use R-tree to search for points close enough to vertices Josh Lopez-Binder Make a start mesh in rhino, select it, it will grow",
  "code": "#DLA on a mesh.\n#http://wiki.mcneel.com/developer/rhinocommonsamples/closestpoint?s[]=rtree\n#use R-tree to search for points close enough to vertices\n# Josh Lopez-Binder\n# Make a start mesh in rhino, select it, it will grow\n\nimport rhinoscriptsyntax as rs\nimport random, math, time\nimport Rhino\nimport scriptcontext\nimport System.Guid\nimport System.Drawing\nimport CParticle\nimport CWorld\nimport CCoral\nimport CGKernel\n\nGKernel = CGKernel.GKernel\nCoral = CCoral.Coral\n#/bin/bash: s: command not found\nParticle = CParticle.Particle\n\ndef meshDLA_MAIN():\n\n\t\"\"\"GET MESH\"\"\"\n\tfilter = Rhino.DocObjects.ObjectType.Mesh\n\trc, objRef = Rhino.Input.RhinoGet.GetOneObject(\"select seedMesh\",False,filter)\n\tif not objRef or rc!=Rhino.Commands.Result.Success: return rc\n\tmesh  = objRef.Mesh()\n\tif not mesh: return\n\tmesh.Compact()\n\n\t\"\"\"GET POLYSRF BOX\n\tfilter = Rhino.DocObjects.ObjectType.PolysrfFilter\n\trc, boxRef = Rhino.Input.RhinoGet.GetOneObject(\"select boundingBox (polySrf)\",False,filter)\n\tif not boxRef or rc!=Rhino.Commands.Result.Success: return rc\n\t#scriptcontext.doc.Objects.Hide(boxRef,True)\n\t\"\"\"\n\n\tareaMassProps = Rhino.Geometry.AreaMassProperties.Compute(mesh)\n\tcentroid = areaMassProps.Centroid\n\tcentroid.Z += 2.3\n\trs.ViewTarget(view=None,target=centroid)\n\n\tshowParticles = True\n\tshowWorld = False\n\tdebugTime = False\n\tsaveLineage = False\n\tspin = False\n\n\tpRadius = .5\n\tstepRatio = 0.5\n\tspeed = pRadius*stepRatio #relate to pRadius and some other len??\n\tnParticles = 50\n\tif debugTime:\n\t\ttimeSteps = 50\n\telse:\n\t\ttimeSteps = 1000\n\tratioMaxMinEdgeLen = .33\n\tthresMult = 5\n\talpha = 2\n\tbeta = 6\n\tgravFactor = 1\n\tpeakInclination = gravFactor*math.pi\n\tgStepSize = .01\n\tmaxGrowLen = .25\n\tminGrowLen = .001\n\tcutoffDist = 1\n\tnSave = 10\n\ttsSave = timeSteps/nSave\n\n\tthreshDist = pRadius*thresMult\n\n\n\n\n\t\"\"\"INITIALIZE WORLD, CORAL\"\"\"\n\tworld = CWorld.World(mesh)\n\tif not showWorld: world.hide()\n\tcoral = Coral(objRef,mesh,ratioMaxMinEdgeLen)\n\tworld.resize(coral,threshDist)\n\tworld.getSpawnPlane()\n\tworld.reDraw()\n\t\"\"\"save param string\"\"\"\n\tparamStr = \"\\nPARAMS_______________\"+\\\n\t\t\t   \"\\npRadius: %1.2fin.\" % pRadius +\\\n\t\t\t   \"\\nstepRatio: %1.2f\"%stepRatio +\\\n\t\t\t   \"\\nnParticles: %d\" % nParticles +\\\n\t\t\t   \"\\ntimeSteps: %d\" % timeSteps +\\\n\t\t\t   \"\\nmaxEdgeLen: %1.2f\" % coral.maxEdgeLength +\\\n\t\t\t   \"\\nminEdgeLen: %1.2f\" % coral.minEdgeLen +\\\n\t\t\t   \" (max/minEdgeLen: %.2f)\" % ratioMaxMinEdgeLen +\\\n\t\t\t   \"\\nthreshMult: %1.1f\" % thresMult +\\\n\t\t\t   \"\\nmaxGrowLen: %.2fin.\" % maxGrowLen +\\\n\t\t\t   \"\\nminGrowLen: %.2fin.\" % minGrowLen +\\\n\t\t\t   \"\\ncutoffDist: %1.1fin.\" % cutoffDist +\\\n\t\t\t   \"\\nused TrianglularDist\" +\\\n\t\t\t   \"\\ngravFactor: %.2f\" % gravFactor +\\\n\t\t\t   \"\\nnSave: %d\" % nSave\n\t#\"\\nbetaDist: a=%d, b=%d\" %(alpha,beta) +\\\n\n\tprint \"INPUT PARAMS________________________\"\n\tprint \"pRadius = %1.2fin.\" % pRadius\n\tprint \"nParticles = \" +str(nParticles)\n\tpeakIncDeg = peakInclination*180.0/math.pi\n\tprint \"peakInclination = %1.1fdeg\" % peakIncDeg\n\tprint \"timeSteps(ts) = \" +str(timeSteps)\n\tprint \"speed = %0.2f in./ts\" % speed\n\tprint \"\tmaxGrowLen = %1.2fin.\" % maxGrowLen\n\tprint \"\tminGrowLen = %1.2fin.\" % minGrowLen\n\tprint \"\tcutoffDist = %1.2fin.\" % cutoffDist\n\n\tprint \"maxEdgeLength(Avg) = %0.2f in.\" % coral.maxEdgeLength\n\tprint \"minEdgeLen = %0.2f in.\" % coral.minEdgeLen\n\tprint \"thresMult = \" + str(thresMult)\n\tprint \"____________________________________\"\n\n\n\n\tgKernel = GKernel(gStepSize,maxGrowLen,minGrowLen,cutoffDist)\n\t#gKernel.plot()\n\n\tparticles = []\n\tgrowVerts = set()\n\tprevHighestPoint = 0;\n\thighestPoint = 0\n\n\t\"\"\"INITIALIZE PARTICLES\"\"\"\n\tfor i in range(nParticles):\n\t\tp = Particle(pRadius)\n\t\tp.setToSpawnLoc(world)\n\t\tif showParticles: p.drawParticle(i)\n\t\tparticles.append(p)\n\n\t\"\"\"RUN SIMIULATION\"\"\"\n\tts = 0\n\tfor t in range(timeSteps):\n\t\tif spin:\n\t\t\trs.RotateView(angle = 1.0)\n\t\tts += 1\n\t\tif(ts>=tsSave):\n\t\t\t#print \"time:%d\"%timeSteps\n\t\t\tif saveLineage: coral.saveToLineage(t)\n\t\t\tts = 0\n\n\t\t#time.sleep(0.3)\n\t\tRhino.RhinoApp.Wait()\n\t\tscriptcontext.escape_test()\n\n\t\t\"\"\"MOVE PARTICLES\"\"\"\n\t\tfor i in range(len(particles)):\n\t\t\tp = particles[i]\n\t\t\t#boundChecks occur within moveParticle()\n\t\t\tp.moveParticle(speed,alpha,beta,peakInclination,world)\n\t\t\tif showParticles: p.clearParticle(), p.drawParticle(i)\n\n\t\t\"\"\"SEARCH FOR INTERSECTIONS\"\"\"\n\t\tcenterVerts = coral.verticesThatAte(world,particles)\n\n\t\t\"\"\"GROW REGIONS AROUND CENTERVERTS\"\"\"\n\t\tgrowVerts = coral.getGrowData(gKernel,centerVerts)\n\t\tcoral.grow(growVerts)\n\n\t\t\"\"\"SUBDIVIDE LONG EDGES\"\"\"\n\t\tcoral.subdivideLongEdges()\n\n\t\t\"\"\"COLLAPSE SHORT EDGES\"\"\"\n\t\tdidCollapse = coral.collapseShortEdges()\n\n\t\t\"\"\"UPDATE MESH\"\"\"\n\t\tcoral.updateNormals()\n\t\tcoral.mesh.Weld(math.pi)\n\t\tcoral.setNakedVerts()\n\n\n\t\t\"\"\"UPDATE CORAL AND WORLD \"\"\"\n\t\tcoral.reDraw()\n\n\n\t\t#coral.colorVerts(growVerts,gKernel)\n\n\t\tworld.resize(coral,threshDist)\n\t\tworld.getSpawnPlane()\n\t\tif showWorld: world.reDraw()\n\n\t#displayGrowNormals(mesh,growLength)\n\tif saveLineage: coral.packLineage(paramStr)\n\tif not rs.SetUserText(coral.objRef.ObjectId,\"params\",paramStr,True):\n\t\t\t\t\tprint \"SetUserText failed\"\n\n\n\t# if not showParticles:\n\t# \tfor particle in particles:\n\t# \t\t#rs.AddPolyline(particle.pnts)\n\t# \t\tscriptcontext.doc.Objects.Hide(particle.sphereID,True)\n\t\t#scriptcontext.doc.Views.Redraw()\n\n\n\nif __name__==\"__main__\":\n\treload(CParticle)\n\treload(CWorld)\n\treload(CCoral)\n\treload(CGKernel)\n\tmeshDLA_MAIN()\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}