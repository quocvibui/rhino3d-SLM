{
  "source_url": "https://github.com/ladybug-tools/honeybee-legacy/blob/bd62af4862fe022801fb87dbc8794fdf1dff73a9/src/Honeybee_Load%20Honeybee%20Objects.py",
  "repo": "ladybug-tools/honeybee-legacy",
  "repo_stars": 129,
  "repo_description": ":bee: Honeybee is a free and open source plugin to connect Grasshopper3D to EnergyPlus, Radiance, Daysim and OpenStudio for building energy and daylighting simulation",
  "license": "NOASSERTION",
  "filepath": "src/Honeybee_Load Honeybee Objects.py",
  "instruction": "Load Honeybee Objects",
  "code": "#\n# Honeybee: A Plugin for Environmental Analysis (GPL) started by Mostapha Sadeghipour Roudsari\n# \n# This file is part of Honeybee.\n# \n# Copyright (c) 2013-2020, Mostapha Sadeghipour Roudsari <mostapha@ladybug.tools> \n# Honeybee is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# Honeybee is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with Honeybee; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n\n\"\"\"\nLoad Honeybee Objects\n\nUse this component to load Honeybee objects from a file on your system.\nThe valid files are created by dump Honeybee objects component.\n-\nProvided by Honeybee 0.0.66\n\n    Args:\n        _HBObjects: A list of Honeybee objects\n        _filePath: A valid path to a file on your drive (e.g. c:\\ladybug\\20ZonesExample.HB)\n        _load: Set to True to load the objects from the file\n    Returns:\n        readMe!: ...\n\"\"\"\n\nghenv.Component.Name = \"Honeybee_Load Honeybee Objects\"\nghenv.Component.NickName = 'loadHBObjects'\nghenv.Component.Message = 'VER 0.0.66\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"HB-Legacy\"\nghenv.Component.SubCategory = \"00 | Honeybee\"\n#compatibleHBVersion = VER 0.0.59\\nDEC_15_2017\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"6\"\nexcept: pass\n\nimport cPickle as pickle\nimport scriptcontext as sc\nimport Grasshopper.Kernel as gh\nimport os\nimport uuid\nfrom Rhino.Geometry import *\nimport Rhino as rc\n\nclass outdoorBCObject(object):\n    \"\"\"\n    BCObject for surfaces with outdoor BC\n    \"\"\"\n    def __init__(self, name = \"\"):\n        self.name = name\n\n\ndef loadHBObjects(HBData):\n    \n    hb_EPZone = sc.sticky[\"honeybee_EPZone\"]\n    hb_EPSrf = sc.sticky[\"honeybee_EPSurface\"]\n    hb_EPZoneSurface = sc.sticky[\"honeybee_EPZoneSurface\"]\n    hb_EPSHDSurface = sc.sticky[\"honeybee_EPShdSurface\"]\n    hb_EPFenSurface = sc.sticky[\"honeybee_EPFenSurface\"]\n    hb_EPHvac = sc.sticky[\"honeybee_EPHvac\"]\n    hb_airDetail = sc.sticky[\"honeybee_hvacAirDetails\"]\n    hb_heatingDetail = sc.sticky[\"honeybee_hvacHeatingDetails\"]\n    hb_coolingDetail = sc.sticky[\"honeybee_hvacCoolingDetails\"]\n    hb_viewFac = sc.sticky[\"honeybee_ViewFactors\"]\n    hb_EPObjectsAux = sc.sticky[\"honeybee_EPObjectsAUX\"]()\n    hb_RADMaterialAUX = sc.sticky[\"honeybee_RADMaterialAUX\"]\n    hb_hive = sc.sticky[\"honeybee_Hive\"]()\n    \n    # a global dictonary to collect data\n    ids = HBData[\"ids\"]\n    objs = HBData[\"objs\"]\n    HBObjects = {}\n    \n    def loadHBviewFac(HBViewFacInfo):\n        # programs is set to default but will be overwritten\n        HBViewFac = hb_viewFac()\n        # update fields in HBZone\n        for key, value in HBViewFacInfo.iteritems():\n            HBViewFac.__dict__[key] = value\n        HBViewFac.calcNumPts()\n        HBObjects[HBViewFac.ID] = HBViewFac\n    \n    def loadHBEPstr(HBconstrObj):\n        EPObject = HBconstrObj['EPstr']\n        added, name = hb_EPObjectsAux.addEPObjectToLib(EPObject, True)\n    \n    def loadHBradMat(HBradMat):\n        added, name = hb_RADMaterialAUX.analyseRadMaterials(HBradMat['RADstr'], True, True)\n    \n    def loadHBHvac(HBHvacData):\n        HBHvac = hb_EPHvac(HBHvacData['GroupID'], HBHvacData['Index'], HBHvacData['airDetails'], HBHvacData['heatingDetails'], HBHvacData['coolingDetails'])\n        for key, value in HBHvacData.iteritems():\n            HBHvac.__dict__[key] = value\n        HBObjects[HBHvac.ID] = HBHvac\n    \n    def loadHBair(HBAirData):\n        HBAir = hb_airDetail()\n        for key, value in HBAirData.iteritems():\n            HBAir.__dict__[key] = value\n        HBObjects[HBAir.ID] = HBAir\n    \n    def loadHBheat(HBHeatData):\n        HBHeat = hb_heatingDetail()\n        for key, value in HBHeatData.iteritems():\n            HBHeat.__dict__[key] = value\n        HBObjects[HBHeat.ID] = HBHeat\n    \n    def loadHBcool(HBCoolData):\n        HBCool = hb_coolingDetail()\n        for key, value in HBCoolData.iteritems():\n            HBCool.__dict__[key] = value\n        HBObjects[HBCool.ID] = HBCool\n    \n    def loadHBZone(HBZoneData):\n        # programs is set to default but will be overwritten\n        HBZone = hb_EPZone(HBZoneData['geometry'], \\\n                HBZoneData['num'], HBZoneData['name'], \\\n                ('Office', 'OpenOffice'), HBZoneData['isConditioned'])\n        \n        # update fields in HBZone\n        for key, value in HBZoneData.iteritems():\n            HBZone.__dict__[key] = value\n        \n        HBObjects[HBZone.ID] = HBZone\n        \n    def loadHBSurface(HBSurfaceData):\n        # EPFenSurface\n        if HBSurfaceData['type'] == 5:\n            HBBaseSurface = HBObjects[HBSurfaceData['parent']]\n            HBSurface = hb_EPFenSurface(HBSurfaceData['geometry'], \\\n                HBSurfaceData['num'], HBSurfaceData['name'], HBBaseSurface, 5)\n                \n        elif HBSurfaceData['type'] == 6:\n            HBSurface = hb_EPSHDSurface(HBSurfaceData['geometry'], \\\n                HBSurfaceData['num'], HBSurfaceData['name'])\n        else:\n            HBSurface = hb_EPZoneSurface(HBSurfaceData['geometry'], \\\n                HBSurfaceData['num'], HBSurfaceData['name'])\n        \n        for key, value in HBSurfaceData.iteritems():\n            HBSurface.__dict__[key] = value\n        \n        HBObjects[HBSurface.ID] = HBSurface\n    \n    def updateHoneybeeObjects():\n        for id, HBObject in HBObjects.iteritems():\n            \n            if HBObject.objectType == 'HBZone':\n                HBObject.surfaces = [HBObjects[id] for id in HBObject.surfaces]\n                HBObject.HVACSystem = HBObjects[HBObject.HVACSystem]\n                continue\n            elif HBObject.objectType == 'HBHvac':\n                if HBObject.airDetails != None:\n                    HBObject.airDetails = HBObjects[HBObject.airDetails]\n                if HBObject.heatingDetails != None:\n                    HBObject.heatingDetails = HBObjects[HBObject.heatingDetails]\n                if HBObject.coolingDetails != None:\n                    HBObject.coolingDetails = HBObjects[HBObject.coolingDetails]\n                continue\n            elif HBObject.objectType == 'HBair' or HBObject.objectType == 'HBheat' or HBObject.objectType == 'HBcool':\n                continue\n            \n            # replace parent ID with the object\n            if HBObject.parent != None:\n                # replace parent object with ID\n                HBObject.parent = HBObjects[HBObject.parent]\n                \n            if not HBObject.isChild and HBObject.hasChild:\n                HBObject.childSrfs = [HBObjects[id] for id in HBObject.childSrfs]\n                HBObject.calculatePunchedSurface()\n            \n            if HBObject.type==6:\n                HBObject.childSrfs = [HBObjects[id] for id in HBObject.childSrfs]\n                \n            if HBObject.type!=6 and HBObject.BCObject.lower() == \"outdoors\":\n                HBObject.BCObject = outdoorBCObject()\n                \n            if HBObject.type!=6 and HBObject.BC.lower() == \"surface\":\n                # replace parent object with ID\n                HBObject.BCObject = HBObjects[HBObject.BCObject]\n    \n    for id, HBO in objs.iteritems():\n        if HBO['objectType'] == 'HBSurface' and HBO['type'] == 5: continue\n        if HBO['objectType'] == 'HBSurface' and HBO['type'] != 5:\n            loadHBSurface(HBO)\n        elif HBO['objectType'] == 'HBZone':\n            loadHBZone(HBO)\n        elif HBO['objectType'] == 'HBHvac':\n            loadHBHvac(HBO)\n        elif HBO['objectType'] == 'HBair':\n            loadHBair(HBO)\n        elif HBO['objectType'] == 'HBheat':\n            loadHBheat(HBO)\n        elif HBO['objectType'] == 'HBcool':\n            loadHBcool(HBO)\n        elif HBO['objectType'] == 'HBConstr' or HBO['objectType'] == 'HBMat' or HBO['objectType'] == 'HBsched' or HBO['objectType'] == 'HBShdCntrl':\n            loadHBEPstr(HBO)\n        elif HBO['objectType'] == 'HBRadMat':\n            loadHBradMat(HBO)\n        elif HBO['objectType'] == 'ViewFactorInfo':\n            loadHBviewFac(HBO)\n        else:\n            print HBO['objectType']\n            raise Exception(\"Unsupported object! Assure all objects are Honeybee objects\")\n    \n    # create Fenestration surfaces\n    for id, HBO in objs.iteritems():\n        if HBO['objectType'] == 'HBSurface' and HBO['type'] == 5:\n            loadHBSurface(HBO)\n    \n    #replace ids with objects in surfaces\n    updateHoneybeeObjects()\n    \n    #Scale everything if units are not meters.\n    if sc.sticky[\"honeybee_ConversionFactor\"] != 1:\n        fac = 1/sc.sticky[\"honeybee_ConversionFactor\"]\n        NUscale = rc.Geometry.Transform.Scale(rc.Geometry.Plane(rc.Geometry.Plane.WorldXY),fac,fac,fac)\n        for obj in HBObjects.keys():\n            if HBObjects[obj].objectType == 'HBSurface':\n                if HBObjects[obj].type == 6:\n                    HBObjects[obj].transform(NUscale, \"\", False)\n            elif HBObjects[obj].objectType == 'HBZone':\n                HBObjects[obj].transform(NUscale, \"\", False)\n    \n    # return new Honeybee objects\n    try:\n        return hb_hive.addToHoneybeeHive([HBObjects[id] for id in HBData[\"ids\"]], ghenv.Component)\n    except:\n        return hb_hive.addNonGeoObjToHive([HBObjects[id] for id in HBData[\"ids\"]][0], ghenv.Component)\n\n\ndef main(filePath):\n    if not os.path.isfile(filePath):\n        raise ValueError(\"Can't find %s\"%filePath)\n    \n    with open(filePath, \"rb\") as inf:\n        return loadHBObjects(pickle.load(inf))\n\n\n\n#Honeybee check.\ninitCheck = True\nif not sc.sticky.has_key('honeybee_release') == True:\n    initCheck = False\n    print \"You should first let Honeybee fly...\"\n    ghenv.Component.AddRuntimeMessage(w, \"You should first let Honeybee fly...\")\nelse:\n    try:\n        if not sc.sticky['honeybee_release'].isCompatible(ghenv.Component): initCheck = False\n        if sc.sticky['honeybee_release'].isInputMissing(ghenv.Component): initCheck = False\n    except:\n        initCheck = False\n        warning = \"You need a newer version of Honeybee to use this compoent.\" + \\\n        \"Use updateHoneybee component to update userObjects.\\n\" + \\\n        \"If you have already updated userObjects drag Honeybee_Honeybee component \" + \\\n        \"into canvas and try again.\"\n        ghenv.Component.AddRuntimeMessage(w, warning)\n\nif initCheck == True and _filePath != None and _load == True:\n    results = main(_filePath)\n    HBObjects = results if results!= -1 else None\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}