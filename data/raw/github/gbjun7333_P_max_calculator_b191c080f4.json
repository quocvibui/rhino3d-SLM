{
  "source_url": "https://github.com/gbjun7333/P_max_calculator/blob/8844e2d7a8f3bd7c387827d6a834114aa901129d/grasshopper/units.py",
  "repo": "gbjun7333/P_max_calculator",
  "repo_stars": 0,
  "repo_description": "parking capacity calculation system",
  "license": "MIT",
  "filepath": "grasshopper/units.py",
  "instruction": "데이터 모델 정의 (Parcel, Lot, Road, Block)",
  "code": "# -*- coding: utf-8 -*-\n\"\"\"\n데이터 모델 정의 (Parcel, Lot, Road, Block)\n\"\"\"\nfrom __future__ import annotations\n\nimport importlib\nfrom typing import List, Any, Optional, Tuple\n\nimport Rhino.Geometry as geo\nimport scriptcontext as sc\n\nimport constants\nimport utils\nfrom constants import TOL, RAW_TOL\n\nimportlib.reload(utils)\nimportlib.reload(constants)\n\n\nclass Parcel:\n    \"\"\"기본 필지 클래스 (지오메트리 보관용)\n\n    전처리 로직은 utils의 함수에 위임하여 중복을 줄입니다.\n    \"\"\"\n\n    def __init__(\n        self,\n        curve_crv: geo.Curve,\n        pnu: str,\n        jimok: str,\n        record: List[Any],\n        hole_regions: Optional[List[geo.Curve]] = None,\n    ):\n        self.region: geo.Curve = curve_crv  # 외부 경계 커브\n        self.hole_regions: List[geo.Curve] = hole_regions or []  # 내부 구멍들\n        self.pnu = pnu\n        self.jimok = jimok\n        self.record = record\n\n    def preprocess_curve(self) -> bool:\n        \"\"\"커브 전처리 (invalid 제거, 자체교차 제거, 단순화)\n\n        구현은 utils.preprocess_curve_util에 위임하여 순환 의존성을 피하기 위해 지연 임포트를 사용합니다.\n        \"\"\"\n        if not self.region or not getattr(self.region, \"IsValid\", False):\n            return False\n\n        # 지연 임포트로 순환 의존성 방지\n        try:\n            import utils  # type: ignore\n        except Exception:\n            return False\n\n        result = self._preprocess_curve_util(self.region, self.hole_regions)\n        if result is None:\n            return False\n\n        region, holes = result\n        self.region = region\n        self.hole_regions = holes\n        return True\n\n    def _preprocess_curve_util(\n        self, region: geo.Curve, hole_regions: Optional[List[geo.Curve]]\n    ) -> Optional[Tuple[geo.Curve, List[geo.Curve]]]:\n        \"\"\"\n        커브의 자체 교차를 제거하고 단순화하여 유효한 폴리곤으로 전처리합니다.\n        홀(hole) 커브들도 함께 처리합니다.\n        \"\"\"\n\n        if region is None or not getattr(region, \"IsValid\", False):\n            return None\n\n        # 자체교차 확인 및 단순화\n        try:\n            if geo.Intersect.Intersection.CurveSelf(region, TOL):\n                simplified = region.Simplify(geo.CurveSimplifyOptions.All, 0.1, 1.0)\n                region = simplified or region\n        except Exception:\n            pass  # 실패 시 원본 사용\n\n        # 일반 단순화\n        try:\n            simplified = region.Simplify(geo.CurveSimplifyOptions.All, 0.1, 1.0)\n            region = simplified or region\n        except Exception:\n            pass\n\n        # 홀 커브들 단순화\n        valid_holes: List[geo.Curve] = []\n        for hole in hole_regions or []:\n            try:\n                if hole and hole.IsValid:\n                    simplified_hole = hole.Simplify(\n                        geo.CurveSimplifyOptions.All, 0.1, 1.0\n                    )\n                    valid_holes.append(simplified_hole or hole)\n            except Exception:\n                continue\n\n        return region, valid_holes\n\n\nclass Road(Parcel):\n    \"\"\"도로 클래스\"\"\"\n\n    pass\n\n\nclass Lot(Parcel):\n    \"\"\"대지 클래스\"\"\"\n\n    def __init__(\n        self,\n        curve_crv: geo.Curve,\n        pnu: str,\n        jimok: str,\n        record: List[Any],\n        hole_regions: Optional[List[geo.Curve]] = None,\n        road_adj: Optional[int] = None,\n        max_height: Optional[float] = None,\n        min_height: Optional[float] = None,\n    ):\n        super().__init__(curve_crv, pnu, jimok, record, hole_regions)\n        self.is_flag_lot: bool = False  # 자루형 토지 여부\n        self.has_road_access: bool = False  # 도로 접근 여부\n        self.road_adj = road_adj  # 인접 도로 점수\n        self.max_height = max_height  # 대지 최대 고도\n        self.min_height = min_height  # 대지 최소 고도\n\n\nclass LayoutScore:\n    \"\"\"블록 평가 점수 클래스\"\"\"\n\n    def __init__(\n        self,\n        region_score: float = 0.0,\n        shape_score: float = 0.0,\n        road_score: float = 0.0,\n        topo_score: float = 0.0,\n    ):\n        self.region_score = region_score\n        self.shape_score = shape_score\n        self.road_score = road_score\n        self.topo_score = topo_score\n\n\nclass Block:\n    \"\"\"블록 클래스 (여러 Lot을 그룹화)\"\"\"\n\n    def __init__(\n        self,\n        region: geo.Curve,\n        lots: Optional[List[Lot]] = None,\n        block_id: int = -1,\n    ):\n        self.region = region  # 블록 외곽 경계\n        self.lots: List[Lot] = lots or []  # 포함된 대지들\n        self.id = block_id\n        self.layout_score = LayoutScore()  # 평가 점수\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}