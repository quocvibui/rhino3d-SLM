{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/scripts/LBT2PH/helpers_geometry.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "scripts/LBT2PH/helpers_geometry.py",
  "instruction": "Helpers geometry",
  "code": "import ghpythonlib.components as ghc\nimport rhinoscriptsyntax as rs\nimport Rhino\n\nfrom ladybug_rhino.fromgeometry import from_face3d\nfrom ladybug_rhino.togeometry import to_face3d \n\ndef avg_normal_vectors(_vectors):\n    x, y, z = 0, 0, 0\n    for v in _vectors:\n        x += v.X\n        y += v.Y\n        z += v.Z\n\n    x = x/len(_vectors)\n    y = y/len(_vectors)\n    z = z/len(_vectors)\n    \n    return Rhino.Geometry.Vector3d(x, y, z)\n\ndef get_srfc_normal_vector(_surface):\n    \"\"\" Returns the surface normal vector of a single Rhino Surface \n    \n    Args:\n        _surface: Rhino.Geometry.NurbsSurface: A Single surface\n    Returns:\n        surface_normal: The vector of the surface normal\n    \n    Note: This only works on a SINGLE surface. If you want to get the normal for a\n    'Brep' object, be sure to use this on the Brep.Surfaces entities one at a time. \n    Breps have list of multiple surfaces (potentialy) and this function only works\n    on a single surface at a time.\n    \"\"\"\n    \n    try:\n        is_surface =  hasattr(_surface, 'NormalAt')\n        if not is_surface:\n            raise AttributeError\n    except AttributeError:\n        print('Input should be a single surface. If using on a Brep, pass in each of the \"Brep.Surfaces\" elements one at a time')\n\n    centroid = Rhino.Geometry.AreaMassProperties.Compute(_surface).Centroid\n    b, u, v = _surface.ClosestPoint(centroid)\n    surface_normal = _surface.NormalAt(u, v)\n\n    return surface_normal\n\ndef brep_avg_surface_normal(_brep):\n    brep_surface_normals = []\n    \n    for srfc in _brep.Surfaces:\n        brep_surface_normals.append( get_srfc_normal_vector(srfc) )\n\n    return avg_normal_vectors(brep_surface_normals)\n\ndef inset_rhino_surface(_srfc, _inset_dist=0.001, _srfc_name=\"\"):\n    \"\"\" Insets/shrinks a Rhino Brep some dimension \n    Arg:\n        _srfc: A Rhino Brep\n        _inset_dist: float: Default=0.001m\n        _srfc_name: str: The name of the surface, used for error messages\n    Returns:\n        new_srfc: A new Rhino surface, shrunk/inset by the specified amount\n    \"\"\"\n\n    #-----------------------------------------------------------------------\n    # Get all the surface params needed\n    srfc_Center = ghc.Area(_srfc).centroid\n    srfc_normal_vector = brep_avg_surface_normal(_srfc)\n    srfc_edges = ghc.DeconstructBrep(_srfc).edges\n    srfc_perimeter = ghc.JoinCurves(srfc_edges, False)\n\n    #-----------------------------------------------------------------------\n    # Try to inset the perimeter Curve\n    inset_curve = rs.OffsetCurve(srfc_perimeter, srfc_Center, _inset_dist, srfc_normal_vector, 0)\n\n    #-----------------------------------------------------------------------\n    # In case the new curve goes 'out' and the offset fails\n    # Or is too small and results in multiple offset Curves\n    if len(inset_curve)>1:\n        warning = 'Error. The surface: \"{}\" is too small. The offset of {} m\"\\\n            \"can not be done. Check the offset size?'.format(_srfc_name, _inset_dist)\n        print(warning)\n        \n        inset_curve = rs.OffsetCurve(srfc_perimeter, srfc_Center, 0.001, srfc_normal_vector, 0)\n        inset_curve = rs.coercecurve( inset_curve[0] )\n    else:\n        inset_curve = rs.coercecurve( inset_curve[0] )\n\n    new_srfc = ghc.BoundarySurfaces(inset_curve)\n\n    return new_srfc\n\ndef inset_LBT_Face3d(_face3d, _inset_dist=0.001):\n    try:\n        rhino_geom = from_face3d(_face3d)\n        rhino_geom_inset = inset_rhino_surface(rhino_geom, _inset_dist)\n    except Exception as e:\n        msg ='Error: Something went wrong trying to \"inset\" the window geometry.\\n'\\\n            'Please double check your windows? Are they planar and the surface normals\\n'\\\n            'are all pointing \"out\"?'\n        print('Error:', e)\n        raise Exception(msg)\n\n    lbt_face3d = to_face3d(rhino_geom_inset)\n\n    if lbt_face3d:\n        return lbt_face3d[0]\n    else:\n        return None",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}