{
  "source_url": "https://github.com/dbt-ethz/open-plans-rhino/blob/6cbb4f56d948dbd3b00c301323963bcbe61642d5/src/rhino/dev/OPAddPlanToProject_cmd.py",
  "repo": "dbt-ethz/open-plans-rhino",
  "repo_stars": 0,
  "repo_description": "Rhino3D plugin to interact with open plans",
  "license": "unknown",
  "filepath": "src/rhino/dev/OPAddPlanToProject_cmd.py",
  "instruction": "Opadd plan to project cmd",
  "code": "from __future__ import print_function\nfrom __future__ import absolute_import\nfrom __future__ import division\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext\nimport System\nimport Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\n\nimport rhino.rhino_helpers as rhh\nimport datamodels\n\n\n__commandname__ = \"OPAddPlanToProject\"\n\n\nclass AddPlan(forms.Dialog[bool]):\n\n    # Dialog box Class initializer\n    def __init__(self):\n        # Initialize dialog box\n        self.Title = 'OPEN PLANS: add floor plan'\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n\n        # create dropwdown for existing projects\n        self.m_label_project = forms.Label(Text='Project')\n        # Create Dropdown List\n        self.m_dropdown_projects = forms.DropDown()\n        # set projects in layers as options in dropdown\n        self.m_dropdown_projects.DataStore = [project.split(\n            '::')[1] for project in rs.LayerChildren(\"OpenPlans\")]\n        # set default value\n        self.m_dropdown_projects.SelectedIndex = 0\n\n        # create attributes type\n        self.m_label_type = forms.Label(Text='Type')\n        self.m_textbox_type = forms.TextBox(Text='floorplan')\n\n        # create attributes architects\n        self.m_label_floor = forms.Label(Text='floor level')\n        self.m_textbox_floor = forms.TextBox(Text='0')\n\n        # Create the default button\n        self.DefaultButton = forms.Button(Text='Add')\n        self.DefaultButton.Click += self.on_OK_button_click\n\n        # Create the abort button\n        self.AbortButton = forms.Button(Text='Cancel')\n        self.AbortButton.Click += self.on_close_button_click\n\n        # Create a table layout and add all the controls\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(80, 20)\n        layout.AddRow(self.m_label_project, self.m_dropdown_projects)\n        layout.AddRow(self.m_label_type, self.m_textbox_type)\n        layout.AddRow(self.m_label_floor, self.m_textbox_floor)\n        layout.AddRow(None)  # spacer\n        layout.AddRow(self.AbortButton, self.DefaultButton)\n\n        self.Content = layout\n\n    # Get the value of the textbox\n    def get_text(self):\n        return {\n            'type': self.m_textbox_type.Text,\n            'floor': self.m_textbox_floor.Text\n        }\n\n    def get_project(self):\n        # return self.m_dropdown_projects.DataStore[self.m_dropdown_projects.SelectedIndex]\n        return self.m_dropdown_projects.SelectedIndex\n\n    # Close button click handler\n    def on_close_button_click(self, sender, e):\n        self.Close(False)\n\n    # OK button click handler\n    def on_OK_button_click(self, sender, e):\n        self.Close(True)\n\n\n# The script that will be using the dialog.\ndef request_new_plan():\n    dialog = AddPlan()\n    rc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n    if (rc):\n        return dialog.get_text(), dialog.get_project()\n    else:\n        return None, None\n\n\n@rhh.op_project_exists\ndef RunCommand():\n    #ret = rhh.add_background_bitmap()\n    ret = Rhino.Commands.Result.Success\n    if ret == Rhino.Commands.Result.Success:\n        plan, project = request_new_plan()\n        if plan:\n            # plan instance from user input\n            plan = datamodels.OpenPlansPlan.from_custom(data=plan)\n\n            # plan layer\n            plan_lname, plan_lid = rhh.add_child_layer(lname=plan.plan_id_string,\n                                            parent=rs.LayerChildren(\n                                                \"OpenPlans\")[project],\n                                            attr=plan.attributes)\n\n            # TODO: Remove plan from document user text\n            # project instance from document user data\n            # project = datamodels.OpenPlansProject.from_custom(\n            #     data=rhh.get_document_user_text())\n            # # add plan and add to rhino\n            # rhh.project_to_rhino_layers(project.add_plan(plan))\n\n\nif __name__ == \"__main__\":\n    RunCommand(True)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}