{
  "source_url": "https://github.com/contextmachine/mmodel/blob/0545e5c2a11c641fc54e91f603e709d3dea549f3/panels_gh/py3klays/p3.py",
  "repo": "contextmachine/mmodel",
  "repo_stars": 0,
  "repo_description": "Deployment branch",
  "license": "Apache-2.0",
  "filepath": "panels_gh/py3klays/p3.py",
  "instruction": null,
  "code": "import copy\nimport gzip\nimport json\nimport os\nimport time\n\nimport rhino3dm\nfrom rhino3dm import _rhino3dm as rh\n\n\n# sys.path.extend([\"/Users/andrewastakhov/PycharmProjects\", \"/Users/andrewastakhov/PycharmProjects/mmodel/panels_gh\"])\n\n\n#os.environ['PANELS_GH_DUMPS']=\"panels_gh/dumps\"\n\n\n\nclass RH:\n    def __init__(self, tag, time, layers, **kwargs):\n        self.time = time\n        super().__init__()\n        # self.frame = frame\n        self.tag = tag\n        self.__dict__ |= kwargs\n        self.model = rhino3dm.File3dm()\n        self.model2 = rhino3dm.File3dm()\n        self.layers = []\n        self.layers2 = []\n        for l in copy.deepcopy(layers):\n            try:\n                self.layers.append(Lay(model=self.model, **l))\n            except:\n                pass\n        for l2 in layers:\n            try:\n                self.layers2.append(Lay2(model=self.model2, **l2))\n            except:\n                pass\n\n    def write(self):\n\n        fp = f\"{os.getenv('PANELS_GH_DUMPS')}/build/cut/{self.tag}[:-2]/{self.tag}\"\n\n        fpfrez = f\"{os.getenv('PANELS_GH_DUMPS')}/build/frez/{self.tag}[:-2]/{self.tag}.3dm\"\n        self.model.Write(fp + \".3dm\", 7)\n        self.model2.Write(fpfrez, 7)\n\n        # self.model.Write(f\"dumps/{self.tag}/{self.tag}\"+\".dxf\")\n        # client.s3.put_object(Bucket=client.bucket,Key=f\"{client.bucket}/{client.prefix}/build{self.time}/{self.tag}/{self.time}\", Body=self.model.Encode())\n        return f\"{os.getenv('PANELS_GH_DUMPS')}/build/cut/{self.tag}[:-2]/{self.tag}.3dm\"\n\n   \n\nclass Lay:\n\n    def __init__(self, model=None, **kwargs):\n        super().__init__()\n        self.model = model\n        self._lay = rhino3dm.Layer()\n        self._lay.Name = kwargs[\"name\"]\n\n        self._lay.Color = tuple(kwargs[\"color\"])\n        self._lay.Visible = (kwargs[\"visible\"])\n\n        lay_index = self.model.Layers.Add(self._lay)\n        #m = rh.Transform.Mirror(rhino3dm.Plane.WorldYZ())\n        if kwargs[\"objects\"] is not None:\n            for o in kwargs[\"objects\"]:\n                # obj = list(self.model.Objects)[-1]\n\n                attrs = rhino3dm.ObjectAttributes()\n                attrs.PlotColorSource = rhino3dm.ObjectPlotColorSource.PlotColorFromLayer\n                attrs.ColorSource = rhino3dm.ObjectColorSource.ColorFromLayer\n                attrs.LayerIndex = lay_index\n                o[\"archive3dm\"] = 70\n                obj = rhino3dm.CommonObject.Decode(o)\n                #obj.Transform(m)\n                print(obj)\n                self.model.Objects.Add(obj, attrs)\nclass Lay2:\n\n    def __init__(self, model=None, **kwargs):\n        super().__init__()\n        self.model = model\n        self._lay = rhino3dm.Layer()\n        print(kwargs)\n\n        self._lay.Name = kwargs[\"name\"]\n\n        self._lay.Color = tuple(kwargs[\"color\"] + [255])\n        self._lay.Visible = (not kwargs[\"visible\"])\n\n        lay_index = self.model.Layers.Add(self._lay)\n        m = rh.Transform.Mirror(rhino3dm.Plane.WorldYZ())\n        if kwargs[\"objects\"] is not None:\n            for o in kwargs[\"objects\"]:\n                # obj = list(self.model.Objects)[-1]\n\n                attrs = rhino3dm.ObjectAttributes()\n                attrs.PlotColorSource = rhino3dm.ObjectPlotColorSource.PlotColorFromLayer\n                attrs.ColorSource = rhino3dm.ObjectColorSource.ColorFromLayer\n                attrs.LayerIndex = lay_index\n                o[\"archive3dm\"] = 70\n                obj = rhino3dm.CommonObject.Decode(o)\n\n                print(obj)\n                self.model.Objects.Add(obj, attrs)\n\n\nif __name__ == \"__main__\":\n\n    s = round(time.time())\n    ## os.mkdir(f\"{os.getenv('PANELS_GH_DUMPS')}/build{s}/cut\")\n    # os.mkdir(f\"{os.getenv('PANELS_GH_DUMPS')}/build{s}/frez\")\n    # client = sessions.S3Client(bucket=os.getenv('BUCKET'), prefix=\"workspace/cxm/arc/\")\n    for i in [\"build1670414928\"]:\n        with gzip.open(f\"{os.getenv('PANELS_GH_DUMPS')}/{i}.gz\", \"rb\", compresslevel=9) as gz:\n            bts = gz.read()\n            # client.s3.put_object(Bucket=client.bucket, Key=f\"{client.bucket }/{client.prefix}/build{s}\", Body=bts)\n            for obj in json.loads(bts):\n                print(obj)\n                a = RH(**obj, time=1)\n\n                os.environ['RHINO_TARGET'] = a.write()\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}