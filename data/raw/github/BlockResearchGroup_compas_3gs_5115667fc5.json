{
  "source_url": "https://github.com/BlockResearchGroup/compas_3gs/blob/162cecfbeb8806340a55713ec3a0bce7cc932c89/examples/_old_examples/to_be_updated/00_30_cell_constructor.py",
  "repo": "BlockResearchGroup/compas_3gs",
  "repo_stars": 11,
  "repo_description": "3D graphic statics add-on for the COMPAS framework",
  "license": "MIT",
  "filepath": "examples/_old_examples/to_be_updated/00_30_cell_constructor.py",
  "instruction": "00 30 cell constructor",
  "code": "from __future__ import absolute_import\nfrom __future__ import print_function\nfrom __future__ import division\n\nimport compas\n\nfrom compas.geometry import add_vectors\nfrom compas.geometry import centroid_points\nfrom compas.geometry import midpoint_point_point\nfrom compas.geometry import subtract_vectors\n\nfrom compas_rhino.utilities import draw_labels\nfrom compas_rhino.utilities import draw_lines\n\nfrom compas_3gs.algorithms import egi_from_vectors\nfrom compas_3gs.algorithms import cell_planarise\nfrom compas_3gs.algorithms import cell_from_egi\n\nfrom compas_3gs.rhino import draw_egi_arcs\nfrom compas_3gs.rhino import MeshConduit\n\nfrom compas_3gs.utilities import get_index_colordict\n\ntry:\n    import rhinoscriptsyntax as rs\nexcept ImportError:\n    compas.raise_if_ironpython()\n\n\n__author__     = 'Juney Lee'\n__copyright__  = 'Copyright 2019, BLOCK Research Group - ETH Zurich'\n__license__    = 'MIT License'\n__email__      = 'juney.lee@arch.ethz.ch'\n\n\n# ------------------------------------------------------------------------------\n#   1. get force vectors\n# ------------------------------------------------------------------------------\nlines  = rs.GetObjects(\"Select force vectors in equilibrium\", preselect=True, filter=rs.filter.curve)\norigin = rs.GetPoint(\"Pick origin\")\n\nmidpts       = {}\nvectors      = {}\ntarget_areas = {}\nfor index, line in enumerate(lines):\n    sp  = rs.CurveStartPoint(line)\n    ep  = rs.CurveEndPoint(line)\n    mp  = midpoint_point_point(sp, ep)\n    mag = rs.CurveLength(line)\n    midpts[index]       = mp\n    vectors[index]      = subtract_vectors(ep, sp)\n    target_areas[index] = mag\n\n\n# ------------------------------------------------------------------------------\n#   2. egi\n# ------------------------------------------------------------------------------\negi = egi_from_vectors(vectors, origin)\n\negi_vertex_colordict = {}\nfor vkey in egi.vertex:\n    color = (0, 0, 0)\n    if egi.vertex[vkey]['type'] == 'zero':\n        color = (255, 0, 0)\n    egi_vertex_colordict[vkey] = color\n\n# draw egi vertex labels and edgees as arcs\nrs.AddLayer('egi')\n\negi.draw_vertexlabels(color=egi_vertex_colordict)\ndraw_egi_arcs(egi)\n\n# pause\nrs.EnableRedraw(True)\nrs.GetString('EGI created ... Press Enter to generate unit cell ... ')\n\n\n# ------------------------------------------------------------------------------\n#   3. unit polyhedron\n# ------------------------------------------------------------------------------\nrs.AddLayer('cell')\ncell = cell_from_egi(egi)\ncell.draw_faces(color=egi_vertex_colordict)\n\n# pause\nrs.EnableRedraw(True)\nrs.GetString('Zero faces are shown in red ... Press Enter to arearise cell faces ...')\n\n\n# ------------------------------------------------------------------------------\n#   4. arearise cell faces\n# ------------------------------------------------------------------------------\n\n# conduit\nconduit = MeshConduit(cell)\n\n\ndef callback(cell, k, args):\n    if k % 10:\n        conduit.redraw()\n\n\n# set targets for zero faces\nfor fkey in cell.faces():\n    if fkey not in target_areas:\n        target_areas[fkey] = 0\n\n# set target normals\ntarget_normals = {}\nfor fkey in cell.faces():\n    target_normals[fkey] = egi.vertex[fkey]['normal']\n\ncollapse_edge_length = rs.GetReal(\"Collapse edge length?\", number=0.1)\n\negi.clear()\ncell.clear()\n\nwith conduit.enabled():\n    cell_planarise(cell,\n                   kmax=2000,\n                   target_areas=target_areas,\n                   target_normals=target_normals,\n                   collapse_edge_length=collapse_edge_length,\n                   callback=callback,\n                   print_result_info=True)\n\n\n# ------------------------------------------------------------------------------\n#   5. draw results\n# ------------------------------------------------------------------------------\nrs.HideObjects(lines)\n\n# get index colors\ncolordict = get_index_colordict(vectors.keys())\n\n# draw initial vectors and target areas\ninput_vector_labels = []\ninput_vectors       = []\nfor i in vectors:\n    label = 'target : ' + str(round(target_areas[i], 5))\n    input_vector_labels.append({'pos'  : midpts[i],\n                                'text' : label,\n                                'color': colordict[i]})\n    input_vectors.append({'start': list(origin),\n                          'end'  : add_vectors(origin, vectors[i]),\n                          'color': colordict[i],\n                          'arrow': 'end'})\ndraw_labels(input_vector_labels)\ndraw_lines(input_vectors)\n\n# diaplay final cell face areas\nfinal_face_labels = []\nfor fkey in vectors:\n    label = str(round(cell.face_area(fkey), 5))\n    pos = centroid_points(cell.face_coordinates(fkey))\n    final_face_labels.append({'pos': pos,\n                              'text': label,\n                              'color': colordict[fkey]})\ndraw_labels(final_face_labels)\n\n# draw cell geometry\nfor fkey in target_areas:\n    if target_areas[fkey] != 0:\n        cell.draw_faces(keys=[fkey])\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}