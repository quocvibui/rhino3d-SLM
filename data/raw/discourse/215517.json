{
  "source_url": "https://discourse.mcneel.com/t/convert-python-2-to-python-3-necessary/215517",
  "topic_id": 215517,
  "title": "Convert Python 2 to Python 3 Necessary?",
  "question": "Is this conversion of Python 2 scripts for Rhino necessary?\n\n\nI have the “convert_py2to3.py” script (Utility to convert py2 rhino-python files to py3 format) maybe from \n@dale\n ? Doesn’t give credit within the script notes.\n\n\nAnyway, not sure if I need to use it, how to use it, and whether it does a batch job per folder of scripts?\n\n\nThanks,\n\n\nAlan",
  "code_blocks": [
    {
      "code": "\"\"\"Utility to convert py2 rhino-python files to py3 format\"\"\"\nimport os\nimport os.path as op\nimport shutil\nfrom lib2to3.main import main  # this is what 2to3 cli utility uses\n\n\n# read sources\nSOURCE_DIR = r\"../Scripts/\"\nDEST_DIR = r\"../python3/\"\n\nITEMS = [\n    r\"rhinoscript/\",\n    r\"rhinoscriptsyntax.py\",\n    r\"scriptcontext.py\",\n]\n\n\nTHIS_DIR = op.dirname(__file__)\nROOT_DIR = op.dirname(THIS_DIR)\nprint(f\"{THIS_DIR=}\")\nprint(f\"{ROOT_DIR=}\")\n\n\nclass SourceFile:\n    \"\"\"Context manager for a python source file\"\"\"\n\n    def __init__(self, filename) -> None:\n        self.filename = filename\n        self.source = \"\"\n\n    def __enter__(self):\n        with open(self.filename, \"r\") as rf:\n            self.source = rf.read()\n        return self\n\n    def __exit__(self, exc_type, exc_value, exc_traceback):\n        with open(self.filename, \"w\") as wf:\n            wf.write(self.source)\n\n    def replace(self, *args, **kwargs):\n        \"\"\"Replace string in source\"\"\"\n        self.source = self.source.replace(*args, **kwargs)\n\n\ndef prep_dest(source, dest):\n    \"\"\"Prepare a new copy of source files\"\"\"\n    if op.exists(dest):\n        print(f\"Deleting: {dest}\")\n        if op.isdir(dest):\n            shutil.rmtree(dest)\n        else:\n            os.remove(dest)\n\n    print(f\"Updating: {dest}\")\n    if op.isdir(source):\n        shutil.copytree(source, dest)\n    else:\n        shutil.copy(source, dest)\n\n\ndef convert_dest(dest):\n    \"\"\"Convert files to python3-compatible\"\"\"\n    print(f\"Converting: {dest}\")\n    main(\"lib2to3.fixes\", args=[\"--write\", \"--nobackups\", \"--no-diffs\", dest])\n\n\ndef apply_dest_fixes(dest):\n    \"\"\"Apply misc fixes to files\"\"\"\n\n    def apply_fixes(item):\n        item_name = op.splitext(op.basename(item))[0]\n        fixer_func_name = f\"{item_name}_fixes\"\n        if fixer_func := globals().get(fixer_func_name, None):\n            fixer_func(item)\n\n    print(f\"Applying Fixes: {dest}\")\n    if op.isdir(dest):\n        for dest_item in os.listdir(dest):\n            apply_fixes(op.join(dest, dest_item))\n    else:\n        apply_fixes(dest)\n\n\n# Fixers ======================================================================\n# function naming format is <file_name>_fixes\n# e.g. scriptcontext_fixes applies fixes to scriptcontext.py\n# -----------------------------------------------------------------------------\n\n\ndef scriptcontext_fixes(item):\n    \"\"\"Fix misc items in scriptcontext.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"import RhinoPython.Host as __host\", \"import Rhino\"\n        )\n        sf.replace(\"doc = None\", \"doc = Rhino.RhinoDoc.ActiveDoc\")\n        sf.replace(\n            \"rc = __host.EscapePressed(reset)\",\n            \"rc = None # __host.EscapePressed(reset)\",\n        )\n\n\ndef application_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/application.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nimport Rhino\nimport Rhino.ApplicationSettings.ModelAidSettings as modelaid\nimport Rhino.Commands.Command as rhcommand\nimport System.TimeSpan, System.Enum, System.Environment\nimport System.Windows.Forms.Screen\nimport datetime\nfrom . import utility as rhutil\n\"\"\".strip(),\n            \"\"\"\nimport datetime\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nfrom Rhino.ApplicationSettings import ModelAidSettings as modelaid\nfrom Rhino.Commands import Command as rhcommand\nfrom System import TimeSpan, Enum, Environment\nfrom System.Windows.Forms import Screen\n\"\"\".strip(),\n        )\n        sf.replace(\n            \"Rhino.PlugIns.PlugInType.None\", \"getattr(Rhino.PlugIns.PlugInType, 'NONE')\"\n        )\n        sf.replace(\"filter =\", \"search_filter =\")\n        sf.replace(\"filter |=\", \"search_filter |=\")\n        sf.replace(\n            \"GetInstalledPlugInNames(filter,\", \"GetInstalledPlugInNames(search_filter,\"\n        )\n\n\ndef block_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/block.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport Rhino\nimport scriptcontext\nfrom . import utility as rhutil\nimport math\nimport System.Guid\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Guid\n\"\"\".strip(),\n        )\n\n\ndef curve_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/curve.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport math\nimport System.Guid, System.Array, System.Enum\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Guid, Array, Enum\n\"\"\".strip(),\n        )\n        sf.replace(\n            \"Rhino.DocObjects.ObjectDecoration.None\",\n            \"getattr(Rhino.DocObjects.ObjectDecoration, 'NONE')\",\n        )\n        sf.replace(\"ValueException(\", \"ValueError(\")\n\n\ndef dimension_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/dimension.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Guid\nfrom .view import __viewhelper, ViewCPlane\n\"\"\".strip(),\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nfrom .view import __viewhelper, ViewCPlane\n\nimport System\nimport Rhino\nfrom System import Guid\n\"\"\".strip(),\n        )\n\n\ndef document_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/document.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nimport Rhino\nimport System.Enum, System.Drawing.Size\nimport System.IO\nfrom . import utility as rhutil\nimport math\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import IO\nfrom System import Enum\nfrom System.Drawing import Size\n\"\"\".strip(),\n        )\n\n\ndef geometry_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/geometry.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Guid, System.Array\n\"\"\".strip(),\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Guid, Array\n\"\"\".strip(),\n        )\n\n\ndef hatch_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/hatch.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Guid\n\"\"\".strip(),\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Guid\n\"\"\".strip(),\n        )\n\n\ndef layer_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/layer.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport Rhino.DocObjects.Layer\nimport scriptcontext\nfrom . import utility as rhutil\nimport System.Guid\nfrom Rhino.RhinoMath import UnsetIntIndex\n\"\"\".strip(),\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Guid\n\nUnsetIntIndex = Rhino.RhinoMath.UnsetIntIndex\nLayer = Rhino.DocObjects.Layer\n\"\"\".strip(),\n        )\n        sf.replace(\"if idx is 0:\", \"if idx == 0:\")\n\n\ndef light_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/light.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\"Rhino.UnitSystem.None\", \"getattr(Rhino.UnitSystem, 'NONE')\")\n\n\ndef line_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/line.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"Rhino.Geometry.Intersect.LineCylinderIntersection.None\",\n            \"getattr(Rhino.Geometry.Intersect.LineCylinderIntersection, 'NONE')\",\n        )\n        sf.replace(\n            \"Rhino.Geometry.Intersect.LineSphereIntersection.None\",\n            \"getattr(Rhino.Geometry.Intersect.LineSphereIntersection, 'NONE')\",\n        )\n        sf.replace(\"Execption(\", \"Exception(\")\n\n\ndef mesh_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/mesh.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Guid, System.Array, System.Drawing.Color\nfrom .view import __viewhelper\n\"\"\".strip(),\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nfrom .view import __viewhelper\n\nimport System\nimport Rhino\nfrom System import Guid, Array\nfrom System.Drawing import Color\n\"\"\".strip(),\n        )\n\n\ndef object_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/object.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nimport Rhino\nfrom . import utility as rhutil\nimport System.Guid, System.Enum\nfrom .layer import __getlayer\nfrom .view import __viewhelper\nimport math\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\nfrom .layer import __getlayer\nfrom .view import __viewhelper\n\nimport System\nimport Rhino\nfrom System import Guid, Enum\n\"\"\".strip(),\n        )\n\n\ndef selection_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/selection.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"Rhino.DocObjects.ObjectType.None\",\n            \"getattr(Rhino.DocObjects.ObjectType, 'NONE')\",\n        )\n        sf.replace(\"def __FilterHelper(filter):\", \"def __FilterHelper(input_filter):\")\n        sf.replace(\"if filter &\", \"if input_filter &\")\n\n        sf.replace(\n            \"\"\"\n    class CustomGetObject(Rhino.Input.Custom.GetObject):\n        def __init__(self, filter_function):\n            self.m_filter_function = filter_function\n\"\"\".strip(),\n            \"\"\"\n    class CustomGetObject(Rhino.Input.Custom.GetObject):\n        def __init__(self, filter_function):\n            super().__init__()\n            self.m_filter_function = filter_function\n\"\"\".strip(),\n        )\n\n        sf.replace(\n            \"\"\"\nclass __CustomGetObjectEx(Rhino.Input.Custom.GetObject):\n    def __init__(self, allowable_geometry):\n        self.m_allowable = allowable_geometry\n\"\"\".strip(),\n            \"\"\"\nclass __CustomGetObjectEx(Rhino.Input.Custom.GetObject):\n    def __init__(self, allowable_geometry):\n        super().__init__()\n        self.m_allowable = allowable_geometry\n\"\"\".strip(),\n        )\n\n\ndef surface_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/surface.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nimport math\nimport Rhino\nimport System.Guid\nfrom . import utility as rhutil\nfrom . import object as rhobject\nfrom System.Collections.Generic import List\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\nfrom . import object as rhobject\n\nimport System\nimport Rhino\nfrom System import Guid\nfrom System.Collections.Generic import List\n\"\"\".strip(),\n        )\n\n\ndef transformation_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/transformation.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Guid, System.Array\nimport math\nfrom . import view as rhview\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\nfrom . import view as rhview\n\nimport System\nimport Rhino\nfrom System import Guid, Array\n\"\"\".strip(),\n        )\n\n\ndef userinterface_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/userinterface.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport Rhino\nimport Rhino.UI\nfrom . import utility as rhutil\nimport scriptcontext\nimport System.Drawing.Color\nimport System.Enum\nimport System.Array\nimport Eto.Forms\nimport System.Windows.Forms\nimport math\nfrom .view import __viewhelper\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\nfrom .view import __viewhelper\n\nimport System\nimport Rhino\nimport Rhino.UI\nimport Eto.Forms\nimport System.Windows.Forms\nfrom System import Enum, Array\nfrom System.Drawing import Color\n\"\"\".strip(),\n        )\n        sf.replace(\n            \"Rhino.UI.ShowMessageIcon.None\",\n            \"getattr(Rhino.UI.ShowMessageIcon, 'NONE')\",\n        )\n\n\ndef utility_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/utility.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport Rhino\nimport System.Drawing.Color, System.Array, System.Guid\nimport time\nimport System.Windows.Forms.Clipboard\nimport scriptcontext\nimport math\nimport string\nimport numbers\nimport RhinoPython.Host as __host\n\"\"\".strip(),\n            \"\"\"\nimport time\nimport math\nimport string\nimport numbers\nimport scriptcontext\n\nimport System\nimport Rhino\nfrom System import Array, Guid\nfrom System.Drawing import Color\nfrom System.Windows.Forms import Clipboard\n# import RhinoPython.Host as __host\n\"\"\".strip(),\n        )\n        sf.replace(\n            \"=  __host.Coerce3dPointFromEnumerables(point)\",\n            \"=  None # __host.Coerce3dPointFromEnumerables(point)\",\n        )\n\n\ndef view_fixes(item):\n    \"\"\"Fix misc items in rhinoscript/view.py\"\"\"\n    with SourceFile(item) as sf:\n        sf.replace(\n            \"\"\"\nimport scriptcontext\nfrom . import utility as rhutil\nimport Rhino\nimport System.Enum\nimport math\n\"\"\".strip(),\n            \"\"\"\nimport math\nimport scriptcontext\nfrom . import utility as rhutil\n\nimport System\nimport Rhino\nfrom System import Enum\n\"\"\".strip(),\n        )\n\n\n# =============================================================================\n\nif __name__ == \"__main__\":\n    for item in ITEMS:\n        source = op.normpath(op.join(THIS_DIR, SOURCE_DIR, item))\n        dest = op.normpath(op.join(THIS_DIR, DEST_DIR, item))\n\n        prep_dest(source, dest)\n        convert_dest(dest)\n        apply_dest_fixes(dest)",
      "language": "python",
      "author": "Alan_Farkas",
      "post_number": 3,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "layers",
    "mesh",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "selection",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 6,
  "views": 89
}