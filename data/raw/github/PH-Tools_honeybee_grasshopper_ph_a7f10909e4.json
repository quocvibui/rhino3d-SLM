{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/shw/create_recirc_pipes.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/shw/create_recirc_pipes.py",
  "instruction": "GHCompo Interface: HBPH - Create SHW Recirculation Pipes.",
  "code": "# -*- Python Version: 2.7 -*-\n# -*- coding: utf-8 -*-\n\n\"\"\"GHCompo Interface: HBPH - Create SHW Recirculation Pipes.\"\"\"\n\ntry:\n    from typing import Any, Dict, List, Union\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from ladybug_geometry.geometry3d.polyline import LineSegment3D, Polyline3D\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_geometry:\\n\\t{}\".format(e))\n\ntry:\n    from ladybug_rhino.togeometry import to_polyline3d\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_phhvac import hot_water_piping\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_energy_ph:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_utils.input_tools import clean_get\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_utils:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\n    from honeybee_ph_rhino.gh_compo_io import ghio_validators\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\n\nclass _RecircPipeBuilder(object):\n    \"\"\"Interface for collect and clean DHW Recirculation Piping user-inputs\n\n    Note: Following the LBT convention, the line-geometry may be stored in any units (m, mm, inch, etc).\n    All non-line-geometry data like thickness, conductivity, temp. etc. must always be in SI units.\n    \"\"\"\n\n    display_name = ghio_validators.HBName(\"display_name\", default=\"_unnamed_recirc_pipe_\")\n    diameter_mm = ghio_validators.UnitMM(\"diameter_mm\", default=\"25.4 MM\")\n    insul_thickness_mm = ghio_validators.UnitMM(\"insul_thickness_mm\", default=\"25.4 MM\")\n    insul_conductivity = ghio_validators.UnitW_MK(\"insul_conductivity\", default=0.04)\n    daily_period = ghio_validators.FloatMax24(\"daily_period\", default=24)\n    water_temp_c = ghio_validators.UnitDegreeC(\"water_temp_c\", default=\"60.0 C\")\n\n    def __init__(\n        self,\n        IGH,\n        _geometry,\n        _name=\"_unnamed_\",\n        _diameter_mm=\"025.4 MM\",\n        _insul_thickness_mm=\"25.4 MM\",\n        _insul_conductivity=\"0.04 W/MK\",\n        _insul_reflective=True,\n        _insul_quality=None,\n        _daily_period=24.0,\n        _water_temp_c=\"60.0 DEG-C\",\n    ):\n        # type: (gh_io.IGH, Union[Polyline3D, LineSegment3D], str, str, str, str, bool, None, float, str) -> None\n        self.IGH = IGH\n        self.geometry = _geometry\n        self.display_name = _name\n        self.diameter_mm = _diameter_mm\n        self.insul_thickness_mm = _insul_thickness_mm\n        self.insul_conductivity = _insul_conductivity\n        self.insul_reflective = _insul_reflective\n        self.insul_quality = _insul_quality\n        self.daily_period = _daily_period\n        self.water_temp_c = _water_temp_c\n\n    def _convert_to_polyline(self, _input):\n        \"\"\"Try to convert input geometry to a Rhino Polyline object.\"\"\"\n        cps = self.IGH.ghpythonlib_components.ControlPoints(_input).points\n        return self.IGH.ghpythonlib_components.PolyLine(cps, False)\n\n    @property\n    def geometry(self):\n        # type: () -> Union[Polyline3D, LineSegment3D]\n        return self._geometry\n\n    @geometry.setter\n    def geometry(self, _input):\n        # type: (Union[Polyline3D, LineSegment3D]) -> None\n        try:\n            self._geometry = to_polyline3d(_input)\n        except:\n            try:\n                self._geometry = to_polyline3d(self._convert_to_polyline(_input))\n            except Exception as e:\n                raise Exception(\n                    \"{}\\nError: Geometry input {} cannot be converted to an LBT Polyline3D?\".format(e, _input)\n                )\n\n    def create_hbph_dhw_recirc_pipe(self):\n        # type: () -> hot_water_piping.PhHvacPipeElement\n        hbph_obj = hot_water_piping.PhHvacPipeElement()\n        hbph_obj.display_name = self.display_name\n\n        # If its a Polyline3D or LineSegment3D\n        segments = getattr(self.geometry, \"segments\", [self.geometry])\n\n        for segment in segments:\n            hbph_obj.add_segment(\n                hot_water_piping.PhHvacPipeSegment(\n                    segment,\n                    float(self.diameter_mm),\n                    float(self.insul_thickness_mm),\n                    float(self.insul_conductivity),\n                    self.insul_reflective,\n                    self.insul_quality,\n                    self.daily_period,\n                    float(self.water_temp_c),\n                )\n            )\n\n        return hbph_obj\n\n\nclass GHCompo_CreateSHWRecircPipes(object):\n    \"\"\"Component Interface\"\"\"\n\n    def __init__(\n        self,\n        _IGH,\n        _geometry,\n        _name,\n        _diameter_mm,\n        _insul_thickness_mm,\n        _insul_conductivity,\n        _insul_reflective,\n        _insul_quality,\n        _daily_period,\n        _water_temp_c,\n        *args,\n        **kwargs\n    ):\n        # type: (gh_io.IGH, List[Union[Polyline3D, LineSegment3D]], List[str], List[str], List[str], List[str], List[bool], List, List[float], List[str], *Any, **Any) -> None\n        self.IGH = _IGH\n        self.geometry = _geometry\n        self.name = _name\n        self.diameter_mm = _diameter_mm\n        self.insul_thickness_mm = _insul_thickness_mm\n        self.insul_conductivity = _insul_conductivity\n        self.insul_reflective = _insul_reflective\n        self.insul_quality = _insul_quality\n        self.daily_period = _daily_period\n        self.water_temp_c = _water_temp_c\n\n    def collection_input_data(self):\n        # type: () -> List[Dict[str, Any]]\n        input_data = []\n        for i in range(len(self.geometry)):\n            input_data.append(\n                {\n                    \"IGH\": self.IGH,\n                    \"_geometry\": clean_get(self.geometry, i),\n                    \"_name\": clean_get(self.name, i, \"_unnamed_\"),\n                    \"_diameter_mm\": clean_get(self.diameter_mm, i, \"25.4 MM\"),\n                    \"_insul_thickness_mm\": clean_get(self.insul_thickness_mm, i, \"25.4 MM\"),\n                    \"_insul_conductivity\": clean_get(self.insul_conductivity, i, \"0.04 W/MK\"),\n                    \"_insul_reflective\": clean_get(self.insul_reflective, i, True),\n                    \"_insul_quality\": clean_get(self.insul_quality, i, None),\n                    \"_daily_period\": clean_get(self.daily_period, i, 24),\n                    \"_water_temp_c\": clean_get(self.water_temp_c, i, \"60.0 C\"),\n                }\n            )\n        return input_data\n\n    def run(self):\n        # type: () -> List[hot_water_piping.PhHvacPipeElement]\n        dhw_recirc_piping_ = []\n        for d in self.collection_input_data():\n            recirc_pipe_builder = _RecircPipeBuilder(**d)\n            dhw_recirc_piping_.append(recirc_pipe_builder.create_hbph_dhw_recirc_pipe())\n\n        return dhw_recirc_piping_\n",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}