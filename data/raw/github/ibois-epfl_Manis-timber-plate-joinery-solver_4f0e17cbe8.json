{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/anim.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/anim.py",
  "instruction": "Gives a preview of the assembly sequence.",
  "code": "\"\"\"Gives a preview of the assembly sequence.\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport rhinoscriptsyntax as rs\r\nimport ast\r\n\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Animate Sequence\", \"Anim\", \"\"\"Gives a preview of the assembly sequence.\"\"\", \"Manis\", \"Utility\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"dcc9f1d8-23dd-4869-b406-8b02b0765862\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"model\", \"model\", \"Plate model.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"step\", \"step\", \"Animation progression from 0 to 1.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"retreat\", \"retreat\", \"Length of the insertion path.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n    \r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_Brep()\r\n        self.SetUpParam(p, \"breps\", \"breps\", \"Show late in motion.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_String()\r\n        self.SetUpParam(p, \"status\", \"status\", \"Assembly progression.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n    \r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        p2 = self.marshal.GetInput(DA, 2)\r\n        result = self.RunScript(p0, p1, p2)\r\n\r\n        if result is not None:\r\n            if not hasattr(result, '__getitem__'):\r\n                self.marshal.SetOutput(result, DA, 0, True)\r\n            else:\r\n                self.marshal.SetOutput(result[0], DA, 0, True)\r\n                self.marshal.SetOutput(result[1], DA, 1, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAB4SURBVEhL7Y9BCsAgDATzpr6pb/JNfVMvtlJcUBLKHIJQOrCIMhvVbmpyrG6lpORDFyRnHeT2tS+N+H/gEoneOXEHujCvHsQdIAU8vEMKeHgq7TVzIogr6nnsSts/xy7EFaREXEFKxBWkRFxBSsQVpERcQUovrtkF47mRqvh38rQAAAAASUVORK5CYII=\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n    \r\n    def RunScript(self, model, step, retreat):\r\n       \r\n\r\n        def flatten_integer_list(l):\r\n            \"\"\"Flatten a nested list of integers\"\"\"\r\n            if type(l) is list:\r\n                new_l=[]\r\n                num = None\r\n                for i in range(len(str(l))):\r\n                    char = str(l)[i]\r\n                    if char != '[' and char != ']' and char!= ' ' and char != ',':\r\n                        if num == None: num = char\r\n                        else: num += char\r\n                    elif num != None: \r\n                        new_l.append(int(num))\r\n                        num = None\r\n                return(new_l)\r\n            else: return l\r\n       \r\n        mod = model\r\n        #init\r\n        breps = None\r\n        status = None\r\n        if retreat == None: retreat = 1000\r\n        if step == None: step = 1\r\n\r\n        if mod:\r\n            # If model as input, take last module for animation.\r\n            if hasattr(mod, 'model') is False:\r\n                mod = mod.modules[-1]\r\n\r\n            #start of insertion\r\n            if step == 0: \r\n                status = ('start of insertion sequence')\r\n            else:\r\n                vectors = mod.assembly_vectors\r\n                count = mod.count\r\n                seq = ast.literal_eval(mod.sequence)\r\n                breps = []\r\n                step = step * count\r\n                deci = step - int(step)\r\n\r\n                # animation\r\n                for i in range(count):\r\n                    if vectors[i] == \"gravity\": vectors[i] = rs.VectorCreate((0,0,-1),(0,0,0))\r\n                    # standing plates\r\n                    if i < int(step) :\r\n                        plate_ids = flatten_integer_list(seq[i])\r\n                        if type(plate_ids) is list:\r\n                            for integer in plate_ids:\r\n                                breps.append(rs.CopyObject(mod.model.plates[integer].brep))\r\n                        else: breps.append(rs.CopyObject(mod.model.plates[plate_ids].brep))\r\n                    # moving plates\r\n                    if i == int(step) :\r\n                        if type(seq[i]) is list:\r\n                            plate_ids = flatten_integer_list(seq[i])\r\n                            for integer in plate_ids:\r\n                                breps.append(rs.CopyObject(mod.model.plates[integer].brep, -(1-deci)*retreat*vectors[i]))\r\n                        else: breps.append(rs.CopyObject(mod.model.plates[seq[i]].brep, -(1-deci)*retreat*vectors[i]))\r\n\r\n                # ongoing status\r\n                perc = 100*(step - int(step))\r\n                status = ('plate '+ str(int(step)) + ' inserted at ' + str(perc)+ ' %.')\r\n\r\n                # end status\r\n                if step == 1: status = ('end of insertion sequence')\r\n\r\n            if breps is not None: \r\n                for i in range(len(breps)): breps[i]= rs.coercebrep(breps[i])\r\n            \r\n        else: self.AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, 'Waiting to get a model as input.')\r\n\r\n        return (breps, status)\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Animate Sequence\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"fd95287a-598b-49e7-a9a0-bff3ba219cf7\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}