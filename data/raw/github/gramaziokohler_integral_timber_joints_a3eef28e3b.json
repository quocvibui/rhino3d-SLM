{
  "source_url": "https://github.com/gramaziokohler/integral_timber_joints/blob/d543a28ccfaeb8a56ff692a29d5510c3e649477f/src/integral_timber_joints/rhino/tools_environment.py",
  "repo": "gramaziokohler/integral_timber_joints",
  "repo_stars": 11,
  "repo_description": "Robotic Assembled Timber Structures with Integral Timber Joints",
  "license": "MIT",
  "filepath": "src/integral_timber_joints/rhino/tools_environment.py",
  "instruction": "Tools environment",
  "code": "import json\nimport os\n\nimport Rhino  # type: ignore\nimport rhinoscriptsyntax as rs  # type: ignore\nfrom compas.geometry.primitives.frame import Frame\nfrom compas.utilities import DataDecoder\nfrom compas_fab.robots.configuration import Configuration\nfrom compas_rhino.geometry import RhinoMesh\nfrom compas_rhino.ui import CommandMenu\nfrom compas_rhino.utilities.objects import get_object_name\n\nfrom integral_timber_joints.assembly import Assembly\nfrom integral_timber_joints.geometry.env_model import EnvironmentModel\nfrom integral_timber_joints.process import RobotClampAssemblyProcess\nfrom integral_timber_joints.rhino.load import get_process, get_process_artist, process_is_none\nfrom integral_timber_joints.rhino.utility import get_existing_beams_filter, recompute_dependent_solutions\nfrom integral_timber_joints.tools import Clamp, Screwdriver, Gripper, RobotWrist, ToolChanger\n\ntry:\n    from typing import Dict, List, Optional, Tuple, Type\nexcept:\n    pass\n\n\ndef list_tools(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    print(\"-- Clamps --\")\n    for clamp in sorted(process.clamps, key=lambda tool: tool.name):\n        print(\"  Clamp (id = %s) type = %s)\" % (clamp.name, clamp.type_name))\n        for link in clamp.links:\n            print(\"  - Link %s with %i meshes\" % (link.name, len(link.visual)))\n\n    print(\"-- Screwdrivers --\")\n    for screwdriver in sorted(process.screwdrivers, key=lambda tool: tool.name):\n        print(\"  Screwdriver (id = %s) type = %s)\" % (screwdriver.name, screwdriver.type_name))\n        for link in screwdriver.links:\n            print(\"  - Link %s with %i meshes\" % (link.name, len(link.visual)))\n\n    print(\"-- Gripper --\")\n    for gripper in sorted(process.grippers, key=lambda tool: tool.name):\n        print(\"  type: %s (id = %s))\" % (gripper.type_name, gripper.name))\n        for link in gripper.links:\n            print(\"  - Link %s with %i meshes\" % (link.name, len(link.visual)))\n\n    print(\"-- Tool Changer --\")\n    print(\"  type: %s (id = %s))\" % (process.robot_toolchanger.type_name, process.robot_toolchanger.name))\n    for i, mesh in enumerate(process.robot_toolchanger.collision_mesh):\n        print(\"  Mesh %i with %i vertices\" % (i, mesh.number_of_vertices()))\n\n    print(\"-- Robot Wrist Meshes (collision sim only)--\")\n    print(\"  type: %s (id = %s))\" % (process.robot_wrist.type_name, process.robot_wrist.name))\n    for i, mesh in enumerate(process.robot_wrist.collision_mesh):\n        print(\"  Mesh %i with %i vertices\" % (i, mesh.number_of_vertices()))\n\n    print(\"-- Env Meshes --\")\n    print(\"  %i Environment Model(es) in current file.\" % len(process.environment_models))\n\n\ndef get_next_tool_id(process, cls):\n    # type: (RobotClampAssemblyProcess, Type) -> str\n    if cls is Clamp:\n        prefix = 'c'\n    elif cls is Screwdriver:\n        prefix = 's'\n    elif cls is Gripper:\n        prefix = 'g'\n    else:\n        raise TypeError(\"%s Class is weird.\" % cls.__name__)\n\n    existing_ids = process.tool_ids\n    for i in range(1, 100):\n        id = prefix + '%i' % i\n        if id not in existing_ids:\n            return id\n\n###########\n# Add Tools\n###########\n\n\ndef add_tool(process, cls):\n    # type: (RobotClampAssemblyProcess, Type) -> None\n    artist = get_process_artist()\n\n    # Ask user for a json file\n    tool_type_name = cls.__name__\n    path = rs.OpenFileName(\"Open\", tool_type_name + \" File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # Deserialize asert correctness and add to Process\n            tool = json.load(f, cls=DataDecoder)\n            assert tool.__class__ is cls\n            # Ask user for a new id\n            name = rs.GetString(\"Type in \" + tool_type_name + \" id typically c1,c2, etc.. Or use Default \", get_next_tool_id(process, cls))\n            if name is not None:\n                tool.name = name\n                process.add_tool(tool)\n                artist.draw_tool_in_storage(tool.name)\n                print(\"Tool added: %s(%s) \" % (tool_type_name, tool.name))\n\n\ndef add_clamp(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    add_tool(process, Clamp)\n\n\ndef add_screwdriver(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    add_tool(process, Screwdriver)\n\n\ndef add_gripper(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    add_tool(process, Gripper)\n\n##############\n# Delete Tools\n##############\n\n\ndef delete_tool(process, cls):\n    # type: (RobotClampAssemblyProcess, Type) -> None\n    tool_type_name = cls.__name__\n\n    # Gather available tools\n    existing_tools_ids = [tool_id for tool_id in process.tool_ids\n                          if process.tool(tool_id).__class__ is cls]\n    if len(existing_tools_ids) == 0:\n        print(\"No %s exist for you to delete.\" % tool_type_name)\n        return\n\n    # List out current clamps for users to choose\n    print(\"Current %s:\" % tool_type_name)\n    for tool_id in existing_tools_ids:\n        tool = process.tool(tool_id)\n        print(\"- tool_id: %s, type: %s\" % (tool.name, tool.type_name))\n\n    # Ask user which clamp to delete\n    tool_id = rs.GetString(\"Which %s to delete?\" % tool_type_name, \"Cancel\", [\"Cancel\"] + existing_tools_ids)\n    if tool_id in existing_tools_ids:\n        process.delete_tool(tool_id)\n        artist = get_process_artist()\n        artist.delete_tool_in_storage(tool_id)\n\n\ndef delete_clamp(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    delete_tool(process, Clamp)\n\n\ndef delete_screwdriver(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    delete_tool(process, Screwdriver)\n\n\ndef delete_gripper(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    delete_tool(process, Gripper)\n\n###############\n# Replace Tools\n###############\n\n\ndef replace_tool(process, cls):\n    # type: (RobotClampAssemblyProcess, Type) -> None\n    tool_type_name = cls.__name__\n\n    # Gather available tools\n    existing_tools_ids = [tool_id for tool_id in process.tool_ids\n                          if process.tool(tool_id).__class__ is cls]\n    if len(existing_tools_ids) == 0:\n        print(\"No %s exist for you to replace.\" % tool_type_name)\n        return\n\n    while(True):\n        # List out current tools for users to choose\n        print(\"Current %s:\" % tool_type_name)\n        for tool_id in existing_tools_ids:\n            tool = process.tool(tool_id)\n            print(\"- tool_id: %s, type: %s\" % (tool.name, tool.type_name))\n\n        # Ask user which tool to delete\n        tool_id = rs.GetString(\"Which %s to replace? (id and storage frame are kept)\" % tool_type_name, \"Cancel\", [\"Cancel\"] + existing_tools_ids)\n\n        if tool_id in existing_tools_ids:\n            old_tool = process.tool(tool_id)\n            path = rs.OpenFileName(\"Open\", \"%s File (*.json)|*.json|All Files (*.*)|*.*||\" % tool_type_name)\n            with open(path, 'r') as f:\n                # Deserialize asert correctness and add to Process\n                new_tool = json.load(f, cls=DataDecoder)\n                assert tool.__class__ is cls\n\n                # Copy over old attributes\n                new_tool.name = old_tool.name\n                new_tool.tool_storage_frame = old_tool.tool_storage_frame\n                new_tool.tool_storage_configuration = old_tool.tool_storage_configuration\n            artist = get_process_artist()\n            artist.delete_tool_in_storage(tool_id)\n            process.delete_tool(tool_id)\n            process.add_tool(new_tool)\n            artist.draw_tool_in_storage(tool_id)\n            print(\"%s is replaced by %s.\" % (old_tool, new_tool))\n        else:\n            return\n\n\ndef replace_clamp(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    replace_tool(process, Clamp)\n\n\ndef replace_screwdriver(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    replace_tool(process, Screwdriver)\n\n\ndef replace_gripper(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    replace_tool(process, Gripper)\n\n\ndef replace_toolchanger(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open\", \"ToolChanger File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # Deserialize asert correctness and add to Process\n            tool = json.load(f, cls=DataDecoder)\n            assert isinstance(tool, ToolChanger)\n            process.robot_toolchanger = tool\n            print(\"Tool Changer replaced with %s\" % tool)\n\n\n#######\n# Robot\n#######\n\ndef set_robot_initial_config(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    # Ask user to pick a Configuration json\n    path = rs.OpenFileName(\"Open a Configuration json, representing initial robot config.\", \"Configuration File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            configuration = json.load(f, cls=DataDecoder)  # type: Configuration\n            assert configuration.__class__.__name__ == Configuration.__name__\n            process.robot_initial_config = configuration\n            print(\"Robot Initial Config is successfully loaded from %s\" % path)\n\n\ndef replace_robot_wrist(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open\", \"ToolChanger File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # robot_wrist asert correctness and add to Process\n            tool = json.load(f, cls=DataDecoder)\n            assert isinstance(tool, RobotWrist)\n            process.robot_wrist = tool\n            print(\"Robot Wrist Object replaced with %s\" % tool)\n\n\n############\n# Env Models\n############\n\n\ndef add_env_model(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    # Ask user to pick one or more mesh object\n    guids = rs.GetObjects(\"Select Mesh(es) for Environment Model (cannot contain convex hull)\", filter=rs.filter.mesh)\n    if guids is None:\n        print(\"No mesh selected.\")\n        return\n    # Show all current env mesh\n    artist = get_process_artist()\n    artist.show_all_env_mesh()\n\n    # Create compas mesh and add it to process.environment_models\n    for guid in guids:\n        rhinomesh = RhinoMesh.from_guid(guid)\n        environment_model = rhinomesh.to_compas(EnvironmentModel)  # type: EnvironmentModel\n        process.add_environment_model(environment_model)\n    # trigger artist to draw that mesh in correct layer\n    artist.draw_all_env_mesh(delete_old=True)\n\n    for beam_id in process.assembly.sequence:\n        process.dependency.invalidate(beam_id, process.create_actions_from_sequence)\n\n\n\ndef delete_all_env_model(process):\n    # type: (RobotClampAssemblyProcess) -> None\n\n    # Show all current env mesh\n    # todo\n\n    # Ask user to reconfirm\n    reconfirm = rs.GetString(\"Are You Sure?\", \"Yes\", [\"Yes\", \"No\"])\n    if reconfirm is None:\n        return\n    if reconfirm.startswith(\"Y\") or reconfirm.startswith(\"y\"):\n        artist = get_process_artist()\n        artist.delete_all_env_mesh()\n        process.environment_models = {}\n\n        for beam_id in process.assembly.sequence:\n            process.dependency.invalidate(beam_id, process.create_actions_from_sequence)\n        print(\"All EnvMeshes are removed\")\n\n\ndef copy_tools(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    \"\"\"Copying tools from another process file.\"\"\"\n\n    # If there are existing tools\n    delete_old = False\n    if len(list(process.tool_ids)):\n        reconfirm = rs.GetString(\"There are %i Clamps, %i Screwdrivers, %i Grippers in current file, do you want to delete them?\" %\n                                 (len(list(process.clamps)), len(list(process.screwdrivers)), len(list(process.grippers))), \"Delete\", [\"Delete\", \"Keep\"])\n        if reconfirm is None:\n            return\n        if reconfirm.startswith(\"D\") or reconfirm.startswith(\"d\"):\n            delete_old = True\n\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open another process file to copy from\", \"Process File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # robot_wrist asert correctness and add to Process\n            another_process = json.load(f, cls=DataDecoder)  # type: RobotClampAssemblyProcess\n        if delete_old:\n            process.attributes['clamps'] = another_process.attributes['clamps']\n            process.attributes['screwdrivers'] = another_process.attributes['screwdrivers']\n            process.attributes['grippers'] = another_process.attributes['grippers']\n            print(\"Old clamps and Grippers deleted, %i Clamps, %i Screwdrivers, %i Grippers imported.\" % (len(list(process.clamps)), len(list(process.screwdrivers)), len(list(process.grippers))))\n        else:\n            for tool in another_process.tools:\n                process.add_tool(tool)\n\n            print(\"%i Clamps, %i Screwdrivers, %i Grippers imported. Now total: %i Clamps, %i Clamps, %i Grippers\" % (\n                len(list(another_process.clamps)), len(list(another_process.screwdrivers)), len(list(another_process.grippers)),\n                len(list(process.clamps)), len(list(process.screwdrivers)), len(list(process.grippers))))\n\n    artist = get_process_artist()\n    artist.delete_all_tools_in_storage()\n    for tool_id in process.tool_ids:\n        artist.draw_tool_in_storage(tool_id)\n\n\ndef copy_tool_changer(process):\n    # type: (RobotClampAssemblyProcess) -> None\n\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open another process file to copy from\", \"Process File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            another_process = json.load(f, cls=DataDecoder)  # type: RobotClampAssemblyProcess\n            # Asert correctness and add to Process\n            if another_process.robot_toolchanger is None:\n                print(\"Opened file do not have robot_toolchanger\")\n                return\n            process.robot_toolchanger = another_process.robot_toolchanger\n            print(\"robot_toolchanger replaced by %s. \" % process.robot_toolchanger.name)\n\n\ndef copy_rob_wrist(process):\n    # type: (RobotClampAssemblyProcess) -> None\n\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open another process file to copy from\", \"Process File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            another_process = json.load(f, cls=DataDecoder)  # type: RobotClampAssemblyProcess\n            # Asert correctness and add to Process\n            if another_process.robot_wrist_collision_mesh is None:\n                print(\"Opened file do not have robot_wrist_collision_mesh\")\n                return\n            process.robot_wrist_collision_mesh = another_process.robot_wrist_collision_mesh\n            print(\"robot_wrist_collision_mesh replaced by %s. \" % process.robot_wrist_collision_mesh.name)\n\n\ndef copy_env_models(process):\n    # type: (RobotClampAssemblyProcess) -> None\n\n    # If there are existing tools\n    delete_old = False\n    if len(process.environment_models) > 0:\n        reconfirm = rs.GetString(\"There are %i Environment Model(es) in current file, do you want to delete them?\" %\n                                 (len(process.environment_models)), \"Delete\", [\"Delete\", \"Keep\"])\n        if reconfirm is None:\n            return\n        if reconfirm.startswith(\"D\") or reconfirm.startswith(\"d\"):\n            delete_old = True\n\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open another process file to copy from\", \"Process File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # robot_wrist asert correctness and add to Process\n            another_process = json.load(f, cls=DataDecoder)  # type: RobotClampAssemblyProcess\n        if delete_old:\n            process.environment_models = another_process.environment_models\n            print(\"Old Environment Model(es) deleted, %i Environment Model(es) imported.\" % (len(process.environment_models)))\n        else:\n            for env_id, env_model in process.environment_models.items():\n                process.environment_models[env_id] = env_model\n            print(\"%i Environment Model(es) imported. Now total: %i Environment Model(es)\" % (len(another_process.environment_models), len(process.environment_models)))\n\n\ndef copy_all(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    reconfirm = rs.GetString(\"There are %i Clamps, %i Screwdrivers, %i Grippers, ToolChanger, RobotWrist, %i Environment Model(es) in current file, do you want to delete them and replace by new ones?\" % (\n        len(process.environment_models),\n        len(list(process.clamps)),\n        len(list(process.screwdrivers)),\n        len(list(process.grippers))),\n        \"Delete\", [\"DeleteAndContinue\", \"Cancel\"])\n    if reconfirm is None:\n        return\n    if reconfirm.startswith(\"C\") or not reconfirm.startswith(\"D\"):\n        return\n\n    # Ask user for a json file\n    path = rs.OpenFileName(\"Open another process file to copy from\", \"Process File (*.json)|*.json|All Files (*.*)|*.*||\")\n    if path:\n        with open(path, 'r') as f:\n            # robot_wrist asert correctness and add to Process\n            another_process = json.load(f, cls=DataDecoder)  # type: RobotClampAssemblyProcess\n\n        process.attributes['clamps'] = another_process.attributes['clamps']\n        process.attributes['grippers'] = another_process.attributes['grippers']\n        process.attributes['screwdrivers'] = another_process.attributes['screwdrivers']\n        print(\"Old clamps and Grippers deleted, %i Clamps, %i Screwdrivers, %i Grippers imported.\" % (len(list(process.clamps)), len(list(process.screwdrivers)), len(list(process.grippers))))\n\n        process.robot_toolchanger = another_process.robot_toolchanger\n        process.robot_wrist = another_process.robot_wrist\n        print(\"Toolchanger is replaced by %s, RobotWrist is replaced by %s.\" % (process.robot_toolchanger.type_name, process.robot_wrist.type_name))\n\n        process.environment_models = another_process.environment_models\n        print(\"Old Environment Model(es) deleted, %i Environment Model(es) imported.\" % (len(process.environment_models)))\n\n\n##############################\n# Tool Storage / Configuration\n##############################\n\n\ndef ui_ask_user_for_tool_id(process, message=\"Which Tool ID\", print_existing_tools=True, include_clamp=True, inclde_gripper=True, inclde_screwdriver=True):\n    # type: (RobotClampAssemblyProcess,str, bool, bool, bool, bool) -> str\n    \"\"\"Note that the list of tools names available must start with a letter character, cannot be numbers\"\"\"\n    ids = []\n    if include_clamp:\n        if print_existing_tools:\n            print(\"-- Existing Clamps --\")\n        for clamp in process.clamps:\n            ids.append(clamp.name)\n            if print_existing_tools:\n                print(\"  Clamp (id = %s) type = %s)\" % (clamp.name, clamp.type_name))\n    if inclde_screwdriver:\n        if print_existing_tools:\n            print(\"-- Existing Clamps --\")\n        for screwdriver in process.screwdrivers:\n            ids.append(screwdriver.name)\n            if print_existing_tools:\n                print(\"  Screwdriver (id = %s) type = %s)\" % (screwdriver.name, screwdriver.type_name))\n\n    if inclde_gripper:\n        if print_existing_tools:\n            print(\"-- Existing Gripper --\")\n        for gripper in process.grippers:\n            ids.append(gripper.name)\n            if print_existing_tools:\n                print(\"  type: %s (id = %s))\" % (gripper.type_name, gripper.name))\n\n    # Return wNone if nothing is available for picking\n    if len(ids) == 0:\n        print(\"Error: No existing tool for picking.\")\n        return None\n\n    # Ask user to pick from a list\n    tool_id = rs.GetString(message, \"Finish\", [\"Finish\"] + sorted(ids))\n    # Ask user for 3 point input\n    if tool_id in ids:\n        return tool_id\n    elif tool_id == \"Finish\":\n        return None\n    else:\n        print(\"%s is not a valid input.\" % tool_id)\n        return None\n\n\ndef set_tool_storage_frame(process, set_from_robot_flange=False):\n    # type: (RobotClampAssemblyProcess, bool) -> None\n    \"\"\"Function invoked by user to set the storage position.\"\"\"\n\n    while True:\n        # Ask user which tool to set\n        tool_id = ui_ask_user_for_tool_id(process, \"Change storage position for which tool?\")\n\n        # Ask user for 3 point input\n        if tool_id is None:\n            return\n\n        # Ask for origin\n        if set_from_robot_flange:\n            origin = rs.GetPoint(\"Pick point as robot flange origin for %s in storage.\" % tool_id)\n            x_point = rs.GetPoint(\"Pick point on robot flange X direction for %s in storage.\" % tool_id)\n            y_point = rs.GetPoint(\"Pick point on robot flange Y direction for %s in storage.\" % tool_id)\n\n            robot_flange_frame = Frame(origin, x_point - origin, y_point - origin)\n            tool_changer = process.robot_toolchanger\n            tool_changer.current_frame = robot_flange_frame\n            tool_storage_frame = tool_changer.current_tcf\n        else:\n            origin = rs.GetPoint(\"Pick point as frame origin for %s in storage.\" % tool_id)\n            x_point = rs.GetPoint(\"Pick point on frame X direction for %s in storage.\" % tool_id)\n            y_point = rs.GetPoint(\"Pick point on frame Y direction for %s in storage.\" % tool_id)\n            tool_storage_frame = Frame(origin, x_point - origin, y_point - origin)\n\n        # Alignment frame\n        process.tool(tool_id).tool_storage_frame = tool_storage_frame\n        print(\"Tool %s Storage Frame changed to : %s \" % (tool_id, tool_storage_frame))\n\n        # Invalidate tool storage related calculations\n        # process.dependency.invalidate(something about storage position)\n        # Storage positions do not actually have much computation. It is not visualized in Grasp Pose\n        # It is only used directly when Actions create Movements.\n\n        # Redraw Tool\n        artist = get_process_artist()\n        artist.draw_tool_in_storage(tool_id, delete_old=True)\n        rs.EnableRedraw(True)\n\n\ndef set_tool_storage_frame_from_robot_flange(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    \"\"\"Function invoked by user to set the storage position.\"\"\"\n    if process.robot_toolchanger is None:\n        print(\"robot_toolchanger is None. Load the toolchanger first.\")\n        return False\n    set_tool_storage_frame(process, True)\n\n\ndef set_tool_storage_configuration(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    \"\"\"Function invoked by user to set the storage configuration.\"\"\"\n    while True:\n        # Ask user which tool to set\n        tool_id = ui_ask_user_for_tool_id(process, \"Set storage configuration for which tool?\")\n        if tool_id is None:\n            return\n\n        # Ask user for 3 point input\n        path = rs.OpenFileName(\"Open a Configuration json, for Tool %s storage configuration.\" % tool_id, \"Configuration File (*.json)|*.json|All Files (*.*)|*.*||\")\n        if path:\n            with open(path, 'r') as f:\n                configuration = json.load(f, cls=DataDecoder)  # type: Configuration\n                assert isinstance(configuration, Configuration)\n                process.tool(tool_id).tool_storage_configuration = configuration\n                print(\"Tool Storage Configuration is successfully loaded from %s\" % path)\n\n                # Perform FK with robot model to get flange frame and tool frame\n                configuration_mm = configuration.scaled(1000)\n                robot_flange_frame = process.robot_model.forward_kinematics(configuration_mm, process.ROBOT_END_LINK)\n                toolchanger = process.robot_toolchanger\n                toolchanger.current_frame = robot_flange_frame\n                tool_frame = toolchanger.current_tcf\n                process.tool(tool_id).tool_storage_frame = tool_frame\n                print(\"Tool storage frame set at %s\" % tool_frame)\n\n        else:\n            print(\"Function Canceled\")\n\n\ndef remove_tool_storage_configuration(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    \"\"\"Function invoked by user to remove the storage configuration.\"\"\"\n\n    while True:\n        # Ask user which tool to set\n        tool_id = ui_ask_user_for_tool_id(process, \"Remove storage configuration for which tool?\")\n        if tool_id is None:\n            return\n\n        process.tool(tool_id).tool_storage_configuration = None\n        print(\"Tool %s Storage Configuration is successfully removed.\" % tool_id)\n\n\ndef not_implemented(process):\n    #\n    print('This function is not implemented')\n\n\ndef show_menu(process):\n    # type: (RobotClampAssemblyProcess) -> None\n    assembly = process.assembly  # type: Assembly\n    artist = get_process_artist()\n\n    while (True):\n\n        # Have artist paint all the tools in storage position and env mesh\n        for tool_id in process.tool_ids:\n            artist.draw_tool_in_storage(tool_id, delete_old=True)\n\n        artist.draw_robot(process.robot_initial_config)\n        artist.draw_all_env_mesh(delete_old=True)\n        rs.EnableRedraw(True)\n\n        # Create Menu\n        config = {\n            'message': 'Process contains %i Clamps, %i Screwdrivers, %i Grippers, %i EnvMeshs:' % (len(list(process.clamps)), len(list(process.screwdrivers)), len(list(process.grippers)), len(process.environment_models)),\n            'options': [\n                {'name': 'Finish', 'action': 'Exit'\n                 },\n                {'name': 'ListTools', 'action': list_tools\n                 },\n                {'name': 'Clamps', 'message': 'Process have %i Clamps:' % len(list(process.clamps)), 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'AddClamp', 'action': add_clamp},\n                    {'name': 'DeleteClamp', 'action': delete_clamp},\n                    {'name': 'ReplaceClamp', 'action': replace_clamp},\n                ]},\n                {'name': 'Screwdrivers', 'message': 'Process have %i Screwdrivers:' % len(list(process.screwdrivers)), 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'AddScrewdriver', 'action': add_screwdriver},\n                    {'name': 'DeleteScrewdriver', 'action': delete_screwdriver},\n                    {'name': 'ReplaceScrewdrivers', 'action': replace_screwdriver},\n                ]},\n                {'name': 'Gripper', 'message': 'Process have %i Gripper:' % len(list(process.grippers)), 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'AddGripper', 'action': add_gripper},\n                    {'name': 'DeleteGripper', 'action': delete_gripper},\n                    {'name': 'ReplaceGripper', 'action': replace_gripper},\n                ]},\n                {'name': 'SetToolStorage', 'message': 'Setting Tool Storage', 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'SetFrameFromToolFrame', 'action': set_tool_storage_frame},\n                    {'name': 'SetFrameFromRobotFlangeFrame', 'action': set_tool_storage_frame_from_robot_flange},\n                    {'name': 'SetConfiguration', 'action': set_tool_storage_configuration},\n                    {'name': 'RemoveConfiguration', 'action': remove_tool_storage_configuration},\n                ]},\n                {'name': 'RobotToolChanger', 'message': 'Process robot_toolchanger:', 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'ReplaceToolChanger', 'action': replace_toolchanger},\n                ]},\n                {'name': 'Robot', 'message': 'Process Robot is: %s' % process.robot_model, 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'SetInitialConfig', 'action': set_robot_initial_config},\n                ]},\n                {'name': 'RobotWrist', 'message': 'Process robot_wrist', 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'ReplaceRobotWrist', 'action': replace_robot_wrist},\n                ]},\n                {'name': 'EnvModels', 'message':  'We have %i Env Meshes:' % len(process.environment_models), 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'AddEnvModel', 'action': add_env_model},\n                    {'name': 'DeleteEnvModel', 'action': not_implemented},\n                    {'name': 'DeleteAllModel', 'action': delete_all_env_model},\n                ]},\n                {'name': 'CopyFromAnotherFile', 'message':  'Copy from another file:', 'options': [\n                    {'name': 'Back', 'action': 'Back'},\n                    {'name': 'CopyTools', 'action': copy_tools},\n                    {'name': 'CopyToolChanger', 'action': copy_tool_changer},\n                    {'name': 'CopyRobWrist', 'action': copy_rob_wrist},\n                    {'name': 'CopyEnvModel', 'action': copy_env_models},\n                    {'name': 'CopyAll', 'action': copy_all},\n                ]},\n\n            ]\n\n        }\n\n        result = CommandMenu(config).select_action()\n        # User cancel command by Escape\n        if result is None or 'action' not in result:\n            artist.hide_all_tools_in_storage()\n            artist.hide_all_env_mesh()\n            artist.hide_robot()\n            rs.EnableRedraw(True)\n            print('Exit Function')\n            return Rhino.Commands.Result.Cancel\n\n        action = result['action']\n\n        # User click Exit Button\n        if action == 'Exit':\n            artist.hide_all_tools_in_storage()\n            artist.hide_all_env_mesh()\n            artist.hide_robot()\n            rs.EnableRedraw(True)\n            print('Exit Function')\n            return Rhino.Commands.Result.Cancel\n        if action == 'Back':\n            # Back is simply redisplaying the menu again from root.\n            continue\n        else:\n            # Run the selected command\n            action(process)\n\n\n######################\n# Rhino Entry Point\n######################\n# Below is the functions that get evoked when user press UI Button\n# Put this in the Rhino button ! _-RunPythonScript 'integral_timber_joints.rhino.tools_environment.py'\nif __name__ == '__main__':\n    process = get_process()\n    if process_is_none(process):\n        print(\"Load json first\")\n    else:\n        show_menu(process)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}