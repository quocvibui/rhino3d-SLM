{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/constraint.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/constraint.py",
  "instruction": "Create a new constrained insertion space.",
  "code": "\"\"\"Create a new constrained insertion space.\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport rhinoscriptsyntax as rs\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Create Constraint\", \"Constraint\", \"\"\"Create a new constrained insertion space.\"\"\", \"Manis\", \"Assembly\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"46acbe0b-f549-435c-b685-c2e67e4359c2\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):      \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"alpha\", \"alpha\", \"Horizontal constraint angle.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"beta\", \"beta\", \"Vertical constraint angle.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"constraint\", \"constraint\", \"Constrained insertion space.\")\r\n        self.Params.Output.Add(p)\r\n        p = Grasshopper.Kernel.Parameters.Param_Surface()\r\n        self.SetUpParam(p, \"boundaries\", \"boundaries\", \"Boundary surfaces constraining the insertion space.\")\r\n        self.Params.Output.Add(p)  \r\n        \r\n    \r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        result = self.RunScript(p0, p1)\r\n\r\n        if result is not None:\r\n            if not hasattr(result, '__getitem__'):\r\n                self.marshal.SetOutput(result, DA, 0, True)\r\n            else:\r\n                self.marshal.SetOutput(result[0], DA, 0, True)\r\n                self.marshal.SetOutput(result[1], DA, 1, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAC6SURBVEhL7Y5RDgIxCEQ9k2fyTD2TZ/KHdQpYipO6JvTDRJLXbYdh2IuIbIWKlVCxEipWQsVKqFgJFSuhYuZZOBjUH6Gi40GP+43i/W4k84CLNshCGe7vgznrTfgiOMOWzA8z4MsCVthMn+3HaoEbY8AK877m+pEXeAMVtRjEUPv0kygdxjs0Rtc011kwUOvwmh+lg3ibODrB7EA+E+5Y6cWEoSazg9aZcGA1XfZxbU128l/wkV9f0OQApsqgOBWdkr0AAAAASUVORK5CYII=\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n    \r\n    def RunScript(self, alpha, beta):\r\n       \r\n        constraint = None\r\n        boundaries = None\r\n        sphere =  rs.AddSphere((0,0,0),1)\r\n        cutter = rs.AddPlanarSrf(rs.AddPolyline([(1,1,0),(1,-1,0),(-1,-1,0),(-1,1,0),(1,1,0)]))\r\n        hemisphere = rs.SplitBrep(sphere,cutter)[1]\r\n\r\n        if alpha is None: alpha = 180\r\n        if beta is None: beta = 180\r\n\r\n        boundaries = [cutter[0]]\r\n        cutter2 = rs.RotateObject(cutter,(0,0,0),90+(alpha/2),(0,1,0),(True))\r\n        cutter3 = rs.RotateObject(cutter,(0,0,0),90-(alpha/2),(0,1,0),(True))\r\n        cutter4 = rs.RotateObject(cutter,(0,0,0),90+(beta/2),(1,0,0),(True))\r\n        cutter5 = rs.RotateObject(cutter,(0,0,0),90-(beta/2),(1,0,0),(True))\r\n        boundaries.append(cutter2)\r\n        boundaries.append(cutter3)\r\n        boundaries.append(cutter4)\r\n        boundaries.append(cutter5)\r\n\r\n        if alpha == 0:\r\n            if beta == 0:\r\n                constraint = rs.AddPoint(0,0,1)\r\n            else:\r\n                arc = rs.AddArc(rs.WorldYZPlane(),1,beta)\r\n                constraint = rs.RotateObject(arc,(0,0,0),90-(beta/2),(1,0,0),(True))\r\n        else:\r\n            if beta == 0:\r\n                arc = rs.AddArc(rs.WorldZXPlane(),1,alpha)\r\n                constraint = rs.RotateObject(arc,(0,0,0),-(alpha/2),(0,1,0),(True))\r\n            else:\r\n                constraint = hemisphere\r\n                if alpha<180:\r\n                    constraint = rs.SplitBrep(constraint,cutter2)[0]\r\n                    constraint = rs.SplitBrep(constraint,cutter3)[1]\r\n                if beta<180:\r\n                    constraint = rs.SplitBrep(constraint,cutter4)[0]\r\n                    constraint = rs.SplitBrep(constraint,cutter5)[1]\r\n\r\n        return (constraint,boundaries)\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Animate Sequence\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"516e3730-d1f4-409b-9a7a-50182a323983\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}