{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/plugin_files/Batch_Import.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "plugin_files/Batch_Import.py",
  "instruction": "Batch import",
  "code": "ï»¿from ghpythonlib.componentbase import dotnetcompiledcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport ghpythonlib.treehelpers as th\nimport os\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\n\nrcdoc = Rhino.RhinoDoc.ActiveDoc\nghdoc = sc.doc\n\nclass MyComponent(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\n            \"BatchImport\", \"BatchImport\", \"\"\"Imports geometry from Rhino files into GH, preserves layers' hierarchy as a data tree.\nImports .3dm files into Rhino and Grasshopper. \nThe component can erase existing geometry in the Rhinodoc.\n    Typical usage:\nTakes a number of files and imports their geometries to GH.\nYou need to provide a path for the folder that contains the files to be imported.\nUse the string concatenate component to join the file path of the folder with the number/name of the file to be imported.\nYou can specify the file number with a slider.\nUse another string concatenate component to concatenate the file extension to the file path of the files and plug it into the FilePaths input of the component.\nBased on the work of Jackie Berry.\"\"\", \"Extra\", \"LocalCode\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"5ae80faf-486f-463d-a98c-71d290793707\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_String()\n        self.SetUpParam(p, \"filenames\", \"filenames\", \"The x script variable\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"sourceFolderPath\", \"sourceFolderPath\", \"Script input sourceFolderPath.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"Import\", \"Import\", \"boolean to activate the import\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"deleteExisting\", \"deleteExisting\", \"boolean to delete existing geometry in file\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"geometryOut\", \"geometryOut\", \"The imported geometry into GH space.\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"status\", \"status\", \"Script output status.\")\n        self.Params.Output.Add(p)\n        \n    \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        p1 = self.marshal.GetInput(DA, 1)\n        p2 = self.marshal.GetInput(DA, 2)\n        p3 = self.marshal.GetInput(DA, 3)\n        result = self.RunScript(p0, p1, p2, p3)\n\n        if result is not None:\n            if not hasattr(result, '__getitem__'):\n                self.marshal.SetOutput(result, DA, 0, True)\n            else:\n                self.marshal.SetOutput(result[0], DA, 0, True)\n                self.marshal.SetOutput(result[1], DA, 1, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAHYcAAB2HAY/l8WUAAAJlSURBVEhLxZVNaxNRFIZTauzED7TB0FQSmxZDMDQkbjS2apIm1VaIoC4EcSG4cKEiCoJuFOpGKmhQsyxSQVSsiogfC40rf4CbgogWdCEiirViKyYe37e5Z2GcFNrE+sBDyDv3npM5c5k45hsLrjAuYAAWQrdRMyeszBrhMqNmf7EPjhtjDMAO+NkYZwAyULMkA7AefjT2MbDjKBSjFmNTzXoYADbVLMsApKFmuxnY0Q3z8DL0MwC8k5yxnQEIwUFjkAEIQM3CDP4LbXC7kQ+LtMJtxmYGwAM144Egy2Ev3AJ53ZZDUOe4jgHYCzVLMACcu2b9DACvabaTgR3/vIEPcgOP2VIGoAVqxjEQnn8eVapj40g107HND9GA3ypEIkueRTpd9RP1fD7rKRtk8+fXiEhGSuMbpfildllHpFfOnAryeTg87asWPx65Hp1uIsWEyPfNIpNzkPtK2I86V4c6xb+y6Q4bKAPHDgekNJXCgqTI100iE7OQ67FvaiIpB/b7+ctPlMv+STaVcH94/bILi3tEvlUUqSbXYf3oi7hsiLvfog7fS1Vpa/W6CndvcWTp8q1XuxvmP3Ad664NR8Ttth5gv7dcZmYa4ODJ4x0iPzGyX5hrZRMzkuJkSo4cDHAkp6d3zpJd/WnPp3dveCowMi1uRvJqtEtS3c3vsY7vpDmzOuBb9PzhvbU4IXj4LF5Myu0bUfG2uJ7gur7WawJ/gQ1XCo9iGFdG7o/EOJJL5Uv1Y+vN4RBG0ydD+TAb6D9e3dhz8VxQxsZScnYgxAY1zd2OsNPZmLOsphw+L+B7RzmeCYfjN6Hu2rXbx7TKAAAAAElFTkSuQmCC\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    \n\n        \n    \"\"\"\n    Deletes existing geometry from Rhino file before import.\n    \"\"\"\n    def deleteExistingGeom(self):\n        sc.doc = Rhino.RhinoDoc.ActiveDoc\n        objects = rs.AllObjects()\n        if objects:\n            for obj in objects:\n                rs.DeleteObject(obj)\n        layers = rs.LayerNames()\n        for layer in layers:\n            if layer!=rs.CurrentLayer():\n                rs.DeleteLayer(layer)\n        return\n\n    \"\"\"\n    Imports geometry from files\n\n    \"\"\"\n    def importRhinoFile(self, fileNames, sourcePath, Import):\n\n        #file import\n        for fn in fileNames:\n            thisFilePath = os.path.join(sourcePath,fn)\n            importCommandString = '_-Import \"' + thisFilePath + '\" _Enter'\n            imported = rs.Command(importCommandString, echo=False)\n\n            if not imported:\n                print \"there was a problem with file: \" + fn\n                self.AddRuntimeMessage(RML.Warning,\"there was a problem with file: \" + fn)\n\n        return\n\n\n    \"\"\"\n    Grabs geometry from Rhino and constructs data tree.\n    Each branch of the tree is a different layer in the document.\n    \"\"\"\n    def rhinoGeomToDataTree(self):\n        sc.doc = rcdoc\n        layers = rs.LayerNames(sort=False)\n        sc.doc = ghdoc\n    #    layerTree = [[] for layer in layers]\n        layerTree = []\n        for i in range(len(layers)):\n            objs = Rhino.RhinoDoc.ActiveDoc.Objects.FindByLayer(layers[i])\n\n            if objs:\n                geoms = [obj.Geometry for obj in objs]\n    #            layerTree[i].extend(geoms)\n                layerTree.append(geoms)\n        status= str(len(layerTree))+ \" branches \\n\"\n\n        layerTree = th.list_to_tree(layerTree, source=[])\n\n        return layerTree, status\n\n    def RunScript(self, filenames, sourceFolderPath, Import, deleteExisting):\n        geometryOut, status = None, None\n        if filenames == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add filenames.\")\n        if sourceFolderPath == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add a source Folder Path as a string.\")\n        if Import == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add a boolean toggle to the 'Import' input.\")\n        #Perform Import\n        if Import:\n            # option to delete existing geometry in document\n            status = \"start import \\n\"\n            if deleteExisting:\n                self.deleteExistingGeom()\n                status += \"deleted \\n\"\n\n            #now import geometry from files\n            if (filenames != None) and (sourceFolderPath != None):\n                #import function here\n                self.importRhinoFile(filenames, sourceFolderPath)\n                status += \"imported rhino files \\n\"\n#                thisDoc.ScheduleSolution(20, self.rhinoGeomToDataTree)\n                geometryAndStatus=self.rhinoGeomToDataTree()\n                geometryOut = geometryAndStatus[0]\n                status+=geometryAndStatus[1]\n                status += \"geometry to datatree \\n\"\n            else:\n                if filenames==[]:\n                    print \"Provide a list of filenames\"\n                    self.AddRuntimeMessage(RML.Warning,\"Provide a list of filenames\")\n                if sourceFolderPath==None:\n                    print \"Provide the path to your source folder\"\n                    self.AddRuntimeMessage(RML.Warning,\"Provide the path to your source folder\")\n\n        # return outputs if you have them; here I try it for you:\n        return (geometryOut, status)\n\n\nimport GhPython\nimport System\n\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\n    def get_AssemblyName(self):\n        return \"BatchImport\"\n    \n    def get_AssemblyDescription(self):\n        return \"\"\"\"\"\"\n\n    def get_AssemblyVersion(self):\n        return \"0.1\"\n\n    def get_AuthorName(self):\n        return \"\"\n    \n    def get_Id(self):\n        return System.Guid(\"afe9ee0a-66e4-473d-a7eb-063849a8b82e\")",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}