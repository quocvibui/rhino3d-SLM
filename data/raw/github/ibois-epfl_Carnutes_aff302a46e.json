{
  "source_url": "https://github.com/ibois-epfl/Carnutes/blob/d3bf0a816670108b5da1aafbd95493ae2260f2cc/src/Carnutes/draw_connectivity_grah.py",
  "repo": "ibois-epfl/Carnutes",
  "repo_stars": 3,
  "repo_description": "Workshop content for AW 2024 Ba3-Ma1 architecture studio",
  "license": "GPL-3.0",
  "filepath": "src/Carnutes/draw_connectivity_grah.py",
  "instruction": "this function creates a graph from the selected breps or lines and draws a graph of the connected elements in the rhino scene. This is for visual inspection of the 3d model.",
  "code": "\"\"\"\nthis function creates a graph from the selected breps or lines and draws a graph of the connected elements in the rhino scene. This is for visual inspection of the 3d model.\n\"\"\"\n\n#! python3\n\n# r: numpy==2.0.2\n# r: open3d==0.19.0\n# r: ZODB==6.0\n# r: igraph==0.11.6\n\nimport os\nimport sys\nimport copy\nimport System\nimport platform\n\nimport System.Drawing\n\nimport Rhino\nimport scriptcontext as sc\n\nfrom utils.model import Model, element\n\n# Create a new layer into which we output the graph\nlayer_name = \"Layer_for_connectivity_graph\"\nlayer_index = sc.doc.Layers.Add(\n    layer_name, System.Drawing.Color.FromArgb(255, 50, 255, 50)\n)\nsc.doc.Layers.SetCurrentLayerIndex(layer_index, True)\n\nattributes = Rhino.DocObjects.ObjectAttributes()\nattributes.LayerIndex = layer_index\nattributes.ObjectColor = System.Drawing.Color.FromArgb(255, 100, 100, 100)\n\n\ndef get_geometries():\n    \"\"\"\n    Just a small utility function to get the geometries from the Rhino scene\n    \"\"\"\n    go = Rhino.Input.Custom.GetObject()\n    go.SetCommandPrompt(\"Select the breps or lines\")\n    go.GeometryFilter = (\n        Rhino.DocObjects.ObjectType.Brep | Rhino.DocObjects.ObjectType.Curve\n    )\n    go.GetMultiple(1, 100000)\n    if go.CommandResult() != Rhino.Commands.Result.Success:\n        print(\"No object selected.\")\n    geometries = [go.Object(i).Geometry() for i in range(go.ObjectCount)]\n    return geometries\n\n\ndef main():\n    # Get the geometries from the Rhino scene\n    geometries = get_geometries()\n    if len(geometries) < 2:\n        print(\"At least two geometries are needed to create a graph.\")\n        return\n\n    if isinstance(geometries[0], Rhino.Geometry.LineCurve):\n        geometries = [geo.ToNurbsCurve() for geo in geometries]\n        print(\"LineCurves converted to NurbsCurves\")\n    elif isinstance(geometries[0], Rhino.Geometry.Line):\n        geometries = [geo.ToNurbsCurve() for geo in geometries]\n        print(\"Lines converted to NurbsCurves\")\n    elif isinstance(geometries[0], Rhino.Geometry.Curve):\n        geometries = [geo.ToNurbsCurve() for geo in geometries]\n        print(\"Curves converted to NurbsCurve\")\n\n    # Create the model\n    elements = [element.Element(geometries[i], i) for i in range(len(geometries))]\n    abstract_model = Model(elements)\n    for edge in abstract_model.connectivity_graph.graph.get_edgelist():\n        sc.doc.Objects.AddLine(\n            abstract_model.elements[edge[0]].geometry.GetBoundingBox(False).Center,\n            abstract_model.elements[edge[1]].geometry.GetBoundingBox(False).Center,\n            attributes,\n        )\n\n    print(\n        \"Graph created with {} vertices and {} edges\".format(\n            abstract_model.connectivity_graph.graph.vcount(),\n            abstract_model.connectivity_graph.graph.ecount(),\n        )\n    )\n\n\nif __name__ == \"__main__\":\n    main()\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}