{
  "source_url": "https://discourse.mcneel.com/t/how-to-set-the-jpg-quality-when-saving-a-bitmap-in-python-or-rhino-script/141657",
  "topic_id": 141657,
  "title": "How to set the jpg quality when saving a bitmap in Python or Rhino script",
  "question": "I am able to save a bitmap as a jpg using the script from SampleViewCaptureToFile.py. I’d like to be able to set the jpg quality. I tried the following, but that doesn’t work and I can’t get very far figuring out why.\n\n\n\n\nimport System\nimport Rhino\nimport scriptcontext as sc\nimport sys\n\nview = sc.doc.Views.ActiveView\nif view:\n    view_capture = Rhino.Display.ViewCapture()\n    view_capture.Width = view.ActiveViewport.Size.Width\n    view_capture.Height = view.ActiveViewport.Size.Height\n    view_capture.ScaleScreenItems = False\n    view_capture.DrawAxes = False\n    view_capture.DrawGrid = False\n    view_capture.DrawGridAxes = False\n    view_capture.TransparentBackground = False\n    bitmap = view_capture.CaptureToBitmap(view)\n    if bitmap:\n        jpg_encoder = System.Drawing.Imaging.Encoder()\n        encoder_quality = System.Drawing.Imaging.Encoder.Quality()\n        encoder_params = System.Drawing.Imaging.EncoderParameters[0]\n        encoder_param = System.Drawing.Imaging.EncoderParameter(encoder_quality, 10)\n        encoder_params.Param[0] = encoder_param\n        bitmap.Save(filename, System.Drawing.Imaging.ImageFormat.Jpg, encoder_params)",
  "code_blocks": [
    {
      "code": "import System\nimport Rhino\nimport scriptcontext as sc\n\ndef _get_image_codec_info(image_format):\n    codecs = System.Drawing.Imaging.ImageCodecInfo.GetImageDecoders()\n    for codec in codecs:\n        if (codec.FormatID == image_format.Guid):\n            return codec\n    return None\n\ndef _save_jpeg_quality(bitmap, path):\n    # Get an image code\n    image_codec_info = _get_image_codec_info(System.Drawing.Imaging.ImageFormat.Jpeg)\n    \n    # Create an Encoder object based on Quality\n    encoder = System.Drawing.Imaging.Encoder.Quality\n    \n    # Create an EncoderParameters object.\n    # An EncoderParameters object has an array of EncoderParameter objects. \n    # In this case, there is only one EncoderParameter object in the array.\n    encoder_params = System.Drawing.Imaging.EncoderParameters(1)\n    \n    encoder_param = System.Drawing.Imaging.EncoderParameter(encoder, 50)\n    encoder_params.Param[0] = encoder_param\n    filename = System.IO.Path.Combine(path, \"test_quality_fifty.jpg\");\n    bitmap.Save(filename, image_codec_info, encoder_params)\n    \n    encoder_param = System.Drawing.Imaging.EncoderParameter(encoder, 100)\n    encoder_params.Param[0] = encoder_param;\n    filename = System.IO.Path.Combine(path, \"test_quality_hundred.jpg\");\n    bitmap.Save(filename, image_codec_info, encoder_params)\n    \n    # Save the bitmap as a JPG file with zero quality level compression\n    encoder_param = System.Drawing.Imaging.EncoderParameter(encoder, 0)\n    encoder_params.Param[0] = encoder_param;\n    filename = System.IO.Path.Combine(path, \"test_quality_zero.jpg\");\n    bitmap.Save(filename, image_codec_info, encoder_params)\n\ndef test_view_capture():\n    view = sc.doc.Views.ActiveView\n    if not view:\n        return\n        \n    view_capture = Rhino.Display.ViewCapture()\n    view_capture.Width = view.ActiveViewport.Size.Width\n    view_capture.Height = view.ActiveViewport.Size.Height\n    view_capture.ScaleScreenItems = False\n    view_capture.DrawAxes = False\n    view_capture.DrawGrid = False\n    view_capture.DrawGridAxes = False\n    view_capture.TransparentBackground = False\n        \n    bitmap = view_capture.CaptureToBitmap(view)\n    if not bitmap:\n        return\n        \n    path = System.Environment.GetFolderPath(System.Environment.SpecialFolder.Desktop)\n    _save_jpeg_quality(bitmap, path)\n\nif __name__ == \"__main__\":\n    test_view_capture()",
      "language": "python",
      "author": "dale",
      "post_number": 2,
      "is_solution": true
    },
    {
      "code": "import System\nimport Rhino\nimport scriptcontext as sc\nimport sys\n\nview = sc.doc.Views.ActiveView\nif view:\n    view_capture = Rhino.Display.ViewCapture()\n    view_capture.Width = view.ActiveViewport.Size.Width\n    view_capture.Height = view.ActiveViewport.Size.Height\n    view_capture.ScaleScreenItems = False\n    view_capture.DrawAxes = False\n    view_capture.DrawGrid = False\n    view_capture.DrawGridAxes = False\n    view_capture.TransparentBackground = False\n    bitmap = view_capture.CaptureToBitmap(view)\n    if bitmap:\n        jpg_encoder = System.Drawing.Imaging.Encoder()\n        encoder_quality = System.Drawing.Imaging.Encoder.Quality()\n        encoder_params = System.Drawing.Imaging.EncoderParameters[0]\n        encoder_param = System.Drawing.Imaging.EncoderParameter(encoder_quality, 10)\n        encoder_params.Param[0] = encoder_param\n        bitmap.Save(filename, System.Drawing.Imaging.ImageFormat.Jpg, encoder_params)",
      "language": "python",
      "author": "mitch1",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "python",
    "transformation"
  ],
  "has_accepted_answer": true,
  "category_id": 3,
  "posts_count": 2,
  "views": 701
}