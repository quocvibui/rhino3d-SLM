{
  "source_url": "https://github.com/a01110946/timber_framing_generator/blob/0b689e23c0ee24a9cfbdf280b219f659a54afd43/src/timber_framing_generator/wall_data/revit_walls.py",
  "repo": "a01110946/timber_framing_generator",
  "repo_stars": 3,
  "repo_description": "A Python tool bridging Revit and Rhino through Rhino.Inside.Revit to automate timber frame design. Processes Revit walls to generate complete framing solutions including studs, plates, headers, and cripples. Features intelligent wall decomposition, opening analysis, and automated documentation generation.",
  "license": "unknown",
  "filepath": "src/timber_framing_generator/wall_data/revit_walls.py",
  "instruction": "Revit walls",
  "code": "import sys\nimport System\nimport Rhino   # type: ignore\nimport Rhino.Geometry as rg  # type: ignore\nfrom typing import List, Dict, Union, Optional\n\n# Revit API imports\nimport clr\n\nclr.AddReference(\"RevitAPI\")\nclr.AddReference(\"RevitAPIUI\")\nfrom Autodesk.Revit.DB import (\n    Wall,\n    XYZ,\n    BuiltInParameter,\n    BuiltInCategory,\n    ElementId,\n    FilteredElementCollector,\n    FamilyInstance,\n    Document,\n)\nimport Autodesk.Revit.DB as DB\nfrom Autodesk.Revit.UI import UIApplication\nimport rhinoscriptsyntax as rs  # type: ignore\n\n# Import your modules\nfrom src.timber_framing_generator.wall_data import wall_input\nfrom src.timber_framing_generator.cell_decomposition import cell_segmentation\n\n# --- Helper Functions for Revit API Data Extraction ---\n\n\ndef get_wall_base_curve(wall: DB.Wall) -> rg.Curve:\n    \"\"\"Gets the base curve of a Revit wall as a Rhino curve.\"\"\"\n    location_curve = DB.LocationCurve\n    curve = location_curve.Curve\n\n    # Convert the Revit API curve to a Rhino NurbsCurve\n    rhino_curve = curve.ToNurbsCurve()\n\n    # Add the NurbsCurve to the Rhino document\n    rhino_object = Rhino.RhinoDoc.ActiveDoc.Objects.AddCurve(rhino_curve)\n\n    # Cast the Rhino object to a Rhino curve if needed\n    if rhino_object:\n        rhino_curve = rs.coercecurve(rhino_object)\n\n    return rhino_curve\n\n\n'''\ndef get_wall_base_elevation(wall: DB.Wall) -> float:\n    \"\"\"Gets the base elevation of a Revit wall.\"\"\"\n    base_level_id = wall.get_Parameter(BuiltInParameter.WALL_BASE_CONSTRAINT).AsElementId()\n    base_level = doc.GetElement(base_level_id)\n    return base_level.Elevation\n\ndef get_wall_top_elevation(wall: DB.Wall) -> float:\n    \"\"\"Gets the top elevation of a Revit wall.\"\"\"\n    top_level_id = wall.get_Parameter(BuiltInParameter.WALL_HEIGHT_TYPE).AsElementId()\n    top_level = doc.GetElement(top_level_id)\n    return top_level.Elevation\n\ndef get_wall_function(wall: DB.Wall) -> str:\n    \"\"\"Gets the function of a Revit wall (e.g., 'Exterior', 'Interior').\"\"\"\n    return wall.WallType.Function.ToString() # Returns \"Exterior\" or \"Interior\"\n\ndef get_wall_openings(wall: DB.Wall) -> List[DB.FamilyInstance]:\n    \"\"\"Gets the openings (doors and windows) associated with a Revit wall.\"\"\"\n    opening_ids = wall.FindInserts(True, False, False, False)\n    openings = [doc.GetElement(id) for id in opening_ids if doc.GetElement(id) is not None]\n    return openings\n\ndef get_opening_data(\n    opening: DB.FamilyInstance, \n    wall_base_elevation: float\n) -> Dict[str, Union[str, float]]:\n    \"\"\"\n    Extracts data for a single opening (door or window).\n\n    Args:\n        opening (DB.FamilyInstance): The Revit FamilyInstance representing \n            the opening.\n        wall_base_elevation (float): The base elevation of the wall the opening \n            is in.\n\n    Returns:\n        Dict[str, Union[str, float]]: A dictionary containing the opening data.\n    \"\"\"\n    # Determine if it's a door or window\n    if opening.Category.Id == ElementId(BuiltInCategory.OST_Doors):\n        opening_type = \"door\"\n    elif opening.Category.Id == ElementId(BuiltInCategory.OST_Windows):\n        opening_type = \"window\"\n    else:\n        opening_type = \"unknown\"  # Handle cases where it's not a door or window\n\n    # Get location point - for simplicity, use insertion point\n    location = opening.Location.Point\n    \n    # Get the wall's base curve to calculate the U coordinate\n    host_wall = opening.Host\n    wall_location_curve = host_wall.Location as DB.LocationCurve\n    wall_curve = wall_location_curve.Curve\n\n    # Project location point onto wall curve to get U coordinate\n    param = wall_curve.ClosestPoint(location, True)  # True to extend curve\n    start_point = wall_curve.Evaluate(0, True)  # Get start point\n    # Approximate U coordinate along the wall\n    u_coordinate = location.DistanceTo(start_point)  \n\n    # Get opening dimensions\n    rough_width = opening.Symbol.get_Parameter(\n        BuiltInParameter.FAMILY_ROUGH_WIDTH_PARAM\n    ).AsDouble()\n    rough_height = opening.Symbol.get_Parameter(\n        BuiltInParameter.FAMILY_ROUGH_HEIGHT_PARAM\n    ).AsDouble()\n\n    # Calculate base elevation relative to wall base\n    sill_height = opening.get_Parameter(\n        BuiltInParameter.INSTANCE_SILL_HEIGHT_PARAM\n    ).AsDouble()\n    base_elevation_relative_to_wall_base = sill_height\n\n    return {\n        \"opening_type\": opening_type,\n        \"start_u_coordinate\": u_coordinate,\n        \"rough_width\": rough_width,\n        \"rough_height\": rough_height,\n        \"base_elevation_relative_to_wall_base\": base_elevation_relative_to_wall_base\n    }\n'''\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}