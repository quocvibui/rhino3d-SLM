{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/lib/EnneadTab/RHINO/RHINO_OBJ_DATA.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/lib/EnneadTab/RHINO/RHINO_OBJ_DATA.py",
  "instruction": "Rhino obj data",
  "code": "#!/usr/bin/python\r\n# -*- coding: utf-8 -*-\r\nimport os\r\nimport sys\r\nroot_folder = os.path.abspath((os.path.dirname(os.path.dirname(os.path.abspath(__file__)))))\r\nsys.path.append(root_folder)\r\nimport ENVIRONMENT\r\n\r\n\r\nif ENVIRONMENT.IS_RHINO_ENVIRONMENT:\r\n    import rhinoscriptsyntax as rs\r\n    import scriptcontext as sc\r\n    import Rhino # type: ignore\r\n\r\n\r\ndef sort_pts_by_Z(pts):\r\n    \"\"\"Sort points by their Z coordinate in ascending order.\r\n\r\n    Parameters\r\n    ----------\r\n    pts : list\r\n        List of Rhino.Geometry.Point3d objects to sort\r\n\r\n    Returns\r\n    -------\r\n    list\r\n        Points sorted by ascending Z coordinate value\r\n    \"\"\"\r\n    pts = sorted(pts, key=lambda x: x.Z)\r\n    return pts\r\n\r\ndef sort_pts_along_crv(pts, crv):\r\n    \"\"\"Sort points by their parameter values along a curve.\r\n\r\n    Parameters\r\n    ----------\r\n    pts : list\r\n        List of Rhino.Geometry.Point3d objects to sort\r\n    crv : Rhino.Geometry.Curve\r\n        Reference curve to sort points along\r\n\r\n    Returns\r\n    -------\r\n    list\r\n        Points sorted by ascending parameter value along the curve\r\n    \"\"\"\r\n    pts = sorted(pts, key=lambda x: rs.CurveClosestPoint(crv, x))\r\n    return pts\r\n\r\ndef sort_AB_along_crv(pt0, pt1, crv):\r\n    \"\"\"Sort two points along a curve in ascending parameter order.\r\n\r\n    Parameters\r\n    ----------\r\n    pt0 : Rhino.Geometry.Point3d\r\n        First point to sort\r\n    pt1 : Rhino.Geometry.Point3d\r\n        Second point to sort\r\n    crv : Rhino.Geometry.Curve\r\n        Reference curve to sort points along\r\n\r\n    Returns\r\n    -------\r\n    tuple\r\n        (pt0, pt1) sorted so that pt0's parameter value is less than pt1's.\r\n        For closed curves, points are sorted to minimize the parameter distance\r\n        between them across the seam.\r\n\r\n    Notes\r\n    -----\r\n    - Uses normalized curve parameters for comparison\r\n    - Handles both open and closed curves\r\n    - For closed curves, checks if sorting across the seam gives shorter parameter distance\r\n    \"\"\"\r\n    t0 = rs.CurveClosestPoint(crv,pt0)\r\n    t1 = rs.CurveClosestPoint(crv,pt1)\r\n    t0 = rs.CurveNormalizedParameter(crv, t0)\r\n    t1 = rs.CurveNormalizedParameter(crv, t1)\r\n\r\n\r\n    if t1 < t0:\r\n        t0, t1 = t1, t0\r\n        pt0, pt1 = pt1, pt0\r\n\r\n    if not rs.IsCurveClosed(crv):\r\n        return pt0, pt1\r\n\r\n    if abs(t1 - t0) > abs(t0) + abs(1-t1):\r\n        pt0, pt1 = pt1, pt0\r\n\r\n    return pt0, pt1\r\n\r\n\r\n\r\ndef get_center(obj):\r\n    \"\"\"Get the center point of an object's bounding box.\r\n\r\n    Parameters\r\n    ----------\r\n    obj : Guid\r\n        Object ID to calculate center for\r\n\r\n    Returns\r\n    -------\r\n    Rhino.Geometry.Point3d or None\r\n        Center point of the object's bounding box, or None if object is invalid\r\n    \"\"\"\r\n    try:\r\n        # Check if object exists and is valid\r\n        if not rs.IsObject(obj):\r\n            print(\"Warning: Object {} is not valid\".format(obj))\r\n            return None\r\n            \r\n        corners = rs.BoundingBox(obj)\r\n        if not corners or len(corners) < 7:\r\n            print(\"Warning: Could not get bounding box for object {}\".format(obj))\r\n            return None\r\n            \r\n        min = corners[0]\r\n        max = corners[6]\r\n        center = (min + max)/2\r\n        return center\r\n        \r\n    except Exception as e:\r\n        try:\r\n            corners = rs.BoundingBox(obj)\r\n            min = corners[0]\r\n            max = corners[6]\r\n            center = (min + max)/2\r\n            return center\r\n        except Exception as e:\r\n            print(\"Error getting center for object {}: {}\".format(obj, str(e)))\r\n            return None\r\n\r\ndef get_obj_h(obj):\r\n    \"\"\"Get the height (Z dimension) of an object's bounding box.\r\n\r\n    Parameters\r\n    ----------\r\n    obj : Guid\r\n        Object ID to calculate height for\r\n\r\n    Returns\r\n    -------\r\n    float or None\r\n        Height of the object's bounding box, or None if object is invalid\r\n    \"\"\"\r\n    try:\r\n        # Check if object exists and is valid\r\n        if not rs.IsObject(obj):\r\n            print(\"Warning: Object {} is not valid\".format(obj))\r\n            return None\r\n            \r\n        corners = rs.BoundingBox(obj)\r\n        if not corners or len(corners) < 7:\r\n            print(\"Warning: Could not get bounding box for object {}\".format(obj))\r\n            return None\r\n            \r\n        min = corners[0]\r\n        max = corners[6]\r\n        z_diff = (max.Z - min.Z)\r\n        return z_diff\r\n        \r\n    except Exception as e:\r\n        print(\"Error getting height for object {}: {}\".format(obj, str(e)))\r\n        return None\r\n\r\ndef get_boundingbox_edge_length(obj):\r\n    \"\"\"Get the lengths of bounding box edges in X, Y, and Z directions.\r\n\r\n    Parameters\r\n    ----------\r\n    obj : Guid\r\n        Object ID to calculate bounding box dimensions for\r\n\r\n    Returns\r\n    -------\r\n    tuple or None\r\n        (X_length, Y_length, Z_length) of the bounding box edges, or None if object is invalid\r\n    \"\"\"\r\n    try:\r\n        # Check if object exists and is valid\r\n        if not rs.IsObject(obj):\r\n            print(\"Warning: Object {} is not valid\".format(obj))\r\n            return None\r\n            \r\n        corners = rs.BoundingBox(obj)\r\n        if not corners or len(corners) < 7:\r\n            print(\"Warning: Could not get bounding box for object {}\".format(obj))\r\n            return None\r\n            \r\n        X = rs.Distance(corners[0], corners[1])\r\n        Y = rs.Distance(corners[1], corners[2])\r\n        Z = rs.Distance(corners[0], corners[5])\r\n        return X, Y, Z\r\n        \r\n    except Exception as e:\r\n        print(\"Error getting bounding box edge length for object {}: {}\".format(obj, str(e)))\r\n        return None\r\n\r\n\r\ndef get_obj_min_center_pt(obj):\r\n    \"\"\"Get the center point of the minimum face of an object's bounding box.\r\n\r\n    Parameters\r\n    ----------\r\n    obj : Guid\r\n        Object ID to calculate minimum face center for\r\n\r\n    Returns\r\n    -------\r\n    Rhino.Geometry.Point3d or None\r\n        Center point of the minimum (bottom) face of the bounding box, or None if object is invalid\r\n    \"\"\"\r\n    try:\r\n        # Check if object exists and is valid\r\n        if not rs.IsObject(obj):\r\n            print(\"Warning: Object {} is not valid\".format(obj))\r\n            return None\r\n            \r\n        pts = rs.BoundingBox(obj)\r\n        if not pts or len(pts) < 3:\r\n            print(\"Warning: Could not get bounding box for object {}\".format(obj))\r\n            return None\r\n            \r\n        pt0 = pts[0]\r\n        pt1 = pts[2]\r\n        return (pt0 + pt1)/2\r\n        \r\n    except Exception as e:\r\n        print(\"Error getting minimum center point for object {}: {}\".format(obj, str(e)))\r\n        return None\r\n\r\n\r\ndef get_instance_geo(block_instance):\r\n    \"\"\"Get all geometry objects from a block instance, including nested instances.\r\n\r\n    Parameters\r\n    ----------\r\n    block_instance : Guid\r\n        Block instance ID to extract geometry from\r\n\r\n    Returns\r\n    -------\r\n    list\r\n        All geometry objects contained in the block instance, transformed to \r\n        world coordinates\r\n\r\n    Notes\r\n    -----\r\n    - Recursively processes nested block instances\r\n    - Applies block instance transformation to all geometry\r\n    - Returns actual geometry objects, not references\r\n    \"\"\"\r\n    try:\r\n        # Check if document is available\r\n        if not sc.doc:\r\n            print(\"Warning: No active document found\")\r\n            return []\r\n            \r\n        block_name = rs.BlockInstanceName(block_instance)\r\n        non_block_objs, block_instance_objs = [], []\r\n\r\n        for x in rs.BlockObjects(block_name):\r\n            (block_instance_objs if rs.IsBlockInstance(x) else non_block_objs).append(x)\r\n            \r\n        non_block_geos = []\r\n        for x in non_block_objs:\r\n            try:\r\n                obj = sc.doc.Objects.Find(x)\r\n                if obj and obj.Geometry:\r\n                    non_block_geos.append(obj.Geometry)\r\n            except Exception as e:\r\n                print(\"Warning: Could not get geometry for object {}: {}\".format(x, str(e)))\r\n                continue\r\n                \r\n        block_geos = []\r\n        for x in block_instance_objs:\r\n            try:\r\n                block_geos.extend(get_instance_geo(x))\r\n            except Exception as e:\r\n                print(\"Warning: Could not process nested block instance {}: {}\".format(x, str(e)))\r\n                continue\r\n                \r\n        geo_contents = non_block_geos + block_geos\r\n        \r\n        transform = rs.BlockInstanceXform(block_instance)\r\n        [x.Transform(transform) for x in geo_contents]\r\n        return geo_contents\r\n        \r\n    except Exception as e:\r\n        print(\"Error getting instance geometry for block {}: {}\".format(block_instance, str(e)))\r\n        return []\r\n\r\n\r\ndef geo_to_obj(geo, name = None):\r\n    \"\"\"Convert a Rhino geometry object to a native Rhino object.\r\n\r\n    Parameters\r\n    ----------\r\n    geo : Rhino.Geometry.GeometryBase\r\n        The geometry object to convert\r\n\r\n    Returns\r\n    -------\r\n    Rhino.Geometry.GeometryBase or None\r\n        The converted geometry object, or None if conversion fails\r\n    \"\"\"\r\n    try:\r\n        # Get the active document\r\n        doc = Rhino.RhinoDoc.ActiveDoc\r\n        if not doc:\r\n            print(\"Warning: No active Rhino document found\")\r\n            return None\r\n            \r\n        if isinstance(geo, Rhino.Geometry.Point3d):\r\n            out_obj = doc.Objects.AddPoint(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Curve):\r\n            out_obj = doc.Objects.AddCurve(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Brep):\r\n            out_obj = doc.Objects.AddBrep(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Mesh):\r\n            out_obj = doc.Objects.AddMesh(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Surface):\r\n            out_obj = doc.Objects.AddSurface(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Hatch):\r\n            out_obj = doc.Objects.AddHatch(geo)\r\n        elif isinstance(geo, Rhino.Geometry.Text):\r\n            out_obj = doc.Objects.AddText(geo)\r\n        elif isinstance(geo, Rhino.Geometry.TextDot):\r\n            out_obj = doc.Objects.AddTextDot(geo)\r\n        else:\r\n            print(\"Unsupported geometry type: {}\".format(type(geo)))\r\n            return None\r\n\r\n        if name and out_obj:\r\n            out_obj.Attributes.Name = name\r\n            out_obj.CommitChanges()\r\n        return out_obj\r\n        \r\n    except Exception as e:\r\n        print(\"Error converting geometry to object: {}\".format(str(e)))\r\n        return None",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}