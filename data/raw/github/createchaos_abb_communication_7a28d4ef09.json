{
  "source_url": "https://github.com/createchaos/abb_communication/blob/740ea3c6bf93b9b0d03e63a6d56ee8ad748e4e38/src/abb_communication/clients_withRN/rfl_robot/tool.py",
  "repo": "createchaos/abb_communication",
  "repo_stars": 3,
  "repo_description": "communication library for abb robot control",
  "license": "NOASSERTION",
  "filepath": "src/abb_communication/clients_withRN/rfl_robot/tool.py",
  "instruction": ". . . . . . . . . . . . . . . . . . . . . . \r\n.                                         .\r\n.   <<  <<><><>  <<      ><  <<      ><   .\r\n.   <<  <<       < ><   ><<  < ><   ><<   .\r\n.   <<  <<><><> ...",
  "code": "'''\r\n. . . . . . . . . . . . . . . . . . . . . . \r\n.                                         .\r\n.   <<  <<><><>  <<      ><  <<      ><   .\r\n.   <<  <<       < ><   ><<  < ><   ><<   .\r\n.   <<  <<><><>  << >< > ><  << >< > ><   .  \r\n.   <<  <<       <<  ><  ><  <<  ><  ><   .\r\n.   <<  <<       <<      ><  <<      ><   .\r\n.   <<  <<       <<      ><  <<      ><   .\r\n.                                         .\r\n.             GKR 2016/17                 .\r\n. . . . . . . . . . . . . . . . . . . . . .\r\n\r\nCreated on 02.11.2016\r\n\r\n@author: kathrind, stefanap\r\n'''\r\n\r\n\r\nfrom abb_communication.geometry import Frame\r\nimport ghpythonlib.components as ghcomp\r\nimport Rhino.Geometry as rg\r\nimport math as m\r\n\r\nclass Tool(object):\r\n    \r\n    #===========================================================================\r\n    def __init__(self, geo, tool_plane):\r\n        ''' tool class for the robot \r\n        geo = tool geometry as list\r\n        plane = defined tool plane\r\n        geo_trfd = tool geometry transformed that the defined tool plane is aligned with the world xy plane\r\n        '''\r\n        \r\n        self.geo = geo\r\n        self.plane = tool_plane\r\n        self.frame = Frame(self.plane, draw_geo=True)\r\n        \r\n        self.T = rg.Transform.PlaneToPlane(self.plane, rg.Plane.WorldXY)\r\n        self.geo_WCS = ghcomp.Transform(self.geo, self.T) # tool aligned_with_WCS\r\n        \r\n        self.plane_WCS = ghcomp.Transform(self.plane, self.T) # should be WorldXY plane\r\n\r\n        self.collision_geo = self.geo\r\n        self.colors = [ghcomp.ColourRGB(100, 100, 150, 200)\r\n                       for i, part in enumerate(self.geo)]\r\n    \r\n    #===========================================================================\r\n    def set_collision_geo(self, collision_geo):\r\n        \"\"\" collision geo of the LWS tool\"\"\"\r\n        self.collison_geo = collision_geo\r\n        self.collison_geo_WCS = ghcomp.Transform(self.collison_geo, self.T)\r\n    \r\n    #===========================================================================\r\n    def get_plane(self):\r\n        ''' returns the tool plane '''\r\n        return rg.Plane(self.plane)\r\n    \r\n    #===========================================================================\r\n    def get_frame(self):\r\n        ''' returns the tool frame '''\r\n        return Frame(self.get_plane())\r\n        \r\n    #===========================================================================\r\n    def get_frame_axes_as_lines(self):\r\n        ''' this method allows you to visualize the tool axes as lines and gh colors '''\r\n        \r\n        tool_axes = self.frame.get_axes_as_lines(length=100)\r\n        tool_axes_colors = [ghcomp.ColourRGB(255, 255, 0, 0), ghcomp.ColourRGB(255, 0, 255, 0), ghcomp.ColourRGB(255, 0, 0, 255)]\r\n\r\n        return tool_axes, tool_axes_colors\r\n    \r\n    #===========================================================================\r\n    def get_frame_axes_as_lines_WCS(self):\r\n        ''' this method allows you to visualize the tool axes as lines and gh colors transformed into the WCS'''\r\n        \r\n        tool_axes, tool_axes_colors = self.get_frame_axes_as_lines()\r\n        tool_axes = ghcomp.Transform(tool_axes, self.T) # aligned_with_WCS\r\n        \r\n        return tool_axes, tool_axes_colors\r\n    \r\n    #===========================================================================\r\n    def get_pose_angle_axis(self):\r\n        ''' returns the pose with the axis angle representation '''\r\n        \r\n        return self.frame.get_pose_angle_axis()\r\n    \r\n    #===========================================================================\r\n    def get_transformed_geo(self, T):\r\n        ''' returns the tool geo transformed by the input transformation matrix '''\r\n        \r\n        return ghcomp.Transform(self.geo, T)\r\n    \r\n    #===========================================================================\r\n    def get_transformed_plane(self, T):\r\n        ''' returns the tool plane transformed by the input transformation matrix '''\r\n        \r\n        return ghcomp.Transform(self.plane, T)\r\n    \r\n    #===========================================================================\r\n    def get_transformed_geo_WCS(self, T):\r\n        ''' returns the tool geo_trfd transformed by the input transformation matrix '''\r\n        \r\n        return ghcomp.Transform(self.geo_WCS, T)\r\n    #===========================================================================\r\n    \r\n\r\nclass MeshMouldTool(Tool):\r\n    \r\n    def __init__(self, geo, tool_plane, cam_plane):\r\n        \r\n        Tool.__init__(self, geo, tool_plane)\r\n        \r\n        self.p1_fixed, self.p2_rotfront, self.p3_rotback_frame, self.p3_rotback_gripper_ret, self.p3_rotback_gripper_ext, self.collision_geo = self.geo\r\n        #self.p1_fixed_wcs, self.p2_rotfront_wcs, self.p3_rotback_frame_wcs, self.p3_rotback_gripper_ret_wcs, self.p3_rotback_gripper_ext_wcs, self.collision_geo_wcs = self.geo_WCS\r\n        \r\n        self.cam_plane = cam_plane\r\n\r\n        self.colors = [ghcomp.ColourRGB(100, 100, 100 + i*20, 150 + i*20) for i, part in enumerate(self.geo)]\r\n        self.colors[-1] = ghcomp.ColourRGB(100, 255, 80, 110)\r\n\r\n\r\n    def set_collision_geo(self, collision_geo):\r\n        \"\"\" collision geo of the Meshmould tool\"\"\"\r\n        self.collison_geo = collision_geo        \r\n        self.collison_geo_WCS = ghcomp.Transform(self.collison_geo, self.T)\r\n    \r\n    def get_cam_plane_with_tool_rot_WCS(self, rot_value_back):\r\n        \r\n        cam_plane_WCS = ghcomp.Transform(self.cam_plane, self.T)\r\n        T_rot_back = rg.Transform.Rotation(m.radians(rot_value_back), self.plane_WCS.ZAxis, self.plane_WCS.Origin)\r\n        cam_plane_WCS = ghcomp.Transform(cam_plane_WCS, T_rot_back)\r\n        \r\n        return cam_plane_WCS  \r\n        \r\n    def apply_tool_transformation_WCS(self, rot_value_front, rot_value_back, extended = False):\r\n        \"\"\" for transforming the tool which is aligned to the tool plane \"\"\"\r\n        \r\n        geo = self.apply_tool_transformation(rot_value_front, rot_value_back, extended = extended)\r\n        geo_WCS = ghcomp.Transform(geo, self.T) # tool aligned_with_WCS\r\n        \r\n        return geo_WCS\r\n    \r\n    def apply_coll_geo_transformation_WCS(self, rot_value_back):\r\n        \"\"\" for transforming the collgeo which is aligned to the tool plane \"\"\"       \r\n        coll_geo = self.apply_coll_geo_transformation(rot_value_back)\r\n        coll_geo_WCS = ghcomp.Transform(coll_geo, self.T) # tool aligned_with_WCS  \r\n        return coll_geo_WCS\r\n    \r\n    def get_transformed_coll_geo_with_tool_transformation_WCS(self, T, rot_value_back):\r\n        \r\n        coll_geo_WCS = self.apply_coll_geo_transformation_WCS(rot_value_back)\r\n        return ghcomp.Transform(coll_geo_WCS, T)\r\n    \r\n    def get_transformed_geo_with_tool_transformation_WCS(self, T, rot_value_front, rot_value_back, extended = False):\r\n        \r\n        geo_WCS = self.apply_tool_transformation_WCS(rot_value_front, rot_value_back, extended = extended)\r\n        return ghcomp.Transform(geo_WCS, T)\r\n    \r\n    def get_transformed_geo_with_tool_transformation(self, T, rot_value_front, rot_value_back, extended = False):\r\n        \r\n        geo = self.apply_tool_transformation(rot_value_front, rot_value_back, extended = extended)\r\n        return ghcomp.Transform(geo, T) \r\n    \r\n    def get_transformed_plane_gripper(self, T, rot_value_front, rot_value_back, plane_gripper, extended = False):\r\n        ''' intermediary function to check the cable routing for the welder... '''\r\n        \r\n        trot_plane = rg.Plane(self.plane)\r\n        T_rot_back = rg.Transform.Rotation(m.radians(rot_value_back), trot_plane.ZAxis, trot_plane.Origin)\r\n        \r\n        plane_gripper = ghcomp.Transform(plane_gripper, T_rot_back)\r\n        if extended == True:            \r\n            return ghcomp.Transform(plane_gripper, T) \r\n        else:\r\n            # maybe add a translation\r\n            return ghcomp.Transform(plane_gripper, T) \r\n    \r\n    def apply_coll_geo_transformation(self, rot_value_back):\r\n        \"\"\" for transforming the collision geo which is in zero \"\"\"\r\n        \r\n        trot_plane = rg.Plane(self.plane)        \r\n        T_rot_back = rg.Transform.Rotation(m.radians(rot_value_back), trot_plane.ZAxis, trot_plane.Origin)\r\n        collision_geo_trfd = ghcomp.Transform(self.collision_geo, T_rot_back)\r\n\r\n        return collision_geo_trfd\r\n        \r\n    def apply_tool_transformation(self, rot_value_front, rot_value_back, extended = False):\r\n        \"\"\" for transforming the tool which is in zero \"\"\"\r\n        \r\n        #self.p1_fixed, self.p2_rotfront, self.p3_rotback_frame, self.p3_rotback_gripper_ret, self.p3_rotback_gripper_ext, self.collision_geo = self.geo\r\n\r\n        trot_plane = rg.Plane(self.plane)\r\n        T_rot_front = rg.Transform.Rotation(m.radians(rot_value_front), trot_plane.ZAxis, trot_plane.Origin)\r\n        \r\n        p2_rotfront_trfd = ghcomp.Transform(self.p2_rotfront, T_rot_front)\r\n        \r\n        T_rot_back = rg.Transform.Rotation(m.radians(rot_value_back), trot_plane.ZAxis, trot_plane.Origin)\r\n        \r\n        p3_rotback_frame_trfd = ghcomp.Transform(self.p3_rotback_frame, T_rot_back)\r\n        p3_rotback_gripper_ret_trfd = ghcomp.Transform(self.p3_rotback_gripper_ret, T_rot_back)\r\n        p3_rotback_gripper_ext_trfd = ghcomp.Transform(self.p3_rotback_gripper_ext, T_rot_back)\r\n        collision_geo_trfd = ghcomp.Transform(self.collision_geo, T_rot_back)\r\n\r\n        if extended == True:\r\n            return [self.p1_fixed, p2_rotfront_trfd, p3_rotback_frame_trfd, p3_rotback_gripper_ext_trfd, collision_geo_trfd]\r\n        else:\r\n            return [self.p1_fixed, p2_rotfront_trfd, p3_rotback_frame_trfd, p3_rotback_gripper_ret_trfd, collision_geo_trfd]\r\n        \r\n        \r\n\r\nclass LwsGripperTool(Tool):\r\n    \r\n    def __init__(self, geo, tool_plane):\r\n        \r\n        Tool.__init__(self, geo, tool_plane)\r\n        \r\n        self.collision_geo = self.geo\r\n        self.colors = [ghcomp.ColourRGB(100, 100, 150, 200) for i, part in enumerate(self.geo)]\r\n\r\n    def set_collision_geo(self, collision_geo):\r\n        \"\"\" collision geo of the LWS tool\"\"\"\r\n        self.collison_geo = collision_geo        \r\n        self.collison_geo_WCS = ghcomp.Transform(self.collison_geo, self.T)\r\n    \r\n\r\nclass RthGripperTool(Tool):\r\n    \r\n    def __init__(self, geo, tool_plane):\r\n        \r\n        Tool.__init__(self, geo, tool_plane)\r\n        \r\n        self.collision_geo = self.geo\r\n        self.colors = [ghcomp.ColourRGB(100, 100, 150, 200) for i, part in enumerate(self.geo)]\r\n\r\n    def set_collision_geo(self, collision_geo):\r\n        \"\"\" collision geo of the RTH tool\"\"\"\r\n        self.collison_geo = collision_geo        \r\n        self.collison_geo_WCS = ghcomp.Transform(self.collison_geo, self.T)\r\n      \r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib"
  ],
  "has_docstring": true
}