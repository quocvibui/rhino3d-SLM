{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/spb_Layer_merge.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "spb_Layer_merge.py",
  "instruction": "190925: Created.",
  "code": "\"\"\"\r\n190925: Created.\r\n\"\"\"\r\n\r\nimport Rhino\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\n\r\ndef getLayersToDelete(bEcho=True):\r\n    \"\"\"\r\n    \"\"\"\r\n    \r\n    layers_ToDel_Picked = rs.GetLayers(\r\n            \"Select layers from which to transfer objects\" \\\r\n            \" (Reference layers will be ignored.)\")\r\n    if not layers_ToDel_Picked: return\r\n    \r\n    layers_ToDel_Picked_NoRefs = []\r\n    for layer in layers_ToDel_Picked:\r\n        if not rs.IsLayerReference(layer):\r\n            layers_ToDel_Picked_NoRefs.append(layer)\r\n    \r\n    def getLayerDescendants(layer_Parent):\r\n        for layer_Child in rs.LayerChildren(layer_Parent):\r\n            layers_Descendant.append(layer_Child)\r\n            getLayerDescendants(layer_Child)\r\n    \r\n    layers_ToDel_WIP = layers_ToDel_Picked_NoRefs[:]\r\n    \r\n    # Add decendant layers if any layers have children.\r\n    for layer in layers_ToDel_Picked_NoRefs:\r\n        if rs.LayerChildCount(layer):\r\n            layers_Descendant = []\r\n            getLayerDescendants(layer)\r\n            \r\n            for layer_Desc in layers_Descendant:\r\n                \r\n                # Remove any layer already in list so that\r\n                # descendants succeed their ancestors.\r\n                if layer_Desc in layers_ToDel_WIP:\r\n                    layers_ToDel_WIP.remove(layer_Desc)\r\n                \r\n                layers_ToDel_WIP.append(layer_Desc)\r\n    \r\n    # Return the layers names to a new list in reverse order;\r\n    # Descendants precede their ancestors.\r\n    return layers_ToDel_WIP[::-1]\r\n\r\n\r\ndef getTargetLayer(layers_ToDel, bEcho=True):\r\n    \"\"\"\r\n    \"\"\"\r\n    \r\n    layer = None\r\n    while layer is None:\r\n        layer = rs.GetLayer(\r\n                \"Select layer into which to merge \" \\\r\n                \"(Reference layers will be ignored.)\")\r\n        if not layer: return\r\n        \r\n        if rs.IsLayerReference(layer):\r\n            layer = rs.GetLayer(\r\n                    \"Reference layer chosen.  Pick again.\" \\\r\n                    \"Select layer into which to merge \" \\\r\n                    \"(Reference layers will be ignored.)\")\r\n            if not layer: return\r\n        \r\n        if layer in layers_ToDel:\r\n            layer = rs.GetLayer(\r\n                    \"Layer to delete was chosen.  Pick again.  \" \\\r\n                    \"Select layer into which to merge \" \\\r\n                    \"(Reference layers will be ignored.)\")\r\n            if not layer: return\r\n    \r\n    return layer\r\n\r\n\r\ndef getModifiableBlocks():\r\n    blocks_ToEval = []\r\n    for block in rs.BlockNames(sort=True):\r\n        if rs.IsBlockReference(block) or not rs.IsBlockEmbedded(block): continue\r\n        blocks_ToEval.append(block)\r\n    return blocks_ToEval\r\n\r\n\r\ndef setLayers(layers_ToDel, layer_Target, bEcho):\r\n    \"\"\"\r\n    \"\"\"\r\n    \r\n    ctObjsTrans_Pass = 0\r\n    \r\n    for gObj in rs.AllObjects():\r\n        if rs.ObjectLayer(gObj) in layers_ToDel:\r\n            if rs.ObjectLayer(gObj, layer_Target):\r\n                ctObjsTrans_Pass += 1\r\n            else:\r\n                ctObjsTrans_Fail += 1\r\n    \r\n    for block in getModifiableBlocks():\r\n        ctObjsTrans_Fail = 0\r\n        for gObj in rs.BlockObjects(block):\r\n            if rs.ObjectLayer(gObj) in layers_ToDel:\r\n                if rs.ObjectLayer(gObj, layer_Target):\r\n                    ctObjsTrans_Pass += 1\r\n                else:\r\n                    ctObjsTrans_Fail += 1\r\n        if bEcho and ctObjsTrans_Fail:\r\n            print \"Layers for {} objects could not be reassigned in {}.\".format(\r\n                    ctObjsTrans_Fail, block)\r\n    \r\n    if bEcho and ctObjsTrans_Pass:\r\n        print \"{} objects' layers were set to {}.\".format(\r\n                ctObjsTrans_Pass, layer_Target)\r\n    \r\n    return ctObjsTrans_Pass\r\n\r\n\r\ndef deleteLayers(layers_ToDel, bEcho=True):\r\n    \r\n    # Change the current layer if it is slated to be deleted.\r\n    if rs.CurrentLayer() in layers_ToDel:\r\n        for layer in rs.LayerNames(sort=True):\r\n            if layer not in layers_ToDel and not rs.IsLayerReference(layer):\r\n                rs.CurrentLayer(layer)\r\n                break\r\n        else:\r\n            if bEcho:\r\n                print \"No eligible layers are available to be made current.\"\r\n    \r\n    ctLayersDeleted = 0\r\n    for layer in layers_ToDel:\r\n        if rs.DeleteLayer(layer):\r\n            ctLayersDeleted += 1\r\n        else:\r\n            if bEcho: print \"{} was NOT deleted.\".format(layer)\r\n    if bEcho:\r\n        if ctLayersDeleted == len(layers_ToDel):\r\n            print \"All {} layers were deleted.\".format(ctLayersDeleted)\r\n        else:\r\n            print \"{} out of {} layers were deleted.\".format(\r\n                    ctLayersDeleted, len(layers_ToDel))\r\n    \r\n    return ctLayersDeleted\r\n\r\n\r\ndef main():\r\n    \r\n    bEcho = True\r\n    \r\n    layers_ToDel = getLayersToDelete(bEcho)\r\n    if not layers_ToDel: return\r\n    \r\n    layer_Target = getTargetLayer(layers_ToDel, bEcho)\r\n    if not layer_Target: return\r\n    \r\n    rs.EnableRedraw(False)\r\n    \r\n    rc = setLayers(layers_ToDel, layer_Target, bEcho)\r\n    \r\n    rc = deleteLayers(layers_ToDel, bEcho)\r\n    \r\n    rs.EnableRedraw()\r\n\r\n\r\nif __name__ == '__main__': main()",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}