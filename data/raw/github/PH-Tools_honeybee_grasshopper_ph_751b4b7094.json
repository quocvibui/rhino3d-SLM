{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/assmbly_create_wood_framing_material.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/assmbly_create_wood_framing_material.py",
  "instruction": "GHCompo Interface: HBPH - Create Wood Framing Material.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Create Wood Framing Material.\"\"\"\n\ntry:\n    from typing import Any, List, Optional, Sequence, Tuple, Union\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from Rhino.Geometry import Brep  # type: ignore\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import Rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_energy.material import opaque\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_energy:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_utils.color import PhColor\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_utils:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_energy_ph.properties.materials.opaque import EnergyMaterialPhProperties, PhDivisionGrid\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_energy_ph:\\n\\t{}\".format(e))\n\ntry:\n    from ph_units.converter import convert\n    from ph_units.parser import parse_input\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ph_units:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino.gh_compo_io.assmbly_create_heterogeneous_material import generate_preview\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\n\ndef convert_list_of_values(_values, _unit=\"M\"):\n    # type: (Sequence[str | float], str) -> List[float]\n    \"\"\"Convert the Sequence of values to the specified unit.\"\"\"\n    values_ = []\n    for col_width in _values:\n        input_val, input_unit = parse_input(col_width)\n        converted_value = convert(input_val, input_unit or \"M\", _unit)\n        values_.append(converted_value)\n        print(\"Converting {}-{} to {:.3f}-{}\".format(input_val, input_unit or \"M\", converted_value, _unit))\n    return values_\n\n\nclass GHCompo_CreateWoodFramingMaterial(object):\n    \"\"\"GHCompo Interface: HBPH - Create Wood Framing Material.\"\"\"\n\n    def __init__(\n        self,\n        IGH,\n        _insulation_material,\n        _wood_framing_material,\n        _wood_framing_member_width,\n        _wood_framing_member_oc_spacing,\n        _top_plate_width,\n        _bottom_plate_width,\n        _element_total_length,\n    ):\n        # type: (gh_io.IGH, Optional[opaque.EnergyMaterial], Optional[opaque.EnergyMaterial], Optional[str], Optional[str], Optional[str], Optional[str], Optional[str]) -> None\n        self.IGH = IGH\n        self.insulation_material = _insulation_material\n        self.wood_framing_material = _wood_framing_material or self.default_wood_framing_material\n        self.wood_framing_member_width = self._convert(_wood_framing_member_width or \"1.5in\")\n        self.wood_framing_member_oc_spacing = self._convert(_wood_framing_member_oc_spacing or \"16in\")\n        self.top_plate_width = self._convert(_top_plate_width or 0.0)\n        self.bottom_plate_width = self._convert(_bottom_plate_width or 0.0)\n        self.element_total_length = self._convert(_element_total_length or \"8ft\")\n\n    @property\n    def default_wood_framing_material(self):\n        # type: () -> opaque.EnergyMaterial\n        mat_ = opaque.EnergyMaterial(\n            \"Softwood Lumber\",\n            conductivity=0.14,\n            specific_heat=1210,\n            density=545,\n            roughness=\"MediumRough\",\n            thickness=0.1,\n        )\n        hbph_props_ph = getattr(mat_.properties, \"ph\")  # type: EnergyMaterialPhProperties\n        hbph_props_ph.ph_color = PhColor.from_argb(255, 255, 128, 0)\n        return mat_\n\n    def _convert(self, value, to_unit=\"M\"):\n        # type: (Union[float, int, str], str) -> float\n        return convert(*parse_input(value), _target_unit=to_unit) or 0.0\n\n    def check_material_type(self, _material):\n        # type: (opaque.EnergyMaterial) -> opaque.EnergyMaterial | None\n        if not isinstance(_material, opaque.EnergyMaterial):\n            msg = \"ERROR: Material '{}' of type '{}' is not allowed. Use only EnergyMaterial.\".format(\n                _material, type(_material)\n            )\n            print(msg)\n            self.IGH.error(msg)\n            return None\n        else:\n            return _material\n\n    def check_material_conductivity(self, _material):\n        # type: (opaque.EnergyMaterial) -> opaque.EnergyMaterial | None\n        if _material.conductivity > 10.0:\n            msg = (\n                \"ERROR: Material '{}' has a very high conductivity value of {:.2f} W/m-K. \"\n                \"Note that metal elements like steel studs and metal fasteners may NOT be \"\n                \"used as part of heterogeneous assemblies (as per ISO 6946).\".format(\n                    _material.display_name, _material.conductivity\n                )\n            )\n            print(msg)\n            self.IGH.error(msg)\n            return None\n        else:\n            return _material\n\n    def check_material(self, _material):\n        # type: (opaque.EnergyMaterial | None) -> opaque.EnergyMaterial | None\n        if _material is None:\n            return None\n        if not self.check_material_type(_material):\n            return None\n        if not self.check_material_conductivity(_material):\n            return None\n        return _material\n\n    def run(self):\n        # type: () -> Tuple[Optional[opaque.EnergyMaterial], Optional[List[Brep]]]\n        insulation_material = self.check_material(self.insulation_material)\n        if not insulation_material:\n            return (None, None)\n\n        wood_framing_material = self.check_material(self.wood_framing_material)\n        if not wood_framing_material:\n            return (None, None)\n\n        # --------------------------------------------------------------------------------------------------------------\n        # -- Setup the new Division Grid\n        division_grid = PhDivisionGrid()\n        insulation_width = (self.wood_framing_member_oc_spacing - self.wood_framing_member_width) / 2\n        division_grid.set_column_widths(\n            [\n                insulation_width,\n                self.wood_framing_member_width,\n                insulation_width,\n            ]\n        )\n        division_grid.set_row_heights(\n            [\n                self.top_plate_width,\n                self.element_total_length - self.top_plate_width - self.bottom_plate_width,\n                self.bottom_plate_width,\n            ]\n        )\n\n        # --------------------------------------------------------------------------------------------------------------\n        # -- Set the Materials on the cells\n\n        # -- Set the 'stud' to the framing material (column-1)\n        for row_number in range(division_grid.row_count):\n            division_grid.set_cell_material(0, row_number, insulation_material)\n            division_grid.set_cell_material(1, row_number, wood_framing_material)\n            division_grid.set_cell_material(2, row_number, insulation_material)\n\n        # -- Set the top-plate\n        if self.top_plate_width != 0:\n            division_grid.set_cell_material(0, 0, wood_framing_material)\n            division_grid.set_cell_material(1, 0, wood_framing_material)\n            division_grid.set_cell_material(2, 0, wood_framing_material)\n\n        # -- Set the bottom-plate\n        if self.bottom_plate_width != 0:\n            division_grid.set_cell_material(0, division_grid.row_count - 1, wood_framing_material)\n            division_grid.set_cell_material(1, division_grid.row_count - 1, wood_framing_material)\n            division_grid.set_cell_material(2, division_grid.row_count - 1, wood_framing_material)\n\n        # --------------------------------------------------------------------------------------------------------------\n        # -- Create a new Hybrid Material\n        base_material = division_grid.get_base_material()\n        if not base_material:\n            return (None, None)\n        new_material_ = base_material.duplicate()\n        nm = \"{} + {}\".format(insulation_material.display_name, wood_framing_material.display_name)\n        new_material_.display_name = nm\n        new_material_.identifier = nm\n        new_material_.conductivity = division_grid.get_equivalent_conductivity()\n        hbph_props = getattr(new_material_.properties, \"ph\")  # type: EnergyMaterialPhProperties\n        hbph_props.divisions = division_grid\n\n        # --------------------------------------------------------------------------------------------------------------\n        # -- Generate the Preview\n        preview_ = generate_preview(\n            self.IGH,\n            convert_list_of_values(division_grid.column_widths, self.IGH.get_rhino_unit_system_name()),\n            convert_list_of_values(division_grid.row_heights, self.IGH.get_rhino_unit_system_name()),\n        )\n\n        return new_material_, preview_\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}