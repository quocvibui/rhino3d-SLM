{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/platesim.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/platesim.py",
  "instruction": "Display plates according to robot moves.",
  "code": "\"\"\"Display plates according to robot moves.\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport rhinoscriptsyntax as rs\r\nimport Rhino.Geometry as rg\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Plate simulation\", \"Plate simulation\", \"\"\"Display plates according to robot moves.\"\"\", \"Manis\", \"Robotics\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"172b904a-aafc-48d0-b5c4-552a0bf99ed2\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"stack_module\", \"stack_module\", \"The plate module stacked in range of the robotic arm.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"goal_module\", \"goal_module\", \"The plate module to assemble in range of the robotic arm.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Plane()\r\n        self.SetUpParam(p, \"planes\", \"planes\", \"The list of planes describing the trajectory of the robotic arm.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Plane()\r\n        self.SetUpParam(p, \"tcp\", \"tcp\", \"The current TCP of the robot.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Integer()\r\n        self.SetUpParam(p, \"step\", \"step\", \"The current step for the assembly.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Integer()\r\n        self.SetUpParam(p, \"pick_step\", \"pick_step\", \"The step where the robot should pick the plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Integer()\r\n        self.SetUpParam(p, \"drop_step\", \"drop_step\", \"The step where the robot should drop the plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"breps\", \"breps\", \"Plates displayed according to robot movements.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n    \r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        p2 = self.marshal.GetInput(DA, 2)\r\n        p3 = self.marshal.GetInput(DA, 3)\r\n        p4 = self.marshal.GetInput(DA, 4)\r\n        p5 = self.marshal.GetInput(DA, 5)\r\n        p6 = self.marshal.GetInput(DA, 6)\r\n        result = self.RunScript(p0, p1, p2, p3, p4, p5, p6)\r\n\r\n        if result is not None:\r\n            self.marshal.SetOutput(result, DA, 0, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAJ9SURBVEhLvdVrSFNhHMfxU2Y1yhpFFDnLS04XFBRhFwUhamlOcCgRDqo33RS7uFrGiCgiuqzCIicl9SJYBa7SEpJoXY1qXRCiF0VvKujmi14FQnT6/s/Okelmzlj94MPO8+zseZ49+z9nyn9LxdKsgpq180oqi7MX6F3JTfCo/WXv++3qlSP2p3pXchPylz1SezxqyO+4p3clN7eayrrUzzvUO82O23pXvKRiMtIxBRORWIwJrvnsz2lWYBU2YB98OIlTOIabeAO5txhDx5ig0b2kl6YMLFv1FjJwFmTlYyFZDbnvB75i6MIYMMFOhPAKstrjOIPzuIgOfMR91KAVmRg8xgQ3TpQ8oTkfGZA9ng4LpmESJmA0tkImlyzGdZi0VrwYE1BFsvJEE4Bsp2QNzkUu4yTU7OhSv3moovK7elciMeMhcrSWohzEnsjlgFz12bt/fXJTRSue6V2JRqooiBFaS1GaUBm5jErVssziqnLrturS7EK9azjZBdkq+SaX8QDLEROX/vo3kUr7gM2QcfbDgb6MgvGDDTdyqt/hEhqgYj22oC8jsTFyOazMxRccgGyVDCyHUxYbs+B1GIepWmvwyKHy4jR64IYkD/INDqMFcm60FMCJTdiN2RgssojXOIRSzEF0rPgOmaxfpNykAmLeiIrc8wIztFZs5JkVRr9KTJnpcrXYvN7WnNraTmt9fXBWXV1HtDyPpyPd6ZSTehZF2qdiMwbdqNZaUTHlNzT8LGxrUxcGAnEVtberGS6XPGv8SNE+FRvpf4xFkIo0KCtNFktXWn5+eHxublxpNls41Wzu5F6plD9lLy6gMUpkliRGxpP/DcO/jKL8BqAWy6+d88mZAAAAAElFTkSuQmCC\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n\r\n    def RunScript(self, stack_module, goal_module, planes, tcp, step, pick_step, drop_step):\r\n        \r\n        if step is None: step = 0\r\n        if pick_step is None: pick_step = 6\r\n        if drop_step is None: drop_step = 11\r\n        \r\n        display = []\r\n\r\n        if goal_module:\r\n            goal = []\r\n            for i in range(goal_module.count):\r\n                goal.append(goal_module.plates[i].brep)\r\n        if stack_module:\r\n            stack = []\r\n            for i in range(stack_module.count):\r\n                stack.append(stack_module.plates[i].brep)\r\n        if stack_module and goal_module and planes and tcp:\r\n            #number of moves\r\n            n = int(len(planes)/len(stack))\r\n            \r\n            # beginning phase\r\n            if step < pick_step :\r\n                display = stack\r\n            \r\n            # on move phase\r\n            elif (step % n >= pick_step) and (step % n <= drop_step):\r\n                plate_on_move = (step - step % n) / n\r\n                for i in range(len(stack)):\r\n                    if i < plate_on_move: display.append(goal[i])\r\n                    if i == plate_on_move:\r\n                        start_plane = planes[step - step % n + pick_step-2]\r\n                        matrix = rg.Transform.PlaneToPlane(start_plane, tcp)\r\n                        obj = rs.TransformObject(rs.CopyObject(stack[i]), matrix)\r\n                        display.append(obj)\r\n                    if i > plate_on_move: display.append(stack[i])\r\n            \r\n            # stand still phase\r\n            else:\r\n                step = step - pick_step\r\n                plate_on_move = (step - step % n) / n\r\n                for i in range(len(stack)):\r\n                    if i <= plate_on_move: display.append(goal[i])\r\n                    if i > plate_on_move: display.append(stack[i])\r\n\r\n        return (display)\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Plate simulation\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"16004be3-3e5c-4683-a78d-d0b4b1612804\")",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}