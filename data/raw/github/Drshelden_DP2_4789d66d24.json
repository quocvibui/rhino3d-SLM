{
  "source_url": "https://github.com/Drshelden/DP2/blob/5a4943a031847a44ecc295153ef08068443de42d/Classes/Week%2004%20-%20Vectors%20and%20Transforms/apply_excel_transform.py",
  "repo": "Drshelden/DP2",
  "repo_stars": 0,
  "repo_description": "Design Programming 2 Course Locker",
  "license": "unknown",
  "filepath": "Classes/Week 04 - Vectors and Transforms/apply_excel_transform.py",
  "instruction": "Rhino Script: Apply Excel Transform to Selected Objects",
  "code": "\"\"\"\nRhino Script: Apply Excel Transform to Selected Objects\n\nThis script (Python 3 compatible):\n1. Reads a 4x4 region from Excel via clipboard\n2. Validates that it's 4x4 and contains numerical values\n3. Creates a Transform from the matrix\n4. Applies it to all selected objects in Rhino\n\nAuthor: Rhino Script Assistant\nDate: February 2026\n\"\"\"\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nfrom Rhino.Geometry import Transform\nimport subprocess\n\ndef get_excel_matrix():\n    \"\"\"\n    Read a 4x4 matrix from the clipboard (copied from Excel).\n    User should select a 4x4 range in Excel, copy it (Ctrl+C), then run this script.\n    Returns: A 4x4 list of values, or None if unsuccessful\n    \"\"\"\n    try:\n        # Get clipboard contents\n        result = subprocess.check_output(\n            ['powershell', '-Command', 'Get-Clipboard']\n        )\n        \n        # Decode bytes to string\n        if isinstance(result, bytes):\n            clipboard_data = result.decode('utf-8').strip()\n        else:\n            clipboard_data = str(result).strip()\n        \n        if not clipboard_data:\n            print(\"Error: Clipboard is empty.\")\n            print(\"Please select a 4x4 range in Excel, copy it (Ctrl+C), and try again.\")\n            return None\n        \n        # Parse the clipboard data (Excel copies with tabs and newlines)\n        lines = clipboard_data.strip().split('\\n')\n        \n        # Check if we have 4 rows\n        if len(lines) != 4:\n            print(\"Error: Clipboard data is not 4 rows.\")\n            print(\"Please select a 4x4 range in Excel and try again.\")\n            print(\"Current rows: {}\".format(len(lines)))\n            return None\n        \n        # Parse the matrix\n        matrix = []\n        for row_idx, line in enumerate(lines):\n            # Split by tabs (Excel's default copy format)\n            values = line.split('\\t')\n            \n            # Check if we have 4 columns\n            if len(values) != 4:\n                print(\"Error: Row {} does not have 4 columns.\".format(row_idx + 1))\n                print(\"Please select a 4x4 range in Excel and try again.\")\n                print(\"Current columns in row {}: {}\".format(row_idx + 1, len(values)))\n                return None\n            \n            row = []\n            for col_idx, value in enumerate(values):\n                try:\n                    # Try to convert to float\n                    numeric_value = float(value.strip())\n                    row.append(numeric_value)\n                except (ValueError, TypeError):\n                    print(\"Error: Cell at row {} col {} contains non-numerical value: '{}'\".format(\n                        row_idx + 1, col_idx + 1, value))\n                    return None\n            \n            matrix.append(row)\n        \n        print(\"Successfully read 4x4 matrix from clipboard:\")\n        for row in matrix:\n            print(\"  \" + str(row))\n        \n        return matrix\n    \n    except subprocess.CalledProcessError:\n        print(\"Error: Could not read clipboard.\")\n        print(\"Please select a 4x4 range in Excel, copy it (Ctrl+C), and try again.\")\n        return None\n    except Exception as e:\n        print(\"Error reading clipboard: \" + str(e))\n        print(\"Please select a 4x4 range in Excel, copy it (Ctrl+C), and try again.\")\n        return None\n\n\ndef matrix_to_transform(matrix):\n    \"\"\"\n    Convert a 4x4 matrix to a Rhino Transform object.\n    \n    Args:\n        matrix: A 4x4 list of lists containing numerical values\n    \n    Returns:\n        A Rhino.Geometry.Transform object, or None if unsuccessful\n    \"\"\"\n    try:\n        # Create a new Transform (identity)\n        transform = Transform.Identity\n        \n        # Set the matrix values using indexers [row, column]\n        for row in range(4):\n            for col in range(4):\n                transform[row, col] = matrix[row][col]\n        \n        print(\"Transform created successfully.\")\n        return transform\n    \n    except Exception as e:\n        print(\"Error creating Transform: \" + str(e))\n        return None\n\n\ndef apply_transform_to_selection(transform):\n    \"\"\"\n    Apply the transform to copies of all selected objects in Rhino.\n    Original objects remain unchanged.\n    \n    Args:\n        transform: A Rhino.Geometry.Transform object\n    \n    Returns:\n        Number of objects transformed, or -1 if unsuccessful\n    \"\"\"\n    try:\n        # Get selected object IDs\n        selected_ids = rs.GetObjects(\"Select objects to transform\", 0, True, True)\n        \n        if not selected_ids:\n            print(\"No objects selected.\")\n            return 0\n        \n        transformed_count = 0\n        \n        for obj_id in selected_ids:\n            try:\n                # Copy the object first\n                copy_id = rs.CopyObject(obj_id)\n                \n                if copy_id is None:\n                    print(\"Warning: Could not copy object {}\".format(obj_id))\n                    continue\n                \n                # Transform the copy\n                result = rs.TransformObject(copy_id, transform)\n                \n                if result:\n                    transformed_count += 1\n                else:\n                    print(\"Warning: Could not transform copied object {}\".format(copy_id))\n            \n            except Exception as e:\n                print(\"Error transforming object {}: \".format(obj_id) + str(e))\n                continue\n        \n        print(\"Successfully created and transformed {} object(s).\".format(transformed_count))\n        return transformed_count\n    \n    except Exception as e:\n        print(\"Error during transformation: \" + str(e))\n        return -1\n\n\ndef main():\n    \"\"\"Main execution function\"\"\"\n    print(\"=\" * 60)\n    print(\"Rhino Excel Transform Script\")\n    print(\"=\" * 60)\n    print()\n    \n    # Step 1: Read the 4x4 matrix from Excel\n    print(\"Step 1: Reading 4x4 matrix from Excel...\")\n    matrix = get_excel_matrix()\n    \n    if matrix is None:\n        print()\n        print(\"Script cancelled.\")\n        return\n    \n    print()\n    \n    # Step 2: Create the Transform\n    print(\"Step 2: Creating Transform...\")\n    transform = matrix_to_transform(matrix)\n    \n    if transform is None:\n        print()\n        print(\"Script cancelled.\")\n        return\n    \n    print()\n    \n    # Step 3: Apply Transform to selected objects\n    print(\"Step 3: Applying Transform to selected objects...\")\n    result = apply_transform_to_selection(transform)\n    \n    if result >= 0:\n        print()\n        print(\"=\" * 60)\n        print(\"Script completed successfully!\")\n        print(\"=\" * 60)\n    else:\n        print()\n        print(\"Script completed with errors.\")\n\n\n# Execute the script\nif __name__ == \"__main__\":\n    main()\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}