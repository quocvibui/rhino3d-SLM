{
  "source_url": "https://github.com/gramaziokohler/integral_timber_joints/blob/d543a28ccfaeb8a56ff692a29d5510c3e649477f/src/integral_timber_joints/rhino/trajectory_slider.py",
  "repo": "gramaziokohler/integral_timber_joints",
  "repo_stars": 11,
  "repo_description": "Robotic Assembled Timber Structures with Integral Timber Joints",
  "license": "MIT",
  "filepath": "src/integral_timber_joints/rhino/trajectory_slider.py",
  "instruction": "Trajectory slider",
  "code": "# Imports\nimport Rhino\nimport scriptcontext\nimport System\nimport Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nfrom integral_timber_joints.rhino.load import get_process, get_process_artist\nfrom integral_timber_joints.process import RoboticMovement\nfrom compas_fab.robots.trajectory import JointTrajectory\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc  # type: ignore\n\n# SampleEtoRoomNumber dialog class\n\n\nclass TrajectorySliderDialog(forms.Dialog[bool]):\n\n    # Dialog box Class initializer\n    def __init__(self):\n        # Initialize drawing related parameters to local variable.\n        self.process = get_process()\n        self.artist = get_process_artist()\n        self.movement = self.process.movements[self.artist.selected_state_id - 1]  # type: RoboticMovement\n        self.trajectory = self.movement.trajectory  # type: JointTrajectory\n        self.init_success = False\n        if self.trajectory is None:\n            print(\"Trajectory is None for %s. Dialog cannot continue\" % (self.movement.movement_id))\n            self.Close(True)\n            return\n\n        trajectory_point_count = len(self.trajectory.points)\n        print(\"Trajectory for %s has %i points.\" % (self.movement.movement_id, trajectory_point_count))\n\n        # Lock to avoid multi threaded update conflict\n        self.update_lock = False\n\n        # Initialize dialog box\n        self.Title = 'Trajectory Slider (PgUp PgDn / Slider)'\n        self.Padding = drawing.Padding(10)\n        self.Resizable = True\n\n        # Create controls for the dialog\n        self.label_total = forms.Label(Text='Trajector Point Index (0 - %i):' % (trajectory_point_count - 1))\n\n        # Create label to chow current index\n        self.label_current = forms.Label(Text='Showing: %i' % (trajectory_point_count - 1))\n\n        # Create a slider\n        self.slider = forms.Slider()\n        self.slider.MinValue = 0\n        self.slider.MaxValue = trajectory_point_count - 1\n        self.slider.Value = trajectory_point_count - 1\n        self.slider.ValueChanged += self.OnSliderValueChanged\n        self.slider.Size = drawing.Size(300, 25)\n\n        # Create the abort button\n        self.AbortButton = forms.Button(Text='Close')\n        self.AbortButton.Click += self.OnCloseButtonClick\n\n        # Create a table layout and add all the controls\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(5, 5)\n        layout.AddRow(self.label_total, self.slider)\n        layout.AddRow(None)  # spacer\n        layout.AddRow(self.label_current, self.AbortButton)\n\n        # Set the dialog content\n        self.Content = layout\n        self.init_success = True\n    # Start of the class functions\n\n    # Close button click handler\n    def OnCloseButtonClick(self, sender, e):\n        self.Close(True)\n\n    # Slider value changed handler\n    def OnSliderValueChanged(self, sender, e):\n        # Multi threaded update lock\n        if self.update_lock:\n            # print (\"Lock active for value %s\" % self.m_slider.Value)\n            return\n        # print (\"Lock okay for %s\" % self.m_slider.Value)\n        self.update_lock = True\n\n        # * Get Configuration at Trajectory Point\n        point_index = self.slider.Value\n        self.label_current.Text = 'Showing: %i' % (point_index)\n        config = self.trajectory.points[point_index]\n\n        # * Get scene with the new trajectory point config\n        scene = self.artist.get_current_selected_scene_state(robot_config_override=config)\n\n        print(\"Showing Trajectory Point Index %i, Config = %s \" % (point_index, config))\n        self.artist.draw_state(scene)\n\n        # Unlock the mutithread lock\n        self.update_lock = False\n\n    ## End of Dialog Class ##\n\n\n# Test calling the dialog\ndef ShowTrajectorySliderDialog():\n    dialog = TrajectorySliderDialog()\n    if dialog.init_success:\n        Rhino.UI.EtoExtensions.ShowSemiModal(dialog, Rhino.RhinoDoc.ActiveDoc, Rhino.UI.RhinoEtoApp.MainWindow)\n\n\n##########################################################################\n# During development, the following code simulates the steps before\n# and after the dialog is called.\nif __name__ == \"__main__\":\n    from integral_timber_joints.rhino.visualize_trajectory import hide_interactive_beams\n    from integral_timber_joints.rhino.visualize_trajectory import show_interactive_beams_delete_state_vis, redraw_state_and_trajectory\n\n    # Situation before entering the dialog\n    process = get_process()\n    artist = get_process_artist()\n    rs.EnableRedraw(False)\n    hide_interactive_beams(process)\n    redraw_state_and_trajectory(artist, process, True)\n\n    # Running interactive aslider\n    ShowTrajectorySliderDialog()\n\n    # Situation after the dialog and after exiting main function\n    show_interactive_beams_delete_state_vis(process)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}