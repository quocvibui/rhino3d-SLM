{
  "source_url": "https://github.com/bsamiee/Parametric_Arsenal/blob/54ec3f5a7fc2c671cb7bc4601772820e625a1904/rhino/plugins/DocsPlease/commands/DetailCaption.py",
  "repo": "bsamiee/Parametric_Arsenal",
  "repo_stars": 0,
  "repo_description": "Rhino 8 Plugins and Scripts - A comprehensive monorepo for architectural automation, parametric design, and creative workflows",
  "license": "MIT",
  "filepath": "rhino/plugins/DocsPlease/commands/DetailCaption.py",
  "instruction": "Title         : DetailCaption.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/DocsPlease/commands/DetailCaption.py",
  "code": "\"\"\"\nTitle         : DetailCaption.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/DocsPlease/commands/DetailCaption.py\n\nDescription\n------------------------------------------------------------------------------\nCreates or updates numbered detail captions with title and scale text positioned below Detail Views.\nAutomatically detects existing captions and updates them instead of creating duplicates.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport rhinoscriptsyntax as rs\nfrom libs.command_framework import rhino_command\nfrom libs.common_utils import require_user_selection, require_user_string, validate_detail_object\nfrom libs.constants import Constants, Strings\nfrom libs.detail_tools import DetailTools\n\n\n@rhino_command(requires_layout=True, undo_description=\"Detail Caption\")\ndef detail_caption() -> None:\n    \"\"\"\n    Create or update detail caption with title and scale.\n\n    Automatically detects if a caption already exists for the selected detail view\n    and updates it instead of creating a duplicate. If no caption exists, creates\n    a new numbered caption.\n\n    Raises:\n        UserCancelledError: If user cancels selection or input.\n        DetailError: If selected object is not a valid detail view.\n        ValidationError: If caption text creation or update fails.\n    \"\"\"\n    # Get detail selection (preselect or prompt)\n    selected = rs.SelectedObjects() or []\n    detail_id = selected[0] if selected else require_user_selection(Strings.PROMPT_SELECT_DETAIL, rs.filter.detail)\n\n    # Validate detail object\n    validate_detail_object(detail_id)\n\n    # Ensure caption layer exists\n    DetailTools.ensure_layer_exists(Constants.CAPTION_LAYER)\n\n    # Search for existing caption linked to this detail\n    existing_caption = DetailTools.find_existing_caption(detail_id)\n\n    if existing_caption:\n        # Update existing caption\n        current_title = DetailTools.get_caption_title(existing_caption)\n        title_text = require_user_string(Strings.PROMPT_ENTER_TITLE, current_title, \"Detail Caption\")\n        scale_text = DetailTools.get_detail_scale(detail_id)\n\n        DetailTools.update_caption_text(existing_caption, title_text, scale_text)\n\n        caption_number = rs.TextObjectText(existing_caption[0])\n        print(f\"Caption {caption_number} updated for detail view\")\n    else:\n        # Create new caption\n        caption_number = DetailTools.count_existing_captions() + 1\n        title_text = require_user_string(Strings.PROMPT_ENTER_TITLE, \"DETAIL\", \"Detail Caption\")\n        scale_text = DetailTools.get_detail_scale(detail_id)\n\n        DetailTools.create_caption(detail_id, caption_number, title_text, scale_text)\n\n        print(f\"Caption {caption_number} created\")\n\n\n# --- Rhino Plugin Entry Point -----------------------------------------------\ndef RunCommand(is_interactive: bool) -> int:\n    \"\"\"Rhino command entry point.\"\"\"\n    detail_caption()\n    return 0\n\n\n# --- Script Entry Point -----------------------------------------------------\nif __name__ == \"__main__\":\n    detail_caption()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}