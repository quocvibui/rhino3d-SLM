{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph_plus/blob/b89f9887488d9c10eb732ffafe910cec70be0752/honeybee_ph_plus_rhino/gh_compo_io/reporting/build_env_surfaces.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph_plus",
  "repo_stars": 2,
  "repo_description": "Additional Honeybe-PH Grasshopper Components",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_plus_rhino/gh_compo_io/reporting/build_env_surfaces.py",
  "instruction": "Functions for getting / sorting all the Honeybee-Model Envelope Surfaces.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"Functions for getting / sorting all the Honeybee-Model Envelope Surfaces. \"\"\"\n\nfrom collections import defaultdict\n\ntry:\n    from typing import Any, Dict, List, Tuple\nexcept ImportError:\n    pass  # Python 2.7\n\ntry:\n    from System import Object  # type: ignore\n    from System.Drawing import Color  # type: ignore\nexcept ImportError:\n    pass  # Outside .NET\n\ntry:\n    from Grasshopper import DataTree  # type: ignore\n    from Grasshopper.Kernel.Data import GH_Path  # type: ignore\n    from Rhino.DocObjects import ObjectAttributes  # type: ignore\nexcept ImportError:\n    pass  # Outside Rhino\n\ntry:\n    from honeybee import face, model\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee:\\n\\t{}\".format(e))\n\ntry:\n    from ladybug_rhino.fromgeometry import from_face3d\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from ph_gh_component_io import gh_io\nexcept ImportError:\n    raise ImportError(\"Failed to import honeybee_ph_rhino\")\n\n\nclass GHCompo_CreateEnvelopeSurfaces(object):\n    def __init__(\n        self,\n        _IGH,\n        _hb_model,\n        _highlight_surface_color,\n        _highlight_outline_color,\n        _highlight_outline_weight,\n        _default_surface_color,\n        _default_outline_color,\n        _default_outline_weight,\n        *args,\n        **kwargs\n    ):\n        # type: (gh_io.IGH, model.Model, Color, Color, float, Color, Color, float, List[Any], Dict[Any, Any]) -> None\n        self.IGH = _IGH\n        self.hb_model = _hb_model\n        self.highlight_surface_color = _highlight_surface_color\n        self.highlight_outline_color = _highlight_outline_color\n        self.highlight_outline_weight = _highlight_outline_weight\n        self.default_surface_color = _default_surface_color\n        self.default_outline_color = _default_outline_color\n        self.default_outline_weight = _default_outline_weight\n\n    def create_rh_attr_object(self, _color, _weight):\n        # type: (Color, float) -> ObjectAttributes\n        \"\"\"Return a new Rhino.DocObjects.ObjectAttributes object with specified settings.\"\"\"\n\n        new_attr_obj = self.IGH.Rhino.DocObjects.ObjectAttributes()\n\n        new_attr_obj.ObjectColor = _color\n        new_attr_obj.PlotColor = _color\n        new_attr_obj.ColorSource = (\n            self.IGH.Rhino.DocObjects.ObjectColorSource.ColorFromObject\n        )\n        new_attr_obj.PlotColorSource = (\n            self.IGH.Rhino.DocObjects.ObjectPlotColorSource.PlotColorFromObject\n        )\n\n        new_attr_obj.PlotWeight = _weight\n        new_attr_obj.PlotWeightSource = (\n            self.IGH.Rhino.DocObjects.ObjectPlotWeightSource.PlotWeightFromObject\n        )\n\n        # new_attr_obj.DisplayOrder = 0  # 1 = Front, -1 = Back\n\n        return new_attr_obj\n\n    def get_hb_face_groups_from_model(self, _hb_model):\n        # type: (model.Model) -> Dict[str, List[face.Face]]\n        \"\"\"Return a dict with Honeybee-Faces grouped by their Construction-Name.\"\"\"\n\n        if not _hb_model:\n            return {}\n\n        face_groups = defaultdict(list)\n        for hb_room in _hb_model.rooms:\n            for hb_face in hb_room.faces:\n                hb_face_constr_name = hb_face.properties.energy.construction.display_name\n                hb_face_constr_name = hb_face_constr_name.strip()\n                face_groups[hb_face_constr_name].append(hb_face)\n\n        return face_groups\n\n    def get_all_construction_names(self, _hb_model):\n        # type: (model.Model) -> List[str]\n        \"\"\"Returns a sorted list of all the construction names found in the Honeybee-Model.\"\"\"\n        if not _hb_model:\n            return []\n\n        hb_cont_names = set()\n        for hb_room in _hb_model.rooms:\n            for hb_face in hb_room.faces:\n                hb_cont_names.add(hb_face.properties.energy.construction.display_name)\n        return sorted(list(hb_cont_names))\n\n    def run(self):\n        # type: () -> Tuple\n        \"\"\"Returns a tuple of the DataTrees with all the Surface Data and geometry from the HB-Model.\n\n        Arguments:\n        ----------\n            * _IGH (gh_io.IGH): The Grasshopper Interface\n            * _hb_model (model.Model): The Honeybee Model to use as the source.\n            * _highlight_surface_color (System.Drawing.Color): The color to use for the Mesh surfaces\n            * _highlight_outline_color (System.Drawing.Color): The color to use for the Mesh outlines\n            * _highlight_outline_weight (float): The plot-weight to use for the Mesh outlines.\n            * _default_surface_color (System.Drawing.Color):\n            * _default_outline_color (System.Drawing.Color):\n            * _default_outline_weight (float):\n\n        Returns:\n        --------\n            * (Tuple[DataTree, DataTree, DataTree, DataTree]):\n        \"\"\"\n\n        # -- Output Trees\n        face_const_names_ = self.IGH.Grasshopper.DataTree[str]()\n        face_geometry_ = self.IGH.Grasshopper.DataTree[Object]()\n        face_rh_attributes_ = self.IGH.Grasshopper.DataTree[ObjectAttributes]()\n        face_areas_ = self.IGH.Grasshopper.DataTree[float]()\n        pth = self.IGH.Grasshopper.Kernel.Data.GH_Path\n\n        # -- Build the RH AttributeObjects\n        rh_attr_surface_highlight = self.create_rh_attr_object(\n            self.highlight_surface_color, 0\n        )\n        rh_attr_surface_default = self.create_rh_attr_object(\n            self.default_surface_color, 0\n        )\n        rh_attr_curve_highlight = self.create_rh_attr_object(\n            self.highlight_outline_color, self.highlight_outline_weight\n        )\n        rh_attr_curve_default = self.create_rh_attr_object(\n            self.default_outline_color, self.default_outline_weight\n        )\n\n        # -- Get all the exterior surfaces from the Model\n        hb_face_groups = self.get_hb_face_groups_from_model(self.hb_model)\n\n        # -- Create the mesh surfaces and edges from the HB-Faces\n        for i, const_name in enumerate(self.get_all_construction_names(self.hb_model)):\n            face_const_names_.Add(const_name, pth(i))\n            face_areas_.Add(sum(f.area for f in hb_face_groups[const_name]), pth(i))\n\n            for hb_room in self.hb_model.rooms:\n                for hb_face in hb_room.faces:\n                    # -- Choose the right colors\n                    if hb_face.properties.energy.construction.display_name == const_name:\n                        surface_color = rh_attr_surface_highlight\n                        crv_color = rh_attr_curve_highlight\n                    else:\n                        surface_color = rh_attr_surface_default\n                        crv_color = rh_attr_curve_default\n\n                    # -- Create the Mesh Surface\n                    mesh = self.IGH.ghpythonlib_components.MeshColours(\n                        from_face3d(hb_face.geometry), surface_color.ObjectColor\n                    )\n                    face_geometry_.Add(mesh, pth(i))\n                    face_rh_attributes_.Add(surface_color, pth(i))\n\n                    # -- Create the Mesh Boundary Edges\n                    msh_edges = self.IGH.ghpythonlib_components.MeshEdges(\n                        mesh\n                    ).naked_edges\n                    msh_boundary = self.IGH.ghpythonlib_components.JoinCurves(\n                        msh_edges, preserve=False\n                    )\n                    if isinstance(msh_boundary, list):\n                        # If boundary is more than one curve, its a donut shaped face....\n                        for crv in msh_boundary:\n                            face_geometry_.Add(crv, pth(i))\n                            face_rh_attributes_.Add(crv_color, pth(i))\n                    else:\n                        face_geometry_.Add(msh_boundary, pth(i))\n                        face_rh_attributes_.Add(crv_color, pth(i))\n\n        return (face_const_names_, face_geometry_, face_rh_attributes_, face_areas_)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib"
  ],
  "has_docstring": true
}