{
  "source_url": "https://github.com/GEL-Dev/RebarRIRToolkit/blob/677b93783a0288e5b411858c133cb7e04a6a0a06/Temp/get_all_rebarshapes.py",
  "repo": "GEL-Dev/RebarRIRToolkit",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Temp/get_all_rebarshapes.py",
  "instruction": "Get all rebarshapes",
  "code": "import rhinoscriptsyntax as rs\nimport clr\nclr.AddReference('System.Core')\nclr.AddReference('RhinoInside.Revit')\nclr.AddReference('RevitAPI') \nclr.AddReference('RevitAPIUI')\nimport math\nimport Rhino\nimport RhinoInside\nimport Grasshopper\nimport ghpythonlib.treehelpers as th\nimport Grasshopper.Kernel.Data.GH_Path as GH_Path\nimport Grasshopper.DataTree as DataTree\nimport scriptcontext\nfrom RhinoInside.Revit import Revit, Convert\nfrom Autodesk.Revit import DB\nfrom Autodesk.Revit.DB.Structure import *\nimport System\nfrom System.Collections.Generic import List, IList\nfrom System import Enum, Action\n\n# Get the Revit document\ndoc = Revit.ActiveDBDocument\n\nallRebarShape  = DB.FilteredElementCollector(doc).OfClass(DB.Structure.RebarShape).WhereElementIsElementType().ToElements()\nallRebarShapeNames = []\n\n# Get all the rebar shape names\nfor shape in allRebarShape:\n    allRebarShapeNames.append(shape.get_Parameter(DB.BuiltInParameter.ALL_MODEL_TYPE_NAME).AsString())\n\n# Get all curves for the browser\noutput_tree = DataTree[System.Object]()\n\nfor i, shape in enumerate(allRebarShape):\n    curves = shape.GetCurvesForBrowser()\n    for j,curve in enumerate(curves):\n        rhino_curve = Convert.Geometry.GeometryDecoder.ToCurve(curve)\n        output_tree.Add(rhino_curve, GH_Path(i))\n\nallRebarCurves = output_tree\n\n# Get all the rebar hook angles\noutput_tree = DataTree[System.Object]()\nallRebarShapeHookAngle = []\n\nfor i, shape in enumerate(allRebarShape):\n        output_tree.Add(shape.GetDefaultHookAngle(0), GH_Path(i))\n        output_tree.Add(shape.GetDefaultHookAngle(1), GH_Path(i))\nallRebarShapeHookAngle = output_tree\n    \n# Get all the rebar hook angles\noutput_tree = DataTree[System.Object]()\nallRebarShapeHookOrientation = []\n\nfor i, shape in enumerate(allRebarShape):\n        output_tree.Add(shape.GetDefaultHookOrientation(0), GH_Path(i))\n        output_tree.Add(shape.GetDefaultHookOrientation(1), GH_Path(i))\nallRebarShapeHookOrientation = output_tree\n\n# Get all the rebar parameters\noutput_tree = DataTree[System.Object]()\noutput_curve = DataTree[System.Object]()\nallRebarSegmentLabel = []\nfor i, shape in enumerate(allRebarShape):\n    familyId = shape.ShapeFamilyId\n    family = doc.GetElement(familyId)\n    family_doc = doc.EditFamily(family);\n    #family_doc = family.Document\n    \n    collector = DB.FilteredElementCollector(family_doc);\n    familyDimensions = collector.OfClass(DB.Dimension).ToElements();\n    labelParamIdToDimId ={}\n    for dim in familyDimensions:\n        try:\n            famParam = dim.FamilyLabel \n            print(famParam)\n            if famParam is not None:\n                print(famParam.Id)\n                labelParamIdToDimId[famParam.Id] = dim.Id\n                print(\"Print not None\")\n                print(dim.Id)\n            \n            \n            #if famParam is not None:\n                \n                #print(dim.Id)\n        except :\n            continue\n    \n    def_by_seg = shape.GetRebarShapeDefinition()\n    if not isinstance(def_by_seg, RebarShapeDefinitionBySegments):\n        raise TypeError(\"Expected RebarShapeDefinitionBySegments type\")\n    segment_pos_to_label = {}\n    curves_for_browser = shape.GetCurvesForBrowser()\n    for ii in range(def_by_seg.NumberOfSegments):\n        seg = def_by_seg.GetSegment(ii)\n        constraints = seg.GetConstraints()\n        for constraint in constraints:\n            param_id = constraint.GetParamId()\n            if param_id is not DB.ElementId.InvalidElementId and param_id in labelParamIdToDimId :\n                label_name = \"\"\n                for param in shape.Parameters:\n                    if param.Id == param_id:\n                        label_name = param.Definition.Name\n                        rhino_curve = Convert.Geometry.GeometryDecoder.ToCurve(curves_for_browser[ii])\n                        segment_pos_to_label[label_name] = rhino_curve\n                        output_tree.Add(label_name, GH_Path(i))\n                        output_curve.Add(rhino_curve, GH_Path(i))\n                        \n        \nallRebarSegmentLabel = output_tree\nallRebarCurves = output_curve",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}