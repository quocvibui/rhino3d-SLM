{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/lib/EnneadTab/RHINO/RHINO_RUI.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/lib/EnneadTab/RHINO/RHINO_RUI.py",
  "instruction": "Rhino rui",
  "code": "import ENVIRONMENT\r\nimport FOLDER\r\nimport os\r\nimport time\r\nimport random\r\n\r\nif ENVIRONMENT.IS_RHINO_ENVIRONMENT:\r\n    import rhinoscriptsyntax as rs\r\n    import Rhino # pyright: ignore\r\n\r\n\r\ndef update_rui_v7():\r\n    \r\n\r\n    for tool_bar_name in rs.ToolbarCollectionNames():\r\n        if ENVIRONMENT.PLUGIN_NAME.lower() in tool_bar_name.lower():\r\n            rs.CloseToolbarCollection(tool_bar_name, prompt=False)\r\n\r\n\r\n    my_local_version = FOLDER.copy_file_to_local_dump_folder(ENVIRONMENT.DIST_RUI_CLASSIC)\r\n    rs.OpenToolbarCollection(my_local_version)\r\n\r\ndef update_rui_v8():\r\n    # todo: figure out a way to deal with R8 rui handle disapear after restart\r\n    good_rui_toolbar_name = os.path.basename(ENVIRONMENT.DIST_RUI_MODERN).replace(\".rui\", \"\")\r\n\r\n    for tool_bar_name in rs.ToolbarCollectionNames():\r\n        # do not close current oppedn mordern rui so it will not deacivate and disappear after restart\r\n        if good_rui_toolbar_name == tool_bar_name:\r\n            continue\r\n\r\n        if ENVIRONMENT.PLUGIN_NAME.lower() in tool_bar_name.lower():\r\n            rs.CloseToolbarCollection(tool_bar_name, prompt=False)\r\n\r\n\r\n    my_local_version = FOLDER.copy_file_to_local_dump_folder(ENVIRONMENT.DIST_RUI_MODERN)\r\n    rs.OpenToolbarCollection(my_local_version)\r\n\r\n\r\n\r\n\r\ndef update_my_rui():\r\n    if rs.ExeVersion() >= 8:\r\n        update_rui_v8()\r\n    else:\r\n        update_rui_v7()\r\n\r\n\r\n    \r\n\r\n\r\n\r\ndef add_startup_script():\r\n    \r\n    \"\"\"hear me out here:\r\n    python cannot add startup script directly\r\n   \r\n    i use this python script C to call rhino script B to call rhino script A, which is the command alias\r\n    This will not run the startup command, it just add to the start sequence.\r\n    \"\"\"\r\n    max_attempts = 3\r\n    \r\n    rvb_caller_script_path = \"{}\\\\{}_StartupCaller.rvb\".format(ENVIRONMENT.WINDOW_TEMP_FOLDER, ENVIRONMENT.PLUGIN_NAME)\r\n\r\n    rvb_caller_content = \"\"\"\r\nOption Explicit\r\n\r\nSub StartupCaller()\r\n    Dim commandName\r\n    commandName = \"{}_{}_Startup\"\r\n    Call Rhino.Command(commandName)\r\nEnd Sub\r\n\r\nCall StartupCaller()\r\n\"\"\".format(ENVIRONMENT.PLUGIN_ABBR, ENVIRONMENT.PLUGIN_NAME)\r\n\r\n    # Use retry logic for the first file\r\n    for attempt in range(max_attempts):\r\n        try:\r\n            with open(rvb_caller_script_path, \"w\") as f:\r\n                f.write(rvb_caller_content)\r\n            break\r\n        except IOError as e:\r\n            if attempt < max_attempts - 1:\r\n                # Add a small random delay to avoid race conditions\r\n                time.sleep(0.5 + random.random())\r\n                continue\r\n            else:\r\n                print(\"Failed to write caller script after {} attempts: {}\".format(max_attempts, e))\r\n                raise\r\n\r\n    rvb_startup_modifier_script_path = \"{}\\\\{}_StartupEnable.rvb\".format(ENVIRONMENT.WINDOW_TEMP_FOLDER, ENVIRONMENT.PLUGIN_NAME)\r\n\r\n    rvb_startup_modifier_content = \"\"\"\r\nOption Explicit\r\n\r\nSub StartupEnable()\r\n    On Error Resume Next\r\n    \r\n    Dim filePath\r\n    Dim intCount\r\n    Dim arrPaths\r\n    Dim strPath\r\n    Dim temp_folder\r\n    \r\n    temp_folder = \"C:\\\\temp\\\\{}_Dump\"\r\n\r\n    ' Get count of startup scripts\r\n    intCount = Rhino.StartupScriptCount\r\n    \r\n    ' If there are scripts, check for ones containing \"menu\" and remove them\r\n    If intCount > 0 Then\r\n        arrPaths = Rhino.StartupScriptList\r\n        For Each strPath in arrPaths\r\n            If InStr(strPath, \"menu\") > 0 Then\r\n                Call Rhino.DeleteStartupScript (strPath)\r\n            End If\r\n        Next\r\n    End If\r\n    \r\n    filePath = temp_folder & \"\\\\{}_StartupCaller.rvb\"\r\n    \r\n    ' Ensure path with spaces is handled correctly by enclosing in quotes\r\n    filePath = Chr(34) & filePath & Chr(34)\r\n    \r\n    Call Rhino.AddStartupScript(filePath)\r\n    \r\n    If Err.Number <> 0 Then\r\n        Call Rhino.Print(\"Error in StartupEnable: \" & Err.Description)\r\n    End If\r\nEnd Sub\r\n\r\nCall StartupEnable()\r\n\"\"\".format(ENVIRONMENT.PLUGIN_NAME, ENVIRONMENT.PLUGIN_NAME)\r\n\r\n    # Use retry logic for the second file\r\n    for attempt in range(max_attempts):\r\n        try:\r\n            with open(rvb_startup_modifier_script_path, \"w\") as f:\r\n                f.write(rvb_startup_modifier_content)\r\n            break\r\n        except IOError as e:\r\n            if attempt < max_attempts - 1:\r\n                # Add a small random delay to avoid race conditions\r\n                time.sleep(0.5 + random.random())\r\n                continue\r\n            else:\r\n                print(\"Failed to write startup modifier script after {} attempts: {}\".format(max_attempts, e))\r\n                raise\r\n                \r\n    Rhino.RhinoApp.RunScript(\"-LoadScript \" + rvb_startup_modifier_script_path, True)\r\n    \r\ndef unit_test():\r\n    pass\r\n\r\n    \r\nif __name__ == \"__main__\":\r\n\r\n    update_my_rui()",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}