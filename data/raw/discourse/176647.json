{
  "source_url": "https://discourse.mcneel.com/t/gui-rhino-radial-menu-cross-platform/176647",
  "topic_id": 176647,
  "title": "GUI - Rhino - Radial Menu - Cross Platform",
  "question": "Hello,\n\n\nI’m out on a journey to create a Radial Popup Menu for Rhino that has image buttons on it that can spawn additional dialog (likely Eto) on clicking one of the menu options.\n\n\nI’ve come across various visual examples of this implementation on the forums here and of course Grasshopper has a similar radial menu built in but I haven’t found any code to this effect.\n\n\nI wanted to pick the community brain on this kind of implementation from a cross platform perspective.\n\n\nIs Eto.Forms.Drawable the way to go with this? Rhino.Display.Pipeline? I would like to do additional research on the topic but can’t seem to find any more posts about it. Perhaps I need to look to python or C# examples outside of Rhino and adapt code from there…\n\n\nI think it’s going to be a lot of Display.Pipeline work:\n\n\nhttps://developer.rhino3d.com/api/rhinocommon/rhino.display.displaypipeline\n\n\nA few visual examples of the kind of thing I’m looking to implement:\n\nCAD Mouse:\n\n\nimage\n1333×750 78 KB\n\nRhino Artisan:\n\n\nimage\n1024×567 87.5 KB\n\nShape Plugin:\n\n\nimage\n688×328 44.1 KB\n\n\nNon-Rhino Examples:\n\n\n\n\nimage\n1000×750 25.2 KB\n\n\nimage\n462×446 5.32 KB\n\n\nThanks for your response!",
  "code_blocks": [
    {
      "code": "import Eto.Forms as forms\nimport Eto.Drawing as drawing\nimport System\nimport Rhino.UI\nimport math\n\nclass CircleProperties:\n    def __init__(self):\n        self.fill_color = drawing.Colors.White\n        self.border_color = None  # Will be set dynamically\n        self.highlight_color = drawing.Colors.Orange\n\n\nclass TransparentDialog(forms.Dialog[bool]):\n    def __init__(self):\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(5)\n        self.Opacity = 1  \n\n        # Initialize circle properties list\n        self.circle_properties = [CircleProperties() for _ in range(8)]\n\n        self.dialog_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n        self.DrawCirclesOnBitmap(self.dialog_bitmap, None)\n\n        # Add an extra bitmap for the highlighted circle\n        self.highlight_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n        \n        self.image_view = forms.ImageView()\n        self.image_view.Image = self.dialog_bitmap\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.image_view)\n        self.Content = layout\n\n        self.Title = \"PIE Menu 0.1\"\n\n        self.selected_button_index = None  # Initialize selected button index variable\n\n    def DrawCirclesOnBitmap(self, bitmap, pointed_circle_index):\n        circle_radius = 100\n        num_circles = 8\n        button_radius = 35\n\n        graphics = drawing.Graphics(bitmap)\n\n        center_x = bitmap.Size.Width / 2\n        center_y = bitmap.Size.Height / 2\n\n        for i, properties in enumerate(self.circle_properties):\n            angle = (2 * math.pi / num_circles) * i\n            circle_center_x = center_x + circle_radius * math.cos(angle)\n            circle_center_y = center_y + circle_radius * math.sin(angle)\n            circle_position = drawing.Point(circle_center_x - button_radius, circle_center_y - button_radius)\n            circle_size = drawing.Size(2 * button_radius, 2 * button_radius)\n          \n            circ_brush = drawing.SolidBrush(properties.fill_color)  # Use circle properties\n\n            highlight_color = drawing.Colors.Orange  # Set the highlight color\n            border_color = drawing.Color.FromArgb(255, i * 30, (i * 30) % 255, 255)  # Assign a unique border color for each circle\n            \n            if i == pointed_circle_index:\n                border_pen = drawing.Pen(highlight_color, 10)\n                self.selected_button_index = i  # Update selected button index\n            else:\n                border_pen = drawing.Pen(border_color, 5)\n\n            graphics.FillEllipse(circ_brush, drawing.Rectangle(circle_position, circle_size))\n            graphics.DrawEllipse(border_pen, drawing.Rectangle(circle_position, circle_size))    \n\n        graphics.Dispose()\n\n\nclass SampleTransparentEtoForm(forms.Form):\n    def __init__(self):\n        self.WindowStyle = forms.WindowStyle.None\n        \n        self.Styles.Add[forms.Panel](\"transparent\", self.MyFormStyler)\n        self.Style = \"transparent\"\n        \n        self.AutoSize = False\n        self.Resizable = False\n        self.TopMost = True\n        self.ShowActivated = False\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(20)\n        self.MovableByWindowBackground = False\n\n        self.close_button = forms.Button(Text=\"Close\")\n        self.close_button.Click += self.OnCloseButtonClick\n\n        self.dialog = TransparentDialog()\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.dialog.Content)\n\n        self.Content = layout\n\n    def MyFormStyler(self, control):\n        self.BackgroundColor = drawing.Colors.Transparent\n        window = control.ControlObject\n        if hasattr(window, \"AllowsTransparency\"):\n            window.AllowsTransparency = True\n        if hasattr(window, \"Background\"):\n            brush = window.Background.Clone()\n            brush.Opacity = 0\n            window.Background = brush\n        else:\n            color = window.BackgroundColor\n            window.BackgroundColor = color.FromRgba(0, 0, 0, 0)\n\n    def OnCloseButtonClick(self, sender, e):\n        # This method can be used later for other purposes\n        self.Close()\n\nclass MyMouseCallback(Rhino.UI.MouseCallback):\n    def __init__(self):\n        self.original_position = None\n        self.form = None\n        self.mouse_moved = False\n\n    def OnMouseDown(self, e):    \n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            self.original_position = Rhino.UI.MouseCursor.Location\n            self.form = SampleTransparentEtoForm()\n            form_loc = drawing.Point(self.original_position.X, self.original_position.Y)\n            self.form.Location = form_loc\n            self.form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n            self.form.Show()\n        else:\n            Rhino.RhinoApp.WriteLine(\"Failure...\")\n            return\n\n    def OnMouseMove(self, e):\n        if self.original_position:\n            current_position = Rhino.UI.MouseCursor.Location\n            \n            if current_position != self.original_position:\n                self.mouse_moved = True\n\n                vector_x = current_position.X - self.original_position.X\n                vector_y = current_position.Y - self.original_position.Y\n\n                angle = math.atan2(vector_y, vector_x)\n                angle_degrees = math.degrees(angle)\n                \n                if angle_degrees < 0:\n                    angle_degrees += 360\n                \n                num_circles = 8\n                pointed_circle_index = int(angle_degrees / (360 / num_circles))\n                # Rhino.RhinoApp.WriteLine(\"Button Index: \"+ str(pointed_circle_index) )\n\n                # Create a new bitmap for highlighting\n                highlight_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n                # Call the DrawCirclesOnBitmap method with the highlighted circle\n                self.form.dialog.DrawCirclesOnBitmap(highlight_bitmap, pointed_circle_index)\n                # Update the ImageView with the new highlight_bitmap\n                self.form.dialog.image_view.Image = highlight_bitmap\n\n    def OnMouseUp(self, e):\n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            if self.mouse_moved:\n                self.original_position = None\n                if self.form:\n                    selected_index = self.form.dialog.selected_button_index\n                    # Close the form first\n                    self.form.Close()\n                    self.form = None\n                    if selected_index is not None:\n                        Rhino.RhinoApp.WriteLine(\"Button {} was selected.\".format(selected_index))\n                        # Execute the corresponding Rhino command\n                        commands = [\"Point\", \"Polyline\", \"Box\", \"Sphere\", \"Cone\", \"Torus\", \"Polygon\", \"BooleanUnion\"]\n                        if selected_index < len(commands):\n                            Rhino.RhinoApp.RunScript(commands[selected_index], False)\n                        else:\n                            Rhino.RhinoApp.WriteLine(\"No command found for index {}.\".format(selected_index))\n            elif self.form:\n                # If mouse hasn't moved, close the form\n                self.form.Close()\n                self.form = None\n\n\ndef DoSomething():\n    if scriptcontext.sticky.has_key('MyMouseCallback'):\n        callback = scriptcontext.sticky['MyMouseCallback']\n        if callback:\n            callback.Enabled = False\n            callback = None\n            scriptcontext.sticky.Remove('MyMouseCallback')\n    else:\n        callback = MyMouseCallback()\n        callback.Enabled = True\n        scriptcontext.sticky['MyMouseCallback'] = callback\n        Rhino.RhinoApp.WriteLine(\"Click somewhere...\")\n\nif __name__ == \"__main__\":\n    DoSomething()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 88,
      "is_solution": false
    },
    {
      "code": "def OnMouseDown(self, e):    \n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            self.original_position = Rhino.UI.MouseCursor.Location\n            \n            self.form = SampleTransparentEtoForm()\n            \n            # subtract half form size from mouse down location\n            form_loc = drawing.Point(self.original_position.X-150, self.original_position.Y-150)\n            \n            self.form.Location = form_loc\n            self.form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n            self.form.Show()\n            \n            # prevent that the MMB Popup comes up\n            e.Cancel = True\n        else:\n            Rhino.RhinoApp.WriteLine(\"Failure...\")\n            return",
      "language": "python",
      "author": "clement",
      "post_number": 89,
      "is_solution": false
    },
    {
      "code": "private static void ApplyTransparency(Panel control, MonoMac.AppKit.NSWindow window)\n        {\n            control.BackgroundColor = Eto.Drawing.Colors.Transparent;\n            window.BackgroundColor = MonoMac.AppKit.NSColor.Clear;\n            \n            window.HasShadow = false;\n            window.Level = MonoMac.AppKit.NSWindowLevel.Floating;\n        }",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 48,
      "is_solution": false
    },
    {
      "code": "def MyTestStyler(self, control):\n    control.AllowsTransparency = True\n    control.Background = System.Windows.Media.Brushes.Transparent\n    control.BackgroundColor = Eto.Drawing.Colors.Transparent\n    control.Opacity = 0.0\n    control.WindowStyle = Eto.Forms.WindowStyle.Default\n    control.ShowActivated = False",
      "language": "python",
      "author": "clement",
      "post_number": 50,
      "is_solution": false
    },
    {
      "code": "void ApplyTransparency(Panel control, System.Windows.Window window)\n            {\n                control.BackgroundColor = Eto.Drawing.Colors.Transparent;\n                window.AllowsTransparency = true;\n                window.Background = System.Windows.Media.Brushes.Transparent;\n                window.Topmost = true;\n                window.ShowActivated = false;\n            }\n\n\n            Eto.Style.Add<Panel>(\n                        \"transparent\", control =>\n                        {\n                            var wpfWindow = (System.Windows.Window)control.ControlObject;\n                            ApplyTransparency(control, wpfWindow);\n                        });",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 28,
      "is_solution": false
    },
    {
      "code": "public static class StyleSetter2\n    {\n        public static void SetStyles()\n        {\n            Eto.Style.Add<Eto.Forms.Panel>(\"Transpar3\", control =>\n            {\n                var nsWindow = (MonoMac.AppKit.NSWindow)control.ControlObject;\n                ApplyTransparency(control, nsWindow);\n\n            });\n        }\n\n        private static void ApplyTransparency(Panel control, MonoMac.AppKit.NSWindow window)\n        {\n            control.BackgroundColor = Eto.Drawing.Colors.Transparent;\n            window.BackgroundColor = MonoMac.AppKit.NSColor.Clear;\n\n            window.HasShadow = false;\n            window.Level = MonoMac.AppKit.NSWindowLevel.Floating;\n        }\n    }",
      "language": "csharp",
      "author": "taraskydon",
      "post_number": 51,
      "is_solution": false
    },
    {
      "code": "private static void ApplyTransparency(Panel control, Eto.Mac.Forms.EtoWindow window)\n        {\n            control.BackgroundColor = Eto.Drawing.Colors.Transparent;\n            window.BackgroundColor = MonoMac.AppKit.NSColor.Clear;\n            \n            window.HasShadow = false;\n            window.Level = MonoMac.AppKit.NSWindowLevel.Floating;\n        }",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 52,
      "is_solution": false
    },
    {
      "code": "private void RenderMetal()\n        {\n            if (MetalLayer == null || GrContext == null) return;\n\n            var stopwatch = Stopwatch.StartNew();\n\n            // Get the current drawable\n            var drawable = MetalLayer.NextDrawable();\n            if (drawable != null)\n            {\n                var currentTexture = drawable.Texture; // Get Metal texture for drawing\n                // REMARK: We must create a new surface at each render loop. If we keep the same surface instance, the radial menu display is blinking (don't know why)\n                SkiaSurface?.Dispose();\n                // Create Skia surface from Metal texture\n                var backendRenderTarget = new GRBackendRenderTarget(\n                    (int)currentTexture.Width,\n                    (int)currentTexture.Height,\n                    1,\n                    new GRMtlTextureInfo(currentTexture));\n                SkiaSurface = SKSurface.Create(GrContext, backendRenderTarget, GRSurfaceOrigin.TopLeft, SKColorType.Rgba8888);\n                Logger.Debug($\"Render metal with center offsets X={DrawingOffset.X},Y={DrawingOffset.Y}\");\n                var canvas = SkiaSurface.Canvas;\n                canvas.Clear(SKColors.Transparent);\n\n                var stopwatchDrawing = Stopwatch.StartNew();\n                PointF center = new PointF((Width / 2.0f) + DrawingOffset.X, (Height / 2.0f) + DrawingOffset.Y);\n                DrawLevelsSkia(canvas, center);\n                stopwatchDrawing.Stop();\n                PerfLogger.Info($\"Surface creation execution time: {stopwatchDrawing.Elapsed.TotalMilliseconds:F2} ms\");\n\n                // Present the drawable\n                var stopwatchDisplaying = Stopwatch.StartNew();\n                GrContext.Flush();// Ensure everything is drawn\n                drawable.Present(); // draw Metal texture to the screen\n\n                stopwatchDisplaying.Stop();\n                PerfLogger.Info($\"Present metal execution time: {stopwatchDisplaying.Elapsed.TotalMilliseconds:F2} ms\");\n            }\n\n            stopwatch.Stop();\n            PerfLogger.Info($\"Render metal execution time: {stopwatch.Elapsed.TotalMilliseconds:F2} ms\");\n        }",
      "language": "csharp",
      "author": "Tigrou",
      "post_number": 206,
      "is_solution": false
    },
    {
      "code": "import Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\n\nclass EtoTransparentDialog(forms.Dialog[bool]):\n\n    def __init__(self):\n        self.Title = 'Transparency'\n        self.ClientSize = drawing.Size(400, 200)\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n        self.WindowStyle = forms.WindowStyle.Default\n        self.Opacity = .5\n\n        self.m_checkbox = forms.CheckBox(Text='Toggle Title Bar', Checked=True)\n        self.m_checkbox.CheckedChanged += self.OnCheckBoxChanged\n        self.m_slider = forms.Slider(MinValue=10, MaxValue=100, Value=50)\n        self.m_slider.ValueChanged += self.OnSliderChanged\n        self.DefaultButton = forms.Button(Text='EXIT')\n        self.DefaultButton.Click += self.OnOKButtonClick\n\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(5, 5)\n        layout.AddRow(self.m_checkbox)\n        layout.AddRow(self.m_slider)\n        layout.AddRow(self.DefaultButton)\n        self.Content = layout\n\n    def OnSliderChanged(self, sender, e):\n        self.Opacity = self.m_slider.Value * 0.01\n\n    def OnOKButtonClick(self, sender, e):\n        self.Close(False)\n\n    def OnCheckBoxChanged(self, sender, e):\n        if self.m_checkbox.Checked:\n            self.WindowStyle = forms.WindowStyle.Default\n        else:\n            self.WindowStyle = forms.WindowStyle.None\n\ndialog = EtoTransparentDialog()\ndialog.WindowStyle = forms.WindowStyle.None  # Set the WindowStyle to None to hide the title bar\nrc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 56,
      "is_solution": false
    },
    {
      "code": "using System;\nusing Eto.Forms;\nusing Eto.Drawing;\nusing SkiaSharp;\nusing Rhino.Commands;\nusing Rhino;\n\nnamespace SkiaSharpTest\n{\n    public class SkiaSharpTestCommand : Rhino.Commands.Command\n    {\n        public override string EnglishName => \"SkiaSharpTestCommand\";\n\n        protected override Result RunCommand(RhinoDoc doc, RunMode mode)\n        {\n            var form = new MainDialog();\n            form.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow);\n\n            return Result.Success;\n        }\n    }\n\n    public class MainDialog : Dialog\n    {\n        public MainDialog()\n        {\n            Title = \"SkiaSharp to Eto Test\";\n            ClientSize = new Size(400, 400);\n\n            Content = new SkiaCircleDrawable();\n        }\n    }\n\n    internal class SkiaCircleDrawable : Drawable\n    {\n        private SKBitmap skiaBitmap;\n        private Bitmap etoBitmap;\n        private bool bitmapNeedsUpdate = true;\n\n        public SkiaCircleDrawable()\n        {\n            skiaBitmap = new SKBitmap(400, 400);\n\n            using (SKCanvas canvas = new SKCanvas(skiaBitmap))\n            {\n                canvas.Clear(SKColors.White);\n\n                using (SKPaint paint = new SKPaint())\n                {\n                    paint.Color = SKColors.Red;\n                    paint.IsAntialias = true;\n                    paint.Style = SKPaintStyle.Fill;\n\n                    canvas.DrawCircle(200, 200, 150, paint);\n                }\n            }\n\n            UpdateEtoBitmap();\n\n            float radius = 150;\n            bool growing = true;\n\n            var timer = new UITimer();\n            timer.Interval = 0.016; // ~60fps\n            timer.Elapsed += (sender, e) => {\n                if (growing)\n                {\n                    radius += 2;\n                    if (radius >= 190) growing = false;\n                }\n                else\n                {\n                    radius -= 2;\n                    if (radius <= 100) growing = true;\n                }\n\n                AnimateCircle(radius);\n            };\n            timer.Start();\n        }\n\n        private void UpdateEtoBitmap()\n        {\n            if (skiaBitmap == null) \n                return;\n\n            if (etoBitmap == null)\n            {\n                etoBitmap = new Bitmap(\n                skiaBitmap.Width,\n                skiaBitmap.Height,\n                PixelFormat.Format32bppRgba);\n            }\n\n            using (var bitmapData = etoBitmap.Lock())\n            {\n                unsafe\n                {\n                    Buffer.MemoryCopy(\n                        skiaBitmap.GetPixels().ToPointer(),\n                        bitmapData.Data.ToPointer(),\n                        bitmapData.ScanWidth * skiaBitmap.Height,\n                        skiaBitmap.RowBytes * skiaBitmap.Height);\n                }\n            }\n\n            bitmapNeedsUpdate = false;\n        }\n\n        public void AnimateCircle(float radius)\n        {\n            using (SKCanvas canvas = new SKCanvas(skiaBitmap))\n            {\n                canvas.Clear(SKColors.White);\n\n                using (SKPaint paint = new SKPaint())\n                {\n                    paint.Color = SKColors.Red;\n                    paint.IsAntialias = true;\n                    paint.Style = SKPaintStyle.Fill;\n\n                    canvas.DrawCircle(200, 200, radius, paint);\n                }\n            }\n\n            bitmapNeedsUpdate = true;\n            Invalidate();\n        }\n\n        protected override void OnPaint(PaintEventArgs e)\n        {\n            base.OnPaint(e);\n\n            if (skiaBitmap == null) \n                return;\n\n            var sw = System.Diagnostics.Stopwatch.StartNew();\n\n            if (bitmapNeedsUpdate)\n                UpdateEtoBitmap();\n            \n            if (etoBitmap != null)\n                e.Graphics.DrawImage(etoBitmap, new PointF(0, 0));\n\n            sw.Stop();\n            Rhino.RhinoApp.WriteLine($\"Elapsed {sw.ElapsedMilliseconds} ms\");\n        }\n    }\n}",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 216,
      "is_solution": false
    },
    {
      "code": "using Eto.Forms;\nusing Eto.Drawing;\nusing SkiaSharp;\nusing Rhino.Commands;\nusing Rhino;\n\nnamespace SkiaSharpTest\n{\n    public class SkiaSharpTestCommand : Rhino.Commands.Command\n    {\n        public override string EnglishName => \"SkiaSharpTestCommand\";\n\n        protected override Result RunCommand(RhinoDoc doc, RunMode mode)\n        {\n            var form = new MainDialog();\n            form.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow);\n\n            return Result.Success;\n        }\n    }\n\n    public class MainDialog : Dialog\n    {\n        public MainDialog()\n        {\n            Title = \"SkiaSharp to Eto Test\";\n            ClientSize = new Size(400, 400);\n\n            Content = new SkiaCircleDrawable();\n        }\n    }\n\n    internal class SkiaCircleDrawable : Drawable\n    {\n        private Bitmap _etoBitmap;\n        private SKImageInfo _info;\n\n        public SkiaCircleDrawable()\n        {\n            _etoBitmap = new Bitmap(400, 400, PixelFormat.Format32bppRgba);\n            _info = new SKImageInfo(width: _etoBitmap.Width, height: _etoBitmap.Height, colorType: SKColorType.Bgra8888, alphaType: SKAlphaType.Premul);\n\n            float radius = 150;\n            bool growing = true;\n\n            DrawCircle(radius);\n\n            var timer = new UITimer();\n            timer.Interval = 0.016; // ~60fps\n            timer.Elapsed += (sender, e) => {\n                if (growing)\n                {\n                    radius += 2;\n                    if (radius >= 190) growing = false;\n                }\n                else\n                {\n                    radius -= 2;\n                    if (radius <= 100) growing = true;\n                }\n\n                AnimateCircle(radius);\n            };\n            timer.Start();\n        }\n\n        private void DrawCircle(float radius)\n        {\n            using (var bitmapData = _etoBitmap.Lock())\n            {\n                // Create a temporary SKSurface that draws directly to the Eto bitmap's pixel buffer\n                using (var surface = SKSurface.Create(\n                    info: _info,\n                    pixels: bitmapData.Data,\n                    rowBytes: bitmapData.ScanWidth,\n                    releaseProc: null,\n                    context: null))\n                {\n                    var canvas = surface.Canvas;\n\n                    canvas.Clear(SKColors.White);\n\n                    using (var paint = new SKPaint())\n                    {\n                        paint.Color = SKColors.Red;\n                        paint.IsAntialias = true;\n                        paint.Style = SKPaintStyle.Fill;\n\n                        canvas.DrawCircle(200, 200, radius, paint);\n                    }\n                    canvas.Flush();\n                }\n            }\n        }\n\n        public void AnimateCircle(float radius)\n        {\n            DrawCircle(radius);\n            Invalidate();\n        }\n\n        protected override void OnPaint(PaintEventArgs e)\n        {\n            base.OnPaint(e);\n\n            var sw = System.Diagnostics.Stopwatch.StartNew();\n            e.Graphics.DrawImage(_etoBitmap, new PointF(0, 0));\n            sw.Stop();\n            Rhino.RhinoApp.WriteLine($\"Elapsed {sw.ElapsedMilliseconds} ms\");\n        }\n    }\n}",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 218,
      "is_solution": false
    },
    {
      "code": "public class SampleTransparentEtoForm : Form\n{\n    public SampleTransparentEtoForm()\n    {\n        WindowStyle = WindowStyle.None;\n        Style = \"sampleTransparent\";\n        AutoSize = false;\n        Resizable = true;\n        Topmost = true;\n        ShowActivated = false;\n        Size = new Size(300, 300);\n        Padding = new Padding(80);\n        MovableByWindowBackground = true;\n        Location = new Point(100, 100);\n        Button button = new Button() { Text = \"Hello World\" };\n\n        var layout = new DynamicLayout();\n        layout.AddRow(button);\n        Content = layout;\n    }\n}\n\n private static void MyFormStyler(Control control)\n {\n     control.BackgroundColor = Eto.Drawing.Colors.Transparent;\n     var window = control.ControlObject;\n\n     if (window != null)\n     {\n         PropertyInfo allowsTransparencyProperty = window.GetType().GetProperty(\"AllowsTransparency\");\n         if (allowsTransparencyProperty != null)\n             allowsTransparencyProperty.SetValue(window, true);\n\n         PropertyInfo backgroundProperty = window.GetType().GetProperty(\"Background\");\n         if (backgroundProperty != null)\n         {\n             dynamic brush = backgroundProperty.GetValue(window);\n             if (brush != null)\n             {\n                 dynamic clonedBrush = brush.Clone();\n                 clonedBrush.Opacity = 0.1;\n                 backgroundProperty.SetValue(window, clonedBrush);\n             }\n         }\n         else\n         {\n             PropertyInfo backgroundColorProperty = window.GetType().GetProperty(\"BackgroundColor\");\n             if (backgroundColorProperty != null)\n             {\n                 backgroundColorProperty.SetValue(window, new Eto.Drawing.Color(0, 0, 0, 25));\n             }\n         }\n     }\n }",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 66,
      "is_solution": false
    },
    {
      "code": "import Eto.Forms as forms\nimport Eto.Drawing as drawing\nimport System\nimport Rhino.UI\nimport math\n\nclass CircleProperties:\n    def __init__(self, icon_path=\"\"):\n        self.fill_color = drawing.Colors.White\n        self.border_color = None  # Will be set dynamically\n        self.highlight_color = drawing.Colors.Orange\n        self.icon_path = icon_path  # Icon path attribute with a default value of \"\"\n\nclass TransparentForm(forms.Form):\n    def __init__(self):\n        self.Title = \"PIE Menu 0.1\"\n        self.WindowStyle = forms.WindowStyle.None\n        self.AutoSize = False\n        self.Resizable = False\n        self.TopMost = True\n        self.ShowActivated = False\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(20)\n        self.MovableByWindowBackground = False\n\n        # Initialize circle properties list with icon paths\n        icon_paths = [\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        \"user_set_path\",\n        ]\n        self.circle_properties = [CircleProperties(icon_path) for icon_path in icon_paths]\n\n        self.form_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n        self.DrawCirclesOnBitmap(self.form_bitmap, None)\n\n        self.image_view = forms.ImageView()\n        self.image_view.Image = self.form_bitmap\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.image_view)\n        self.Content = layout\n\n        self.selected_button_index = None  # Initialize selected button index variable\n\n        # Add transparent style\n        self.Styles.Add[forms.Panel](\"transparent\", self.MyFormStyler)\n        self.Style = \"transparent\"\n        \n    def DrawCirclesOnBitmap(self, bitmap, pointed_circle_index):\n        # Clear the bitmap\n        graphics = drawing.Graphics(bitmap)\n        graphics.Clear(drawing.Colors.Transparent)\n\n        circle_radius = 100\n        num_circles = 8\n        button_radius = 35\n\n        center_x = bitmap.Size.Width / 2\n        center_y = bitmap.Size.Height / 2\n\n        for i, properties in enumerate(self.circle_properties):\n            angle = (2 * math.pi / num_circles) * i\n            circle_center_x = center_x + circle_radius * math.cos(angle)\n            circle_center_y = center_y + circle_radius * math.sin(angle)\n            circle_position = drawing.Point(circle_center_x - button_radius, circle_center_y - button_radius)\n            circle_size = drawing.Size(2 * button_radius, 2 * button_radius)\n          \n            circ_brush = drawing.SolidBrush(properties.fill_color)  # Use circle properties\n\n            highlight_color = drawing.Colors.Orange  # Set the highlight color\n            border_color = drawing.Colors.LightGrey  # Assign a unique border color for each circle\n            \n            if i == pointed_circle_index:\n                border_pen = drawing.Pen(highlight_color, 10)\n                self.selected_button_index = i  # Update selected button index\n            else:\n                border_pen = drawing.Pen(border_color, 5)\n\n            graphics.FillEllipse(circ_brush, drawing.Rectangle(circle_position, circle_size))\n            graphics.DrawEllipse(border_pen, drawing.Rectangle(circle_position, circle_size)) \n            # Draw the image\n            icon_bitmap = drawing.Bitmap(properties.icon_path)\n            graphics.DrawImage(icon_bitmap, circle_center_x - 25, circle_center_y - 25, 50, 50)\n\n        graphics.Dispose()\n\n    def MyFormStyler(self, control):\n        self.BackgroundColor = drawing.Colors.Transparent\n        window = control.ControlObject\n        if hasattr(window, \"AllowsTransparency\"):\n            window.AllowsTransparency = True\n        if hasattr(window, \"Background\"):\n            brush = window.Background.Clone()\n            brush.Opacity = 0  # Adjust opacity as needed\n            window.Background = brush\n        else:\n            color = window.BackgroundColor\n            window.BackgroundColor = color.FromRgba(0, 0, 0, 0)\n\n    def Cleanup(self):\n        # Close the form if it's shown\n        if self.Visible:\n            self.Close()\n        \n        # Dispose of the form's resources\n        self.Dispose()\n\nclass MyMouseCallback(Rhino.UI.MouseCallback):\n    def __init__(self):\n        self.original_position = None\n        self.form = None\n        self.mouse_moved = False\n\n    def OnMouseDown(self, e):\n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            Rhino.RhinoApp.WriteLine(\"MMB Down\")\n            if self.form:\n                self.form.Cleanup()  # Clean up any existing UI\n            self.original_position = Rhino.UI.MouseCursor.Location\n            self.form = TransparentForm()\n            form_loc = drawing.Point(self.original_position.X - 150, self.original_position.Y - 150)\n            Rhino.RhinoApp.WriteLine(str(form_loc))\n            self.form.Location = form_loc\n            self.form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n            self.form.Show()\n\n    def OnMouseMove(self, e):\n        if self.original_position:\n            current_position = Rhino.UI.MouseCursor.Location\n            \n            if current_position != self.original_position:\n                self.mouse_moved = True\n\n                vector_x = current_position.X - self.original_position.X\n                vector_y = current_position.Y - self.original_position.Y\n\n                angle = math.atan2(vector_y, vector_x)\n                angle_degrees = math.degrees(angle)\n                \n                if angle_degrees < 0:\n                    angle_degrees += 360\n                \n                num_circles = 8\n                pointed_circle_index = int(angle_degrees / (360 / num_circles))\n                # Rhino.RhinoApp.WriteLine(\"Button Index: \"+ str(pointed_circle_index) )\n\n                # Create a new bitmap for highlighting\n                highlight_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n                # Call the DrawCirclesOnBitmap method with the highlighted circle\n                self.form.DrawCirclesOnBitmap(highlight_bitmap, pointed_circle_index)\n                # Update the ImageView with the new highlight_bitmap\n                self.form.image_view.Image = highlight_bitmap\n\n    def OnMouseUp(self, e):\n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            if self.mouse_moved:\n                self.original_position = None\n                if self.form:\n                    selected_index = self.form.selected_button_index\n                    # Close the form first\n                    self.form.Close()\n                    self.form = None\n                    if selected_index is not None:\n                        # Execute the corresponding Rhino command\n                        commands = [\"Floor\", \"Wall\", \"Door\", \"Window\", \"Electrical\", \"Plumbing\", \"Object\", \"Room\"]\n                        Rhino.RhinoApp.WriteLine(\"Running {} tool...\".format(commands[selected_index]))\n                        if selected_index < len(commands):\n                            Rhino.RhinoApp.RunScript(commands[selected_index], False)\n                        else:\n                            Rhino.RhinoApp.WriteLine(\"No command found for index {}.\".format(selected_index))\n            elif self.form:\n                # If mouse hasn't moved, close the form\n                self.form.Close()\n                self.form = None\n\n\ndef DoSomething():\n    if scriptcontext.sticky.has_key('MyMouseCallback'):\n        callback = scriptcontext.sticky['MyMouseCallback']\n        if callback:\n            callback.Enabled = False\n            callback = None\n            scriptcontext.sticky.Remove('MyMouseCallback')\n    else:\n        callback = MyMouseCallback()\n        callback.Enabled = True\n        scriptcontext.sticky['MyMouseCallback'] = callback\n        Rhino.RhinoApp.WriteLine(\"Click somewhere...\")\n\nif __name__ == \"__main__\":\n    DoSomething()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 94,
      "is_solution": false
    },
    {
      "code": "if (_drawShadow)\n {\n     canvas.Save();\n     canvas.Translate(12 * _screenScale, 12 * _screenScale);\n     var shadowFilter = SKImageFilter.CreateDropShadowOnly(\n         dx: 12 * _screenScale,\n         dy: 12 * _screenScale,\n         sigmaX: 6 * _screenScale,\n         sigmaY: 8 * _screenScale,\n         color: SKColors.Black.WithAlpha(120)\n         );\n     using (var shadowPaint = new SKPaint\n     {\n         ImageFilter = shadowFilter,\n         Style = SKPaintStyle.Fill,\n         Color = SKColors.Black.WithAlpha(120)\n     })\n     {\n         canvas.DrawPath(path, shadowPaint);\n     }\n     canvas.Restore();\n }",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 224,
      "is_solution": false
    },
    {
      "code": "if (_drawShadow)\n {\n     canvas.Save();\n     canvas.Translate(12 * _screenScale, 12 * _screenScale);\n     using (var shadowPaint = new SKPaint\n     {\n         Style = SKPaintStyle.Fill,\n         Color = SKColors.Black.WithAlpha(120)\n     })\n     {\n         canvas.DrawPath(path, shadowPaint);\n     }\n     canvas.Restore();\n }",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 224,
      "is_solution": false
    },
    {
      "code": "using System.Diagnostics;\nusing Eto.Forms;\nusing Eto.Drawing;\nusing SkiaSharp;\nusing Rhino.Commands;\nusing Rhino;\n\nnamespace SkiaSharpTest\n{\n    public class SkiaSharpTestCommand : Rhino.Commands.Command\n    {\n        public override string EnglishName => \"SkiaSharpTestCommand\";\n\n        protected override Result RunCommand(RhinoDoc doc, RunMode mode)\n        {\n            var form = new MainDialog();\n            form.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow);\n            return Result.Success;\n        }\n    }\n\n    public class MainDialog : Dialog\n    {\n        public MainDialog()\n        {\n            Title = \"SkiaSharp Animated Rings\";\n            ClientSize = new Size(1200, 1200);\n            Location = new Point(0, 0);\n            Content = new SkiaRingsDrawable();\n        }\n    }\n\n\ninternal class SkiaRingsDrawable : Drawable\n    {\n        private Bitmap _etoBitmap;\n        private SKImageInfo _info;\n        private int _numLevels = 20;\n        private float _centerX = 600;\n        private float _centerY = 600;\n        private float _baseInnerRadius = 10;\n        private float _ringWidth = 50;\n        private bool _drawShadow = true;\n        private float _screenScale = 1.0f;\n\n        private SKImageFilter _shadowFilter;\n\n        private GRContext _grContext;\n\n        // Animation variables\n        private float _radiusOffset = 0f;\n        private float _offsetIncrement = 0.2f;\n        private float _maxOffset = 10f;\n        private bool _expanding = true;\n\n        private UITimer _timer;\n\n        public SkiaRingsDrawable()\n        {\n            _etoBitmap = new Bitmap(1200, 1200, PixelFormat.Format32bppRgba);\n            _info = new SKImageInfo(\n                width: _etoBitmap.Width,\n                height: _etoBitmap.Height,\n                colorType: SKColorType.Bgra8888,\n                alphaType: SKAlphaType.Premul\n            );\n\n            _grContext = GRContext.CreateGl();\n\n            _shadowFilter = SKImageFilter.CreateDropShadowOnly(\n                dx: 12 * _screenScale,\n                dy: 12 * _screenScale,\n                sigmaX: 6 * _screenScale,\n                sigmaY: 8 * _screenScale,\n                color: SKColors.Black.WithAlpha(120)\n            );\n\n            _timer = new UITimer();\n            _timer.Interval = 0.016;\n            _timer.Elapsed += (sender, e) =>\n            {\n                UpdateAnimation();\n                DrawRings();\n                Invalidate();\n            };\n            _timer.Start();\n\n            this.UnLoad += (sender, e) =>\n            {\n                _timer.Stop();\n                _shadowFilter?.Dispose();\n                _grContext?.Dispose();\n            };\n        }\n\n        private void UpdateAnimation()\n        {\n            if (_expanding)\n            {\n                _radiusOffset += _offsetIncrement;\n                if (_radiusOffset >= _maxOffset)\n                {\n                    _radiusOffset = _maxOffset;\n                    _expanding = false;\n                }\n            }\n            else\n            {\n                _radiusOffset -= _offsetIncrement;\n                if (_radiusOffset <= 0)\n                {\n                    _radiusOffset = 0;\n                    _expanding = true;\n                }\n            }\n        }\n\n        private void DrawRings()\n        {\n            var stopwatch = Stopwatch.StartNew();\n\n            using (var bitmapData = _etoBitmap.Lock())\n            {\n                // Create a hardware-accelerated surface\n                using (var surface = SKSurface.Create(_grContext, false, _info))\n                {\n                    var canvas = surface.Canvas;\n                    canvas.Clear(SKColors.White);\n\n                    using (var fillPaint = new SKPaint { Style = SKPaintStyle.Fill })\n                    {\n                        for (int level = 0; level < _numLevels; level++)\n                        {\n                            float animatedRingWidth = _ringWidth + _radiusOffset;\n                            float innerRadius = _baseInnerRadius + level * animatedRingWidth;\n                            float outerRadius = innerRadius + animatedRingWidth;\n\n                            using (var path = new SKPath())\n                            {\n                                path.AddCircle(_centerX, _centerY, outerRadius);\n                                path.AddCircle(_centerX, _centerY, innerRadius);\n                                path.FillType = SKPathFillType.EvenOdd;\n\n                                if (_drawShadow)\n                                {\n                                    canvas.Save();\n                                    canvas.Translate(12 * _screenScale, 12 * _screenScale);\n\n                                    using (var shadowPaint = new SKPaint\n                                    {\n                                        ImageFilter = _shadowFilter,\n                                        Style = SKPaintStyle.Fill,\n                                        Color = SKColors.Black.WithAlpha(120)\n                                    })\n                                    {\n                                        canvas.DrawPath(path, shadowPaint);\n                                    }\n                                    canvas.Restore();\n                                }\n\n                                SKColor currentColor = (level % 2 == 0) ? SKColors.Blue : SKColors.Red;\n                                fillPaint.Color = currentColor;\n                                canvas.DrawPath(path, fillPaint);\n                            }\n                        }\n                    }\n\n                    canvas.Flush();\n\n                    using (var image = surface.Snapshot())\n                    {\n                        image.ReadPixels(_info, bitmapData.Data, bitmapData.ScanWidth, 0, 0);\n                    }\n                }\n            }\n\n            stopwatch.Stop();\n            Rhino.RhinoApp.WriteLine($\"Frame render time: {stopwatch.Elapsed.TotalMilliseconds:F2} ms\");\n        }\n\n        protected override void OnPaint(PaintEventArgs e)\n        {\n            base.OnPaint(e);\n            e.Graphics.DrawImage(_etoBitmap, new PointF(0, 0));\n        }\n    }\n}",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 226,
      "is_solution": false
    },
    {
      "code": "private void MyFormStyler(Control control)\n        {\n            BackgroundColor = Colors.Transparent;\n            var window = control.ControlObject as System.Windows.Window;\n\n            if (window != null)\n            {\n                window.AllowsTransparency = true;\n\n                if (window.Background != null)\n                {\n                    var brush = window.Background.Clone();\n                    brush.Opacity = 0.0;\n                    window.Background = brush;\n                }\n                else\n                {\n                    var color = Color.FromArgb(0, 0, 0, 0);\n                    BackgroundColor = color;\n                }\n            }\n        }",
      "language": "csharp",
      "author": "taraskydon",
      "post_number": 70,
      "is_solution": false
    },
    {
      "code": "import Eto.Forms as forms\nimport Eto.Drawing as drawing\nimport System\nimport Rhino.UI\nimport math\n\nclass TransparentDialog(forms.Dialog[bool]):\n    def __init__(self):\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(5)\n        self.Opacity = 1  \n\n        circle_radius = 100\n        num_circles = 8\n        button_radius = 35\n\n        bitmap = drawing.Bitmap(self.Size, drawing.PixelFormat.Format32bppRgba)\n        graphics = drawing.Graphics(bitmap)\n\n        circle_fill_color = drawing.Colors.White\n        circle_border_color = drawing.Colors.Gray\n        circ_brush = drawing.SolidBrush(circle_fill_color)\n        border_pen = drawing.Pen(circle_border_color, 2)\n\n        center_x = self.Size.Width / 2\n        center_y = self.Size.Height / 2\n\n        for i in range(num_circles):\n            angle = (2 * math.pi / num_circles) * i\n            circle_center_x = center_x + circle_radius * math.cos(angle)\n            circle_center_y = center_y + circle_radius * math.sin(angle)\n            circle_position = drawing.Point(circle_center_x - button_radius, circle_center_y - button_radius)\n            circle_size = drawing.Size(2 * button_radius, 2 * button_radius)\n            graphics.FillEllipse(circle_fill_color, drawing.Rectangle(circle_position, circle_size))\n            graphics.DrawEllipse(border_pen, drawing.Rectangle(circle_position, circle_size))\n\n        graphics.Dispose()\n\n        self.image_view = forms.ImageView()\n        self.image_view.Image = bitmap\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.image_view)\n        self.Content = layout\n\n        # Variable to store the index of the circle \"pointed to\" by the mouse\n        self.pointed_circle_index = None\n\n        self.Title = \"Transparent Circle Array\"\n\nclass SampleTransparentEtoForm(forms.Form):\n    def __init__(self):\n        self.WindowStyle = forms.WindowStyle.None\n        \n        self.Styles.Add[forms.Panel](\"transparent\", self.MyFormStyler)\n        self.Style = \"transparent\"\n        \n        self.AutoSize = False\n        self.Resizable = True\n        self.TopMost = True\n        self.ShowActivated = False\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(20)\n        self.MovableByWindowBackground = True\n        self.Location = drawing.Point(100, 100)\n\n        self.close_button = forms.Button(Text=\"Close\")\n        self.close_button.Click += self.OnCloseButtonClick\n\n        self.dialog = TransparentDialog()\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.close_button)\n        layout.AddRow(self.dialog.Content)\n\n        self.Content = layout\n\n    def MyFormStyler(self, control):\n        self.BackgroundColor = drawing.Colors.Transparent\n        window = control.ControlObject\n        if hasattr(window, \"AllowsTransparency\"):\n            window.AllowsTransparency = True\n        if hasattr(window, \"Background\"):\n            brush = window.Background.Clone()\n            brush.Opacity = 0\n            window.Background = brush\n        else:\n            color = window.BackgroundColor\n            window.BackgroundColor = color.FromRgba(0, 0, 0, 0)\n\n    def OnCloseButtonClick(self, sender, e):\n        Rhino.RhinoApp.WriteLine(\"Closing dialog...\")\n        self.Close()\n\nclass MyMouseCallback(Rhino.UI.MouseCallback):\n    def __init__(self):\n        self.original_position = None\n    \n    def OnMouseDown(self, e):    \n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            self.original_position = Rhino.UI.MouseCursor.Location\n            \n            Rhino.RhinoApp.WriteLine(\"Mouse X: {}, Mouse Y: {}\".format(self.original_position.X, self.original_position.Y))        \n            Rhino.RhinoApp.WriteLine(\"Initializing dialog...\")\n\n            form = SampleTransparentEtoForm()\n            form_loc = drawing.Point(self.original_position.X, self.original_position.Y)\n            form.Location = form_loc\n            form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n            form.Show()\n        else:\n            Rhino.RhinoApp.WriteLine(\"Failure...\")\n            return\n\n    def OnMouseMove(self, e):\n        if self.original_position:\n            current_position = Rhino.UI.MouseCursor.Location\n            \n            vector_x = current_position.X - self.original_position.X\n            vector_y = current_position.Y - self.original_position.Y\n\n            # Calculate the angle of the vector relative to the positive x-axis\n            angle = math.atan2(vector_y, vector_x)\n            \n            # Convert the angle to degrees\n            angle_degrees = math.degrees(angle)\n            \n            # Ensure the angle is positive and between 0 and 360 degrees\n            if angle_degrees < 0:\n                angle_degrees += 360\n            \n            # Calculate the circle index based on the angle\n            num_circles = 8\n            circle_index = int(angle_degrees / (360 / num_circles))\n\n            Rhino.RhinoApp.WriteLine(\"Angle: {}, Circle Index: {}\".format(angle_degrees, circle_index))\n\n\n\n    def OnMouseUp(self, e):\n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            Rhino.RhinoApp.WriteLine(\"Middle Mouse Up\")\n            self.original_position = None\n        else:\n            Rhino.RhinoApp.WriteLine(\"Other mouse up\")\n\ndef DoSomething():\n    if scriptcontext.sticky.has_key('MyMouseCallback'):\n        callback = scriptcontext.sticky['MyMouseCallback']\n        if callback:\n            callback.Enabled = False\n            callback = None\n            scriptcontext.sticky.Remove('MyMouseCallback')\n    else:\n        callback = MyMouseCallback()\n        callback.Enabled = True\n        scriptcontext.sticky['MyMouseCallback'] = callback\n        Rhino.RhinoApp.WriteLine(\"Click somewhere...\")\n\nif __name__ == \"__main__\":\n    DoSomething()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 78,
      "is_solution": false
    },
    {
      "code": "using System.Diagnostics;\nusing Eto.Forms;\nusing Eto.Drawing;\nusing SkiaSharp;\nusing Rhino.Commands;\nusing Rhino;\n\nnamespace SkiaSharpTest\n{\n    public class SkiaSharpTestCommand : Rhino.Commands.Command\n    {\n        public override string EnglishName => \"SkiaSharpTestCommand\";\n\n        protected override Result RunCommand(RhinoDoc doc, RunMode mode)\n        {\n            var form = new MainDialog();\n            form.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow);\n            return Result.Success;\n        }\n    }\n\n    public class MainDialog : Dialog\n    {\n        public MainDialog()\n        {\n            Title = \"SkiaSharp Animated Rings\";\n            ClientSize = new Size(1000, 1000);\n            Location = new Point(0, 0);\n            Content = new SkiaRingsDrawable();\n        }\n    }\n\n\n    internal class SkiaRingsDrawable : Drawable\n    {\n        private Bitmap _etoBitmap;\n        private SKImageInfo _info;\n        private int _numLevels = 10;\n        private float _centerX = 500;\n        private float _centerY = 500;\n        private float _baseInnerRadius = 10;\n        private float _ringWidth = 40;\n        private bool _drawShadow = true;\n        private float _screenScale = 1.0f;\n\n        private SKImageFilter _shadowFilter;\n\n        private GRContext _grContext;\n\n        // Animation variables\n        private float _radiusOffset = 0f;\n        private float _offsetIncrement = 0.2f;\n        private float _maxOffset = 10f;\n        private bool _expanding = true;\n\n        private UITimer _timer;\n\n        private SKPaint _fillPaint = new SKPaint { Style = SKPaintStyle.Fill, IsAntialias = true };\n        private SKPaint _shadowPaint;\n\n        public SkiaRingsDrawable()\n        {\n            _etoBitmap = new Bitmap(1000, 1000, PixelFormat.Format32bppRgba);\n            _info = new SKImageInfo(\n                width: _etoBitmap.Width,\n                height: _etoBitmap.Height,\n                colorType: SKColorType.Bgra8888,\n                alphaType: SKAlphaType.Premul\n            );\n\n            _grContext = GRContext.CreateGl();\n\n            _shadowFilter = SKImageFilter.CreateDropShadowOnly(\n                dx: 12 * _screenScale,\n                dy: 12 * _screenScale,\n                sigmaX: 8 * _screenScale,\n                sigmaY: 8 * _screenScale,\n                color: SKColors.Black.WithAlpha(120)\n            );\n\n            _shadowPaint = new SKPaint\n            {\n                ImageFilter = _shadowFilter,\n                IsAntialias = true,\n                Style = SKPaintStyle.Fill,\n            };\n\n            _timer = new UITimer();\n            _timer.Interval = 0.016;\n            _timer.Elapsed += (sender, e) =>\n            {\n                UpdateAnimation();\n                DrawRings();\n                Invalidate();\n            };\n            _timer.Start();\n\n            this.UnLoad += (sender, e) =>\n            {\n                _timer.Stop();\n                _shadowFilter?.Dispose();\n                _grContext?.Dispose();\n            };\n        }\n\n        private void UpdateAnimation()\n        {\n            if (_expanding)\n            {\n                _radiusOffset += _offsetIncrement;\n                if (_radiusOffset >= _maxOffset)\n                {\n                    _radiusOffset = _maxOffset;\n                    _expanding = false;\n                }\n            }\n            else\n            {\n                _radiusOffset -= _offsetIncrement;\n                if (_radiusOffset <= 0)\n                {\n                    _radiusOffset = 0;\n                    _expanding = true;\n                }\n            }\n        }\n\n        private void DrawRings()\n        {\n            var stopwatch = Stopwatch.StartNew();\n\n            using (var bitmapData = _etoBitmap.Lock())\n            {\n                // Create a hardware-accelerated surface\n                using (var surface = SKSurface.Create(_grContext, false, _info))\n                {\n                    var canvas = surface.Canvas;\n                    canvas.Clear(SKColors.White);\n\n                    for (int level = 0; level < _numLevels; level++)\n                    {\n                        float animatedRingWidth = _ringWidth + _radiusOffset;\n                        float innerRadius = _baseInnerRadius + level * animatedRingWidth;\n                        float outerRadius = innerRadius + animatedRingWidth;\n\n                        using (var path = new SKPath())\n                        {\n                            path.AddCircle(_centerX, _centerY, outerRadius);\n                            path.AddCircle(_centerX, _centerY, innerRadius);\n                            path.FillType = SKPathFillType.EvenOdd;\n\n                            if (_drawShadow)\n                                canvas.DrawPath(path, _shadowPaint);\n\n                            _fillPaint.Color = (level % 2 == 0) ? SKColors.Blue : SKColors.Red;\n                            canvas.DrawPath(path, _fillPaint);\n                        }\n                    }\n\n                    canvas.Flush();\n                    surface.ReadPixels(_info, bitmapData.Data, bitmapData.ScanWidth, 0, 0);\n                }\n            }\n\n            stopwatch.Stop();\n            Rhino.RhinoApp.WriteLine($\"Frame render time: {stopwatch.Elapsed.TotalMilliseconds:F2} ms\");\n        }\n\n        protected override void OnPaint(PaintEventArgs e)\n        {\n            base.OnPaint(e);\n            e.Graphics.DrawImage(_etoBitmap, new PointF(0, 0));\n        }\n    }\n}",
      "language": "csharp",
      "author": "mrhe",
      "post_number": 228,
      "is_solution": false
    },
    {
      "code": "import Eto.Forms as forms\nimport Eto.Drawing as drawing\nimport System\nimport Rhino.UI\nimport math\n\nclass TransparentDialog(forms.Dialog[bool]):\n    def __init__(self):\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(5)\n        self.Opacity = 1  \n\n        self.dialog_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n        self.DrawCirclesOnBitmap(self.dialog_bitmap)\n\n        # Add an extra bitmap for the highlighted circle\n        self.highlight_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n        \n        self.image_view = forms.ImageView()\n        self.image_view.Image = self.dialog_bitmap\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.image_view)\n        self.Content = layout\n\n        # Variable to store the index of the circle \"pointed to\" by the mouse\n        self.pointed_circle_index = None\n\n        self.Title = \"PIE Menu 0.1\"\n\n        # Add an extra bitmap for the highlighted circle\n        self.highlight_bitmap = drawing.Bitmap(drawing.Size(300, 300), drawing.PixelFormat.Format32bppRgba)\n\n    def DrawCirclesOnBitmap(self, bitmap):\n        circle_radius = 100\n        num_circles = 8\n        button_radius = 35\n\n        graphics = drawing.Graphics(bitmap)\n        circle_fill_color = drawing.Colors.White\n        circle_border_color = drawing.Colors.Gray\n        circ_brush = drawing.SolidBrush(circle_fill_color)\n        border_pen = drawing.Pen(circle_border_color, 2)\n\n        center_x = bitmap.Size.Width / 2\n        center_y = bitmap.Size.Height / 2\n\n        for i in range(num_circles):\n            angle = (2 * math.pi / num_circles) * i\n            circle_center_x = center_x + circle_radius * math.cos(angle)\n            circle_center_y = center_y + circle_radius * math.sin(angle)\n            circle_position = drawing.Point(circle_center_x - button_radius, circle_center_y - button_radius)\n            circle_size = drawing.Size(2 * button_radius, 2 * button_radius)\n            graphics.FillEllipse(circle_fill_color, drawing.Rectangle(circle_position, circle_size))\n            graphics.DrawEllipse(border_pen, drawing.Rectangle(circle_position, circle_size))    \n\n        graphics.Dispose()\n\nclass SampleTransparentEtoForm(forms.Form):\n    def __init__(self):\n        self.WindowStyle = forms.WindowStyle.None\n        \n        self.Styles.Add[forms.Panel](\"transparent\", self.MyFormStyler)\n        self.Style = \"transparent\"\n        \n        self.AutoSize = False\n        self.Resizable = True\n        self.TopMost = True\n        self.ShowActivated = False\n        self.Size = drawing.Size(300, 300)\n        self.Padding = drawing.Padding(20)\n        self.MovableByWindowBackground = True\n\n        self.close_button = forms.Button(Text=\"Close\")\n        self.close_button.Click += self.OnCloseButtonClick\n\n        self.dialog = TransparentDialog()\n\n        layout = forms.DynamicLayout()\n        # layout.AddRow(self.close_button)\n        layout.AddRow(self.dialog.Content)\n\n        self.Content = layout\n\n    def MyFormStyler(self, control):\n        self.BackgroundColor = drawing.Colors.Transparent\n        window = control.ControlObject\n        if hasattr(window, \"AllowsTransparency\"):\n            window.AllowsTransparency = True\n        if hasattr(window, \"Background\"):\n            brush = window.Background.Clone()\n            brush.Opacity = 0\n            window.Background = brush\n        else:\n            color = window.BackgroundColor\n            window.BackgroundColor = color.FromRgba(0, 0, 0, 0)\n\n    def OnCloseButtonClick(self, sender, e):\n        # Rhino.RhinoApp.WriteLine(\"Closing dialog...\")\n        self.Close()\n\nclass MyMouseCallback(Rhino.UI.MouseCallback):\n    def __init__(self):\n        self.original_position = None\n        self.form = None\n        self.circle_centers = []  # List to store the center positions\n\n    def OnMouseDown(self, e):    \n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            self.original_position = Rhino.UI.MouseCursor.Location\n            Rhino.RhinoApp.WriteLine(\"Mouse X: {}, Mouse Y: {}\".format(self.original_position.X, self.original_position.Y))        \n            # Rhino.RhinoApp.WriteLine(\"Initializing dialog...\")\n            \n            self.form = SampleTransparentEtoForm()\n            form_loc = drawing.Point(self.original_position.X, self.original_position.Y)\n            self.form.Location = form_loc\n            self.form.Owner = Rhino.UI.RhinoEtoApp.MainWindow\n            self.form.Show()\n\n        else:\n            Rhino.RhinoApp.WriteLine(\"Failure...\")\n            return\n\n    def DrawCircleHighlight(self, circle_index, circle_centers):\n        Rhino.RhinoApp.WriteLine(\"Drawing Circle Highlight...\")\n        Rhino.RhinoApp.WriteLine(\"Button Index: \" + str(circle_index))\n    \n        if self.form and self.highlight_bitmap:\n            Rhino.RhinoApp.WriteLine(\"Highlight Bitmap Exists...\")\n            graphics = drawing.Graphics(self.highlight_bitmap)\n            highlight_pen = drawing.Pen(drawing.Colors.Orange, 6) # Highlight Pen\n            highlight_radius = 38  # Larger radius for the highlight circle\n            \n            # Retrieve the center position based on the circle index\n            circle_center_x, circle_center_y = circle_centers[circle_index]\n            Rhino.RhinoApp.WriteLine(str(circle_centers[circle_index]))\n            \n            highlight_position = drawing.Point(circle_center_x - highlight_radius, circle_center_y - highlight_radius)\n            highlight_circle_size = drawing.Size(2 * highlight_radius, 2 * highlight_radius)\n\n            # Draw Highlight around current circle at index\n            graphics.DrawEllipse(highlight_pen, drawing.Rectangle(highlight_position, highlight_circle_size))\n\n            graphics.Dispose()\n\n        else:\n            Rhino.RhinoApp.WriteLine(\"Form or Highlight Bitmap is None...\")\n\n    def DrawDialog(self):\n        # Draw the radial array of circles\n        self.DrawCirclesOnBitmap(self.dialog_bitmap)\n        \n        # Draw the highlighted circle on top\n        self.DrawCircleHighlight(self.pointed_circle_index)\n        \n        # Composite the bitmaps together if needed\n        \n        # Update the image view with the combined bitmap\n        combined_bitmap = CombineBitmaps(self.dialog_bitmap, self.highlight_bitmap)\n        self.image_view.Image = combined_bitmap\n\n    def CombineBitmaps(background_bitmap, overlay_bitmap):\n        # Combine the two bitmaps into one, preserving the background\n        combined_bitmap = background_bitmap.Clone()\n        graphics = drawing.Graphics(combined_bitmap)\n        graphics.DrawImage(overlay_bitmap, drawing.Point(0, 0))\n        graphics.Dispose()\n        return combined_bitmap\n\n    def OnMouseMove(self, e):\n        if self.original_position:\n            current_position = Rhino.UI.MouseCursor.Location\n            \n            vector_x = current_position.X - self.original_position.X\n            vector_y = current_position.Y - self.original_position.Y\n\n            # Calculate the angle of the vector relative to the positive x-axis\n            angle = math.atan2(vector_y, vector_x)\n            \n            # Convert the angle to degrees\n            angle_degrees = math.degrees(angle)\n            \n            # Ensure the angle is positive and between 0 and 360 degrees\n            if angle_degrees < 0:\n                angle_degrees += 360\n            \n            # Round the angle to the nearest whole number for printing\n            rounded_angle_degrees = round(angle_degrees)\n            \n            # Calculate the circle index based on the angle\n            num_circles = 8\n            circle_index = int(angle_degrees / (360 / num_circles))\n\n            # Pass the circle centers list to the DrawCircleHighlight method\n            self.DrawCircleHighlight(circle_index, self.circle_centers)\n\n    def OnMouseUp(self, e):\n        if e.Button == System.Windows.Forms.MouseButtons.Middle:\n            # Rhino.RhinoApp.WriteLine(\"Middle Mouse Up\")\n            self.original_position = None\n            if self.form:\n                self.form.Close()\n                self.form = None\n        # else:\n        #     Rhino.RhinoApp.WriteLine(\"Other mouse up\")\n\ndef DoSomething():\n    if scriptcontext.sticky.has_key('MyMouseCallback'):\n        callback = scriptcontext.sticky['MyMouseCallback']\n        if callback:\n            callback.Enabled = False\n            callback = None\n            scriptcontext.sticky.Remove('MyMouseCallback')\n    else:\n        callback = MyMouseCallback()\n        callback.Enabled = True\n        scriptcontext.sticky['MyMouseCallback'] = callback\n        Rhino.RhinoApp.WriteLine(\"Click somewhere...\")\n\nif __name__ == \"__main__\":\n    DoSomething()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 87,
      "is_solution": false
    },
    {
      "code": "﻿using Grasshopper;\nusing Grasshopper.GUI.Canvas;\nusing Grasshopper.Kernel;\nusing Newtonsoft.Json;\nusing System;\nusing System.Drawing;\n\nnamespace GHRadialMenu.Actions;\ninternal class NewObjectAction() : IAction\n{\n    public Guid ComponentGuid { get; set; }\n\n    public string InitCode { get; set; } = string.Empty;\n\n    private string _name = string.Empty, _description = string.Empty;\n    [JsonIgnore]\n    public string Name => string.IsNullOrEmpty(_name) ? _name = Proxy?.Desc.Name ?? _name : _name;\n\n    [JsonIgnore]\n    public string Description => string.IsNullOrEmpty(_description) ? _description = Proxy?.Desc.Description ?? _description : _description;",
      "language": "csharp",
      "author": "michaelvollrath",
      "post_number": 109,
      "is_solution": false
    },
    {
      "code": "<PackageReference Include=RhinoCommon Version=7.36.23346.16351 GeneratePathProperty=True ExcludeAssets=all />\n<Reference Include=$(PkgRhinoCommon)\\lib\\net48\\Eto.dll Private=true />\n<PackageReference Include=RhinoWindows Version=7.36.23346.16351 GeneratePathProperty=True ExcludeAssets=all />\n<Reference Include=$(PkgRhinoWindows)\\lib\\net48\\Eto.Wpf.dll Private=true />",
      "language": "unknown",
      "author": "mrhe",
      "post_number": 258,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "csharp",
    "file-io",
    "geometry",
    "grasshopper",
    "layers",
    "materials",
    "python",
    "rhinocommon",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 3,
  "posts_count": 275,
  "views": 11708
}