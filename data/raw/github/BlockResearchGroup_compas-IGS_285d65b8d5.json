{
  "source_url": "https://github.com/BlockResearchGroup/compas-IGS/blob/be44e0ba12ce1156015b02b0ab9dd61c8006fc85/commands/IGS_form_update_from_force.py",
  "repo": "BlockResearchGroup/compas-IGS",
  "repo_stars": 1,
  "repo_description": "Rhino plugin for Interactive Graphic Statics using an algebraic graph-based approach to graphic statics",
  "license": "MIT",
  "filepath": "commands/IGS_form_update_from_force.py",
  "instruction": "venv: brg-csd r: compas_session>=0.4.5, compas_ags>=1.3.2",
  "code": "#! python3\n# venv: brg-csd\n# r: compas_session>=0.4.5, compas_ags>=1.3.2\n\nimport rhinoscriptsyntax as rs  # type: ignore  # noqa: F401\n\nfrom compas_ags.ags import force_update_from_form\nfrom compas_ags.ags import form_update_from_force\nfrom compas_igs.session import IGSSession\nfrom compas_igs.utilities import check_equilibrium\n\n# =============================================================================\n# Command\n# =============================================================================\n\n\ndef RunCommand():\n    session = IGSSession()\n\n    form = session.find_formdiagram(warn=True)\n    if not form:\n        return\n\n    force = session.find_forcediagram(warn=True)\n    if not force:\n        return\n\n    # =============================================================================\n    # Command\n    # =============================================================================\n\n    form_update_from_force(form.diagram, force.diagram)\n    force_update_from_form(force.diagram, form.diagram)\n\n    # =============================================================================\n    # Check equilibrium\n    # =============================================================================\n\n    max_angle = session.settings.solver.max_angle\n    min_force = session.settings.solver.min_force\n    max_ldiff = session.settings.solver.max_ldiff\n\n    result = check_equilibrium(\n        form.diagram,\n        force.diagram,\n        tol_angle=max_angle,\n        tol_force=min_force,\n        tol_ldiff=max_ldiff,\n    )\n\n    if result:\n        session.set(\"equilibrium\", True)\n        session.settings.form.show_external_force_labels = True\n\n    else:\n        print(\"The diagrams ARE NOT in equilibrium.\")\n\n        session.set(\"equilibrium\", False)\n        session.settings.form.show_external_force_labels = False\n        session.settings.form.show_independent_edge_labels = True\n\n    # =============================================================================\n    # Update scene\n    # =============================================================================\n\n    form.redraw()\n\n    if session.settings.autosave:\n        session.record(name=\"Form Update From Force\")\n\n\n# =============================================================================\n# Main\n# =============================================================================\n\nif __name__ == \"__main__\":\n    RunCommand()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}