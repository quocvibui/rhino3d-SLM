{
  "source_url": "https://github.com/dbt-ethz/open-plans-rhino/blob/6cbb4f56d948dbd3b00c301323963bcbe61642d5/src/rhino/dev/OPUploadProject_cmd.py",
  "repo": "dbt-ethz/open-plans-rhino",
  "repo_stars": 0,
  "repo_description": "Rhino3D plugin to interact with open plans",
  "license": "unknown",
  "filepath": "src/rhino/dev/OPUploadProject_cmd.py",
  "instruction": "Opupload project cmd",
  "code": "from __future__ import print_function\nfrom __future__ import absolute_import\nfrom __future__ import division\nfrom datamodels.project_class import OpenPlansProject\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext as sc\nimport System\nimport Rhino.UI\nimport Eto.Forms as forms\nimport Eto.Drawing as drawing\n\nimport rhino.rhino_helpers as rhh\nimport datamodels\nimport json\n\n\n__commandname__ = \"OPUploadProject\"\n\n\nclass GetJsonFilePath(forms.Dialog[bool]):\n\n    def __init__(self):\n        # Initialize dialog box\n        self.Title = 'OPEN PLANS: Upload project to database'\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n\n        # select file location\n        self.m_label_file = forms.Label(Text='Project File Path (json)')\n        self.m_textbox_file = forms.TextBox(Text=None)\n\n        # Create the browse button\n        self.BrowseButton = forms.Button(Text='Browse...')\n        self.BrowseButton.Click += self.on_browse_button_click\n\n        # Create the default button\n        self.DefaultButton = forms.Button(Text='Upload')\n        self.DefaultButton.Click += self.on_OK_button_click\n\n        # Create the abort button\n        self.AbortButton = forms.Button(Text='Cancel')\n        self.AbortButton.Click += self.on_close_button_click\n\n        # Create a table layout and add all the controls\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(80, 20)\n        layout.AddRow(self.m_label_file,\n                      self.m_textbox_file, self.BrowseButton)\n        layout.AddRow(self.m_label_file,\n                      self.m_textbox_file, self.BrowseButton)\n        layout.AddRow(None)  # spacer\n        layout.AddRow(None, self.DefaultButton, self.AbortButton)\n\n        self.Content = layout\n\n    def get_file_location(self):\n        return self.m_textbox_file.Text\n\n    # Close button click handler\n\n    def on_close_button_click(self, sender, e):\n        self.Close(False)\n\n    # OK button click handler\n    def on_OK_button_click(self, sender, e):\n        if self.m_textbox_file.Text == \"\":\n            raise Exception(\"Failed to upload project: file path is required\")\n        else:\n            self.Close(True)\n\n    def on_browse_button_click(self, sender, e):\n        filename = rs.OpenFileName(\"Open\", \"JSON Files (*.json)|*.json||\")\n        if filename:\n            self.m_textbox_file.Text = filename\n\n\ndef request_json_file():\n    dialog = GetJsonFilePath()\n    rc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n    if (rc):\n        return dialog.get_file_location()\n    else:\n        return False\n\n\ndef json_to_dict(filepath):\n    with open(filepath) as d:\n        data = json.load(d)\n    if data:\n        return data\n\n\ndef RunCommand(is_interactive):\n    project_file = request_json_file()\n    data = json_to_dict(project_file)\n    project = datamodels.OpenPlansProject.from_custom(data=data)\n    project.upload_to_openplans()\n\n\nif __name__ == \"__main__\":\n    RunCommand(True)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}