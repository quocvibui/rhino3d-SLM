{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/toolpath.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/toolpath.py",
  "instruction": "Explode the model and distribute the plates as an array.",
  "code": "\"\"\"Explode the model and distribute the plates as an array.\"\"\"\n\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport copy\nfrom Grasshopper import DataTree\nfrom Grasshopper.Kernel.Data import GH_Path\n\n__author__ = \"Nicolas Rogeau\"\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\n__version__ = \"2021.09\"\n\nclass MyComponent(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\n            \"Toolpath Generator\", \"Toolpath\", \"\"\"Offset the contour of each plate to get the toolpath for fabrication.\"\"\", \"Manis\", \"Solver\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"b8273f2a-e122-467c-961d-67071bb5d5d1\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_Boolean()\n        self.SetUpParam(p, \"run\", \"run\", \"Run the model if True.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"model\", \"model\", \"Plate model.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n\n        p = Grasshopper.Kernel.Parameters.Param_String()\n        self.SetUpParam(p, \"plates_id\", \"plates_id\", \"(Optional) List of plates to only merge joints for those plates.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Number()\n        self.SetUpParam(p, \"contour_tool_radius\", \"contour_tool_radius\", \"Radius of tool used to cut the contour.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Number()\n        self.SetUpParam(p, \"holes_tool_radius\", \"holes_tool_radius\", \"Radius of tool used to cut the holes.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Boolean()\n        self.SetUpParam(p, \"notch\", \"notch\", \"Generate notches in corners for insertion.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Boolean()\n        self.SetUpParam(p, \"cylinder\", \"cylinder\", \"If notch is True, generate cylinders as joints_negatives for detailed vizualization of the notches.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Number()\n        self.SetUpParam(p, \"limit\", \"limit\", \"Limit the angle of the corners for which a notch should be created.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Boolean()\n        self.SetUpParam(p, \"tbone\", \"tbone\", \"Change notch style: Dog-bone if False, T-bone if True.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Integer()\n        self.SetUpParam(p, \"switch\", \"switch\", \"Switch the top and bottom planes.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n    \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"model\", \"model\", \"Updated plate model.\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"top_milling_contour\", \"top_milling_contour\", \"Top_contour for milling operations.\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"bottom_milling_contour\", \"bottom_milling_contour\", \"Bottom_contour for milling operations.\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"top_milling_holes\", \"top_milling_holes\", \"Top_holes for milling operations.\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"bottom_milling_holes\", \"bottom_milling_holes\", \"Bottom_holes for milling operations.\")\n        self.Params.Output.Add(p)\n    \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        p1 = self.marshal.GetInput(DA, 1)\n        p2 = self.marshal.GetInput(DA, 2)\n        p3 = self.marshal.GetInput(DA, 3)\n        p4 = self.marshal.GetInput(DA, 4)\n        p5 = self.marshal.GetInput(DA, 5)\n        p6 = self.marshal.GetInput(DA, 6)\n        p7 = self.marshal.GetInput(DA, 7)\n        p8 = self.marshal.GetInput(DA, 8)\n        p9 = self.marshal.GetInput(DA, 9)\n        result = self.RunScript(p0, p1, p2, p3, p4, p5, p6, p7, p8, p9)\n\n        if result is not None:\n            if not hasattr(result, '__getitem__'):\n                self.marshal.SetOutput(result, DA, 0, True)\n            else:\n                self.marshal.SetOutput(result[0], DA, 0, True)\n                self.marshal.SetOutput(result[1], DA, 1, True)\n                self.marshal.SetOutput(result[2], DA, 2, True)\n                self.marshal.SetOutput(result[3], DA, 3, True)\n                self.marshal.SetOutput(result[4], DA, 4, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAACMSURBVEhL7ZRLDoAgDEQ9k2fiTJzJM7nB1E4TrbXy3RheMgmh7QywYDFIHlTntnpgxexbwIqhOrfVAytmBljAyobq3FbPaSIMuQHJQmrU1Aos79A+l9u5nlarK91PrvlfgKxL5PIIWGMsEuZeEfNhARrTxBPmsjFNPGEuG3muEpmb/US/5UjNgA+FdACwXPThKHhjfAAAAABJRU5ErkJggg==\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    def RunScript(self, run, model, plates_id, contour_tool_radius, holes_tool_radius, notch, cylinder, limit, tbone, switch):\n\n        def list_to_datatree(raggedList):\n            rl = raggedList\n            result = DataTree[object]()\n            for i in range(len(rl)):\n                temp = []\n                for j in range(len(rl[i])):\n                    temp.append(rl[i][j])\n                path = GH_Path(i)\n                result.AddRange(temp, path)\n            return result\n\n        top_milling_contour =  None\n        bottom_milling_contour =  None\n        top_milling_holes =  None\n        bottom_milling_holes =  None\n\n        if run is True or run == None: \n            if model:\n                model = copy.deepcopy(model)\n    \n                model.get_fabrication_lines(plates_id, contour_tool_radius, holes_tool_radius, notch, cylinder, limit, tbone)\n    \n                model.switch_top_bottom(switch)\n    \n                top_milling_contour =  []\n                bottom_milling_contour =  []\n                top_milling_holes =  []\n                bottom_milling_holes =  []\n    \n                for i in range(len(model.plates)):\n\n                    # apply to all or some plates.\n                    flag = True\n                    if (plates_id != None) and (plates_id != []) and (plates_id != 'all'):\n                        flag = False\n                        for j in range(len(plates_id)):\n                            if str(i) == plates_id[j]: flag = True\n\n                    if flag == True:\n                        top_milling_contour.append(model.plates[i].top_milling_contour)\n                        bottom_milling_contour.append(model.plates[i].bottom_milling_contour)\n                        top_milling_holes.append(model.plates[i].top_milling_holes)\n                        bottom_milling_holes.append(model.plates[i].bottom_milling_holes)\n                                       \n                top_milling_holes = list_to_datatree(top_milling_holes)\n                bottom_milling_holes = list_to_datatree(bottom_milling_holes)\n\n            else: self.AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, 'Waiting to get a model as input.')\n\n        else: self.AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, 'Set Run to True to generate toolpath.')\n\n        return (model, top_milling_contour, bottom_milling_contour, top_milling_holes, bottom_milling_holes)\n\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\n    def get_AssemblyName(self):\n        return \"Toolpath Generator\"\n    \n    def get_AssemblyDescription(self):\n        return \"\"\"\"\"\"\n\n    def get_AssemblyVersion(self):\n        return \"0.1\"\n\n    def get_AuthorName(self):\n        return \"Nicolas Rogeau\"\n    \n    def get_Id(self):\n        return System.Guid(\"dd2bd212-02eb-4b01-ba5c-1b9accc4cb5c\")",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}