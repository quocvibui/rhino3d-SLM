{
  "source_url": "https://github.com/caadxyz/DeBoorAlgorithmNurbs/blob/683f93a9c430eaecd45684521ebdc4561181de9b/src/BezierCurve.py",
  "repo": "caadxyz/DeBoorAlgorithmNurbs",
  "repo_stars": 53,
  "repo_description": "De Boor's Algorithm for NURBS Curve",
  "license": "LGPL-3.0",
  "filepath": "src/BezierCurve.py",
  "instruction": "coding=utf-8 BezierCurve.py Copyright (c) 2020.6 mahaidong Supported by ikuku.cn & caad.xyz See License in the root of this repository for details.",
  "code": "#coding=utf-8\n################################################################################\n# BezierCurve.py\n# Copyright (c) 2020.6 mahaidong\n# Supported by ikuku.cn & caad.xyz \n# See License in the root of this repository for details.\n################################################################################\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nfrom System.Drawing import Color\n\nimport os\nimport sys\nsys.path.append( os.path.dirname( ghenv.Component.OnPingDocument().FilePath ) )\nfrom textGoo import TextGoo\nfrom pointGoo import PointGoo\nimport ghpythonlib.treehelpers as th\n\n#debug\nimport textGoo\nimport pointGoo\nreload(textGoo)\nreload(pointGoo)\n\n\nclass BezierCurve(object):\n\n    def __init__(self, pts, textHeight):\n        self.pts = pts\n        self.legend = []\n        self.textHeight = textHeight \n        self.basisStr()\n    \n    def basisStr(self):\n        n = len(self.pts)\n        for i in range(n):\n            text0 = BezierCurve.superscript(\"\",'u',i)\n            text1 = BezierCurve.superscript(text0, '(1-u)',n-1-i)\n            if BezierCurve.binomial(n-1,i)==1:\n                text = text0+text1+\"•P\"+str(i)\n            else:\n                text = str(BezierCurve.binomial(n-1,i))+\"•\"+text0+text1+\"•P\"+str(i)\n\n            plane = Rhino.Geometry.Plane(self.pts[i], Rhino.Geometry.Vector3d(0,0,1))\n            text3d = TextGoo( Rhino.Display.Text3d( text, plane, self.textHeight ))\n            hslColor = Rhino.Display.ColorHSL(i/(n+1),1,0.5)\n            text3d.SetColor(hslColor.ToArgbColor())\n            self.legend.append(text3d)\n    \n    def basisFunction(self,i,l, origin,nums ):\n        pts = []\n        n = len(self.pts)\n        for j in range(nums+1):\n            x = origin.X + l*j/nums\n            y = origin.Y + l*BezierCurve.binomial(n-1,i)*( (j/nums)**i)*((1-j/nums)**(n-1-i))\n            pts.append( Rhino.Geometry.Point3d(x,y,0) )\n        return pts\n\n    # algorithm: https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/notes.html\n    def calculatePoint( self, u ): \n        p = None\n        n = len(self.pts)\n        for i in range(n):\n            if i == 0:\n                p = BezierCurve.binomial(n-1,i)*(u**i)*((1-u)**(n-1-i))*self.pts[i]\n            else: \n                p += BezierCurve.binomial(n-1,i)*(u**i)*((1-u)**(n-1-i))*self.pts[i]\n        return p\n\n    def drawCurvePts(self,nums,u, colorLimit):\n        pts = []\n        for i in range(nums+1):\n            if i/float(nums+1)<=u:\n                pt = self.calculatePoint( i/float(nums) )\n                ptGoo = PointGoo(pt)\n                hslColor = Rhino.Display.ColorHSL( colorLimit*i/float(nums+1),1,0.5 )\n                ptGoo.SetColor(hslColor.ToArgbColor())\n                pts.append( ptGoo ) \n        return pts\n    \n\n    @staticmethod\n    def superscript(p,u,i):\n        result =\"\"\n        if i==0:\n            pass\n        elif i==1:\n            result +=u \n        elif i==2:\n            result +=u+'\\xB2'\n        elif i==3:\n            result +=u+'\\xB3'\n        else:\n            result +=u+'^'+str(i)\n        if p is \"\":\n            return result\n        else:\n            if result is \"\":\n                return \"\"\n            else:\n                return '•'+result\n\n    @staticmethod\n    def binomial(n, k):\n        \"\"\"\n        A fast way to calculate binomial coefficients by Andrew Dalke.\n        See http://stackoverflow.com/questions/3025162/statistics-combinations-in-python\n        \"\"\"\n        if 0 <= k <= n:\n            ntok = 1\n            ktok = 1\n            for t in range(1, min(k, n - k) + 1):\n                ntok *= n\n                ktok *= t\n                n -= 1\n            return ntok // ktok\n        else:\n            return 0\n\nbc = BezierCurve(pts, textHeight)\nlegend = bc.legend\ncrvPoints = bc.drawCurvePts(nums,u,(len(pts)-1)/(len(pts)+1) )\nu2p = []\nu2p.append(bc.calculatePoint(u))\nu2p.append(funPosition+Rhino.Geometry.Point3d(u*funLength,0,0))\n\nbasisFunction = []\nfor i in range(len(pts)):\n    basisPts = bc.basisFunction(i,funLength,funPosition,nums) \n    basisPtGooList = []\n    for pt in basisPts:\n        ptGoo = PointGoo(pt)\n        hslColor = Rhino.Display.ColorHSL(i/(len(pts)+1),1,0.5)\n        ptGoo.SetColor(hslColor.ToArgbColor())\n        basisPtGooList.append(ptGoo)\n    basisFunction.append( basisPtGooList )\nbasisFunction = th.list_to_tree(basisFunction, source=[0,0])\n\n\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}