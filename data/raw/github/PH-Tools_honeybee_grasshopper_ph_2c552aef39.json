{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/shw/create_pipe_trunks.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/shw/create_pipe_trunks.py",
  "instruction": "GHCompo Interface: HBPH - Create SHW Pipe | Trunks.",
  "code": "# -*- Python Version: 2.7 -*-\n# -*- coding: utf-8 -*-\n\n\"\"\"GHCompo Interface: HBPH - Create SHW Pipe | Trunks.\"\"\"\n\ntry:\n    from typing import Any, Collection, Dict, List, Union\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from ladybug_geometry.geometry3d.polyline import LineSegment3D, Polyline3D\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_geometry:\\n\\t{}\".format(e))\n\ntry:\n    from ladybug_rhino.togeometry import to_polyline3d\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ladybug_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_phhvac import hot_water_piping\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_energy_ph:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_utils.input_tools import clean_get, input_to_int\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_utils:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\n    from honeybee_ph_rhino.gh_compo_io import ghio_validators\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\n\nclass _TrunkPipeBuilder(object):\n    \"\"\"Interface for collect and clean DHW 'Trunk' Piping user-inputs\n\n    Note: Following the LBT convention, the line-geometry may be stored in any units (m, mm, inch, etc).\n    All non-line-geometry data like thickness, conductivity, temp. etc. must always be in SI units.\n    \"\"\"\n\n    display_name = ghio_validators.HBName(\"display_name\", default=\"_unnamed_trunk_pipe_\")\n    pipe_diameter_mm = ghio_validators.UnitMM(\"pipe_diameter_mm\", default=\"12.7 MM\")\n    water_temp_c = ghio_validators.UnitDegreeC(\"water_temp_c\", default=\"60.0 C\")\n\n    def __init__(\n        self,\n        IGH,\n        dhw_branches,\n        multiplier,\n        display_name,\n        demand_recirculation,\n        pipe_material,\n        pipe_diameter_mm,\n        geometry,\n        water_temp_c,\n    ):\n        # type: (gh_io.IGH, List, int, str, bool, int, int, Union[Polyline3D, LineSegment3D], float) -> None\n        self.IGH = IGH\n        self.dhw_branches = dhw_branches\n        self.multiplier = multiplier\n        self.display_name = display_name\n        self.demand_recirculation = demand_recirculation\n        self.pipe_material = pipe_material\n        self.pipe_diameter_mm = pipe_diameter_mm\n        self.geometry = geometry\n        self.water_temp_c = water_temp_c\n\n    def _convert_to_polyline(self, _input):\n        # type: (Any) -> Polyline3D\n        \"\"\"Try to convert input geometry to a Rhino Polyline object.\"\"\"\n        cps = self.IGH.ghpythonlib_components.ControlPoints(_input).points\n        return self.IGH.ghpythonlib_components.PolyLine(cps, False)\n\n    @property\n    def geometry(self):\n        # type: () -> Union[Polyline3D, LineSegment3D]\n        return self._geometry\n\n    @geometry.setter\n    def geometry(self, _input):\n        \"\"\"Set geometry input. Will convert input to LBT-Polyline3D.\"\"\"\n        try:\n            # -- First, assume it is Rhino geometry and convert it to an LBT Polyline3D\n            self._geometry = to_polyline3d(_input)\n        except:\n            try:\n                # -- If that fails, try and convert it to a Rhino Polyline, then an LBT one\n                self._geometry = to_polyline3d(self._convert_to_polyline(_input))\n            except Exception as e:\n                raise Exception(\n                    \"{}\\nError: Geometry input {} cannot be converted to an LBT Polyline3D?\".format(e, _input)\n                )\n\n    @property\n    def geometry_segments(self):\n        # type: () -> Collection[LineSegment3D]\n        if isinstance(self.geometry, LineSegment3D):\n            return [self.geometry]\n        elif isinstance(self.geometry, Polyline3D):\n            return self.geometry.segments\n        else:\n            raise ValueError(\"Geometry input '{}' is not a Polyline3D or LineSegment3D?\".format(type(self.geometry)))\n\n    def create_hbph_dhw_trunk_pipe(self):\n        # type: () -> hot_water_piping.PhHvacPipeTrunk\n        \"\"\"Create a Honeybee 'PhPipeTrunk' object for a DHW Trunk Pipe.\"\"\"\n\n        # -- Build the new PH-Trunk\n        hbph_obj = hot_water_piping.PhHvacPipeTrunk()\n        hbph_obj.display_name = self.display_name\n        hbph_obj.multiplier = self.multiplier\n        hbph_obj.demand_recirculation = self.demand_recirculation\n\n        for geom_segment in self.geometry_segments:\n            hbph_obj.pipe_element.add_segment(\n                hot_water_piping.PhHvacPipeSegment(\n                    _geom=geom_segment,\n                    _diameter_mm=self.pipe_diameter_mm,\n                    _insul_thickness_mm=0.0,\n                    _insul_conductivity=0.04,\n                    _insul_refl=False,\n                    _insul_quality=None,\n                    _daily_period=24,\n                    _water_temp_c=self.water_temp_c,\n                    _material=self.pipe_material,\n                )\n            )\n\n        # -- Add the Branch piping\n        for hbph_branch in self.dhw_branches:\n            if hasattr(hbph_branch, \"fixtures\"):\n                # -- Its a branch, so just add it to the trunk\n                hbph_obj.add_branch(hbph_branch)\n            else:\n                hbph_fixture = hbph_branch\n                if len(hbph_obj.branches) == 0:\n                    # -- Create a new branch, and add the input as a fixture\n                    new_branch = hot_water_piping.PhHvacPipeBranch()\n                    new_branch.display_name = self.display_name\n                    new_branch.add_fixture(hbph_fixture)\n                    hbph_obj.add_branch(new_branch)\n                else:\n                    # -- Host the fixture on the existing branch\n                    hbph_obj.branches[0].add_fixture(hbph_fixture)\n\n        return hbph_obj\n\n\nclass GHCompo_CreateSHWTrunkPipes(object):\n    \"\"\"Component Interface\"\"\"\n\n    def __init__(\n        self,\n        _IGH,\n        _dhw_branches,\n        _multipliers,\n        _display_name,\n        _demand_recirculation,\n        _pipe_material,\n        _pipe_diameter_mm,\n        _geometry,\n        _water_temp_c,\n    ):\n        # type: (gh_io.IGH, List[hot_water_piping.PhHvacPipeElement], List[int], List[str], List[bool], List[str], List[str], List[Union[Polyline3D, LineSegment3D]], list[str]) -> None\n        self.IGH = _IGH\n        self.dhw_branches = _dhw_branches\n        self.multipliers = _multipliers\n        self.display_name = _display_name\n        self.demand_recirculation = _demand_recirculation\n        self.pipe_material = _pipe_material\n        self.pipe_diameter_mm = _pipe_diameter_mm\n        self.geometry = _geometry\n        self.water_temp_c = _water_temp_c\n\n    def collect_trunk_data(self):\n        # type: () -> List[Dict[str, Any]]\n        \"\"\"Organize all the input data, fill in any missing bits using 'clean_get'.\"\"\"\n        trunk_data = []\n        for i in range(len(self.geometry)):\n            trunk_data.append(\n                {\n                    \"IGH\": self.IGH,\n                    \"dhw_branches\": self.dhw_branches,\n                    \"multiplier\": clean_get(self.multipliers, i, 1),\n                    \"display_name\": clean_get(self.display_name, i, \"_unnamed_trunk_\"),\n                    \"demand_recirculation\": clean_get(self.demand_recirculation, i, False),\n                    \"pipe_material\": input_to_int(clean_get(self.pipe_material, i, \"2\")),\n                    \"pipe_diameter_mm\": clean_get(self.pipe_diameter_mm, i, \"12.7 MM\"),\n                    \"geometry\": self.geometry[i],\n                    \"water_temp_c\": clean_get(self.water_temp_c, i, \"60 C\"),\n                }\n            )\n\n        return trunk_data\n\n    def run(self):\n        # type: () -> List[hot_water_piping.PhHvacPipeElement]\n        dhw_trunk_piping_ = []\n\n        for trunk_data in self.collect_trunk_data():\n            trunk_pipe_builder = _TrunkPipeBuilder(**trunk_data)\n            dhw_trunk_piping_.append(trunk_pipe_builder.create_hbph_dhw_trunk_pipe())\n\n        return dhw_trunk_piping_\n",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}