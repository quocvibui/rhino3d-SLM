{
  "source_url": "https://github.com/jingcheng-chen/rhinomcp/blob/615f0eae092d3d129f07fde519b28ca10d31dd6e/rhino_mcp_server/static/block.py",
  "repo": "jingcheng-chen/rhinomcp",
  "repo_stars": 299,
  "repo_description": "RhinoMCP connects Rhino 3D to AI Agent through the Model Context Protocol (MCP)",
  "license": "Apache-2.0",
  "filepath": "rhino_mcp_server/static/block.py",
  "instruction": null,
  "code": "import math\n\nimport System\n\nimport Rhino\n\nimport scriptcontext\n\nfrom rhinoscript import utility as rhutil\n\n\ndef __InstanceObjectFromId(id, raise_if_missing):\n    rhobj = rhutil.coercerhinoobject(id, True, raise_if_missing)\n    if isinstance(rhobj, Rhino.DocObjects.InstanceObject): return rhobj\n    if raise_if_missing: raise ValueError(\"unable to find InstanceObject\")\n\n\ndef AddBlock(object_ids, base_point, name=None, delete_input=False):\n    \"\"\"Adds a new block definition to the document\n    Parameters:\n      object_ids ([guid, ....]) objects that will be included in the block\n      base_point (point): 3D base point for the block definition\n      name (str, optional): name of the block definition. If omitted a name will be\n        automatically generated\n      delete_input (bool): if True, the object_ids will be deleted\n    Returns:\n      str: name of new block definition on success\n    Example:\n      import rhinoscriptsyntax as rs\n      objs = rs.GetObjects(\"Select objects to define block\")\n      if objs:\n          point = rs.GetPoint(\"Block base point\")\n          if point:\n              block = rs.AddBlock(objs, point, None, True)\n              rs.InsertBlock(block, point)\n    See Also:\n      InsertBlock\n    \"\"\"\n    base_point = rhutil.coerce3dpoint(base_point, True)\n    if not name:\n        name = scriptcontext.doc.InstanceDefinitions.GetUnusedInstanceDefinitionName()\n    found = scriptcontext.doc.InstanceDefinitions.Find(name)\n    objects = []\n    for id in object_ids:\n        obj = rhutil.coercerhinoobject(id, True)\n        if obj.IsReference: return\n        ot = obj.ObjectType\n        if ot==Rhino.DocObjects.ObjectType.Light: return\n        if ot==Rhino.DocObjects.ObjectType.Grip: return\n        if ot==Rhino.DocObjects.ObjectType.Phantom: return\n        if ot==Rhino.DocObjects.ObjectType.InstanceReference and found:\n            uses, nesting = obj.UsesDefinition(found.Index)\n            if uses: return\n        objects.append(obj)\n    if objects:\n        geometry = [obj.Geometry for obj in objects]\n        attrs = [obj.Attributes for obj in objects]\n        rc = 0\n        if found:\n          rc = scriptcontext.doc.InstanceDefinitions.ModifyGeometry(found.Index, geometry, attrs)\n        else:\n          rc = scriptcontext.doc.InstanceDefinitions.Add(name, \"\", base_point, geometry, attrs)\n        if rc>=0:\n            if delete_input:\n                for obj in objects: scriptcontext.doc.Objects.Delete(obj, True)\n            scriptcontext.doc.Views.Redraw()\n    return name\n\n\ndef BlockContainerCount(block_name):\n    \"\"\"Returns number of block definitions that contain a specified\n    block definition\n    Parameters:\n      block_name (str): the name of an existing block definition\n    Returns:\n      number: the number of block definitions that contain a specified block definition\n    Example:\n      import rhinoscriptscriptsyntax as rs\n      block = rs.GetString(\"Block name to query\")\n      if rs.IsBlock(block):\n          count = rs.BlockContainerCount(block)\n          print(\"This block is nested in {} block(s).\".format(count))\n    See Also:\n      BlockContainers\n      IsBlock\n    \"\"\"\n    return len(BlockContainers(block_name))\n\n\ndef BlockContainers(block_name):\n    \"\"\"Returns names of the block definitions that contain a specified block\n    definition.\n    Parameters:\n      block_name (str): the name of an existing block definition\n    Returns:\n      list(str, ...): A list of block definition names\n    Example:\n      import rhinoscriptsyntax as rs\n      blockname = rs.GetString(\"Block name to query\")\n      if rs.IsBlock(blockname):\n          blocks = rs.BlockContainers(blockname)\n          for block in blocks: print(block)\n    See Also:\n      BlockContainerCount\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    containers = idef.GetContainers()\n    rc = []\n    for item in containers:\n        if not item.IsDeleted: rc.append(item.Name)\n    return rc\n\n\ndef BlockCount():\n    \"\"\"Returns the number of block definitions in the document\n    Returns:\n      number: the number of block definitions in the document\n    Example:\n      import rhinoscriptsyntax as rs\n      count = rs.BlockCount()\n      print(\"There are {} blocks\".format(count)\n    See Also:\n      BlockNames\n      IsBlock\n    \"\"\"\n    return scriptcontext.doc.InstanceDefinitions.ActiveCount\n\n\ndef BlockDescription(block_name, description=None):\n    \"\"\"Returns or sets the description of a block definition\n    Parameters:\n      block_name (str): the name of an existing block definition\n      description (str, optional): The new description.\n    Returns:\n      str: if description is not specified, the current description\n      str: if description is specified, the previous description\n    Example:\n      import rhinoscriptsyntax as rs\n      blockname = rs.GetString(\"Block name to list description\")\n      if rs.IsBlock(blockname):\n          desc = rs.BlockDescription(blockname)\n          if desc is None: print(\"No description\")\n          else: print(desc)\n    See Also:\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    rc = idef.Description\n    if description: scriptcontext.doc.InstanceDefinitions.Modify( idef, idef.Name, description, True )\n    return rc\n\n\ndef BlockInstanceCount(block_name,where_to_look=0):\n    \"\"\"Counts number of instances of the block in the document.\n    Nested instances are not included in the count.\n    Parameters:\n      block_name (str): the name of an existing block definition\n      where_to_look (number, optional):\n        0 = get top level references in active document.\n        1 = get top level and nested references in active document.\n        2 = check for references from other instance definitions\n    Returns:\n      number: the number of instances of the block in the document\n    Example:\n      import rhinoscriptsyntax as rs\n      blockname = rs.GetString(\"Block to count\")\n      if rs.IsBlock(blockname):\n          count = rs.BlockInstanceCount(blockname)\n          print(\"{} block(s) found.\".format(count))\n    See Also:\n      BlockInstanceInsertPoint\n      BlockInstances\n      BlockInstanceXform\n      IsBlockInstance\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    refs = idef.GetReferences(where_to_look)\n    return len(refs)\n\n\ndef BlockInstanceInsertPoint(object_id):\n    \"\"\"Returns the insertion point of a block instance.\n    Parameters:\n      object_id (guid): The identifier of an existing block insertion object\n    Returns:\n      point: The insertion 3D point if successful\n    Example:\n      import rhinoscriptsyntax as rs\n      strObject = rs.GetObject(\"Select block\")\n      if rs.IsBlockInstance(strObject):\n          rs.AddPoint( rs.BlockInstanceInsertPoint(strObject) )\n    See Also:\n      BlockInstanceCount\n      BlockInstances\n      BlockInstanceXform\n      IsBlockInstance\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    xf = instance.InstanceXform\n    pt = Rhino.Geometry.Point3d.Origin\n    pt.Transform(xf)\n    return pt\n\n\ndef BlockInstanceName(object_id):\n    \"\"\"Returns the block name of a block instance\n    Parameters:\n      object_id (guid): The identifier of an existing block insertion object\n    Returns:\n      str: the block name of a block instance\n    Example:\n      import rhinoscriptsyntax as rs\n      strObject = rs.GetObject(\"Select block\")\n      if rs.IsBlockInstance(strObject):\n          print(rs.BlockInstanceName(strObject))\n    See Also:\n      BlockInstanceCount\n      BlockInstances\n      BlockInstanceXform\n      IsBlockInstance\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    idef = instance.InstanceDefinition\n    return idef.Name\n\n\ndef BlockInstances(block_name,where_to_look=0):\n    \"\"\"Returns the identifiers of the inserted instances of a block.\n    Parameters:\n      block_name (str): the name of an existing block definition\n      where_to_look (number, optional):\n        0 = get top level references in active document.\n        1 = get top level and nested references in active document.\n        2 = check for references from other instance definitions\n    Returns:\n      list(guid, ...): Ids identifying the instances of a block in the model.\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block to select\")\n      if rs.IsBlock(strBlock):\n          arrObjects = rs.BlockInstances(strBlock)\n          if arrobjects:\n              rs.SelectObjects(arrObjects)\n    See Also:\n      BlockInstanceCount\n      BlockInstanceInsertPoint\n      BlockInstanceXform\n      IsBlockInstance\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    instances = idef.GetReferences(where_to_look)\n    return [item.Id for item in instances]\n\n\ndef BlockInstanceXform(object_id):\n    \"\"\"Returns the location of a block instance relative to the world coordinate\n    system origin (0,0,0). The position is returned as a 4x4 transformation\n    matrix\n    Parameters:\n      object_id (guid): The identifier of an existing block insertion object\n    Returns:\n      transform: the location, as a transform matrix, of a block instance relative to the world coordinate\n    system origin\n    Example:\n      import rhinoscriptsyntax as rs\n      obj = rs.GetObject(\"Select block to query\")\n      if rs.IsBlockInstance(obj):\n          arrMatrix = rs.BlockInstanceXform(obj)\n          if arrMatrix is not None:\n              pointId = rs.AddPoint([0,0,0])\n              rs.TransformObject( pointId, arrMatrix)\n    See Also:\n      BlockInstanceCount\n      BlockInstanceInsertPoint\n      BlockInstances\n      IsBlockInstance\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    return instance.InstanceXform\n\n\ndef BlockNames( sort=False ):\n    \"\"\"Returns the names of all block definitions in the document\n    Parameters:\n      sort (bool): True to return a sorted list\n    Returns:\n      list(str, ...): the names of all block definitions in the document\n    Example:\n      import rhinoscriptsyntax as rs\n      names = rs.BlockNames(True)\n      if names:\n          for name in names: print(name)\n    See Also:\n      BlockCount\n      IsBlock\n    \"\"\"\n    ideflist = scriptcontext.doc.InstanceDefinitions.GetList(True)\n    rc = [item.Name for item in ideflist]\n    if(sort): rc.sort()\n    return rc\n\n\ndef BlockObjectCount(block_name):\n    \"\"\"Returns number of objects that make up a block definition\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      number: the number of objects that make up a block definition\n    Example:\n      import rhinoscriptsyntax as rs\n      count = rs.BlockObjectCount()\n      print(\"There are {} blocks\".format(count))\n    See Also:\n      BlockNames\n      BlockObjects\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.ObjectCount\n\n\ndef BlockObjects(block_name):\n    \"\"\"Returns identifiers of the objects that make up a block definition\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      list(guid, ...): list of identifiers on success\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name to list identifiers\")\n      if rs.IsBlock(strBlock):\n          objects = rs.BlockObjects(strBlock)\n          if objects:\n              for item in objects: print(item)\n    See Also:\n      BlockNames\n      BlockObjectCount\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    rhobjs = idef.GetObjects()\n    return [obj.Id for obj in rhobjs]\n\n\ndef BlockPath(block_name):\n    \"\"\"Returns path to the source of a linked or embedded block definition.\n    A linked or embedded block definition is a block definition that was\n    inserted from an external file.\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      str: path to the linked block on success\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name to list path\")\n      if rs.IsBlockEmbedded(strBlock):\n          print(rs.BlockPath(strBlock))\n    See Also:\n      IsBlock\n      IsBlockEmbedded\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.SourceArchive\n\n\ndef BlockStatus(block_name):\n    \"\"\"Returns the status of a linked block\n    Parameters:\n        block_name (str): Name of an existing block\n    Returns:\n      number: the status of a linked block\n        Value Description\n        -3    Not a linked block definition.\n        -2    The linked block definition's file could not be opened or could not be read.\n        -1    The linked block definition's file could not be found.\n         0    The linked block definition is up-to-date.\n         1    The linked block definition's file is newer than definition.\n         2    The linked block definition's file is older than definition.\n         3    The linked block definition's file is different than definition.\n    Example:\n      import rhinoscriptsyntax as rs\n      block = rs.GetString(\"Block name to list description\")\n      if rs.IsBlock(block):\n          status = rs.BlockStatus(block)\n          print(\"block status for {} is {}\".format(block, status))\n    See Also:\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: return -3\n    return int(idef.ArchiveFileStatus)\n\n\ndef DeleteBlock(block_name):\n    \"\"\"Deletes a block definition and all of it's inserted instances.\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      bool: True or False indicating success or failure\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name to delete\")\n      if rs.IsBlock(strBlock):\n          rs.DeleteBlock(strBlock)\n    See Also:\n      BlockNames\n      ExplodeBlockInstance\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    rc = scriptcontext.doc.InstanceDefinitions.Delete(idef.Index, True, False)\n    scriptcontext.doc.Views.Redraw()\n    return rc\n\n\ndef ExplodeBlockInstance(object_id, explode_nested_instances=False):\n    \"\"\"Explodes a block instance into it's geometric components. The\n    exploded objects are added to the document\n    Parameters:\n      object_id (guid): The identifier of an existing block insertion object\n      explode_nested_instances (bool, optional): By default nested blocks are not exploded.\n    Returns:\n      list(guid, ...): identifiers for the newly exploded objects on success\n    Example:\n      import rhinoscriptsyntax as rs\n      strObject = rs.GetObject(\"Select block instance to explode\")\n      if rs.IsBlockInstance(strObject):\n          rs.ExplodeBlockInstance(strObject)\n    See Also:\n      DeleteBlock\n      IsBlockInstance\n    \"\"\"\n    instance = __InstanceObjectFromId(object_id, True)\n    guids = scriptcontext.doc.Objects.AddExplodedInstancePieces(instance, explodeNestedInstances=explode_nested_instances, deleteInstance=True)\n    if guids:\n      scriptcontext.doc.Views.Redraw()\n    return guids\n\n\ndef InsertBlock( block_name, insertion_point, scale=(1,1,1), angle_degrees=0, rotation_normal=(0,0,1) ):\n    \"\"\"Inserts a block whose definition already exists in the document\n    Parameters:\n      block_name (str): name of an existing block definition\n      insertion_point (point): insertion point for the block\n      scale ({number, number, number]): x,y,z scale factors\n      angle_degrees (number, optional): rotation angle in degrees\n      rotation_normal (vector, optional): the axis of rotation.\n    Returns:\n      guid: id for the block that was added to the doc\n    Example:\n    See Also:\n    \"\"\"\n    insertion_point = rhutil.coerce3dpoint(insertion_point, True)\n    rotation_normal = rhutil.coerce3dvector(rotation_normal, True)\n    angle_radians = math.radians(angle_degrees)\n    trans = Rhino.Geometry.Transform\n    move = trans.Translation(insertion_point[0],insertion_point[1],insertion_point[2])\n    scale = trans.Scale(Rhino.Geometry.Plane.WorldXY, scale[0], scale[1], scale[2])\n    rotate = trans.Rotation(angle_radians, rotation_normal, Rhino.Geometry.Point3d.Origin)\n    xform = move * scale * rotate\n    return InsertBlock2( block_name, xform )\n\n\ndef InsertBlock2(block_name, xform):\n    \"\"\"Inserts a block whose definition already exists in the document\n    Parameters:\n      block_name (str): name of an existing block definition\n      xform (transform): 4x4 transformation matrix to apply\n    Returns:\n      guid: id for the block that was added to the doc on success\n    Example:\n    See Also:\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    xform = rhutil.coercexform(xform, True)\n    id = scriptcontext.doc.Objects.AddInstanceObject(idef.Index, xform )\n    if id!=System.Guid.Empty:\n        scriptcontext.doc.Views.Redraw()\n        return id\n\n\ndef IsBlock(block_name):\n    \"\"\"Verifies the existence of a block definition in the document.\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      bool: True or False\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name\")\n      if rs.IsBlock(strBlock):\n          print(\"The block definition exists.\")\n      else:\n          print(\"The block definition does not exist.\")\n    See Also:\n      IsBlockEmbedded\n      IsBlockInstance\n      IsBlockInUse\n      IsBlockReference\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    return (idef is not None)\n\n\ndef IsBlockEmbedded(block_name):\n    \"\"\"Verifies a block definition is embedded, or linked, from an external file.\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      bool: True or False\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name\")\n      if rs.IsBlock(strBlock):\n          if rs.IsBlockEmbedded(strBlock):\n              print(\"The block definition is embedded.\")\n          else:\n              print(\"The block definition is not embedded.\")\n      else:\n          print(\"The block definition does not exist.\")\n    See Also:\n      IsBlock\n      IsBlockInstance\n      IsBlockInUse\n      IsBlockReference\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    ut = Rhino.DocObjects.InstanceDefinitionUpdateType\n    return (idef.UpdateType==ut.Embedded or idef.UpdateType==ut.Static or idef.UpdateType==ut.LinkedAndEmbedded)\n\n\ndef IsBlockInstance(object_id):\n    \"\"\"Verifies an object is a block instance\n    Parameters:\n      object_id (guid): The identifier of an existing block insertion object\n    Returns:\n      bool: True or False\n    Example:\n      import rhinoscriptsyntax as rs\n      obj = rs.GetObject(\"Select block instance\")\n      if rs.IsBlockInstance(obj):\n          print(\"The object is a block instance.\")\n      else:\n          print(\"The object is not a block instance.\")\n    See Also:\n      IsBlock\n      IsBlockEmbedded\n      IsBlockInUse\n      IsBlockReference\n    \"\"\"\n    return  __InstanceObjectFromId(object_id, False) is not None\n\n\ndef IsBlockInUse(block_name, where_to_look=0):\n    \"\"\"Verifies that a block definition is being used by an inserted instance\n    Parameters:\n      block_name (str): name of an existing block definition\n      where_to_look (number, optional): One of the following values\n           0 = Check for top level references in active document\n           1 = Check for top level and nested references in active document\n           2 = Check for references in other instance definitions\n    Returns:\n      bool: True or False\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name\")\n      if rs.IsBlock(strBlock):\n          if rs.IsBlockInUse(strBlock):\n              print(\"The block definition is in use.\")\n          else:\n              print(\"The block definition is not in use.\")\n      else:\n          print(\"The block definition does not exist.\")\n    See Also:\n      IsBlock\n      IsBlockInstance\n      IsBlockEmbedded\n      IsBlockReference\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.InUse(where_to_look)\n\n\ndef IsBlockReference(block_name):\n    \"\"\"Verifies that a block definition is from a reference file.\n    Parameters:\n      block_name (str): name of an existing block definition\n    Returns:\n      bool: True or False\n    Example:\n      import rhinoscriptsyntax as rs\n      strBlock = rs.GetString(\"Block name\")\n      if rs.IsBlock(strBlock):\n          if rs.IsBlockReference(strBlock):\n              print(\"The block definition is a reference definition.\")\n          else:\n              print(\"The block definition is not a reference definition.\")\n      else:\n          print(\"The block definition does not exist.\")\n    See Also:\n      IsBlock\n      IsBlockEmbedded\n      IsBlockInUse\n      IsBlockInstance\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    return idef.IsReference\n\n\ndef RenameBlock( block_name, new_name ):\n    \"\"\"Renames an existing block definition\n    Parameters:\n      block_name (str): name of an existing block definition\n      new_name (str): name to change to\n    Returns:\n      bool: True or False indicating success or failure\n    Example:\n      import rhinoscriptsyntax as rs\n      strOldBlock = rs.GetString(\"Old block name\")\n      if strOldBlock:\n          strNewBlock = rs.GetString(\"New block name\")\n          if strNewBlock:\n              rs.RenameBlock (strOldBlock, strNewBlock)\n    See Also:\n      BlockNames\n      IsBlock\n    \"\"\"\n    idef = scriptcontext.doc.InstanceDefinitions.Find(block_name)\n    if not idef: raise ValueError(\"%s does not exist in InstanceDefinitionsTable\"%block_name)\n    description = idef.Description\n    rc = scriptcontext.doc.InstanceDefinitions.Modify(idef, new_name, description, False)\n    return rc\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}