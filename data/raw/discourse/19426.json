{
  "source_url": "https://discourse.mcneel.com/t/python-fillallholes/19426",
  "topic_id": 19426,
  "title": "Python FillAllHoles",
  "question": "Hello,\n\n\nI have the following script which exports obj files, working well. However on export when I display the obj file I am getting holes in the meshes when displayed in webGL. I do not understand if I am simply decimating the mesh to much. They seem to appear rather randomly, but I understand I am using a one size fits all export which may not be ideal.\n\n\nRegardless, I found if I create the mesh manually in the GUI I can then also select an option to fill all holes. This fixes the issue, but I would like to incorporate a fill all holes step in my export. I donâ€™t understand at what point I would do this step. Do I need to write a script which adds the mesh to the Rhino environment to access the command? The command I found is FillMeshHoles: \nhttp://docs.mcneel.com/rhino/5/help/en-us/commands/fillmeshholes.htm\n when the mesh is selected.\n\n\nThe script:\n\n\n    import os\n    import scriptcontext\n    import rhinoscriptsyntax as rs\n    \n    \n    print \"//export run started/////////////\"\n    \n    # this function via mcneel/rhinoscriptsyntax\n    #https://github.com/mcneel/rhinoscriptsyntax/blob/master/Scripts/rhinoscript/layer.py\n    def layerNames(sort=False):\n        rc = []\n        for layer in scriptcontext.doc.Layers:\n            if not layer.IsDeleted: rc.append(layer.FullPath)\n        if sort: rc.sort()\n        return rc\n    \n    def GetDAESettings():\n        e_str = \"\"\n        return e_str\n    \n    def GetOBJSettings():\n        e_str = \"_Geometry=_Mesh \"\n        e_str+= \"_EndOfLine=CRLF \"\n        e_str+= \"_ExportRhinoObjectNames=_ExportObjectsAsOBJGroups \"\n        e_str+= \"_ExportMeshTextureCoordinates=_Yes \"\n        e_str+= \"_ExportMeshVertexNormals=_Yes \"\n        e_str+= \"_CreateNGons=_No \"\n        e_str+= \"_ExportMaterialDefinitions=_No \"\n        e_str+= \"_YUp=_No \"\n        e_str+= \"_WrapLongLines=Yes \"\n        e_str+= \"_VertexWelding=_Welded \"\n        e_str+= \"_WritePrecision=8 \"\n        e_str+= \"_Enter \"\n    \n        e_str+= \"_DetailedOptions \"\n        e_str+...",
  "code_blocks": [
    {
      "code": "import os\n    import scriptcontext\n    import rhinoscriptsyntax as rs\n    \n    \n    print \"//export run started/////////////\"\n    \n    # this function via mcneel/rhinoscriptsyntax\n    #https://github.com/mcneel/rhinoscriptsyntax/blob/master/Scripts/rhinoscript/layer.py\n    def layerNames(sort=False):\n        rc = []\n        for layer in scriptcontext.doc.Layers:\n            if not layer.IsDeleted: rc.append(layer.FullPath)\n        if sort: rc.sort()\n        return rc\n    \n    def GetDAESettings():\n        e_str = \"\"\n        return e_str\n    \n    def GetOBJSettings():\n        e_str = \"_Geometry=_Mesh \"\n        e_str+= \"_EndOfLine=CRLF \"\n        e_str+= \"_ExportRhinoObjectNames=_ExportObjectsAsOBJGroups \"\n        e_str+= \"_ExportMeshTextureCoordinates=_Yes \"\n        e_str+= \"_ExportMeshVertexNormals=_Yes \"\n        e_str+= \"_CreateNGons=_No \"\n        e_str+= \"_ExportMaterialDefinitions=_No \"\n        e_str+= \"_YUp=_No \"\n        e_str+= \"_WrapLongLines=Yes \"\n        e_str+= \"_VertexWelding=_Welded \"\n        e_str+= \"_WritePrecision=8 \"\n        e_str+= \"_Enter \"\n    \n        e_str+= \"_DetailedOptions \"\n        e_str+= \"_JaggedSeams=_No \"\n        e_str+= \"_PackTextures=_No \"\n        e_str+= \"_Refine=_Yes \"\n        e_str+= \"_SimplePlane=_Yes \"\n    \n        e_str+= \"_AdvancedOptions \"\n        e_str+= \"_Angle=70 \"\n        e_str+= \"_AspectRatio=0 \"\n        e_str+= \"_Distance=0.0 \"\n        e_str+= \"_Density=0.4 \"\n        e_str+= \"_Grid=0 \"\n        e_str+= \"_MaxEdgeLength=0 \"\n        e_str+= \"_MinEdgeLength=0.0001 \"\n    \n        e_str+= \"_Enter _Enter\"\n    \n        return e_str\n\ndef GetSTLSettings():\n    eStr = \"_ExportFileAs=_Binary \"\n    eStr+= \"_ExportUnfinishedObjects=_Yes \"\n    eStr+= \"_UseSimpleDialog=_No \"\n    eStr+= \"_UseSimpleParameters=_No \"\n    eStr+= \"_Enter _DetailedOptions \"\n    eStr+= \"_JaggedSeams=_No \"\n    eStr+= \"_PackTextures=_No \"\n    eStr+= \"_Refine=_Yes \"\n    eStr+= \"_SimplePlane=_No \"\n    eStr+= \"_AdvancedOptions \"\n    eStr+= \"_Angle=15 \"\n    eStr+= \"_AspectRatio=0 \"\n    eStr+= \"_Distance=0.01 \"\n    eStr+= \"_Grid=16 \"\n    eStr+= \"_MaxEdgeLength=0 \"\n    eStr+= \"_MinEdgeLength=0.0001 \"\n    eStr+= \"_Enter _Enter\"\n    return eStr\n\nsettingsList = {\n    'GetDAESettings': GetDAESettings,\n    'GetOBJSettings': GetOBJSettings,\n    'GetSTLSettings': GetSTLSettings\n}\n\n\n\n\nfileName = rs.DocumentName()\nfilePath = rs.DocumentPath().rstrip(fileName)\n\narrLayers = layerNames(False)\n\n\n\ndef initExportByLayer(fileType=\"obj\", visibleonly=False, byObject=False):\n    for layerName in arrLayers:\n        layer = scriptcontext.doc.Layers.FindByFullPath(layerName, True)\n        if layer >= 0:\n            layer = scriptcontext.doc.Layers[layer]\n            save = True;\n            if visibleonly:\n                if not layer.IsVisible:\n                    save = False\n            if  rs.IsLayerEmpty(layerName):\n                save = False\n            if save:\n                cutName = layerName.split(\"::\")\n                cutName = cutName[len(cutName)-1]\n                objs = scriptcontext.doc.Objects.FindByLayer(cutName)\n                if len(objs) > 0:\n                    if byObject:\n                        i=0\n                        for obj in objs:\n                            i= i+1\n\n                            saveObjectsToFile(cutName+\"_\"+str(i), [obj], fileType)\n                    else:\n                        saveObjectsToFile(cutName, objs, fileType)\n\n\n\ndef saveObjectsToFile(name, objs, fileType):\n    rs.EnableRedraw(False)\n    if len(objs) > 0:\n        settings = settingsList[\"Get\"+fileType.upper()+\"Settings\"]()\n        rs.UnselectAllObjects()\n        for obj in objs:\n            obj.Select(True)\n        name = \"\".join(name.split(\" \"))\n        command = '-_Export \"{}{}{}\" {}'.format(filePath+fileType+\"/\", name, \".\"+fileType.lower(), settings)\n        rs.Command(command, True)\n        rs.EnableRedraw(True)\n\n\ninitExportByLayer(\"obj\",True, False)\n\nprint \"//export run ended/////////////\"",
      "language": "python",
      "author": "radio412",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "layers",
    "materials",
    "mesh",
    "python",
    "rhinoscriptsyntax"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 5,
  "views": 1548
}