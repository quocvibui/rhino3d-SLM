{
  "source_url": "https://github.com/CADacombs/rhinopython/blob/541b4ade49f1dda6a3861d12b9e2613405182082/spb_RhinoObject_MatchColor.py",
  "repo": "CADacombs/rhinopython",
  "repo_stars": 37,
  "repo_description": "Python scripts for Rhinoceros (Rhino, Rhino3D).",
  "license": "LGPL-3.0",
  "filepath": "spb_RhinoObject_MatchColor.py",
  "instruction": "This script sets a RhinoObject's Attribute's color or color source, e.g., ByLayer,\r\nto that of another object.",
  "code": "\"\"\"\r\nThis script sets a RhinoObject's Attribute's color or color source, e.g., ByLayer,\r\nto that of another object.\r\n\"\"\"\r\n\r\n#! python 2  Must be on a line less than 32.\r\nfrom __future__ import absolute_import, division, print_function, unicode_literals\r\n\r\n\"\"\"\r\n250919: Created.\r\n\"\"\"\r\n\r\nimport Rhino\r\nimport Rhino.DocObjects as rd\r\nimport Rhino.Geometry as rg\r\nimport Rhino.Input as ri\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\nfrom System import Guid\r\nfrom System.Drawing import Color\r\n\r\n\r\n_result_GUIDs = {\r\n    'Modified': [],\r\n    'AlreadyAtTarget': [],\r\n    'FailedFilter': [],\r\n    'FailedModification': [],\r\n    }\r\n\r\n_sSetResult = {\r\n    'ObjectColorSource': None,\r\n    'ObjectColor': None,\r\n    }\r\n\r\n\r\nclass Opts:\r\n\r\n    keys = []\r\n    values = {}\r\n    names = {}\r\n    riOpts = {}\r\n    listValues = {}\r\n    stickyKeys = {}\r\n\r\n\r\n    key = 'bAcceptByLayer'; keys.append(key)\r\n    values[key] = False\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n\r\n    key = 'bAcceptByParent'; keys.append(key)\r\n    values[key] = False\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n\r\n    key = 'bAcceptByMaterial'; keys.append(key)\r\n    values[key] = False\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n\r\n    key = 'bEcho'; keys.append(key)\r\n    values[key] = True\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n\r\n    key = 'bDebug'; keys.append(key)\r\n    values[key] = False\r\n    riOpts[key] = ri.Custom.OptionToggle(values[key], 'No', 'Yes')\r\n    stickyKeys[key] = '{}({})'.format(key, __file__)\r\n\r\n\r\n    for key in keys:\r\n        if key not in names:\r\n            names[key] = key[1:]\r\n\r\n\r\n    # Load sticky.\r\n    for key in stickyKeys:\r\n        if stickyKeys[key] in sc.sticky:\r\n            if key in riOpts:\r\n                riOpts[key].CurrentValue = values[key] = sc.sticky[stickyKeys[key]]\r\n            else:\r\n                # For OptionList.\r\n                values[key] = sc.sticky[stickyKeys[key]]\r\n\r\n\r\n    @classmethod\r\n    def addOption(cls, go, key):\r\n\r\n        idxOpt = None\r\n\r\n        if key in cls.riOpts:\r\n            if key[0] == 'b':\r\n                idxOpt = go.AddOptionToggle(\r\n                        cls.names[key], cls.riOpts[key])[0]\r\n            elif key[0] == 'f':\r\n                idxOpt = go.AddOptionDouble(\r\n                    cls.names[key], cls.riOpts[key])[0]\r\n            elif key[0] == 'i':\r\n                idxOpt = go.AddOptionInteger(\r\n                    englishName=cls.names[key], intValue=cls.riOpts[key])[0]\r\n        elif key in cls.listValues:\r\n            idxOpt = go.AddOptionList(\r\n                englishOptionName=cls.names[key],\r\n                listValues=cls.listValues[key],\r\n                listCurrentIndex=cls.values[key])\r\n        else:\r\n            print(\"{} is not a valid key in Opts.\".format(key))\r\n\r\n        return idxOpt\r\n\r\n\r\n    @classmethod\r\n    def setValue(cls, key, idxList=None):\r\n\r\n        if key in cls.riOpts:\r\n            sc.sticky[cls.stickyKeys[key]] = cls.values[key] = cls.riOpts[key].CurrentValue\r\n            return\r\n\r\n        if key in cls.listValues:\r\n            sc.sticky[cls.stickyKeys[key]] = cls.values[key] = idxList\r\n            return\r\n\r\n        print(\"Invalid key?\")\r\n\r\n\r\ndef getInput_toModify():\r\n    \"\"\"\r\n    \"\"\"\r\n\r\n    go = ri.Custom.GetObject()\r\n\r\n    go.SetCommandPrompt(\"Select objects to modify their color\")\r\n\r\n    #go.GeometryFilter = rd.ObjectType.Brep\r\n\r\n    idxs_Opt = {}\r\n\r\n    def addOption(key): idxs_Opt[key] = Opts.addOption(go, key)\r\n\r\n    while True:\r\n        go.ClearCommandOptions()\r\n        idxs_Opt.clear()\r\n\r\n        addOption('bAcceptByLayer')\r\n        addOption('bAcceptByParent')\r\n        addOption('bAcceptByMaterial')\r\n        addOption('bEcho')\r\n        addOption('bDebug')\r\n\r\n        res = go.GetMultiple(minimumNumber=1, maximumNumber=0)\r\n\r\n\r\n        if res == ri.GetResult.Cancel:\r\n            go.Dispose()\r\n            return\r\n\r\n        if res == ri.GetResult.Object:\r\n            objrefs = go.Objects()\r\n            go.Dispose()\r\n            return objrefs\r\n\r\n        # An option was selected.\r\n        for key in idxs_Opt:\r\n            if go.Option().Index == idxs_Opt[key]:\r\n                Opts.setValue(key, go.Option().CurrentListOptionIndex)\r\n                break\r\n\r\n\r\ndef getInput_Source():\r\n    \"\"\"\r\n    \"\"\"\r\n\r\n    go = ri.Custom.GetObject()\r\n\r\n    go.SetCommandPrompt(\"Select source object\")\r\n\r\n    #go.GeometryFilter = rd.ObjectType.Brep\r\n\r\n    idxs_Opt = {}\r\n\r\n    def addOption(key): idxs_Opt[key] = Opts.addOption(go, key)\r\n\r\n    while True:\r\n        go.ClearCommandOptions()\r\n        idxs_Opt.clear()\r\n\r\n        addOption('bAcceptByLayer')\r\n        addOption('bAcceptByParent')\r\n        addOption('bAcceptByMaterial')\r\n        addOption('bEcho')\r\n        addOption('bDebug')\r\n\r\n        res = go.Get()\r\n\r\n        if res == ri.GetResult.Cancel:\r\n            go.Dispose()\r\n            return\r\n\r\n        if res == ri.GetResult.Object:\r\n            objref = go.Object(0)\r\n            go.Dispose()\r\n            return objref\r\n\r\n        # An option was selected.\r\n        for key in idxs_Opt:\r\n            if go.Option().Index == idxs_Opt[key]:\r\n                Opts.setValue(key, go.Option().CurrentListOptionIndex)\r\n                break\r\n\r\n\r\ndef _tryFindRhinoColorName(color):\r\n    for rh_UI_NamedColor in Rhino.UI.NamedColorList.Default:\r\n        if rh_UI_NamedColor.Color == color:\r\n            return rh_UI_NamedColor.Name\r\n    return color.ToString()\r\n\r\n\r\ndef _set_Color(rdObjs_toModify, rdObj_Source):\r\n    color_Source = rdObj_Source.Attributes.ObjectColor\r\n\r\n    for rdO in rdObjs_toModify:\r\n\r\n        if (\r\n            (rdO.Attributes.ObjectColor == color_Source) and\r\n            (rdO.Attributes.ColorSource == colorSource_Source)\r\n        ):\r\n            _result_GUIDs['AlreadyAtTarget'].append(rdO.Id)\r\n            continue\r\n\r\n        if rdO.Attributes.ObjectColor != color_Source:\r\n            rdO.Attributes.ObjectColor = color_Source\r\n\r\n        if rdO.Attributes.ColorSource != rd.ObjectColorSource.ColorFromObject:\r\n            rdO.Attributes.ColorSource = rd.ObjectColorSource.ColorFromObject\r\n\r\n        if not rdO.CommitChanges():\r\n            _result_GUIDs['FailedModification'].append(rdO.Id)\r\n            continue\r\n\r\n        if (\r\n            (rdO.Attributes.ObjectColor == color_Source) and\r\n            (rdO.Attributes.ColorSource == rd.ObjectColorSource.ColorFromObject)\r\n        ):\r\n            _result_GUIDs['Modified'].append(rdO.Id)\r\n        else:\r\n            _result_GUIDs['FailedModification'].append(rdO.Id)\r\n            continue\r\n\r\n    _sSetResult['ObjectColor'] = color_Source\r\n\r\n\r\ndef _set_ColorSource(rdObjs_toModify, rdObj_Source):\r\n\r\n    colorSource_Source = rdObj_Source.Attributes.ColorSource\r\n\r\n    for rdO in rdObjs_toModify:\r\n        if rdO.Attributes.ColorSource == colorSource_Source:\r\n            _result_GUIDs['AlreadyAtTarget'].append(rdO.Id)\r\n            continue\r\n\r\n        rdO.Attributes.ColorSource = colorSource_Source\r\n\r\n        if not rdO.CommitChanges():\r\n            _result_GUIDs['FailedModification'].append(rdO.Id)\r\n            continue\r\n\r\n        if rdO.Attributes.ColorSource == rd.ObjectColorSource.ColorFromLayer:\r\n            _result_GUIDs['Modified'].append(rdO.Id)\r\n        else:\r\n            _result_GUIDs['FailedModification'].append(rdO.Id)\r\n            continue\r\n\r\n    _sSetResult['ObjectColorSource'] = colorSource_Source\r\n\r\n\r\ndef _process_ByLayer_ColorSource(rdObjs_toModify, rdObj_Source):\r\n    color_Layer = sc.doc.Layers[rdObj_Source.Attributes.LayerIndex].Color\r\n    sColor = _tryFindRhinoColorName(color_Layer)\r\n\r\n    rc, bLayerColor_notByLayer = ri.RhinoGet.GetBool(\r\n        prompt=\"Source object is ByLayer with layer color {}. Set object color to\".format(sColor),\r\n        acceptNothing=False,\r\n        offPrompt=\"ByLayer\",\r\n        onPrompt=\"LayerColor\",\r\n        boolValue=True)\r\n    if rc != Rhino.Commands.Result.Success: return\r\n\r\n    if bLayerColor_notByLayer:\r\n        for rdO in rdObjs_toModify:\r\n            if (\r\n                (rdO.Attributes.ColorSource == rd.ObjectColorSource.ColorFromObject) and\r\n                (rdO.Attributes.ObjectColor == color_Layer)\r\n            ):\r\n                _result_GUIDs['AlreadyAtTarget'].append(rdO.Id)\r\n                continue\r\n\r\n            if rdO.Attributes.ColorSource != rd.ObjectColorSource.ColorFromObject:\r\n                rdO.Attributes.ColorSource = rd.ObjectColorSource.ColorFromObject\r\n\r\n            if rdO.Attributes.ObjectColor != color_Layer:\r\n                rdO.Attributes.ObjectColor = color_Layer\r\n\r\n            if not rdO.CommitChanges():\r\n                _result_GUIDs['FailedModification'].append(rdO.Id)\r\n                continue\r\n\r\n            if (\r\n                (rdO.Attributes.ColorSource == rd.ObjectColorSource.ColorFromObject) and\r\n                (rdO.Attributes.ObjectColor == color_Layer)\r\n            ):\r\n                _result_GUIDs['Modified'].append(rdO.Id)\r\n            else:\r\n                _result_GUIDs['FailedModification'].append(rdO.Id)\r\n                continue\r\n\r\n        _sSetResult['ObjectColor'] = color_Layer\r\n\r\n    else:\r\n        _set_ColorSource(rdObjs_toModify, rdObj_Source)\r\n\r\n\r\ndef main():\r\n\r\n    rdObjs_toModify = list(\r\n        sc.doc.Objects.GetSelectedObjects(\r\n            includeLights=False,\r\n            includeGrips=False))\r\n\r\n    if not rdObjs_toModify:\r\n        #objrefs_toModify = getInput_toModify()\r\n        #if objrefs_toModify is None: return\r\n\r\n        rc, objrefs_toModify = ri.RhinoGet.GetMultipleObjects(\r\n            prompt=\"Select objects to modify their color\",\r\n            acceptNothing=False,\r\n            filter=rd.ObjectType.AnyObject)\r\n        if rc != Rhino.Commands.Result.Success: return\r\n\r\n        rdObjs_toModify = [o.Object() for o in objrefs_toModify]\r\n\r\n    sc.doc.Objects.UnselectAll()\r\n    sc.doc.Views.Redraw()\r\n\r\n    objref_Source = getInput_Source()\r\n    if objref_Source is None: return\r\n\r\n    #rc, objref_Source = ri.RhinoGet.GetOneObject(\r\n    #    prompt=\"Select source object\",\r\n    #    acceptNothing=False,\r\n    #    filter=rd.ObjectType.AnyObject)\r\n    #if rc != Rhino.Commands.Result.Success: return\r\n\r\n    sc.doc.Objects.UnselectAll()\r\n    sc.doc.Views.Redraw()\r\n\r\n    bAcceptByLayer = Opts.values['bAcceptByLayer']\r\n    bAcceptByParent = Opts.values['bAcceptByParent']\r\n    bAcceptByMaterial = Opts.values['bAcceptByMaterial']\r\n    bEcho = Opts.values['bEcho']\r\n    bDebug = Opts.values['bDebug']\r\n\r\n    rdObj_Source = objref_Source.Object()\r\n    colorSource_Source = rdObj_Source.Attributes.ColorSource\r\n\r\n    if not bAcceptByLayer:\r\n        if colorSource_Source == rd.ObjectColorSource.ColorFromLayer:\r\n            print(\"Source object color is ByLayer, so ending script.\")\r\n            return\r\n\r\n    if not bAcceptByParent:\r\n        if colorSource_Source == rd.ObjectColorSource.ColorFromParent:\r\n            print(\"Source object color is ByParent, so ending script..\")\r\n            return\r\n\r\n    if not bAcceptByMaterial:\r\n        if colorSource_Source == rd.ObjectColorSource.ColorFromMaterial:\r\n            print(\"Source object color is ByMaterial, so ending script.\")\r\n            return\r\n\r\n    if colorSource_Source == rd.ObjectColorSource.ColorFromLayer:\r\n        _process_ByLayer_ColorSource(rdObjs_toModify, rdObj_Source)\r\n    elif colorSource_Source != rd.ObjectColorSource.ColorFromObject:\r\n        _set_ColorSource(rdObjs_toModify, rdObj_Source)\r\n    else:\r\n        _set_Color(rdObjs_toModify, rdObj_Source)\r\n\r\n    if _sSetResult['ObjectColorSource']:\r\n        print(\"Resultant object color source: {}\".format(_sSetResult['ObjectColor']))\r\n    if _sSetResult['ObjectColor']:\r\n        print(\"Resultant object color: {}\".format(\r\n            _tryFindRhinoColorName(_sSetResult['ObjectColor'])))\r\n\r\n\r\n    if len(_result_GUIDs['AlreadyAtTarget']) == len(rdObjs_toModify):\r\n        print(\"All {} objects are already at target color.\".format(len(rdObjs_toModify)))\r\n        return\r\n\r\n    for key in _result_GUIDs:\r\n        if _result_GUIDs[key]:\r\n            print(\"{} {}\".format(len(_result_GUIDs[key]), key))\r\n\r\n    sc.doc.Views.Redraw()\r\n\r\n\r\nif __name__ == '__main__': main()",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}