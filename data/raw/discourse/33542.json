{
  "source_url": "https://discourse.mcneel.com/t/excel-reading-limitation/33542",
  "topic_id": 33542,
  "title": "Excel Reading Limitation",
  "question": "I’m using \nBumblebee\n to read data into Rhino. My Excel files have about 500 000 rows each but I cannot get in more than ± 65 000 rows into Grasshopper at a time. In the old days, Excel had a limit of 65 000 rows but since 2007 one file can contain up to 1 048 576 rows.\n\n\nDoes anybody know if it’s possible (and how) to go beyond the 65K lines?\n\n\nThe Bumblebee gh userobject is as follows:\n\n\n\nOption Strict Off\nOption Explicit On\n\nImports Rhino\nImports Rhino.Geometry\nImports Rhino.DocObjects\nImports Rhino.Collections\n\nImports GH_IO\nImports GH_IO.Serialization\nImports Grasshopper\nImports Grasshopper.Kernel\nImports Grasshopper.Kernel.Data\nImports Grasshopper.Kernel.Types\n\nImports System\nImports System.IO\nImports System.Xml\nImports System.Xml.Linq\nImports System.Linq\nImports System.Data\nImports System.Drawing\nImports System.Reflection\nImports System.Collections\nImports System.Windows.Forms\nImports Microsoft.VisualBasic\nImports System.Collections.Generic\nImports System.Runtime.InteropServices\n\n\n\n''' <summary>\n''' This class will be instantiated on demand by the Script component.\n''' </summary>\nPublic Class Script_Instance\n  Inherits GH_ScriptInstance\n\n  #Region \"Utility functions\"\n  ''' <summary>Print a String to the [Out] Parameter of the Script component.</summary>\n  ''' <param name=\"text\">String to print.</param>\n  Private Sub Print(ByVal text As String)\n    __out.Add(text)\n  End Sub\n  ''' <summary>Print a formatted String to the [Out] Parameter of the Script component.</summary>\n  ''' <param name=\"format\">String format.</param>\n  ''' <param name=\"args\">Formatting parameters.</param>\n  Private Sub Print(ByVal format As String, ByVal ParamArray args As Object())\n    __out.Add(String.Format(format, args))\n  End Sub\n  ''' <summary>Print useful information about an object instance to the [Out] Parameter of the Script component. </summary>\n  ''' <param name=\"obj\">Object instance to parse.</param>\n  Private Sub Reflect(ByVal obj As Object)\n    __out.Add(GH_ScriptComponentUtil...",
  "code_blocks": [
    {
      "code": "Option Strict Off\nOption Explicit On\n\nImports Rhino\nImports Rhino.Geometry\nImports Rhino.DocObjects\nImports Rhino.Collections\n\nImports GH_IO\nImports GH_IO.Serialization\nImports Grasshopper\nImports Grasshopper.Kernel\nImports Grasshopper.Kernel.Data\nImports Grasshopper.Kernel.Types\n\nImports System\nImports System.IO\nImports System.Xml\nImports System.Xml.Linq\nImports System.Linq\nImports System.Data\nImports System.Drawing\nImports System.Reflection\nImports System.Collections\nImports System.Windows.Forms\nImports Microsoft.VisualBasic\nImports System.Collections.Generic\nImports System.Runtime.InteropServices\n\n\n\n''' <summary>\n''' This class will be instantiated on demand by the Script component.\n''' </summary>\nPublic Class Script_Instance\n  Inherits GH_ScriptInstance\n\n  #Region \"Utility functions\"\n  ''' <summary>Print a String to the [Out] Parameter of the Script component.</summary>\n  ''' <param name=\"text\">String to print.</param>\n  Private Sub Print(ByVal text As String)\n    __out.Add(text)\n  End Sub\n  ''' <summary>Print a formatted String to the [Out] Parameter of the Script component.</summary>\n  ''' <param name=\"format\">String format.</param>\n  ''' <param name=\"args\">Formatting parameters.</param>\n  Private Sub Print(ByVal format As String, ByVal ParamArray args As Object())\n    __out.Add(String.Format(format, args))\n  End Sub\n  ''' <summary>Print useful information about an object instance to the [Out] Parameter of the Script component. </summary>\n  ''' <param name=\"obj\">Object instance to parse.</param>\n  Private Sub Reflect(ByVal obj As Object)\n    __out.Add(GH_ScriptComponentUtilities.ReflectType_VB(obj))\n  End Sub\n  ''' <summary>Print the signatures of all the overloads of a specific method to the [Out] Parameter of the Script component. </summary>\n  ''' <param name=\"obj\">Object instance to parse.</param>\n  Private Sub Reflect(ByVal obj As Object, ByVal method_name As String)\n    __out.Add(GH_ScriptComponentUtilities.ReflectType_VB(obj, method_name))\n  End Sub\n#End Region\n  \n#Region \"Members\"\n  ''' <summary>Gets the current Rhino document.</summary>\n  Private RhinoDocument As RhinoDoc\n  ''' <summary>Gets the Grasshopper document that owns this script.</summary>\n  Private GrasshopperDocument as GH_Document\n  ''' <summary>Gets the Grasshopper script component that owns this script.</summary>\n  Private Component As IGH_Component\n  ''' <summary>\n  ''' Gets the current iteration count. The first call to RunScript() is associated with Iteration=0.\n  ''' Any subsequent call within the same solution will increment the Iteration count.\n  ''' </summary>\n  Private Iteration As Integer\n#End Region\n\n  ''' <summary>\n  ''' This procedure contains the user code. Input parameters are provided as ByVal arguments, \n  ''' Output parameter are ByRef arguments. You don't have to assign output parameters, \n  ''' they will have default values.\n  ''' </summary>\n  Private Sub RunScript(ByVal XL_Path As List(Of Object), ByVal Origin As Point3d, ByVal Bound As Point3d, ByVal ByColumn As Boolean, ByVal Type As Integer, ByVal _Stream As Boolean, ByRef A As Object, ByRef B As Object, ByRef Data As Object) \n    Component.Params.Input(0).Name = \"Path\"\n    Component.Params.Input(0).Description = \"Optional input for the XL Path component which specifies the Target Workbook and Sheet. If blank the active workbook and worksheet is used, or the worksheet index supplied by an origin component\"\n    Component.Params.Input(1).Name = \"Data Origin\"\n    Component.Params.Input(1).Description = \"Optional point input which specifies the lower bounds from which data will be read where X = Row, Y = Column, and Z = Sheet Index. If Z = 0 the active sheet will be used. If input is empty first used cell on active sheet will be used\"\n    Component.Params.Input(2).Name = \"Data Bound\"\n    Component.Params.Input(2).Description = \"Optional point input which specifies the upper bounds from which data will be read where X = Row, Y = Column, and Z = Sheet Index. If Z = 0 the active sheet will be used, If input is empty last used cell on active sheet will be used\"\n    Component.Params.Input(3).Name = \"By Column\"\n    Component.Params.Input(3).Description = \"Sets if data will be transposed\"\n    Component.Params.Input(4).Name = \"Type\"\n    Component.Params.Input(4).Description = \"Optional input for the XL Data Type component or integer value specifying the type of data being read [Value = 0, Value2 = 1, Formula = 2, FormulaLocal = 3, FormulaR1C1 = 4, FormulaR1C1Local = 5]\"\n    Component.Params.Input(5).Name = \"Stream\"\n    Component.Params.Input(5).Description = \"If true, data will be read\"\n\n    Component.Params.Output(1).Name = \"Origin\"\n    Component.Params.Output(1).Description = \"List output of points which specify the lower bounds of read data\"\n    Component.Params.Output(2).Name = \"Bound\"\n    Component.Params.Output(2).Description = \"List output of points which specify the upper bounds of read data\"\n    Component.Params.Output(3).Name = \"Data\"\n    Component.Params.Output(3).Description = \"Datatree of generic data read from Excel\"\n    If _Stream = True Then\n      'If _LIVE = True Then owner.ExpireSolution(True)\n\n      Dim objExcel, excelWorkbook, excelSheet As Object\n\n      If XL_Path.Count() > 1 Then\n        objExcel = XL_Path.item(0)\n        excelWorkbook = XL_Path.item(1)\n        excelSheet = XL_Path.item(2)\n      Else\n        Dim oldCI As System.Globalization.CultureInfo = system.Threading.Thread.CurrentThread.CurrentCulture\n        System.Threading.Thread.CurrentThread.CurrentCulture = New System.Globalization.CultureInfo(\"en-US\")\n\n        'Access Active Session of Excel if no Path is specified\n\n        objExcel = System.Runtime.InteropServices.Marshal.GetActiveObject(\"Excel.Application\")\n        excelWorkbook = objExcel.activeWorkbook\n        excelSheet = objExcel.ActiveSheet\n      End If\n\n      objExcel.screenUpdating = False\n\n      Dim arrStr As New datatree(Of Object)\n      Dim i,j,k,m,n As Integer\n\n      If XL_Path.count() <= 1 Then\n        If CInt(origin.z) = 0 Then\n          n = 0\n          excelSheet = objExcel.ActiveSheet\n        ElseIf CInt(bound.z) = 0 Then\n          n = 0\n          excelSheet = excelWorkbook.Sheets.item(CInt(origin.Z))\n        Else\n          n = (bound.z - origin.z)\n          excelSheet = excelWorkbook.Sheets.item(CInt(origin.Z))\n        End If\n      End If\n\n      'specify a range in excel and stream data\n      For m = 0 To n Step 1\n        If m <> 0 Then\n          excelSheet = excelWorkbook.Sheets.item(CInt(origin.Z + n))\n        End If\n\n        If Origin = Nothing Then\n          Origin.Y = excelSheet.usedrange.row\n          Origin.X = excelSheet.usedrange.column\n        End If\n        If Bound = Nothing Then\n          Bound.Y = excelSheet.usedrange.rows(excelSheet.usedrange.rows.count).row\n          Bound.X = excelSheet.usedrange.columns(excelSheet.usedrange.columns.count).column\n        End If\n        Dim rng As Object\n        If (origin.x = bound.x) And (origin.y = bound.y) Then\n          arrStr.add(excelSheet.Cells(Origin.Y, Origin.X).value, New GH_Path(0))\n        Else\n\n          If type = 1 Then\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).value2\n          ElseIf type = 2 Then\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).formula\n          ElseIf type = 3 Then\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).formulalocal\n          ElseIf type = 4 Then\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).FormulaR1C1\n          ElseIf type = 5 Then\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).FormulaR1C1Local\n          Else\n            rng = excelSheet.Range(excelSheet.Cells(Origin.Y, Origin.X), excelSheet.Cells(Bound.Y, Bound.X)).value\n          End If\n\n          If ByColumn = True Then\n            rng = objExcel.transpose(rng)\n          End If\n          k = 0\n          For i = LBound(rng, 1) To UBound(rng, 1) Step 1\n            For j = LBound(rng, 2) To UBound(rng, 2) Step 1\n              If n = 0 Then\n                arrStr.add(rng(i, j), New GH_Path(k))\n              Else\n                arrStr.add(rng(i, j), New GH_Path({m,k}))\n              End If\n            Next\n          k = k + 1\n          Next\n        End If\n      Next\n      excelSheet.activate\n      objExcel.screenUpdating = True\n\n      A = New point3d(Origin.x, origin.Y, excelSheet.Index)\n      B = New point3d(Bound.x, Bound.Y, excelSheet.Index)\n      Data = arrStr\n\n    End If\n  End Sub \n\n  '<Custom additional code> \n\n  '</Custom additional code> \n\n  Private __err As New List(Of String)\n  Private __out As New List(Of String)\n  Private doc As RhinoDoc = RhinoDoc.ActiveDoc            'Legacy field.\n  Private owner As Grasshopper.Kernel.IGH_ActiveObject    'Legacy field.\n  Private runCount As Int32                               'Legacy field.\n  \n  Public Overrides Sub InvokeRunScript(ByVal owner As IGH_Component, _\n                                       ByVal rhinoDocument As Object, _\n                                       ByVal iteration As Int32, _\n                                       ByVal inputs As List(Of Object), _\n                                       ByVal DA As IGH_DataAccess) \n    'Prepare for a new run...\n    '1. Reset lists\n    Me.__out.Clear()\n    Me.__err.Clear()\n\n    'Current field assignments.\n    Me.Component = owner\n    Me.Iteration = iteration\n    Me.GrasshopperDocument = owner.OnPingDocument()\n    Me.RhinoDocument = TryCast(rhinoDocument, Rhino.RhinoDoc)\n\n    'Legacy field assignments\n    Me.owner = Me.Component\n    Me.runCount = Me.Iteration\n    Me.doc = Me.RhinoDocument\n\n    '2. Assign input parameters\n    Dim XL_Path As List(Of System.Object) = Nothing\n    If (inputs(0) IsNot Nothing) Then\n      XL_Path = GH_DirtyCaster.CastToList(Of System.Object)(inputs(0))\n    End If\n\n    Dim Origin As Point3d = Nothing\n    If (inputs(1) IsNot Nothing) Then\n      Origin = DirectCast(inputs(1), Point3d)\n    End If\n\n    Dim Bound As Point3d = Nothing\n    If (inputs(2) IsNot Nothing) Then\n      Bound = DirectCast(inputs(2), Point3d)\n    End If\n\n    Dim ByColumn As Boolean = Nothing\n    If (inputs(3) IsNot Nothing) Then\n      ByColumn = DirectCast(inputs(3), Boolean)\n    End If\n\n    Dim Type As Integer = Nothing\n    If (inputs(4) IsNot Nothing) Then\n      Type = DirectCast(inputs(4), Integer)\n    End If\n\n    Dim _Stream As Boolean = Nothing\n    If (inputs(5) IsNot Nothing) Then\n      _Stream = DirectCast(inputs(5), Boolean)\n    End If\n\n\n\n    '3. Declare output parameters\n  Dim A As System.Object = Nothing\n  Dim B As System.Object = Nothing\n  Dim Data As System.Object = Nothing\n\n\n    '4. Invoke RunScript\n    Call RunScript(XL_Path, Origin, Bound, ByColumn, Type, _Stream, A, B, Data)\n\n    Try\n      '5. Assign output parameters to component...\n      If (A IsNot Nothing) Then\n        If (GH_Format.TreatAsCollection(A)) Then\n          Dim __enum_A As IEnumerable = DirectCast(A, IEnumerable)\n          DA.SetDataList(1, __enum_A)\n        Else\n          If (TypeOf A Is Grasshopper.Kernel.Data.IGH_DataTree) Then\n            'merge tree\n            DA.SetDataTree(1, DirectCast(A, Grasshopper.Kernel.Data.IGH_DataTree))\n          Else\n            'assign direct\n            DA.SetData(1, A)\n          End If\n        End If\n      Else\n        DA.SetData(1, Nothing)\n      End If\n      If (B IsNot Nothing) Then\n        If (GH_Format.TreatAsCollection(B)) Then\n          Dim __enum_B As IEnumerable = DirectCast(B, IEnumerable)\n          DA.SetDataList(2, __enum_B)\n        Else\n          If (TypeOf B Is Grasshopper.Kernel.Data.IGH_DataTree) Then\n            'merge tree\n            DA.SetDataTree(2, DirectCast(B, Grasshopper.Kernel.Data.IGH_DataTree))\n          Else\n            'assign direct\n            DA.SetData(2, B)\n          End If\n        End If\n      Else\n        DA.SetData(2, Nothing)\n      End If\n      If (Data IsNot Nothing) Then\n        If (GH_Format.TreatAsCollection(Data)) Then\n          Dim __enum_Data As IEnumerable = DirectCast(Data, IEnumerable)\n          DA.SetDataList(3, __enum_Data)\n        Else\n          If (TypeOf Data Is Grasshopper.Kernel.Data.IGH_DataTree) Then\n            'merge tree\n            DA.SetDataTree(3, DirectCast(Data, Grasshopper.Kernel.Data.IGH_DataTree))\n          Else\n            'assign direct\n            DA.SetData(3, Data)\n          End If\n        End If\n      Else\n        DA.SetData(3, Nothing)\n      End If\n\n    Catch ex As Exception\n      __err.Add(String.Format(\"Script exception: {0}\", ex.Message))\n    Finally\n      'Add errors and messages...\n      If (owner.Params.Output.Count > 0) Then\n        If (TypeOf owner.Params.Output(0) Is Grasshopper.Kernel.Parameters.Param_String) Then\n          Dim __errors_plus_messages As New List(Of String)\n          If (Me.__err IsNot Nothing) Then __errors_plus_messages.AddRange(Me.__err)\n          If (Me.__out IsNot Nothing) Then __errors_plus_messages.AddRange(Me.__out)\n          If (__errors_plus_messages.Count > 0) Then\n            DA.SetDataList(0, __errors_plus_messages)\n          End If\n        End If\n      End If\n    End Try\n  End Sub \nEnd Class",
      "language": "unknown",
      "author": "wim",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "geometry",
    "grasshopper",
    "python",
    "rhinocommon"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 4,
  "views": 1923
}