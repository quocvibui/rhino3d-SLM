{
  "source_url": "https://github.com/deswaks/space-invader/blob/94e00bff3b5371cfa6999f381461af9af6e0b0ba/ghpython%20component%20source%20code/gbXML_export.py",
  "repo": "deswaks/space-invader",
  "repo_stars": 0,
  "repo_description": "Tools for locating and reconstructing analytical building spaces with Rhino Grasshopper",
  "license": "MIT",
  "filepath": "ghpython component source code/gbXML_export.py",
  "instruction": "Export rooms to gbXML\nInput:\n    rooms [brep] - Solid of the rooms to export\n    path [path] - Place to save the gbXML",
  "code": "\"\"\" Export rooms to gbXML\nInput:\n    rooms [brep] - Solid of the rooms to export\n    path [path] - Place to save the gbXML\n\"\"\"\nimport rhinoscriptsyntax as rs\nimport ghpythonlib.components as ghc\nimport Rhino.Geometry as rg\nimport ghpythonlib.treehelpers as ght\n\ndef brep_area(brep, plane):\n    \"\"\" Computes plane area of a brep\"\"\"\n    section_curve = ghc.BrepXPlane(brep,plane)[0]\n    area = ghc.Area(section_curve)[0]\n    return area\n\ndef get_spatial_data(breps):\n    \"\"\" Creates a dictionary with volume and area of the breps\"\"\"\n    spatial_data = {\"area\":[],\"volume\":[]}\n    for i, room_brep in enumerate(breps):\n        # Get volume\n        room_volume, room_centroid = ghc.Volume(room_brep)\n        spatial_data[\"volume\"].append(int(room_volume))\n        # Get Area\n        room_area = brep_area(room_brep, ghc.XYPlane(room_centroid))\n        spatial_data[\"area\"].append(int(room_area))\n    return spatial_data\n\ndef brep_polyloops(brep):\n    \"\"\" Returns the polyloop of all faces for a brep\"\"\"\n    faces = ghc.DeconstructBrep(brep)[0]\n    polyloops = []\n    for face in faces:\n        edges = ghc.DeconstructBrep(face)[1]\n        polyline = ghc.JoinCurves(edges, False)\n        vertices = ghc.Explode(polyline, recursive=True)[1]\n        polyloops.append(vertices)\n    return polyloops\n\ndef room_xml_string(room_brep, i):\n    # Header for string concatenation\n    XML_room_header = '''\\n        <Space id=\"sp-%i-Open\" zoneIdRef=\"zone-Default\">\n            <Name>%i Open</Name>\n            <Area>%i</Area>\n            <Volume>%i</Volume>\n            <ShellGeometry id=\"sg-sp-%i-Open\" unit=\"mm\">\n                <ClosedShell>''' %(i,i,spatial_data[\"area\"][i],spatial_data[\"volume\"][i],i)\n    \n    # Goemetry strings for string concatenation\n    XML_room_polyloops = \"\"\n    polyloops = brep_polyloops(room_brep)\n    for polyloop in polyloops:\n        XML_room_polyloops += \"\\n\\t\\t\\t\\t\\t<PolyLoop>\"\n        for point in polyloop:\n            XML_room_polyloops += \"\\n\"+\"\\t\"*6+\"<CartesianPoint>\"\n            for coordinate in point:\n                XML_room_polyloops += \"\\n\"+\"\\t\"*7+\"<Coordinate>%i<Coordinate>\" %int(coordinate)\n            XML_room_polyloops += \"\\n\"+\"\\t\"*6+\"</CartesianPoint>\"\n        XML_room_polyloops += \"\\n\\t\\t\\t\\t\\t</PolyLoop>\"\n    \n    # Footer for string concatenation\n    XML_room_footer = '''</ClosedShell>\n                <AnalyticalShell>\n                </AnalyticalShell>\n            </ShellGeometry>\n        </Space>'''\n    return XML_room_header + XML_room_polyloops + XML_room_footer\n\n\n# Open file and create list to write\nxml = open(path, \"w\")\n\n# Get volume and area\nspatial_data = get_spatial_data(rooms)\n\n# Write header and open tags\nXML_header = '''<Campus id=\"cmps-1\">\n    <Building id=\"bldg-1\" buildingType=\"Office\">\n        <Area>%i</Area>''' % sum(spatial_data[\"area\"])\nxml.write(XML_header)\n\n# Write rooms\nfor i, room_brep in enumerate(rooms):\n    xml.write(room_xml_string(room_brep, i))\n\n# Write Close tags\nXML_footer = '''</Building>\\n</Campus>'''\nxml.write(XML_footer)\n\n# close file\nxml.close()",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}