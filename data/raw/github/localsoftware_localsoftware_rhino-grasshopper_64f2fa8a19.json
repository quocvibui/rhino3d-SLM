{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/plugin_files/Create_Pickle_View.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "plugin_files/Create_Pickle_View.py",
  "instruction": "Create pickle view",
  "code": "﻿from ghpythonlib.componentbase import dotnetcompiledcomponent as component\nimport Grasshopper, GhPython, System, Rhino, os, math\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport cPickle as pickle\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\n\nclass MyComponent(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\n            \"CreatePickleView\", \"CreatePickleView\", \"\"\"Serializes Rhino view data into a binary file.\nReturns a pickled file with view information to be set up in Rhino.\nBased on the work of Jackie Berry.\n    Typical usage:\nInput a geometry (make sure to only input one geometry), and Azimuth and Altitude angles for the view.\nSet a path with a panel to export the Pickled View to. Finally use a Boolean Toggle to activate the component.\nYou can use the component’s outputs to set a view and visualize the results of the parameters used to create the view.\"\"\", \"Extra\", \"LocalCode\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"7604b8c9-36bf-4577-a712-6a8f3da4bc86\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"data\", \"data\", \"geometry or data to serialize\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Number()\n        self.SetUpParam(p, \"azimuth\", \"azimuth\", \"rotation in XY of camera angle.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_Number()\n        self.SetUpParam(p, \"altitude\", \"altitude\", \"vertical rotation of camera angle.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"siteNumber\", \"siteNumber\", \"local code site number (sort of optional)\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"layer\", \"layer\", \"name of file\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"path\", \"path\", \"path of directory for target binary file.\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n        p = GhPython.Assemblies.MarshalParam()\n        self.SetUpParam(p, \"write\", \"write\", \"boolean\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"geometry\", \"geometry\", \"if successful, a data tree with serialized geometry\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"view_vector\", \"view_vector\", \"a vector specifying the camera angle\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"view_target\", \"view_target\", \"a 3D point specifying the camera target (center of geom bbox)\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"status\", \"status\", \"Script variable CreatePickleView\")\n        self.Params.Output.Add(p)\n        \n    \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        p1 = self.marshal.GetInput(DA, 1)\n        p2 = self.marshal.GetInput(DA, 2)\n        p3 = self.marshal.GetInput(DA, 3)\n        p4 = self.marshal.GetInput(DA, 4)\n        p5 = self.marshal.GetInput(DA, 5)\n        p6 = self.marshal.GetInput(DA, 6)\n        result = self.RunScript(p0, p1, p2, p3, p4, p5, p6)\n\n        if result is not None:\n            if not hasattr(result, '__getitem__'):\n                self.marshal.SetOutput(result, DA, 0, True)\n            else:\n                self.marshal.SetOutput(result[0], DA, 0, True)\n                self.marshal.SetOutput(result[1], DA, 1, True)\n                self.marshal.SetOutput(result[2], DA, 2, True)\n                self.marshal.SetOutput(result[3], DA, 3, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAHYcAAB2HAY/l8WUAAAPnSURBVEhL3VVpaFNZFH5pTF986SRtYjutGmKqrY00RsclW7OYqLgLIqKIC1W0KkVc60LBP27gTGcYyQ+RgUHQqvjDhSr+UBBR6gLuG9Zaly5irbY2Vrt8nvteXtI0LRVk/syBj7x37/m+c94959xw/08TBOWfOTma0zkjfhDkazZpThN1qaTQj9nH62qbmwL4VOfFp9r+0fzBjzvXnOA4xcGIRJ9mVicrD7mc2nDRKiOKVgztG4VDUVxkxI4tw7BxvQnLFw9Gbm5KDWmUEtSiWg+z+R36dw/vOdHRSlnVOXtFC+HbBzfQ7kP1Ewc2FZtw5rgV4c8e4vlQcWYsjEbhOumlSrKSpVgsmqqWRh8AP9DqAcLeRIDtB9FY60HpjuEI+tNRuMyIuTMzgY5JQBvzCeD+TTv0Or4ioi1a6aVzY2mTnJpJvKUHIsLVT10o2WzGIAOPnVuy0d5G/piKieP0OH/KRs+UHOOTb6gsj2rCLWTivMetf4lOcmaZM0GWyTeWDREoo3u37Fi90giNoGIkEaEyC06U22DL14rvs6dniL6go2L89hYf8kZqKlmA/NKSbGlTjD4Jre88aKgpwPUrE7BgfhaUSUlR4b6gUCThwY2JQGfsK4pWZH2lPc5Vtj9PCkDi5UesGJGdgrQ0NREVUYFUbTIO/mXBwzt2nCwfTT6a6J6M5YuHiMLSsQawfXM2W+ccB/aMpIXJqHrsxEB17BhkqFRKXLs8njongBNH8tHwtgANb7zIymRJxPx4Xoka0kAHq1kAWzeYu2hdDhDE+zcF+DUjnsQQ8Btofwo8Lr34rk/l0UUF3r5pWILvhnUmUbyXANLigd25CaQ5M1kBp8BkFKJrX5q82LtreJyfhCTUV9Oc0IkkBvjqxce6AujT+DiSTqtCPRX92SMH1tAUXzg7ho5hMqyRDpJhs+oQ+tuCz41SkRMDiMUJ0qeb44gMrB1vV9qpfYN49cKN2dPSo3setwEnj45GZ1hqa7Hd6bf3AHQF1D53QRg4IC6ADC11k/w8a0YGLlb8Jk0xG9Iw8ZlGpIt6DxD5itWFxjjhGBRYtGAwKq9OkDjy1SJzoxrdAvy+t0eATh+eUb8rlbEBY5kXrzXh8V1HTJhNbXfR7iCfko1SAOcf+3oEYER6nzc3EwY9L15sr6tYZ9AQdVGPdxfqC8TfJtWSM6+ju59dWuiI3EEMJNRc58bHt1LLiRnLe/2BToC19cL56W0sAJeRzh8/9q8VNVTc+heEKgI9N712o4mGjz2Laz8C6rBq8j8cGgXdL6qQGIBMRVgpCMkhg0H9jyHtJ0B8QVCxv84lBAUT/w+N474Dx530k5e70fcAAAAASUVORK5CYII=\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n\n    def RunScript(self, data, azimuth, altitude, siteNumber, layer, path, Write):\n        geometry, view_vector, view_target, status = None, None, None, None\n        if data ==None:\n            self.AddRuntimeMessage(RML.Warning,\"Add data as input.\")\n        if path ==None:\n            self.AddRuntimeMessage(RML.Warning,\"Add a path.\")\n        if Write == None:\n            self.AddRuntimeMessage(RML.Warning,\"Add a boolean toggle in the 'Write' input.\")\n            \n            \n        if path!=None and len(data)>0 and write==True and azimuth!=None and altitude!=None:\n            bbox = rs.BoundingBox(data)\n            centroid = [0,0,0]\n            for pt in bbox:\n                centroid = [centroid[0]+pt[0]/8, centroid[1]+pt[1]/8, centroid[2]+pt[2]/8]\n            target = rs.AddPoint(centroid)\n            target = rs.coerce3dpoint(target)\n\n            # convert angles to radians\n            azimuth = azimuth*2*math.pi/360\n            altitude = altitude*2*math.pi/360\n            X = centroid[0] + math.cos(azimuth)\n            Y = centroid[1] + math.sin(azimuth)\n            Z = centroid[2] + math.sin(altitude)\n            cam_pos = [X, Y, Z]\n\n            vector = rs.VectorCreate(centroid, cam_pos)\n            vector = rs.coerce3dvector(vector)\n\n            try:\n                if siteNumber!=None:\n                    filename = os.path.join(path,str(int(siteNumber))+layer)\n                else:\n                    filename = os.path.join(path,layer)\n\n                outdata=[]\n                outdata+=data\n                outdata+=[target]\n                outdata+=[vector]\n\n                f = open(filename, 'wb')\n                pickle.dump(outdata, f, -1)\n\n                f.close()\n                fcheck = open(filename,'rb')\n                checkdata = pickle.load(fcheck)\n                if len(checkdata)>2:\n                    geometry=checkdata[:-2]\n                    view_target=checkdata[-2]\n                    view_vector=checkdata[-1]\n                    status = \"View and geometry pickled successfully.\"\n                else:\n                    status = \"It looks like the file didn't save correctly. \\nTry the pickleData and UnpickleData components to debug.\"\n                fcheck.close()\n            except:\n                status = \"Unable to pickle the view file. \\nThe path your provided may be invalid.\"\n        else:\n            if not len(data)>0:\n                status = \"specify objects (data) in view to pickle.\"\n            if azimuth==None:\n                status = \"specify view angle azimuth.\"\n            if altitude==None:\n                status = \"specify view angle altitude.\"\n            if layer==None:\n                status = \"specify file layer name.\"\n            if path==None:\n                status = \"specify path to target directory\"\n            if Write!=True:\n                status = \"set write to True to pickle view\"\n\n        # return outputs\n        return (geometry, view_vector, view_target, status)\n\n\nimport GhPython\nimport System\n\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\n    def get_AssemblyName(self):\n        return \"CreatePickleView\"\n    \n    def get_AssemblyDescription(self):\n        return \"\"\"\"\"\"\n\n    def get_AssemblyVersion(self):\n        return \"0.1\"\n\n    def get_AuthorName(self):\n        return \"\"\n    \n    def get_Id(self):\n        return System.Guid(\"ecc81d21-8891-4a63-871b-d9ccbc9558f5\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}