{
  "source_url": "https://github.com/a01110946/timber_framing_generator/blob/0b689e23c0ee24a9cfbdf280b219f659a54afd43/src/timber_framing_generator/framing_elements/location_data.py",
  "repo": "a01110946/timber_framing_generator",
  "repo_stars": 3,
  "repo_description": "A Python tool bridging Revit and Rhino through Rhino.Inside.Revit to automate timber frame design. Processes Revit walls to generate complete framing solutions including studs, plates, headers, and cripples. Features intelligent wall decomposition, opening analysis, and automated documentation generation.",
  "license": "unknown",
  "filepath": "src/timber_framing_generator/framing_elements/location_data.py",
  "instruction": "File: timber_framing_generator/framing_elements/location_data.py",
  "code": "# File: timber_framing_generator/framing_elements/location_data.py\n\n# First, detect the environment and import appropriate modules\nimport sys\nimport os\n\n# Check if we're running in Grasshopper/Rhino\nis_rhino_environment = 'rhinoscriptsyntax' in sys.modules or 'Rhino' in sys.modules\n\n# Try to import rhinoinside and Rhino.Geometry\ntry:\n    import rhinoinside\n    rhinoinside.load()\n    import Rhino.Geometry as rg\nexcept ImportError:\n    # Fall back based on environment\n    if not is_rhino_environment:\n        # Only import rhinoinside if we're not already in Rhino\n        import rhinoinside\n        rhinoinside.load()\n    \n    # Import Rhino.Geometry directly if we're already in Rhino\n    import Rhino.Geometry as rg\n\nfrom typing import Dict, List, Tuple, Optional, Union\nfrom dataclasses import dataclass\n\n\n@dataclass\nclass WallCornerPoints:\n    \"\"\"\n    Stores and validates wall corner points in a consistent order.\n\n    The corner points are stored in this order:\n    - bottom_left (0)  - bottom_right (1)\n    - top_right (2)    - top_left (3)\n    \"\"\"\n\n    bottom_left: rg.Point3d\n    bottom_right: rg.Point3d\n    top_right: rg.Point3d\n    top_left: rg.Point3d\n\n    @classmethod\n    def from_corner_points(cls, points: List[rg.Point3d]) -> \"WallCornerPoints\":\n        \"\"\"\n        Creates a WallCornerPoints instance from a list of points,\n        validating the order and structure.\n\n        Args:\n            points: List of 4 corner points from the wall boundary cell\n\n        Returns:\n            WallCornerPoints instance with validated corner points\n\n        Raises:\n            ValueError: If points list doesn't contain exactly 4 points\n            TypeError: If any point is not a Rhino.Geometry.Point3d\n        \"\"\"\n        if len(points) != 4:\n            raise ValueError(f\"Expected 4 corner points, got {len(points)}\")\n\n        if not all(isinstance(p, rg.Point3d) for p in points):\n            raise TypeError(\"All points must be Rhino.Geometry.Point3d objects\")\n\n        return cls(\n            bottom_left=points[0],\n            bottom_right=points[1],\n            top_right=points[2],\n            top_left=points[3],\n        )\n\n\ndef get_plate_location_data(\n    wall_data: Dict[str, Union[str, rg.Curve, float, bool, List, rg.Plane]],\n    plate_type: str = \"bottom_plate\",\n    representation_type: str = \"structural\",\n) -> Dict[str, Union[rg.Curve, rg.Plane, float, str]]:\n    \"\"\"\n    Extracts pure location data for plates without making geometry decisions.\n\n    Args:\n        wall_data: Dictionary containing wall information and cells\n        plate_type: Type of plate to locate. Valid options are:\n                   \"bottom_plate\", \"top_plate\", \"cap_plate\", \"sole_plate\"\n        representation_type: How the plate should be represented. Valid options are:\n                           \"structural\" (true center location) or\n                           \"schematic\" (visual representation location)\n\n    Returns:\n        Dictionary containing:\n            - reference_line: rg.Curve - The base line from wall geometry\n            - base_plane: rg.Plane - The wall's base plane for orientation\n            - reference_elevation: float - Elevation for positioning\n            - wall_type: str - Original wall type name for reference\n            - representation_type: str - The requested representation type\n\n    Raises:\n        ValueError: If wall boundary cell (WBC) is not found\n        ValueError: If plate_type is not recognized\n        ValueError: If representation_type is not \"structural\" or \"schematic\"\n    \"\"\"\n    # Validate representation_type\n    if representation_type not in [\"structural\", \"schematic\"]:\n        raise ValueError(\n            f\"representation_type must be 'structural' or 'schematic', got '{representation_type}'\"\n        )\n\n    # Find wall boundary cell\n    wbc_cell = next(\n        (cell for cell in wall_data[\"cells\"] if cell[\"cell_type\"] == \"WBC\"), None\n    )\n    if wbc_cell is None:\n        raise ValueError(\"Wall Boundary Cell (WBC) not found in wall data\")\n\n    # Validate and organize corner points\n    corner_points = WallCornerPoints.from_corner_points(wbc_cell[\"corner_points\"])\n    base_plane = wall_data[\"base_plane\"]\n\n    # Select points and elevation based on plate type\n    if plate_type in [\"bottom_plate\", \"sole_plate\"]:\n        start_point = corner_points.bottom_left\n        end_point = corner_points.bottom_right\n        reference_elevation = wall_data[\"wall_base_elevation\"]\n    elif plate_type in [\"top_plate\", \"cap_plate\"]:\n        start_point = corner_points.top_left\n        end_point = corner_points.top_right\n        reference_elevation = wall_data[\"wall_top_elevation\"]\n    else:\n        raise ValueError(\n            f\"plate_type must be one of: bottom_plate, sole_plate, top_plate, cap_plate. \"\n            f\"Got: {plate_type}\"\n        )\n\n    reference_line = rg.LineCurve(start_point, end_point)\n\n    return {\n        \"reference_line\": reference_line,\n        \"base_plane\": base_plane,\n        \"reference_elevation\": reference_elevation,\n        \"wall_type\": wall_data[\"wall_type\"],\n        \"representation_type\": representation_type,  # Include this in the output\n    }\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}