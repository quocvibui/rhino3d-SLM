{
  "source_url": "https://github.com/TfedUD/Gh-2-eQ/blob/f8d0d681aca03b406fced8bb50abb70f2fd42b69/eQuestRhino/eQbug/fileBldr.py",
  "repo": "TfedUD/Gh-2-eQ",
  "repo_stars": 0,
  "repo_description": "initial eQuest model generation project to be developed with further interoperability",
  "license": "GPL-3.0",
  "filepath": "eQuestRhino/eQbug/fileBldr.py",
  "instruction": "File bldr",
  "code": "import rhinoscriptsyntax as rs\nimport sys\nimport ghpythonlib.components as ghc\ntry:  # import the core honeybee dependencies\n    from honeybee.boundarycondition import boundary_conditions\n    from honeybee.facetype import face_types, Wall, RoofCeiling, Floor\n    from honeybee.room import Room\nexcept ImportError as e:\n    raise ImportError('\\nFailed to import honeybee:\\n\\t{}'.format(e))\n\ntry:  # import the core honeybee dependencies\n    from honeybee.face import Face\n    from honeybee.facetype import face_types\n    from honeybee.boundarycondition import boundary_conditions\n    from honeybee.typing import clean_and_id_string\nexcept ImportError as e:\n    raise ImportError('\\nFailed to import honeybee:\\n\\t{}'.format(e))\n\ntry:  # import the ladybug_rhino dependencies\n    from ladybug_rhino.togeometry import to_face3d\n    from ladybug_rhino.grasshopper import all_required_inputs, longest_list, wrap_output\nexcept ImportError as e:\n    raise ImportError('\\nFailed to import ladybug_rhino:\\n\\t{}'.format(e))\nfrom decimal import Decimal as dex\n\nfrom geomTools import EQverts as ev\nfrom ladybug_rhino import fromgeometry as fg\nfrom ladybug_rhino import togeometry as tg\nimport itertools\n\n#---------------Space Class---------------------------------\n\n\nclass eQspace:\n\n    def __init__(self, _rm):\n        self.rm = _rm\n\n#---------------Adding floor surface property--------------------------------\n    @property\n    def floorSrfc(self):\n        return self.getMyFloor(self.rm)\n    \n    @staticmethod\n    def getMyFloor(obj):\n        floorFace = [srfc for srfc in obj.faces if str(srfc.type)=='Floor']\n        flrgeom = []\n        for f in floorFace:\n            flrgeom.append(fg.from_face3d(f.geometry))\n        return flrgeom\n#---------\n#---------adding RoofCeiling property to get the space height----------------\n    @property\n    def roofCeilingSrfc(self):\n        return self.getMyCeiling(self.rm)\n    \n    @staticmethod\n    def getMyCeiling(obj):\n        ceilingFaces = [srfc for srfc in obj.faces if str(srfc.type)=='RoofCeiling']\n        ceilinggeom = []\n        for f in ceilingFaces:\n            ceilinggeom.append(fg.from_face3d(f.geometry))\n        return ceilinggeom\n\n#---------\n#---------adding walls in to index for wall inputs (cred: Abbot Price)\n    @property\n    def room_wall_V(self):\n        return self._getAllWalls(self.rm)\n    \n    @staticmethod\n    def _getAllWalls(obj):\n        wallIndx = []\n        wallybois = [srfc for srfc in obj.faces if str(srfc.type)=='Wall']\n        for face in wallybois:\n            if str(face.boundary_condition)=='Outdoors':\n                indx = wallybois.index(face)+1\n                wallIndx.append(str(indx))\n        return wallIndx\n    \n\n\n#---------\n#---------Additional props for the overall floor class\n#---------\n    @property\n    def room_story(self):\n        return self._getStory(self.rm)\n\n    @staticmethod\n    def _getStory(obj):\n        return obj.story\n    \n    @property\n    def room_height(self):\n        return self._getHeight(self.rm)\n\n    @staticmethod\n    def _getHeight(obj):\n        return obj.average_floor_height\n\n\n\n\n#--------------Get attrs to create the output strings------------------------\n    @property\n    def spc_nm(self):\n        return self._getSpcNm(self.rm)\n    \n    @staticmethod\n    def _getSpcNm(obj):\n        return obj.display_name\n\n    @property\n    def lvl(self):\n        return self._getlvl(self.rm)\n    \n    @staticmethod\n    def _getlvl(obj):\n        return obj.story\n\n    @property\n    def space_verts(self):\n        return(self._spaceVerts(self.floorSrfc))\n    \n    @staticmethod\n    def _spaceVerts(obj):\n        \n        te = obj\n        return _get_verts(te)\n\n#------------------------------------------------------------------------------\n\n#---------------- Space Polys -------------------------------------------------\n\n    @property\n    def spcPlystr(self):\n        return self._spvst(self.space_verts, self.spc_nm, self.lvl)\n\n    @staticmethod\n    def _spvst(vrts, nm, lv):\n        try:\n            st = []\n            x = vrts\n            for i, ind in enumerate(x):\n                indx = i+1\n                strv = '   V{}'.format(indx)+' '*14+'=  '\n                st.append(prepend(ind,strv))\n            c=[]\n            for elem in st:\n                for el in elem:\n                    c.append(el)\n            bdx = '\\n'.join([i for i in c[0:]])\n            vx = str(bdx)+'\\n   ..\\n'\n            ttl = '\"{}_L-{} Plg\" = POLYGON\\n'.format(nm, lv) \n\n            return ttl+vx\n\n        except  IndexError:\n            raise IndexError('No faces found on room:\"{obj.name}\"')\n\n#-------------------------------------------------------------------\n\n#---------------------- spaces--------------------------------------\n    @property\n    def spcSpace(self):\n        return self._makeSpace(self.rm, self.room_wall_V)\n\n    @staticmethod\n    def _makeSpace(obj, rmwv):\n        filtDesc = filter(str.isalpha, obj.display_name)\n        bdx = '\"{}_L-{}_SP\" = SPACE\\n   SHAPE'.format(obj.display_name, obj.story)+' '*11+'= POLYGON\\n'+'   POLYGON'\\\n            +' '*9+'= \"{}_L-{} Plg\"\\n'.format(obj.display_name, obj.story)+'   C-ACTIVITY-DESC = *{}*\\n  ..\\n'.format(filtDesc)\n        wallstings = []\n        for i, wv in enumerate(rmwv):\n            idx = i+1\n            wvst = '\"{}_L-{}_SP Wall_{}\" = EXTERIOR-WALL\\n  LOCATION        = SPACE-V{}\\n  ..\\n'.format(obj.display_name, obj.story,idx,wv)\n            wallstings.append(wvst)\n        wvl = '\\n'.join([i for i in wallstings[0:]])\n        return str(bdx)+'\\n'+wvl\n\n\n\n#---------------------------------------------------------------------\n\n#----------------------Zones------------------------------------------\n\n    @property\n    def spcZone(self):\n        return self._makezone(self.rm)\n\n    @staticmethod\n    def _makezone(obj):\n        sp = '\"{}_L-{}_SP\"\\n   '.format(obj.display_name, obj.story)\n        bdx = '\"{}_L{}_ZN\" = ZONE\\n   '.format(obj.display_name, obj.story)+'TYPE'+' '*13+'= CONDITIONED\\n   '\\\n            +'SPACE'+' '*12+'= {}\\n   ..\\n'.format(sp)\n        return bdx\n\n\n\n\n#---------Level/story/floor what call you's to org eQuest spaces to their parent floor---\n\n\n\n#THIS is how to pass in multiple objects into a single class instance\n\nclass eQfloor(eQspace):\n    \"\"\" todo:\n            Make sort: to pass individual floors/levels/storys (lets all just use one vernacular maybe)\n            As to make our 'floor instances' in which to write the file out from\n        todo:\n            Need to pass all the strings for the rooms into the floor so can write out the inp \n            by floor:\n            floor space/poly/area whatever:   create for floor: append room strs\n    \"\"\"\n    def __init__(self, rooms=[]):\n        \n        self._rooms = []\n        for room in rooms:\n            self.add_room(room)\n\n        self._floor_geoms = []\n        for room in self.rooms:\n            self.add_floorGeoms(room)\n\n        self._floor_storyInd = []\n        for room in self.rooms:\n            self.add_storyInd(room)\n\n        self._room_roof_ceiling = []\n        for room in self.rooms:\n            self.add_roofceiling(room)\n\n        self._room_poly_strings = []\n        for room in self.rooms:\n            self.add_rmPoly_str(room)\n\n        self._room_space_strings = []\n        for room in self.rooms:\n            self.add_room_space_str(room)\n        \n        self._space_zone_strings = []\n        for room in self.rooms:\n            self.add_space_zone(room)\n\n#---------\n    def add_space_zone(self,obj):\n        self._space_zone_strings.append(obj.spcZone)\n    \n    @property\n    def room_inp_zone(self):\n        return(self._space_zone_strings)\n#---------\n\n#---------\n    def add_room_space_str(self, obj):\n        self._room_space_strings.append(obj.spcSpace)\n\n    @property\n    def room_inp_space(self):\n        return(self._room_space_strings)\n#---------\n\n# ---------\n    def add_rmPoly_str(self, obj):\n        self._room_poly_strings.append(obj.spcPlystr)\n\n    @property\n    def room_inp_poly(self):\n        return(self._room_poly_strings)\n#---------\n\n#---------\n    @property\n    def rooms(self):\n        return(self._rooms)\n\n    def add_room(self, obj):\n        self._rooms.append(eQspace(obj))\n#---------\n\n#---------\n    def add_roofceiling(self, obj):\n        self._room_roof_ceiling.append(obj.roofCeilingSrfc)\n    \n    @property\n    def floor_Height(self):\n        return self._getheight(self._room_roof_ceiling)\n    \n    @staticmethod\n    def _getheight(obj):\n        geomlist = [x for n in obj for x in n]\n        te = ghc.BrepJoin(geomlist).breps\n        sm = ghc.MergeFaces(te).breps\n        pt = ghc.Area(sm).centroid\n        \n        return pt.Z\n#---------\n\n#---------\n    @property\n    def floor_faces(self):\n        return(self._floor_geoms)\n\n    def add_floorGeoms(self, obj):\n        self._floor_geoms.append(obj.floorSrfc)\n#---------\n\n#---------\n    @property\n    def floor_story_ind(self):\n        return(self._floor_storyInd)\n\n    def add_storyInd(self, obj):\n        self._floor_storyInd.append(obj.room_story)\n#---------\n\n#---------\n    @property\n    def floor_verts(self):\n        return(self._floorVerts(self.floor_faces))\n    \n    @staticmethod\n    def _floorVerts(obj):\n        geomslst = [ x for n in obj for x in n]\n        te = ghc.BrepJoin(geomslst).breps\n        sm = ghc.MergeFaces(te).breps\n        return _get_verts(sm)\n#---------\n\n#---------\n    @property\n    def flr_z(self):\n        return(self._getz(self.floor_faces))\n    \n    @staticmethod\n    def _getz(obj):\n        geomlst = [ x for n in obj for x in n]\n        te = ghc.BrepJoin(geomlst).breps\n        cnt = ghc.Area(te).centroid\n        return cnt.Z\n\n\n\n#---------\n    @property\n    def level(self):\n        return self._levelGet(self.floor_story_ind)\n\n    @staticmethod\n    def _levelGet(obj):\n        return obj[1]\n#---------\n\n\n\n\n\n#---------Floor inp strings time -----------------------------------------\n#---------\n    #----------------Polys --------------------------------\n    @property\n    def floor_poly_strs(self):\n        return self._makeStrSet(self.floor_verts, self.level, self.room_inp_poly)\n\n    @staticmethod\n    def _makeStrSet(vrts, lvl, rminp):\n        hdr = '\"Level -{} Poly\" = POLYGON\\n'.format(lvl)\n        st = []\n        x = vrts\n        for i, ind in enumerate(x):\n            indx = i+1\n            strv = '   V{}'.format(indx)+' '*14+'=  '\n            st.append(prepend(ind,strv))\n        c = []\n        for elem in st:\n            for el in elem:\n                c.append(el)\n        bdx = '\\n'.join([i for i in c[0:]])\n        ipstrs = ''.join(i for i in rminp)\n        return hdr+str(bdx)+'\\n   ..\\n'+ipstrs\n    #---------\n    #---------Floors Spaces Walls WIndows Doors\n    #---------\n\n    @property\n    def floor_space_strs(self):\n        return self._makeSpaceSet(self.level, self.floor_Height, self.flr_z, self.room_inp_space)\n\n    @staticmethod\n    def _makeSpaceSet(lvl, hgt, flz, sinp):\n        hdr = '\"Level -{}\" = FLOOR\\n'.format(lvl)+'   Z'+' '*16+'= {}\\n'.format(flz)\\\n            +'   POLYGON'+' '*10+'= \"Level -{} Poly\"\\n   '.format(lvl)+'SHAPE'+' '*12\\\n                +'= POLYGON\\n   '+'FLOOR-HEIGHT'+' '*5+'= {}\\n   '.format(hgt)\\\n                    +'SPACE-HEIGHT'+' '*5+'= {}\\n   '.format(hgt)+'C-DIAGRAM-DATA   *Level {} UI DiagData*\\n   ..\\n'.format(lvl)\n        \n        spstrs = '\\n'.join(i for i in sinp)\n        return hdr+spstrs\n\n    #---------\n    #---------Zones\n    #---------\n\n    @property\n    def floor_zone_strs(self):\n        return self._makeZoneStrSet(self.room_inp_zone)\n\n    @staticmethod\n    def _makeZoneStrSet(obj):\n        place = '\"AHU PLACEHOLDER\"\\n   ..\\n'\n        znstrs = '\\n'.join(i for i in obj)\n        return place+znstrs\n\n\n\n\n\n    \n        \n\n\n\n\n\n\n\n\n\n\n\n\n\n\ndef prepend(list, str):\n    str += '{0}'\n    list = [str.format(list)]\n    return(list)\n\ndef _get_verts(obj):\n        #brp_edges = ghc.DeconstructBrep(obj).edges\n        #brp_perim = ghc.JoinCurves(brp_edges, True)\n        #brp_verts = ghc.ControlPoints(brp_perim).points\n        #brpC =  ghc.CullDuplicates(brp_verts, 0.0).points\n        brp = ghc.DeconstructBrep(obj).vertices\n        brpC = ghc.ReverseList(brp)\n        verts = [ev.from_Rh_points(point) for point in brpC]\n        \n        return verts\n        \ndef _get_vertsFloor(obj):\n        #brp_edges = ghc.DeconstructBrep(obj).edges\n        #brp_perim = ghc.JoinCurves(brp_edges, True)\n        #brp_verts = ghc.ControlPoints(brp_perim).points\n        #brpC =  ghc.CullDuplicates(brp_verts, 0.0).points\n        brp = ghc.DeconstructBrep(obj).vertices\n        #brpC = ghc.ReverseList(brp)\n        verts = [ev.from_Rh_points(point) for point in brp]\n        \n        return verts\n\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}