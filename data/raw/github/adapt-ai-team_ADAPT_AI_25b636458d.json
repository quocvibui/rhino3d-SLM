{
  "source_url": "https://github.com/adapt-ai-team/ADAPT_AI/blob/5de8b42c4f4d4ad35cbd8e79588fc6e869398bc4/spz_analysis2/scale.py",
  "repo": "adapt-ai-team/ADAPT_AI",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "spz_analysis2/scale.py",
  "instruction": null,
  "code": "import rhino3dm\nimport compute_rhino3d\nimport compute_rhino3d.Util\nimport requests\nimport os\nimport json\nimport traceback\n\n# Rhino Compute URL\nRHINO_COMPUTE_URL = \"http://localhost:5000\"\n\n# File paths\nGEOMETRY_PATH = r\"D:\\spz_analysis2\\\\newyork.3dm\"\nSCALED_GEOMETRY_PATH = r\"D:\\spz_analysis2\\\\newyork_scaled.3dm\"\nSCALE_FACTOR = 2.0  # Scaling factor\n\n# Function to check if files exist\ndef check_files():\n    print(\"Checking file paths:\")\n    if not os.path.exists(GEOMETRY_PATH):\n        raise FileNotFoundError(f\"Error: Geometry file '{GEOMETRY_PATH}' is missing!\")\n    print(\"‚úÖ Geometry file found!\")\n\n# Function to test Rhino Compute connection\ndef test_rhino_compute():\n    try:\n        response = requests.get(f\"{RHINO_COMPUTE_URL}/version\")\n        print(\"Rhino Compute Response:\", response.text)\n        return response.status_code == 200\n    except requests.exceptions.RequestException as e:\n        print(\"Error connecting to Rhino Compute:\", e)\n        return False\n\n# Function to load .3dm file and extract geometry\ndef load_geometry():\n    try:\n        print(\"üìÇ Loading 3DM File:\", GEOMETRY_PATH)\n        model = rhino3dm.File3dm.Read(GEOMETRY_PATH)\n        \n        if not model:\n            raise ValueError(\"‚ùå Failed to load the 3DM file!\")\n\n        # Extract objects (Meshes, Breps, or Curves)\n        objects = [obj.Geometry for obj in model.Objects]\n        if not objects:\n            raise ValueError(\"‚ùå No geometry found in the 3DM file!\")\n\n        print(f\"‚úÖ Found {len(objects)} objects in the file.\")\n        return objects\n\n    except Exception as e:\n        print(\"‚ùå Error loading geometry:\", e)\n        return None\n\n# Function to scale geometry using Rhino Compute\ndef scale_geometry(objects):\n    try:\n        print(\"üîπ Scaling Geometry via Rhino Compute...\")\n\n        # Define the scaling transformation\n        scale_transform = rhino3dm.Transform.Scale(rhino3dm.Point3d(0, 0, 0), SCALE_FACTOR)\n\n        # Serialize geometry using compute_rhino3d.Geometry.encode\n        serialized_objects = [compute_rhino3d.Geometry.encode(obj) for obj in objects]\n\n        # Send transformation request to Rhino Compute\n        response = requests.post(\n            f\"{RHINO_COMPUTE_URL}/rhino/geometry/transform\",\n            json={\n                \"transforms\": [scale_transform.ToFloatArray()] * len(serialized_objects),  # Correct transformation format\n                \"geometry\": serialized_objects\n            }\n        )\n\n        # Process response\n        if response.status_code == 200:\n            scaled_data = response.json()\n            scaled_objects = [compute_rhino3d.Geometry.decode(obj) for obj in scaled_data]\n            print(f\"‚úÖ Successfully scaled {len(scaled_objects)} objects.\")\n            return scaled_objects\n        else:\n            print(\"‚ùå Error:\", response.status_code)\n            print(\"üîç Rhino Compute Response:\", response.text)\n            return None\n\n    except Exception as e:\n        print(\"‚ùå Error during scaling:\", e)\n        print(traceback.format_exc())\n        return None\n\n# Function to save the scaled geometry into a new .3dm file\ndef save_scaled_geometry(scaled_objects):\n    try:\n        print(\"üíæ Saving Scaled Geometry...\")\n\n        # Create a new 3DM model\n        model = rhino3dm.File3dm()\n        for obj in scaled_objects:\n            model.Objects.Add(obj)\n\n        # Save file\n        model.Write(SCALED_GEOMETRY_PATH, 6)  # Rhino 6 file format\n        print(f\"‚úÖ Scaled geometry saved to {SCALED_GEOMETRY_PATH}\")\n\n    except Exception as e:\n        print(\"‚ùå Error saving file:\", e)\n        print(traceback.format_exc())\n\n# Run the script\nif __name__ == \"__main__\":\n    try:\n        print(\"Requests module imported successfully.\")\n\n        # Step 1: Check files\n        check_files()\n\n        # Step 2: Test Rhino Compute\n        if not test_rhino_compute():\n            raise ConnectionError(\"Rhino Compute is not reachable. Make sure it is running.\")\n\n        # Step 3: Load geometry from .3dm file\n        objects = load_geometry()\n        if not objects:\n            raise ValueError(\"No geometry found in the 3DM file.\")\n\n        # Step 4: Scale the geometry\n        scaled_objects = scale_geometry(objects)\n        if not scaled_objects:\n            raise ValueError(\"Scaling failed.\")\n\n        # Step 5: Save the scaled geometry\n        save_scaled_geometry(scaled_objects)\n\n    except Exception as e:\n        print(\"‚ùå Fatal Error:\")\n        print(traceback.format_exc())\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}