{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/_rhino/Revit.tab/export_material_by_layer.button/export_material_by_layer_left.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/_rhino/Revit.tab/export_material_by_layer.button/export_material_by_layer_left.py",
  "instruction": "Export material by layer left",
  "code": "__title__ = \"ExportMaterialByLayer\"\r\n__doc__ = \"Export material definitions for each layer using legal file names as dictionary keys.\"\r\n\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\nimport Rhino\r\nfrom EnneadTab import ERROR_HANDLE, LOG, FOLDER, DATA_FILE, NOTIFICATION\r\n\r\n\r\n@LOG.log(__file__, __title__)\r\n@ERROR_HANDLE.try_catch_error()\r\ndef export_material_by_layer():\r\n    \"\"\"Export material definitions for each layer.\r\n    \r\n    Returns:\r\n        dict: Dictionary with legal file names as keys and material definitions as values\r\n    \"\"\"\r\n    # Get all layers in the document\r\n    all_layers = rs.LayerNames()\r\n    \r\n    # Initialize dictionary to store layer materials\r\n    layer_materials = {}\r\n    cached_convertion = {}\r\n    \r\n    for layer in all_layers:\r\n        # Get material index for the layer\r\n        material_index = rs.LayerMaterialIndex(layer)\r\n        if material_index == -1:\r\n            continue\r\n            \r\n        # Get material properties\r\n        material = sc.doc.Materials[material_index]\r\n        if not material:\r\n            continue\r\n\r\n        material_name = material.RenderMaterial.Name\r\n        if material.RenderMaterial.TypeName == \"Enscape\":\r\n            if material_name not in cached_convertion:\r\n                pb_material = material.RenderMaterial.ConvertToPhysicallyBased(Rhino.Render.RenderTexture.TextureGeneration.Skip)\r\n                cached_convertion[material_name] = pb_material\r\n                note = \"temporarily converting to physically based for material: {}.\\nBecause you can not directly use Enscape material for Revit.\".format(material_name)\r\n                NOTIFICATION.messenger(main_text=note)\r\n                print (note)\r\n            else:\r\n                pb_material = cached_convertion[material_name]\r\n\r\n            rgb = (255*pb_material.BaseColor.R, 255*pb_material.BaseColor.G, 255*pb_material.BaseColor.B)\r\n            transparency = 1.0 - pb_material.Opacity\r\n            transparency_color = (255*pb_material.BaseColor.R, 255*pb_material.BaseColor.G, 255*pb_material.BaseColor.B)\r\n            shininess = pb_material.Roughness\r\n        else:\r\n            # Convert color to RGB values\r\n            diffuse = material.DiffuseColor\r\n            rgb = (diffuse.R, diffuse.G, diffuse.B)\r\n\r\n            if hasattr(material, \"TransparencyColor\"):\r\n                transparency_color = (material.TransparencyColor.R, material.TransparencyColor.G, material.TransparencyColor.B)\r\n            else:\r\n                transparency_color = (diffuse.R, diffuse.G, diffuse.B)\r\n\r\n            transparency = material.Transparency\r\n            shininess = material.Shine\r\n\r\n        material_def = {\r\n            \"name\": material_name,\r\n            \"color\": {\r\n                \"diffuse\": rgb,\r\n                \"transparency\": transparency,\r\n                \"transparency_color\": transparency_color,\r\n                \"shininess\": shininess\r\n            }\r\n        }\r\n        \r\n        # Create legal file name as key\r\n        legal_name = FOLDER.secure_legal_file_name(layer)\r\n        layer_materials[legal_name] = material_def\r\n    \r\n    # Save the material data to a file that Revit can read\r\n    DATA_FILE.set_data(layer_materials, \"RHINO_MATERIAL_MAP\")\r\n    NOTIFICATION.messenger(\"Material data exported successfully!\")\r\n\r\nif __name__ == \"__main__\":\r\n    export_material_by_layer()\r\n    \r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}