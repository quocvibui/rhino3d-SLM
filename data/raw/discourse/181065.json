{
  "source_url": "https://discourse.mcneel.com/t/rectangle-packing-python-script/181065",
  "topic_id": 181065,
  "title": "Rectangle packing Python script",
  "question": "So I have tried to rewrite houdini vex script for rectangle packing found here \nhttp://www.natelapinski.com/2019/05/08/box-packing/\n\n\nBut my script does not work as shown in vex example. All rectangles travel away from center, even though there are no collisions. Any advice would be appreciated\n\n\nRectangle packing.gh\n (16.4 KB)\n\n.\n\n\n\n\nimport Rhino.Geometry as rg  # Import Rhino geometry library\nimport random  # Import random module\n\ndef pack_squares(points, dimensions, iterations):\n    pp = points[:]  # Copy the input points\n\n    for q in range(iterations):  # Loop through the specified number of iterations    \n        newP = rg.Point3d(0, 0, 0)  # Initialize a new point\n    \n        for i in range(len(points)):  # Loop through each point\n            for j in range(len(points)):  # Loop through each point again (nested loop for pair-wise comparisons)\n                p1 = pp[i]  # Current point\n                dimen1 = dimensions[i]  # Dimensions of the current point (rectangle)\n\n                p2 = pp[j]  # Another point for comparison\n                dimen2 = dimensions[j]  # Dimensions of the other point (rectangle)\n\n                min1 = p1 - dimen1  # Minimum point of the bounding box of the current point\n                max1 = p1 + dimen1  # Maximum point of the bounding box of the current point\n\n                min2 = p2 - dimen2  # Minimum point of the bounding box of the other point\n                max2 = p2 + dimen2  # Maximum point of the bounding box of the other point\n#                print(max2)\n\n                x1min, x1max = min1.X, max1.X  # X min and max coordinates of the current point's bounding box\n                z1min, z1max = min1.Z, max1.Z  # Z min and max coordinates of the current point's bounding box\n\n                x2min, x2max = min2.X, max2.X  # X min and max coordinates of the other point's bounding box\n                z2min, z2max = min2.Z, max2.Z  # Z min and max coordinates of the other point's bounding box\n                #print...",
  "code_blocks": [
    {
      "code": "import Rhino.Geometry as rg  # Import Rhino geometry library\nimport random  # Import random module\n\ndef pack_squares(points, dimensions, iterations):\n    pp = points[:]  # Copy the input points\n\n    for q in range(iterations):  # Loop through the specified number of iterations    \n        newP = rg.Point3d(0, 0, 0)  # Initialize a new point\n    \n        for i in range(len(points)):  # Loop through each point\n            for j in range(len(points)):  # Loop through each point again (nested loop for pair-wise comparisons)\n                p1 = pp[i]  # Current point\n                dimen1 = dimensions[i]  # Dimensions of the current point (rectangle)\n\n                p2 = pp[j]  # Another point for comparison\n                dimen2 = dimensions[j]  # Dimensions of the other point (rectangle)\n\n                min1 = p1 - dimen1  # Minimum point of the bounding box of the current point\n                max1 = p1 + dimen1  # Maximum point of the bounding box of the current point\n\n                min2 = p2 - dimen2  # Minimum point of the bounding box of the other point\n                max2 = p2 + dimen2  # Maximum point of the bounding box of the other point\n#                print(max2)\n\n                x1min, x1max = min1.X, max1.X  # X min and max coordinates of the current point's bounding box\n                z1min, z1max = min1.Z, max1.Z  # Z min and max coordinates of the current point's bounding box\n\n                x2min, x2max = min2.X, max2.X  # X min and max coordinates of the other point's bounding box\n                z2min, z2max = min2.Z, max2.Z  # Z min and max coordinates of the other point's bounding box\n                #print(x1min, z1min, x2min, z2min)\n                \n\n                \n                in_square = x1min <= x2max and x2min <= x1max and z1min <= z2max and z2min <= z1max  # Check if the rectangles intersect\n                \n                if in_square:\n                    direction = rg.Vector3d(p1 - p2)  # Calculate the direction vector between the points\n                    direction.Unitize()  # Normalize the direction vector\n                    newP = p1 + direction * 0.1  # Move the current point away from the other point\n\n                    # Move the point only if it does not collide with another square\n#                    for k in range(len(points)):\n#                        if k != i and rg.Point3d.DistanceTo(newP, pp[k]) < dimen1.Length + dimensions[k].Length:\n#                            newP = p1  # Revert to the original position if collision detected\n#                            print(dimen1.Length)\n#                            break\n\n                    pp[i] = newP  # Update the current point's position\n\n    return pp  # Return the modified list of points\n\n\n\n\nresult = pack_squares(pts, dims, iters)  # Pack squares",
      "language": "python",
      "author": "Edr",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinocommon",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 2,
  "posts_count": 4,
  "views": 458
}