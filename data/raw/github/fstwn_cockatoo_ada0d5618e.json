{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_WriteGraphToFile.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_WriteGraphToFile.py",
  "instruction": "Writes a Graph to different data formats. The graph can be a KnitNetwork or a\ngraph prepared for GraphViz / Gephi.\n---\nCode for writing graph to dot file by Anders Holden Deleuran.\n    Inputs:\n      ...",
  "code": "\"\"\"\nWrites a Graph to different data formats. The graph can be a KnitNetwork or a\ngraph prepared for GraphViz / Gephi.\n---\nCode for writing graph to dot file by Anders Holden Deleuran.\n    Inputs:\n        Toggle: Set to True to write the file.\n                {item, boolean}\n        Graph: A graph to write to the file. Can be either a KnitNetwork or a\n               graph prepared for GraphViz / Gephi.\n               {item, Graph / KnitNetwork}\n        FileFormat: Selection of a file format used for writing. Can be GraphML,\n                    JSON, GML or DOT.\n                    [0] = GraphML\n                    [1] = JSON\n                    [2] = GML\n                    [3] = DOT\n                    Defaults to 0.\n                    {item, int}\n        Name: The filename of the file to write.\n              {item, str}\n    Output:\n        Folder: The folder were the file was written.\n                {item, str}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 200809\n\"\"\"\n\n# PYTHON STANDARD LIBRARY IMPORTS\nfrom __future__ import division\nimport os\nimport json\n\n# GPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"WriteGraphToFile\"\nghenv.Component.NickName =\"WGTF\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"08 Visualisation\"\n\n# LOCAL MODULE IMPORTS\ntry:\n    import cockatoo\n    import networkx as nx\nexcept ImportError:\n    errMsg = \"The Cockatoo python module seems to be not correctly \" + \\\n             \"installed! Please make sure the module is in you search \" + \\\n             \"path, see README for instructions!.\"\n    raise ImportError(errMsg)\n\nclass WriteGraphToFile(component):\n   \n    def ensure_folder(self, foldername):\n        \"\"\"\n        Ensures a specific subfolder inside the GH def folder.\n        \n        Based on code by Anders Holden Deleuran\n        \"\"\"\n        \n        if ghdoc.Path:\n            folder = os.path.dirname(ghdoc.Path)\n            folder = folder + \"\\\\\" + foldername\n            if not os.path.isdir(folder):\n                os.makedirs(folder)\n            return folder\n    \n    def write_graph_to_json(self, graph, file):\n        \"\"\"\n        Write a JSON Graph .json file.\n        \"\"\"\n        \n        json_data = nx.readwrite.adjacency_data(graph)\n        \n        jf = open(file, 'w')\n        json.dump(json_data, jf)\n        jf.close()\n    \n    def write_graph_to_graphml(self, graph, file):\n        \"\"\"\n        Write a GraphML .graphml file.\n        \"\"\"\n        \n        nx.write_graphml(graph, file)\n    \n    def write_graph_to_gml(self, graph, file):\n        \"\"\"\n        Write a GML .gml file.\n        \"\"\"\n        \n        nx.write_gml(graph, file)\n    \n    def write_graph_to_dot(self, graph, file, label=\"\", dpi=72, node_sep=None):\n        \"\"\"\n        Write and edit a dot file. Implements the pydot and dot_parser modules.\n        \n        Based on code by Anders Holden Deleuran.\n        \"\"\"\n        \n        nx.write_dot(graph, file)\n        \n        # Get the lines in the dot file\n        df = open(file, 'r')\n        df_lines = df.readlines()\n        df.close()\n        \n        # Add additional properties to the dot file\n        df_lines.insert(1, 'label=\"' + str(label) + '\" dpi=' + str(dpi) + ' overlap=scalexy nodesep=' + str(node_sep) + ' rankdir=BT' + ';\\n')\n        df_string = ''.join(df_lines)\n        \n        # Open and overwrite dot file\n        df = open(file, 'w')\n        df.write(df_string)\n        df.close()\n    \n    def RunScript(self, Toggle, Graph, FileFormat, Name):\n        \n        if FileFormat == None or FileFormat < 0:\n            FileFormat = 0\n        elif FileFormat > 3:\n            FileFormat = 3\n        \n        if Toggle and Graph and FileFormat != None and Name:\n            if FileFormat == 0:\n                if isinstance(Graph, cockatoo.KnitNetworkBase):\n                    Graph = cockatoo.KnitNetwork(Graph)\n                    # sanitize graph attributes\n                    if Graph.graph.has_key(\"reference_geometry\"):\n                        del Graph.graph[\"reference_geometry\"]\n                    # sanitize nodes\n                    for node in Graph.node:\n                        if Graph.node[node].has_key(\"geo\"):\n                            del Graph.node[node][\"geo\"]\n                        for key in Graph.node[node]:\n                            Graph.node[node][key] = str(Graph.node[node][key])\n                    # sanitize edges\n                    for edge in Graph.edges_iter(data=True):\n                        if edge[2].has_key(\"geo\"):\n                            del edge[2][\"geo\"]\n                        for key in edge[2]:\n                            edge[2][key] = str(edge[2][key])\n                \n                folder = self.ensure_folder(\"GraphML\")\n                file = folder + \"\\\\\" + Name + \".graphml\"\n                self.write_graph_to_graphml(Graph, file)\n            \n            elif FileFormat == 1:\n                if isinstance(Graph, cockatoo.KnitNetworkBase):\n                    Graph = cockatoo.KnitNetwork(Graph)\n                    # sanitize graph attributes\n                    if Graph.graph.has_key(\"reference_geometry\"):\n                        del Graph.graph[\"reference_geometry\"]\n                    # sanitize nodes\n                    for node in Graph.node:\n                        if Graph.node[node].has_key(\"geo\"):\n                            del Graph.node[node][\"geo\"]\n                        for key in Graph.node[node]:\n                            Graph.node[node][key] = str(Graph.node[node][key])\n                    # sanitize edges\n                    for edge in Graph.edges_iter(data=True):\n                        if edge[2].has_key(\"geo\"):\n                            del edge[2][\"geo\"]\n                        for key in edge[2]:\n                            edge[2][key] = str(edge[2][key])\n                \n                folder = self.ensure_folder(\"JSONGraph\")\n                file = folder + \"\\\\\" + Name + \".json\"\n                self.write_graph_to_json(Graph, file)\n            \n            elif FileFormat == 2:\n                if isinstance(Graph, cockatoo.KnitNetworkBase):\n                    Graph = cockatoo.KnitNetwork(Graph)\n                    # sanitize graph attributes\n                    if Graph.graph.has_key(\"reference_geometry\"):\n                        del Graph.graph[\"reference_geometry\"]\n                    # sanitize nodes\n                    for node in Graph.node:\n                        if Graph.node[node].has_key(\"geo\"):\n                            del Graph.node[node][\"geo\"]\n                        for key in Graph.node[node]:\n                            Graph.node[node][key] = str(Graph.node[node][key])\n                    # sanitize edges\n                    for edge in Graph.edges_iter(data=True):\n                        if edge[2].has_key(\"geo\"):\n                            del edge[2][\"geo\"]\n                        for key in edge[2]:\n                            edge[2][key] = str(edge[2][key])\n                \n                folder = self.ensure_folder(\"GML\")\n                file = folder + \"\\\\\" + Name + \".gml\"\n                self.write_graph_to_gml(Graph, file)\n            \n            elif FileFormat == 3:\n                if isinstance(Graph, cockatoo.KnitNetworkBase):\n                    Graph = cockatoo.KnitNetwork(Graph)\n                    # sanitize graph attributes\n                    if Graph.graph.has_key(\"reference_geometry\"):\n                        del Graph.graph[\"reference_geometry\"]\n                    # sanitize nodes\n                    for node in Graph.node:\n                        if Graph.node[node].has_key(\"geo\"):\n                            del Graph.node[node][\"geo\"]\n                        for key in Graph.node[node]:\n                            Graph.node[node][key] = str(Graph.node[node][key])\n                    # sanitize edges\n                    for edge in Graph.edges_iter(data=True):\n                        if edge[2].has_key(\"geo\"):\n                            del edge[2][\"geo\"]\n                        for key in edge[2]:\n                            edge[2][key] = str(edge[2][key])\n                \n                folder = self.ensure_folder(\"Dot\")\n                file = folder + \"\\\\\" + Name + \".dot\"\n                self.write_graph_to_dot(Graph, file)\n            \n            return folder\n        else:\n            if Toggle and not Graph:\n                rml = self.RuntimeMessageLevel.Warning\n                self.AddRuntimeMessage(rml, \"No Graph / KnitNetwork input!\")\n            if Toggle and not Name:\n                rml = self.RuntimeMessageLevel.Warning\n                self.AddRuntimeMessage(rml, \"No Name input!\")\n        \n        return Grasshopper.DataTree[object]()",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}