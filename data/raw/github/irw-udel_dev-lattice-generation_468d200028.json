{
  "source_url": "https://github.com/irw-udel/dev-lattice-generation/blob/6f71e27d2ac6638d6d12643e0040cd4c26a21b29/sdk-scripts/logging_system_info.py",
  "repo": "irw-udel/dev-lattice-generation",
  "repo_stars": 0,
  "repo_description": null,
  "license": "MIT",
  "filepath": "sdk-scripts/logging_system_info.py",
  "instruction": "Provides a scripting component.\n    Inputs:\n        refresh: Recalculate the component\n        project_dir: The project's main directory\n        save_directory: Folder to save the STL and log output\n...",
  "code": "\"\"\"Provides a scripting component.\n    Inputs:\n        refresh: Recalculate the component\n        project_dir: The project's main directory\n        save_directory: Folder to save the STL and log output\n        id_properties: Key features of the part. Takes single value or list of properties\n    Output:\n        part_id: A unique ID for the generated part. Takes the format (date)-(properties fragment)-(instance fragment)\n        date_utc: The UTC date and time at which computation was performed\n        mesh_path: Full path for the STL output\n        log_path: Full path for the log output\n        gh_file: Path and name of the Grasshopper definition\n        base_unit: Base unit of the Rhino and Grasshopper file (e.g. millimeter)\n        device: Device used for computation\n        rhino_build: Rhino software version\n        rhino_date: Rhino software version release date\n        gh_build: Grasshopper software version\n        gh_date: Grasshopper software version release date\n        core_dependencies: Default libraries used in this definition\n        addon_dependencies: Installed libraries used in this definition\"\"\"\n\n__author__ = \"irw\"\n# Includes script components from Giulio Piacentino, source: https://www.grasshopper3d.com/forum/topics/gh-filename-is-python\n__version__ = \"20220124\"\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext\nimport os\nimport hashlib\nfrom datetime import datetime\n\ndef make_id(properties):\n    properties_string = ','.join(map(str, properties))\n    properties_fragment = (hashlib.md5(properties_string.encode(\"UTF-8\")).hexdigest())[:3]\n\n    date_info = datetime.now().strftime(\"%y%m%d\")\n    date_utc = datetime.utcnow().strftime(\"%Y-%m-%dT%H:%M:%S\")\n    instance_fragment = (hashlib.sha256(date_utc.encode(\"UTF-8\")).hexdigest())[:2]\n\n    unique_id = '-'.join([date_info, properties_fragment, instance_fragment])\n    \n    return unique_id, date_utc\n\ndef get_libraries(self):\n    core_libraries = {}\n    addon_libraries = {}\n    objids = {}\n    \n    server = Grasshopper.Instances.ComponentServer\n    for obj in self.OnPingDocument().Objects:\n        if obj == self: continue #Ignore this component.\n        \n        objId = obj.ComponentGuid\n        if objids.has_key(objId): continue\n        objids[objId] = \"\"\n        \n        lib = server.FindAssemblyByObject(obj)\n        if lib == None: continue\n        if core_libraries.has_key(lib.Id) or addon_libraries.has_key(lib.Id): continue\n        \n        if lib.IsCoreLibrary:\n            core_libraries[lib.Id] = lib\n        else:\n            addon_libraries[lib.Id] = lib\n    \n    return core_libraries, addon_libraries\n\ndef get_units(ghdoc):\n    scriptcontext.doc = Rhino.RhinoDoc.ActiveDoc\n    base_units = rs.UnitSystemName()\n    scriptcontext.doc = ghdoc\n    \n    return base_units\n\ndef get_device():\n    device = Rhino.Runtime.HostUtils.DeviceId.ToString()\n\n    return device\n\ndef get_software_build():\n    rhino_build = str(Rhino.RhinoApp.Version)\n    rhino_date = Rhino.RhinoApp.BuildDate\n    gh_build = str(Grasshopper.Versioning.Version)\n    gh_date = Grasshopper.Versioning.BuildDate\n\n    return rhino_build, rhino_date, gh_build, gh_date\n\nclass SystemInfo(component):\n    def RunScript(self, refresh, project_dir, save_directory, id_properties):\n        ghdoc = scriptcontext.doc\n        part_id = None\n        date_utc = None\n        gh_file = None\n        base_unit = None\n        device = None\n        rhino_build = None\n        rhino_date = None\n        gh_build = None\n        gh_date = None\n        core_dependencies = None\n        addon_dependencies = None\n\n\n        part_id, date_utc = make_id(id_properties)\n        gh_path = os.path.realpath(ghdoc.Path)\n\n        if not save_directory:\n            save_directory = os.path.dirname(ghdoc.Path)\n\n        file_name_base = \"\\\\\".join([save_directory, part_id])\n        mesh_path = \"\\\"{}.stl\\\"\".format(file_name_base)\n        log_path = \"{}.txt\".format(file_name_base)\n\n        if project_dir:\n            gh_file = gh_path.split(project_dir)[1]\n        else:\n            gh_file = gh_path\n\n        base_unit = get_units(ghdoc)\n        device = get_device()\n        rhino_build, rhino_date, gh_build, gh_date = get_software_build()\n\n\n        core_libraries, addon_libraries = get_libraries(self)\n\n        core_dependencies = []\n        for id, lib in core_libraries.iteritems():\n            core_dependencies.append(\"{0} {1}\".format(lib.Name, lib.Version))\n\n        addon_dependencies = []\n        for id, lib in addon_libraries.iteritems():\n            addon_dependencies.append(\"{0} {1}\".format(lib.Name, lib.Version))\n        \n        return part_id, date_utc, mesh_path, log_path, gh_file, base_unit, device, rhino_build, rhino_date, gh_build, gh_date, core_dependencies, addon_dependencies",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}