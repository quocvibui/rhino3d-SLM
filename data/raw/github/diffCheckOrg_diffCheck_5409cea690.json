{
  "source_url": "https://github.com/diffCheckOrg/diffCheck/blob/8f668b1f273e8d81a282c6115ba3eae07eef9235/src/gh/components/DF_CAD_segmentator/code.py",
  "repo": "diffCheckOrg/diffCheck",
  "repo_stars": 15,
  "repo_description": "diffCheck is a CAD-integrated tool for evaluating digital timber fabrication processes.",
  "license": "GPL-3.0",
  "filepath": "src/gh/components/DF_CAD_segmentator/code.py",
  "instruction": null,
  "code": "#! python3\n\nimport System\n\nimport Rhino\nfrom ghpythonlib.componentbase import executingcomponent as component\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\n\nfrom diffCheck.diffcheck_bindings import dfb_segmentation\nfrom diffCheck.diffcheck_bindings import dfb_geometry\n\nfrom diffCheck import df_cvt_bindings\n\n\n\nclass DFCADSegmentator(component):\n    def RunScript(self,\n        i_clouds: System.Collections.Generic.IList[Rhino.Geometry.PointCloud],\n        i_assembly,\n        i_angle_threshold: float = 0.1,\n        i_association_threshold: float = 0.1) -> Rhino.Geometry.PointCloud:\n\n        if i_clouds is None or i_assembly is None:\n            self.AddRuntimeMessage(RML.Warning, \"Please provide a cloud and an assembly to segment.\")\n            return None\n        if i_angle_threshold is None:\n            i_angle_threshold = 0.1\n        if i_association_threshold is None:\n            i_association_threshold = 0.1\n\n        o_clusters = []\n        df_clusters = []\n        # we make a deepcopy of the input clouds\n        df_clouds = [df_cvt_bindings.cvt_rhcloud_2_dfcloud(cloud.Duplicate()) for cloud in i_clouds]\n\n        df_beams = i_assembly.beams\n        df_beams_meshes = []\n        rh_beams_meshes = []\n\n        for df_b in df_beams:\n            rh_b_mesh_faces = [df_b_f.to_mesh() for df_b_f in df_b.side_faces]\n            df_b_mesh_faces = [df_cvt_bindings.cvt_rhmesh_2_dfmesh(rh_b_mesh_face) for rh_b_mesh_face in rh_b_mesh_faces]\n            df_beams_meshes.append(df_b_mesh_faces)\n            rh_beams_meshes.append(rh_b_mesh_faces)\n\n            # different association depending on the type of beam\n            df_asssociated_cluster_faces = dfb_segmentation.DFSegmentation.associate_clusters(\n                is_roundwood=df_b.is_roundwood,\n                reference_mesh=df_b_mesh_faces,\n                unassociated_clusters=df_clouds,\n                angle_threshold=i_angle_threshold,\n                association_threshold=i_association_threshold\n            )\n\n            df_asssociated_cluster = dfb_geometry.DFPointCloud()\n            for df_associated_face in df_asssociated_cluster_faces:\n                df_asssociated_cluster.add_points(df_associated_face)\n\n            dfb_segmentation.DFSegmentation.clean_unassociated_clusters(\n                is_roundwood=df_b.is_roundwood,\n                unassociated_clusters=df_clouds,\n                associated_clusters=[df_asssociated_cluster],\n                reference_mesh=[df_b_mesh_faces],\n                angle_threshold=i_angle_threshold,\n                association_threshold=i_association_threshold\n            )\n\n            df_clusters.append(df_asssociated_cluster)\n\n        o_clusters = [df_cvt_bindings.cvt_dfcloud_2_rhcloud(cluster) for cluster in df_clusters]\n\n        for o_cluster in o_clusters:\n            if not o_cluster.IsValid:\n                o_cluster = None\n                ghenv.Component.AddRuntimeMessage(RML.Warning, \"Some beams could not be segmented and were replaced by 'None'\")  # noqa: F821\n\n\n        return o_clusters\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib"
  ],
  "has_docstring": false
}