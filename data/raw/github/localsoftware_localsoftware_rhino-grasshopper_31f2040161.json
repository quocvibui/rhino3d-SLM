{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/python/BatchImport.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "python/BatchImport.py",
  "instruction": "Imports geometry from Rhino files into GH, preserves layers' hierarchy as a data tree.",
  "code": "\"\"\"Imports geometry from Rhino files into GH, preserves layers' hierarchy as a data tree.\n\nImports .3dm files into Rhino and Grasshopper. \nThe component can erase existing geometry in the Rhinodoc.\n\n    Typical usage:\n        Takes a number of files and imports their geometries to GH.\n        You need to provide a path for the folder that contains the files to be imported.\n        Use the string concatenate component to join the file path of the folder with the number/name of the file to be imported.\n        You can specify the file number with a slider.\n        Use another string concatenate component to concatenate the file extension to the file path of the files and plug it into the FilePaths input of the component.\n        Based on the work of Jackie Berry.\n    Inputs:\n        filename: List of file(s) to import (string)\n        Import: boolean to activate the import\n        deleteExisting: boolean to delete existing geometry in file\n\n    Output:\n        geometryOut: The imported geometry into GH space.\"\"\"\n\n__author__ = \"palomagr\"\n__version__ = \"2020.07.09\"\n\n#ghenv.Component.Name = \"Batch Import\"\n#ghenv.Component.NickName = \"BatchImport\"\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport ghpythonlib.treehelpers as th\nimport os\nrcdoc = Rhino.RhinoDoc.ActiveDoc\nghdoc = sc.doc\n\nclass MyComponent(component):\n    \"\"\"\n    Deletes existing geometry from Rhino file before import.\n    \"\"\"\n    def deleteExistingGeom(self):\n        sc.doc = Rhino.RhinoDoc.ActiveDoc\n        objects = rs.AllObjects()\n        if objects:\n            for obj in objects:\n                rs.DeleteObject(obj)\n        layers = rs.LayerNames()\n        for layer in layers:\n            if layer!=rs.CurrentLayer():\n                rs.DeleteLayer(layer)\n        return\n\n    \"\"\"\n    Imports geometry from files\n\n    \"\"\"\n    def importRhinoFile(self, fileNames, sourcePath):\n        #file import\n        for fn in fileNames:\n            thisFilePath = os.path.join(sourcePath,fn)\n            importCommandString = '_-Import \"' + thisFilePath + '\" _Enter'\n            imported = rs.Command(importCommandString, echo=False)\n\n            if not imported:\n                print \"there was a problem with file: \" + fn\n\n        return\n\n\n    \"\"\"\n    Grabs geometry from Rhino and constructs data tree.\n    Each branch of the tree is a different layer in the document.\n    \"\"\"\n    def rhinoGeomToDataTree(self):\n        sc.doc = rcdoc\n        layers = rs.LayerNames(sort=False)\n        sc.doc = ghdoc\n    #    layerTree = [[] for layer in layers]\n        layerTree = []\n        for i in range(len(layers)):\n            objs = Rhino.RhinoDoc.ActiveDoc.Objects.FindByLayer(layers[i])\n\n            if objs:\n                geoms = [obj.Geometry for obj in objs]\n    #            layerTree[i].extend(geoms)\n                layerTree.append(geoms)\n        status= str(len(layerTree))+ \" branches \\n\"\n\n        layerTree = th.list_to_tree(layerTree, source=[])\n\n        return layerTree, status\n\n    def RunScript(self, filenames, sourceFolderPath, Import, deleteExisting):\n        geometryOut, status = None, None\n\n        #Perform Import\n        if Import:\n            # option to delete existing geometry in document\n            status = \"start import \\n\"\n            if deleteExisting:\n                self.deleteExistingGeom()\n                status += \"deleted \\n\"\n\n            #now import geometry from files\n            if (filenames != None) and (sourceFolderPath != None):\n                #import function here\n                self.importRhinoFile(filenames, sourceFolderPath)\n                status += \"imported rhino files \\n\"\n#                thisDoc.ScheduleSolution(20, self.rhinoGeomToDataTree)\n                geometryAndStatus=self.rhinoGeomToDataTree()\n                geometryOut = geometryAndStatus[0]\n                status+=geometryAndStatus[1]\n                status += \"geometry to datatree \\n\"\n            else:\n                if filenames==None:\n                    print \"Provide a list of filenames\"\n                elif sourceFolderPath==None:\n                    print \"Provide the path to your source folder\"\n\n        # return outputs if you have them; here I try it for you:\n        return (geometryOut, status)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}