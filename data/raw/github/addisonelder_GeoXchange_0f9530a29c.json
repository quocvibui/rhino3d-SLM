{
  "source_url": "https://github.com/addisonelder/GeoXchange/blob/fe2354fc957aa3a3bfce922ead691214c7851723/libs/gx_landxml.py",
  "repo": "addisonelder/GeoXchange",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "libs/gx_landxml.py",
  "instruction": "Gx landxml",
  "code": "#! python3\nimport rhinoscriptsyntax as rs #type: ignore\nimport Rhino\nimport Rhino.Geometry as rg\nimport Eto.Forms as forms\nimport Rhino.UI as ui\nimport xml.etree.ElementTree as ET\nimport re\nimport math\nimport System # type: ignore\nfrom libs import filepicker\nfrom libs.constants import *\nfrom libs import gx_geometry\n\nclass LandXML():\n    def __init__(self):\n        self.path = None\n        self.tree = None\n        self.root = None\n        self.ns = None\n\n        self.alignment = None\n\n        try:\n            self.pick_file()\n            print(\"pickfile_success\")\n        except Exception as e:\n            print(e)\n\n        self.parse_as_tree()\n        print(\"parse_success\")\n\n    def pick_file(self):\n        self.path = filepicker.pick_file(\".xml\", \"LandXML Files\")\n\n    def parse_as_tree(self):\n        # Set XML tree and root\n        self.tree = ET.parse(self.path)\n        print(self.tree)\n        self.root = self.tree.getroot()\n        print(self.root)\n\n        # Extract the default namespace from the root tag\n        # (format: {namespace}tag)\n        m = re.match(r'\\{(.*)\\}', self.root.tag)\n        namespace = m.group(1) if m else ''\n\n        # Build the namespace dictionary for ElementTree search\n        self.ns = {'ns': namespace} if namespace else {}\n        print(self.ns)\n\nclass Alignment():\n    def __init__(self, landxml):\n        self.landxml = landxml\n        self.name = None\n        self.start_sta = None\n        self.lines = None\n        self.curves = None\n        self.polycurve = None\n\n        self.extract_alignment_data()\n        self.extract_lines()\n        self.extract_curves()\n\n    def extract_alignment_data(self):\n        for alignment in self.landxml.root.findall('.//ns:Alignment', self.landxml.ns):\n            #Find Parameters\n            self.name = alignment.get('name')\n            self.start_sta = float(alignment.get('staStart'))\n\n    def extract_lines(self):\n        line_list = []\n        for entry in self.landxml.root.findall('.//ns:Line', self.landxml.ns):\n            start = self.parse_point(entry, \"Start\")\n            end = self.parse_point(entry, \"End\")\n            line = rg.Line(start, end)\n            line = line.ToNurbsCurve()\n            line_list.append(line)\n        self.lines = line_list\n            \n    def extract_curves(self):\n        curve_list = []\n        for entry in self.landxml.root.findall('.//ns:Curve', self.landxml.ns):\n            # pull parameters from landxml\n            start = self.parse_point(entry, \"Start\")\n            end = self.parse_point(entry, \"End\")\n            center = self.parse_point(entry, \"Center\")\n            radius = float(entry.get('radius'))\n            direction = entry.get('rot')\n\n            # build the arc\n            circle = rg.Circle(center,radius)\n            circle = circle.ToNurbsCurve()\n            start_param = circle.ClosestPoint(start)[1]\n            end_param = circle.ClosestPoint(end)[1]\n            if direction == \"ccw\":\n                domain = rg.Interval(start_param,end_param)\n            else:\n                domain = rg.Interval(end_param,start_param)\n            \n            arc = circle.Trim(domain)\n            curve_list.append(arc)\n        self.curves = curve_list\n\n    def parse_point(self, item, search):\n        # pull a point item from an XML branch\n        point_string = item.find(f'ns:{search}', self.landxml.ns).text.strip()\n        y_str, x_str = point_string.split()\n        x = float(x_str)\n        y = float(y_str)\n        point = rg.Point3d(x,y,0)\n        return point\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}