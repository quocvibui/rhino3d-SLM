{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/modules.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/modules.py",
  "instruction": "Get modules from model.",
  "code": "\"\"\"Get modules from model.\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport rhinoscriptsyntax as rs\r\nimport copy\r\nfrom Grasshopper import DataTree\r\nfrom Grasshopper.Kernel.Data import GH_Path\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Get Modules\", \"Modules\", \"\"\"Get modules from model.\"\"\", \"Manis\", \"Assembly\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"8b1633ef-c5f8-4fd7-b75c-d757d5131433\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"model\", \"model\", \"Plate model.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Integer()\r\n        self.SetUpParam(p, \"module_id\", \"module_id\", \"(Optional) ID of the module. If none is provided, all modules will be retrieved.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n    \r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"module\", \"module\", \"Module(s) inheriting model functions.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_String()\r\n        self.SetUpParam(p, \"sequence\", \"sequence\", \"Sub-sequence of the module.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"step\", \"step\", \"Tag representing the position of the module in the full assembly sequence. 'M' stands for the final step of the Model.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Brep()\r\n        self.SetUpParam(p, \"breps\", \"breps\", \"Module breps.\")\r\n        self.Params.Output.Add(p)\r\n        \r\n    \r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        result = self.RunScript(p0, p1)\r\n\r\n        if result is not None:\r\n            if not hasattr(result, '__getitem__'):\r\n                self.marshal.SetOutput(result, DA, 0, True)\r\n            else:\r\n                self.marshal.SetOutput(result[0], DA, 0, True)\r\n                self.marshal.SetOutput(result[1], DA, 1, True)\r\n                self.marshal.SetOutput(result[2], DA, 2, True)\r\n                self.marshal.SetOutput(result[3], DA, 3, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAADESURBVEhLzZDREYMwDEOZqTN1JmbqTP0JloMhMbFB+ehVdw+TKLYCSynlMSI8OEaDItDw/bwphoMijlsxjAZFQHIrlHq7WnXP8J5uzGBDBK+LpxsM1oOqA/qv7DzIFhRMwMx/7YbcBuwKDZH3ngdERtrEnI2MpImDDXitKwUdQDMRANXbnetWF88WFFQANhisB1UHuK9tPcgWFEyAKTRE3vujgMhIm5izkZE21Xqs/dmG08QrEdDJne0VDXFNvw1ovZyybMNIxM83vg1XAAAAAElFTkSuQmCC\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n    \r\n    def RunScript(self, model, module_id):\r\n        \r\n        def round_vector(vec, n=3):\r\n            \"\"\"round x,y,z components of a vector to n decimals\"\"\"\r\n            for i in range(len(vec)):\r\n                vec[i] = round(vec[i],n)\r\n            return vec\r\n\r\n        def list_to_datatree(raggedList):\r\n            \"\"\"Python to Grasshopper (from Chen Jingcheng)\"\"\"\r\n            rl = raggedList\r\n            result = DataTree[object]()\r\n            for i in range(len(rl)):\r\n                temp = []\r\n                for j in range(len(rl[i])):\r\n                    temp.append(rl[i][j])\r\n                #print(i, \" - \",temp)\r\n                path = GH_Path(i)\r\n                result.AddRange(temp, path)\r\n            return result\r\n\r\n        module = None\r\n        sequence = None\r\n        step = None\r\n        breps = None\r\n        \r\n        if model:        \r\n            if module_id != None:\r\n                module_id = module_id % len(model.modules)\r\n                module = model.modules[module_id]\r\n                breps = model.modules[module_id].breps\r\n                step = str(model.modules[module_id].step)\r\n                sequence = str(model.modules[module_id].sequence)\r\n                assembly_vectors = []\r\n                for i in range(len(model.modules[module_id].assembly_vectors)):\r\n                    vector = model.modules[module_id].assembly_vectors[i]\r\n                    if vector == \"gravity\": vector = rs.VectorCreate((0,0,-1),(0,0,0))\r\n                    assembly_vectors.append(round_vector(vector,6))\r\n        \r\n            else:\r\n                module = []\r\n                breps = []\r\n                sequence = []\r\n                step = []\r\n                assembly_vectors = []\r\n                for mod in model.modules:\r\n                    module.append(mod)\r\n                    breps.append(mod.breps)\r\n                    sequence.append(str(mod.sequence))\r\n                    step.append(str(mod.step))\r\n                    sub_assembly_vectors = []\r\n                    for vec in mod.assembly_vectors:\r\n                        if vec == \"gravity\": vec = rs.VectorCreate((0,0,-1),(0,0,0))\r\n                        sub_assembly_vectors.append(round_vector(vec,6))\r\n                    assembly_vectors.append(sub_assembly_vectors)\r\n                breps = list_to_datatree(breps)\r\n                assembly_vectors = list_to_datatree(assembly_vectors)\r\n        \r\n        return (module, sequence, step, breps)\r\n\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Modules\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"8b84a228-8858-4a01-9624-9af6a0036530\")",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}