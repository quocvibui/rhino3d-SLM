{
  "source_url": "https://github.com/localsoftware/localsoftware_rhino-grasshopper/blob/4aafec57e33b9f09cce6fd73dcda12b17cf794a5/python/BakeWithAttributes.py",
  "repo": "localsoftware/localsoftware_rhino-grasshopper",
  "repo_stars": 0,
  "repo_description": null,
  "license": "BSD-2-Clause",
  "filepath": "python/BakeWithAttributes.py",
  "instruction": "Bakes geometry with attributes into Rhino.",
  "code": "\"\"\"Bakes geometry with attributes into Rhino.\n\nThe geometry is baked by branch into specific layers.\nGeometry objects can have colors, widths, and materials as attributes.\nYou can group the baked objects and delete all the previous instances of the objects.\n\n    Typical usage example:\n        Input geometry an separate (graph) them into branches of a data tree.\n        Provide a list of layer names to each branch that will be baked. Input all the desired attributes.\n        Use a 'make Material' LocalCode component to make and assign a material to each layer.\n        Toggle the 'Bake' boolean to activate the component.\n\n    Inputs:\n        geometry: Geometry as a tree of objects\n        layers: Layer names as a list of strings\n        colors: Color swatches as a list\n        widths: List of floats\n        materials: List of LocalCode Materials\n        delete: Boolean to delete 'EVERY' previous instance of the geometry\n        group: Boolean to group all objects\n        Bake: Boolean that bakes the geometry with attributes into Rhino\n\n    Outputs:\n        None\"\"\"\n\n__author__ = \"palomagr\"\n__version__ = \"2020.07.09\"\n\n# ghenv.Component.Name = \"Bake with Attributes\"\n# ghenv.Component.NickName = \"Bake with Attributes\"\n\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System, Rhino, os\nimport rhinoscriptsyntax as rs\nimport ghpythonlib.treehelpers as th\nimport ghpythonlib.components as ghcomp\nimport scriptcontext as sc\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\n\nclass MyComponent(component):\n\n    def RunScript(self, geometry, layers, colors, widths, materials, delete, group, Bake):\n        # Call rhino document\n        rcdoc = Rhino.RhinoDoc.ActiveDoc\n        # Make a list of the geometry branches\n        geometryList = [geometry.Branch(b) for b in range(geometry.BranchCount)]\n        # Check if the number of layers is the same as the branches\n        if geometry == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add geometry in branches.\")\n        if Bake == None:\n            self.AddRuntimeMessage(RML.Warning, \"Add a boolean toggle in the Bake input.\")\n        if len(layers) != geometry.BranchCount:\n            self.AddRuntimeMessage(RML.Warning, \"Add the same number of geometry branches and layers.\")\n\n        # Function that deletes all previous instances of the geometry\n        def deleteExistingGeom():\n            sc.doc = rcdoc\n            allObjs = rs.AllObjects()\n            rs.DeleteObjects(allObjs)\n            sc.doc = ghdoc\n            return\n\n        if Bake:\n            if delete:\n                deleteExistingGeom()\n\n            num = len(geometryList)\n\n            for i in range(num):\n                currentLayer = layers[i]\n                if colors != [] and len(colors) == num:\n                    currentColor = colors[i]\n                else:\n                    currentColor = [0, 0, 0]\n                if materials != [] and len(materials) == num:\n                    currentMaterial = materials[i]\n                else:\n                    currentMaterial = None\n                if widths != [] and len(widths) == num:\n                    currentWidth = widths[i]\n                else:\n                    currentWidth = 1.0\n\n                for id in geometryList[i]:\n                    sc.doc = ghdoc\n                    gh_to_rhino = rs.coercerhinoobject(id)\n                    attributes = gh_to_rhino.Attributes\n                    geometryObj = gh_to_rhino.Geometry\n                    sc.doc = Rhino.RhinoDoc.ActiveDoc  # we change the scriptcontext\n                    rhino_brep = sc.doc.Objects.Add(geometryObj,\n                                                    attributes)  # we add both the geometry and the attributes to the Rhino doc\n                    if (group):\n                        name = rs.AddGroup('bake_group')\n                        rs.AddObjectToGroup(rhino_brep, 'bake_group')\n\n                    if not rs.IsLayer(currentLayer) and currentColor != None:\n                        rs.AddLayer(name=currentLayer)\n\n                    prevColor = rs.LayerColor(layer=currentLayer)\n                    if prevColor != currentColor:\n                        rs.LayerColor(currentLayer, color=currentColor)\n\n                    index = rs.LayerOrder(currentLayer)\n                    if currentMaterial != None:\n                        # print(currentMaterial.Name)\n                        sc.doc.RenderMaterials.Add(currentMaterial)\n                        sc.doc.Layers[index].RenderMaterial = currentMaterial\n\n                    rs.LayerPrintWidth(currentLayer, float(currentWidth))\n                    rs.ObjectLayer(rhino_brep, currentLayer)  # add objects to rhino layer\n        sc.doc = ghdoc  # we put back the original Grasshopper document as default\n\n        # return outputs if you have them; here I try it for you:\n        return\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}