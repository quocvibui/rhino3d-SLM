{
  "source_url": "https://github.com/ladybug-tools/honeybee-legacy/blob/bd62af4862fe022801fb87dbc8794fdf1dff73a9/src/Honeybee%20EP%20context%20Surfaces.py",
  "repo": "ladybug-tools/honeybee-legacy",
  "repo_stars": 129,
  "repo_description": ":bee: Honeybee is a free and open source plugin to connect Grasshopper3D to EnergyPlus, Radiance, Daysim and OpenStudio for building energy and daylighting simulation",
  "license": "NOASSERTION",
  "filepath": "src/Honeybee EP context Surfaces.py",
  "instruction": "prepare shading/context geometries",
  "code": "\"\"\"\nprepare shading/context geometries\n\n    Args:\n        northVectorOrRotation: A vector that shows North or a number that shows\n                               the rotation of the North from the Y axis\n        bldgMasses: List of closed Breps as thermal zones.\n    Returns:\n        report: ...\n        thermalZones: Thermal zone's geometries for visualiza\n\"\"\"\n\nghenv.Component.Name = 'Honeybee EP context Surfaces'\nghenv.Component.NickName = 'HB_EPContextSrf'\nghenv.Component.Message = 'VER 0.0.66\\nJUL_07_2020'\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\nghenv.Component.Category = \"HB-Legacy\"\nghenv.Component.SubCategory = \"10 | Energy | Energy\"\n#compatibleHBVersion = VER 0.0.57\\nNOV_04_2016\n#compatibleLBVersion = VER 0.0.59\\nFEB_01_2015\nghenv.Component.AdditionalHelpFromDocStrings = \"2\"\n\nimport rhinoscriptsyntax as rs\nimport Rhino as rc\nimport scriptcontext as sc\nimport os\nimport System\nimport Grasshopper.Kernel as gh\nimport uuid\n\ntolerance = sc.doc.ModelAbsoluteTolerance\nimport math\n\n\ndef main(shdSurfaces, EPTransSchedule, meshingSettings, justBoundingBox):\n    \n    # import the classes\n    if sc.sticky.has_key('honeybee_release'):\n\n        try:\n            if not sc.sticky['honeybee_release'].isCompatible(ghenv.Component): return -1\n            if sc.sticky['honeybee_release'].isInputMissing(ghenv.Component): return -1\n        except:\n            warning = \"You need a newer version of Honeybee to use this compoent.\" + \\\n            \" Use updateHoneybee component to update userObjects.\\n\" + \\\n            \"If you have already updated userObjects drag Honeybee_Honeybee component \" + \\\n            \"into canvas and try again.\"\n            w = gh.GH_RuntimeMessageLevel.Warning\n            ghenv.Component.AddRuntimeMessage(w, warning)\n            return -1\n        \n        # don't customize this part\n        hb_EPSrf = sc.sticky[\"honeybee_EPSurface\"]\n        hb_EPSHDSurface = sc.sticky[\"honeybee_EPShdSurface\"]\n        hb_RADMaterialAUX = sc.sticky[\"honeybee_RADMaterialAUX\"]\n        hb_EPObjectsAux = sc.sticky[\"honeybee_EPObjectsAUX\"]()\n        HBScheduleList = sc.sticky[\"honeybee_ScheduleLib\"].keys()\n\n        ########################################################################\n        #----------------------------------------------------------------------#\n        shdBreps = []\n        # create bounding box of shading geometries\n        if justBoundingBox:\n            for brep in shdSurfaces:\n                if brep.Faces.Count>1 or not brep.Faces[0].IsPlanar(sc.doc.ModelAbsoluteTolerance):\n                    shdBreps.append(brep.GetBoundingBox(True).ToBrep())\n                else:\n                    shdBreps.append(brep)\n        else:\n            shdBreps = shdSurfaces\n        \n        shadingClasses = []\n        shadingMeshPreview = []\n        \n        if meshingSettings == None:\n            mp = rc.Geometry.MeshingParameters.Minimal\n            mp.SimplePlanes = True\n        else:\n            mp = meshingSettings\n        \n        def getRadMaterialName(radMaterial):\n            nameStr = radMaterial.split(\" \")[2]\n            name =  nameStr.split(\"\\n\")[0]\n            return name\n        \n        for brepCount, brep in enumerate(shdBreps):\n            if brep != None:\n                isPlanar = True\n                # check planarity\n                for face in brep.Faces:\n                    if not face.IsPlanar(tolerance):\n                        isPlanar = False\n                        break\n                \n                shadingBreps = []\n                if not isPlanar:\n                    meshArray = rc.Geometry.Mesh.CreateFromBrep(brep, mp)\n                    for mesh in meshArray:\n                        for meshFace in range(mesh.Faces.Count):\n                            vertices = list(mesh.Faces.GetFaceVertices(meshFace))[1:]\n                            vertices = vertices + [sc.doc.ModelAbsoluteTolerance]\n                            # create the brep from mesh\n                            shdBrep = rc.Geometry.Brep.CreateFromCornerPoints(*vertices)\n                            shadingBreps.append(shdBrep)\n                else:\n                    for face in brep.Faces:\n                        shadingBreps.append(face.DuplicateFace(False))\n                \n                for faceCount, shdBrep in enumerate(shadingBreps):\n                        thisShading = hb_EPSHDSurface(shdBrep, 1000*brepCount + faceCount, 'shdSrf_' + `brepCount` + '_' + `faceCount` + \"_\" + str(uuid.uuid4()))\n                        \n                        # add transmittance schedule if any\n                        if EPTransSchedule!=None:\n                            schedule= EPTransSchedule.upper()\n                            if schedule!=None and not schedule.lower().endswith(\".csv\") and schedule not in HBScheduleList:\n                                msg = \"Cannot find \" + schedule + \" in Honeybee schedule library.\"\n                                print msg\n                                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                                return -1\n                            elif schedule!=None and schedule.lower().endswith(\".csv\"):\n                                # check if csv file is existed\n                                if not os.path.isfile(schedule):\n                                    msg = \"Cannot find the shchedule file: \" + schedule\n                                    print msg\n                                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\n                                    return -1\n                            \n                            thisShading.TransmittanceSCH = schedule\n                        \n                        # add the Rad Material if any\n                        if RADMaterial!=None:\n                            # if it is just the name of the material make sure it is already defined\n                            if len(RADMaterial.split(\" \")) == 1:\n                                # if the material is not in the library add it to the library\n                                if not hb_RADMaterialAUX.isMatrialExistInLibrary(RADMaterial):\n                                    warningMsg = \"Can't find \" + RADMaterial + \" in RAD Material Library.\\n\" + \\\n                                                \"Add the material to the library and try again.\"\n                                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                                    return\n                                \n                                try:\n                                    thisShading.setRADMaterial(RADMaterial)\n                                except Exception, e:\n                                    print e\n                                    warningMsg = \"You are using an old version of Honeybee_Honeybee! Update your files and try again.\"\n                                    print warningMsg\n                                    ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                                    return\n                                \n                                addedToLib = True\n                            else:\n                                \n                                # try to add the material to the library\n                                addedToLib, thisShading.RadMaterial = hb_RADMaterialAUX.analyseRadMaterials(RADMaterial, True)\n                                \n                            if addedToLib==False:\n                                warningMsg = \"Failed to add \" + RADMaterial + \" to the Library.\"\n                                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warningMsg)\n                                return\n                        \n                        # add shading to the list\n                        shadingClasses.append(thisShading)\n                \n        # add to the hive\n        hb_hive = sc.sticky[\"honeybee_Hive\"]()\n        HBContext  = hb_hive.addToHoneybeeHive(shadingClasses, ghenv.Component)\n        return HBContext\n        ################################################################################################\n    else:\n        print \"You should first let Honeybee to fly...\"\n        w = gh.GH_RuntimeMessageLevel.Warning\n        ghenv.Component.AddRuntimeMessage(w, \"You should first let Honeybee to fly...\")\n        return -1\n        \n\nif _shdSurfaces and _shdSurfaces[0]!=None:\n    # add cleaning function\n    result= main(_shdSurfaces, EPTransSchedule_, meshingSettings_, justBoundingBox_)\n    \n    if result != -1: HBContext = result",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}