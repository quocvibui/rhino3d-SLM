{
  "source_url": "https://github.com/ibois-epfl/Manis-timber-plate-joinery-solver/blob/9b0d22db181d4f55f01816440a5c0a31cda502bc/Gh%20compilation%20files/dowel.py",
  "repo": "ibois-epfl/Manis-timber-plate-joinery-solver",
  "repo_stars": 12,
  "repo_description": "A grasshopper plugin to create joints between timber panels and export CNC toolpath and robot trajectories for fully automated workflow from design to fabrication to assembly.",
  "license": "MIT",
  "filepath": "Gh compilation files/dowel.py",
  "instruction": "Create Dowel Joints between plates with Face to Face connections",
  "code": "\"\"\"Create Dowel Joints between plates with Face to Face connections\"\"\"\r\n\r\nfrom ghpythonlib.componentbase import dotnetcompiledcomponent as component\r\nimport Grasshopper, GhPython\r\nimport System\r\nimport copy\r\nfrom Grasshopper import DataTree\r\nfrom Grasshopper.Kernel.Data import GH_Path\r\n\r\n__author__ = \"Nicolas Rogeau\"\r\n__laboratory__ = \"IBOIS, Laboratory for Timber Construction\" \r\n__university__ = \"EPFL, Ecole Polytechnique Federale de Lausanne\"\r\n__funding__ = \"NCCR Digital Fabrication, ETH Zurich\"\r\n__version__ = \"2021.09\"\r\n\r\nclass MyComponent(component):\r\n    def __new__(cls):\r\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\r\n            \"Add Dowel Joint\", \"Dowel\", \"\"\"Create Dowel Joints between plates with Face to Face connections\"\"\", \"Manis\", \"Joints\")\r\n        return instance\r\n    \r\n    def get_ComponentGuid(self):\r\n        return System.Guid(\"f7337d23-a306-4630-a218-cb7208b3bbd0\")\r\n    \r\n    def SetUpParam(self, p, name, nickname, description):\r\n        p.Name = name\r\n        p.NickName = nickname\r\n        p.Description = description\r\n        p.Optional = True\r\n    \r\n    def RegisterInputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"model\", \"model\", \"Plate model.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_String()\r\n        self.SetUpParam(p, \"plates_pairs\", \"plates_pairs\", \"(Optional) List of pair of plates (a,b) to only add joints between those plates.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.list\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_number\", \"dowel_number\", \"The number of dowels to create for each contact zones.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_radius\", \"dowel_radius\", \"The radius of the dowels.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_tolerance\", \"dowel_tolerance\", \"The distance between the border of the hole and the dowel \")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_retreat_1\", \"dowel_retreat_1\", \"The distance which separate the top of the surface of the first plate to one side of the dowel.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_retreat_2\", \"dowel_retreat_2\", \"The distance which separate the top of the surface of the second plate to the one side of the dowel.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"circle_radius\", \"circle_radius\", \"(In the case of several dowels) The radius of the circle on which the dowels are laying.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"circle_rotation\", \"circle_rotation\", \"(In the case of several dowels) The rotation of the circle on which the dowels are laying.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_angle_1\", \"dowel_angle_1\", \"The rotation of the dowel in the plane of the plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Number()\r\n        self.SetUpParam(p, \"dowel_angle_2\", \"dowel_angle_2\", \"The rotation of the dowel through the plate.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n        p = Grasshopper.Kernel.Parameters.Param_Boolean()\r\n        self.SetUpParam(p, \"parallel\", \"parallel\", \"Align all dowels if True. Otherwise, the inclination of the dowels is directed towards the center of the joint.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n\r\n        p = Grasshopper.Kernel.Parameters.Param_Curve()\r\n        self.SetUpParam(p, \"tile\", \"tile\", \"(Optional) Geometric tile as polyline to customize the shape of the dowel. Tile should be drawn scale and centered on the world origin.\")\r\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\r\n        self.Params.Input.Add(p)\r\n        \r\n    \r\n    def RegisterOutputParams(self, pManager):\r\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\r\n        self.SetUpParam(p, \"model\", \"model\", \"Updated plate model.\")\r\n        self.Params.Output.Add(p)\r\n\r\n        p = Grasshopper.Kernel.Parameters.Param_Brep()\r\n        self.SetUpParam(p, \"joints_positives\", \"joints_positives\", \"The joints to add to each plate.\")\r\n        self.Params.Output.Add(p)\r\n\r\n        p = Grasshopper.Kernel.Parameters.Param_Brep()\r\n        self.SetUpParam(p, \"joints_negatives\", \"joints_negatives\", \"The joints to subtract from each plate.\")\r\n        self.Params.Output.Add(p)\r\n\r\n        p = Grasshopper.Kernel.Parameters.Param_Brep()\r\n        self.SetUpParam(p, \"joints_keys\", \"joints_keys\", \"The keys to insert in each plate.\")\r\n        self.Params.Output.Add(p)\r\n\r\n\r\n    def SolveInstance(self, DA):\r\n        p0 = self.marshal.GetInput(DA, 0)\r\n        p1 = self.marshal.GetInput(DA, 1)\r\n        p2 = self.marshal.GetInput(DA, 2)\r\n        p3 = self.marshal.GetInput(DA, 3)\r\n        p4 = self.marshal.GetInput(DA, 4)\r\n        p5 = self.marshal.GetInput(DA, 5)\r\n        p6 = self.marshal.GetInput(DA, 6)\r\n        p7 = self.marshal.GetInput(DA, 7)\r\n        p8 = self.marshal.GetInput(DA, 8)\r\n        p9 = self.marshal.GetInput(DA, 9)\r\n        p10 = self.marshal.GetInput(DA, 10)\r\n        p11 = self.marshal.GetInput(DA, 11)\r\n        p12 = self.marshal.GetInput(DA, 12)\r\n        result = self.RunScript(p0, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12)\r\n\r\n        if result is not None:\r\n            if not hasattr(result, '__getitem__'):\r\n                self.marshal.SetOutput(result, DA, 0, True)\r\n            else:\r\n                self.marshal.SetOutput(result[0], DA, 0, True)\r\n                self.marshal.SetOutput(result[1], DA, 1, True)\r\n                self.marshal.SetOutput(result[2], DA, 2, True)\r\n                self.marshal.SetOutput(result[3], DA, 3, True)\r\n        \r\n    def get_Internal_Icon_24x24(self):\r\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAADISURBVEhL7Y9BDsIgFETZunbjLbTlSt5IC/VGnskNMh8maeHTVneavmSS8meYT83OzpRQaDPlxaaI5mXV9M6FLYrRXJ8WaD76KqYhO7hw8S6c3TC7DMVorv94wZiL7xLshpuce4dzmrGA4JtzZjBDXwVe3I1eQlhi/UP+Amfr05wFBN+cM4MZ+ipQuqbWgtJHnwbNVRHNW5BKeD2vM2FGNL8laVPQgrn+lxdMVfotxayKGv5Gua9CXnk6HkQ8l6K/pJjb+W+MeQOOdDulf6sO+wAAAABJRU5ErkJggg==\"\r\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\r\n\r\n    \r\n    def RunScript(self, model, plates_pairs, dowel_number, dowel_radius, dowel_tolerance, dowel_retreat_1, dowel_retreat_2, circle_radius, circle_rotation, dowel_angle_1, dowel_angle_2, parallel, tile):\r\n        \r\n        def list_to_datatree(raggedList):\r\n            rl = raggedList\r\n            result = DataTree[object]()\r\n            for i in range(len(rl)):\r\n                temp = []\r\n                for j in range(len(rl[i])):\r\n                    temp.append(rl[i][j])\r\n                path = GH_Path(i)\r\n                result.AddRange(temp, path)\r\n            return result\r\n\r\n        joints_positives = []\r\n        joints_negatives = []\r\n        joints_keys = []\r\n\r\n        if model:\r\n            model = copy.deepcopy(model)\r\n            model.add_dowels(plates_pairs, \r\n                dowel_number,\r\n                dowel_radius, \r\n                dowel_tolerance, \r\n                dowel_retreat_1, \r\n                dowel_retreat_2, \r\n                circle_radius, \r\n                circle_rotation, \r\n                dowel_angle_1,\r\n                dowel_angle_2,\r\n                parallel,\r\n                tile)\r\n\r\n            for plate in model.plates:\r\n                joints_positives.append(plate.joints_positives)\r\n                joints_negatives.append(plate.joints_negatives)\r\n                joints_keys.append(plate.joints_keys)\r\n            joints_positives = list_to_datatree(joints_positives)\r\n            joints_negatives = list_to_datatree(joints_negatives)\r\n            joints_keys = list_to_datatree(joints_keys)\r\n\r\n        else: \r\n            self.AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, 'Waiting to get a model as input.')\r\n        return (model, joints_positives, joints_negatives, joints_keys)\r\n\r\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\r\n    def get_AssemblyName(self):\r\n        return \"Add Dowel Joint\"\r\n    \r\n    def get_AssemblyDescription(self):\r\n        return \"\"\"\"\"\"\r\n\r\n    def get_AssemblyVersion(self):\r\n        return \"0.1\"\r\n\r\n    def get_AuthorName(self):\r\n        return \"Nicolas Rogeau\"\r\n    \r\n    def get_Id(self):\r\n        return System.Guid(\"791715cb-89d3-4f3d-9cdc-cae46be64cb4\")",
  "language": "python",
  "imports": [
    "ghpythonlib"
  ],
  "has_docstring": true
}