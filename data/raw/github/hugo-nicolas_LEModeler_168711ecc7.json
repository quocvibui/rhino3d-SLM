{
  "source_url": "https://github.com/hugo-nicolas/LEModeler/blob/7780bc8a0163ea84ce0b2934858ecab2ff124a63/PythonFiles/main.py",
  "repo": "hugo-nicolas/LEModeler",
  "repo_stars": 5,
  "repo_description": "Automated generation and export of parametric hydrofoil geometries using Rhinoceros 3D CAD engine",
  "license": "GPL-3.0",
  "filepath": "PythonFiles/main.py",
  "instruction": null,
  "code": "import os\r\nimport sys\r\nimport Rhino\r\nfrom Rhino.Geometry import *\r\nfrom Rhino.Input import RhinoGet\r\nfrom Rhino.Commands import Result\r\nfrom Rhino.DocObjects import ObjectType\r\nimport rhinoscriptsyntax as rs\r\nfrom scriptcontext import doc\r\n\r\nfrom Class_Stab import Stab\r\nfrom Class_Wing import Wing\r\nfrom Class_Foil import Foil\r\nfrom Class_Mast import Mast\r\nfrom Class_Fuselage_front import Fuselagefront\r\nfrom Class_Fuselage_rear import Fuselagerear\r\n\r\n\r\n\r\ndef PartsToModel(filename='..\\\\input_parameters.txt'):\r\n    \"\"\" defines the foil parts to model \"\"\"\r\n    try:\r\n        f = open(filename, 'r+')\r\n    except IOError as e:\r\n        print('Unable to open de file\\n', e)\r\n        sys.exit()\r\n    Parts = dict()\r\n    for el in f.readlines():\r\n        el_split = el.split('=')\r\n        if len(el_split) == 2:\r\n            if str(el_split[0]).strip(' ') in ['wing','stab','mast','fuselage']:\r\n                    Parts[str(el_split[0]).strip(' ')] = str(el_split[1]).strip('\\n ')\r\n    return Parts\r\n\r\n\r\ndef SaveAsRhinoFile(extension,Parts_foil_export):\r\n    \"\"\" exports the whole foil \"\"\"\r\n    for key_export in Parts_foil_export.keys():\r\n        rs.SelectObject(str(Parts_foil_export[key_export]))\r\n        if os.path.exists('..\\\\Exports\\\\part_' + key_export + extension):\r\n            os.remove('..\\\\Exports\\\\part_' + key_export + extension)\r\n        path = os.path.abspath('..\\\\Exports\\\\part_' + key_export + extension)\r\n        cmd = \"_-Export \" + path + \" _Enter\"\r\n        rs.Command(cmd)\r\n        rs.UnselectObjects(str(Parts_foil_export[key_export]))\r\n\r\n\r\ndef ClearRhinoFile():\r\n    \"\"\" deletes every surfaces that are not useful polysurfaces \"\"\"\r\n    arrObjects = rs.AllObjects()\r\n    for el in arrObjects:\r\n        if not rs.IsPolysurface(el):\r\n            rs.DeleteObject(el)\r\n\r\n\r\ndef ClearLayerRhinoFile():\r\n    \"\"\" deletes every layers that are empty \"\"\"\r\n    arrLayers = rs.LayerNames(False)\r\n    for layerName in arrLayers:\r\n        if rs.IsLayerEmpty(layerName):\r\n            rs.DeleteLayer(layerName)\r\n\r\n\r\ndef CreateObjectRhinoFile():\r\n    \"\"\" creates a layer for each object within the Rhino file \"\"\"\r\n    arrObjects = rs.AllObjects()\r\n    i = 0\r\n    for el in arrObjects:\r\n        i = i + 1\r\n        name = \"Layer_number_\" + str(i)\r\n        rs.EnableRedraw(False)\r\n        rs.AddLayer(name)\r\n        rs.ObjectLayer(el, name)\r\n        rs.LayerVisible(name, True)\r\n        rs.EnableRedraw(True)\r\n    return i\r\n\r\n\r\n\r\nif __name__ == '__main__':\r\n    try :\r\n        rs.Command(\"-_SelAll\")\r\n        rs.Command(\"-_Delete\")\r\n    except:\r\n        pass\r\n    \r\n    \"\"\" construction and saving of the foil \"\"\"\r\n\r\n    # Construction \r\n    rs.UnitSystem(4)  # meters\r\n\r\n    Parts = PartsToModel()  # Parts = {\"wing\":'yes',\"stab\":'yes',\"mast\":'yes',\"fuselage\":'yes'}\r\n    Parts_foil = dict()\r\n\r\n    if Parts[\"wing\"] == 'yes':\r\n        # front wing\r\n        wing = Wing()\r\n        Parts_foil[\"wing\"] = wing\r\n\r\n    if Parts[\"stab\"] == 'yes': \r\n        # stabilizer\r\n        stab = Stab()\r\n        Parts_foil[\"stab\"] = stab\r\n\r\n    if Parts[\"mast\"] == 'yes':\r\n        # mast\r\n        mast = Mast()\r\n        Parts_foil[\"mast\"] = mast\r\n    \r\n    if Parts[\"fuselage\"] == 'yes':\r\n        # front part of the fuselage (nose)\r\n        fuselagefront = Fuselagefront()\r\n        # rear part of the fuselage\r\n        fuselagerear = Fuselagerear()\r\n        fuselage = [fuselagefront, fuselagerear]\r\n        Parts_foil[\"fuselage\"] = fuselage\r\n\r\n    # whole foil\r\n    foil = Foil(Parts_foil)\r\n    id_Parts_foil = foil.make_foil(Parts_foil)\r\n    Parts_foil_export = dict()\r\n\r\n    if \"wing\" in Parts_foil.keys():\r\n        \"\"\" closed front wing \"\"\"\r\n        id_wing = id_Parts_foil[\"wing\"]\r\n        try:  # blunt trailing edge  \r\n            if foil.symmetric == 'no':\r\n                curve_wing = rs.DuplicateEdgeCurves(id_wing)  # in : str - out : array of strings\r\n                # 0 left, 1 bottom, 2 right, 3 top\r\n                id_patch_wing = rs.AddEdgeSrf((curve_wing[0], curve_wing[2]))  # in : array - out : str\r\n                id_full_wing = rs.JoinSurfaces((id_patch_wing, id_wing), True)\r\n                curve_wing_new = rs.DuplicateEdgeCurves(id_full_wing)\r\n                id_patch_wing_bot = rs.AddEdgeSrf((curve_wing_new[0], curve_wing_new[5]))  # in : array - out : array\r\n                id_patch_wing_top = rs.AddEdgeSrf((curve_wing_new[2], curve_wing_new[4]))\r\n                # array of strings  # 0 left, 1 bottom, 2 right, 3 top, 4 bottom trailing edge, 5 top trailing edge\r\n                front_wing_export = rs.JoinSurfaces((id_full_wing, id_patch_wing_bot, id_patch_wing_top), True)  # in : array - out : str                \r\n                # in : str - out : str\r\n                Parts_foil_export[\"wing\"] = front_wing_export\r\n            elif foil.symmetric == 'yes':\r\n                # right\r\n                curve_wing = rs.DuplicateEdgeCurves(id_wing)  # in : str - out : array of strings\r\n                # 0 left, 1 bottom, 2 right, 3 top\r\n                id_patch_wing = rs.AddEdgeSrf((curve_wing[0], curve_wing[2]))  # in : array - out : str\r\n                id_full_wing = rs.JoinSurfaces((id_patch_wing, id_wing), True)  # in : array - out : str\r\n                curve_wing_new = rs.DuplicateEdgeCurves(id_full_wing)\r\n                id_patch_wing_bot = rs.AddEdgeSrf((curve_wing_new[2], curve_wing_new[4]))\r\n                # array of strings  # 0 left, 1 bottom, 2 right, 3 top, 4 bottom trailing edge, 5 top trailing edge\r\n                id_full_wing_new = rs.JoinSurfaces((id_full_wing, id_patch_wing_bot), True)  # in : array - out : str\r\n                # left\r\n                id_full_wing_mirror = rs.MirrorObject(id_full_wing_new, (-10, 0, -10), (10, 0, 10), True)\r\n                # in : str - out : str\r\n                front_wing_export = rs.JoinSurfaces((id_full_wing_new, id_full_wing_mirror), True)  # in : array - out : str\r\n                Parts_foil_export[\"wing\"] = front_wing_export\r\n        except:  # sharp trailing edge \r\n            if foil.symmetric == 'no':\r\n                curve_wing = rs.DuplicateEdgeCurves(id_wing)  # in : str - out : array of strings\r\n                id_patch_wing_bot = rs.AddPlanarSrf((curve_wing[1]))  # in : array - out : array\r\n                id_patch_wing_top = rs.AddPlanarSrf((curve_wing[2]))  # in : array - out : array\r\n                front_wing_export = rs.JoinSurfaces((id_patch_wing_bot, id_patch_wing_top, id_wing), True)\r\n                Parts_foil_export[\"wing\"] = front_wing_export\r\n                rs.DeleteObject(id_wing)\r\n                rs.DeleteObject(id_patch_wing_top)\r\n                rs.DeleteObject(id_patch_wing_bot)\r\n            elif foil.symmetric == 'yes':\r\n                # right\r\n                curve_wing = rs.DuplicateEdgeCurves(id_wing)  # in : str - out : array of strings\r\n                id_patch_wing = rs.AddPlanarSrf((curve_wing[1]))  # in : array - out : array\r\n                id_full_wing = rs.JoinSurfaces((id_patch_wing[0], id_wing), True)  # in : array - out : str\r\n                # left\r\n                id_full_wing_mirror = rs.MirrorObject(id_full_wing, (-10, 0, -10), (10, 0, 10), True)\r\n                # in : str - out : str\r\n                front_wing_export = rs.JoinSurfaces((id_full_wing, id_full_wing_mirror), True)  # in : array - out : str\r\n                Parts_foil_export[\"wing\"] = front_wing_export\r\n                # surface deletion\r\n                rs.DeleteObject(id_wing)\r\n                rs.DeleteObject(id_full_wing)\r\n                rs.DeleteObject(id_full_wing_mirror)\r\n\r\n    if \"stab\" in Parts_foil.keys():\r\n        id_stab = id_Parts_foil[\"stab\"]\r\n        \"\"\" closed stabilizer \"\"\"\r\n        try:\r\n            # right\r\n            curve_stab_0 = rs.DuplicateEdgeCurves(id_stab)\r\n            # array of strings  # 0 left, 1 bottom, 2 right, 3 top\r\n            id_patch_stab = rs.AddEdgeSrf((curve_stab_0[0], curve_stab_0[2]))\r\n            id_full_stab_0 = rs.JoinSurfaces((id_patch_stab, id_stab), True)\r\n            curve_stab = rs.DuplicateEdgeCurves(id_full_stab_0)\r\n            id_patch_stab_bot = rs.AddEdgeSrf((curve_stab[2], curve_stab[4]))\r\n            # array of strings  # 0 left, 1 bottom, 2 right, 3 top, 4 bottom trailing edge, 5 top trailing edge\r\n            id_full_stab = rs.JoinSurfaces((id_full_stab_0, id_patch_stab_bot), True)\r\n\r\n            # left\r\n            id_full_stab_mirror = rs.MirrorObject(id_full_stab, (-10, 0, -10), (10, 0, 10), True)\r\n\r\n            stab_export = rs.JoinSurfaces((id_full_stab, id_full_stab_mirror), True)\r\n            Parts_foil_export[\"stab\"] = stab_export\r\n\r\n            # surface deletion\r\n            rs.DeleteObject(id_stab)\r\n            rs.DeleteObject(id_patch_stab)\r\n            rs.DeleteObject(id_full_stab_0)\r\n            rs.DeleteObject(id_patch_stab_bot)\r\n            rs.DeleteObject(id_full_stab)\r\n            rs.DeleteObject(id_full_stab_mirror)\r\n\r\n        except:\r\n            curve_stab = rs.DuplicateEdgeCurves(id_stab)  # array of strings\r\n            id_patch_stab = rs.AddPlanarSrf((curve_stab[1]))  # array of strings\r\n            id_full_stab = rs.JoinSurfaces((id_patch_stab[0], id_stab), True)\r\n\r\n            id_full_stab_mirror = rs.MirrorObject(id_full_stab, (-10, 0, -10), (10, 0, 10), True)\r\n\r\n            stab_export = rs.JoinSurfaces((id_full_stab, id_full_stab_mirror), True)\r\n            Parts_foil_export[\"stab\"] = stab_export\r\n\r\n            # surface deletion\r\n            rs.DeleteObject(id_stab)\r\n            rs.DeleteObject(id_full_stab)\r\n            rs.DeleteObject(id_full_stab_mirror)\r\n\r\n    if \"mast\" in Parts_foil.keys():\r\n        \"\"\" closed mast \"\"\"\r\n        id_mast = id_Parts_foil[\"mast\"]\r\n        try:\r\n            curve_mast_0 = rs.DuplicateEdgeCurves(id_mast)  # array of strings  # 0 left, 1 bottom, 2 right, 3 top\r\n            id_patch_mast = rs.AddEdgeSrf((curve_mast_0[0], curve_mast_0[2]))\r\n            id_full_mast = rs.JoinSurfaces((id_patch_mast, id_mast), True)\r\n            curve_mast = rs.DuplicateEdgeCurves(id_full_mast)\r\n            id_patch_mast_top = rs.AddEdgeSrf((curve_mast[0], curve_mast[5]))\r\n            id_patch_mast_bot = rs.AddEdgeSrf((curve_mast[2], curve_mast[4]))\r\n            # array of strings  # 0 left, 1 bottom, 2 right, 3 top, 4 bottom trailing edge, 5 top trailing edge\r\n\r\n            mast_export = rs.JoinSurfaces((id_full_mast, id_patch_mast_top, id_patch_mast_bot), True)\r\n            Parts_foil_export[\"mast\"] = mast_export\r\n\r\n            # surface deletion\r\n            rs.DeleteObject(id_mast)\r\n            rs.DeleteObject(id_patch_mast)\r\n            rs.DeleteObject(id_patch_mast_top)\r\n            rs.DeleteObject(id_patch_mast_bot)\r\n            rs.DeleteObject(id_full_mast)\r\n\r\n        except:\r\n            curve_mast = rs.DuplicateEdgeCurves(id_mast)  # array of strings\r\n            id_patch_mast_bot = rs.AddPlanarSrf((curve_mast[1]))  # array of strings\r\n            id_patch_mast_top = rs.AddPlanarSrf((curve_mast[2]))  # array of strings\r\n\r\n            mast_export = rs.JoinSurfaces((id_patch_mast_bot, id_patch_mast_top, id_mast), True)\r\n            Parts_foil_export[\"mast\"] = mast_export\r\n\r\n            # surface deletion\r\n            rs.DeleteObject(id_mast)\r\n            rs.DeleteObject(id_patch_mast_bot)\r\n            rs.DeleteObject(id_patch_mast_top)\r\n\r\n    if \"fuselage\" in Parts_foil.keys():\r\n        \"\"\" closed fuselage \"\"\"\r\n        # front\r\n        id_fuselagefront = id_Parts_foil[\"fuselage_front\"]\r\n        curve_fuselagefront = rs.DuplicateEdgeCurves(id_fuselagefront)\r\n        id_patch_fuselagefront = rs.AddPlanarSrf((curve_fuselagefront[1]))\r\n        id_full_fuselagefront = rs.JoinSurfaces((id_patch_fuselagefront, id_fuselagefront), True)\r\n\r\n        # rear\r\n        id_fuselagerear = id_Parts_foil[\"fuselage_rear\"]\r\n        curve_fuselagerear = rs.DuplicateEdgeCurves(id_fuselagerear)\r\n        id_patch_fuselagerear = rs.AddPlanarSrf((curve_fuselagerear[1]))  # string\r\n        id_full_fuselagerear = rs.JoinSurfaces((id_patch_fuselagerear, id_fuselagerear), True)\r\n\r\n        fuselage_export = rs.JoinSurfaces((id_full_fuselagefront, id_full_fuselagerear), True)\r\n        Parts_foil_export[\"fuselage\"] = fuselage_export\r\n\r\n        # surface deletion\r\n        rs.DeleteObject(id_fuselagefront)\r\n        rs.DeleteObject(id_patch_fuselagefront)\r\n        rs.DeleteObject(id_full_fuselagefront)\r\n        rs.DeleteObject(id_fuselagerear)\r\n        rs.DeleteObject(id_patch_fuselagerear)\r\n        rs.DeleteObject(id_full_fuselagerear)\r\n\r\n    # curve deletion\r\n    arrObjects = rs.AllObjects()\r\n    for el in arrObjects:\r\n        if not(rs.IsPolysurface(el)):\r\n            rs.DeleteObject(str(el))\r\n\r\n    # Clears, saves and exports\r\n    for extension in foil.L_extension:\r\n       SaveAsRhinoFile(extension,Parts_foil_export)\r\n    ClearRhinoFile()\r\n    ClearLayerRhinoFile()\r\n    rs.DocumentModified(False)  # prevents a dialog box from popping when closing Rhino\r\n    if foil.close_Rhino == 'yes':\r\n        rs.Exit()\r\n    ",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}