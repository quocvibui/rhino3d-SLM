{
  "source_url": "https://github.com/jingcheng-chen/rhinomcp/blob/615f0eae092d3d129f07fde519b28ca10d31dd6e/rhino_mcp_server/src/rhinomcp/tools/execute_rhinocommon_csharp_code.py",
  "repo": "jingcheng-chen/rhinomcp",
  "repo_stars": 299,
  "repo_description": "RhinoMCP connects Rhino 3D to AI Agent through the Model Context Protocol (MCP)",
  "license": "Apache-2.0",
  "filepath": "rhino_mcp_server/src/rhinomcp/tools/execute_rhinocommon_csharp_code.py",
  "instruction": "Execute rhinocommon csharp code",
  "code": "from mcp.server.fastmcp import Context\nfrom rhinomcp.server import get_rhino_connection, mcp, logger\nfrom typing import Any, List, Dict, Optional\n\n\n@mcp.tool()\ndef execute_rhinocommon_csharp_code(\n    ctx: Context,\n    code: str,\n) -> Dict[str, Any]:\n    \"\"\"\n    Execute RhinoCommon C# code directly in Rhino.\n\n    This tool allows you to execute C# code that uses the RhinoCommon API directly.\n    The code is compiled and executed at runtime using Roslyn.\n\n    IMPORTANT NOTES:\n    ================\n    1. The code runs in a scripting context with the following globals available:\n       - `doc`: The active RhinoDoc (Rhino.RhinoDoc)\n       - `output`: A StringBuilder to capture output (use output.AppendLine(\"...\"))\n\n    2. Common namespaces are pre-imported:\n       - System, System.Collections.Generic, System.Linq\n       - Rhino, Rhino.Geometry, Rhino.DocObjects, Rhino.Commands\n\n    3. Use `output.AppendLine()` to return results to the caller (like print() in Python)\n\n    Parameters:\n    - code: The C# code to execute\n\n    Example Usage:\n    --------------\n    Task: \"Create a sphere at the origin\"\n\n    ```csharp\n    var sphere = new Sphere(Point3d.Origin, 5.0);\n    var brep = sphere.ToBrep();\n    doc.Objects.AddBrep(brep);\n    doc.Views.Redraw();\n    output.AppendLine($\"Created sphere with radius 5 at origin\");\n    ```\n\n    Task: \"List all curves in the document\"\n\n    ```csharp\n    var curves = doc.Objects.FindByObjectType(ObjectType.Curve);\n    output.AppendLine($\"Found {curves.Length} curves:\");\n    foreach (var obj in curves)\n    {\n        output.AppendLine($\"  - {obj.Id}: {obj.Name ?? \"(unnamed)\"}\");\n    }\n    ```\n\n    Task: \"Create a line between two points\"\n\n    ```csharp\n    var start = new Point3d(0, 0, 0);\n    var end = new Point3d(10, 10, 0);\n    var line = new Line(start, end);\n    doc.Objects.AddLine(line);\n    doc.Views.Redraw();\n    output.AppendLine($\"Created line from {start} to {end}\");\n    ```\n\n    Common Mistakes to Avoid:\n    - Forgetting to use `output.AppendLine()` to return results\n    - Not calling `doc.Views.Redraw()` after adding objects\n    - Using types without their namespace (use Point3d, not Rhino.Geometry.Point3d)\n\n    Returns:\n    - success: Whether the code executed successfully\n    - output: Any output from output.AppendLine() calls\n    - message: Error message if failed (includes compilation errors)\n\n    Any changes made to the document will be undone if the script fails.\n    \"\"\"\n    try:\n        logger.info(\"Executing RhinoCommon C# code\")\n\n        # Get the global connection\n        rhino = get_rhino_connection()\n\n        return rhino.send_command(\"execute_rhinocommon_csharp_code\", {\"code\": code})\n\n    except Exception as e:\n        logger.error(f\"Error executing C# code: {str(e)}\")\n        return {\"success\": False, \"message\": str(e)}\n",
  "language": "python",
  "imports": [
    "Rhino.Geometry",
    "RhinoCommon"
  ],
  "has_docstring": false
}