{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/_rhino/Block.tab/sample_layout.button/sample_layout_left.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/_rhino/Block.tab/sample_layout.button/sample_layout_left.py",
  "instruction": "Sample layout left",
  "code": "\r\n__title__ = \"SampleLayout\"\r\n__doc__ = \"\"\"Create sample block layout along crvs to quickly visualize design.\r\n\r\nFeatures:\r\n- Quick block layout visualization\r\n- Flexible block size configuration\r\n- Multiple layout modes:\r\n  - Panel mode: Blocks span between divider points\r\n  - Post mode: Blocks oriented to local coordinate of divider points\r\n- User-friendly interface with clear step-by-step instructions\r\n- Real-time preview of block placement\r\n- Supports both open and closed curves\r\n- Automatically handles curve segmentation for accurate block placement\"\"\"\r\n\r\n__is_popular__ = True\r\n\r\nimport Rhino # pyright: ignore\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\nimport Rhino # pyright: ignore\r\nimport Eto # pyright: ignore\r\n\r\n\r\nfrom EnneadTab import ENVIRONMENT, DATA_FILE, NOTIFICATION, SOUND, LOG, ERROR_HANDLE\r\nfrom EnneadTab.RHINO import RHINO_UI, RHINO_OBJ_DATA\r\n\r\n\r\nFORM_KEY = 'SAMPLE_BLOCK_modeless_form'\r\n\r\n\r\n\r\n\r\n# make modal dialog\r\nclass SampleBlockDialog(Eto.Forms.Form):\r\n    # Initializer\r\n    def __init__(self):\r\n        # Eto initials\r\n        self.Title = \"Sample Block Maker\"\r\n        self.Resizable = True\r\n        self.Padding = Eto.Drawing.Padding(5)\r\n        self.Spacing = Eto.Drawing.Size(5, 5)\r\n        \r\n        #self.Bounds = Eto.Drawing.Rectangle()\r\n        self.height = 400\r\n        self.width = 400\r\n        self.selected_crvs = None\r\n        self.user_block = None\r\n        self.is_flipped = False\r\n        self.Closed += self.OnFormClosed\r\n\r\n\r\n\r\n\r\n        # initialize layout\r\n        main_layout = Eto.Forms.DynamicLayout()\r\n        main_layout.Padding = Eto.Drawing.Padding(5)\r\n        main_layout.Spacing = Eto.Drawing.Size(5, 5)\r\n\r\n\r\n\r\n        # add listBox\r\n        main_layout.BeginVertical()\r\n        main_layout.AddRow(self.CreatePicker())\r\n        main_layout.AddRow(self.Create_block_info_inputs())\r\n        main_layout.EndVertical()\r\n\r\n\r\n\r\n\r\n\r\n        layout = Eto.Forms.DynamicLayout()\r\n        layout.Padding = Eto.Drawing.Padding(5)\r\n        layout.Spacing = Eto.Drawing.Size(5, 5)\r\n\r\n        # add message\r\n        layout.AddSeparateRow(None, self.CreateLogoImage())\r\n        layout.BeginVertical()\r\n        layout.AddRow(self.CreateMessageBar())\r\n        layout.AddRow(self.CreateExpander())\r\n        layout.EndVertical()\r\n\r\n\r\n        layout.BeginVertical()\r\n        layout.AddRow(main_layout)\r\n        layout.EndVertical()\r\n\r\n        # add buttons\r\n        layout.BeginVertical()\r\n        layout.AddRow(*self.CreateButtons())\r\n        layout.EndVertical()\r\n\r\n        # set content\r\n        self.Content = layout\r\n        self.InitiateFiller()\r\n        \r\n        RHINO_UI.apply_dark_style(self)\r\n\r\n    @property\r\n    def main_crv_geo(self):\r\n        if self.selected_crvs:\r\n            return [rs.coercecurve (x) for x in self.selected_crvs]\r\n        return None\r\n\r\n    @property\r\n    def is_post_like(self):\r\n        return self.mode_list.SelectedValue == self.mode_list.DataStore[1]\r\n\r\n    \"\"\"\r\n    @property\r\n    def is_flip_crv(self):\r\n        # return check box isChecked\r\n        return False\r\n    \"\"\"\r\n\r\n\r\n    def CreateLogoImage(self):\r\n        self.logo = Eto.Forms.ImageView()\r\n\r\n        return self.logo\r\n\r\n    # create message bar function\r\n    def CreateMessageBar(self):\r\n        self.msg = Eto.Forms.Label()\r\n        self.msg.Text = \"Pick an open/closed curve and preview its blocks fit thru them as panel or post.\"\r\n        return self.msg\r\n        #self.msg.HorizontalAlignment = Eto.Forms.HorizontalAlignment.Left\r\n\r\n\r\n    def CreateExpander(self):\r\n        self.expander = Eto.Forms.Expander ()\r\n        self.expander.Header = \"Quick Help\"\r\n        self.expander.Expanded = False\r\n        msg = Eto.Forms.Label()\r\n        msg.Text = \"helper document to be filled in.....\"\r\n        self.expander.Content = msg\r\n        return self.expander\r\n\r\n\r\n\r\n    def CreatePicker(self):\r\n        layout = Eto.Forms.DynamicLayout()\r\n        layout.Padding = Eto.Drawing.Padding(5)\r\n        layout.Spacing = Eto.Drawing.Size(5, 5)\r\n        msg = Eto.Forms.Label()\r\n        msg.Text = \"Step 1:\"\r\n        layout.AddRow(msg)\r\n        A = Eto.Forms.Label(Text = 'Pick closed or open crvs.\\nMultiple input crvs now supported!\\nThe flip the crv for dirent orientation.')\r\n        layout.AddRow(A)\r\n\r\n        pick_bn = Eto.Forms.Button(Text = 'Pick Input Curve(s).')\r\n        pick_bn.Click += self.btn_Pick_Crv_Clicked\r\n\r\n        self.crv_label = Eto.Forms.Label(Text = '')\r\n        layout.AddRow(pick_bn,  None)\r\n        layout.AddRow(self.crv_label)\r\n        layout.AddRow(Rhino.UI.Controls.Divider())\r\n\r\n        return layout\r\n\r\n    def Create_block_info_inputs(self):\r\n\r\n\r\n        layout = Eto.Forms.DynamicLayout()\r\n        layout.Padding = Eto.Drawing.Padding(5)\r\n        layout.Spacing = Eto.Drawing.Size(5, 5)\r\n\r\n        stack_layout = Eto.Forms.DynamicLayout()\r\n        stack_layout.Padding = Eto.Drawing.Padding(5)\r\n        stack_layout.Spacing = Eto.Drawing.Size(5, 5)\r\n\r\n\r\n        msg = Eto.Forms.Label()\r\n        msg.Text = \"Step 2:\"\r\n        layout.AddRow(msg)\r\n\r\n        A = Eto.Forms.Label(Text = 'Panel mode spans block between divider pts.\\nPost mode orient to local coordinate of the divider pts.')\r\n        stack_layout.AddRow(A)\r\n        self.mode_list = Eto.Forms.RadioButtonList()\r\n        self.mode_list.Orientation = Eto.Forms.Orientation.Vertical\r\n        self.mode_list.DataStore  = [\"Panel mode\", \"Post mode\"]\r\n        self.mode_list.SelectedValue = self.mode_list.DataStore[0]\r\n        self.mode_list.SelectedValueChanged += self.UI_changed\r\n        stack_layout.AddRow(self.mode_list)\r\n        layout.AddRow(stack_layout)\r\n\r\n\r\n        layout.AddRow(Rhino.UI.Controls.Divider())\r\n        msg = Eto.Forms.Label()\r\n        msg.Text = \"Step 3:\"\r\n        layout.AddRow(msg)\r\n\r\n        stack_layout = Eto.Forms.DynamicLayout()\r\n        stack_layout.Padding = Eto.Drawing.Padding(5)\r\n        stack_layout.Spacing = Eto.Drawing.Size(5, 5)\r\n        A = Eto.Forms.Label(Text = 'You can use your own block or use placeholder block.')\r\n        stack_layout.AddRow(A)\r\n        pick_bn = Eto.Forms.Button(Text = 'Pick Your Own Block')\r\n        pick_bn.Click += self.btn_Pick_User_Block_Clicked\r\n        clear_pick_bn = Eto.Forms.Button(Text = 'Clear User Block')\r\n        clear_pick_bn.Click += self.btn_Clear_Pick_User_Block_Clicked\r\n        stack_layout.AddRow(pick_bn, clear_pick_bn)\r\n        self.user_block_label = Eto.Forms.Label(Text = ' ')\r\n        stack_layout.AddRow(self.user_block_label)\r\n        layout.AddRow(stack_layout)\r\n\r\n\r\n        layout.AddRow(Rhino.UI.Controls.Divider())\r\n\r\n        msg = Eto.Forms.Label()\r\n        msg.Text = \"Step 4:\"\r\n        layout.AddRow(msg)\r\n        stack_layout = Eto.Forms.DynamicLayout()\r\n        stack_layout.Padding = Eto.Drawing.Padding(5)\r\n        stack_layout.Spacing = Eto.Drawing.Size(5, 5)\r\n        A = Eto.Forms.Label(Text = 'Block spacing info in model unit:')\r\n\r\n        stack_layout.AddRow( A)\r\n\r\n\r\n        label = Eto.Forms.Label(Text = 'Using Smaller Text?')\r\n        self.cbox_small_text = Eto.Forms.CheckBox()\r\n        self.cbox_small_text.CheckedChanged += self.btn_preview_Clicked\r\n        stack_layout.AddRow(label,  self.cbox_small_text)\r\n        \r\n        self.label_A = Eto.Forms.Label(Text = 'Panel Width')\r\n        self.tbox_width = Eto.Forms.TextBox()\r\n        stack_layout.AddRow(self.label_A,  self.tbox_width)\r\n\r\n        self.label_B = Eto.Forms.Label(Text = 'Panel Height')\r\n        self.tbox_height = Eto.Forms.TextBox()\r\n        stack_layout.AddRow(self.label_B, self.tbox_height)\r\n\r\n        self.label_C = Eto.Forms.Label(Text = 'Panel Depth')\r\n        self.tbox_depth = Eto.Forms.TextBox()\r\n        stack_layout.AddRow(self.label_C, self.tbox_depth)\r\n\r\n        self.debug_label = Eto.Forms.Label(Text = 'Info:')\r\n        stack_layout.AddRow(None, self.debug_label)\r\n\r\n        layout.AddRow(stack_layout)\r\n\r\n\r\n        return layout\r\n\r\n\r\n    def CreateButtons(self):\r\n        \"\"\"\r\n        Creates buttons for either print the selection result\r\n        or exiting the dialog\r\n        \"\"\"\r\n        user_buttons = []\r\n\r\n        btn = Eto.Forms.Button()\r\n        btn.Text = \"Flip Orientation\"\r\n        btn.Click += self.btn_flip_orientation_Clicked\r\n        user_buttons.append(btn)\r\n\r\n\r\n        user_buttons.append(None)\r\n\r\n        self.btn_Run = Eto.Forms.Button()\r\n        self.btn_Run.Height = 30\r\n        self.btn_Run.Text = \"Update Preview\"\r\n\r\n        self.btn_Run.ImagePosition = Eto.Forms.ButtonImagePosition.Right\r\n        self.btn_Run.Click += self.btn_preview_Clicked\r\n        user_buttons.append(self.btn_Run)\r\n\r\n\r\n\r\n        self.btn_Run = Eto.Forms.Button()\r\n        self.btn_Run.Text = \"Add previewed block to file.\"\r\n        self.btn_Run.Click += self.btn_process_Clicked\r\n        user_buttons.append(self.btn_Run)\r\n\r\n        #self.width = 400\r\n\r\n        return user_buttons\r\n\r\n    # event handler handling clicking on the 'run' button\r\n    def UI_changed(self, sender, e):\r\n        self.generate_blocks_layout(is_preview = True)\r\n        if self.is_post_like:\r\n            self.label_A.Text =  'Post Spacing'\r\n            self.label_B.Text =  'Post Height'\r\n            self.label_C.Text =  'Post Depth'\r\n        else:\r\n            self.label_A.Text =  'Panel Width'\r\n            self.label_B.Text =  'Panel Height'\r\n            self.label_C.Text =  'Panel Depth'\r\n\r\n    # event handler handling clicking on the 'run' button\r\n    def btn_preview_Clicked(self, sender, e):\r\n        self.generate_blocks_layout(is_preview = True)\r\n\r\n\r\n    def btn_process_Clicked(self, sender, e):\r\n        self.generate_blocks_layout(is_preview = False)\r\n        self.clear_out()\r\n        \r\n\r\n    # event handler handling clicking on the 'cancel' button\r\n    def btn_Cancel_Clicked(self, sender, e):\r\n        self.Close()\r\n\r\n\r\n    def btn_Pick_Crv_Clicked(self, sender, e):\r\n        select_objs = rs.GetObjects(message = \"Pick open or closed crvs.\", filter = 4, select = True)\r\n        if select_objs:\r\n            temp_note = \"{} base curve{} captured!\".format(len(select_objs), \"s\" if len(select_objs) > 1 else \"\")\r\n            self.crv_label.Text = temp_note\r\n            NOTIFICATION.messenger(main_text = temp_note)\r\n            map(rs.SimplifyCurve,select_objs)\r\n            self.selected_crvs = select_objs\r\n        else:\r\n            temp_note = \"Base curve not defined!\"\r\n            self.crv_label.Text = temp_note\r\n            NOTIFICATION.messenger(main_text = temp_note)\r\n\r\n        self.generate_blocks_layout(is_preview = True)\r\n\r\n\r\n\r\n    def btn_Pick_User_Block_Clicked(self, sender, e):\r\n        select_obj = rs.GetObject(message = \"Pick a block you want to use in this sample layout.\", filter = 4096, select = True)\r\n        if select_obj:\r\n            try:\r\n                b_name = rs.BlockInstanceName(select_obj)\r\n                self.user_block_label.Text = \"User Block captured! <{}>\".format(rs.BlockInstanceName(select_obj))\r\n                self.user_block = select_obj\r\n            except:\r\n                temp_note = \"This block is not from current file\\nmight be from worksession file?\"\r\n                NOTIFICATION.messenger(main_text = temp_note)\r\n                self.user_block = None\r\n        else:\r\n            self.user_block_label.Text = \"User Block not defined! Will use sample block.\"\r\n            self.user_block = None\r\n\r\n        self.generate_blocks_layout(is_preview = True)\r\n\r\n\r\n\r\n    def btn_Clear_Pick_User_Block_Clicked(self, sender, e):\r\n\r\n        self.user_block_label.Text = \"User Block not defined! Will use sample block.\"\r\n        self.user_block = None\r\n\r\n        self.generate_blocks_layout(is_preview = True)\r\n\r\n\r\n\r\n    def btn_flip_orientation_Clicked(self, sender, e):\r\n\r\n        self.is_flipped = not(self.is_flipped)\r\n        if self.selected_crvs:\r\n            map(rs.ReverseCurve, self.selected_crvs)\r\n        self.generate_blocks_layout(is_preview = True)\r\n\r\n\r\n\r\n\r\n    def generate_blocks_layout(self, is_preview):\r\n\r\n\r\n        try:\r\n\r\n            self.width = float(self.tbox_width.Text)\r\n            self.height = float(self.tbox_height.Text)\r\n            self.depth = float(self.tbox_depth.Text)\r\n        except:\r\n            print (\"size data not valid\")\r\n            return\r\n\r\n\r\n        if self.width * self.depth * self.height == 0:\r\n            temp_note =  \"size data not valid\"\r\n            NOTIFICATION.messenger(main_text = temp_note)\r\n            return\r\n\r\n\r\n        if not self.selected_crvs:\r\n            temp_note =  \"input crvs not is empty\"\r\n            NOTIFICATION.messenger(main_text = temp_note)\r\n            return\r\n\r\n        rs.UnselectAllObjects()\r\n        rs.EnableRedraw(False)\r\n\r\n\r\n        # need to remove preview crvs no matter what\r\n        self.obj_name = \"{}_BLOCK_LAYOUT_PREVIEW\".format(ENVIRONMENT.PLUGIN_ABBR)\r\n        old_crvs = rs.ObjectsByName(self.obj_name)\r\n        rs.DeleteObjects(old_crvs)\r\n\r\n        if not is_preview:\r\n            self.obj_name = \"{}_BLOCK_LAYOUT\".format(ENVIRONMENT.PLUGIN_ABBR)\r\n            SOUND.play_sound(\"sound_effect_popup_msg3.wav\")\r\n        else:\r\n            SOUND.play_sound(\"sound_effect_menu_tap.wav\")\r\n            \r\n\r\n\r\n        # get block name if using user block\r\n\r\n        # create sampleblock to get insert_pt and ref_pt\r\n        block_name = \"{}_layout block_{} x {} x {}\".format(ENVIRONMENT.PLUGIN_ABBR, self.width, self.depth, self.height)\r\n        block_name = make_unique_block_name(block_name)\r\n        if self.is_post_like:\r\n            block_name, insert_pt, ref_pt = self.create_post_block(block_name)\r\n        else:\r\n            block_name, insert_pt, ref_pt = self.create_panel_block(block_name)\r\n\r\n        #  make temp block, use user block name or sampleblock\r\n        if self.user_block:\r\n            try:\r\n                block_name = rs.BlockInstanceName(self.user_block)\r\n            except:\r\n                NOTIFICATION.messenger(main_text = \"Invalid User Block...\")\r\n        self.temp_block = rs.InsertBlock(block_name, insert_pt)\r\n        directional_ref = [0,1,0]\r\n        self.block_reference = [insert_pt, ref_pt, directional_ref]\r\n\r\n        #  flip crv if needed\r\n        # if self.is_flipped:\r\n        #     rs.ReverseCurve(self.selected_crvs)\r\n\r\n        self.total_panel = 0\r\n            \r\n\r\n        map(self.process_base_crv, self.selected_crvs)\r\n        rs.DeleteObject(self.temp_block)\r\n        \r\n        \r\n        rs.Redraw()\r\n        rs.EnableRedraw(True)\r\n        if not is_preview:\r\n            NOTIFICATION.messenger(main_text = \"Blocks added!\")\r\n\r\n        self.debug_label.Text = \"Panel Count = {}\".format(self.total_panel)\r\n        \r\n        \r\n    def process_base_crv(self, base_crv):\r\n        # breakup base crv\r\n        crv_segs = rs.ExplodeCurves(base_crv)\r\n\r\n        #temporartyly set project osnap on to prevent flipping on X axis base line\r\n        #original_project_osnap_status = rs.ProjectOsnaps()\r\n        #rs.ProjectOsnaps(enable = True)\r\n\r\n        collection = []\r\n        #print crv_segs\r\n        for seg in crv_segs:\r\n            #print (rs.CurveLength(seg), self.width)\r\n\r\n            count = round(rs.CurveLength(seg) / self.width)\r\n            if count > 500:\r\n                NOTIFICATION.messenger(main_text = \"Too many segments for this block size...\\nAre you sure the division width is in correct unit?\")\r\n                rs.DeleteObjects(crv_segs)\r\n                break\r\n\r\n            # divide the curve into segments of equal length\r\n            pts_on_seg = rs.DivideCurve(seg, count, create_points = False)\r\n            if not pts_on_seg:\r\n                continue\r\n            if rs.IsCurveClosed(seg):\r\n                pts_on_seg.append(pts_on_seg[0])\r\n\r\n\r\n            # if post mode and open crv then use all pts\r\n            special_case = self.is_post_like and not rs.IsCurveClosed(base_crv)\r\n            #special_case = 0\r\n            for i in range(len(pts_on_seg) - 1 + special_case):\r\n                x0 = pts_on_seg[i]\r\n                #print x0\r\n                if not self.is_post_like:\r\n                    x1 = pts_on_seg[i + 1]\r\n                param = rs.CurveClosestPoint(seg, x0)\r\n                tangent = rs.CurveTangent(seg, param)\r\n\r\n                side_vector = rs.VectorRotate(tangent, 90, [0,0,1])\r\n\r\n                directional_ref_temp = x0 + side_vector\r\n\r\n                if self.is_post_like:\r\n                    target_reference = [x0, x0 + tangent, directional_ref_temp]\r\n                    temp_placed_block = rs.OrientObject( self.temp_block, self.block_reference, target_reference, flags = 1 )\r\n\r\n\r\n                else:\r\n                    target_reference = [x0, x1, directional_ref_temp]\r\n                    temp_placed_block = rs.OrientObject( self.temp_block, self.block_reference, target_reference, flags = 1 + 2)\r\n                    if not temp_placed_block:\r\n                        continue\r\n                    scale_factor = rs.Distance(x0, x1)/self.width\r\n\r\n                    local_plane = Rhino.Geometry.Plane(x0, x1, directional_ref_temp)\r\n                    transform = Rhino.Geometry.Transform.Scale(local_plane, scale_factor, 1,1)\r\n\r\n                    rs.TransformObject( temp_placed_block, transform, copy = False)\r\n\r\n\r\n                collection.append(temp_placed_block)\r\n\r\n\r\n            rs.DeleteObject(seg)\r\n\r\n\r\n        \r\n        rs.AddObjectsToGroup(collection, rs.AddGroup())\r\n        map(lambda x: rs.ObjectName(x, self.obj_name), collection)\r\n        \r\n\r\n        self.total_panel += len(collection)\r\n\r\n\r\n    def get_dot(self, text, box):\r\n        height = 0.5\r\n        if self.cbox_small_text.Checked:\r\n            height = 0.02\r\n        return rs.AddText(text,\r\n                            RHINO_OBJ_DATA.get_center(box),\r\n                            height = height,\r\n                            font = \"Arial\",\r\n                            font_style = 0,\r\n                            justification = 2 + 131072 )\r\n        \r\n        \r\n    def create_post_block(self, name):\r\n        W, H, D = self.width/10, self.height, self.depth\r\n        pt0 = [0,0,0]\r\n        pt2 = [-W/2,0,0]\r\n        pt1 = [W/2, W, H]\r\n        pts = [pt1, pt2]\r\n        ref_pt_coord = [W/2 , 0, 0]\r\n\r\n        box_corners = rs.BoundingBox(pts)\r\n        box = rs.AddBox(box_corners)\r\n        dot = self.get_dot(\"Sample Post\\n<{}>\\nReplace block with better design.\".format(name),box)\r\n\r\n        insert_pt = rs.AddPoint(pt0)\r\n        ref_pt = rs.AddPoint(ref_pt_coord)\r\n        ref_line_start_pt = pt0\r\n        ref_line_end_pt = [0, -W, 0]\r\n\r\n        ref_line = rs.AddLine(ref_line_start_pt, ref_line_end_pt)\r\n        block_contents = [box, insert_pt, ref_pt, ref_line, dot]\r\n        block_name = rs.AddBlock(block_contents, insert_pt, name = name, delete_input = True)\r\n        return block_name, pt0, ref_pt_coord\r\n\r\n    def create_panel_block(self, name):\r\n        W, H, D = self.width, self.height, self.depth\r\n\r\n        pt0 = [0,0,0]\r\n        pt1 = [W, D, H]\r\n        pts = [pt0, pt1]\r\n        ref_pt_coord = [W, 0, 0]\r\n\r\n        box_corners = rs.BoundingBox(pts)\r\n        box = rs.AddBox(box_corners)\r\n        dot = self.get_dot(\"Sample Panel\\n<{}>\\nReplace block with better design.\".format(name),box)\r\n        #dot = rs.AddTextDot(\"Sample Panel <{}>\\nReplace Me\".format(name), RHINO_OBJ_DATA.get_center(box))\r\n        insert_pt = rs.AddPoint(pt0)\r\n        ref_pt = rs.AddPoint(ref_pt_coord)\r\n\r\n        # make center ref line\r\n        ref_line_start_pt = [W/2, 0, 0]\r\n        ref_line_end_pt = [W/2, -W, 0]\r\n        ref_line = rs.AddLine(ref_line_start_pt, ref_line_end_pt)\r\n\r\n        # make corner ref lines\r\n        corner_ref_lines = []\r\n        corner_pts = [[0,0,0],\r\n               [W,0,0],\r\n               [W,0,H],\r\n               [0,0,H]]\r\n        for corner_pt in corner_pts:\r\n\r\n            corner_ref_line_end_pt = [corner_pt[0], corner_pt[1]-W/2, corner_pt[2]]\r\n            corner_ref_lines.append(rs.AddLine(corner_pt, corner_ref_line_end_pt))\r\n            \r\n\r\n        block_contents = [box, insert_pt, ref_pt, ref_line, dot] + corner_ref_lines\r\n        block_name = rs.AddBlock(block_contents, insert_pt, name = name, delete_input = True)\r\n        return block_name, pt0, ref_pt_coord\r\n\r\n\r\n    def OnFormClosed(self, sender, e):\r\n        self.Close()\r\n\r\n\r\n\r\n    def InitiateFiller(self):\r\n\r\n        self.filler_list = [\"tbox_width\",\"tbox_height\", \"tbox_depth\", \"cbox_small_text\"]\r\n        for x in self.filler_list:\r\n            sticky_key = FORM_KEY + x\r\n            default = 0\r\n            value = DATA_FILE.get_sticky(sticky_key, default_value_if_no_sticky = default)\r\n\r\n\r\n            box = getattr(self, x)\r\n            if \"tbox\" in x:\r\n                box.Text  = str(value)\r\n            else:\r\n                box.Checked = value\r\n\r\n\r\n    def Close(self):\r\n        # Remove the events added in the initializer\r\n        #self.RemoveEvents()\r\n        # Dispose of the form and remove it from the sticky dictionary\r\n        if sc.sticky.has_key(FORM_KEY):\r\n            form = sc.sticky[FORM_KEY]\r\n            if form:\r\n                form.Dispose()\r\n                form = None\r\n            sc.sticky.Remove(FORM_KEY)\r\n\r\n        for x in self.filler_list:\r\n            if not hasattr(self, x):\r\n                continue\r\n            box = getattr(self, x)\r\n            sticky_key = FORM_KEY + x\r\n            #print x\r\n            if \"tbox\" in x:\r\n                DATA_FILE.set_sticky(sticky_key, box.Text)\r\n            else:\r\n                DATA_FILE.set_sticky(sticky_key, box.Checked)\r\n\r\n        self.clear_out()\r\n\r\n\r\n\r\n    def clear_out(self):\r\n        obj_name = \"{}_BLOCK_LAYOUT_PREVIEW\".format(ENVIRONMENT.PLUGIN_ABBR)\r\n        old_crvs = rs.ObjectsByName(obj_name)\r\n        rs.DeleteObjects(old_crvs)\r\n        for name in rs.BlockNames():\r\n            if not name:\r\n                continue\r\n            if \"{}_layout block_\".format(ENVIRONMENT.PLUGIN_ABBR) in name and not rs.IsBlockInUse(name):\r\n                rs.DeleteBlock(name)\r\n\r\n        self.selected_crvs = None\r\n        self.crv_label.Text = \"Base curve empty.\"\r\n\r\n\r\ndef make_unique_block_name(block_name):\r\n    while True:\r\n        if block_name not in rs.BlockNames():\r\n            break\r\n\r\n        block_name += \"_new\"\r\n\r\n    return block_name\r\n\r\n\r\n@LOG.log(__file__, __title__)\r\n@ERROR_HANDLE.try_catch_error()\r\ndef sample_layout():\r\n    rs.EnableRedraw(False)\r\n    if sc.sticky.has_key(FORM_KEY):\r\n        return\r\n    dlg = SampleBlockDialog()\r\n    dlg.Owner = Rhino.UI.RhinoEtoApp.MainWindow\r\n    dlg.Show()\r\n    sc.sticky[FORM_KEY] = dlg\r\n    \r\nif __name__ == \"__main__\":\r\n    sample_layout()\r\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}