{
  "source_url": "https://github.com/Arastookhajehee/collaborative-bonsai-ironpython-backend-test-01/blob/51d4b7fbee6d81bf75935e0ed84669429cc7e7db/TimberBranch.py",
  "repo": "Arastookhajehee/collaborative-bonsai-ironpython-backend-test-01",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "TimberBranch.py",
  "instruction": "Timber branch",
  "code": "import clr\nimport System\nimport Rhino\nimport math\nfrom System import Guid\nfrom System.Drawing import Color\nfrom Rhino.Geometry import Plane, Mesh, Box, Interval, Rectangle3d, Transform, Brep, MeshingParameters\n\n# Newtonsoft dll is in the same folder\nimport os\nclr.AddReference('Newtonsoft.Json.dll')\nfrom Newtonsoft.Json import JsonConvert\n\nclass TimberBranch:\n    def __init__(self, placement_plane=None, user=None, color=None, state=None, branch=None, parentIDs=None):\n        try:\n            self.ID = Guid.NewGuid()\n            self.placementPlane = placement_plane if placement_plane else Plane.WorldXY\n            self.duplicatePlane = Plane(self.placementPlane)\n            self.buildOnPlane = Plane(self.placementPlane)\n            self.orientablePlanes = []\n            self.meshBox = Mesh()\n            self.user = user\n            self.color = color\n            self.state = state\n            self.parentIDs = parentIDs if parentIDs else []\n            self.childIDs = []\n            self.width = 18.0\n            self.length = 300.0\n            self.thickness = 18.0\n            self.designTimeStamp = TimberBranch.GetTimeStamp()\n            self.modificationTimeStamp = \"\"\n            self.physicalTimeStamp = \"\"\n            self.brep = None\n            self.selected = False\n            self.message = \"\"\n            self.fabricatedTimeStamp = \"\"\n            self.fabricationFail = False\n            self.placementGlueShift = \"\"\n            self.placementShift = \"\"\n            \n            if branch:\n                self.copy_from(branch, placement_plane)\n            else:\n                self.create_brep()\n                self.create_planes_and_mesh()\n        except:\n            self.ID = Guid.Empty\n\n    def copy_from(self, branch, placement_plane):\n        self.ID = branch.ID\n        self.placementPlane = placement_plane\n        self.duplicatePlane = Plane(placement_plane)\n        self.buildOnPlane = Plane(placement_plane)\n        self.orientablePlanes = []\n        self.meshBox = Mesh()\n        self.user = branch.user\n        self.color = branch.color\n        self.state = branch.state\n        self.parentIDs = branch.parentIDs[:]\n        self.childIDs = branch.childIDs[:]\n        self.width = branch.width\n        self.length = branch.length\n        self.thickness = branch.thickness\n        self.designTimeStamp = branch.designTimeStamp\n        self.modificationTimeStamp = TimberBranch.GetTimeStamp()\n        self.create_brep()\n        self.create_planes_and_mesh()\n\n    def create_brep(self):\n        x_interval = Interval(-self.width / 2, self.width / 2)\n        y_interval = Interval(-self.length / 2, self.length / 2)\n        z_interval = Interval(-self.thickness / 2, self.thickness / 2)\n        self.brep = Box(self.placementPlane, x_interval, y_interval, z_interval).ToBrep()\n\n    def create_planes_and_mesh(self):\n        tolerance = Rhino.RhinoDoc.ActiveDoc.ModelAbsoluteTolerance\n        planes = []\n        for i in range(4):\n            plane = Plane(self.placementPlane)\n            plane.Rotate(i * math.pi / 2, self.placementPlane.YAxis, self.placementPlane.Origin)\n            planes.append(plane)\n            face_border = TimberBranch.GetBorderFace(plane, self.width, self.length, self.thickness)\n            meshing_parameters = MeshingParameters()\n            meshing_parameters.SimplePlanes = True\n            meshing_parameters.GridMaxCount = 1\n            border = face_border.ToNurbsCurve()\n            self.meshBox.Append(Mesh.CreateFromPlanarBoundary(border, meshing_parameters, tolerance))\n        self.orientablePlanes = planes\n\n    def Select(self):\n        self.selected = True\n        self.color = Color.FromArgb(255, self.color.R, self.color.G, self.color.B)\n\n    def UnSelect(self):\n        self.selected = False\n        self.color = Color.FromArgb(70, self.color.R, self.color.G, self.color.B)\n\n    def AddParentID(self, parent_id):\n        self.parentIDs.append(parent_id)\n\n    def AddChildID(self, child_id):\n        self.childIDs.append(child_id)\n\n    def RemoveParentID(self, parent_id):\n        self.parentIDs.remove(parent_id)\n\n    def RemoveChildID(self, child_id):\n        self.childIDs.remove(child_id)\n\n    def ToJson(self):\n        return JsonConvert.SerializeObject(self)\n\n    @staticmethod\n    def FromJson(json_str):\n        return JsonConvert.DeserializeObject[TimberBranch](json_str)\n\n    def BuildOn(self, user, color, state, ignore_heirarchy=False):\n        plane = self.buildOnPlane\n        new_branch = TimberBranch(plane, user, color, state)\n        if ignore_heirarchy:\n            return new_branch\n        new_branch.AddParentID(self.ID)\n        self.AddChildID(new_branch.ID)\n        return new_branch\n\n    @staticmethod\n    def GetBorderFace(orientation_plane, width, length, thickness):\n        x_interval = Interval(-width / 2, width / 2)\n        y_interval = Interval(-length / 2, length / 2)\n        rect = Rectangle3d(orientation_plane, x_interval, y_interval)\n        rect.Transform(Transform.Translation(orientation_plane.ZAxis * -thickness / 2))\n        return rect\n\n    @staticmethod\n    def GetTimeStamp():\n        return System.DateTime.Now.ToString(\"yyyy-MM-dd-HH-mm-ss\")\n\n    @staticmethod\n    def ListToJson(branch_list):\n        return JsonConvert.SerializeObject(branch_list)\n\n    @staticmethod\n    def FromJsonToList(json_str):\n        return JsonConvert.DeserializeObject[list](json_str)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": false
}