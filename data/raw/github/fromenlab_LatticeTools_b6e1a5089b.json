{
  "source_url": "https://github.com/fromenlab/LatticeTools/blob/4ed52adaf55fdab72c4b6c9566f011a3bdc9f8d3/prepare/primitive_origin.py",
  "repo": "fromenlab/LatticeTools",
  "repo_stars": 1,
  "repo_description": "Components for generating lattice structures in Rhino®/Grasshopper®",
  "license": "NOASSERTION",
  "filepath": "prepare/primitive_origin.py",
  "instruction": "Primitive origin",
  "code": "from ghpythonlib.componentbase import dotnetcompiledcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\ndef clean_primitive(primitive):\n    if (primitive.ObjectType == Rhino.DocObjects.ObjectType.Brep):\n        meshed_brep = Rhino.Geometry.Mesh.CreateFromBrep(primitive, Rhino.Geometry.MeshingParameters(1))\n        meshed_primitive = Rhino.Geometry.Mesh()\n        for mesh in meshed_brep:\n            meshed_primitive.Append(mesh)\n\n        meshed_primitive.HealNakedEdges(0.01)\n    else:\n        meshed_primitive = primitive\n\n    meshed_primitive.UnifyNormals()\n    meshed_primitive.Weld(3.1415)\n    if(meshed_primitive.Volume() < 0):\n        meshed_primitive.Flip(True, True, True)\n\n    return meshed_primitive\n\ndef get_cut_planes(primitive):\n    primitive = rs.coercegeometry(primitive)\n    bbox = primitive.GetBoundingBox(True)\n    scaled_bbox = bbox\n    center = bbox.Center\n    center_plane = Rhino.Geometry.Plane(center, Rhino.Geometry.Vector3d(0,0,1))\n    scaled_bbox.Transform(Rhino.Geometry.Transform.Scale(center_plane, 1.2, 1.2, 1))\n\n    x_length = scaled_bbox.Max[0] - scaled_bbox.Min[0]\n    x_interval = Rhino.Geometry.Interval(-x_length/2, x_length/2)\n\n    y_length = scaled_bbox.Max[1] - scaled_bbox.Min[1]\n    y_interval = Rhino.Geometry.Interval(-y_length/2, y_length/2)\n\n    z_vector = Rhino.Geometry.Vector3d(0,0,1)\n\n    top_point = Rhino.Geometry.Point3d(center[0],center[1],bbox.Max[2])\n    top_plane = Rhino.Geometry.Plane(top_point, -z_vector)\n    top_surface = Rhino.Geometry.PlaneSurface(top_plane, x_interval, y_interval)\n\n    bottom_point = Rhino.Geometry.Point3d(center[0],center[1],bbox.Min[2])\n    bottom_plane = Rhino.Geometry.Plane(bottom_point, z_vector)\n    bottom_surface = Rhino.Geometry.PlaneSurface(bottom_plane, x_interval, y_interval)\n\n    return [Rhino.Geometry.Mesh.CreateFromSurface(surface, Rhino.Geometry.MeshingParameters(1)) for surface in [top_surface, bottom_surface]]\n\ndef get_symmetry_planes(primitive):\n    bbox = primitive.GetBoundingBox(True)\n\n    min_coord_x = bbox.Min[0]*1.2\n    max_coord_x = bbox.Max[0]*1.2\n    x_interval = Rhino.Geometry.Interval(min_coord_x, max_coord_x)\n    \n    min_coord_y = bbox.Min[1]*1.2\n    max_coord_y = bbox.Max[1]*1.2\n    y_interval = Rhino.Geometry.Interval(min_coord_y, max_coord_y)\n    \n    min_coord_z = bbox.Min[2]*1.2\n    max_coord_z = bbox.Max[2]*1.2\n    z_interval = Rhino.Geometry.Interval(min_coord_z, max_coord_z)\n\n    zx_x_interval = Rhino.Geometry.Interval(bbox.Min[0]*1.2, bbox.Max[0]*1.2)\n    zx_z_interval = Rhino.Geometry.Interval((bbox.Min[2]-bbox.Center[2])*1.2, (bbox.Max[2]-bbox.Center[2])*1.2)\n    yz_y_interval = Rhino.Geometry.Interval(bbox.Min[1]*1.2, bbox.Max[1]*1.2)\n    yz_z_interval = Rhino.Geometry.Interval((bbox.Min[2]-bbox.Center[2])*1.2, (bbox.Max[2]-bbox.Center[2])*1.2)\n\n    plane_point = bbox.Center\n\n    XY_cut = Rhino.Geometry.PlaneSurface(Rhino.Geometry.Plane(plane_point, Rhino.Geometry.Vector3d(0,0,-1)), x_interval, y_interval)\n    YZ_cut = Rhino.Geometry.PlaneSurface(Rhino.Geometry.Plane(plane_point, Rhino.Geometry.Vector3d(-1,0,0)), yz_y_interval, yz_z_interval)\n    ZX_cut = Rhino.Geometry.PlaneSurface(Rhino.Geometry.Plane(plane_point, Rhino.Geometry.Vector3d(0,-1,0)), zx_z_interval, zx_x_interval)\n\n    return [Rhino.Geometry.Mesh.CreateFromSurface(surface, Rhino.Geometry.MeshingParameters(1)) for surface in [XY_cut, YZ_cut, ZX_cut]]\n\nclass Primitive(component):\n    def __new__(cls):\n        instance = Grasshopper.Kernel.GH_Component.__new__(cls,\n            \"Primitive - Prepare (Origin)\", \"Primitive\", \"\"\"Converts an input primitive to a mesh for lattice generation. Center input at (0,0,0).\"\"\", \"LatticeTools\", \"Prepare\")\n        return instance\n    \n    def get_ComponentGuid(self):\n        return System.Guid(\"f88468d1-acbe-40ba-bdf7-5cb2c77196d2\")\n    \n    def SetUpParam(self, p, name, nickname, description):\n        p.Name = name\n        p.NickName = nickname\n        p.Description = description\n        p.Optional = True\n    \n    def RegisterInputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_Geometry()\n        self.SetUpParam(p, \"primitive\", \"primitive\", \"Base shape to populate with lattice geometry. Centered at (0,0,0).\")\n        p.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        self.Params.Input.Add(p)\n        \n    \n    def RegisterOutputParams(self, pManager):\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"primitive\", \"primitive\", \"The primitive as a mesh\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"cut_surfaces\", \"cut_surfaces\", \"Top and bottom surfaces, oriented for trimming the lattice\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"symmetry_surfaces\", \"symmetry_surfaces\", \"Surfaces for octant-based symmetry\")\n        self.Params.Output.Add(p)\n        \n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"octant\", \"octant\", \"Primitive mesh octant (-1, -1, -1)\")\n        self.Params.Output.Add(p)\n\n        p = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        self.SetUpParam(p, \"quarter\", \"quarter\", \"Primitive mesh quarter (-1, -1)\")\n        self.Params.Output.Add(p)\n        \n    \n    def SolveInstance(self, DA):\n        p0 = self.marshal.GetInput(DA, 0)\n        result = self.RunScript(p0)\n\n        if result is not None:\n            if not hasattr(result, '__getitem__'):\n                self.marshal.SetOutput(result, DA, 0, True)\n            else:\n                self.marshal.SetOutput(result[0], DA, 0, True)\n                self.marshal.SetOutput(result[1], DA, 1, True)\n                self.marshal.SetOutput(result[2], DA, 2, True)\n                self.marshal.SetOutput(result[3], DA, 3, True)\n        \n    def get_Internal_Icon_24x24(self):\n        o = \"iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAHYcAAB2HAY/l8WUAAAK9SURBVEhLYyAGhGUWmwan5ESmpdVzQYUoB+GpRVbGNk63uXh4/wmJiv+XV9H4z8HJ9U9V1/CtnVfgnojkPHGoUtKBW1DUcl5+wf+xuZX/155+8H/v3S9gvPH80/+ts1f/d/QJ+S+rrPYtKrPYGKqFeOAWGLVYTEr2/9IDV+AGo+M9dz7/T6to+S8oIvbHPzqtyj0kZq6pjfN1O8/AA4GxmVlQozBBWFqxHQ+fwP/F+y9jNRgdN05f9l/X1Oq/k2/o/5z6nv9RmSX/xaXl/hvZOt7EGl+mdi43YrLLsRpGLN586cV/YNz9B/kGaiwDQ3x+vYCNq98xYTGJ/xvOPsaqkRS86vgdUIL4H1lUL8IAiihxSZlfDt5BYAlsGsjBajqG/wPiMzMY7L1CdnqFJ2BVRC4GJQIJWYX/ISm5IQySCsrfJ67cjVUhuXjOtpP/RSWkf4PDn09Q+O+KozexKiQHrzhy47+qtgEikvXM7R4mFtViVUwqnrvj9H9Qrrf3CdkKNhwEQGkf5B1rV9//i/ZexKqRWAxyqLmTx3mo0QgQnVvP5+Adso1PQOgfKPywaSYGF7dNAeWB21BjMYGtm9/h6OwyrJqJwaCcbOsZuB9qHCYIjM0okFNW+7/j+lusBuDD26+9+S+rpPrfPza1GGocdqBjYv3EMzQOw5KFey781ze3AWMQG1kOZLhHSOx/kF6oMbhBVFaxvI6pxVOQT6KySv/nNfT99wyL/w+KH5eAyBWugZErgUX5P5AYSA4ULCCXgwyPySlWhBqDCuzr61kC4rNSkSsRkFdBaRlUAIIMDkkttIdKMYDYIDGQHCjM8QYLyHBFFc0vIuJS/7l5+f6Bszc1QUhCdgqo3ACVHxHpRf+tnD3PQqWoA0DBAqp3QYZLySn+945I7oJKUQ+AggXkcpDhofX1bFDhoQAYGADLMuz3NxXYUwAAAABJRU5ErkJggg==\"\n        return System.Drawing.Bitmap(System.IO.MemoryStream(System.Convert.FromBase64String(o)))\n\n    def RunScript(self, primitive):\n        primitive = clean_primitive(primitive)\n        cut_surfaces = get_cut_planes(primitive)\n        symmetry_surfaces = get_symmetry_planes(primitive)\n        octant = Rhino.Geometry.Mesh.CreateBooleanDifference({primitive}, symmetry_surfaces)\n        quarter = Rhino.Geometry.Mesh.CreateBooleanDifference({primitive}, symmetry_surfaces[1:3])\n        \n        return primitive, cut_surfaces, symmetry_surfaces, octant, quarter\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}