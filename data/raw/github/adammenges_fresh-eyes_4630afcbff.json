{
  "source_url": "https://github.com/adammenges/fresh-eyes/blob/d458eb0199488355ccf9d5e77afc1429f77d5908/utility%20scripts/rhinoscripts/_superseded/180405_process_housing_models.py",
  "repo": "adammenges/fresh-eyes",
  "repo_stars": 0,
  "repo_description": "AI + Architecture",
  "license": "GPL-3.0",
  "filepath": "utility scripts/rhinoscripts/_superseded/180405_process_housing_models.py",
  "instruction": "180405 process housing models",
  "code": "\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext\nimport System.Drawing\nimport os\n\ndef main():\n    #basepath = \"C:\\\\Users\\\\ksteinfe\\\\Desktop\\\\TEMP\" #Kyle's Desktop\n    basepath = \"G:\\\\TEMP\" #Matt's Desktop\n    #basepath = \"C:\\\\Users\\\\Matt\\\\Desktop\\\\Temp\" #Matt's Laptop\n\n    max_flrs = 99 # maximum number of folders to open\n    max_fils = 99 # maximum number of files to open in each folder\n\n    folder_tic = time.clock()\n    fdr_cnt = 0\n    for root, dirs, files in walklevel(basepath):\n        \n        print (\"{}\\t {}\".format(fdr_cnt,root))\n        #if (root == basepath): continue\n        \n        fil_cnt = 0\n        for full_filename in files:\n            filename, file_extension = os.path.splitext(full_filename)\n            if file_extension != \".3dm\": continue\n\n            file_tic = time.clock()\n            filepath = os.path.join(root, full_filename)\n            rs.DocumentModified(False)\n            rs.Command('_-Open {} _Enter'.format('\"'+filepath+'\"'))\n            t = round(time.clock()-file_tic)\n            print(filename+\"\\ttime:\\t\"+str(t))\n            \n            #massing color\n            rs.CurrentLayer(\"MASSING\")\n            m=235#patch color\n            rs.LayerColor(\"MASSING\",(m,m,m))\n\n            #patch openings\n            p=200#patch color\n            patch_opening(\"DOOR\",(p,p,p))#set color here\n            patch_opening(\"WINDOW\",(p,p,p))#set color here\n            rs.LayerPrintWidth(\"SITE\", width=0.4)#set print width here\n\n            #setting view & site lines\n            rs.CurrentLayer(\"SITE\")\n            s=120#patch color\n            rs.LayerColor(\"SITE\",(s,s,s))\n            rs.Command(\"SelText Delete SelPts Delete\") #delete text for zoom_viewer to work...\n            zoom_viewer(\"SITE\",(1,-1.5,1),(0,0,0))#set focus layer,camera, target\n            zoom_out()\n            zoom_out()\n            zoom_out()\n            \n            #add ground plane\n            g=255#patch color\n            rs.AddLayer(\"GROUND_PLANE\",(g,g,g))\n            rs.CurrentLayer(\"GROUND_PLANE\")\n            rs.Command(\"plane c 0 1000 enter \")#create ground plane for site\n            rs.Command(\"PrintDisplay\"+\"s\"+\" _-Enter\"+\"o\"+\" _-Enter\"+\" _-Enter\")#ensures lineweights are displaying\n            capture_view_antialias(os.path.join(basepath,filename+\"_antialias.png\"), (800,800) )#changeimagesize\n\n            #update\n            fil_cnt+=1\n            if fil_cnt > max_fils: break\n\n        fdr_cnt+=1\n        if fdr_cnt > max_flrs: break\n    \n    t = round(time.clock()-folder_tic)\n    print(\"TOTAL\\ttime:\\t\"+str(t))\n\n\ndef zoom_viewer(layername,camera,focus):\n        rs.CurrentLayer(layername)\n        rhobjs = scriptcontext.doc.Objects.FindByLayer(layername)\n        set_active_view(\"Perspective\")\n        view = rs.CurrentView()\n        set_disp_mode(\"Arctic\")\n        rs.ViewProjection(view,1)\n        rs.ViewCameraTarget(view,camera,focus)#adjust view\n        rs.ViewCameraLens(view,30)\n        rhobjs = scriptcontext.doc.Objects.FindByLayer(layername)\n        rs.SelectObject(rhobjs[0])\n        rs.ZoomSelected()\n        rs.UnselectAllObjects()\n\ndef zoom_out():\n        rs.Command(\"Zoom o \")#ZoomOut\n\ndef patch_site(layername,color):\n    rs.CurrentLayer(layername)\n    rhobjs = scriptcontext.doc.Objects.FindByLayer(layername)\n    surface=rs.AddPlanarSrf(rhobjs[0])\n    material_index = rs.AddMaterialToObject(surface)# add new material and get its index\n    rs.MaterialColor(material_index, color)# assign material color\n    rs.LayerColor(layername,(0,0,0))\n    try:\n        return surface\n    except:\n        return False\n\ndef patch_opening(layername,color):\n    rs.CurrentLayer(layername)\n    rs.LayerColor(layername,color)\n    crvs = scriptcontext.doc.Objects.FindByLayer(layername)\n    for crv in crvs:\n        rs.SelectObject(crv)\n        rs.Command(\"extrudecrv solid=yes bothsides=yes 0.05 delete\")\n\ndef set_active_view(viewportName):\n    RhinoDocument = Rhino.RhinoDoc.ActiveDoc\n    view = RhinoDocument.Views.Find(viewportName, False)\n    if view is None: return\n    RhinoDocument.Views.ActiveView = view\n    return view # returns RhinoCommon view. for Rhinoscript, use rs.CurrentView()\n\n\n# scale_fac is capture to save size ratio\ndef capture_view_antialias(filePath, save_size=1.0, scale_fac = 2.0 ): \n    RhinoDocument = Rhino.RhinoDoc.ActiveDoc\n    view = RhinoDocument.Views.ActiveView    \n    vp = view.ActiveViewport\n    \n    try:\n        capture_size = System.Drawing.Size(save_size[0]*scale_fac,save_size[1]*scale_fac)\n    except:\n        save_size = vp.Size.Width*save_size,vp.Size.Height*save_size\n        capture_size = System.Drawing.Size(save_size[0]*scale_fac,save_size[1]*scale_fac)\n    \n    capture = view.CaptureToBitmap( capture_size )\n    capture = resize_bitmap(capture,save_size)\n    capture.Save(filePath);\n\ndef capture_view(filePath, save_size=1.0):\n    RhinoDocument = Rhino.RhinoDoc.ActiveDoc\n    view = RhinoDocument.Views.ActiveView    \n    vp = view.ActiveViewport\n    \n    try:\n        capture_size = System.Drawing.Size(save_size[0],save_size[1])\n    except:\n        save_size = vp.Size.Width*save_size,vp.Size.Height*save_size\n        capture_size = System.Drawing.Size(save_size[0],save_size[1])\n    \n    capture = view.CaptureToBitmap( capture_size )\n\n    capture.Save(filePath);\n\n\ndef resize_bitmap(src_img,size):\n    dest_rect = System.Drawing.Rectangle(0,0,size[0],size[1])\n    dest_img = System.Drawing.Bitmap(size[0],size[1])\n    dest_img.SetResolution(src_img.HorizontalResolution, src_img.VerticalResolution)\n    \n    with System.Drawing.Graphics.FromImage(dest_img) as g:\n        g.CompositingMode = System.Drawing.Drawing2D.CompositingMode.SourceCopy\n        g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality\n        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic\n        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality\n        g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality\n        \n        with System.Drawing.Imaging.ImageAttributes() as wrap_mode:\n            wrap_mode.SetWrapMode(System.Drawing.Drawing2D.WrapMode.TileFlipXY)\n            g.DrawImage(src_img, dest_rect, 0,0, src_img.Width, src_img.Height, System.Drawing.GraphicsUnit.Pixel, wrap_mode)\n    return dest_img\n\n\ndef set_disp_mode(modename):\n    desc = Rhino.Display.DisplayModeDescription.FindByName(modename)\n    if desc: \n        scriptcontext.doc.Views.ActiveView.ActiveViewport.DisplayMode = desc\n        #scriptcontext.doc.Views.Redraw()\n\nimport rhinoscriptsyntax as rs\nimport os, time\n\ndef walklevel(some_dir, level=1):\n    some_dir = some_dir.rstrip(os.path.sep)\n    assert os.path.isdir(some_dir), \"Directory not found:\\t{}\".format(some_dir)\n    num_sep = some_dir.count(os.path.sep)\n    for root, dirs, files in os.walk(some_dir):\n        yield root, dirs, files\n        num_sep_this = root.count(os.path.sep)\n        if num_sep + level <= num_sep_this:\n            del dirs[:]\n            \n\nif __name__ == \"__main__\":\n    # execute only if run as a script\n    main()",
  "language": "python",
  "imports": [
    "Rhino",
    "RhinoCommon",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}