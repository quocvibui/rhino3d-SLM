{
  "source_url": "https://github.com/bsamiee/Parametric_Arsenal/blob/54ec3f5a7fc2c671cb7bc4601772820e625a1904/rhino/plugins/ArchBuilder/libs/command_base.py",
  "repo": "bsamiee/Parametric_Arsenal",
  "repo_stars": 0,
  "repo_description": "Rhino 8 Plugins and Scripts - A comprehensive monorepo for architectural automation, parametric design, and creative workflows",
  "license": "MIT",
  "filepath": "rhino/plugins/ArchBuilder/libs/command_base.py",
  "instruction": "Title         : command_base.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/ArchBuilder/libs/command_base.py",
  "code": "\"\"\"\nTitle         : command_base.py\nAuthor        : Bardia Samiee\nProject       : Parametric Forge\nLicense       : MIT\nPath          : rhino/plugins/ArchBuilder/libs/command_base.py\n\nDescription\n----------------------------------------------------------------------------\nBase functionality for individual arch commands to minimize duplication.\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import Any, Callable\n\nimport Rhino.Geometry as rg\nimport scriptcontext as sc\n\nimport Rhino\nfrom libs.assemble import ArchAssembler\nfrom libs.input_methods import ArchInputManager, InputMethod\nfrom libs.metadata import ArchMetadata\nfrom libs.specs import ArchFamily, ArchSpec\nfrom libs.ui import ProfileSelection\nfrom libs.utils import ArchBuilderUtils\n\n\n# --- Base Command Class ---------------------------------------------------\nclass ArchCommandBase:\n    \"\"\"Base functionality shared by all arch commands.\"\"\"\n\n    def __init__(self, family: ArchFamily, builder: Callable[[ArchSpec], rg.Curve]) -> None:\n        self.family = family\n        self.builder = builder\n        self.abs_tol = ArchBuilderUtils.model_absolute_tolerance()\n\n    def get_profile_selection(self) -> ProfileSelection | None:\n        \"\"\"Collect a profile selection using the method chosen by the user.\"\"\"\n        method = ArchInputManager.get_input_method()\n        if method is None:\n            return None\n\n        if method == InputMethod.CURVE:\n            return ArchInputManager.get_curve_input(self.abs_tol)\n        return ArchInputManager.get_points_input(self.abs_tol)\n\n    def collect_parameters(self, profile: ProfileSelection) -> dict[str, Any] | None:  # noqa: PLR6301\n        \"\"\"Override in subclasses to collect arch-specific parameters.\"\"\"\n        return {}\n\n    def add_to_document(self, curves: list[rg.Curve], spec: ArchSpec) -> None:\n        \"\"\"Add curves to document with metadata.\"\"\"\n        undo = sc.doc.BeginUndoRecord(f\"ArchBuilder {self.family.value}\")\n        try:\n            for curve in curves:\n                ArchMetadata.attach_to_curve(curve, spec)\n                sc.doc.Objects.AddCurve(curve)\n        finally:\n            sc.doc.EndUndoRecord(undo)\n        sc.doc.Views.Redraw()\n\n    def execute(self) -> bool:\n        \"\"\"Gather input, build geometry, and add results to the document.\"\"\"\n        profile = self.get_profile_selection()\n        if profile is None:\n            return False\n\n        metadata = self.collect_parameters(profile)\n        if metadata is None:  # User cancelled parameter collection\n            return False\n\n        spec = ArchSpec(\n            family=self.family,\n            span=profile.span,\n            rise=profile.rise,\n            plane=profile.plane,\n            metadata=metadata,\n        )\n\n        try:\n            profile_local = self.builder(spec)\n        except ValueError as exc:\n            raise RuntimeError(f\"Failed to build {self.family.value.replace('_', ' ')} arch profile: {exc}\") from exc\n        result = ArchAssembler.build(spec, profile_local)\n\n        self.add_to_document(result.all_curves, spec)\n        return True\n\n\n# --- Command Factory Function ---------------------------------------------\ndef arch_command(family: ArchFamily, builder: Callable[[ArchSpec], rg.Curve]) -> Callable[[], int]:\n    \"\"\"Decorator to create arch command with minimal boilerplate.\"\"\"\n\n    def run_command() -> int:\n        try:\n            command = ArchCommandBase(family, builder)\n            success = command.execute()\n        except RuntimeError as exc:\n            Rhino.RhinoApp.WriteLine(f\"ArchBuilder cancelled: {exc}\")\n            return 0\n        else:\n            if success:\n                Rhino.RhinoApp.WriteLine(f\"ArchBuilder: {family.value} created.\")\n            return 0 if success else 1\n\n    return run_command\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "scriptcontext"
  ],
  "has_docstring": true
}