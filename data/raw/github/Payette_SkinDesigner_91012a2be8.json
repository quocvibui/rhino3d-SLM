{
  "source_url": "https://github.com/Payette/SkinDesigner/blob/f53b5e9262a1e7a3da19c58d90c773e7cdb953d6/src/SkinDesigner_Panel.py",
  "repo": "Payette/SkinDesigner",
  "repo_stars": 9,
  "repo_description": "SkinDesigner facade panelization tool for Grasshopper",
  "license": "GPL-3.0",
  "filepath": "src/SkinDesigner_Panel.py",
  "instruction": "Use this component to generate a panel type to be used by the SkinGenerator component to generate a panelized skin.",
  "code": "# SkinDesigner: A Plugin for Building Skin Design (GPL) started by Santiago Garay\n\n# This file is part of SkinDesigner.\n# \n# Copyright (c) 2017, Santiago Garay <sgaray1970@gmail.com> \n# SkinDesigner is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# SkinDesigner is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# You should have received a copy of the GNU General Public License\n# along with SkinDesigner; If not, see <http://www.gnu.org/licenses/>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n\n#Panel\n\"\"\"\nUse this component to generate a panel type to be used by the SkinGenerator component to generate a panelized skin.\n\n    Args:\n        name: A string that represents the panel ID. By defualt it uses de component guid (not recommended).\n        activate: A boolean that turns the panel on/off. Default is off.        \n        definitions: A string with panel functions to be executed on this panel (only for advanced use, refer to Panel API)        \n        width: A float number specifying the panel width in scene units\n        height: A float number specifying the panel height in scene units\n        thickness: A float number specifying the panel wall object thickness in scene units\n        panelSystem: A list with data generated by panel system-type components: CurtainWall, Wall, etc.\n        windowSystem:  A list with data generated by Window component\n        shadingSystems: lists with data generated by shading-type components: Shade, LouverShading, ShadingBox\n        customSystem: A list with data generated by a CustomGeometry component \n\n\n    Returns:\n        panel: A Panel object that represents a Panel data structure to be used as input on Panel_Bay, Skin_Generator or Panel Viewer components\n        panelDefinition: A string representing the panel properties as panel functions (refer to Panel API). \n            It can be saved for reference or be used as input on another panel component (as a live reference for instance)\n            \n\"\"\"\n\nghenv.Component.Name = \"SkinDesigner_Panel\"\nghenv.Component.NickName = 'Panel'\nghenv.Component.Message = 'VER 0.1.17\\nDec_17_2017'\nghenv.Component.Category = \"SkinDesigner\"\nghenv.Component.SubCategory = \"01 | Construction\"\ntry: ghenv.Component.AdditionalHelpFromDocStrings = \"2\"\nexcept: pass\n\nimport Grasshopper.Kernel as gh\nimport GhPython\n# automnatically set the right input names and types (when using + icon) \nnumInputs = ghenv.Component.Params.Input.Count\naccessList = ghenv.Component.Params.Input[0].Access.list\naccessItem = ghenv.Component.Params.Input[0].Access.item\n\ntypeFloat = GhPython.Component.NewFloatHint()\ntypeString = GhPython.Component.NewStrHint()\ntypeNone =  GhPython.Component.NoChangeHint()\ntypeGHDoc = GhPython.Component.GhDocGuidHint()\ntypeBool = gh.Parameters.Hints.GH_BooleanHint_CS()\nfor input in range(numInputs):\n    access = accessList ; typeHint = typeString\n    if input == 0: inputName = 'name' ; access = accessItem\n    elif input == 1: inputName = 'activate'; access = accessItem; typeHint = typeBool   \n    elif input == 2: inputName = 'definitions' ; access = accessList; typeHint = typeGHDoc\n    elif input == 3: inputName = 'width' ; access = accessItem ; typeHint = typeFloat\n    elif input == 4: inputName = 'height' ; access = accessItem ; typeHint = typeFloat\n    elif input == 5: inputName = 'thickness'; access = accessItem ; typeHint = typeFloat\n    elif input == 6: inputName = 'panelSystem' ; access = accessList; typeHint = typeGHDoc\n    elif input == 7: inputName = 'windowSystem' ; access = accessList; typeHint = typeGHDoc\n    elif input == 8: inputName = 'shadingSystems' ; access = accessList; typeHint = typeGHDoc\n    elif input == 9: inputName = 'customSystem'; access = accessList; typeHint = typeNone \n    else: continue\n    \n    ghenv.Component.Params.Input[input].NickName = inputName\n    ghenv.Component.Params.Input[input].Name = inputName\n    ghenv.Component.Params.Input[input].Access = access\n    ghenv.Component.Params.Input[input].TypeHint = typeHint\n    ghenv.Component.Attributes.Owner.OnPingDocument()\n\n\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext as sc\nimport copy\nfrom types import *\n\n\n    \n#init set up global variables\n\nsc.doc = Rhino.RhinoDoc.ActiveDoc\nunitSystem = sc.doc.ModelUnitSystem\n_UNIT_COEF = 1\nif unitSystem == Rhino.UnitSystem.Feet: _UNIT_COEF = 3.28084\nif unitSystem == Rhino.UnitSystem.Inches: _UNIT_COEF = 3.28084*12\nif unitSystem == Rhino.UnitSystem.Millimeters: _UNIT_COEF = 1000\nsc.doc = ghdoc\n\npanel = None\npanelDefinition = \"\"\nwarningData = []\npanelWarningData = []\n\ntry:\n    SGLibPanel = sc.sticky[\"SGLib_Panel\"]\nexcept:\n    warningData.append(\"I need SkinDesigner_SkinDesigner component\")\n    \n#SKIN GRID GENERATION BASED ON PANEL SIZE\n#------------------------------------------------------------------------------\ndef PanelCreate():\n\n    #initialize\n    sc.doc = Rhino.RhinoDoc.ActiveDoc\n    rs.EnableRedraw(False)\n    global warningData\n    \n    #Create Skin Panel Matrix\n    #Panel dimensions (Units feet or meters)\n    \n    #--------------------------------------------------------------------\n    # PANEL INIT SECTION\n\n    myBasePanel = SGLibPanel()\n    panelDefinition = [\"\"]\n    tmpDefinition = [\"\", None, None, None, None, None]\n    \n    # run size panel properties if avialable\n    if numInputs > 2 and definitions and definitions[0] :\n        if len(definitions) == 1: \n            tmpDefinition = [\"\", None, None, None, None, definitions[0]]\n        else :\n            tmpDefinition = definitions\n            runOK = runActions(tmpDefinition[0], myBasePanel)\n            if not runOK: warningData.append(\"Invalid 'definitions' input (panel size data) - data discarded\")\n            panelDefinition[0] = tmpDefinition[0] \n\n    #set panel properties from inputs and update Panel Defintion\n    if  numInputs > 3 and width:\n        try: myBasePanel.SetWidth(width)\n        except: warningData.append(\"Invalid 'width' input - using default value\")\n        panelDefinition[0] = updateProperty(panelDefinition[0], \"Width\", myBasePanel.GetPanelProperty(\"PanelWidth\"))\n    if numInputs > 4 and height:\n        try: myBasePanel.SetHeight(height)\n        except: warningData.append(\"Invalid 'height' input - using default value\")\n        panelDefinition[0] = updateProperty(panelDefinition[0], \"Height\", myBasePanel.GetPanelProperty(\"PanelHeight\"))\n    if numInputs > 5 and thickness:\n        try: myBasePanel.SetThickness(thickness)\n        except: warningData.append(\"Invalid 'thickness' input - using default value\")\n        panelDefinition[0] = updateProperty(panelDefinition[0], \"Thickness\", myBasePanel.GetPanelProperty(\"PanelThickness\"))\n        \n    #set predifined variables:\n    PanelName = str(ghenv.Component.InstanceGuid).rsplit(\"-\",1)[1]\n\n    if name <> None: PanelName = name\n    myBasePanel.SetName(PanelName) \n    \n    PanelHeight = myBasePanel.GetPanelProperty(\"PanelHeight\")\n    PanelWidth = myBasePanel.GetPanelProperty(\"PanelWidth\")\n    PanelThickness = myBasePanel.GetPanelProperty(\"PanelThickness\")\n    \n    #----------Create Window -----------------------------------------    \n    tmpWindowSystem = None ; Window = None\n    if numInputs > 2 and len(tmpDefinition)>1 and tmpDefinition[1] : tmpWindowSystem = tmpDefinition[1]\n    if numInputs > 7 and windowSystem : tmpWindowSystem = windowSystem\n    if tmpWindowSystem : \n        try:\n            Window = dict(width=tmpWindowSystem[0], height=tmpWindowSystem[1], fromLeft=tmpWindowSystem[2], fromBottom=tmpWindowSystem[3], recess=tmpWindowSystem[4])\n            windowDef = \"AddWindow(width=Window['width'], height=Window['height'], fromLeft=Window['fromLeft'], fromBottom=Window['fromBottom'], recess=Window['recess'])\"\n        except:  \n            warningData.append(\"Invalid 'windowSystem' input - data discarded\")\n            Window = None\n        else:\n            runOK = runActions(windowDef, myBasePanel, Window, PanelWidth, PanelHeight, PanelThickness)\n            if not runOK: warningData.append(\"Invalid 'windoSystem' input - data discarded\")\n    panelDefinition.append(tmpWindowSystem)\n            \n    #------------Create Panel System----------------------------------------------\n    tmpPanelSystem = None\n    if numInputs > 2 and len(tmpDefinition)>2 and tmpDefinition[2] : tmpPanelSystem = tmpDefinition[2]\n    if numInputs > 6 and panelSystem and panelSystem[0]: tmpPanelSystem = panelSystem\n    if tmpPanelSystem:\n        runOK = runActions(tmpPanelSystem[1], myBasePanel, Window, PanelWidth, PanelHeight, PanelThickness)\n        if not runOK: warningData.append(\"Invalid 'panelSystem' input (pane data)- data discarded\")\n        runOK = runActions(tmpPanelSystem[2], myBasePanel, Window, PanelWidth, PanelHeight, PanelThickness)\n        if not runOK: warningData.append(\"Invalid 'panelSystem' input (mullions data)- data discarded\")\n        if Window: \n            runOK = runActions(tmpPanelSystem[3], myBasePanel, Window, PanelWidth, PanelHeight, PanelThickness)\n            if not runOK: warningData.append(\"Invalid 'panelSystem' input (window mullions data)- data discarded\")\n    panelDefinition.append(tmpPanelSystem)\n    \n    #------------Create Shading----------------------------------------------\n    tmpShadeData = None\n    if numInputs > 2 and len(tmpDefinition)>3 and tmpDefinition[3] : tmpShadeData = tmpDefinition[3]    \n    if numInputs > 8 and shadingSystems: tmpShadeData = shadingSystems\n    if tmpShadeData : \n        tmpWindowSystem = None\n        if numInputs > 7 and windowSystem: #create window data without variables to avoid error when solving of parameters\n            tmpWindowSystem = copy.deepcopy(Window)\n            try:\n                if type(tmpWindowSystem['width']) == StringType :  tmpWindowSystem['width'] = eval(tmpWindowSystem['width'])\n                if type(tmpWindowSystem['height']) == StringType :  tmpWindowSystem['height'] = eval(tmpWindowSystem['height'])\n                if tmpWindowSystem['fromLeft'] == 'C' : tmpWindowSystem['fromLeft'] = (PanelWidth-tmpWindowSystem['width'])/2\n                if tmpWindowSystem['fromBottom'] == 'C' : tmpWindowSystem['fromBottom'] = (PanelHeight-tmpWindowSystem['height'])/2  \n                if type(tmpWindowSystem['fromLeft']) == StringType :  tmpWindowSystem['fromLeft'] = eval(tmpWindowSystem['fromLeft'])\n                if type(tmpWindowSystem['fromBottom']) == StringType :  tmpWindowSystem['fromBottom'] = eval(tmpWindowSystem['fromBottom'])\n            except: \n                warningData.append(\"Invalid window parameters - data discarded\")\n                tmpWindowSystem = None\n        for index, shade in enumerate(tmpShadeData):\n            runOK = runActions(shade, myBasePanel, tmpWindowSystem, PanelWidth, PanelHeight, PanelThickness)\n            if not runOK: warningData.append(\"Invalid 'shadingSystem' input - shading system #\"+str(index)+ \" - data discarded\")\n            \n    panelDefinition.append(tmpShadeData)\n            \n    #-------------Create Custom Geometry --------------------------------------------------------\n    tmpGeometryData = None\n    if numInputs > 2 and len(tmpDefinition)>4 and tmpDefinition[4] : tmpGeometryData = tmpDefinition[4]\n    if numInputs > 9 and customSystem : tmpGeometryData = customSystem\n    if tmpGeometryData and len(tmpGeometryData)==8 and tmpGeometryData[0]:\n        try:\n            myBasePanel.AddCustomGeometry(tmpGeometryData[0], tmpGeometryData[1], tmpGeometryData[2], tmpGeometryData[3],+\\\n                tmpGeometryData[4], tmpGeometryData[5], tmpGeometryData[6], tmpGeometryData[7])\n        except: warningData.append(\"Invalid 'customSystem' input - data discarded\")\n    panelDefinition.append(tmpGeometryData)\n\n    # ---------run definition if provided---------------------------------------------------\n    if numInputs > 2 and len(tmpDefinition)>5 and tmpDefinition[5]: \n        runOK = runActions(tmpDefinition[5], myBasePanel, Window,  PanelWidth, PanelHeight, PanelThickness)\n        if not runOK: warningData.append(\"Invalid 'definitions' input - process incomplete\")\n        panelDefinition.append(tmpDefinition[5])\n    \n    #---------- test Draw -------------\n    #myBasePanel.Draw(\"drawGeometry\") #Draw in scene (for checkup geometry only)\n\n    #Wrapup\n    rs.EnableRedraw(True)\n    sc.doc = ghdoc\n    return myBasePanel, panelDefinition\n\n    #----------------------------------------------------------------\n\ndef updateProperty(definition, property, value):\n    txtStart = definition.find(property+\"(\")\n    if txtStart >= 0 :     \n        txtDelete = definition[txtStart : definition.find(\")\",txtStart)+3]\n        definition = definition.replace(txtDelete, \"\")\n        \n    definition = property + \"(\" + str(value) + \")\\r\\n\" + definition\n\n    return definition\n\ndef runActions(actionString, myBasePanel, Window=None, PanelWidth=None, PanelHeight=None, PanelThickness=None, brepGeometry=None):\n    #print [myBasePanel, Window, PanelWidth, PanelHeight, PanelThickness]\n    #print actionString\n    \n    try:\n        actionList = actionString.rsplit(\"\\r\\n\")\n        for action in actionList: \n            if action : \n                if \"Window[\" in action and Window == None: continue\n                action = \"myBasePanel.\" + action\n                codeObj= compile(action,'<string>','single')\n                eval(codeObj)\n    except:\n        return False\n    return True\n    \n\n\nif activate : \n    panel, panelDefinition = PanelCreate()\n    panelWarningData = panel.GetPanelProperty(\"WarningData\")\n\nif warningData <> []: \n    for warning in warningData: ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, str(warning))\nif panelWarningData <> []:\n    for warning in panelWarningData: ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, str(\"Internal Warning:\\n\\r\" +warning))    \nprint \"done\"",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}