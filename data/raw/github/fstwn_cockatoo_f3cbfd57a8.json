{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_ValueWatchdog.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_ValueWatchdog.py",
  "instruction": "Listens for changes in a list of values and sends a True value if anything changes\n(this can be used to reset the Kangaroo Solver for example).\n    Inputs:\n        WatchedValues: These are the values...",
  "code": "\"\"\"\nListens for changes in a list of values and sends a True value if anything changes\n(this can be used to reset the Kangaroo Solver for example).\n    Inputs:\n        WatchedValues: These are the values that are being watched. Has to be a flat list ideally (but might work with datatrees, too). {list, data}\n        Enable: If True, the ValueWatchdog is active. If false, it isn't. Connect a Toggle to switch it on and off. {item,boolean}\n    Outputs:\n        solverReset: Triggers a True when anything has changed, otherwise false. {list,polyline/curve}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 210105\n\"\"\"\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# CUSTOM RHINO IMPORTS\nfrom scriptcontext import sticky as st\nfrom ghpythonlib import treehelpers as th\n\nghenv.Component.Name = \"ValueWatchdog\"\nghenv.Component.NickName = \"VWD\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"01 Pipeline Controlling\"\n\nclass ValueWatchDog(component):\n    \n    def updateComponent(self, values, key):\n        # define callback action\n        def callBack(e):\n            st[key] = values\n            self.ExpireSolution(False)\n        # get ghDoc\n        ghDoc = self.OnPingDocument()\n        # schedule new solution\n        ghDoc.ScheduleSolution(1, \n                   Grasshopper.Kernel.GH_Document.GH_ScheduleDelegate(callBack))\n    \n    def RunScript(self, WatchedValues, Enable):\n        \n        # preprocess value tree\n        WatchedValues.Flatten()\n        WatchedValues = th.tree_to_list(WatchedValues)\n        \n        # get instance guid and init stickey key\n        ig = self.InstanceGuid\n        v_key = str(ig) + \"_VWD_VALUES\"\n        \n        # define initial condition\n        Reset = False\n        \n        if Enable and WatchedValues:\n            if v_key not in st:\n                #print \"Setting values\"\n                st[v_key] = WatchedValues\n                Reset = False\n            if st[v_key] != WatchedValues:\n                #print \"Reset!\"\n                Reset = True\n                self.Message = str(Reset)\n                self.updateComponent(WatchedValues, v_key)\n            else:\n                Reset = False\n                self.Message = str(Reset)\n        else:\n            if not Enable:\n                self.Message = \"ValueWatchdog disabled!\"\n            if not WatchedValues:\n                rml = self.RuntimeMessageLevel.Warning\n                rmsg = \"Input WatchedValues failed to collect Data!\"\n                self.Message = \"No Values to watch...\"\n                self.AddRuntimeMessage(rml, rmsg)\n        \n        # return outputs if you have them; here I try it for you:\n        return Reset\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}