{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph/blob/c433bc8e66f3a51fd05ee4c485f4c54c03d2a569/honeybee_ph_rhino/gh_compo_io/shading/shade_LBT_rad_settings.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph",
  "repo_stars": 6,
  "repo_description": "Honeybe-PH plugin for Rhino / Grasshopper ",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_rhino/gh_compo_io/shading/shade_LBT_rad_settings.py",
  "instruction": "GHCompo Interface: HBPH - Shading Factor Settings - LBT Rad.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Shading Factor Settings - LBT Rad.\"\"\"\n\n\ntry:\n    from typing import Any, Optional\nexcept ImportError:\n    pass  # IronPython\n\ntry:\n    import Rhino.Geometry as rg  # type: ignore\nexcept ImportError:\n    pass  # Outside Grasshopper\n\ntry:\n    from honeybee_ph_utils import sky_matrix\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_utils:\\n\\t{}\".format(e))\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import honeybee_ph_rhino:\\n\\t{}\".format(e))\n\ntry:\n    from ph_units.converter import convert\n    from ph_units.parser import parse_input\n    from ph_units.unit_type import Unit\nexcept ImportError as e:\n    raise ImportError(\"\\nFailed to import ph_units:\\n\\t{}\".format(e))\n\n\nclass HBPH_LBTRadSettings:\n    \"\"\"LBT Radiation Solver Settings.\"\"\"\n\n    def __init__(self, _wsm, _ssm, _mshp, _gs, _lgp, _cpus, _win_mshp=None):\n        # type: (Any, Any, rg.MeshingParameters, float, Any, Optional[int], Optional[rg.MeshingParameters]) -> None\n        self.winter_sky_matrix = _wsm\n        self.summer_sky_matrix = _ssm\n        self.mesh_params = _mshp\n        self.grid_size = _gs\n        self.legend_par = _lgp\n        self.cpus = _cpus\n        self.window_mesh_params = _win_mshp\n\n    def __str__(self):\n        return \"{}()\".format(self.__class__.__name__)\n\n    def __repr__(self):\n        return str(self)\n\n    def ToString(self):\n        return str(self)\n\n\nclass GHCompo_CreateLBTRadSettings(object):\n    \"\"\"Interface for LBT Radiation Solver Settings.\"\"\"\n\n    # -- Defaults\n    winter_period = (10, 3)  # October 1 to March 31\n    summer_period = (6, 9)  # June 1 to September 30'\n\n    def __init__(\n        self,\n        _IGH,\n        _epw_file=None,\n        _north=None,\n        _winter_sky_matrix=None,\n        _summer_sky_matrix=None,\n        _mesh_params=None,\n        _grid_size=None,\n        _legend_par=None,\n        _cpus=None,\n        _window_mesh_params=None,\n    ):\n        # type: (gh_io.IGH, str | None, float | None, Any, Any, rg.MeshingParameters | None, str | None, Any, int | None, rg.MeshingParameters | None) -> None\n        self.IGH = _IGH\n        self.epw_file = _epw_file\n        self.north = _north\n        self.winter_sky_matrix = _winter_sky_matrix\n        self.summer_sky_matrix = _summer_sky_matrix\n        self.mesh_params = _mesh_params or rg.MeshingParameters.Default\n        self.grid_size_in_rhino_doc_units = _grid_size\n        self.legend_par = _legend_par or None\n        self.cpus = _cpus or None\n        self.window_mesh_params = _window_mesh_params\n\n    @property\n    def winter_sky_matrix(self):\n        return self._winter_sky_matrix\n\n    @winter_sky_matrix.setter\n    def winter_sky_matrix(self, _in):\n        if _in:\n            self._winter_sky_matrix = _in\n        elif self.epw_file:\n            self._winter_sky_matrix = sky_matrix.gen_matrix(self.epw_file, self.winter_period, self.north)\n        else:\n            self._winter_sky_matrix = None\n\n    @property\n    def summer_sky_matrix(self):\n        return self._summer_sky_matrix\n\n    @summer_sky_matrix.setter\n    def summer_sky_matrix(self, _in):\n        if _in:\n            self._summer_sky_matrix = _in\n        elif self.epw_file:\n            self._summer_sky_matrix = sky_matrix.gen_matrix(self.epw_file, self.summer_period, self.north)\n        else:\n            self._summer_sky_matrix = None\n\n    @property\n    def grid_size_in_rhino_doc_units(self):\n        # type: () -> Unit\n        return self._grid_size_in_rhino_doc_units\n\n    @grid_size_in_rhino_doc_units.setter\n    def grid_size_in_rhino_doc_units(self, _input):\n        # type: (Optional[str]) -> None\n        \"\"\"Set the grid-size to use for the radiation analysis mesh, considering Rhino unit-types.\"\"\"\n\n        if _input is None:\n            input_value, input_unit = \"152.4\", \"MM\"  # default = 6-INCH\n        else:\n            input_value, input_unit = parse_input(_input)\n\n        # -- Be sure to convert the input to the active Rhino-doc's unit-type\n        target_unit = self.IGH.get_rhino_unit_system_name()\n        grid_size = convert(input_value, input_unit or target_unit, target_unit)\n\n        if not grid_size:\n            raise ValueError(\"Failed to understand the grid-size input of: '{}'?\".format(_input))\n        else:\n            print(\"Converting: {} {} -> {:.4f} {}\".format(input_value, input_unit, grid_size, target_unit))\n            self._grid_size_in_rhino_doc_units = Unit(value=grid_size, unit=target_unit)\n\n    def check_grid_size(self):\n        # type: () -> None\n        \"\"\"Check the grid size and issue a warning if it seems too small (less than 4-inch).\"\"\"\n\n        THRESHOLD_IN_INCHES = Unit(\"4\", \"INCH\")\n        THRESHOLD_IN_RH_DOC_UNITS = THRESHOLD_IN_INCHES.as_a(self.IGH.get_rhino_unit_system_name())\n\n        if self._grid_size_in_rhino_doc_units < THRESHOLD_IN_RH_DOC_UNITS:\n            msg = (\n                \"WARNING: The analysis grid size is set to {:.3f}-{} x {:.3f}-{}. \"\n                \"This is very small and will likely result in long calculation times. \"\n                \"Are you really sure you need an analysis grid with segments \"\n                \"this small? If so, you can proceed, but expect slow execution.\".format(\n                    self._grid_size_in_rhino_doc_units.value,\n                    self._grid_size_in_rhino_doc_units.unit,\n                    self._grid_size_in_rhino_doc_units.value,\n                    self._grid_size_in_rhino_doc_units.unit,\n                )\n            )\n            print(msg)\n            self.IGH.warning(msg)\n        else:\n            msg = \"Analysis grid size is set to {:.3f}-{} x {:.3f}-{}. \".format(\n                self._grid_size_in_rhino_doc_units.value,\n                self._grid_size_in_rhino_doc_units.unit,\n                self._grid_size_in_rhino_doc_units.value,\n                self._grid_size_in_rhino_doc_units.unit,\n            )\n            print(msg)\n\n    def run(self):\n        # type: () -> Optional[HBPH_LBTRadSettings]\n        if not self.winter_sky_matrix or not self.summer_sky_matrix:\n            return None\n\n        self.check_grid_size()\n\n        hbph_obj = HBPH_LBTRadSettings(\n            self.winter_sky_matrix,\n            self.summer_sky_matrix,\n            self.mesh_params,\n            self.grid_size_in_rhino_doc_units.value,\n            self.legend_par,\n            self.cpus,\n            self.window_mesh_params,\n        )\n        return hbph_obj\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}