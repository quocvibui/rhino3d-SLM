{
  "source_url": "https://github.com/contextmachine/mmodel/blob/0545e5c2a11c641fc54e91f603e709d3dea549f3/lahta/tests/tri.py",
  "repo": "contextmachine/mmodel",
  "repo_stars": 0,
  "repo_description": "Deployment branch",
  "license": "Apache-2.0",
  "filepath": "lahta/tests/tri.py",
  "instruction": "Copyright (c) 2022. Computational Geometry, Digital Engineering and Optimizing your construction processe\"",
  "code": "#  Copyright (c) 2022. Computational Geometry, Digital Engineering and Optimizing your construction processe\"\nimport ast\nfrom collections import Iterator\n\nimport rhino3dm\n\nfrom mm.baseitems import Item\nfrom mm.meta import RemoteType\n\n\nclass L2(metaclass=RemoteType, bucket=\"lahta.contextmachine.online\", prefix=\"cxm/internal/L2/\",\n         suffix=\"\"):\n\n    def __enter__(self):\n        return self\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        return True\n\n    def __gethook__(self, hook):\n        # print(f\"{self} get hook\")\n        return list(map(rhino3dm.GeometryBase.Decode, ast.literal_eval(hook[\"Body\"].read().decode())[\"rhino\"]))\n\n    def __sethook__(self, hook):\n        # print(f\"{self} set hook\")\n        return {\"rhino\": map(rhino3dm.GeometryBase.Encode, hook)}\n\n\nclass CollectionMethod:\n\n    def __init__(self, f):\n        self._f = f\n\n    def __set_name__(self, owner, name):\n        self.name = name\n        self.owner = owner\n\n    def __get__(self, instance, owner):\n        # print(\"call method\")\n\n        try:\n            return self.__call__\n        except:\n            raise\n\n    def __call__(self, *args, **kwargs):\n        return self._f(self.owner, *args, **kwargs)\n\n\nclass RhItemCollection(Iterator):\n\n    def __init__(self, cls):\n        super().__init__()\n        self._i = -1\n        self._cls = cls\n        self._children = []\n\n    def __iter__(self):\n        return self\n\n    @property\n    def children(self):\n        return self._children\n\n    @children.setter\n    def children(self, v):\n        self.children.append(v)\n\n    @children.deleter\n    def children(self):\n        del self._children\n\n    def reload(self):\n        self._i = -1\n\n    def __next__(self):\n        self._i += 1\n        if self._i < len(self.children):\n            return self.children[self._i]\n        else:\n            self.reload()\n            raise StopIteration\n\n    def __call__(self, *args, **kwargs):\n        self.children = self._cls(*args, **kwargs)\n        return self\n\n    def __getitem__(self, item):\n        return self.children[item]\n\n    def __setitem__(self, item, v):\n        self.children[item] = v\n\n    def __call_child(self, name):\n        cc = next(self)\n        f = self._cls.__dict__[name]\n\n        def wrp(*args, **kwargs):\n\n            return f(cc, *args, **kwargs)\n\n        while True:\n            try:\n                return wrp\n            except:\n                break\n\n\n@RhItemCollection\nclass RhItem(Item):\n    def __init__(self, *args, json_string=None, **kwargs):\n        self._rhino = None\n        super().__init__(**kwargs)\n        if json_string is not None:\n            self.decode(json_string)\n\n    def __get__(self, instance, ctx=True):\n        if ctx:\n            return self.rhino\n        else:\n            return self._rhino\n\n    @property\n    def rhino(self):\n        return rhino3dm.GeometryBase.Decode(self._rhino)\n\n    @rhino.setter\n    def rhino(self, v):\n        self._rhino = v\n\n    def decode(self, string):\n        if isinstance(string, str):\n            self.rhino = ast.literal_eval(string)\n        else:\n            self.rhino = string\n        return self\n\n    def encode(self):\n        return self._rhino\n\n\nwith L2() as l2:\n    RhItemCollection()\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": true
}