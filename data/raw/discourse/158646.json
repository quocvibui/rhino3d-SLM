{
  "source_url": "https://discourse.mcneel.com/t/rhino-rhinodoc-import-not-running-headless/158646",
  "topic_id": 158646,
  "title": "Rhino.RhinoDoc.Import not running headless",
  "question": "We got a problem calling \nRhino.RhinoDoc.Import\n from a thread that is not the UI thread. The headless document is created immediately beforehand using \nRhinoDoc.CreateHeadless\n. This is the stacktrace of the exception that happens (lowest two calls are our own code):\n\n\nException when reading file: The calling thread cannot access this object because a different thread owns it.\n   at System.Windows.Threading.Dispatcher.VerifyAccess()\n   at MS.Internal.Media.VisualTreeUtils.AsVisual(DependencyObject element, Visual& visual, Visual3D& visual3D)\n   at System.Windows.Media.VisualTreeHelper.GetParent(DependencyObject reference)\n   at System.Windows.UIElement.GetUIParentWithinLayoutIsland()\n   at System.Windows.ContextLayoutManager.LayoutQueue.Add(UIElement e)\n   at System.Windows.UIElement.InvalidateArrange()\n   at Eto.Wpf.Forms.WpfFrameworkElement`3.Invalidate(Boolean invalidateChildren) in D:\\\\BuildAgent\\\\work\\\\commercial\\\\src4\\\\DotNetSDK\\\\Eto\\\\src\\\\Eto.Wpf\\\\Forms\\\\WpfFrameworkElement.cs:line 355\n   at Eto.Wpf.Forms.WpfContainer`3.Invalidate(Boolean invalidateChildren) in D:\\\\BuildAgent\\\\work\\\\commercial\\\\src4\\\\DotNetSDK\\\\Eto\\\\src\\\\Eto.Wpf\\\\Forms\\\\WpfContainer.cs:line 55\n   at RhinoWindows.Forms.StackedDialogPageService.RedrawPageControl(Object pageControl)\n   at Rhino.UI.PanelSystem.OnVisiblePanelCallback(Guid panelTypeGuid, Guid hostId, UInt32 documentSerailNumber, UInt32 state)\n   at UnsafeNativeMethods.RHC_RhinoReadFile(UInt32 docSerialNumber, String path, IntPtr pOptions)\n   at Rhino.RhinoDoc.Import(String filePath)\n   at ShapeDiver.Public.Grasshopper.Import.RhinoHeadlessDocumentLoaderSingleton.LoadUsingRhino(Stream stream, String file_extension, Boolean scaleUsingCurrentDocument, String& err, List`1& outputMaterial) in C:\\\\Program Files (x86)\\\\Jenkins\\\\workspace\\\\GrasshopperCompleteRhino7\\\\SdGhPublicLib\\\\Grasshopper\\\\Import\\\\RhinoHeadlessDocumentLoaderSingleton.cs:line 310\n   at ShapeDiverForGrasshopper.ShapeDiverGeometryImportComponent.HandleDataStream(IGH_DataA...",
  "code_blocks": [
    {
      "code": "Exception when reading file: The calling thread cannot access this object because a different thread owns it.\n   at System.Windows.Threading.Dispatcher.VerifyAccess()\n   at MS.Internal.Media.VisualTreeUtils.AsVisual(DependencyObject element, Visual& visual, Visual3D& visual3D)\n   at System.Windows.Media.VisualTreeHelper.GetParent(DependencyObject reference)\n   at System.Windows.UIElement.GetUIParentWithinLayoutIsland()\n   at System.Windows.ContextLayoutManager.LayoutQueue.Add(UIElement e)\n   at System.Windows.UIElement.InvalidateArrange()\n   at Eto.Wpf.Forms.WpfFrameworkElement`3.Invalidate(Boolean invalidateChildren) in D:\\\\BuildAgent\\\\work\\\\commercial\\\\src4\\\\DotNetSDK\\\\Eto\\\\src\\\\Eto.Wpf\\\\Forms\\\\WpfFrameworkElement.cs:line 355\n   at Eto.Wpf.Forms.WpfContainer`3.Invalidate(Boolean invalidateChildren) in D:\\\\BuildAgent\\\\work\\\\commercial\\\\src4\\\\DotNetSDK\\\\Eto\\\\src\\\\Eto.Wpf\\\\Forms\\\\WpfContainer.cs:line 55\n   at RhinoWindows.Forms.StackedDialogPageService.RedrawPageControl(Object pageControl)\n   at Rhino.UI.PanelSystem.OnVisiblePanelCallback(Guid panelTypeGuid, Guid hostId, UInt32 documentSerailNumber, UInt32 state)\n   at UnsafeNativeMethods.RHC_RhinoReadFile(UInt32 docSerialNumber, String path, IntPtr pOptions)\n   at Rhino.RhinoDoc.Import(String filePath)\n   at ShapeDiver.Public.Grasshopper.Import.RhinoHeadlessDocumentLoaderSingleton.LoadUsingRhino(Stream stream, String file_extension, Boolean scaleUsingCurrentDocument, String& err, List`1& outputMaterial) in C:\\\\Program Files (x86)\\\\Jenkins\\\\workspace\\\\GrasshopperCompleteRhino7\\\\SdGhPublicLib\\\\Grasshopper\\\\Import\\\\RhinoHeadlessDocumentLoaderSingleton.cs:line 310\n   at ShapeDiverForGrasshopper.ShapeDiverGeometryImportComponent.HandleDataStream(IGH_DataAccess DA, Stream stream, String content_type) in C:\\\\Program Files (x86)\\\\Jenkins\\\\workspace\\\\GrasshopperCompleteRhino7\\\\ShapeDiverForGrasshopper\\\\Parameters\\\\ShapeDiverGeometryImportComponent.cs:line 15",
      "language": "unknown",
      "author": "snabela",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "file-io",
    "geometry",
    "grasshopper",
    "materials",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 15,
  "views": 896
}