{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph_plus/blob/b89f9887488d9c10eb732ffafe910cec70be0752/honeybee_ph_plus_rhino/gh_compo_io/hb_tools/sort_geom_objs_by_level.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph_plus",
  "repo_stars": 2,
  "repo_description": "Additional Honeybe-PH Grasshopper Components",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_plus_rhino/gh_compo_io/hb_tools/sort_geom_objs_by_level.py",
  "instruction": "GHCompo Interface: HBPH - Sort Geom by Level.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Sort Geom by Level.\"\"\"\n\ntry:\n    from typing import Dict, List, Tuple\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from itertools import izip  # type: ignore\nexcept ImportError:\n    izip = zip  # Python 3\n\nfrom collections import defaultdict\n\ntry:\n    from Grasshopper import DataTree  # type: ignore\n    from Grasshopper.Kernel.Data import GH_Path  # type: ignore\n    from Rhino import Geometry  # type: ignore\n    from Rhino.Geometry import GeometryBase  # type: ignore\n    from System import Object  # type: ignore\nexcept:\n    pass  # Outside Rhino\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError:\n    raise ImportError(\"Failed to import honeybee_ph_rhino\")\n\n\nclass GHCompo_SortGeomObjectsByLevel(object):\n    \"\"\"Utility for sorting any Rhino Geometry objects by their Z-location (height).\"\"\"\n\n    def __init__(self, _IGH, _geom, _tolerance):\n        # type: (gh_io.IGH, List[Geometry.GeometryBase], float) -> None\n        self.IGH = _IGH\n        self.geom = _geom\n        self.geom_by_level = defaultdict(list)  # type: defaultdict[str, List[GeometryBase]]\n        self.names_by_level = defaultdict(list)  # type: defaultdict[str, List[str]]\n        self.user_text_by_level = defaultdict(list)  # type: defaultdict[str, List[Dict]]\n        self.tolerance = _tolerance or 0.001\n\n    def get_z_height(self, _geom):\n        # type: (Geometry.GeometryBase) -> float\n        \"\"\"Return the Z-dimension value for the bottom / lowest element of the geometry.\"\"\"\n        return min((_.Z for _ in self.IGH.ghc.BoxCorners(_geom)))\n\n    def get_dict_key(self, _geom):\n        # type: (GeometryBase) -> str\n        \"\"\"Return the dict key for sorting the geometry by height. Will try and group\n        together the geometry objects taking into account the tolerance value.\n        \"\"\"\n        z_height = self.get_z_height(_geom)\n\n        for k in self.geom_by_level.keys():\n            # -- try to add to an existing key first, if it can.\n            if abs(float(k) - z_height) < self.tolerance:\n                return k\n        else:\n            # -- if not, add a new key\n            return \"{0:.{precision}f}\".format(z_height, precision=4)\n\n    def run(self):\n        # type: () -> Tuple[List[float], List[GeometryBase], List[Dict]]\n        \"\"\"Returns a DataTree with the geometry organized into branches by their 'level'\"\"\"\n\n        # -- Get all the Geom attributes from the GH Scene\n        geom_input_idx = self.IGH.gh_compo_find_input_index_by_name(\"_geom\")\n        obj_attributes = self.IGH.get_rh_obj_UserText_dict(self.IGH.gh_compo_get_input_guids(geom_input_idx))\n\n        # -- Get all the Geom object info from the RH Scene\n        with self.IGH.context_rh_doc():\n            for attrs, geom in izip(obj_attributes, self.geom):\n                dict_key = self.get_dict_key(geom)\n                self.geom_by_level[dict_key].append(geom)\n                self.names_by_level[dict_key].append(attrs.pop(\"Object Name\"))\n                self.user_text_by_level[dict_key].append(attrs)\n\n        # -- Package up for output\n        geom_ = DataTree[Object]()\n        names_ = DataTree[Object]()\n        user_text_ = DataTree[Object]()\n        for i, k in enumerate(sorted(self.geom_by_level.keys(), key=lambda n: float(n))):\n            geom_.AddRange([_ for _ in self.geom_by_level[k]], GH_Path(i))\n            names_.AddRange([_ for _ in self.names_by_level[k]], GH_Path(i))\n            user_text_.AddRange([_ for _ in self.user_text_by_level[k]], GH_Path(i))\n\n        return geom_, names_, user_text_\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}