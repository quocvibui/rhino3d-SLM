{
  "source_url": "https://github.com/TfedUD/PyPH/blob/87fe2ec207a8b0ddcd3fbb682ea71368c11b580a/PyPH_GH/ghuser_py/PyPH%20-%20Create%20Bldg%20Segment.py",
  "repo": "TfedUD/PyPH",
  "repo_stars": 0,
  "repo_description": "Python toolkit for working with Passive House energy models",
  "license": "GPL-3.0",
  "filepath": "PyPH_GH/ghuser_py/PyPH - Create Bldg Segment.py",
  "instruction": "Assign Honeybee Rooms to a specific 'Buildiing Segment' within the PHX Model. In WUFI, this is used\nas the 'Case', while in C3RRO this will be considered the 'Variant'. For PHIUS\nprojects, use this...",
  "code": "#\n# PyPH: A Plugin for aadding Passive-House data to LadybugTools Models\n# \n# This component is part of the PH-Tools toolkit <https://github.com/PH-Tools>.\n# \n# Copyright (c) 2021, PH-Tools and bldgtyp, llc <phtools@bldgtyp.com> \n# PyPH is free software; you can redistribute it and/or modify \n# it under the terms of the GNU General Public License as published \n# by the Free Software Foundation; either version 3 of the License, \n# or (at your option) any later version. \n# \n# PyPH is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \n# GNU General Public License for more details.\n# \n# For a copy of the GNU General Public License\n# see <https://github.com/PH-Tools/PyPH/blob/main/LICENSE>.\n# \n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\n#\n\"\"\"\nAssign Honeybee Rooms to a specific 'Buildiing Segment' within the PHX Model. In WUFI, this is used\nas the 'Case', while in C3RRO this will be considered the 'Variant'. For PHIUS\nprojects, use this component to break mixed-use projects into separate residential-case\nand non-residential-case variants.\n-\nEM October 20, 2021\n    Args:\n        segment_name_: Name for the building-segment\n        \n        occupancy_category_: Input either -\n            \"1-Residential\" (default)\n            \"2-Non-residential\"\n        \n        usage_type_: Input either -\n            \"1-Residential\" (default)\n            \"4-Office/Administrative building\"\n            \"5-School\"\n            \"6-Other\"\n            \"7-Undefined/unfinished\"\n        \n        num_of_floor_levels_: (int) Total number of floor levels for the group of \n            Honeybee rooms input. Default=1\n        \n        num_units_: (int) Total number of 'units' for the group of Honeybee rooms\n            input For residential, this is the total number of dwelling units\n            in the group of HB-Room. For non-residential, leave this set to \"1\".\n        \n        winter_set_temp_: default = 20C [68F]\n        \n        summer_set_temp_: default = 25C [77F]\n        \n        ----------\n        _HB_rooms: The Honeybee rooms to include in this Building Segment\n    \n    Returns:\n        HB_rooms_: The Honeybee rooms assigned to this Building Segment\n\"\"\"\n\nimport scriptcontext as sc\nimport Rhino as rh\nimport rhinoscriptsyntax as rs\nimport ghpythonlib.components as ghc\nimport Grasshopper as gh\nimport honeybee.boundarycondition\n\nimport LBT_Utils\nimport LBT_Utils.hb_schedules\n\nimport PHX\nimport PHX.bldg_segment\nimport PHX.programs.occupancy\nimport PHX.programs.lighting\nimport PHX.programs.schedules\nimport PHX.spaces\n\nimport PyPH_Rhino.gh_io\nimport PyPH_Rhino.bldg_segment_id\nimport PyPH_Rhino.occupancy\nimport PyPH_Rhino.lighting\nimport PyPH_Rhino.gh_utils\nimport PyPH_Rhino.surfaces\n\n# --\nimport PyPH_GH._component_info_\nreload(PyPH_GH._component_info_)\nghenv.Component.Name = \"PyPH - Create Bldg Segment\"\nDEV = True\nPyPH_GH._component_info_.set_component_params(ghenv, dev='OCT_20_2021')\n\nif DEV:\n    reload(LBT_Utils)\n    reload(LBT_Utils.hb_schedules)\n    reload(PHX.serialization.to_dict)\n    reload(PHX.serialization.from_dict)\n    reload(PHX.bldg_segment)\n    reload(PHX.spaces)\n    reload(PHX.programs.occupancy)\n    reload(PHX.programs.lighting)\n    reload(PHX.programs.schedules)\n    reload(PyPH_Rhino.gh_io)\n    reload(PyPH_Rhino.bldg_segment_id)\n    reload(PyPH_Rhino.occupancy)\n    reload(PyPH_Rhino.lighting)\n    reload(PyPH_Rhino.surfaces)\n\n# -- GH Interface\nIGH = PyPH_Rhino.gh_io.IGH( ghdoc, ghenv, sc, rh, rs, ghc, gh )\n\n#-- New Segment\nnew_bldg_segment = PyPH_Rhino.bldg_segment_id.BldgSegment_ID()\nnew_bldg_segment.name = segment_name_ or '_default_building_'\n\n# -- Segment Occupancy\noccupancy = PHX.programs.occupancy.BldgSegmentOccupancy()\noccupancy.category = PyPH_Rhino.gh_io.input_to_int(IGH, occupancy_category_, 1)\noccupancy.usage_type = PyPH_Rhino.gh_io.input_to_int(IGH, usage_type_, 1)\noccupancy.num_stories = PyPH_Rhino.gh_io.input_to_int(IGH, num_floor_levels_, 1)\noccupancy.num_units = PyPH_Rhino.gh_io.input_to_int(IGH, num_units_, 1)\nIGH.warning(occupancy.validate())\n\n#-- PH Params\nif _PHIUS_certification:\n    new_PH_params = _PHIUS_certification\nelse:\n    new_PH_params = PHX.bldg_segment.PHIUSCertification()\n\nPyPH_Rhino.gh_utils.object_preview(new_bldg_segment)\nPyPH_Rhino.gh_utils.object_preview(occupancy)\nPyPH_Rhino.gh_utils.object_preview(new_PH_params)\n\n\n# --------------------------------------------------------------------------\n# -- Add the data to all the input HB Rooms\nface_ids_in_the_segment = { face.identifier for room in _HB_rooms for face in room.faces  }\nHB_rooms_ = []\nfor room in _HB_rooms:\n    if not room: continue\n    new_hb_room = room.duplicate()\n    \n    \n    # --------------------------------------------------------------------------\n    # -- Re-Set any intersitital Segment<->Segment Face BC from 'Surface' to 'Adiabatic'\n    for face in new_hb_room.faces:\n        if not isinstance(face.boundary_condition, honeybee.boundarycondition.Surface):\n            continue\n        PyPH_Rhino.surfaces.set_HB_face_BC_to_adiabatic_if_match_not_found(face, face_ids_in_the_segment)\n    \n    \n    # --------------------------------------------------------------------------\n    # -- NON_RES ONLY\n    if occupancy.category == 2:\n        default_name = room.properties.energy.program_type.display_name\n        # -- For Non-Residential, calc the PHX Occupancy and Lighting Schedules\n        hb_occ = room.properties.energy.people\n        hb_lighting = room.properties.energy.lighting\n        new_phx_occupancy = PyPH_Rhino.occupancy.phx_occupancy_from_hb(hb_occ, default_name)\n        new_phx_lighting = PyPH_Rhino.lighting.phx_lighting_from_hb(hb_lighting)\n        \n        # -- Build a new Occupancy based on the HB Zone,\n        # -- Apply it to each space in the Zone\n        space_dicts = room.user_data.get('phx',{}).get('spaces',{})\n        new_spaces = []\n        for space_dict in space_dicts.values():\n            new_space = PHX.spaces.Space.from_dict(space_dict)\n            new_space.occupancy = new_phx_occupancy\n            new_space.lighting = new_phx_lighting\n            new_spaces.append(new_space)\n            \n        # -- pack new dict onto HB Room\n        space_dict = {id(space):space.to_dict() for space in new_spaces}\n        new_hb_room = LBT_Utils.user_data.add_to_HB_Obj_user_data(new_hb_room,\n                                    space_dict, 'spaces', _write_mode='overwrite')\n    \n    \n    # --------------------------------------------------------------------------\n    #-- Pack everything back into the HB Room user-data\n    bldg_seg_dict = new_bldg_segment.to_dict()\n    new_hb_room = LBT_Utils.user_data.add_to_HB_Obj_user_data(new_hb_room,\n                                    bldg_seg_dict, 'bldg_segment_id', _write_mode='overwrite')\n    \n    occ_dict = occupancy.to_dict()\n    new_hb_room = LBT_Utils.user_data.add_to_HB_Obj_user_data(new_hb_room,\n                                    occ_dict, 'segment_occupancy', _write_mode='overwrite')\n    \n    ph_param_dict = new_PH_params.to_dict()\n    new_hb_room = LBT_Utils.user_data.add_to_HB_Obj_user_data(new_hb_room,\n                                    ph_param_dict, 'ph_certification', _write_mode='overwrite')\n    \n    \n    # --------------------------------------------------------------------------\n    HB_rooms_.append(new_hb_room)",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}