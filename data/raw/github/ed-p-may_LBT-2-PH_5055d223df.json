{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/rh_plugin_v6/PHPPexport%20%7B82540871-2420-4c7f-8efa-78b7d078cbfe%7D/dev/PHPP_SetSurfaceParams_cmd.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "rh_plugin_v6/PHPPexport {82540871-2420-4c7f-8efa-78b7d078cbfe}/dev/PHPP_SetSurfaceParams_cmd.py",
  "instruction": "Used to Set the User Attribute Text values of Rhino Surface objects. Select an\r\nobject or set of objects and run. You'll be prompted to enter values for \r\nAssembly Type (Wall, Floor, etc..), Boundary...",
  "code": "#\r\n# LBT2PH: A Plugin for creating Passive House Planning Package (PHPP) models from LadybugTools. Created by blgdtyp, llc\r\n# \r\n# This component is part of the PH-Tools toolkit <https://github.com/PH-Tools>.\r\n# \r\n# Copyright (c) 2020, bldgtyp, llc <phtools@bldgtyp.com> \r\n# LBT2PH is free software; you can redistribute it and/or modify \r\n# it under the terms of the GNU General Public License as published \r\n# by the Free Software Foundation; either version 3 of the License, \r\n# or (at your option) any later version. \r\n# \r\n# LBT2PH is distributed in the hope that it will be useful,\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\n# GNU General Public License for more details.\r\n# \r\n# For a copy of the GNU General Public License\r\n# see <http://www.gnu.org/licenses/>.\r\n# \r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\n#\r\n\"\"\"\r\nUsed to Set the User Attribute Text values of Rhino Surface objects. Select an\r\nobject or set of objects and run. You'll be prompted to enter values for \r\nAssembly Type (Wall, Floor, etc..), Boundary Conditions and Material Assemblies\r\nThe Assembly values come from a PHPP-Style Excel file with a 'Components' \r\nworksheet to read from Assembly names will read from 'Components[D15:H113]'.\r\n-\r\nEM Jul. 26, 2020\r\n\"\"\"\r\n\r\nimport rhinoscriptsyntax as rs\r\nimport Eto\r\nimport Rhino\r\nimport json\r\nfrom collections import defaultdict\r\n\r\n__commandname__ = \"PHPP_SetSurfaceParams\"\r\n\r\nclass Model:\r\n    \r\n    def __init__(self, selObjs):\r\n        self.selectedObjects = selObjs\r\n    \r\n    def _setAttrIfNotVaries(self, _obj, _key, _val):\r\n        if _val != '<varies>':\r\n            rs.SetUserText(_obj, _key, _val)\r\n    \r\n    def setObjAttrs(self, _dialogVals):\r\n        for eachObj in self.selectedObjects:\r\n            # Formula to auto-set the obj's name in the User Text = '%<ObjectName(\"{}\")>%'\r\n            rs.SetUserText(eachObj, 'Object Name', '%<ObjectName(\"{}\")>%'.format( str(eachObj) ) )            \r\n            if 'varies' not in str(_dialogVals['srfcName']):\r\n                rs.ObjectName(eachObj, str(_dialogVals['srfcName']))\r\n            \r\n            self._setAttrIfNotVaries(eachObj, 'srfType', _dialogVals['srfcType'])\r\n            self._setAttrIfNotVaries(eachObj, 'EPBC', _dialogVals['srfcEPBC'])\r\n            self._setAttrIfNotVaries(eachObj, 'EPConstruction', _dialogVals['srfcAssmbly'])\r\n    \r\n    def getObjAttrs_Exg(self):\r\n        exgNames, exgTypes, exgEPBCs , exgAssmblies = self._getValsForSelectedObjs()\r\n        \r\n        # Check if the existing properties are all the same frame/glass types, or more than one kind present in the selection?\r\n        exgName = '<varies>' if len(set(exgNames))>1 else exgNames[0] \r\n        exgType = '<varies>' if len(set(exgTypes))>1 else exgTypes[0] \r\n        exgEPBC = '<varies>' if len(set(exgEPBCs))>1 else exgEPBCs[0]\r\n        exgAssmbly = '<varies>' if len(set(exgAssmblies))>1 else exgAssmblies[0]\r\n        \r\n        return exgName, exgType, exgEPBC, exgAssmbly\r\n    \r\n    def getAssmblyLib(self):\r\n        assmblyLib = []\r\n        \r\n        print(\"Reading the Rhino Document's Glazing and Frame Types...\")\r\n        if rs.IsDocumentUserText():\r\n            for eachKey in rs.GetDocumentUserText():\r\n                if 'PHPP_lib_Assmbly' in eachKey:\r\n                    assmblyLib.append( json.loads(rs.GetDocumentUserText(eachKey))['Name'] )\r\n        return assmblyLib\r\n    \r\n    def _getObjUserText(self, _obj, _val, _default):\r\n        keys = rs.GetUserText(_obj)\r\n        if _val in keys:\r\n            return rs.GetUserText(_obj, _val)\r\n        else:\r\n            return _default\r\n    \r\n    def _getValsForSelectedObjs(self):\r\n        nms = []\r\n        types = []\r\n        epbcs = []\r\n        assemblies = []\r\n        \r\n        if len(self.selectedObjects)==0:\r\n            return [''], [''], [''], ['']\r\n            \r\n        for eachObj in self.selectedObjects:\r\n            nms.append(rs.ObjectName(eachObj))\r\n            types.append(self._getObjUserText(eachObj, 'srfType', ''))\r\n            epbcs.append(self._getObjUserText(eachObj, 'EPBC', ''))\r\n            assemblies.append(self._getObjUserText(eachObj, 'EPConstruction', ''))\r\n        \r\n        return nms, types, epbcs, assemblies\r\n\r\nclass View(Eto.Forms.Dialog):\r\n    \r\n    def __init__(self, controller):\r\n        self.controller = controller\r\n        assmblyLib = self.controller.getAssemblyLib()\r\n        exgName, exgType, exgEPBC, exgAssmbly = self.controller.getExistingValues()\r\n        \r\n        self.groupContent = self.createContent(exgName, exgType, exgEPBC, exgAssmbly, assmblyLib)\r\n        self._setWindowParams()\r\n        self._addContentToWindow()\r\n        self._addOKCancelButtons()\r\n    \r\n    def _getSrfcTypeList(self):\r\n         return ['WALL',\r\n            'UndergroundWall',\r\n            'ROOF',\r\n            'UndergroundCeiling',\r\n            'FLOOR',\r\n            'UndergroundSlab',\r\n            'SlabOnGrade',\r\n            'ExposedFloor',\r\n            'CEILING',\r\n            'AIRWALL',\r\n            'WINDOW',\r\n            'SHADING']\r\n    \r\n    def _getEPBClist(self):\r\n        return ['Ground', 'Adiabatic', 'Outdoors']\r\n    \r\n    def createContent(self, _nm, _type, _epbc, _assm, _assmblyLib):\r\n        groupContent = [\r\n            {'groupName': 'Select:',\r\n            'content':[\r\n                {'name': 'srfcName', 'label':'Surface Name:', 'input':Eto.Forms.TextBox( Text = str(_nm))},\r\n                {'name': 'srfcType', 'label':'Surface Type:', 'input': self._createDropDown(self._getSrfcTypeList(), _type)},\r\n                {'name': 'srfcEPBC', 'label':'EPBC:', 'input': self._createDropDown(self._getEPBClist(), _epbc)},\r\n                {'name': 'srfcAssmbly', 'label':'Select Assembly:', 'input': self._createDropDown(_assmblyLib, _assm)}\r\n                ]\r\n            }]\r\n        \r\n        return groupContent\r\n    \r\n    def _createDropDown(self, _data, _exgValue):\r\n        dropDownObj = Eto.Forms.DropDown()\r\n        dropDownObj.DataStore = _data\r\n        dropDownObj.DataStore.Insert(0, _exgValue)\r\n        dropDownObj.SelectedIndex = 0\r\n        dropDownObj.Size = Eto.Drawing.Size(200, -1)\r\n        \r\n        return dropDownObj\r\n        \r\n    def _setWindowParams(self):\r\n        self.Title = \"Set Parameters for the Surface(s) Selected\"\r\n        self.Padding = Eto.Drawing.Padding(15)\r\n        self.Resizable = True\r\n    \r\n    def _addContentToWindow(self):\r\n        self.layout = Eto.Forms.DynamicLayout()\r\n        self.layout.Spacing = Eto.Drawing.Size(10,10)\r\n        self.layout = Eto.Forms.DynamicLayout()\r\n        \r\n        for group in self.groupContent:\r\n            groupObj = Eto.Forms.GroupBox(Text = group.get('groupName', ''))\r\n            groupLayout = Eto.Forms.TableLayout()\r\n            groupLayout.Padding = Eto.Drawing.Padding(5) # Offfset from the outside of the Group Edge\r\n            groupLayout.Spacing = Eto.Drawing.Size(15,10) # Spacing between elements\r\n            \r\n            for tableRow in group.get('content', ''):\r\n                groupLayout.Rows.Add(Eto.Forms.TableRow(\r\n                        Eto.Forms.TableCell(Eto.Forms.Label(Text = tableRow.get('label', 'Label Missing'))), \r\n                        Eto.Forms.TableCell(tableRow.get('input'), None)    \r\n                        ))\r\n            \r\n            groupObj.Content = groupLayout\r\n            self.layout.Add(groupObj)\r\n        \r\n        self.Content = self.layout\r\n    \r\n    def _addOKCancelButtons(self):\r\n        # Create the OK / Cancel Button\r\n        self.Button_OK = Eto.Forms.Button(Text = 'OK')\r\n        self.Button_OK.Click += self.controller.OnOKButtonClick\r\n        self.Button_Cancel = Eto.Forms.Button(Text = 'Cancel')\r\n        self.Button_Cancel.Click += self.controller.OnCancelButtonClick\r\n        \r\n        # Add the Buttons at the bottom\r\n        self.vert = self.layout.BeginVertical()\r\n        self.vert.Padding = Eto.Drawing.Padding(10)\r\n        self.vert.Spacing = Eto.Drawing.Size(15,0)\r\n        self.layout.AddRow(None, self.Button_Cancel, self.Button_OK, None)\r\n        self.layout.EndVertical()\r\n    \r\n    def showWindow(self):\r\n        self.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\r\n    \r\n    def getDialogValues(self):\r\n        dialogValues = defaultdict()\r\n        for eachEntry in self.groupContent[0]['content']:\r\n            if isinstance(eachEntry['input'], Eto.Forms.TextBox):\r\n                dialogValues[eachEntry['name']] = eachEntry['input'].Text\r\n            elif isinstance(eachEntry['input'], Eto.Forms.DropDown):\r\n                dialogValues[eachEntry['name']] = eachEntry['input'].DataStore[eachEntry['input'].SelectedIndex]\r\n                \r\n        return dialogValues\r\n\r\nclass Controller:\r\n    \r\n    def __init__(self, selObjs):\r\n        self.model = Model(selObjs)\r\n        self.view = View(self)\r\n    \r\n    def main(self):\r\n        self.view.showWindow()\r\n    \r\n    def OnOKButtonClick(self, sender, e):\r\n        print('Applying the New Properites to Selected')\r\n        dialogValues = self.view.getDialogValues()\r\n        self.model.setObjAttrs(dialogValues)\r\n        self.Update = True\r\n        self.view.Close()\r\n    \r\n    def OnCancelButtonClick(self, sender, e):\r\n        print('Canceled...')\r\n        self.Update = False\r\n        self.view.Close()\r\n    \r\n    def getExistingValues(self):\r\n        return self.model.getObjAttrs_Exg()\r\n    \r\n    def getAssemblyLib(self):\r\n        return self.model.getAssmblyLib()\r\n\r\ndef RunCommand( is_interactive ):\r\n    print \"Setting the name(s) for the selected object(s)\"\r\n    \r\n    dialog = Controller(rs.SelectedObjects())\r\n    dialog.main()\r\n\r\n# Use for debuging in editor\r\n#RunCommand(True)",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}