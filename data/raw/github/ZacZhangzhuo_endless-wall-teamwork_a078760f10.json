{
  "source_url": "https://github.com/ZacZhangzhuo/endless-wall-teamwork/blob/7257f5f0a1ce359894a3dcd68962fbe23ae19ae7/simulation_v2/send.py",
  "repo": "ZacZhangzhuo/endless-wall-teamwork",
  "repo_stars": 2,
  "repo_description": "This is the brick pick and place of UR5 robot group practice, ETH Zurich MAS dfab 2022-23",
  "license": "MIT",
  "filepath": "simulation_v2/send.py",
  "instruction": null,
  "code": "from imp import reload\nimport Rhino.Geometry as rg\nimport simple_ur_script as ur\nreload(ur)\nimport simple_comm as c\nreload(c)\n\ndef tcp(script):\n    script += ur.set_tcp_by_angles(TCP[0], TCP[1], TCP[2], TCP[3], TCP[4], TCP[5])\n    return script\n\ndef set_robot_base():\n    pt_0 = TABLE_NAVIGATION_POINTS[0] # base plane origin\n    pt_1 = TABLE_NAVIGATION_POINTS[1] \n    pt_2 = TABLE_NAVIGATION_POINTS[2]\n    robot_base = rg.Plane(pt_0,pt_1-pt_0,pt_2-pt_0)\n    return robot_base\n\ndef rhino_to_robot_space(rhino_plane):\n    plane = rhino_plane.Clone()\n    robot_base_plane = set_robot_base()\n    rhino_matrix = rg.Transform.PlaneToPlane(rg.Plane.WorldXY,robot_base_plane)\n    plane.Transform(rhino_matrix)\n    return plane\n\ndef pickup_brick(script,pick_up_plane):\n    planes = []\n    #change the distance if needed\n    SAFE_DIST = 150\n    \n    safe_plane = pick_up_plane.Clone()\n    safe_plane.Translate(rg.Vector3d.ZAxis*SAFE_DIST)\n    \n    ## add to the path: go to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    ## add to the path: go to the pick up plane\n    script += ur.move_l(pick_up_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(pick_up_plane)\n    \n    ## add to the path: turn on the vacuum and wait 1 sec.\n    script += ur.set_digital_out(IO,True)\n    script += ur.sleep(SAFE_SLEEP_TIME)\n\n    # add to the path: go back to the safe_plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    return script, planes\n\ndef place_brick(script, place_plane):\n    \n    planes = []\n\n    safe_plane = place_plane.Clone()\n    safe_plane.Translate(rg.Vector3d.ZAxis*SAFE_DIST)\n    \n    # add to the path: go to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    # add to the path: go to the place plane\n    script += ur.move_l(place_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(place_plane)\n    \n    ## add to the path: turn off the vacuum and wait 1 second (hold the brick)\n    script += ur.set_digital_out(IO,False)\n    script += ur.sleep(SAFE_SLEEP_TIME)\n    # add to the path: go back to the safe plane\n    script += ur.move_l(safe_plane, SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n    planes.append(safe_plane)\n    \n    return script,planes\n\ndef send(script):\n    script = c.concatenate_script(script)\n    c.send_script(script, ROBOT_IP)\n    return script \n\nscript = \"\"\nscript = tcp(script)\n\nif is_debug_mode:\n    test_plane = debug_plane.Clone()\n    script += ur.move_l(rhino_to_robot_space(test_plane), SAFE_ROBOT_ACC, SAFE_ROBOT_VEL)\n\nelse:\n    for i in range(len(brick_planes)):\n        script, p = pickup_brick(script,rhino_to_robot_space(picking_planes[i%len(picking_planes)]))\n        script, p = place_brick(script,rhino_to_robot_space(brick_planes[i]))\n\nif fabricate:\n    send(script)",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": false
}