{
  "source_url": "https://discourse.mcneel.com/t/aligned-dimension-script-in-python-3/198601",
  "topic_id": 198601,
  "title": "Aligned dimension script in python 3",
  "question": "Hi All\n\n\nPlease take a look at what I thought was a simple script using rs.AddAlignedDimension when the script runs all 90 degree dims are ok as are the 45 and 135 degree but the 225 and 315 are not aligned but are square dimensions.\n\n\nI have listed the script and attached model with the points I was using.\n\n\ncurves.3dm\n (159.5 KB)\n\n\n#! python3\nimport Rhino\nimport Rhino.UI\nimport scriptcontext as sc\nimport System\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport rhinoscriptsyntax as rs\nfrom System.Drawing import Color\nfrom decimal import Decimal\nimport math\npi = math.pi \n\nimport operator\n\n#surfaces = []\n\n\nJobNum = []\n#Plane = []\nNewLayer = []\nFont = []\n#Tol = []\n#Thk = []\n#maxDist = []\n#VecScale = []\nModScale = []\nNumDp = []\nSpoints = [] \nNames = []\n\nnumber = 1\n\nOrigls = []\n\ncurves = []\n\n#Geo Vectors Points dialog class\nclass GeoAssociateDialog(forms.Dialog[bool]):\n    \n    # Dialog box Class initializer\n    def __init__(self):\n\n        # call base class initializer\n        super().__init__()\n\n        # Initialize dialog box\n        self.Title = \"Geo Label Curve Length\"\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n        \n        \n        # Create Radio Button List Control\n        #self.m_radiobuttonlist = forms.RadioButtonList()\n        #self.m_radiobuttonlist.DataStore = ['No Plane', 'Fit Plane']\n        #self.m_radiobuttonlist.Orientation = forms.Orientation.Horizontal\n        #self.m_radiobuttonlist.SelectedIndex = 0\n        \n        # Create controls for the dialog\n        self.m_label1 = forms.Label()\n        self.m_label1.Text = \"Job Number:\"\n\n\n        self.m_JobNum_textbox = forms.TextBox()\n        self.m_JobNum_textbox.Text = \"SC-000\"\n        #self.m_JobNum_textbox = forms.TextBox(Text = \"\")\n        \n        self.m_label2 = forms.Label()\n        self.m_label2.Text = \"New Layer:\"\n\n        self.m_NewLayer_textbox = forms.TextBox()\n        self.m_NewLayer_textbox.Text = \"Curve Length\"\n        #self.m_NewLayer_textbox ...",
  "code_blocks": [
    {
      "code": "def AddAlignedDimension(start_point, end_point, point_on_dimension_line, style=None):\n    \"\"\"Adds an aligned dimension object to the document. An aligned dimension\n    is a linear dimension lined up with two points\n    Parameters:\n      start_point (point): first point of dimension\n      end_point (point): second point of dimension\n      point_on_dimension_line (point): location point of dimension line\n      style (str, optional): name of dimension style\n    Returns:\n      guid: identifier of new dimension on success\n      None: on error\n    Example:\n      import rhinoscriptsyntax as rs\n      origin = 1, 1, 0\n      offset = 11, 5, 0\n      point = 1, 3, 0\n      rs.AddAlignedDimension( origin, offset, point )\n    See Also:\n      IsAlignedDimension\n    \"\"\"\n    start = rhutil.coerce3dpoint(start_point, True)\n    end = rhutil.coerce3dpoint(end_point, True)\n    onpoint = rhutil.coerce3dpoint(point_on_dimension_line, True)\n>   plane = Rhino.Geometry.Plane(start, end, onpoint)\n>   if not plane.IsValid:\n>     # usually when points passed to ctor are colinear\n>     plane = ViewCPlane()\n    success, s, t = plane.ClosestParameter(start)\n    start = Rhino.Geometry.Point2d(s,t)\n    success, s, t = plane.ClosestParameter(end)\n    end = Rhino.Geometry.Point2d(s,t)\n    success, s, t = plane.ClosestParameter(onpoint)\n    onpoint = Rhino.Geometry.Point2d(s,t)\n    ldim = Rhino.Geometry.LinearDimension(plane, start, end, onpoint)\n    ...etc",
      "language": "python",
      "author": "jeremy5",
      "post_number": 13,
      "is_solution": false
    },
    {
      "code": "#! python3\nimport Rhino\nimport Rhino.UI\nimport scriptcontext as sc\nimport System\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport rhinoscriptsyntax as rs\nfrom System.Drawing import Color\nfrom decimal import Decimal\nimport math\npi = math.pi \n\nimport operator\n\n#surfaces = []\n\n\nJobNum = []\n#Plane = []\nNewLayer = []\nFont = []\n#Tol = []\n#Thk = []\n#maxDist = []\n#VecScale = []\nModScale = []\nNumDp = []\nSpoints = [] \nNames = []\n\nnumber = 1\n\nOrigls = []\n\ncurves = []\n\n#Geo Vectors Points dialog class\nclass GeoAssociateDialog(forms.Dialog[bool]):\n    \n    # Dialog box Class initializer\n    def __init__(self):\n\n        # call base class initializer\n        super().__init__()\n\n        # Initialize dialog box\n        self.Title = \"Geo Label Curve Length\"\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n        \n        \n        # Create Radio Button List Control\n        #self.m_radiobuttonlist = forms.RadioButtonList()\n        #self.m_radiobuttonlist.DataStore = ['No Plane', 'Fit Plane']\n        #self.m_radiobuttonlist.Orientation = forms.Orientation.Horizontal\n        #self.m_radiobuttonlist.SelectedIndex = 0\n        \n        # Create controls for the dialog\n        self.m_label1 = forms.Label()\n        self.m_label1.Text = \"Job Number:\"\n\n\n        self.m_JobNum_textbox = forms.TextBox()\n        self.m_JobNum_textbox.Text = \"SC-000\"\n        #self.m_JobNum_textbox = forms.TextBox(Text = \"\")\n        \n        self.m_label2 = forms.Label()\n        self.m_label2.Text = \"New Layer:\"\n\n        self.m_NewLayer_textbox = forms.TextBox()\n        self.m_NewLayer_textbox.Text = \"Curve Length\"\n        #self.m_NewLayer_textbox = forms.TextBox(Text = \"\")\n        \n        #self.m_label3 = forms.Label()\n        #self.m_label3.Text = \"maxDist mm:\"\n\n        #self.m_maxDist_textbox = forms.TextBox()\n        #self.m_maxDist_textbox.Text = \"\"\n        \n        #self.m_label4 = forms.Label()\n        #self.m_label4.Text = \"Thickness mm:\"\n\n\n        #self.m_Thickness_textbox = forms.TextBox()\n        #self.m_Thickness_textbox.Text = \"\"\n        \n        self.m_label5 = forms.Label()\n        self.m_label5.Text = \"Font Size mm:\"\n\n        self.m_Font_textbox = forms.TextBox()\n        self.m_Font_textbox.Text = \"\"\n        \n        #self.m_label6 = forms.Label()\n        #self.m_label6.Text = \"Vector Scale:\"\n\n        #self.m_VectScale_textbox = forms.TextBox()\n        #self.m_VectScale_textbox.Text = \"3\"\n        \n        #self.m_label7 = forms.Label()\n        #self.m_label7.Text = \"Tol mm:\"\n\n\n        #self.m_Tol_textbox = forms.TextBox()\n        #self.m_Tol_textbox.Text = \"8\"        \n        \n        self.m_label8 = forms.Label()\n        self.m_label8.Text = \"Model Space Scale:\"\n\n        self.m_ModScale_textbox = forms.TextBox()\n        self.m_ModScale_textbox.Text = \"15\"       \n        \n        \n        self.m_NumDp_combobox = forms.ComboBox()\n        self.m_NumDp_combobox.DataStore = ['NumDP0', 'NumDP1', 'NumDP2']\n        self.m_NumDp_combobox.SelectedIndex = 0\n        \n        self.m_label = forms.Label()\n        self.m_label.Text = \"Decimal Places:\"\n        \n        # Create the default button\n        self.DefaultButton = forms.Button()\n        self.DefaultButton.Text = 'OK'\n\n        self.DefaultButton.Click += self.OnOKButtonClick\n        \n        # Create the abort button\n        self.AbortButton = forms.Button()\n        self.AbortButton.Text = 'Cancel'\n        \n        self.AbortButton.Click += self.OnCloseButtonClick\n        \n        \n        # Create a table layout and add all the controls\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(5, 5)\n        \n        #layout.AddRow(self.m_JobNum_textbox)\n        \n        #layout.AddRow(self.m_label, self.m_radiobuttonlist)\n        \n        #layout.AddRow(self.m_label, self.m_Layers_listbox)\n        #layout.AddRow(self.m_JobNum_textbox)\n        layout.AddRow(self.m_label1, self.m_JobNum_textbox)\n        #layout.AddRow(self.m_NewLayer_textbox)\n        layout.AddRow(self.m_label2, self.m_NewLayer_textbox)\n        \n        #layout.AddRow(self.m_label3, self.m_maxDist_textbox)\n        \n        #layout.AddRow(self.m_label4, self.m_Thickness_textbox)\n        \n        layout.AddRow(self.m_label5, self.m_Font_textbox)\n        \n        #layout.AddRow(self.m_label6, self.m_VectScale_textbox)\n        \n        #layout.AddRow(self.m_label7, self.m_Tol_textbox)\n        \n        layout.AddRow(self.m_label8, self.m_ModScale_textbox)\n        \n        layout.AddRow(self.m_label, self.m_NumDp_combobox)\n        \n        layout.AddRow(None) # spacer\n        \n        layout.AddRow(self.DefaultButton, self.AbortButton)\n        \n        # Set the dialog content\n        self.Content = layout\n        self.Load += self.OnFormLoad\n        self.Closing += self.OnFormClosing\n        \n\n    \n    # Start of the class functions\n    \n    # Get the value of the textbox\n    \n    #def GetText20(self):\n        #return self.m_Layers_listtbox.SelectedIndex\n    \n    def GetText1(self):\n        return self.m_JobNum_textbox.Text\n        \n    def GetPlane(self):\n        return self.self.m_radiobuttonlist.SelectedIndex\n        \n        \n    def GetText2(self):\n        return self.m_NewLayer_textbox.Text\n        \n    def GetText3(self):\n        return self.m_maxDist_textbox.Text\n        \n    def GetText4(self):\n        return self.m_Thickness_textbox.Text\n        \n    def GetText5(self):\n        return self.m_Font_textbox.Text\n        \n    def GetText6(self):\n        return self.m_VectScale_textbox.Text\n        \n    def GetText7(self):\n        return self.m_Tol_textbox.Text\n\n    def GetText8(self):\n        return self.m_ModScale_textbox.Text\n\n        \n    # Get/set the value of the combobox\n    def GetNumDp(self):\n        return self.m_NumDp_combobox.SelectedIndex\n    #def SetNumDp(self, index):\n      #self.m_NumDp_combobox.SelectedIndex = Rhino.RhinoMath.Clamp(index, 0, 2)\n    \n    # Close button click handler\n    def OnCloseButtonClick(self, sender, e):\n        self.Close(False)\n    \n    # OK button click handler\n    def OnOKButtonClick(self, sender, e):\n        self.Close(True)\n        \n        \n        \n        \n    def OnFormLoad(self, sender, e):\n        # set previous or default text for \"Job Number\"\n        if sc.sticky.has_key(\"Job Number\"):\n            # set last used text if found in sticky\n            self.m_JobNum_textbox.Text = sc.sticky[\"Job Number\"]\n        else:\n            # set default text if not not found in sticky\n            self.m_JobNum_textbox.Text = \"SC-000\"\n            \n        #if sc.sticky.has_key(\"Plane\"):\n            #self.m_radiobuttonlist.SelectedIndex = sc.sticky[\"Plane\"]\n        #else:\n            #self.m_radiobuttonlist.SelectedIndex = 0\n            \n        if sc.sticky.has_key(\"New Layer\"):\n            # set last used text if found in sticky\n            self.m_NewLayer_textbox.Text = sc.sticky[\"New Layer\"]\n        else:\n            # set default text if not not found in sticky\n            self.m_NewLayer_textbox.Text = \"Curve Length\"\n            \n        #if sc.sticky.has_key(\"maxDist\"):\n            # set last used text if found in sticky\n            #self.m_maxDist_textbox.Text = sc.sticky[\"maxDist\"]\n        #else:\n            # set default text if not not found in sticky\n            #self.m_maxDist_textbox.Text = \"50\"\n            \n        #if sc.sticky.has_key(\"Thickness\"):\n            # set last used text if found in sticky\n            #self.m_Thickness_textbox.Text = sc.sticky[\"Thickness\"]\n        #else:\n            # set default text if not not found in sticky\n            #self.m_Thickness_textbox.Text = \"0\"\n            \n        if sc.sticky.has_key(\"Font Size\"):\n            # set last used text if found in sticky\n            self.m_Font_textbox.Text = sc.sticky[\"Font Size\"]\n        else:\n            # set default text if not not found in sticky\n            self.m_Font_textbox.Text = \"100\"\n            \n        #if sc.sticky.has_key(\"Vect Scale\"):\n            # set last used text if found in sticky\n            #self.m_VectScale_textbox.Text = sc.sticky[\"Vect Scale\"]\n        #else:\n            # set default text if not not found in sticky\n            #self.m_VectScale_textbox.Text = \"3\"\n            \n        #if sc.sticky.has_key(\"Tol\"):\n            # set last used text if found in sticky\n            #self.m_Tol_textbox.Text = sc.sticky[\"Tol\"]\n        #else:\n            # set default text if not not found in sticky\n            #self.m_Tol_textbox.Text = \"8\"\n       \n        if sc.sticky.has_key(\"Model Space Scale\"):\n            # set last used text if found in sticky\n            self.m_ModScale_textbox.Text = sc.sticky[\"Model Space Scale\"]\n        else:\n            # set default text if not not found in sticky\n            self.m_ModScale_textbox.Text = \"1\"\n            \n            \n    \n    def OnFormClosing(self, sender, e):\n        # store the text from the text box in sticky (it can be empty)\n        sc.sticky[\"Job Number\"] = self.m_JobNum_textbox.Text\n        \n        #sc.sticky[\"Plane\"] = self.m_radiobuttonlist.SelectedIndex\n        # store the text from the text box in sticky (it can be empty)\n        \n        sc.sticky[\"New Layer\"] = self.m_NewLayer_textbox.Text\n        \n        # store the text from the text box in sticky (it can be empty)\n        #sc.sticky[\"maxDist\"] = self.m_maxDist_textbox.Text\n        \n        # store the text from the text box in sticky (it can be empty)\n        #sc.sticky[\"Thickness\"] = self.m_Thickness_textbox.Text\n        \n        # store the text from the text box in sticky (it can be empty)\n        sc.sticky[\"Font Size\"] = self.m_Font_textbox.Text\n        \n        # store the text from the text box in sticky (it can be empty)\n        #sc.sticky[\"Vect Scale\"] = self.m_VectScale_textbox.Text\n        \n        # store the text from the text box in sticky (it can be empty)\n        #sc.sticky[\"Tol\"] = self.m_Tol_textbox.Text\n        \n       # store the text from the text box in sticky (it can be empty)\n        sc.sticky[\"Model Space Scale\"] = self.m_ModScale_textbox.Text\n        \n        \ndef RadialDimensions():\n    \n    # Utility function to show the dialog box\n    # The script that will be using the dialog.\n    dialog = GeoAssociateDialog();\n    \n    #Open the dialogue\n\n    rc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n    if not rc: return\n    \n    #Plane = str(dialog.m_radiobuttonlist.SelectedIndex)\n    #print (\"Plane Fit\", Plane)\n    \n    JobNum = str(dialog.m_JobNum_textbox.Text)\n    print (\"JobNum\", JobNum)\n    \n    NewLayer = str(dialog.m_NewLayer_textbox.Text)\n    print (\"NewLayer\", NewLayer)\n    \n    #maxDist = str(dialog.m_maxDist_textbox.Text)\n    #print (\"maxDist\", maxDist)\n    \n    #Thk = str(dialog.m_Thickness_textbox.Text)\n    #print (\"Thickness\", Thk)\n    \n    Font = int(dialog.m_Font_textbox.Text)\n    print (\"Font\", Font)\n    \n    #VecScale = str(dialog.m_VectScale_textbox.Text)\n    #print (\"VecScale\", VecScale)\n    \n    #Tol = str(dialog.m_Tol_textbox.Text)\n    #print (\"Tolerance to Design\", Tol)\n    \n    ModScale = int(dialog.m_ModScale_textbox.Text)\n    print (\"Model Space Scale\", ModScale)\n    \n    NumDp = int(dialog.m_NumDp_combobox.SelectedIndex)\n    print (\"Number of Decimal Places\", NumDp)\n        \n    \n    #surfaces = []\n    \n    rs.AddLayer(str(JobNum))\n    rs.AddLayer(str(NewLayer),Color.Yellow, parent = str(JobNum))\n    rs.CurrentLayer(str(NewLayer))\n\n    \n    #objs = rs.GetObjects(\"Pick some curves\", rs.filter.curve)\n\n    rs.CurrentDimStyle(\"Default\")\n    rs.DimStyleScale(\"Default\", ModScale)\n    #rs.ObjectLayer(obj, NewLayer)\n    \n    if NumDp == 0:\n        #rs.CurrentDimStyle(\"Dp0\")\n        #rs.DimStyleScale(\"Dp0\", modscale)\n        rs.DimStyleLinearPrecision(\"Default\", 0)\n        #precision = 3\n        #rs.UnitDistanceDisplayPrecision( 0 )\n\n        \n        \n    elif NumDp == 1:\n        \n        #rs.CurrentDimStyle(\"Dp1\")\n        #rs.DimStyleScale(\"Dp1\", modscale)\n        rs.DimStyleLinearPrecision(\"Default\", 1)\n        #precision = 3\n        #rs.UnitDistanceDisplayPrecision( 1 )\n        \n                        \n    elif NumDp == 2:\n        \n        #rs.CurrentDimStyle(\"Dp2\")\n        #rs.DimStyleScale(\"Dp2\", modscale)\n        rs.DimStyleLinearPrecision(\"Default\", 2)\n        #precision = 3\n        #rs.UnitDistanceDisplayPrecision( 2 )\n\n\n    #print(\"Object identifier: {}\".format(objectId))\n\n    cpId = rs.GetObject(\"Pick the centre point\", rs.filter.point)\n    cpIdc = rs.PointCoordinates(cpId)\n    if not cpIdc:\n        return\n        \n        #print(cpIdc)\n\n    rdIds = rs.GetObjects(\"Pick the radial points\", rs.filter.point)\n    #rdIds = rs.GetPointCoordinates(\"Pick the radial points\")\n    if not rdIds:\n        return\n        print(rdIds)\n\n\n    rs.CurrentView(\"Top\")\n\n\n    if rdIds:\n        for rdId in rdIds:\n\n            rdIdc = rs.PointCoordinates(rdId)\n\n            mid = rs.PointAdd(rdIdc, cpIdc)/2\n\n            rs.AddPoint(mid)\n             \n            aDim = rs.AddAlignedDimension( cpIdc, rdIdc, mid, \"Default\" )\n\n            #point = rs.CurveMidPoint(obj)\n\n\n\n    print (\"End of Radial Dimensions\")\n# Check to see if this file is being executed as the \"main\" python\n# script instead of being used as a module by some other python script\n# This allows us to use the module which ever way we want.\nif __name__ == \"__main__\":\n\n    rc = RadialDimensions()",
      "language": "python",
      "author": "RogerD",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "layers",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "selection",
    "transformation",
    "ui"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 15,
  "views": 289
}