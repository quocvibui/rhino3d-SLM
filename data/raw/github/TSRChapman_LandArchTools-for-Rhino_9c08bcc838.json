{
  "source_url": "https://github.com/TSRChapman/LandArchTools-for-Rhino/blob/43036cbbcab2bf756216f6a752f65e83aac3fccb/ImportNearMaps.py",
  "repo": "TSRChapman/LandArchTools-for-Rhino",
  "repo_stars": 5,
  "repo_description": "Custom Tools for Rhino made for Landscape Architects",
  "license": "BSD-3-Clause",
  "filepath": "ImportNearMaps.py",
  "instruction": "Copyright <2021> <Thomas Chapman>",
  "code": "\n\n'''\nCopyright <2021> <Thomas Chapman>\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE\nWARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\nOTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'''\n\n\nimport struct\nimport imghdr\nimport rhinoscriptsyntax as rs\n\n\ndef ImportNearMaps():\n    try:\n\n        def scale():\n            system = rs.UnitSystem()\n            if system == 2 or system == 3 or system == 4:\n                scaleFactorDict = {2: 1000, 3: 100, 4: 1}\n                scaleFactor = scaleFactorDict[system]\n                return scaleFactor\n\n            if system != 2 or system != 3 or system != 4:\n                return None\n\n        def get_image_size(fname):\n            '''Determine the image type of fhandle and return its size.\n            from draco'''\n            with open(fname, 'rb') as fhandle:\n                head = fhandle.read(24)\n                if len(head) != 24:\n                    return\n                if imghdr.what(fname) == 'png':\n                    check = struct.unpack('>i', head[4:8])[0]\n                    if check != 0x0d0a1a0a:\n                        return\n                    width, height = struct.unpack('>ii', head[16:24])\n                elif imghdr.what(fname) == 'gif':\n                    width, height = struct.unpack('<HH', head[6:10])\n                elif imghdr.what(fname) == 'jpeg':\n                    try:\n                        fhandle.seek(0)  # Read 0xff next\n                        size = 2\n                        ftype = 0\n                        while not 0xc0 <= ftype <= 0xcf:\n                            fhandle.seek(size, 1)\n                            byte = fhandle.read(1)\n                            while ord(byte) == 0xff:\n                                byte = fhandle.read(1)\n                            ftype = ord(byte)\n                            size = struct.unpack('>H', fhandle.read(2))[0] - 2\n                        # We are at a SOFn block\n                        fhandle.seek(1, 1)  # Skip `precision' byte.\n                        height, width = struct.unpack('>HH', fhandle.read(4))\n                    except Exception:  # IGNORE:W0703\n                        return\n                else:\n                    return\n                return width, height\n\n        if scale() == None:\n            rs.MessageBox(\n                \"This tool is can only be used in mm, cm or m model units\")\n            return None\n\n        factor = scale()\n\n        # Find and open jgw file, extract scalefactor and x and y coordinates\n\n        jgw = rs.OpenFileName(title='Select .JGW file',\n                              filter=\"JGW Files (*.JGW)|*.JGW||\")\n\n        with open(jgw, 'rt') as f:\n            numslist = f.read().splitlines()\n\n        scaleFactor01 = numslist[0]\n\n        worldx = float(numslist[4])*int(factor)\n        worldy = float(numslist[5])*int(factor)\n\n        # Find and open jpg file, extract pixel size\n\n        jpg = rs.OpenFileName(title='Select .JPG image File',\n                              filter=\"JPG Files (*.JPG)|*.JPG||\")\n\n        size = get_image_size(jpg)\n\n        scaleFactor02 = (float(size[0])*int(factor))\n        scaleFactor03 = (float(size[1])*int(factor))\n\n        # Calculate scale factor\n\n        scaleFactorWidth = (float(scaleFactor01))*(float(scaleFactor02))\n        scaleFactorHeight = (float(scaleFactor01))*(float(scaleFactor03))\n\n        origin = (float(worldx), (float(worldy) - float(scaleFactorHeight)), 0)\n\n        picturePlane = rs.PlaneFromFrame(origin, (1, 0, 0), (0, 1, 0))\n\n        rs.AddPictureFrame(picturePlane, jpg, width=(\n            float(scaleFactorWidth)), height=(float(scaleFactorHeight)))\n\n    except:\n        print(\"Failed to execute\")\n        rs.EnableRedraw(True)\n        return\n\n\nif __name__ == \"__main__\":\n    ImportNearMaps()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}