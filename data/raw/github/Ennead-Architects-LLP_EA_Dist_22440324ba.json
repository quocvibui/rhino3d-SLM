{
  "source_url": "https://github.com/Ennead-Architects-LLP/EA_Dist/blob/635520d89b8308b78eabf5b60bb80121d0fa3838/Apps/_rhino/Revit.tab/map_revit_subc_material.button/map_revit_subc_material_left.py",
  "repo": "Ennead-Architects-LLP/EA_Dist",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "Apps/_rhino/Revit.tab/map_revit_subc_material.button/map_revit_subc_material_left.py",
  "instruction": "Map revit subc material left",
  "code": "\r\n__title__ = \"MapRevitSubCategoryMaterial\"\r\n__doc__ = \"Work with ExportSubCategoryMaterialTable on revit side. After you export the OST mapping there, this button help you create and map layer material based on layer name, if found in the OST mapping\"\r\nimport rhinoscriptsyntax as rs\r\nimport scriptcontext as sc\r\n\r\nfrom EnneadTab import NOTIFICATION, DATA_FILE, ENVIRONMENT\r\nfrom EnneadTab import LOG, ERROR_HANDLE\r\nfrom EnneadTab.RHINO import RHINO_MATERIAL\r\n\r\ndef get_layer_with_keyword(keyword):\r\n\r\n    for layer in rs.LayerNames():\r\n        if keyword in layer:\r\n            return layer\r\n    return None\r\n\r\n\r\n\r\n@LOG.log(__file__, __title__)\r\n@ERROR_HANDLE.try_catch_error()\r\ndef map_revit_subc_material():\r\n    rs.EnableRedraw(False)\r\n    data = DATA_FILE.get_data(\"SUBC_MATERIAL_TABLE\")\r\n    print(data)\r\n    if not data:\r\n        NOTIFICATION.messenger(\"There are no material data exported from Revit. \\nUse the \\\")Export SubCategory Material Table\\\" button in \\nEnneadTab for Revit to export the data first\",\r\n                                         image = ENVIRONMENT.get_EnneadTab_For_Rhino_root()+ \"\\\\Source Codes\\\\Revit\\\\map_revit_subC_material_LG.png\",\r\n                                         animation_stay_duration = 7)\r\n        return\r\n    \r\n    for subC_keyword, material_data in data.items():\r\n        print (subC_keyword)\r\n        # print material_data\r\n        layer = get_layer_with_keyword(subC_keyword)\r\n        if not layer:\r\n            continue\r\n        \r\n        current_material_index = rs.LayerMaterialIndex(layer)\r\n        current_material_name = rs.MaterialName(current_material_index)\r\n        if current_material_name == material_data[\"shading\"][\"name\"]:\r\n            print (\"Same name material already applied to this layer <{}>\".format(layer))\r\n            continue\r\n        \r\n\r\n        desired_material_index = sc.doc.Materials.Find(materialName = material_data[\"shading\"][\"name\"],\r\n                                                       ignoreDeletedMaterials = True)\r\n        if desired_material_index != -1:\r\n            print (\"Desired material index: {}\".format(desired_material_index))\r\n            rs.LayerMaterialIndex(layer, desired_material_index)\r\n            continue\r\n        \r\n        \r\n        print (\"########## Desired material not found in the document, will try to add it\")\r\n        \r\n        RGBAR = (material_data[\"shading\"][\"color\"][\"red\"],\r\n                 material_data[\"shading\"][\"color\"][\"green\"],\r\n                 material_data[\"shading\"][\"color\"][\"blue\"],\r\n                 material_data[\"shading\"][\"transparency\"],\r\n                 material_data[\"shading\"][\"glossy\"])\r\n        desired_material_index, sample_sphere = RHINO_MATERIAL.create_material(name = material_data[\"shading\"][\"name\"], \r\n                                                                                                RGBAR = RGBAR, \r\n                                                                                                return_index = True)\r\n        # rs.DeleteObject(sample_sphere)\r\n            \r\n        \r\n        \r\nif __name__ == \"__main__\":\r\n    map_revit_subc_material()",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}