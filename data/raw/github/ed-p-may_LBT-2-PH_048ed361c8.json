{
  "source_url": "https://github.com/ed-p-may/LBT-2-PH/blob/3c2bbdf0cb26deb92d36b870aeb920cbc31d8da2/scripts/LBT2PH/assemblies.py",
  "repo": "ed-p-may/LBT-2-PH",
  "repo_stars": 12,
  "repo_description": "LBT2PH is a free toolkit for creating PHPP energy models from Ladybug Tools v1.0+ definitions.",
  "license": "GPL-3.0",
  "filepath": "scripts/LBT2PH/assemblies.py",
  "instruction": "Assemblies",
  "code": "import helpers\nimport json\nimport rhinoscriptsyntax as rs\nimport Grasshopper.Kernel as ghK\nimport scriptcontext as sc\nfrom collections import namedtuple\n\ntry:  # import the honeybee dependencies\n    from honeybee.typing import clean_and_id_ep_string\n    from honeybee_energy.material.opaque import EnergyMaterial\n    from honeybee_energy.material.opaque import EnergyMaterialNoMass\n    from honeybee_energy.construction.opaque import OpaqueConstruction\n#    from honeybee_energy.lib.materials import opaque_material_by_identifier\nexcept ImportError as e:\n    raise ImportError('\\nFailed to import honeybee_energy:\\n\\t{}'.format(e))\n\nclass PHPP_Construction:\n    Layer = namedtuple('Layer', ['layer_number', 'layer_name'])\n    \n    def __init__(self, _hb_const):\n        self.hb_const = _hb_const\n\n    @property\n    def u_value(self):\n        return self.hb_const.u_value\n\n    @property\n    def hb_display_name(self):\n        return self.hb_const.display_name\n\n    @property\n    def identifier(self):\n        return self.hb_const.identifier\n\n    @property\n    def IntInsul(self):\n        if '__Int__' in self.hb_const.identifier:\n            return 'x'\n        else:\n            return None\n\n    @property\n    def phpp_name(self):\n        nm = self.hb_const.display_name\n        nm = nm.replace('__Int__', '')\n        nm = nm.replace('PHPP_CONST_', '')\n        nm = nm.replace(' ', '_')\n\n        return nm\n\n    @property\n    def Layers(self):\n        layers = []\n        for i, layer in enumerate(self.hb_const.layers):\n            mat = self.hb_const.materials[i]\n            layers.append( self.Layer(i, mat.display_name )  )\n\n        return layers\n    \n    def __unicode__(self):\n        return u'A PHPP-Style Construction Object: < {} >'.format(self.phpp_name)\n    def __str__(self):\n        return unicode(self).encode('utf-8')\n    def __repr__(self):\n       return \"{}(_hb_const={!r})\".format(self.__class__.__name__, self.hb_const)\n\ndef get_constructions_from_rh(_ghdoc):\n    ''' Returns a dict with all the assemblies found in the Rhino UserText'''\n    \n    constructions_ = {}\n    \n    with helpers.context_rh_doc(_ghdoc):\n        if not rs.IsDocumentUserText():\n            return constructions_\n        \n        for key in rs.GetDocumentUserText():\n            if 'PHPP_lib_Assmbly_' in key:\n                value_as_str = rs.GetDocumentUserText(key)\n                value_as_dict = json.loads(value_as_str)\n                assembly_name = value_as_dict.get('Name')\n                constructions_[assembly_name] = value_as_dict\n        \n        return constructions_\n\ndef generate_all_HB_constructions(_rh_doc_constructions, _ghenv):\n    ''' Returns a list of HB Construction Objects. One for each Construction found in the Rhino UserText '''\n    \n    assert type(_rh_doc_constructions) is dict, '\"create_HB_construction\" input should be type: dict'\n    \n    constructions = {}\n    for nm, construction in _rh_doc_constructions.items():\n        #---------------------------------------------------------------------------------------------------\n        # Get the construction parameters\n        try:\n            nm = construction.get('Name', 'NO_NAME').upper()\n            uval = float(construction.get('uValue', 1.0))\n            rval = float(1/uval)\n        \n            #---- Try and sort out the IntInsul flag\n            try:\n                intInsul = bool(float(construction.get('intInsulation', None)))\n                if intInsul:\n                    intInsul = 1\n                else:\n                    intInsul = 0\n            except Exception as e:\n                msg = 'Something went wrong reading the \"IntInsualtion\" flag? What the heck?'\\\n                    'Check the type of the \"IntInsul\" flag coming from Rhino? Should be a string'\\\n                    'either \"0.0\" or \"1.0\"?'\n                raise Exception(msg)\n\n        except Exception as e:\n            print(e)\n            nm = construction.get('Name', 'NO_NAME').upper()\n            uval = 1.0\n            rval = 1.0\n            intInsul = 0\n            warning = 'Something went wrong getting the Construction Assembly info for the Assembly type: \"{}\" from the Rhino Library?\\n'\\\n            'No assembly by that name, or a non-numeric entry found in the Library? Please check the Library File inputs.\\n'\\\n            'For now, I will assign a U-Value of 1.0 W/m2k to this assembly as a default value.'.format(nm.upper())\n            _ghenv.Component.AddRuntimeMessage(ghK.GH_RuntimeMessageLevel.Warning, warning)\n\n        #---------------------------------------------------------------------------------------------------\n        # Clean up the names\n        name_construction = \"PHPP_CONST_{}\".format(nm).upper().replace(\" \", \"_\")\n        name_material = \"PHPP_MAT_{}\".format(nm).upper().replace(\" \", \"_\")\n\n        #---------------------------------------------------------------------------------------------------\n        # Add the tag to the name if Interior Insulated\n        intInsulFlag = '__Int__'\n        if intInsul == 1:\n            name_construction = name_construction + intInsulFlag\n            name_material = name_material + intInsulFlag\n        \n        #---------------------------------------------------------------------------------------------------\n        # Build the Materials\n        # So that we don't end up with lots of MassLayers, check if there is already one in the Sticky first\n        if 'LBT2PH_std_mass_material' in sc.sticky:\n            hb_mass_layer = sc.sticky.get('LBT2PH_std_mass_material')\n        else:\n            hb_mass_layer = create_std_mass_material()\n            sc.sticky['LBT2PH_std_mass_material'] = hb_mass_layer\n        hb_no_mass_materal = create_HB_material_no_mass(name_material, rval)\n\n        #---------------------------------------------------------------------------------------------------\n        # Build the Construction\n        construction_layers = [hb_mass_layer, hb_no_mass_materal, hb_mass_layer]\n        new_EP_Construction = create_HB_construction(name_construction, construction_layers)\n        k = name_construction.replace(intInsulFlag, '') # Scrub the flag for the dict only\n        constructions[k] = new_EP_Construction\n\n    return constructions\n\ndef create_std_mass_material():\n    ''' Simple 'Mass' Layer for inside/outside of simple constuctions '''\n\n    try:\n        # Set the default material properties\n        roughness = 'MediumRough'\n        therm_absp = 0.9\n        sol_absp = 0.7\n        vis_absp = 0.7\n        name = 'MASSLAYER'\n        thickness = 0.0254\n        conductivity = 2\n        density = 2500\n        spec_heat = 460\n        \n        # Create the material\n        mat = EnergyMaterial(\n            clean_and_id_ep_string(name), thickness, conductivity, density,\n            spec_heat, roughness, therm_absp, sol_absp, vis_absp)\n        mat.display_name = name\n        \n        return mat\n    except Exception as e:\n        print('Error creating HB Material', e)\n        return None\n\ndef create_HB_material_no_mass(_material_name, _material_r_value):   \n    \"\"\" Creates an HB Style \"No-Mass\" Material \"\"\"\n\n    try:\n        # set the default material properties\n        name = _material_name\n        r_value = _material_r_value\n        roughness = 'MediumRough'\n        therm_absp = 0.9\n        sol_absp = 0.7\n        vis_absp = 0.7\n        \n        # create the NoMass material\n        mat = EnergyMaterialNoMass(\n            clean_and_id_ep_string(name), r_value, roughness, therm_absp,\n            sol_absp, vis_absp)\n        mat.display_name = name\n\n        return mat\n    except Exception as e:\n        print('Error creating HB Material', e)\n        return None\n\ndef create_HB_construction(_name, _layers):\n    ''' Builds a HB Style Construction Object from a list of HB-Material layers'''\n\n    try:       \n        constr = OpaqueConstruction(clean_and_id_ep_string(_name), _layers)\n        constr.display_name = _name\n        return constr\n    except Exception as e:\n        print('Error creating Construction', e)\n        return None",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}