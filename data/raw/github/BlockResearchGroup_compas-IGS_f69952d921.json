{
  "source_url": "https://github.com/BlockResearchGroup/compas-IGS/blob/be44e0ba12ce1156015b02b0ab9dd61c8006fc85/commands/IGS_force_from_form.py",
  "repo": "BlockResearchGroup/compas-IGS",
  "repo_stars": 1,
  "repo_description": "Rhino plugin for Interactive Graphic Statics using an algebraic graph-based approach to graphic statics",
  "license": "MIT",
  "filepath": "commands/IGS_force_from_form.py",
  "instruction": "venv: brg-csd r: compas_session>=0.4.5, compas_ags>=1.3.2",
  "code": "#! python3\n# venv: brg-csd\n# r: compas_session>=0.4.5, compas_ags>=1.3.2\n\nimport rhinoscriptsyntax as rs  # type: ignore  # noqa: F401\n\nfrom compas_ags.ags import force_update_from_form\nfrom compas_ags.ags import form_count_dof\nfrom compas_ags.ags import form_update_q_from_qind\nfrom compas_ags.diagrams import ForceDiagram\nfrom compas_igs.scene import RhinoForceObject\nfrom compas_igs.session import IGSSession\nfrom compas_igs.utilities import compute_force_drawinglocation\nfrom compas_igs.utilities import compute_force_drawingscale\nfrom compas_igs.utilities import compute_form_forcescale\n\n# =============================================================================\n# Command\n# =============================================================================\n\n\ndef RunCommand():\n    session = IGSSession()\n\n    form = session.find_formdiagram(warn=True)\n    if not form:\n        return\n\n    force = session.find_forcediagram(warn=False)\n    if force:\n        force.clear()\n        session.scene.remove(force)\n\n    # =============================================================================\n    # <COMMAND>\n    # =============================================================================\n\n    edges = list(form.diagram.edges_where(is_ind=True))\n\n    if not len(edges):\n        return session.warn(\n            message=\"\"\"You have not yet assigned force values to the form diagram.\n            Please assign forces first.\"\"\"\n        )\n\n    k, m = form_count_dof(form.diagram)\n\n    if k != len(edges):\n        return session.warn(\n            message=\"\"\"You have not assigned the correct number of force values.\n            Please, check the degrees of freedom of the form diagram and update the assigned forces accordingly.\"\"\"\n        )\n\n    formdiagram = form.diagram\n    forcediagram = ForceDiagram.from_formdiagram(formdiagram)\n\n    form_update_q_from_qind(formdiagram)\n    force_update_from_form(forcediagram, formdiagram)\n\n    # =============================================================================\n    # Update scene\n    # =============================================================================\n\n    rs.UnselectAllObjects()\n\n    force: RhinoForceObject = session.scene.add(forcediagram)\n\n    force.scale = compute_force_drawingscale(form, force)  # scale factor for the diagram\n    force.location = compute_force_drawinglocation(form, force)  # translation of the diagram\n\n    session.settings.form.scale_internal_force_pipes = compute_form_forcescale(form)  # thickness\n    session.settings.form.show_external_force_labels = True\n\n    session.set(\"equilibrium\", True)\n\n    session.scene.redraw()\n\n    if session.settings.autosave:\n        session.record(name=\"Force From Form\")\n\n\n# =============================================================================\n# Main\n# =============================================================================\n\nif __name__ == \"__main__\":\n    RunCommand()\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}