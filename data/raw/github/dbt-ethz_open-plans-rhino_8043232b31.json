{
  "source_url": "https://github.com/dbt-ethz/open-plans-rhino/blob/6cbb4f56d948dbd3b00c301323963bcbe61642d5/src/rhino/dev/OPCreateProject_cmd.py",
  "repo": "dbt-ethz/open-plans-rhino",
  "repo_stars": 0,
  "repo_description": "Rhino3D plugin to interact with open plans",
  "license": "unknown",
  "filepath": "src/rhino/dev/OPCreateProject_cmd.py",
  "instruction": "Opcreate project cmd",
  "code": "from __future__ import print_function\nfrom __future__ import absolute_import\nfrom __future__ import division\n\nimport rhinoscriptsyntax as rs\nimport Rhino\nimport scriptcontext\nimport System\nimport Rhino.UI\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport json\n\nimport rhino.rhino_helpers as rhh\nimport datamodels\nimport api\n\n__commandname__ = \"OPCreateProject\"\n\n\nclass CreateProject(forms.Dialog[bool]):\n\n    def __init__(self):\n        # Initialize dialog box\n        self.Title = 'OPEN PLANS: Create New Project'\n        self.Padding = drawing.Padding(10)\n        self.Resizable = False\n\n        # create attributes Name\n        self.m_label_name = forms.Label(Text='Project Name')\n        self.m_textbox_name = forms.TextBox(Text=None)\n\n        # create attributes Tags\n        self.m_label_tags = forms.Label(Text='Project Tags')\n        self.m_textbox_tags = forms.TextBox(Text=None)\n        self.m_textbox_tags.PlaceholderText = 'Tag1, Tag2'\n\n        # create attributes architects\n        self.m_label_architect = forms.Label(\n            Text='Architect(s)')\n        self.m_textbox_architect = forms.TextBox()\n        self.m_textbox_architect.PlaceholderText = 'Architect1, Architect2'\n\n        # create attributes civil engineer\n        self.m_label_ceng = forms.Label(Text='Civil Engineer')\n        self.m_textbox_ceng = forms.TextBox(Text=None)\n\n        # create attributes client\n        self.m_label_client = forms.Label(Text='Client')\n        self.m_textbox_client = forms.TextBox(Text=None)\n\n        # create attributes year of completion\n        self.m_label_yoc = forms.Label(Text='Year of Completion')\n        self.m_numeric_yoc = forms.TextBox()\n        self.m_numeric_yoc.MaxLength = 4\n        self.m_numeric_yoc.PlaceholderText = '1990'\n\n        # create description multiline textbox\n        self.m_label_richtext = forms.Label(Text='Project description')\n        self.m_richtextarea = forms.RichTextArea()\n        self.m_richtextarea.Size = drawing.Size(210, 100)\n\n        # create attributes source\n        self.m_label_source = forms.Label(Text='Source information')\n        self.m_textbox_source = forms.TextBox(Text=None)\n\n        # geolocation\n        self.m_label_lat = forms.Label(Text='Latitude')\n        self.m_textbox_lat = forms.TextBox(Text=None)\n        self.m_textbox_lat.PlaceholderText = '47.4088180795008'\n\n        self.m_label_long = forms.Label(Text='Longitude')\n        self.m_textbox_long = forms.TextBox(Text=None)\n        self.m_textbox_long.PlaceholderText = '8.505813237051635'\n\n        # select file location\n        self.m_label_file = forms.Label(Text='Save File Path')\n        self.m_textbox_file = forms.TextBox(Text=None)\n\n        # Create the browse button\n        self.BrowseButton = forms.Button(Text='Browse...')\n        self.BrowseButton.Click += self.on_browse_button_click\n\n        # Create the default button\n        self.DefaultButton = forms.Button(Text='Create')\n        self.DefaultButton.Click += self.on_OK_button_click\n\n        # Create the abort button\n        self.AbortButton = forms.Button(Text='Cancel')\n        self.AbortButton.Click += self.on_close_button_click\n\n        # Create a table layout and add all the controls\n        layout = forms.DynamicLayout()\n        layout.Spacing = drawing.Size(5, 5)\n\n        layout.BeginVertical()\n        layout.AddRow(self.m_label_name, self.m_textbox_name)\n        layout.AddRow(self.m_label_tags, self.m_textbox_tags)\n        layout.AddRow(self.m_label_architect, self.m_textbox_architect)\n        layout.AddRow(self.m_label_ceng, self.m_textbox_ceng)\n        layout.AddRow(self.m_label_client, self.m_textbox_client)\n        layout.AddRow(self.m_label_source, self.m_textbox_source)\n        layout.AddRow(self.m_label_yoc, self.m_numeric_yoc)\n        layout.AddRow(self.m_label_richtext, self.m_richtextarea)\n        layout.AddRow(self.m_label_lat, self.m_textbox_lat)\n        layout.AddRow(self.m_label_long, self.m_textbox_long)\n        layout.AddRow(self.m_label_file,\n                    self.m_textbox_file, self.BrowseButton)\n        layout.EndVertical()\n\n        layout.AddSeparateRow(self.DefaultButton)\n        layout.AddSeparateRow(self.AbortButton)\n\n        self.Content = layout\n\n    # Get the value of the textbox\n    def get_text(self):\n        return {\n            'name': self.m_textbox_name.Text,\n            'tags': self.m_textbox_tags.Text.replace(' ','').split(','),\n            #'architects': self.m_textbox_architect.Text.split(','),\n            'architects': self.m_textbox_architect.Text,\n            'civil_engineers': self.m_textbox_ceng.Text,\n            'clients': self.m_textbox_client.Text,\n            'year_of_completion': int(self.m_numeric_yoc.Text) if self.m_numeric_yoc.Text else None,\n            'source': self.m_textbox_source.Text,\n            'description': self.m_richtextarea.Text,\n            'longitude': self.m_textbox_long.Text, \n            'latitude': self.m_textbox_lat.Text\n        }\n\n    def get_file_location(self):\n        return self.m_textbox_file.Text\n\n    # Close button click handler\n\n    def on_close_button_click(self, sender, e):\n        self.Close(False)\n\n    # OK button click handler\n    def on_OK_button_click(self, sender, e):\n        if self.m_textbox_name.Text == \"\":\n            raise Exception(\"Failed to create project: Name is required\")\n        else:\n            self.Close(True)\n\n    def on_browse_button_click(self, sender, e):\n        filename = rs.OpenFileName(\"Open\", \"JSON Files (*.json)|*.json||\")\n        if filename:\n            self.m_textbox_file.Text = filename\n\n\ndef request_new_project():\n    dialog = CreateProject()\n    rc = dialog.ShowModal(Rhino.UI.RhinoEtoApp.MainWindow)\n    if (rc):\n        return dialog.get_text(), dialog.get_file_location()\n    else:\n        return False, False\n\n\ndef create_new_project(project):\n    # project_id = api.get_data(dict=api.save_project(\n    #     project=datamodels.OpenPlansProject.from_custom(data=project).project), key='project_id')\n    # project_id = 557    # hardcoded for testing\n    project_id = None\n    if project_id:\n        return datamodels.OpenPlansProject.from_project_id(project_id)\n    else:\n        return datamodels.OpenPlansProject.from_custom(data=project)\n\n\ndef CommandLineOptions():\n    items = (\"Options\", \"CreateNew\", \"LoadExisting\")\n    results = rs.GetBoolean(\"Create OPEN PLANS project (press enter to continue)\", items, (False))\n    if results:\n        if results[0]:\n            load_existing_project()\n            return True\n    else:\n        print('Cancel')\n        return True\n\n\ndef fetch_project_by_id(id):\n    return datamodels.OpenPlansProject.from_project_id(id)\n\n\ndef load_existing_project():\n    project_id = rs.GetInteger(\"Project id\")\n\n    if project_id:\n        openplans_project = fetch_project_by_id(id=project_id)\n\n        # add project to rhino layers\n        rhh.project_to_rhino_layers(openplans_project)\n\n\ndef RunCommand(is_interactive):\n    options = CommandLineOptions()\n    if options:\n        return Rhino.Commands.Result.Success\n\n    new_project, file = request_new_project()\n\n    if new_project:\n        openplans_project = create_new_project(new_project)\n\n        # add project to rhino layers\n        rhh.project_to_rhino_layers(openplans_project)\n\n        if file:\n            with open(file, 'w') as o:\n                json.dump(openplans_project.project, o, indent=4)\n\n\nif __name__ == \"__main__\":\n    RunCommand(True)\n",
  "language": "python",
  "imports": [
    "Rhino",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}