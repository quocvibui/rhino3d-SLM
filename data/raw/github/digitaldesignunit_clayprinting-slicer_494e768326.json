{
  "source_url": "https://github.com/digitaldesignunit/clayprinting-slicer/blob/53537d912559e468aa7eac0c1c7942f48033251c/grasshopper_userobjects_src/DDUClayPrintingSlicer_ViewCaptureToFile.py",
  "repo": "digitaldesignunit/clayprinting-slicer",
  "repo_stars": 4,
  "repo_description": "Open-Source Grasshopper-based slicer, primarily for printing clay on the WASP40100.",
  "license": "MIT",
  "filepath": "grasshopper_userobjects_src/DDUClayPrintingSlicer_ViewCaptureToFile.py",
  "instruction": "PYTHON STANDARD LIBRARY IMPORTS",
  "code": "# PYTHON STANDARD LIBRARY IMPORTS\nimport os\nimport datetime\n\n# RHINO SDK IMPORTS\nimport System\nimport Rhino\nimport Grasshopper\nimport scriptcontext as sc\n\n# GHENV COMPONENT SETTINGS\nghenv.Component.Name = \"ViewCaptureToFile\"\nghenv.Component.NickName = \"ViewCaptureToFile\"\nghenv.Component.Category = \"DDUClayPrintingSlicer\"\nghenv.Component.SubCategory = \"8 Visualisation\"\n\n\nclass ViewCaptureToFile(Grasshopper.Kernel.GH_ScriptInstance):\n    \"\"\"\n    Author: Anders Holden Deleuran (updated 2025 by Max Benjamin Eschenbach)\n    License: MIT License\n    Version: 250902\n    Description: Captures the active Rhino view to an image file\n    \"\"\"\n\n    def __init__(self):\n        super().__init__()\n        # initialize props\n        self.Component = ghenv.Component  # type: ignore[reportUnedfinedVariable] # NOQA\n        self.InputParams = self.Component.Params.Input\n        self.OutputParams = self.Component.Params.Output\n\n    def _addRemark(self, msg: str = ''):\n        \"\"\"Add a remark message to the component runtime messages.\"\"\"\n        rml = self.Component.RuntimeMessageLevel.Remark\n        self.AddRuntimeMessage(rml, msg)\n\n    def _addWarning(self, msg: str = ''):\n        \"\"\"Add a warning message to the component runtime messages.\"\"\"\n        rml = self.Component.RuntimeMessageLevel.Warning\n        self.AddRuntimeMessage(rml, msg)\n\n    def _addError(self, msg: str = ''):\n        \"\"\"Add an error message to the component runtime messages.\"\"\"\n        rml = self.Component.RuntimeMessageLevel.Error\n        self.AddRuntimeMessage(rml, msg)\n\n    def checkOrMakeFolder(self):\n        \"\"\"\n        Check/makes a \"Captures\" folder in the GH def folder and a subfolder\n        in the format 'YYMMDD'.\n        \"\"\"\n        # construct timestamp for subfolder\n        date = datetime.date.today()\n        yy = str(date.year)[-2:]\n        mm = str(date.month).zfill(2)\n        dd = str(date.day).zfill(2)\n        timestamp = yy + mm + dd\n        docpath = ghdoc.Path  # type: ignore[reportUnedfinedVariable] # NOQA\n        if docpath:\n            folder = os.path.dirname(docpath)\n            captureFolder = folder + \"\\\\Captures\\\\\" + timestamp\n            if not os.path.isdir(captureFolder):\n                os.makedirs(captureFolder)\n            return captureFolder\n\n    def makeFileName(self):\n        \"\"\" Make a string with the gh def name + current hourMinuteSecond \"\"\"\n        # Make hour minute seconds string\n        n = datetime.datetime.now()\n        ho, mt, sc = str(n.hour), str(n.minute), str(n.second)\n        if len(ho) == 1:\n            ho = \"0\" + ho\n        if len(mt) == 1:\n            mt = \"0\" + mt\n        if len(sc) == 1:\n            sc = \"0\" + sc\n        hms = ho + mt + sc\n        # Get name of GH def\n        ghDef = ghdoc.Name.strip(\"*\")  # type: ignore[reportUnedfinedVariable] # NOQA\n        # Concatenate and return\n        fileName = ghDef + \"_\" + hms\n        return fileName\n\n    def captureActiveViewToFile(\n            self,\n            width,\n            height,\n            path,\n            grid,\n            worldAxes,\n            cplaneAxes):\n        \"\"\"\n        Captures the active view to an image file at the path.\n        Path looks like this:\n        \"C:\\\\Users\\\\user\\\\Desktop\\\\Captures\\\\foo_bar.png\"\n        \"\"\"\n        # Set the script context to the current Rhino doc\n        sc.doc = Rhino.RhinoDoc.ActiveDoc\n        # Get the active view and set image dimensions\n        activeView = sc.doc.Views.ActiveView\n        # Perform the capture\n        try:\n            viewcap = Rhino.Display.ViewCapture()\n            viewcap.DrawGrid = grid\n            viewcap.DrawGridAxes = worldAxes\n            viewcap.DrawAxes = cplaneAxes\n            viewcap.Height = height\n            viewcap.Width = width\n            imageCap = viewcap.CaptureToBitmap(activeView)\n            System.Drawing.Bitmap.Save(imageCap, path)\n            Rhino.RhinoApp.WriteLine(path)\n            sc.doc = ghdoc  # type: ignore[reportUnedfinedVariable] # NOQA\n            return path\n        except Exception as e:\n            sc.doc = ghdoc  # type: ignore[reportUnedfinedVariable] # NOQA\n            raise Exception(f'Capture failed, check the path: {str(e)}')\n\n    def RunScript(self,\n            Toggle: bool,\n            Width: int,\n            Height: int,\n            BackgroundColor: System.Drawing.Color,\n            Grid: bool,\n            WorldAxes: bool,\n            CPlaneAxes: bool,\n            OpenFile: bool):\n        \"\"\"\n        Main execution method for capturing the active view to a file.\n\n        Args:\n            Toggle: Boolean to execute the capture operation\n            Width: Image width in pixels (default: 1920)\n            Height: Image height in pixels (default: 1080)\n            BackgroundColor: Background color for the viewport\n            Grid: Show grid in capture\n            WorldAxes: Show world axes in capture\n            CPlaneAxes: Show construction plane axes in capture\n            OpenFile: Open the captured file after creation\n\n        Returns:\n            Path to the captured image file\n        \"\"\"\n        # Initialize param descriptions (this has to be done in RunScript)\n        self.InputParams[0].Description = (\n            'Toggle to execute the view capture operation'\n        )\n        self.InputParams[1].Description = (\n            'Image width in pixels (default: 1920 if not provided)'\n        )\n        self.InputParams[2].Description = (\n            'Image height in pixels (default: 1080 if not provided)'\n        )\n        self.InputParams[3].Description = (\n            'Background color for the viewport capture'\n        )\n        self.InputParams[4].Description = (\n            'Show grid in the captured image'\n        )\n        self.InputParams[5].Description = (\n            'Show world axes in the captured image'\n        )\n        self.InputParams[6].Description = (\n            'Show construction plane axes in the captured image'\n        )\n        self.InputParams[7].Description = (\n            'Open the captured file after creation'\n        )\n\n        # Initialize output param descriptions\n        self.OutputParams[0].Description = (\n            'Path to the captured image file'\n        )\n\n        # Set up output trees and results\n        Path = Grasshopper.DataTree[System.Object]()\n\n        if not Toggle:\n            self.Component.Message = (\n                'Ready to capture view (toggle to execute)'\n            )\n            return Path\n\n        try:\n            # Set background color if provided\n            if BackgroundColor:\n                settings = Rhino.ApplicationSettings.AppearanceSettings\n                settings.ViewportBackgroundColor = BackgroundColor\n                self._addRemark('Background color set for capture')\n\n            # Set default dimensions if not provided\n            if not Width:\n                Width = 1920\n            if not Height:\n                Height = 1080\n\n            self.Component.Message = 'Preparing capture...'\n\n            # Create capture folder and filename\n            capFolder = self.checkOrMakeFolder()\n            fileName = self.makeFileName()\n            path = os.path.join(capFolder, fileName + '.png')\n\n            self.Component.Message = 'Capturing view...'\n\n            # Perform the capture\n            captured_path = self.captureActiveViewToFile(\n                Width, Height, path, Grid, WorldAxes, CPlaneAxes\n            )\n\n            # Add to output\n            ghp = Grasshopper.Kernel.Data.GH_Path(0)\n            Path.Add(captured_path, ghp)\n\n            # Open file if requested\n            if OpenFile:\n                os.startfile(path)\n                self._addRemark('File opened after capture')\n\n            self.Component.Message = f'View captured: {fileName}.png'\n            self._addRemark(f'Successfully captured view to {captured_path}')\n\n            return Path\n\n        except Exception as e:\n            msg = f'Capture failed: {str(e)}'\n            self._addError(msg)\n            self.Component.Message = msg\n            return Path\n",
  "language": "python",
  "imports": [
    "Rhino",
    "scriptcontext"
  ],
  "has_docstring": true
}