{
  "source_url": "https://github.com/chriswmackey/lbt-rhino/blob/d650b6631f4a5708f4472427d076c2343c569ac2/libraries/ladybug_rhino/bakegeometry.py",
  "repo": "chriswmackey/lbt-rhino",
  "repo_stars": 0,
  "repo_description": "A set of Rhino scripts that run Ladybug Tools as commands.",
  "license": "AGPL-3.0",
  "filepath": "libraries/ladybug_rhino/bakegeometry.py",
  "instruction": "Functions to bake from Ladybug geometries into a Rhino document.",
  "code": "\"\"\"Functions to bake from Ladybug geometries into a Rhino document.\"\"\"\nfrom .fromgeometry import from_point2d, from_arc2d, from_polyline2d, from_mesh2d, \\\n    from_point3d, from_plane, from_arc3d, from_polyline3d, \\\n    from_mesh3d, from_face3d, from_polyface3d, from_sphere, from_cone, from_cylinder\nfrom .color import color_to_color, gray\n\ntry:\n    from System.Drawing import Color\nexcept ImportError as e:\n    raise ImportError(\"Failed to import Windows/.NET libraries\\n{}\".format(e))\n\ntry:\n    import Rhino.Geometry as rg\n    from Rhino import RhinoMath\n    import Rhino.DocObjects as docobj\n    from Rhino import RhinoDoc as rhdoc\nexcept ImportError as e:\n    raise ImportError(\"Failed to import Rhino document attributes.\\n{}\".format(e))\n\n\"\"\"____________BAKE 2D GEOMETRY TO THE RHINO SCENE____________\"\"\"\n\n\ndef bake_vector2d(vector, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Ray2D to the Rhino scene as a Line with an Arrowhead.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (rg.Point3d(0, 0, z), rg.Point3d(vector.x, vector.y, z))\n    attrib = _get_attributes(layer_name, attributes)\n    attrib.ObjectDecoration = docobj.ObjectDecoration.EndArrowhead\n    return doc.Objects.AddLine(seg[0], seg[1], attrib)\n\n\ndef bake_point2d(point, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Point2D to the Rhino scene as a Point.\"\"\"\n    doc = rhdoc.ActiveDoc\n    pt = from_point2d(point, z)\n    return doc.Objects.AddPoint(pt, _get_attributes(layer_name, attributes))\n\n\ndef bake_ray2d(ray, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Ray2D to the Rhino scene as a Line with an Arrowhead.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (from_point2d(ray.p, z), from_point2d(ray.p + ray.v, z))\n    attrib = _get_attributes(layer_name, attributes)\n    attrib.ObjectDecoration = docobj.ObjectDecoration.EndArrowhead\n    return doc.Objects.AddLine(seg[0], seg[1], attrib)\n\n\ndef bake_linesegment2d(line, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug LineSegment2D to the Rhino scene as a Line.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (from_point2d(line.p1, z), from_point2d(line.p2, z))\n    return doc.Objects.AddLine(seg[0], seg[1], _get_attributes(layer_name, attributes))\n\n\ndef bake_polygon2d(polygon, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Polygon2D to the Rhino scene as a Polyline.\"\"\"\n    doc = rhdoc.ActiveDoc\n    pgon = [from_point2d(pt, z) for pt in polygon.vertices] + \\\n        [from_point2d(polygon[0], z)]\n    return doc.Objects.AddPolyline(pgon, _get_attributes(layer_name, attributes))\n\n\ndef bake_arc2d(arc, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Arc2D to the Rhino scene as an Arc or a Circle.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_arc = from_arc2d(arc, z)\n    if arc.is_circle:\n        return doc.Objects.AddCircle(rh_arc, _get_attributes(layer_name, attributes))\n    else:\n        return doc.Objects.AddArc(rh_arc, _get_attributes(layer_name, attributes))\n\n\ndef bake_polyline2d(polyline, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Polyline2D to the Rhino scene as a Curve.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_crv = from_polyline2d(polyline, z)\n    return doc.Objects.AddCurve(rh_crv, _get_attributes(layer_name, attributes))\n\n\ndef bake_mesh2d(mesh, z=0, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Mesh2D to the Rhino scene as a Mesh.\"\"\"\n    doc = rhdoc.ActiveDoc\n    _mesh = from_mesh2d(mesh, z)\n    return doc.Objects.AddMesh(_mesh, _get_attributes(layer_name, attributes))\n\n\n\"\"\"____________BAKE 3D GEOMETRY TO THE RHINO SCENE____________\"\"\"\n\n\ndef bake_vector3d(vector, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Ray2D to the Rhino scene as a Line with an Arrowhead.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (rg.Point3d(0, 0, 0), rg.Point3d(vector.x, vector.y, vector.z))\n    attrib = _get_attributes(layer_name, attributes)\n    attrib.ObjectDecoration = docobj.ObjectDecoration.EndArrowhead\n    return doc.Objects.AddLine(seg[0], seg[1], attrib)\n\n\ndef bake_point3d(point, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Point3D to the Rhino scene as a Point.\"\"\"\n    doc = rhdoc.ActiveDoc\n    pt = from_point3d(point)\n    return doc.Objects.AddPoint(pt, _get_attributes(layer_name, attributes))\n\n\ndef bake_ray3d(ray, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Ray2D to the Rhino scene as a Line with an Arrowhead.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (from_point3d(ray.p), from_point3d(ray.p + ray.v))\n    attrib = _get_attributes(layer_name, attributes)\n    attrib.ObjectDecoration = docobj.ObjectDecoration.EndArrowhead\n    return doc.Objects.AddLine(seg[0], seg[1], attrib)\n\n\ndef bake_plane(plane, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Plane to the Rhino scene as a Rectangle.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_pln = from_plane(plane)\n    r = 10  # default radius for a plane object in rhino model units\n    interval = rg.Interval(-r / 2, r / 2)\n    rect = rg.Rectangle3d(rh_pln, interval, interval)\n    return doc.Objects.AddRectangle(rect, _get_attributes(layer_name, attributes))\n\n\ndef bake_linesegment3d(line, layer_name=None, attributes=None):\n    \"\"\"Add ladybug LineSegment3D to the Rhino scene as a Line.\"\"\"\n    doc = rhdoc.ActiveDoc\n    seg = (from_point3d(line.p1), from_point3d(line.p2))\n    return doc.Objects.AddLine(seg[0], seg[1], _get_attributes(layer_name, attributes))\n\n\ndef bake_arc3d(arc, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Arc3D to the Rhino scene as an Arc or Circle.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_arc = from_arc3d(arc)\n    if arc.is_circle:\n        return doc.Objects.AddCircle(rh_arc, _get_attributes(layer_name, attributes))\n    else:\n        return doc.Objects.AddArc(rh_arc, _get_attributes(layer_name, attributes))\n\n\ndef bake_polyline3d(polyline, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Polyline3D to the Rhino scene as a Curve.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_crv = from_polyline3d(polyline)\n    return doc.Objects.AddCurve(rh_crv, _get_attributes(layer_name, attributes))\n\n\ndef bake_mesh3d(mesh, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Mesh3D to the Rhino scene as a Mesh.\"\"\"\n    doc = rhdoc.ActiveDoc\n    _mesh = from_mesh3d(mesh)\n    return doc.Objects.AddMesh(_mesh, _get_attributes(layer_name, attributes))\n\n\ndef bake_face3d(face, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Face3D to the Rhino scene as a Brep.\"\"\"\n    doc = rhdoc.ActiveDoc\n    _face = from_face3d(face)\n    return doc.Objects.AddBrep(_face, _get_attributes(layer_name, attributes))\n\n\ndef bake_polyface3d(polyface, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Polyface3D to the Rhino scene as a Brep.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_polyface = from_polyface3d(polyface)\n    return doc.Objects.AddBrep(rh_polyface, _get_attributes(layer_name, attributes))\n\n\ndef bake_sphere(sphere, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Sphere to the Rhino scene as a Brep.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_sphere = from_sphere(sphere).ToBrep()\n    return doc.Objects.AddBrep(rh_sphere, _get_attributes(layer_name, attributes))\n\n\ndef bake_cone(cone, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Cone to the Rhino scene as a Brep.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_cone = from_cone(cone).ToBrep()\n    return doc.Objects.AddBrep(rh_cone, _get_attributes(layer_name, attributes))\n\n\ndef bake_cylinder(cylinder, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Cylinder to the Rhino scene as a Brep.\"\"\"\n    doc = rhdoc.ActiveDoc\n    rh_cylinder = from_cylinder(cylinder).ToBrep()\n    return doc.Objects.AddBrep(rh_cylinder, _get_attributes(layer_name, attributes))\n\n\n\"\"\"________ADDITIONAL 3D GEOMETRY TRANSLATORS________\"\"\"\n\n\ndef bake_mesh3d_as_hatch(mesh, layer_name=None, attributes=None):\n    \"\"\"Add ladybug Mesh3D to the Rhino scene as a colored hatch.\"\"\"\n    doc = rhdoc.ActiveDoc\n    # get a list of colors that align with the mesh faces\n    if mesh.colors is not None:\n        if mesh.is_color_by_face:\n            colors = [color_to_color(col) for col in mesh.colors]\n        else:  # compute the average color across the vertices\n            colors, v_cols = [], mesh.colors\n            for face in mesh.faces:\n                red = int(sum(v_cols[f].r for f in face) / len(face))\n                green = int(sum(v_cols[f].g for f in face) / len(face))\n                blue = int(sum(v_cols[f].b for f in face) / len(face))\n                colors.append(Color.FromArgb(255, red, green, blue))\n    else:\n        colors = [gray()] * len(mesh.faces)\n\n    # create hatches from each of the faces and get an aligned list of colors\n    hatches, hatch_colors = [], []\n    vertices = mesh.vertices\n    for face, color in zip(mesh.faces, colors):\n        f_verts = [from_point3d(vertices[f]) for f in face]\n        f_verts.append(f_verts[0])\n        p_line = rg.PolylineCurve(f_verts)\n        if p_line.IsPlanar():\n            hatches.append(rg.Hatch.Create(p_line, 0, 0, 0)[0])\n            hatch_colors.append(color)\n        elif len(face) == 4:\n            p_line_1 = rg.PolylineCurve(f_verts[:3] + [f_verts[0]])\n            p_line_2 = rg.PolylineCurve(f_verts[-3:] + [f_verts[-3]])\n            hatches.append(rg.Hatch.Create(p_line_1, 0, 0, 0)[0])\n            hatches.append(rg.Hatch.Create(p_line_2, 0, 0, 0)[0])\n            hatch_colors.extend((color, color))\n\n    # bake the hatches into the scene\n    guids = []\n    for hatch, color in zip(hatches, hatch_colors):\n        attribs = _get_attributes(layer_name, attributes)\n        attribs.ColorSource = docobj.ObjectColorSource.ColorFromObject\n        attribs.ObjectColor = color\n        guids.append(doc.Objects.AddHatch(hatch, attribs))\n\n    # group the hatches so that they are easy to handle in the Rhino scene\n    group_t = doc.Groups\n    docobj.Tables.GroupTable.Add(group_t, guids)\n    return guids\n\n\n\"\"\"________________EXTRA HELPER FUNCTIONS________________\"\"\"\n\n\ndef _get_attributes(layer_name=None, attributes=None):\n    \"\"\"Get Rhino object attributes.\"\"\"\n    doc = rhdoc.ActiveDoc\n    attributes = doc.CreateDefaultAttributes() if attributes is None else attributes\n    if layer_name is None:\n        return attributes\n    elif isinstance(layer_name, int):\n        attributes.LayerIndex = layer_name\n    elif layer_name is not None:\n        attributes.LayerIndex = _get_layer(layer_name)\n    return attributes\n\n\ndef _get_layer(layer_name):\n    \"\"\"Get a layer index from the Rhino document from the layer name.\"\"\"\n    doc = rhdoc.ActiveDoc\n    layer_table = doc.Layers  # layer table\n    layer_index = layer_table.FindByFullPath(layer_name, RhinoMath.UnsetIntIndex)\n    if layer_index == RhinoMath.UnsetIntIndex:\n        all_layers = layer_name.split('::')\n        parent_name = all_layers[0]\n        layer_index = layer_table.FindByFullPath(parent_name, RhinoMath.UnsetIntIndex)\n        if layer_index == RhinoMath.UnsetIntIndex:\n            parent_layer = docobj.Layer()\n            parent_layer.Name = parent_name\n            layer_index = layer_table.Add(parent_layer)\n        for lay in all_layers[1:]:\n            parent_name = '{}::{}'.format(parent_name, lay)\n            parent_index = layer_index\n            layer_index = layer_table.FindByFullPath(\n                parent_name, RhinoMath.UnsetIntIndex)\n            if layer_index == RhinoMath.UnsetIntIndex:\n                parent_layer = docobj.Layer()\n                parent_layer.Name = lay\n                parent_layer.ParentLayerId = layer_table[parent_index].Id\n                layer_index = layer_table.Add(parent_layer)\n\n    return layer_index\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}