{
  "source_url": "https://github.com/Exponent-Labs/exponent-compute-rhino3d/blob/2f56ff9a30c3b87f53e6aaab1d4b7548bc068b16/compute_rhino3d/Util.py",
  "repo": "Exponent-Labs/exponent-compute-rhino3d",
  "repo_stars": 0,
  "repo_description": "A patched version of the compute python library that fixes batched requests",
  "license": "unknown",
  "filepath": "compute_rhino3d/Util.py",
  "instruction": null,
  "code": "import rhino3dm\r\nimport json\r\nimport requests\r\n\r\n__version__ = '0.12.1'\r\n\r\nurl = 'https://compute.rhino3d.com/'\r\nauthToken = ''\r\napiKey = ''\r\nstopat = 0\r\n\r\n\r\ndef ComputeFetch(endpoint, arglist):\r\n    class __Rhino3dmEncoder(json.JSONEncoder):\r\n        def default(self, o):\r\n            if hasattr(o, \"Encode\"):\r\n                return o.Encode()\r\n            return json.JSONEncoder.default(self, o)\r\n    global authToken\r\n    global apiKey\r\n    global url\r\n    global stopat\r\n    posturl = url + endpoint\r\n    if(stopat>0):\r\n        if(posturl.find('?')>0): posturl += '&stopat='\r\n        else: posturl += '?stopat='\r\n        posturl += str(stopat)\r\n    postdata = json.dumps(arglist, cls=__Rhino3dmEncoder)\r\n    headers = { 'User-Agent': 'compute.rhino3d.py/' + __version__ }\r\n    if authToken:\r\n        headers['Authorization'] = 'Bearer ' + authToken\r\n    if apiKey:\r\n        headers['RhinoComputeKey'] = apiKey\r\n    r = requests.post(posturl, data=postdata, headers=headers)\r\n    return r.json()\r\n\r\n\r\ndef PythonEvaluate(script, inputs, output_names):\r\n    \"\"\"\r\n    Evaluate a python script on the compute server. The script can reference an\r\n    `input` parameter which is passed as a dictionary. The script also has\r\n    access to an 'output' parameter which is returned from the server.\r\n\r\n    Args:\r\n        script (str): the python script to evaluate\r\n        inputs (dict): dictionary of data passed to the server for use by the\r\n                       script as an input variable\r\n        output_names (list): list of strings defining which variables in the\r\n                       script to return\r\n    Returns:\r\n        dict: The script has access to an output dict variable that it can\r\n              fill with values. This information is returned from the server\r\n              to the client.\r\n    \"\"\"\r\n    encodedInput = rhino3dm.ArchivableDictionary.EncodeDict(inputs)\r\n    url = 'rhino/python/evaluate'\r\n    args = [script, json.dumps(encodedInput), output_names]\r\n    response = ComputeFetch(url, args)\r\n    output = rhino3dm.ArchivableDictionary.DecodeDict(json.loads(response))\r\n    return output\r\n\r\n\r\ndef DecodeToCommonObject(item):\r\n    if item is None:\r\n        return None\r\n    if isinstance(item, list):\r\n        return [DecodeToCommonObject(x) for x in item]\r\n    return rhino3dm.CommonObject.Decode(item)\r\n\r\n\r\ndef DecodeToPoint3d(item):\r\n    if item is None:\r\n        return None\r\n    if isinstance(item, list):\r\n        return [DecodeToPoint3d(x) for x in item]\r\n    return rhino3dm.Point3d(item['X'], item['Y'], item['Z'])\r\n\r\n\r\ndef DecodeToVector3d(item):\r\n    if item is None:\r\n        return None\r\n    if isinstance(item, list):\r\n        return [DecodeToVector3d(x) for x in item]\r\n    return rhino3dm.Vector3d(item['X'], item['Y'], item['Z'])\r\n\r\n\r\ndef DecodeToLine(item):\r\n    if item is None:\r\n        return None\r\n    if isinstance(item, list):\r\n        return [DecodeToLine(x) for x in item]\r\n    start = DecodeToPoint3d(item['From'])\r\n    end = DecodeToPoint3d(item['To'])\r\n    return rhino3dm.Line(start,end)\r\n\r\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}