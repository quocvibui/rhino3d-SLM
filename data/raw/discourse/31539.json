{
  "source_url": "https://discourse.mcneel.com/t/floor-generator-script-work-in-progress/31539",
  "topic_id": 31539,
  "title": "Floor generator script (work in progress)",
  "question": "floormaker-01.jpg\n800Ã—600 80.5 KB\n\n\nsee script below for explanation\n\n\n\"\"\"\nfloor maker script *** work in progress ***\ngoal is to make something that looks like floor generator for 3dsmax\nwould require a multimaterial and ability to assign material IDs to objects\nto work properly and ultimately randomization of the map color per object\nwhich is currently not possible vray as far as I know.\n\nScript will generate floor planks and add random text coordinates to each plank\nbut will do that within the maps size.\nRight now a texture size of 2000 x 300 units is chosen. So the smaller the\nplanks are, the more it can be randomized\n\nother possibilities to include:\n- making the planks not straight, but this will require denser meshes\n- rotation (180 degrees) of textures for more quasi uniqueness\n- a check to avoid seams on short ends to not come to close together\n***********************************\n* script written by Gijs de Zwart *\n* www.studiogijs.nl               *\n* April, 2016                     *\n***********************************\n\"\"\"\n\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport random\nimport math\n\ndef createMesh(vertices,face_vertices):\n    mesh = Rhino.Geometry.Mesh()\n    for a, b, c in vertices: mesh.Vertices.Add(a, b, c)\n    for face in face_vertices:\n        if len(face)<4:\n            mesh.Faces.AddFace(face[0], face[1], face[2])\n        else:\n            mesh.Faces.AddFace(face[0], face[1], face[2], face[3])\n    return mesh\n\n\ndef addPlank(plane, width, length):\n    \n    #define texture size in world units here\n    texWidth = 2000\n    texHeight = 300\n    \n    rect=Rhino.Geometry.Rectangle3d(plane,width,length)\n    pts=[rect.Corner(i) for i in range(0,4)]\n    pts2=[]\n    for i in range(0,4):\n        pts2.append(Rhino.Geometry.Point3d(0,0,20))\n    for i in range(0,len(pts2)):#modify points\n        pts2[i].X=pts[i].X\n        pts2[i].Y=pts[i].Y\n    for pt in pts2:#add points to original points\n        pts.append(pt)\n        \n    fac...",
  "code_blocks": [
    {
      "code": "\"\"\"\nfloor maker script *** work in progress ***\ngoal is to make something that looks like floor generator for 3dsmax\nwould require a multimaterial and ability to assign material IDs to objects\nto work properly and ultimately randomization of the map color per object\nwhich is currently not possible vray as far as I know.\n\nScript will generate floor planks and add random text coordinates to each plank\nbut will do that within the maps size.\nRight now a texture size of 2000 x 300 units is chosen. So the smaller the\nplanks are, the more it can be randomized\n\nother possibilities to include:\n- making the planks not straight, but this will require denser meshes\n- rotation (180 degrees) of textures for more quasi uniqueness\n- a check to avoid seams on short ends to not come to close together\n***********************************\n* script written by Gijs de Zwart *\n* www.studiogijs.nl               *\n* April, 2016                     *\n* May, 2020 (random rotation)     *\n***********************************\n\"\"\"\n\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport random\nimport math\n\ndef createMesh(vertices,face_vertices):\n    mesh = Rhino.Geometry.Mesh()\n    for a, b, c in vertices: mesh.Vertices.Add(a, b, c)\n    for face in face_vertices:\n        if len(face)<4:\n            mesh.Faces.AddFace(face[0], face[1], face[2])\n        else:\n            mesh.Faces.AddFace(face[0], face[1], face[2], face[3])\n    return mesh\n\n\ndef addPlank(plane, width, length):\n    \n    #define texture size in world units here\n    texWidth = 2000\n    texHeight = 300\n    \n    rect=Rhino.Geometry.Rectangle3d(plane,width,length)\n    pts=[rect.Corner(i) for i in range(0,4)]\n    pts2=[]\n    for i in range(0,4):\n        pts2.append(Rhino.Geometry.Point3d(0,0,20))\n    for i in range(0,len(pts2)):#modify points\n        pts2[i].X=pts[i].X\n        pts2[i].Y=pts[i].Y\n    for pt in pts2:#add points to original points\n        pts.append(pt)\n        \n    faceVertices = []\n    faceVertices.append((0,3,2,1))\n    faceVertices.append((0,1,5,4))\n    faceVertices.append((1,2,6,5))\n    faceVertices.append((2,3,7,6))\n    faceVertices.append((3,0,4,7))\n    faceVertices.append((4,5,6,7))\n    \n    \n    mesh=createMesh(pts,faceVertices)\n    mesh.Unweld(.3,True)\n    dx=Rhino.Geometry.Interval(0,texWidth)\n    dy=Rhino.Geometry.Interval(0,texHeight)\n    dz=Rhino.Geometry.Interval(0,20)\n    #add mesh to document to apply a texture map\n    newmesh = sc.doc.Objects.AddMesh(mesh)\n    randX=(texHeight-width)*random.uniform(0,1)\n    randY=(texWidth-length)*random.uniform(0,1)\n    texplane=Rhino.Geometry.Plane.WorldXY\n    texplane.Origin = plane.Origin\n    texplane.Rotate(math.pi/2,plane.ZAxis)\n    texplane.OriginY+=length-texWidth+randY\n    texplane.OriginX+=texHeight-randX\n    texmap = Rhino.Render.TextureMapping.CreatePlaneMapping(texplane,dx,dy,dz)    \n    table = Rhino.RhinoDoc.ActiveDoc.Objects\n    Rhino.DocObjects.Tables.ObjectTable.ModifyTextureMapping(table,newmesh,1,texmap)\n    center = rs.MeshAreaCentroid(newmesh)\n    angle= random.uniform(-.5,.5)\n    rs.RotateObject(newmesh, center, angle, copy=False)\n    angle= random.uniform(-2,2)\n    axis = Rhino.Geometry.Vector3d(0,1,0)\n    rs.RotateObject(newmesh, center, angle, axis, copy=False)\n    angle= random.uniform(-.25,.25)\n    axis = Rhino.Geometry.Vector3d(1,0,0)\n    rs.RotateObject(newmesh, center, angle, axis, copy=False)\n\ndef randomFloor():\n    floorwidth = rs.GetReal(\"enter floor width size\",10000)\n    floorlength = rs.GetReal(\"enter floor length size\",10000)\n    width=rs.GetReal(\"enter plank width\",140)\n    maxlength = rs.GetReal(\"enter plank max length\",2000)\n    minlength = rs.GetReal(\"enter plank min length\",700)\n    gapwidth = rs.GetReal(\"enter gap width\", 2)\n    plane = Rhino.Geometry.Plane.WorldXY\n    i=0\n    meshes=[]\n    temp=0\n    while i<floorwidth:\n        j=0\n        plane.OriginY=0\n        while j<floorlength:\n            \n            randomlength = random.randint(minlength,maxlength)\n            if j==0:\n                startlength=random.randint(2,20)*maxlength/20\n                while temp==startlength:\n                    startlength=random.randint(3,20)*maxlength/20\n                temp=startlength\n                addPlank(plane, width, startlength)\n                j+=startlength+gapwidth\n                \n            elif randomlength<floorlength-j:\n                #if (floorlength-j)/2<randomlength:\n                    #randomlength-=300\n                addPlank(plane, width, randomlength)\n                j+=randomlength+gapwidth\n                \n            else:\n                addPlank(plane, width, floorlength-j)\n                j=floorlength\n                \n            plane.OriginY=j\n            \n        plane.OriginX+=width+gapwidth\n        i+=width\n    floor=[sc.doc.Objects.AddMesh(mesh) for mesh in meshes]\n    sc.doc.Views.Redraw()\n            \n    \nrandomFloor()",
      "language": "python",
      "author": "Gijs",
      "post_number": 20,
      "is_solution": false
    },
    {
      "code": "\"\"\"\nfloor maker script *** work in progress ***\ngoal is to make something that looks like floor generator for 3dsmax\nwould require a multimaterial and ability to assign material IDs to objects\nto work properly and ultimately randomization of the map color per object\nwhich is currently not possible vray as far as I know.\n\nScript will generate floor planks and add random text coordinates to each plank\nbut will do that within the maps size.\nRight now a texture size of 2000 x 300 units is chosen. So the smaller the\nplanks are, the more it can be randomized\n\nother possibilities to include:\n- making the planks not straight, but this will require denser meshes\n- rotation (180 degrees) of textures for more quasi uniqueness\n- a check to avoid seams on short ends to not come to close together\n***********************************\n* script written by Gijs de Zwart *\n* www.studiogijs.nl               *\n* April, 2016                     *\n***********************************\n\"\"\"\n\nimport Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext as sc\nimport random\nimport math\n\ndef createMesh(vertices,face_vertices):\n    mesh = Rhino.Geometry.Mesh()\n    for a, b, c in vertices: mesh.Vertices.Add(a, b, c)\n    for face in face_vertices:\n        if len(face)<4:\n            mesh.Faces.AddFace(face[0], face[1], face[2])\n        else:\n            mesh.Faces.AddFace(face[0], face[1], face[2], face[3])\n    return mesh\n\n\ndef addPlank(plane, width, length):\n    \n    #define texture size in world units here\n    texWidth = 2000\n    texHeight = 300\n    \n    rect=Rhino.Geometry.Rectangle3d(plane,width,length)\n    pts=[rect.Corner(i) for i in range(0,4)]\n    pts2=[]\n    for i in range(0,4):\n        pts2.append(Rhino.Geometry.Point3d(0,0,20))\n    for i in range(0,len(pts2)):#modify points\n        pts2[i].X=pts[i].X\n        pts2[i].Y=pts[i].Y\n    for pt in pts2:#add points to original points\n        pts.append(pt)\n        \n    faceVertices = []\n    faceVertices.append((0,3,2,1))\n    faceVertices.append((0,1,5,4))\n    faceVertices.append((1,2,6,5))\n    faceVertices.append((2,3,7,6))\n    faceVertices.append((3,0,4,7))\n    faceVertices.append((4,5,6,7))\n    \n    \n    mesh=createMesh(pts,faceVertices)\n    mesh.Unweld(.3,True)\n    dx=Rhino.Geometry.Interval(0,texWidth)\n    dy=Rhino.Geometry.Interval(0,texHeight)\n    dz=Rhino.Geometry.Interval(0,20)\n    #add mesh to document to apply a texture map\n    newmesh = sc.doc.Objects.AddMesh(mesh)\n    randX=(texHeight-width)*random.uniform(0,1)\n    randY=(texWidth-length)*random.uniform(0,1)\n    texplane=Rhino.Geometry.Plane.WorldXY\n    texplane.Origin = plane.Origin\n    texplane.Rotate(math.pi/2,plane.ZAxis)\n    texplane.OriginY+=length-texWidth+randY\n    texplane.OriginX+=texHeight-randX\n    texmap = Rhino.Render.TextureMapping.CreatePlaneMapping(texplane,dx,dy,dz)    \n    table = Rhino.RhinoDoc.ActiveDoc.Objects\n    Rhino.DocObjects.Tables.ObjectTable.ModifyTextureMapping(table,newmesh,1,texmap)\n\ndef randomFloor():\n    floorwidth = rs.GetReal(\"enter floor width size\",10000)\n    floorlength = rs.GetReal(\"enter floor length size\",10000)\n    width=rs.GetReal(\"enter plank width\",140)\n    maxlength = rs.GetReal(\"enter plank max length\",2000)\n    minlength = rs.GetReal(\"enter plank min length\",700)\n    gapwidth = rs.GetReal(\"enter gap width\", 2)\n    plane = Rhino.Geometry.Plane.WorldXY\n    i=0\n    meshes=[]\n    temp=0\n    while i<floorwidth:\n        j=0\n        plane.OriginY=0\n        while j<floorlength:\n            \n            randomlength = random.randint(minlength,maxlength)\n            if j==0:\n                startlength=random.randint(2,20)*maxlength/20\n                while temp==startlength:\n                    startlength=random.randint(3,20)*maxlength/20\n                temp=startlength\n                addPlank(plane, width, startlength)\n                j+=startlength+gapwidth\n                \n            elif randomlength<floorlength-j:\n                #if (floorlength-j)/2<randomlength:\n                    #randomlength-=300\n                addPlank(plane, width, randomlength)\n                j+=randomlength+gapwidth\n                \n            else:\n                addPlank(plane, width, floorlength-j)\n                j=floorlength\n                \n            plane.OriginY=j\n            \n        plane.OriginX+=width+gapwidth\n        i+=width\n    floor=[sc.doc.Objects.AddMesh(mesh) for mesh in meshes]\n    sc.doc.Views.Redraw()\n            \n    \nrandomFloor()",
      "language": "python",
      "author": "Gijs",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "materials",
    "mesh",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "transformation",
    "ui"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 30,
  "views": 7788
}