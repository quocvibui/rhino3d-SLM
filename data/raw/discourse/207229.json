{
  "source_url": "https://discourse.mcneel.com/t/point-on-object/207229",
  "topic_id": 207229,
  "title": "Point on object",
  "question": "I need to define points on the surface of the object, and then preview the drawn points and the normal direction of the object. However, I encountered some problems during the process and now the code is not running properly.\n\n\nimport Rhino\nimport scriptcontext as sc\nimport System.Drawing\n\nclass SurfaceNormalPicker:\n    def __init__(self):\n        self.surface_id = None\n        self.brep = None\n        self.face = None\n        self.current_pt = None\n        self.current_normal = None\n\n    def draw_callback(self, sender, e):\n        try:\n            if self.current_pt and self.current_normal:\n                pt = self.current_pt\n                normal = self.current_normal\n                end_pt = pt + normal * 5.0\n                e.Display.DrawPoint(pt, System.Drawing.Color.Red)\n                e.Display.DrawArrow(Rhino.Geometry.Line(pt, end_pt), System.Drawing.Color.Blue)\n        except Exception as ex:\n            print(\"draw_callback error:\", ex)\n        pass\n\n    def run(self):\n        try:\n            # 选一个曲面或多面体\n            rc, objref = Rhino.Input.RhinoGet.GetOneObject(\"选择一个曲面或多面体\", False, Rhino.DocObjects.ObjectType.Surface | Rhino.DocObjects.ObjectType.Brep)\n            if rc != Rhino.Commands.Result.Success:\n                print(\"未选中曲面\")\n                return\n\n            self.brep = objref.Brep()\n            if not self.brep:\n                print(\"选中对象不是Brep\")\n                return\n\n            # 这里只简单用第一个face\n            self.face = self.brep.Faces[0]\n\n            gp = Rhino.Input.Custom.GetPoint()\n            gp.SetCommandPrompt(\"点击曲面上的点，按 Enter 退出\")\n            gp.Constrain(self.face.UnderlyingSurface(), False)  # 约束到曲面\n            gp.DynamicDraw += self.draw_callback\n\n            while True:\n                rc = gp.Get()\n                if rc == Rhino.Commands.Result.Success:\n                    self.current_pt = gp.Point()\n                    break\n                    # 获取UV参数\n                    success, u, v = self.face.ClosestPoint(self.curren...",
  "code_blocks": [
    {
      "code": "#! python 3\n\nimport Rhino\nimport scriptcontext as sc\nimport System.Drawing\n\nclass SurfaceNormalPicker:\n    def __init__(self):\n        self.surface_id = None\n        self.brep = None\n        self.face = None\n        self.current_pt = None\n        self.current_normal = None\n\n    def draw_callback(self, sender, e):\n        try:\n            if self.current_pt and self.current_normal:\n                pt = self.current_pt\n                normal = self.current_normal\n                end_pt = pt + normal * 5.0\n                e.Display.DrawPoint(pt, System.Drawing.Color.Red)\n                e.Display.DrawArrow(Rhino.Geometry.Line(pt, end_pt), System.Drawing.Color.Blue)\n        except Exception as ex:\n            print(\"draw_callback error:\", ex)\n        pass\n\n    def run(self):\n        try:\n            # 选一个曲面或多面体\n            rc, objref = Rhino.Input.RhinoGet.GetOneObject(\"选择一个曲面或多面体\", False, Rhino.DocObjects.ObjectType.Surface | Rhino.DocObjects.ObjectType.Brep)\n            if rc != Rhino.Commands.Result.Success:\n                print(\"未选中曲面\")\n                return\n\n            self.brep = objref.Brep()\n            if not self.brep:\n                print(\"选中对象不是Brep\")\n                return\n\n            # 这里只简单用第一个face\n            self.face = self.brep.Faces[0]\n\n            gp = Rhino.Input.Custom.GetPoint()\n            gp.SetCommandPrompt(\"点击曲面上的点，按 Enter 退出\")\n            gp.Constrain(self.face.UnderlyingSurface(), False)  # 约束到曲面\n            gp.DynamicDraw += self.draw_callback\n\n            while True:\n                rc = gp.Get()\n                if rc == Rhino.Input.GetResult.Point:\n                    self.current_pt = gp.Point()\n                    # 获取UV参数\n                    success, u, v = self.face.ClosestPoint(self.current_pt)\n                    if success:\n                        self.current_normal = self.face.NormalAt(u, v)\n                        self.current_normal.Unitize()\n                        print(f\"点: {self.current_pt}, 法线: {self.current_normal}\")\n                        continue\n                    else:\n                        self.current_normal = None\n                        print(\"无法计算法线\")\n                else:\n                    break\n\n        except Exception as ex:\n            print(\"draw_callback error:\", ex)\n\nif __name__ == \"__main__\":\n    SurfaceNormalPicker().run()",
      "language": "python",
      "author": "clement",
      "post_number": 2,
      "is_solution": false
    },
    {
      "code": "import Rhino\nimport scriptcontext as sc\nimport System.Drawing\n\nclass SurfaceNormalPicker:\n    def __init__(self):\n        self.surface_id = None\n        self.brep = None\n        self.face = None\n        self.current_pt = None\n        self.current_normal = None\n\n    def draw_callback(self, sender, e):\n        try:\n            if self.current_pt and self.current_normal:\n                pt = self.current_pt\n                normal = self.current_normal\n                end_pt = pt + normal * 5.0\n                e.Display.DrawPoint(pt, System.Drawing.Color.Red)\n                e.Display.DrawArrow(Rhino.Geometry.Line(pt, end_pt), System.Drawing.Color.Blue)\n        except Exception as ex:\n            print(\"draw_callback error:\", ex)\n        pass\n\n    def run(self):\n        try:\n            # 选一个曲面或多面体\n            rc, objref = Rhino.Input.RhinoGet.GetOneObject(\"选择一个曲面或多面体\", False, Rhino.DocObjects.ObjectType.Surface | Rhino.DocObjects.ObjectType.Brep)\n            if rc != Rhino.Commands.Result.Success:\n                print(\"未选中曲面\")\n                return\n\n            self.brep = objref.Brep()\n            if not self.brep:\n                print(\"选中对象不是Brep\")\n                return\n\n            # 这里只简单用第一个face\n            self.face = self.brep.Faces[0]\n\n            gp = Rhino.Input.Custom.GetPoint()\n            gp.SetCommandPrompt(\"点击曲面上的点，按 Enter 退出\")\n            gp.Constrain(self.face.UnderlyingSurface(), False)  # 约束到曲面\n            gp.DynamicDraw += self.draw_callback\n\n            while True:\n                rc = gp.Get()\n                if rc == Rhino.Commands.Result.Success:\n                    self.current_pt = gp.Point()\n                    break\n                    # 获取UV参数\n                    success, u, v = self.face.ClosestPoint(self.current_pt)\n                    if success:\n                        self.current_normal = self.face.NormalAt(u, v)\n                        self.current_normal.Unitize()\n                        print(f\"点: {self.current_pt}, 法线: {self.current_normal}\")\n                    else:\n                        self.current_normal = None\n                        print(\"无法计算法线\")\n\n                elif rc == Rhino.Commands.Result.Cancel or rc == Rhino.Commands.Result.Nothing:\n                    print(\"结束点选\")\n                    break\n                else:\n                    print(\"未知错误\")\n                break\n        except Exception as ex:\n            print(\"draw_callback error:\", ex)\n\nif __name__ == \"__main__\":\n    SurfaceNormalPicker().run()",
      "language": "python",
      "author": "tom33",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "python",
    "rhinocommon"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 3,
  "views": 92
}