{
  "source_url": "https://discourse.mcneel.com/t/eto-forms-cell-color-from-layer-color/201874",
  "topic_id": 201874,
  "title": "Eto forms, Cell color from Layer color?",
  "question": "I do have this basic script and I do want if possible to get the cells from the \nMaterial\n column to have the same color as the color of the layer on which each object is on. It is possible to achieve this? This script needs to work on both Rhino v7 for MacOS and Windows.\n\n\n#!/usr/bin/env ironpython2.7\n# -*- coding: utf8 -*-\n# SimpleCutlist.py\n\nimport Rhino\nimport Rhino.Geometry as g\nimport rhinoscriptsyntax as rs\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport scriptcontext\n\n# List of layers to exclude\nEXCLUDED_LAYERS = [\"Booleans\", \"Dim\", \"Default\", \"Walls\"]\n\n# Attributes for the cutlist\nclass attr:\n    def __init__(self, name, isEditable, valType):\n        self.name = name\n        self.isEditable = isEditable\n        self.valType = valType\n\nATTRS = (\n    attr(\"_N\", True, str),        # N (number)\n    attr(\"_Name\", True, str),     # Name\n    attr(\"Length\", True, float),  # Length\n    attr(\"Width\", True, float),   # Width\n    attr(\"Thickness\", True, float), # Thickness\n    attr(\"Material\", True, str),  # Material\n)\n\ndef computeDims(obj):\n    objRef = Rhino.DocObjects.ObjRef(obj)\n    brep = objRef.Geometry()\n    edges = list(brep.Edges)\n    edges.sort(key=lambda edge: edge.GetLength(), reverse=True)\n    edge = edges[0]\n    origin = edge.PointAtStart\n    xPoint = edge.PointAtEnd\n    xVec = Rhino.Geometry.Vector3d(xPoint - origin)\n    xVec.Unitize()\n    face = brep.Faces[0]\n    yVec = Rhino.Geometry.Vector3d.CrossProduct(face.NormalAt(0, 0), xVec)\n    yVec.Unitize()\n    plane = Rhino.Geometry.Plane(origin, xVec, yVec)\n    verts = list(brep.Vertices)\n    tMatrix = g.Transform.ChangeBasis(g.Plane.WorldXY, plane)\n    map(lambda vert: vert.Transform(tMatrix), verts)\n    verts = list(map(lambda vert: vert.Location, verts))\n    verts.sort(key=lambda vert: vert.X)\n    length = verts[-1].X - verts[0].X\n    verts.sort(key=lambda vert: vert.Y)\n    width = verts[-1].Y - verts[0].Y\n    verts.sort(key=lambda vert: vert.Z)\n    thickness = verts[-1].Z - verts[0].Z\n   ...",
  "code_blocks": [
    {
      "code": "#!/usr/bin/env ironpython2.7\n# -*- coding: utf8 -*-\n# SimpleCutlist.py\n\nimport Rhino\nimport Rhino.Geometry as g\nimport rhinoscriptsyntax as rs\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport scriptcontext\n\n# List of layers to exclude\nEXCLUDED_LAYERS = [\"Booleans\", \"Dim\", \"Default\", \"Walls\"]\n\n# Attributes for the cutlist\nclass attr:\n    def __init__(self, name, isEditable, valType):\n        self.name = name\n        self.isEditable = isEditable\n        self.valType = valType\n\nATTRS = (\n    attr(\"_N\", True, str),        # N (number)\n    attr(\"_Name\", True, str),     # Name\n    attr(\"Length\", True, float),  # Length\n    attr(\"Width\", True, float),   # Width\n    attr(\"Thickness\", True, float), # Thickness\n    attr(\"Material\", True, str),  # Material\n)\n\ndef computeDims(obj):\n    objRef = Rhino.DocObjects.ObjRef(obj)\n    brep = objRef.Geometry()\n    edges = list(brep.Edges)\n    edges.sort(key=lambda edge: edge.GetLength(), reverse=True)\n    edge = edges[0]\n    origin = edge.PointAtStart\n    xPoint = edge.PointAtEnd\n    xVec = Rhino.Geometry.Vector3d(xPoint - origin)\n    xVec.Unitize()\n    face = brep.Faces[0]\n    yVec = Rhino.Geometry.Vector3d.CrossProduct(face.NormalAt(0, 0), xVec)\n    yVec.Unitize()\n    plane = Rhino.Geometry.Plane(origin, xVec, yVec)\n    verts = list(brep.Vertices)\n    tMatrix = g.Transform.ChangeBasis(g.Plane.WorldXY, plane)\n    map(lambda vert: vert.Transform(tMatrix), verts)\n    verts = list(map(lambda vert: vert.Location, verts))\n    verts.sort(key=lambda vert: vert.X)\n    length = verts[-1].X - verts[0].X\n    verts.sort(key=lambda vert: vert.Y)\n    width = verts[-1].Y - verts[0].Y\n    verts.sort(key=lambda vert: vert.Z)\n    thickness = verts[-1].Z - verts[0].Z\n    return [length, width, thickness]\n\nclass Detail:\n    def __init__(self, obj):\n        self.obj = obj\n        self.id = obj\n        for attr_obj in ATTRS:\n            key = attr_obj.name\n            val = rs.GetUserText(str(obj), key)\n            if val is None:\n                default = \"0\" if attr_obj.valType in [float, str] and key != \"Material\" else \"\"\n                setattr(self, key, default)\n                rs.SetUserText(str(obj), key, default)\n            else:\n                setattr(self, key, val)\n        self.setDims()\n        self.update_material_from_layer()\n\n    def setDims(self):\n        dims = computeDims(self.obj)\n        self.Length = str(round(dims[0], 2))\n        self.Width = str(round(dims[1], 2))\n        self.Thickness = str(round(dims[2], 2))\n        rs.SetUserText(str(self.id), \"Length\", self.Length)\n        rs.SetUserText(str(self.id), \"Width\", self.Width)\n        rs.SetUserText(str(self.id), \"Thickness\", self.Thickness)\n\n    def update_material_from_layer(self):\n        objRef = Rhino.DocObjects.ObjRef(self.id)\n        index = objRef.Object().Attributes.LayerIndex\n        layer = scriptcontext.doc.Layers[index]\n        self.Material = layer.Name\n        self.layer_color = drawing.Color.FromArgb(layer.Color.ToArgb())\n        rs.SetUserText(str(self.id), \"Material\", self.Material)\n\n    def getParams(self):\n        return [getattr(self, attr.name) for attr in ATTRS]\n\n    def refresh(self):\n        for attr in ATTRS:\n            rs.SetUserText(str(self.id), attr.name, getattr(self, attr.name))\n\nclass Specification:\n    def __init__(self, details):\n        self.details = []\n        idSet = set(range(len(details)))\n        self.table = []\n        self.colors = []  # Store layer colors\n        while idSet:\n            curId = idSet.pop()\n            curDet = details[curId]\n            curDetails = [curDet]\n            for id in list(idSet):\n                if curDet.getParams() == details[id].getParams():\n                    curDetails.append(details[id])\n                    idSet.remove(id)\n            self.details.append(curDetails)\n            self.table.append(curDet.getParams())\n            self.colors.append(curDet.layer_color)  # Store the layer color\n\nclass SimpleCutlistDialog(forms.Dialog[bool]):\n    def __init__(self):\n        self.Title = \"Simple Cutlist\"\n        self.Padding = drawing.Padding(2)\n        self.Resizable = True\n        \n        # Create export button\n        self.button = forms.Button(Text=\"Export CSV\")\n        self.button.Width = 80  # Set a smaller, specific width\n        self.button.Click += self.buttonClick\n        \n        # Create main layout\n        layout = forms.DynamicLayout()\n        self.Content = layout\n        self.ClientSize = drawing.Size(600, 400)\n        \n    def create_table(self, spec):\n        self.spec = spec\n        \n        # Create the table layout\n        table = forms.TableLayout()\n        table.Spacing = drawing.Size(1, 1)\n        \n        # Add header row\n        header_row = forms.TableRow()\n        for i, attr_obj in enumerate(ATTRS):\n            header_text = attr_obj.name if attr_obj.name[0] != \"_\" else attr_obj.name[1:]\n            label = forms.Label()\n            label.Text = header_text\n            label.VerticalAlignment = forms.VerticalAlignment.Center\n            \n            container = forms.Panel()\n            container.Padding = drawing.Padding(5, 2)\n            container.BackgroundColor = drawing.Colors.LightGrey\n            container.Content = label\n            \n            header_row.Cells.Add(forms.TableCell(container, True))\n        \n        table.Rows.Add(header_row)\n        \n        # Add data rows\n        for row_idx, row_data in enumerate(spec.table):\n            table_row = forms.TableRow()\n            \n            for col_idx, cell_data in enumerate(row_data):\n                # Create the text cell\n                label = forms.Label()\n                label.Text = str(cell_data)\n                label.VerticalAlignment = forms.VerticalAlignment.Center\n                \n                # Create container\n                container = forms.Panel()\n                container.Padding = drawing.Padding(5, 2)\n                \n                # If this is the Material column, set background color to layer color\n                if col_idx == 5:  # Material column\n                    container.BackgroundColor = spec.colors[row_idx]\n                else:\n                    # Alternating row colors\n                    if row_idx % 2 == 0:\n                        container.BackgroundColor = drawing.Colors.White\n                    else:\n                        container.BackgroundColor = drawing.Colors.FloralWhite\n                \n                container.Content = label\n                table_row.Cells.Add(forms.TableCell(container, True))\n            \n            table.Rows.Add(table_row)\n        \n        # Make all rows and cells expand to fill space\n        table.Rows.Add(None)\n        return table\n\n    def buttonClick(self, sender, e):\n        data = [[col.HeaderText for col in self.gridview.Columns]] if hasattr(self, 'gridview') else [[\"N\", \"Name\", \"Length\", \"Width\", \"Thickness\", \"Material\"]]\n        data.extend(self.spec.table)\n        filename = rs.SaveFileName(\"Save cutlist as\", \"CSV File (*.csv)|*.csv||\")\n        if filename:\n            with open(filename, 'w') as f:\n                for row in data:\n                    f.write(\"|\".join(str(item) for item in row) + \"\\n\")\n\n    def setData(self, spec):\n        self.spec = spec\n        \n        # Create the table layout\n        table = self.create_table(spec)\n        \n        # Create a row for the button with None spacers for centering\n        button_row = forms.TableLayout()\n        button_row.Spacing = drawing.Size(5, 5)\n        button_row_layout = forms.TableRow()\n        button_row_layout.Cells.Add(None)  # Left spacer\n        button_row_layout.Cells.Add(forms.TableCell(self.button, False))  # Button in center\n        button_row_layout.Cells.Add(None)  # Right spacer\n        button_row.Rows.Add(button_row_layout)\n        button_row.Rows.Add(None)  # Bottom spacer\n        \n        # Set up main layout\n        layout = forms.DynamicLayout()\n        layout.Add(table)\n        layout.Add(button_row)\n        \n        self.Content = layout\n\ndef main():\n    objs = rs.GetObjects(\"Select polysurface objects\", 16, preselect=True)\n    if not objs:\n        return\n\n    filtered_objs = [obj for obj in objs if rs.ObjectLayer(obj) not in EXCLUDED_LAYERS]\n    if not filtered_objs:\n        rs.MessageBox(\"No valid objects found.\")\n        return\n\n    details = [Detail(obj) for obj in filtered_objs]\n    spec = Specification(details)\n    dialog = SimpleCutlistDialog()\n    dialog.setData(spec)\n    Rhino.UI.EtoExtensions.ShowSemiModal(dialog, Rhino.RhinoDoc.ActiveDoc, Rhino.UI.RhinoEtoApp.MainWindow)\n\nif __name__ == \"__main__\":\n    main()",
      "language": "python",
      "author": "michaelvollrath",
      "post_number": 2,
      "is_solution": false
    },
    {
      "code": "#!/usr/bin/env ironpython2.7\n# -*- coding: utf8 -*-\n# SimpleCutlist.py\n\nimport Rhino\nimport Rhino.Geometry as g\nimport rhinoscriptsyntax as rs\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\nimport scriptcontext\n\n# List of layers to exclude\nEXCLUDED_LAYERS = [\"Booleans\", \"Dim\", \"Default\", \"Walls\"]\n\n# Attributes for the cutlist\nclass attr:\n    def __init__(self, name, isEditable, valType):\n        self.name = name\n        self.isEditable = isEditable\n        self.valType = valType\n\nATTRS = (\n    attr(\"_N\", True, str),        # N (number)\n    attr(\"_Name\", True, str),     # Name\n    attr(\"Length\", True, float),  # Length\n    attr(\"Width\", True, float),   # Width\n    attr(\"Thickness\", True, float), # Thickness\n    attr(\"Material\", True, str),  # Material\n)\n\ndef computeDims(obj):\n    objRef = Rhino.DocObjects.ObjRef(obj)\n    brep = objRef.Geometry()\n    edges = list(brep.Edges)\n    edges.sort(key=lambda edge: edge.GetLength(), reverse=True)\n    edge = edges[0]\n    origin = edge.PointAtStart\n    xPoint = edge.PointAtEnd\n    xVec = Rhino.Geometry.Vector3d(xPoint - origin)\n    xVec.Unitize()\n    face = brep.Faces[0]\n    yVec = Rhino.Geometry.Vector3d.CrossProduct(face.NormalAt(0, 0), xVec)\n    yVec.Unitize()\n    plane = Rhino.Geometry.Plane(origin, xVec, yVec)\n    verts = list(brep.Vertices)\n    tMatrix = g.Transform.ChangeBasis(g.Plane.WorldXY, plane)\n    map(lambda vert: vert.Transform(tMatrix), verts)\n    verts = list(map(lambda vert: vert.Location, verts))\n    verts.sort(key=lambda vert: vert.X)\n    length = verts[-1].X - verts[0].X\n    verts.sort(key=lambda vert: vert.Y)\n    width = verts[-1].Y - verts[0].Y\n    verts.sort(key=lambda vert: vert.Z)\n    thickness = verts[-1].Z - verts[0].Z\n    return [length, width, thickness]\n\nclass Detail:\n    def __init__(self, obj):\n        self.obj = obj\n        self.id = obj\n        for attr_obj in ATTRS:\n            key = attr_obj.name\n            val = rs.GetUserText(str(obj), key)\n            if val is None:\n                default = \"0\" if attr_obj.valType in [float, str] and key != \"Material\" else \"\"\n                setattr(self, key, default)\n                rs.SetUserText(str(obj), key, default)\n            else:\n                setattr(self, key, val)\n        self.setDims()\n        self.update_material_from_layer()\n\n    def setDims(self):\n        dims = computeDims(self.obj)\n        self.Length = str(round(dims[0], 2))\n        self.Width = str(round(dims[1], 2))\n        self.Thickness = str(round(dims[2], 2))\n        rs.SetUserText(str(self.id), \"Length\", self.Length)\n        rs.SetUserText(str(self.id), \"Width\", self.Width)\n        rs.SetUserText(str(self.id), \"Thickness\", self.Thickness)\n\n    def update_material_from_layer(self):\n        objRef = Rhino.DocObjects.ObjRef(self.id)\n        index = objRef.Object().Attributes.LayerIndex\n        layer = scriptcontext.doc.Layers[index]\n        self.Material = layer.Name\n        self.layer_color = drawing.Color.FromArgb(layer.Color.ToArgb())\n        rs.SetUserText(str(self.id), \"Material\", self.Material)\n\n    def getParams(self):\n        return [getattr(self, attr.name) for attr in ATTRS]\n\n    def refresh(self):\n        for attr in ATTRS:\n            rs.SetUserText(str(self.id), attr.name, getattr(self, attr.name))\n\nclass Specification:\n    def __init__(self, details):\n        self.details = []\n        idSet = set(range(len(details)))\n        self.table = []\n        while idSet:\n            curId = idSet.pop()\n            curDet = details[curId]\n            curDetails = [curDet]\n            for id in list(idSet):\n                if curDet.getParams() == details[id].getParams():\n                    curDetails.append(details[id])\n                    idSet.remove(id)\n            self.details.append(curDetails)\n            self.table.append(curDet.getParams())\n\nclass SimpleCutlistDialog(forms.Dialog[bool]):\n    def __init__(self):\n        self.Title = \"Simple Cutlist\"\n        self.Padding = drawing.Padding(2)\n        self.Resizable = True\n        self.m_gridview = forms.GridView()\n        self.m_gridview.ShowHeader = True\n\n        for i, attr in enumerate(ATTRS):\n            column = forms.GridColumn()\n            column.HeaderText = attr.name if attr.name[0] != \"_\" else attr.name[1:]\n            column.Editable = attr.isEditable\n            column.DataCell = forms.TextBoxCell(i)\n            self.m_gridview.Columns.Add(column)\n\n        self.button = forms.Button(Text=\"Export CSV\")\n        self.button.Width = 80  # Set a smaller, specific width\n        self.button.Click += self.buttonClick\n\n        layout = forms.DynamicLayout()\n        layout.AddRow(self.m_gridview)\n        layout.AddRow(self.button)\n        self.Content = layout\n        self.ClientSize = drawing.Size(600, 130)\n\n    def buttonClick(self, sender, e):\n        data = [[col.HeaderText for col in self.m_gridview.Columns]]\n        data.extend(self.spec.table)\n        filename = rs.SaveFileName(\"Save cutlist as\", \"CSV File (*.csv)|*.csv||\")\n        if filename:\n            with open(filename, 'w') as f:\n                for row in data:\n                    f.write(\"|\".join(str(item) for item in row) + \"\\n\")\n\n    def setData(self, spec):\n        self.spec = spec\n        self.m_gridview.DataStore = spec.table\n\ndef main():\n    objs = rs.GetObjects(\"Select polysurface objects\", 16, preselect=True)\n    if not objs:\n        return\n\n    filtered_objs = [obj for obj in objs if rs.ObjectLayer(obj) not in EXCLUDED_LAYERS]\n    if not filtered_objs:\n        rs.MessageBox(\"No valid objects found.\")\n        return\n\n    details = [Detail(obj) for obj in filtered_objs]\n    spec = Specification(details)\n    dialog = SimpleCutlistDialog()\n    dialog.setData(spec)\n    Rhino.UI.EtoExtensions.ShowSemiModal(dialog, Rhino.RhinoDoc.ActiveDoc, Rhino.UI.RhinoEtoApp.MainWindow)\n\nif __name__ == \"__main__\":\n    main()",
      "language": "python",
      "author": "Cumberland",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "boolean",
    "file-io",
    "geometry",
    "layers",
    "materials",
    "python",
    "rhinocommon",
    "rhinoscriptsyntax",
    "selection",
    "transformation",
    "ui"
  ],
  "has_accepted_answer": false,
  "category_id": 11,
  "posts_count": 3,
  "views": 137
}