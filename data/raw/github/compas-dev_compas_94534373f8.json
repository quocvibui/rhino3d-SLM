{
  "source_url": "https://github.com/compas-dev/compas/blob/HEAD/src/compas_rhino/layers.py",
  "repo": "compas-dev/compas",
  "repo_stars": 352,
  "repo_description": "Main library of the COMPAS framework and CAD integrations for Rhino/GH and Blender.",
  "license": "MIT",
  "filepath": "src/compas_rhino/layers.py",
  "instruction": "Layers",
  "code": "from __future__ import absolute_import\nfrom __future__ import division\nfrom __future__ import print_function\n\nfrom collections import deque\n\nimport rhinoscriptsyntax as rs  # type: ignore\nimport scriptcontext as sc  # type: ignore\n\nfind_object = sc.doc.Objects.Find\n\ntry:\n    purge_object = sc.doc.Objects.Purge\nexcept AttributeError:\n    purge_object = None\n\n\n# ==============================================================================\n# helpers\n# ==============================================================================\n\n\ndef show_hidden_objects_on_layer(name):\n    rs.ShowObjects([guid for guid in rs.HiddenObjects() if rs.ObjectLayer(guid) == name])\n\n\ndef find_objects_on_layer(name, include_hidden=True, include_children=True):\n    if include_hidden:\n        show_hidden_objects_on_layer(name)\n    to_delete = rs.ObjectsByLayer(name)\n    if include_children:\n        to_visit = deque(rs.LayerChildren(name))\n        while to_visit:\n            name = to_visit.popleft()\n            if include_hidden:\n                show_hidden_objects_on_layer(name)\n            to_delete += rs.ObjectsByLayer(name)\n            if rs.LayerChildCount(name):\n                to_visit.extend(rs.LayerChildren(name))\n    return to_delete\n\n\ndef delete_objects_on_layer(name, include_hidden=True, include_children=False, purge=True):\n    guids = find_objects_on_layer(name, include_hidden, include_children)\n    if purge and purge_object:\n        rs.EnableRedraw(False)\n        for guid in guids:\n            obj = find_object(guid)\n            if not obj:\n                continue\n            purge_object(obj.RuntimeSerialNumber)\n        rs.EnableRedraw(True)\n    else:\n        rs.DeleteObjects(guids)\n\n\n# ==============================================================================\n# create\n# ==============================================================================\n\n\ndef create_layers_from_path(path, separator=\"::\"):\n    \"\"\"Create a nested layer structure from a hierarchical path string.\n\n    Parameters\n    ----------\n    path : str\n        The path string.\n    separator : str, optional\n        Separator between components of the layer path.\n\n    Returns\n    -------\n    None\n\n    Examples\n    --------\n    The following snippet will created 3 nested layers,\n    with \"COMPAS\" at the root level, \"Datastructures\" at the first nested level, and \"Mesh\" at the deepest level.\n\n    * COMPAS\n      * Datastructures\n        * Mesh\n\n    .. code-block:: python\n\n        create_layers_from_path(\"COMPAS::Datastructures::Mesh\")\n\n    \"\"\"\n    names = path.split(separator)\n    parent = None\n    for name in names:\n        if parent:\n            name = parent + separator + name\n        if not rs.IsLayer(name):\n            rs.AddLayer(name)\n        parent = name\n\n\ndef create_layers_from_paths(names, separator=\"::\"):\n    \"\"\"Create nested layers from a lst of hierarchical path strings.\n\n    Parameters\n    ----------\n    names : list[str]\n        The path strings of the nested layer structures.\n    separator : str, optional\n        Separator between components of the layer path.\n\n    Returns\n    -------\n    None\n\n    Examples\n    --------\n    The following snippet will created 2 nested layer structures:\n\n    * COMPAS\n      * Datastructures\n        * Mesh\n        * Graph\n      * Geometry\n        * Point\n        * Vector\n\n    .. code-block:: python\n\n        create_layers_from_paths(\n            [\n                \"COMPAS::Datastructures::Mesh\",\n                \"COMPAS::Datastructures::Graph\",\n                \"COMPAS::Geometry::Point\",\n                \"COMPAS::Geometry::Vector\",\n            ]\n        )\n\n    \"\"\"\n    for name in names:\n        create_layers_from_path(name, separator=separator)\n\n\ndef create_layers_from_dict(layers):\n    \"\"\"Create Rhino layers from a dictionary.\n\n    Parameters\n    ----------\n    layers : dict[str, dict]\n        A dictionary of nested layer definitions.\n        The keys of the dict are the layer names.\n        The corresponding values define optional layer properties and nested layers.\n\n    Returns\n    -------\n    None\n\n    Examples\n    --------\n    .. code-block:: python\n\n        layers = {\n            \"COMPAS\",\n            {\n                \"layers\": {\n                    \"Datastructures\": {\"color\": (255, 0, 0), \"layers\": {\"Mesh\": {}, \"Graph\": {}}},\n                    \"Geometry\": {\"color\": (0, 0, 255), \"layers\": {\"Point\": {}, \"Vector\": {}}},\n                }\n            },\n        }\n\n        create_layers_from_dict(layers)\n\n    \"\"\"\n\n    def recurse(layers, parent=None):\n        for name in layers:\n            if not name:\n                continue\n            fullname = name\n            if parent:\n                fullname = parent + \"::\" + name\n            try:\n                attr = layers[name]\n            except TypeError:\n                attr = {}\n            attr = attr or {}\n            color = attr.get(\"color\", (0, 0, 0))\n            visible = attr.get(\"visible\", True)\n            locked = attr.get(\"locked\", False)\n            if not rs.IsLayer(fullname):\n                rs.AddLayer(fullname, color, visible, locked)\n            if \"layers\" in attr:\n                recurse(attr[\"layers\"], fullname)\n\n    rs.EnableRedraw(False)\n    recurse(layers)\n    rs.EnableRedraw(True)\n\n\ncreate_layers = create_layers_from_dict\n\n\n# ==============================================================================\n# clear\n# ==============================================================================\n\n\ndef clear_layer(name, include_hidden=True, include_children=True, purge=True):\n    \"\"\"Delete all objects of a layer.\n\n    Parameters\n    ----------\n    name : str\n        The full, hierarchical name of the layer.\n    include_hidden : bool, optional\n        If True, include all hidden objects.\n    include_children : bool, optional\n        If True, include the objects of child layers.\n    purge : bool, optional\n        If True, purge history after deleting.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    if not rs.IsLayer(name):\n        return\n    guids = find_objects_on_layer(name, include_hidden, include_children)\n    rs.EnableRedraw(False)\n    if purge and purge_object:\n        for guid in guids:\n            obj = find_object(guid)\n            if not obj:\n                continue\n            purge_object(obj.RuntimeSerialNumber)\n    else:\n        rs.DeleteObjects(guids)\n    rs.EnableRedraw(True)\n\n\ndef clear_current_layer():\n    \"\"\"Delete all objects from the current layer.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    layer = rs.CurrentLayer()\n    clear_layer(layer)\n\n\ndef clear_layers(layers, include_children=True, include_hidden=True, purge=True):\n    \"\"\"Delete the objects of the specified layers.\n\n    Parameters\n    ----------\n    layers : list[str]\n        A list of layer names as fully qualified hierarchical paths.\n    include_hidden : bool, optional\n        If True, include all hidden objects.\n    include_children : bool, optional\n        If True, include the objects of child layers.\n    purge : bool, optional\n        If True, purge history after deleting.\n\n    Returns\n    -------\n    None\n\n    \"\"\"\n    rs.EnableRedraw(False)\n    to_delete = []\n    for name in layers:\n        if rs.IsLayer(name):\n            to_delete += find_objects_on_layer(name, include_hidden, include_children)\n    if purge and purge_object:\n        for guid in to_delete:\n            obj = find_object(guid)\n            if not obj:\n                continue\n            purge_object(obj.RuntimeSerialNumber)\n    else:\n        rs.DeleteObjects(to_delete)\n    rs.EnableRedraw(True)\n\n\n# ==============================================================================\n# delete\n# ==============================================================================\n\n\ndef delete_layers(layers):\n    \"\"\"Delete layers and all contained objects.\n\n    Parameters\n    ----------\n    layers : dict or list[str]\n        When given as a list the list elements should be name of layers given\n        with ``\"::\"`` as a separator between hierarchies.\n        When provided as a dictionary, keys represent layer names, and values are dictionaries defining optional nested layers.\n\n    Returns\n    -------\n    None\n\n    Examples\n    --------\n    .. code-block:: python\n\n        layers = {\"COMPAS\": {\"layers\": {\"Datastructures\": {\"layers\": {\"Mesh\": {}, \"Graph\": {}}}}}}\n\n        create_layers(layers)\n\n        delete_layers([\"COMPAS::Datastructures::Graph\"])\n        delete_layers({\"COMPAS\": {\"layers\": {\"Datastructures\": {\"layers\": {\"Mesh\": {}}}}}})\n\n    \"\"\"\n    to_delete = []\n\n    def recurse(layers, parent=None):\n        for name in layers:\n            if not name:\n                continue\n            fullname = name\n            if parent:\n                fullname = parent + \"::\" + name\n            try:\n                attr = layers[name]\n            except TypeError:\n                attr = {}\n            if \"layers\" in attr:\n                recurse(attr[\"layers\"], fullname)\n            to_delete.append(fullname)\n\n    rs.EnableRedraw(False)\n    recurse(layers)\n\n    for layer in to_delete:\n        if rs.IsLayer(layer):\n            if rs.IsLayerCurrent(layer):\n                print(\"Can't delete {} as it is the current layer\".format(layer))\n                continue\n\n            rs.PurgeLayer(layer)\n\n    rs.EnableRedraw(True)\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}