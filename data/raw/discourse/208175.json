{
  "source_url": "https://discourse.mcneel.com/t/update-gh-panel-through-python/208175",
  "topic_id": 208175,
  "title": "Update GH panel through python",
  "question": "Hi,\n\n\nI have a database in a GH panel. I want to be able to update the database through an ETO form dialogue, where the updated database needs to replace the old database with, on the exact same  GH panel.\n\n\nI dont want to find the panel through “ghenv.Component.OnPingDocument().Objects” like most of the examples on the forum since my actual script has extreme amount of panels. But is it even possible?\n\n\nI am able to read the GH panel into the ETO form but I cant seem to update the GH panel after I have sent the data from the ETO form. I am still new to python scripting.\n\n\nGH panel updater.gh\n (8.5 KB)\n\n\nimage\n1565×815 64.4 KB\n\n\nimport rhinoscriptsyntax as rs\nimport Grasshopper as gh\nimport scriptcontext as sc\nimport Rhino as rc\nimport System\nimport Rhino.UI as rui\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\n# -*- coding: utf-8 -*-\n\nif run:\n    # lookup GH-component and save\n    ghlink = ghenv.Component.Params.Output[1].Recipients[0].Attributes.GetTopLevel.Owner\n    target = ghlink.Params.Input[0].Sources[0].Sources[0]\n    \n    currentDB = target.UserText\n    print currentDB #Check that database comes through\n    \n    \n    class ShowDatabaseUpdater(forms.Dialog[bool]):\n        \n        # Dialog box Class initializer\n        def __init__(self):\n            \n            # Initialize dialog box\n            self.Title = 'Database Updater'\n            self.Padding = drawing.Padding(10)\n            self.Resizable = True\n            \n            # Create controls for the dialog\n            self.m_label = forms.Label()\n            self.m_label.Text = 'Look at current database and update if wrong'\n            self.m_textarea = forms.TextArea()\n            self.m_textarea.Text = currentDB\n            \n            # Create the default button\n            self.DefaultButton = forms.Button()\n            self.DefaultButton.Text ='Change'\n            self.DefaultButton.Click += self.OnOKButtonClick\n            \n            # Create the close button\n            self.Clos...",
  "code_blocks": [
    {
      "code": "import rhinoscriptsyntax as rs\nimport Grasshopper as gh\nimport scriptcontext as sc\nimport Rhino as rc\nimport System\nimport Rhino.UI as rui\nimport Eto.Drawing as drawing\nimport Eto.Forms as forms\n# -*- coding: utf-8 -*-\n\nif run:\n    # lookup GH-component and save\n    ghlink = ghenv.Component.Params.Output[1].Recipients[0].Attributes.GetTopLevel.Owner\n    target = ghlink.Params.Input[0].Sources[0].Sources[0]\n    \n    currentDB = target.UserText\n    print currentDB #Check that database comes through\n    \n    \n    class ShowDatabaseUpdater(forms.Dialog[bool]):\n        \n        # Dialog box Class initializer\n        def __init__(self):\n            \n            # Initialize dialog box\n            self.Title = 'Database Updater'\n            self.Padding = drawing.Padding(10)\n            self.Resizable = True\n            \n            # Create controls for the dialog\n            self.m_label = forms.Label()\n            self.m_label.Text = 'Look at current database and update if wrong'\n            self.m_textarea = forms.TextArea()\n            self.m_textarea.Text = currentDB\n            \n            # Create the default button\n            self.DefaultButton = forms.Button()\n            self.DefaultButton.Text ='Change'\n            self.DefaultButton.Click += self.OnOKButtonClick\n            \n            # Create the close button\n            self.CloseButton = forms.Button()\n            self.CloseButton.Text ='Cancel'\n            self.CloseButton.Click += self.OnCloseButtonClick\n            \n            # Create a table layout and add all the controls\n            layout = forms.DynamicLayout()\n            layout.Spacing = drawing.Size(5, 5)\n            layout.AddRow(self.m_label)\n            layout.AddRow(None) # spacer\n            layout.AddRow(self.m_textarea)\n            layout.AddRow(None) # spacer\n            layout.AddRow(self.DefaultButton)\n            layout.AddRow(self.CloseButton)\n            \n            # Create the dialog content\n            self.Content = layout\n            \n        ## Start of the class functions\n        \n        # Get the value of the textbox\n        def GetText(self):\n            return self.m_textarea.Text\n        \n        # OK button click handler\n        def OnOKButtonClick(self, sender, e):\n            if self.m_textarea.Text == currentDB:\n                self.Close(False)\n            else:\n                self.Close(True)\n        \n        # Close button click handler\n        def OnCloseButtonClick(self, sender, e):\n            self.Close(False)\n        \n        ## End of Dialog Class ##\n    \n    def RequestDataBaseUpdater():\n        dialog = ShowDatabaseUpdater();\n        popup = dialog.ShowModal(rui.RhinoEtoApp.MainWindow);\n        print dialog.GetText()\n        \n        if popup:\n            if type(target) is gh.Kernel.Special.GH_Panel: \n                updatedDB = '\\r\\n'.join(map(str, dialog.GetText()))\n                target.Usertext = updatedDB\n                target.ExpireSolution(True)\n    \n##########################################################################\n# Check to see if this file is being executed as the \"main\" python\n# script instead of being used as a module by some other python script\n# This allows us to use the module which ever way we want.\n    if __name__ == \"__main__\":\n        RequestDataBaseUpdater()",
      "language": "python",
      "author": "NECH",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "geometry",
    "grasshopper",
    "python",
    "rhinoscriptsyntax"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 2,
  "views": 83
}