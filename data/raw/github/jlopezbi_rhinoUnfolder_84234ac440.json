{
  "source_url": "https://github.com/jlopezbi/rhinoUnfolder/blob/37abb2c4d2a464e62dbdbb0bde72491dcbfd7343/rhino_unwrapper/cutSelection/userCuts.py",
  "repo": "jlopezbi/rhinoUnfolder",
  "repo_stars": 8,
  "repo_description": "unwrap meshes in rhino!",
  "license": "GPL-3.0",
  "filepath": "rhino_unwrapper/cutSelection/userCuts.py",
  "instruction": "User cuts",
  "code": "import Rhino\nimport rhinoscriptsyntax as rs\nimport scriptcontext\nimport System.Drawing\nimport System.Array\nimport math\n\n#def all_weight_functions():\n#    return dict([m for m in inspect.getmembers(wf, inspect.isfunction)])\n\ndef apply_user_cuts(rMesh,key,cutlist):\n    '''\n    stores cutList in the given rMesh, in a dictionary with key\n    '''\n    rMesh.UserDictionary.Set(key,System.Array[int](cutlist))\n\ndef get_user_cuts(myMesh,meshDisplayer):\n    #NOTE: thinking about where this function should reside\n    #TODO: avoid click-throughs.\n    display = True # show selected cut edges\n    edges = myMesh.get_set_of_edges()\n    cuts = set()\n    color = (0, 255, 0, 255)\n    isChain = False\n    angleTolerance = math.radians(30)  # inital defautl value\n    drawnEdges = {}\n    while True:\n        edgeIdx, isChain, angleTolerance, mesh = getMeshEdge(\n            \"select cut edge on mesh\", isChain, angleTolerance)\n\n        if edgeIdx is None:\n            #print(\"esc: edgeIDx is NONE\")\n            cuts = None\n            break\n\n        elif edgeIdx >= 0:\n            #print(\"selected: valid edgeIdx\")\n            if edgeIdx not in cuts:\n                if isChain:\n                    cuts.update(myMesh.getChain(edgeIdx,angleTolerance))\n                else:\n                    cuts.update([edgeIdx])\n            else:\n                if isChain:\n                    cuts.difference_update(myMesh.getChain(edgeIdx,angleTolerance))\n                else:\n                    cuts.difference_update([edgeIdx])\n\n                if len(drawnEdges) != 0:\n                    scriptcontext.doc.Objects.Delete(drawnEdges[edgeIdx], True)\n\n            if display:\n                for edgeIdx in drawnEdges.keys():\n                    scriptcontext.doc.Objects.Delete(drawnEdges[edgeIdx], True)\n\n                drawnEdges.update(meshDisplayer.display_edges(cuts,color))\n\n        elif edgeIdx == -1:\n            #print(\"enter:\")\n            print(\"set cuts\")\n            myMesh.set_cuts(list(cuts))\n            break\n    return cuts\n\ndef getMeshEdge(message, isChain, angle):\n    getter= Rhino.Input.Custom.GetObject()\n    getter.GeometryFilter = Rhino.DocObjects.ObjectType.MeshEdge\n    getter.SetCommandPrompt(message)\n    getter.AcceptNothing(True)\n\n    boolOption = Rhino.Input.Custom.OptionToggle(isChain, \"Off\", \"On\")\n    dblOption = Rhino.Input.Custom.OptionDouble(math.degrees(angle), 0, 180)\n\n    getter.AddOptionDouble(\"maxAngle\", dblOption)\n    getter.AddOptionToggle(\"chainSelect\", boolOption)\n\n    edgeIdx = None\n    mesh = None\n    while True:\n        getE =getter.Get()\n\n        if getE == Rhino.Input.GetResult.Object:\n            #TODO: figure out how to avoid selecting a obscured edge;\n            #maybe use rs.IsVisibleInView(object_id) function;\n            # add test line to doc, check if IsVisibleInView and if not\n            # delete it and continue the loop\n            objRef =getter.Object(0)\n            edgeIdx = GetEdgeIdx(objRef)\n            mesh = objRef.Mesh()\n\n        elif getE == Rhino.Input.GetResult.Option:\n            continue\n        elif getE == Rhino.Input.GetResult.Cancel:\n            print(\"hit ESC in getMeshEdge()\")\n            edgeIdx = None\n            break\n        elif getE == Rhino.Input.GetResult.Nothing:\n            print(\"hit ENTER in getMeshEdge()\")\n            edgeIdx = -1\n            break\n        break\n    scriptcontext.doc.Objects.UnselectAll()\n    getter.Dispose()\n\n    isChain = boolOption.CurrentValue\n    angle = math.radians(dblOption.CurrentValue)\n\n    return (edgeIdx, isChain, angle, mesh)\n\ndef GetEdgeIdx(objref):\n    # Rhino.DocObjects.ObjRef .GeometryComponentIndex to\n    # Rhino.Geometry.ComponentIndex\n    meshEdgeIndex = objref.GeometryComponentIndex\n\n    return meshEdgeIndex.Index\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}