{
  "source_url": "https://github.com/localcode/rhinopythonscripts/blob/34c5314a276e9d4d79a62da6bed96a8112552c2f/FileTools.py",
  "repo": "localcode/rhinopythonscripts",
  "repo_stars": 62,
  "repo_description": "A place to dump and share python scripts for use in McNeel's Rhino and Grasshopper",
  "license": "unknown",
  "filepath": "FileTools.py",
  "instruction": "File tools",
  "code": "import os\nimport sys\n\nimport System\nimport System.Collections.Generic as SCG\n\nimport Rhino\nfrom Rhino.FileIO import FileWriteOptions, FileReadOptions\nimport scriptcontext\nimport rhinoscriptsyntax as rs\n\nimport xlrd\nimport LayerTools\n\ndef xlsToObjs(filePath, headers=True):\n    '''converts xls rows to a list of dictionaries. first row headers become\n    the attribute names.'''\n    wb = xlrd.open_workbook(filePath)\n    sheet = wb.sheet_by_index(0)\n    if headers:\n        # get the first row\n        head = sheet.row_values(0)\n        objs = []\n        # get the rows\n        for r in range(sheet.nrows - 1):\n            r += 1 # shift down a row\n            obj = {}\n            vals = sheet.row_values(r)\n            for c, v in enumerate(vals):\n                # lookup key by column index\n                obj[head[c]] = v\n            objs.append(obj)\n        return objs\n\ndef exportFile(filePath,\n        version=4,\n        geomOnly=False,\n        selectedOnly=False,\n        ):\n    '''Export a file.'''\n    opt = FileWriteOptions()\n    opt.FileVersion = version\n    opt.WriteGeometryOnly = geomOnly\n    opt.WriteSelectedObjectsOnly = selectedOnly\n    return scriptcontext.doc.WriteFile(filePath, opt)\n\ndef importFiles(filePathList):\n    '''Import a list of files'''\n    opt = FileReadOptions()\n    opt.ImportMode = True\n    for f in filePathList:\n        #print 'Importing %s' % f\n        scriptcontext.doc.ReadFile(f, opt)\n\ndef silentImport(filePathList):\n    \"\"\"Takes one or more file paths and returns RhinoCommon\n    File3dm objects for each file, if they exist. Returns an empty\n    list if no file is found.\n    \"\"\"\n    models = []\n    if type(filePathList) == str: # assume it's one path\n        filePathList = [filePathList]\n    for f in filePathList:\n        model = Rhino.FileIO.File3dm.Read(f)\n        if not model: continue\n        models.append(model)\n    return models\n\ndef modelsToLayerGeometryDict(models):\n    out = {}\n    for m in models:\n        for layer in m.Layers:\n            name = layer.Name\n            out[name] = []\n            objs = m.Objects.FindByLayer(name)\n            for obj in objs:\n                geom = obj.Geometry\n                geom.EnsurePrivateCopy()\n                out[name].append(geom)\n        m.Dispose()\n    return out\n\ndef fileGeometryDict(fileNames):\n    models = silentImport(fileNames)\n    return modelsToLayerGeometryDict(models)\n\ndef importFile(filePath):\n    '''import one file.'''\n    importFiles([filePath])\n\ndef deleteAll():\n    \"\"\"Deletes everything in the current Rhino scriptcontext.doc. Returns nothing.\"\"\"\n    guidList = []\n    objType = Rhino.DocObjects.ObjectType.AnyObject\n    objTable = scriptcontext.doc.Objects\n    objs = objTable.GetObjectList(objType)\n    for obj in objs:\n        guidList.append(obj.Id)\n    for guid in guidList:\n        objTable.Delete(guid, True)\n\ndef importLayers(filePaths, layerNames):\n    '''Input a list of filePaths and a list of layerNames, in order to import all the\n    files and return a list of RhinoObjects on each layer, in corresponding layers.\n    Layers that do not exist or contain no objects will return empty lists.'''\n    outObjs = []\n    importFiles(filePaths)\n    for ln in layerNames:\n        objs = scriptcontext.doc.Objects.FindByLayer(ln)\n        outObjs.append(objs)\n    return outObjs\n\ndef importLayerGeometryDict(filePaths, layerNames=None, silent=True):\n    '''Input a list of filePaths and a list of layerNames, in order to import all the\n    files and return a list of RhinoObjects on each layer, in corresponding layers.\n    Layers that do not exist or contain no objects will return empty lists.'''\n    outObjs = []\n    importFiles(filePaths)\n    if not layerNames:\n        layerNames = []\n        # get all the layers\n        lyrTable = scriptcontext.doc.Layers\n        for lyr in lyrTable:\n            layerNames.append(lyr.FullPath)\n    for ln in layerNames:\n        objs = scriptcontext.doc.Objects.FindByLayer(ln)\n        if objs:\n            outObjs.append([obj.Geometry for obj in objs])\n        else:\n            outObjs.append([])\n    return dict(zip(layerNames, outObjs))\n\ndef importSmartLayerDict(filePaths, layerNames):\n    '''Input a list of filePaths and a list of layerNames, in order to import all the\n    files and return a list of SmartFeatures corresponding to each layer.\n    Layers that do not exist or contain no objects will return empty lists.'''\n    importFiles(filePaths)\n    outFeatures = []\n    for ln in layerNames:\n        features = LayerTools.getLayerSmartFeatures(ln)\n        outFeatures.append(features)\n    return dict(zip(layerNames, outFeatures))\n\ndef exportLayers(layerNames, filePath, version=4):\n    '''Export only the items on designated layers to a file.'''\n    # save selection\n    oldSelection = rs.SelectedObjects()\n    # clear selection\n    rs.UnselectAllObjects()\n    # add everything on the layers to selection\n    for name in layerNames:\n        objs = scriptcontext.doc.Objects.FindByLayer(name)\n        guids = [obj.Id for obj in objs]\n        scriptcontext.doc.Objects.Select.Overloads[SCG.IEnumerable[System.Guid]](guids)\n    # export selected items\n    exportFile(filePath, version, selectedOnly=True)\n    #clear selection\n    rs.UnselectAllObjects()\n    # restore selection\n    if oldSelection:\n        scriptcontext.doc.Objects.Select.Overloads[SCG.IEnumerable[System.Guid]](oldSelection)\n    #print 'exported %s' % filePath\n\n",
  "language": "python",
  "imports": [
    "Rhino",
    "RhinoCommon",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": false
}