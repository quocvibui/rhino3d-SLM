{
  "source_url": "https://github.com/ENZYME-APD/tapir-archicad-automation/blob/3cc4d67228a62381d6cf7d9c0c3897171044ace2/sandbox/grasshopper-plugin/src/tapir.py",
  "repo": "ENZYME-APD/tapir-archicad-automation",
  "repo_stars": 94,
  "repo_description": "The easiest way to use the JSON/Python API from Archicad without knowing how to code.",
  "license": "MIT",
  "filepath": "sandbox/grasshopper-plugin/src/tapir.py",
  "instruction": null,
  "code": "#!/usr/bin/env python27\n# -*- coding: utf-8 -*-\n\n__all__ = [\"Plugin\", \"RhinoWrapper\", \"Factory\"]\n\n# - - - - - - - - BUILT-IN IMPORTS\nimport System, traceback\nimport base64\n\n# - - - - - - - - LOCAL IMPORTS\nfrom tapir_py import parts, utility\n\n# - - - - - - - - RH/GH IMPORTS\nimport Rhino, Grasshopper, GhPython\n\n# - - - - - - - - GLOBAL VARIABLES\nPlugin = utility.RuntimeObject( { \"is_active\" : False, \"Archicad\" : None }, \"TapirPlugin\")\n\n# - - - - - - - - DECORATORS\ndef connect(function):\n    def wrapper(*args, **kwargs):\n        if Plugin.is_active:\n            return function(*args, **kwargs)\n        else:\n            args[0].AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Warning, \"Plugin Disconnected!\")\n    return wrapper\n\ndef debug(function):    \n    def wrapper(*args, **kwargs):\n        try:\n            return function(*args, **kwargs)\n        except Exception as ex:\n            System.Windows.Forms.MessageBox.Show(traceback.format_exc(), str(ex))\n            args[0].AddRuntimeMessage(Grasshopper.Kernel.GH_RuntimeMessageLevel.Error, str(ex))\n        return wrapper\n\n# - - - - - - - - CLASS LIBRARY\nclass AssemblyInfo(GhPython.Assemblies.PythonAssemblyInfo):\n    \n    def get_AssemblyName(self):\n        return \"tAPIr\"\n    \n    def get_AssemblyDescription(self):\n        return \"\"\"Grasshopper components to access ArchiCAD via JSON API.\"\"\"\n\n    def get_AssemblyVersion(self):\n        return \"1.0.9\"\n\n    def get_AuthorName(self):\n        return \"EnzymeAPD\"\n    \n    def get_Id(self):\n        return System.Guid(\"54b11162-627b-455b-b9c0-963e76b36dc7\")\n\nclass RhinoWrapper(object):\n\n    @staticmethod\n    def BoundingBox(boundingBoxes):\n\n        success = True\n        message = \"\"\n        rhino_boxes = []\n        for bBox in list(boundingBoxes):\n\n            if isinstance(bBox, parts.BoundingBox):\n                X = Rhino.Geometry.Interval(*bBox.x)\n                Y = Rhino.Geometry.Interval(*bBox.y)\n                Z = Rhino.Geometry.Interval(*bBox.z)\n            \n                box = Rhino.Geometry.Box(Rhino.Geometry.Plane.WorldXY, X, Y, Z)\n                rhino_boxes.append(box)\n            else:\n                success = False\n                message = \"Some inputs were skipped.\"\n\n        return success, message, rhino_boxes\n\nclass Factory(object):\n\n    @staticmethod\n    def create_button(component, param_index, name, x_offset=27, y_offset=11):\n        source_input = component.Params.Input[param_index]\n        component_width_delta = component.Attributes.Bounds.Width * 0.5\n\n        # Create new Button component\n        source_pivot = component.Attributes.Pivot\n        new_button = Grasshopper.Kernel.Special.GH_ButtonObject()\n\n        # Add component to current Grasshopper Document\n        doc = component.OnPingDocument()\n        doc.AddObject(new_button, False, doc.ObjectCount + 1)\n\n        new_button.Name = name\n        new_button.NickName = name\n        new_button.Attributes.Pivot = System.Drawing.PointF(source_pivot.X - component_width_delta - x_offset, source_pivot.Y - y_offset)\n\n        # Connect Value List to component\n        source_input.AddSource(new_button)\n        new_button.ExpireSolution(True)\n\n        return new_button\n\n    @staticmethod\n    def create_value_list(component, param_index, name, items, x_offset=27, y_offset=11):\n        source_input = component.Params.Input[param_index]\n        component_width_delta = component.Attributes.Bounds.Width * 0.5\n\n        # Create new Value List component\n        source_pivot = component.Attributes.Pivot\n        new_value_list = Grasshopper.Kernel.Special.GH_ValueList()\n        \n        # Add component to current Grasshopper Document\n        doc = component.OnPingDocument()\n        doc.AddObject(new_value_list, False, doc.ObjectCount + 1)\n\n        new_value_list.Name = name\n        new_value_list.NickName = name\n        new_value_list.Attributes.Pivot = System.Drawing.PointF(source_pivot.X - component_width_delta - x_offset, source_pivot.Y - y_offset)\n        new_value_list.ListItems.Clear()\n\n        # Populate list\n        Factory.update_value_list(new_value_list, items)\n\n        # Connect Value List to component\n        source_input.AddSource(new_value_list)\n        new_value_list.ExpireSolution(True)\n\n        return new_value_list\n\n    @staticmethod\n    def update_value_list(component, items):\n        if isinstance(component, Grasshopper.Kernel.Special.GH_ValueList):\n            component.ListItems.Clear()\n            for item in items:\n                list_item = Grasshopper.Kernel.Special.GH_ValueListItem(str(item), '\"{}\"'.format(item))\n                component.ListItems.Add(list_item)\n            return True\n        else:\n            return False\n\n# ----- UTILLITIES\ndef ico2base64(ico_file):\n    \"\"\"\n    Converts icon image to base64 string \n    to be used by get_internal_Icon_24x24 method\n    \"\"\"\n    with open(ico_file, \"rb\") as image_file:\n        encoded_string = base64.b64encode(image_file.read())\n        image_file.close()\n    return encoded_string\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": false
}