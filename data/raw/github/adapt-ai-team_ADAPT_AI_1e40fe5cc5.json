{
  "source_url": "https://github.com/adapt-ai-team/ADAPT_AI/blob/5de8b42c4f4d4ad35cbd8e79588fc6e869398bc4/spz_analysis2/convert_glb_to_3dm.py",
  "repo": "adapt-ai-team/ADAPT_AI",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "spz_analysis2/convert_glb_to_3dm.py",
  "instruction": "Convert glb to 3dm",
  "code": "import rhino3dm\nimport trimesh\nimport numpy as np\nimport os\n\n# üìÇ Define file paths\nINPUT_GLB_PATH = r\"D:\\spz_pipeline\\pipeline_outputs\\example_image.glb\"  # ‚úÖ Ensure correct input file\nOUTPUT_3DM_PATH = r\"D:\\spz_pipeline\\pipeline_outputs\\example_image.3dm\"  # ‚úÖ Ensure correct output file\n\ndef convert_glb_to_3dm(glb_path, output_3dm_path):\n    # üîç Check if input file exists\n    if not os.path.exists(glb_path):\n        print(f\"‚ùå Error: Input file `{glb_path}` not found!\")\n        return\n    \n    print(f\"üîÑ Converting `{glb_path}` ‚Üí `{output_3dm_path}`...\")\n    \n    try:\n        # Load the .glb file\n        scene = trimesh.load(glb_path)\n\n        # Create a new Rhino 3DM file\n        model = rhino3dm.File3dm()\n\n        # Process each mesh in the scene\n        for mesh_name, geometry in scene.geometry.items():\n            print(f\"Processing mesh: {mesh_name}\")\n\n            # Convert trimesh mesh to Rhino mesh\n            rhino_mesh = rhino3dm.Mesh()\n\n            # Add vertices with Y-Z axis swap\n            vertices = geometry.vertices.copy()\n            vertices[:, [1, 2]] = vertices[:, [2, 1]]  # Swap Y and Z coordinates (GLB Y-up ‚Üí Rhino Z-up)\n\n            # Add transformed vertices to Rhino mesh\n            for vertex in vertices:\n                rhino_mesh.Vertices.Add(float(vertex[0]), float(vertex[1]), float(vertex[2]))\n\n            # Add faces\n            for face in geometry.faces:\n                if len(face) == 3:\n                    rhino_mesh.Faces.AddFace(int(face[0]), int(face[2]), int(face[1]))  # Reverse orientation\n                elif len(face) == 4:\n                    rhino_mesh.Faces.AddFace(int(face[0]), int(face[3]), int(face[2]), int(face[1]))  # Reverse orientation for quads\n\n            # Compute mesh normals\n            rhino_mesh.Normals.ComputeNormals()\n            rhino_mesh.Compact()\n\n            # Add the mesh to the Rhino 3DM model\n            model.Objects.AddMesh(rhino_mesh)\n            print(f\"‚úÖ Added mesh with {len(rhino_mesh.Vertices)} vertices and {len(rhino_mesh.Faces)} faces\")\n\n        # Save the file\n        model.Write(output_3dm_path, 5)\n        print(f\"‚úÖ Conversion successful! Saved as `{output_3dm_path}`\")\n\n    except Exception as e:\n        print(f\"‚ùå Error during conversion: {str(e)}\")\n\n# üöÄ Run the conversion process\nif __name__ == \"__main__\":\n    convert_glb_to_3dm(INPUT_GLB_PATH, OUTPUT_3DM_PATH)\n",
  "language": "python",
  "imports": [
    "rhino3dm"
  ],
  "has_docstring": false
}