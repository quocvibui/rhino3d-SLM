{
  "source_url": "https://discourse.mcneel.com/t/unregistering-connected-input-param-in-python-component/176134",
  "topic_id": 176134,
  "title": "Unregistering connected input param in python component",
  "question": "hello!\n\n\nI am working on a component that adaptively adds and removes input parameters depending on an initial input. When I call \nUnregisterInputParameter()\n on a connected param, even with with the isolate bool set to True, I get an object expired during solution error in a popup. The dynamic registering and unregistering of inputs is otherwise working fine. I tried using the \nIGH_Param.IsolateObject()\n method to disconnect the param before unregistering, but that didnâ€™t work. The component takes a custom class with an \ninput_names\n attribute which looks like this:\n\n\nclass input(object):\n    def __init__(self):\n        self.input_names = [\"input 1\", \"input 2\"]\n    \na = input()\n\n\n\nor\n\n\nclass input(object):\n    def __init__(self):\n        self.input_names = [\"input 3\", \"input 4\"]\n    \na = input()\n\n\n\nHere is the component script itself:\n\n\nfrom ghpythonlib.componentbase import executingcomponent as component\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Error\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Warning\nimport Grasshopper\n\ndoc = Grasshopper.Instances.ActiveCanvas.Document\n\ndef add_GH_param(name, io, ghenv):  \n    \"\"\"Adds a parameter to the Grasshopper component. \"\"\"\n    assert io in (\"Output\", \"Input\")\n    params = [param.NickName for param in getattr(ghenv.Component.Params, io)]\n    if name not in params:\n        param = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        param.NickName = name\n        param.Name = name\n        param.Description = name\n        param.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        param.Optional = True\n        index = getattr(ghenv.Component.Params, io).Count\n        registers = dict(Input=\"RegisterInputParam\", Output=\"RegisterOutputParam\")\n        getattr(ghenv.Component.Params, registers[io])(param, index)\n\n\n\ndef clear_GH_params(ghenv, permanent_param_count=1):\n    \"\"\"Clears all input parameters from the component. \"\"\"\n    changed = False\n    while len(ghenv.Component.Params.Input) > permanent...",
  "code_blocks": [
    {
      "code": "from ghpythonlib.componentbase import executingcomponent as component\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Error\nfrom Grasshopper.Kernel.GH_RuntimeMessageLevel import Warning\nimport Grasshopper\n\ndoc = Grasshopper.Instances.ActiveCanvas.Document\n\ndef add_GH_param(name, io, ghenv):  \n    \"\"\"Adds a parameter to the Grasshopper component. \"\"\"\n    assert io in (\"Output\", \"Input\")\n    params = [param.NickName for param in getattr(ghenv.Component.Params, io)]\n    if name not in params:\n        param = Grasshopper.Kernel.Parameters.Param_GenericObject()\n        param.NickName = name\n        param.Name = name\n        param.Description = name\n        param.Access = Grasshopper.Kernel.GH_ParamAccess.item\n        param.Optional = True\n        index = getattr(ghenv.Component.Params, io).Count\n        registers = dict(Input=\"RegisterInputParam\", Output=\"RegisterOutputParam\")\n        getattr(ghenv.Component.Params, registers[io])(param, index)\n\n\n\ndef clear_GH_params(ghenv, permanent_param_count=1):\n    \"\"\"Clears all input parameters from the component. \"\"\"\n    changed = False\n    while len(ghenv.Component.Params.Input) > permanent_param_count:\n        ghenv.Component.Params.Input[len(ghenv.Component.Params.Input) - 1].IsolateObject()\n        ghenv.Component.Params.UnregisterInputParameter(\n            ghenv.Component.Params.Input[len(ghenv.Component.Params.Input) - 1],\n            True\n        )\n        changed = True\n    ghenv.Component.Params.OnParametersChanged()\n    return changed\n\n\ndef manage_dynamic_params(input_names, ghenv, permanent_param_count=1):\n    \"\"\"manages component input parameters. \"\"\"\n\n    if not input_names:  # if no names are input\n        return clear_GH_params(ghenv, permanent_param_count)\n\n    else:\n        register_params = False\n        if len(ghenv.Component.Params.Input) == len(input_names) + permanent_param_count:           #if param count matches input_names count\n            for i, name in enumerate(input_names):\n                if ghenv.Component.Params.Input[i + permanent_param_count].Name != name:            #if param names don't match\n                    register_params = True\n                    break\n        else:\n            register_params = True\n        if register_params:\n            clear_GH_params(ghenv, permanent_param_count)       #we could consider renaming params if we don't want to disconnect GH component inputs\n            for name in input_names:\n                add_GH_param(name, \"Input\", ghenv)\n            return True\n        else:\n            return False\n            \n\nclass DirectJointRule(component):\n    def RunScript(self, original_input, *args):\n        names = None\n        if original_input:\n            names = [name for name in original_input.input_names]\n\n        if manage_dynamic_params(names, ghenv):\n            ghenv.Component.Params.OnParametersChanged()\n            doc.ScheduleSolution(1)\n            return\n        \n        return args",
      "language": "python",
      "author": "OBucklin",
      "post_number": 1,
      "is_solution": false
    }
  ],
  "tags": [
    "file-io",
    "grasshopper",
    "python",
    "transformation"
  ],
  "has_accepted_answer": false,
  "category_id": 8,
  "posts_count": 8,
  "views": 495
}