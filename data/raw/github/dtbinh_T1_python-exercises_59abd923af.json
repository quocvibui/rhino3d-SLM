{
  "source_url": "https://github.com/dtbinh/T1_python-exercises/blob/f4710c3dc2ba8ddb3e3e9069ab8d65df674463ab/07_ur_online/shifted_frames_setup/compas/src/compas_rhino/ui/mouse.py",
  "repo": "dtbinh/T1_python-exercises",
  "repo_stars": 0,
  "repo_description": null,
  "license": "unknown",
  "filepath": "07_ur_online/shifted_frames_setup/compas/src/compas_rhino/ui/mouse.py",
  "instruction": null,
  "code": "from __future__ import print_function\n\ntry:\n    from Rhino.UI import MouseCallback\nexcept ImportError:\n    import platform\n    if platform.python_implementation() == 'IronPython':\n        raise\n\n    class MouseCallback(object):\n        pass\n\n\n__author__     = ['Tom Van Mele', ]\n__copyright__  = 'Copyright 2014, BLOCK Research Group - ETH Zurich'\n__license__    = 'MIT License'\n__email__      = 'vanmelet@ethz.ch'\n\n\n__all__ = ['Mouse', ]\n\n\nclass Mouse(MouseCallback):\n    \"\"\"\"\"\"\n    def __init__(self):\n        super(Mouse, self).__init__()\n        self.x  = None  # x-coordinate of 2D point in the viewport\n        self.y  = None  # y-coordinate of 2D point in the viewport\n        self.p1 = None  # start of the frustum line in world coordinates\n        self.p2 = None  # end of the frustum line in world coordinates\n\n    def OnMouseMove(self, e):\n        line    = e.View.ActiveViewport.ClientToWorld(e.ViewportPoint)\n        self.x  = e.ViewportPoint.X\n        self.y  = e.ViewportPoint.Y\n        self.p1 = line.From\n        self.p2 = line.To\n        e.View.Redraw()\n\n    def OnMouseDown(self, e):\n        pass\n\n    def OnMouseUp(self, e):\n        pass\n\n\n# ==============================================================================\n# Debugging\n# ==============================================================================\n\nif __name__ == '__main__':\n\n    from compas.geometry import distance_point_line\n\n    import System\n    from System.Drawing import Color\n\n    import Rhino\n    from Rhino.Geometry import Point3d\n\n    import rhinoscriptsyntax as rs\n\n    # calculate \"right angle distance\" from point to frustum line\n    # to check if mouse is hovering over that point\n    # the distance from a point P to a line defined by points A, B\n    # is twice the area of the trianlge ABP divided by the length of AB\n    # see: https://en.wikipedia.org/wiki/Distance_from_a_point_to_a_line\n    class Inspector(Rhino.Display.DisplayConduit):\n        \"\"\"\"\"\"\n\n        def __init__(self, points, tol=0.1):\n            super(Inspector, self).__init__()\n            self.mouse     = Mouse()\n            self.points    = points\n            self.tol       = tol\n            self.dotcolor  = Color.FromArgb(255, 0, 0)\n            self.textcolor = Color.FromArgb(0, 0, 0)\n\n        def DrawForeground(self, e):\n            p1  = self.mouse.p1\n            p2  = self.mouse.p2\n            for i, p0 in enumerate(self.points):\n                if distance_point_line(p0, (p1, p2)) < self.tol:\n                    e.Display.DrawDot(Point3d(*p0), str(i), self.dotcolor, self.textcolor)\n                    break\n\n    points = [[i, i, 0] for i in range(10)]\n\n    try:\n        inspector = Inspector(points)\n        inspector.mouse.Enabled = True\n        inspector.Enabled = True\n\n        # this interrupts the script until the user provides a string or escapes\n        rs.GetString(message='Do some hovering')\n\n    except Exception as e:\n        print(e)\n\n    finally:\n        inspector.mouse.Enabled = False\n        inspector.Enabled = False\n        del inspector.mouse\n        del inspector\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "rhinoscriptsyntax"
  ],
  "has_docstring": false
}