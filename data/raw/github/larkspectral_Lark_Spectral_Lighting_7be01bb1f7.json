{
  "source_url": "https://github.com/larkspectral/Lark_Spectral_Lighting/blob/56d03f6c41535e675bea5f9f7c36ded9b5f16ae6/Lark%20Calculation%20of%20RGB%20Irradiance%20From%20HDR%20Image.py",
  "repo": "larkspectral/Lark_Spectral_Lighting",
  "repo_stars": 3,
  "repo_description": "Lark Spectral Lighting",
  "license": "NOASSERTION",
  "filepath": "Lark Calculation of RGB Irradiance From HDR Image.py",
  "instruction": "Use this component to calculate RGB irradiance values from an HDR luminance image\n-\nProvided by Lark 3.0.0",
  "code": "# Get RGB irradiance values from an HDR luminance image \n\n# Lark Spectral Lighting (v0.0.1, v0.0.2 and v1.0) is a collaboration of University of Washington and ZGF Architects LLP\n# Authors Dr. Mehlika Inanici, Marty Brennan & Ed Clark\n# Lark v2.0 is a collaboration of EPFL, Oregon State University, and Eindhoven University of Technology\n# Authors Dr. Clotilde Pierson & Myrta Gkaintatzi-Masouti\n# Lark Spectral Lighting v3.0 is a collaboration of University of Washington and ZGF Architects LLP\n# Authors Bo Jung, Dr. Mehlika Inanici, Marty Brennan, and Zining Cheng \n# Copyright 2015-2022 University of Washington (Mehlika Inanici, Ph.D.) and ZGF Architects LLP\n# Copyright 2022 EPFL, Oregon State University (Clotilde Pierson, Ph.D.), and Eindhoven University of Technology (Myrta Gkaintatzi-Masouti, M.Sc.)\n# Copyright 2023 University of Washington (Bo Jung, M.Sc., Mehlika Inanici, Ph.D., Zining Cheng, M.Sc.) and ZGF Architects LLP\n# Licensed under The Modified 3-Clause BSD License (the \"License\");\n# You may obtain a copy of the License at\n# https://opensource.org/licenses/BSD-3-Clause\n\n# Component updated by Bo Jung for Lark v3.0 (2023-08-15):\n# Updated option to add where the text file for RGB values are saved (default is 'C:\\lark\\\\temp').\n\n\"\"\"\nUse this component to calculate RGB irradiance values from an HDR luminance image\n-\nProvided by Lark 3.0.0\n\n    Args:\n        picture: filepath to 3-channel HDR image\n        filename: optional name for the txt file containing RGB values\n        filepath: optional directory for the txt file containing RGB values\n    Returns:\n        out: warnings and errors\n        RGB_values: RGB values calculated from HDR image\n\"\"\"\n\n__author__ = \"Bo Jung\"\n__version__ = \"2023.08.15\"\n\nghenv.Component.Name = \"Lark Calculation of RGB Irradiance From HDR Image v3\"\nghenv.Component.NickName = 'RGB From HDR'\nghenv.Component.Message = '3.0.0'\nghenv.Component.Category = \"Lark\"\nghenv.Component.SubCategory = \"Point-in-time\"\n\nimport rhinoscriptsyntax as rs\nimport os\nimport re\nfrom subprocess import Popen\n\n\n\n#make lark directory if none exists\npath = 'C:\\lark\\\\temp'\nif os.path.isdir(path) != True: \n    os.makedirs(path)\nelse:\n    pass\npath_masks = 'C:\\lark'\nos.chdir(path)\n\nif filepath == None or []:        \n    filepath = path\n    \n\n#print out current directory\ncurrent_dir = filepath\n\n\n#check all inputs\nerror_list = []\ninputs = [picture]\ninputs_name = [\"picture\"]\n\nfor idx, val in enumerate (inputs):\n    if val == None or val == []:\n        error_list.append(inputs_name[idx])\n\nif len(error_list) != 0:\n    check = \"error\"\nelse:\n    check = 1\n\nif check == \"error\":\n    print \"Warning! Connect the following inputs:\" \n    print error_list\n\nif filename == None:        \n    filename = \"\"\n\n\n\n#extract RGB irradiance values from HDR image\nif check != \"error\":\n    extension = \"_RGBvalues.txt\"\n    name = \"%s%s\" %(filename,extension)\n\n    #Check view of masked HDR image\n    v1 =  \"vwright -vf \" + picture + \" V > \" +  \"vwr.cal\"\n    print(v1)\n\n    #Calculate the RGB values of the masked HDR image\n    v2 =  \"pcomb -h -f \"  +  filepath + \"vwr.cal\" + \" -e \" \"\"\" \"dot=Dx(1)*Vdx+Dy(1)*Vdy+Dz(1)*Vdz\" -e \"ro=if(dot,S(1)*dot*ri(1),0);go=if(dot,S(1)*dot*gi(1),0);bo=if(dot,S(1)*dot*bi(1),0)\" \"\"\" + \"-o \" + picture + \" | pvalue -h -H -df | total -if3 > \" + name\n\n    #Delete temporary file\n    tempdel1 = \"del *vwr* \"\n\n    #Create batch file\n    batch_loc = filepath + \"\\\\batchfile.bat\"\n    batch = open(batch_loc, \"w\")\n    batch.write(v1 + '\\n' * 3 + v2 + '\\n' * 3 + tempdel1)\n    batch.close()\n\n    #Run batch file\n    runbatch = Popen(\"batchfile.bat\", cwd=filepath)\n    stdout, stderr = runbatch.communicate()\n    #Print filepath to RGB values file\n    RGB_values = filepath + \"\\\\\" + name\n",
  "language": "python",
  "imports": [
    "rhinoscriptsyntax"
  ],
  "has_docstring": true
}