{
  "source_url": "https://github.com/fstwn/cockatoo/blob/d952ac5d2148ec29fba52e8eb75f0f43770c74ca/usrobj_src/Cockatoo_GeometryWatchDog.py",
  "repo": "fstwn/cockatoo",
  "repo_stars": 38,
  "repo_description": "Cockatoo is a prototypical open-source software toolkit for generating (3d-)knitting patterns from NURBS surface and mesh geometry directly inside Grasshopper.",
  "license": "MIT",
  "filepath": "usrobj_src/Cockatoo_GeometryWatchDog.py",
  "instruction": "Listens for changes in geometry and sends a True value if anything changes\n(this can be used to reset the Kangaroo Solver for example).\n    Inputs:\n        Geometry: This is the geometry that is...",
  "code": "\"\"\"\nListens for changes in geometry and sends a True value if anything changes\n(this can be used to reset the Kangaroo Solver for example).\n    Inputs:\n        Geometry: This is the geometry that is being watched for changes.\n                  {tree, geometry}\n        Enable: If True, the PipelineWatchdog is active. If false, it isn't.\n                Connect a Toggle to switch it on and off.\n                {item, boolean}\n    Outputs:\n        Reset: Triggers a True when anything has changed, otherwise false.\n               {item, boolean}\n    Remarks:\n        Author: Max Eschenbach\n        License: MIT License\n        Version: 2010105\n\"\"\"\n\n# GHPYTHON SDK IMPORTS\nfrom ghpythonlib.componentbase import executingcomponent as component\nimport Grasshopper, GhPython\nimport System\nimport Rhino\nimport rhinoscriptsyntax as rs\n\n# CUSTOM RHINO IMPORTS\nfrom scriptcontext import sticky as st\nfrom ghpythonlib import treehelpers as th\n\nghenv.Component.Name = \"GeometryWatchDog\"\nghenv.Component.NickName = \"GWD\"\nghenv.Component.Category = \"Cockatoo\"\nghenv.Component.SubCategory = \"01 Pipeline Controlling\"\n\nclass GeometryWatchDog(component):\n    \n    def updateComponent(self, geo, key):\n        # define callback action\n        def callBack(e):\n            st[key] = geo\n            self.ExpireSolution(False)\n        # get ghDoc\n        ghDoc = self.OnPingDocument()\n        # schedule new solution\n        ghDoc.ScheduleSolution(1, \n                   Grasshopper.Kernel.GH_Document.GH_ScheduleDelegate(callBack))\n    \n    def RunScript(self, Geometry, Enable):\n        \n        # preprocess geometry tree\n        Geometry.Flatten()\n        Geometry = th.tree_to_list(Geometry)\n        \n        # get instance guid and set sticky keys\n        ig = self.InstanceGuid\n        geo_key = str(ig) + \"_GWD_GEO\"\n        reset_key = str(ig) + \"_GWD_RESET\"\n        \n        # define initial condition\n        Reset = False\n        \n        if Enable and Geometry:\n            if geo_key not in st or reset_key not in st or st[reset_key] == True:\n                #print \"Setting geometry\"\n                st[geo_key] = Geometry\n                st[reset_key] = False\n                Reset = False\n                self.Message = str(Reset)\n            elif st[geo_key] != Geometry:\n                #print \"Reset!\"\n                Reset = True\n                st[reset_key] = True\n                self.Message = str(Reset)\n                self.updateComponent(Geometry, geo_key)\n            else:\n                Reset = False\n                st[reset_key] = False\n                self.Message = str(Reset)\n        else:\n            if not Enable:\n                self.Message = \"GeometryWatchdog disabled!\"\n            if not Geometry:\n                rml = self.RuntimeMessageLevel.Warning\n                rmsg = \"Input Geometry failed to collect Data!\"\n                self.Message = \"No Geometry to watch...\"\n                self.AddRuntimeMessage(rml, rmsg)\n        \n        # return outputs if you have them; here I try it for you:\n        return Reset\n",
  "language": "python",
  "imports": [
    "Rhino",
    "ghpythonlib",
    "rhinoscriptsyntax",
    "scriptcontext"
  ],
  "has_docstring": true
}