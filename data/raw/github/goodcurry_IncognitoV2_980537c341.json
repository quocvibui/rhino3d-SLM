{
  "source_url": "https://github.com/goodcurry/IncognitoV2/blob/14df6e9582299dfddaab5f82ddec7be4ec5d4e0d/incog/callbacks/scripts.py",
  "repo": "goodcurry/IncognitoV2",
  "repo_stars": 7,
  "repo_description": "Official and latest source code of IncognitoV2",
  "license": "unknown",
  "filepath": "incog/callbacks/scripts.py",
  "instruction": "Scripts",
  "code": "from rbx.instance import Instance\r\nfrom rbx.local_script import LocalScript\r\nfrom rbx.module_script import ModuleScript\r\nfrom rbx.object_value import ObjectValue\r\nfrom rbx.number_value import NumberValue\r\nfrom rbx.bindable_event import BindableEvent\r\nfrom rbx.script_context import ScriptContext, LuaState, ExtraSpace\r\nfrom rbx.utils import Utils\r\nfrom rbx.luau import Luau\r\n\r\nfrom exploit.instances import Instances\r\n\r\nluau_compile = Luau.compile\r\nluau_decompress = Luau.decompress\r\nto_embedded_code = Utils.to_embedded_code\r\n\r\ndef _convert_to_script(instance: Instance) -> LocalScript | ModuleScript:\r\n    script: Instance = instance\r\n    script_class: str = script.class_name\r\n\r\n    if script_class == \"LocalScript\":\r\n        script = LocalScript(script)\r\n    elif script_class == \"ModuleScript\":\r\n        script = ModuleScript(script)\r\n\r\n    return script\r\n\r\ndef _get_bindable_event_extraspace(bindable_event: BindableEvent) -> ExtraSpace:\r\n    bindable_event: BindableEvent = BindableEvent(bindable_event)\r\n    return bindable_event.first.impl.thread_ref.lua_state.extra_space\r\n\r\ndef getrenv(data):\r\n    loader: LocalScript = LocalScript(data[0])\r\n    holder: ModuleScript = ModuleScript(data[1])\r\n\r\n    loader.embedded_code = to_embedded_code(\"require(script.Holder)\")\r\n    holder.embedded_code = to_embedded_code(\"return function() end\")\r\n\r\n    return True\r\n\r\ndef getrunningscripts(data):\r\n    scripts_holder: ObjectValue = ObjectValue(data[0])\r\n    fetched_scripts_count: NumberValue = NumberValue(data[1])\r\n    script_context: ScriptContext = Instances.script_context\r\n\r\n    running_scripts: list[\"Instance\"] = []\r\n    if script_context is not None:\r\n        global_state = script_context.get_global_state(0)\r\n        for extra_space in Utils.get_extraspaces(global_state.state):\r\n            script = extra_space.script\r\n            if script is not None and script.address not in running_scripts:\r\n                running_scripts.append(script.address)\r\n\r\n    fetched_scripts_count.value = float(len(running_scripts))\r\n\r\n    if len(running_scripts) > 0:\r\n        while fetched_scripts_count.value > 0:\r\n            pass\r\n\r\n        for index, holder in enumerate(scripts_holder.get_children()):\r\n            holder: ObjectValue = ObjectValue(holder)\r\n            holder.value = running_scripts[index]\r\n\r\n    return True\r\n\r\ndef getscriptbytecode(data):\r\n    script: LocalScript | ModuleScript = _convert_to_script(data[0])\r\n    script_embedded_code = script.embedded_code\r\n\r\n    return \"\" if script_embedded_code.size < 1 else luau_decompress(\r\n        script_embedded_code.bytecode).decode(\"utf-8\", \"ignore\")\r\n\r\ndef dumpstring(data):\r\n    source: str = data[0]\r\n    bytecode: bytes = luau_compile(source)\r\n\r\n    return bytecode.decode(\"utf-8\", \"ignore\")\r\n\r\ndef setthreadidentity(data):\r\n    extra_space: ExtraSpace = _get_bindable_event_extraspace(data[0])\r\n    extra_space.identity = data[1]\r\n\r\n    return True\r\n\r\ndef getthreadidentity(data) -> int:\r\n    extra_space: ExtraSpace = _get_bindable_event_extraspace(data[0])\r\n    return extra_space.identity\r\n\r\ndef setthreadcapabilities(data):\r\n    extra_space: ExtraSpace = _get_bindable_event_extraspace(data[0])\r\n    extra_space.capabilities = data[1]\r\n\r\n    return True\r\n\r\ndef getthreadcapabilities(data) -> int:\r\n    extra_space: ExtraSpace = _get_bindable_event_extraspace(data[0])\r\n    return extra_space.capabilities\r\n\r\n__library__ = [\r\n    getrenv, getrunningscripts,\r\n    getscriptbytecode, dumpstring, \r\n    setthreadidentity, getthreadidentity, \r\n    setthreadcapabilities, getthreadcapabilities\r\n]",
  "language": "python",
  "imports": [],
  "has_docstring": false
}