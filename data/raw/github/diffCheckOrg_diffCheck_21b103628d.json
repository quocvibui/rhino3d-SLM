{
  "source_url": "https://github.com/diffCheckOrg/diffCheck/blob/8f668b1f273e8d81a282c6115ba3eae07eef9235/src/gh/components/DF_ransac_global_registration/code.py",
  "repo": "diffCheckOrg/diffCheck",
  "repo_stars": 15,
  "repo_description": "diffCheck is a CAD-integrated tool for evaluating digital timber fabrication processes.",
  "license": "GPL-3.0",
  "filepath": "src/gh/components/DF_ransac_global_registration/code.py",
  "instruction": null,
  "code": "#! python3\n\n\nimport Rhino\nfrom ghpythonlib.componentbase import executingcomponent as component\n\nfrom Grasshopper.Kernel import GH_RuntimeMessageLevel as RML\n\nfrom diffCheck import diffcheck_bindings\nfrom diffCheck import df_cvt_bindings\n\n\nclass DFRANSACGlobalRegistration(component):\n    def RunScript(self,\n        i_cloud_source: Rhino.Geometry.PointCloud,\n        i_cloud_target: Rhino.Geometry.PointCloud,\n        i_radius_kd_search: float,\n        i_neighbours_kd_search: int,\n        i_max_corrspondence_dist: float,\n        is_t_estimate_pt2pt: bool,\n        i_ransac_n: int,\n        i_checker_dist: float,\n        i_similarity_threshold: float,\n        i_max_iterations: int,\n        i_confidence_threshold: float\n    ) -> Rhino.Geometry.Transform:\n        if i_cloud_source is None or i_cloud_target is None:\n            ghenv.Component.AddRuntimeMessage(RML.Warning, \"Please provide both objects of type point clouds to align\")  # noqa: F821\n            return None\n        if not i_cloud_source.ContainsNormals or not i_cloud_target.ContainsNormals:\n            ghenv.Component.AddRuntimeMessage(RML.Error, \"Please compute cloud's normals with a component before\")  # noqa: F821\n\n        # set default values\n        if i_radius_kd_search is None:\n            i_radius_kd_search = 1\n        if i_neighbours_kd_search is None:\n            i_neighbours_kd_search = 50\n        if i_max_corrspondence_dist is None:\n            i_max_corrspondence_dist = 0.5\n        if is_t_estimate_pt2pt is None:\n            is_t_estimate_pt2pt = False\n        if i_ransac_n is None:\n            i_ransac_n = 3\n        if i_checker_dist is None:\n            i_checker_dist = 0.5\n        if i_similarity_threshold is None:\n            i_similarity_threshold = 1.5\n        if i_max_iterations is None:\n            i_max_iterations = 5000\n        if i_confidence_threshold is None:\n            i_confidence_threshold = 0.999\n\n        # conversion\n        df_cloud_source = df_cvt_bindings.cvt_rhcloud_2_dfcloud(i_cloud_source)\n        df_cloud_target = df_cvt_bindings.cvt_rhcloud_2_dfcloud(i_cloud_target)\n\n        # fast registration\n        df_xform = diffcheck_bindings.dfb_registrations.DFGlobalRegistrations.O3DRansacOnFeatureMatching(\n            source=df_cloud_source,\n            target=df_cloud_target,\n            voxelize=False,  # set as default\n            voxel_size=0.1,  # set as default\n            radius_kd_tree_search=i_radius_kd_search,\n            max_neighbor_kd_tree_search=i_neighbours_kd_search,\n            max_correspondence_distance=i_max_corrspondence_dist,\n            is_t_estimate_pt2pt=is_t_estimate_pt2pt,\n            ransac_n=i_ransac_n,\n            correspondence_checker_distance=i_checker_dist,\n            similarity_threshold=i_similarity_threshold,\n            ransac_max_iteration=i_max_iterations,\n            ransac_confidence_threshold=i_confidence_threshold\n        )\n        print(\"-------------------\")\n        print(\"Estimated transformation matrix:\")\n        print(df_xform.transformation_matrix)\n        print(\"-------------------\")\n\n        # cvt df xform to rhino xform\n        df_xform_matrix = df_xform.transformation_matrix\n        rh_form = Rhino.Geometry.Transform()\n        for i in range(4):\n            for j in range(4):\n                rh_form[i, j] = df_xform_matrix[i, j]\n        if rh_form == Rhino.Geometry.Transform.Identity:\n            ghenv.Component.AddRuntimeMessage(RML.Warning, \"The transformation matrix is identity, no transformation is applied\")  # noqa: F821\n            return None\n\n        o_x_form = rh_form\n\n        return o_x_form\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry",
    "ghpythonlib"
  ],
  "has_docstring": false
}