{
  "source_url": "https://github.com/BlockResearchGroup/compas-FoFin/blob/9ce50ac0bb4d9785fe387fba6b2edcfcf16665e1/commands/FF_solve_fd.py",
  "repo": "BlockResearchGroup/compas-FoFin",
  "repo_stars": 7,
  "repo_description": "Rhino plugin for form finding of tension-only, compression-only, and mixed tension-compression structures with axial forces, using constrained force-density and dynamic relaxation solvers.",
  "license": "NOASSERTION",
  "filepath": "commands/FF_solve_fd.py",
  "instruction": "venv: brg-csd r: compas_fofin>=0.15.3",
  "code": "#! python3\n# venv: brg-csd\n# r: compas_fofin>=0.15.3\n\nfrom compas_fofin.datastructures import CableMesh\nfrom compas_fofin.scene import RhinoCableMeshObject\nfrom compas_fofin.scene import RhinoConstraintObject\nfrom compas_fofin.session import FoFinSession\nfrom compas_fofin.solvers import AutoUpdateFD\n\n\ndef RunCommand():\n    session = FoFinSession()\n\n    # =============================================================================\n    # Load stuff from session\n    # =============================================================================\n\n    meshobj: RhinoCableMeshObject = session.find_cablemesh()\n    if not meshobj:\n        return\n\n    mesh: CableMesh = meshobj.mesh\n\n    # =============================================================================\n    # Clear conduits\n    # =============================================================================\n\n    session.clear_conduits()\n\n    # =============================================================================\n    # Update Constraints\n    # =============================================================================\n\n    for sceneobject in session.scene.objects:\n        if isinstance(sceneobject, RhinoConstraintObject):\n            sceneobject.update_constraint_geometry()\n\n    mesh.update_constraints()\n\n    # =============================================================================\n    # Solve FD\n    # =============================================================================\n\n    autoupdate = AutoUpdateFD(meshobj.mesh, kmax=session.settings.solver.kmax)\n    autoupdate()\n\n    # =============================================================================\n    # Update scene\n    # =============================================================================\n\n    meshobj.show_vertices = list(meshobj.mesh.vertices_where(is_support=True))\n    meshobj.show_edges = False\n    meshobj.show_faces = False\n\n    meshobj.clear()\n    meshobj.draw()\n    meshobj.display_forces_conduit(tmax=session.settings.display.tmax)\n    meshobj.display_reactions_conduit(scale=session.settings.drawing.scale_reactions)\n    meshobj.display_mesh_conduit()\n\n    # =============================================================================\n    # Session save\n    # =============================================================================\n\n    if session.settings.autosave:\n        session.record(name=\"Solve FD\")\n\n\n# =============================================================================\n# Main\n# =============================================================================\n\nif __name__ == \"__main__\":\n    RunCommand()\n",
  "language": "python",
  "imports": [],
  "has_docstring": true
}