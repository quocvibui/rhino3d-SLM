{
  "source_url": "https://github.com/jackhymowitz/main/blob/7325131db23094f1a28bd184b6a68f864f41a729/01_GH_Components/py/BT_CalcVentFlowRates.py",
  "repo": "jackhymowitz/main",
  "repo_stars": 0,
  "repo_description": "IDF2PH is a free open source toolkit for working with E+ and PHPP Energy Models",
  "license": "GPL-3.0",
  "filepath": "01_GH_Components/py/BT_CalcVentFlowRates.py",
  "instruction": "Will determine the fresh-air ventilation flow rates for all the PHPP Rooms in the HB Zones. Reads from the HB/EP Schedules and Loads applied to the HB zones\r\r\n>  If you like, you can pass in a...",
  "code": "#\r\r\n# IDF2PHPP: A Plugin for exporting an EnergyPlus IDF file to the Passive House Planning Package (PHPP). Created by blgdtyp, llc\r\r\n# \r\r\n# This component is part of IDF2PHPP.\r\r\n# \r\r\n# Copyright (c) 2020, bldgtyp, llc <info@bldgtyp.com> \r\r\n# IDF2PHPP is free software; you can redistribute it and/or modify \r\r\n# it under the terms of the GNU General Public License as published \r\r\n# by the Free Software Foundation; either version 3 of the License, \r\r\n# or (at your option) any later version. \r\r\n# \r\r\n# IDF2PHPP is distributed in the hope that it will be useful,\r\r\n# but WITHOUT ANY WARRANTY; without even the implied warranty of \r\r\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \r\r\n# GNU General Public License for more details.\r\r\n# \r\r\n# For a copy of the GNU General Public License\r\r\n# see <http://www.gnu.org/licenses/>.\r\r\n# \r\r\n# @license GPL-3.0+ <http://spdx.org/licenses/GPL-3.0+>\r\r\n#\r\r\n\"\"\"\r\r\nWill determine the fresh-air ventilation flow rates for all the PHPP Rooms in the HB Zones. Reads from the HB/EP Schedules and Loads applied to the HB zones\r\r\n>  If you like, you can pass in a PHPP-Style ventilation schedule into the '_phppVenSched'. If not, this will read the HB Schedule applied to the Zone and use that to create a PHPP-Style schedule with a CONSTANT flow rate.\r\r\n>  If you want to use this component to align a PHPP and EP model, use an HB 'Constant Schedule' object and set the zone's ventilation schedule to '1'.\r\r\n-\r\r\nEM August 1, 2020\r\r\n\r\r\n    Args:\r\r\n        _HBZones: List. A list of all the HB Zones to use.\r\r\n        zoneGrossFloorArea_: <Optional>: (m2) A value representing the total zone floor area (gross) including all interstitial floor levels.\r\r\n        airFlowInput_: ('EP' | 'UD') <Optional> The Type of values to use for the room's/zone's Air-Flow (m3/h). If 'EP' is input (or none is input) this calculator will figure out the EP Fresh-Air loads based on the HB/EP Program and apply those values to the PHPP Rooms. IF 'UD' is input (User Determined) this calculator will try and use any Rhino-Scene / GH-Scene inputs from the 'Create PHPP Room' component. Any rooms which didn't have values input will default to the HB/EP Zone's Program loads\r\r\n        _phppVentSched: <Optional> Input a simplified PHPP-Style ventilation schedule from the 'PHPP Vent Sched' component. This will override any HB Schedules found in the zone and will be applied to all rooms in the zone.\r\r\n    Returns:\r\r\n        HBZones_: The HB Zones with the new Ventilation Airflow information added\r\r\n        ventilationPerArea_: (m3/s-m2) the TOTAL average yearly ventilation flow rate for the zone at a CONSTANT rate. Input this value into an HB 'setEPZoneLoads' component and then input a 'Constant Schedule' into an HB 'setEPZoneSchedules' component.\r\r\n        ventilationPerPerson_: (m3/s-person) an override set to 0. All the ventilation is encompased in the above 'PerArea' value.\r\r\n\"\"\"\r\r\n\r\r\nghenv.Component.Name = \"BT_CalcVentFlowRates\"\r\r\nghenv.Component.NickName = \"Room Vent Flowrates\"\r\r\nghenv.Component.Message = 'AUG_01_2020'\r\r\nghenv.Component.IconDisplayMode = ghenv.Component.IconDisplayMode.application\r\r\nghenv.Component.Category = \"BT\"\r\r\nghenv.Component.SubCategory = \"01 | Model\"\r\r\n\r\r\n\r\r\nimport scriptcontext as sc\r\r\nimport Grasshopper.Kernel as gh\r\r\nimport os\r\r\nfrom collections import deque\r\r\nimport itertools\r\r\nfrom datetime import date\r\r\nfrom System import Object\r\r\nfrom Grasshopper import DataTree\r\r\nfrom Grasshopper.Kernel.Data import GH_Path\r\r\nimport ghpythonlib.components as ghc\r\r\nfrom collections import namedtuple\r\r\n\r\r\n# Defs and Classes\r\r\nPHPP_Sys_Ventilation = sc.sticky['PHPP_Sys_Ventilation']\r\r\nhb_hive = sc.sticky[\"honeybee_Hive\"]()\r\r\nHBZoneObjects = hb_hive.callFromHoneybeeHive(_HBZones)\r\r\n\r\r\n########################################################\r\r\n######## FROM HB 'convertEPSCHValues' COMPONENT ########\r\r\ndef getNationalHols(country, weekStartWith):\r\r\n    # Dictionary of national hoildays arranged by country.\r\r\n    # All countries are accounted for with the exception of:\r\r\n    # BLZ (CENTRAL AMERICA), BRN (SOUTH PACIFIC), GUM (SOUTH PACIFIC), MHL (SOUTH PACIFIC), PLW (SOUTH PACIFIC), UMI (SOUTH PACIFIC)\r\r\n    # https://energyplus.net/weather\r\r\n    ###################################################\r\r\n    # Source: http://www.officeholidays.com/countries/ ------ http://www.officeholidays.com/countries/\r\r\n    listOfValues = [0, 1, 2, 3, 4, 5, 6]\r\r\n    week = deque(listOfValues)\r\r\n    week.rotate(-weekStartWith)\r\r\n    dayWeekList = list(itertools.chain.from_iterable(itertools.repeat(week, 53)))[:365]\r\r\n    countries = {\r\r\n    'USA':[0,[i for i, x in enumerate(dayWeekList) if x == 2][2],[i for i, x in enumerate(dayWeekList) if x == 2][21],184,[i for i, x in enumerate(dayWeekList) if x == 2][35],314,[i for i, x in enumerate(dayWeekList) if x == 5][46],359],\r\r\n    'CAN': [0,181,[i for i, x in enumerate(dayWeekList) if x == 2][35],358,359],\r\r\n    'CUB': [0,1,[i for i, x in enumerate(dayWeekList) if x == 6][12],120,205,206,207,282,358,364],\r\r\n    'GTM': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],120,180,257,292,304,358],\r\r\n    'HND': [0,[i for i, x in enumerate(dayWeekList) if x == 4][11],[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],120,257,278,358],\r\r\n    'MEX': [0,[i for i, x in enumerate(dayWeekList) if x == 2][4],[i for i, x in enumerate(dayWeekList) if x == 2][11],[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],120,258,[i for i, x in enumerate(dayWeekList) if x == 2][46],345,358,359],\r\r\n    'MTQ': [0,[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,127,[i for i, x in enumerate(dayWeekList) if x == 2][19],194,226,304,314,358],\r\r\n    'NIC': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],120,121,169,256,257,341,358],\r\r\n    'PRI': [0,5,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 2][12],127,169,327,358],\r\r\n    'SLV': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],120,129,168,215,216,217,305,358,359],\r\r\n    'VIR': [0,5,17,45,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],89,149,153,248,304,314,358,359],\r\r\n    'ARG': [0,[i for i, x in enumerate(dayWeekList) if x == 2][5],[i for i, x in enumerate(dayWeekList) if x == 3][5],82,[i for i, x in enumerate(dayWeekList) if x == 6][12],91,120,144,170,188,189,[i for i, x in enumerate(dayWeekList) if x == 2][32],282,[i for i, x in enumerate(dayWeekList) if x == 2][47],341,358],\r\r\n    'BOL': [0,21,[i for i, x in enumerate(dayWeekList) if x == 2][5],[i for i, x in enumerate(dayWeekList) if x == 3][5],[i for i, x in enumerate(dayWeekList) if x == 5][11],120,[i for i, x in enumerate(dayWeekList) if x == 5][20],171,305,358],\r\r\n    'BRA': [0,[i for i, x in enumerate(dayWeekList) if x == 2][5],[i for i, x in enumerate(dayWeekList) if x == 3][5],[i for i, x in enumerate(dayWeekList) if x == 4][5],[i for i, x in enumerate(dayWeekList) if x == 5][11],110,120,[i for i, x in enumerate(dayWeekList) if x == 5][20],249,284,305,318,323,358],\r\r\n    'CHL': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],120,140,179,196,226,261,262,303,304,341,358],\r\r\n    'COL': [0,10,79,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],120,128,149,156,[i for i, x in enumerate(dayWeekList) if x == 2][26],200,218,226,289,[i for i, x in enumerate(dayWeekList) if x == 2][44],317,341,358],\r\r\n    'ECU': [0,38,39,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 1][12],120,143,221,281,306,358],\r\r\n    'PER': [0,[i for i, x in enumerate(dayWeekList) if x == 4][11],[i for i, x in enumerate(dayWeekList) if x == 5][11],120,179,208,209,242,280,304,341,358,359],\r\r\n    'PRY': [0,59,[i for i, x in enumerate(dayWeekList) if x == 4][11],[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 1][12],120,133,134,162,227,271,284,341,358,364],\r\r\n    'URY': [0,38,39,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],108,120,169,198,284,236,305,358],\r\r\n    'VEN': [0,38,39,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],108,120,174,179,185,204,226,284,304,358,359,364],\r\r\n    'AUS': [0,25,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],114,358,359,360],\r\r\n    'FJI': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],174,249,282,303,345,359,360],\r\r\n    'MYS': [38,120,121,140,155,186,187,242,254,258,274,345,358,359],\r\r\n    'NZL': [0,3,38,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],114,[i for i, x in enumerate(dayWeekList) if x == 2][22],[i for i, x in enumerate(dayWeekList) if x == 2][42],358,359,360],\r\r\n    'PHL': [0,1,38,55,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 0][12],98,120,162,187,232,240,253,303,304,333,357,358,363,364],\r\r\n    'SGP': [0,38,39,[i for i, x in enumerate(dayWeekList) if x == 6][12],120,121,140,218,220,254,302,358,359],\r\r\n    'DZA': [0,120,187,253,274,283,304,345],\r\r\n    'EGY': [6,24,114,120,121,187,188,189,204,253,254,255,274,278,345],\r\r\n    'ETH': [6,19,60,119,120,124,147,253,255,269,345],\r\r\n    'GHA': [0,64,65,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,121,144,181,186,253,263,[i for i, x in enumerate(dayWeekList) if x == 6][48],358,359],\r\r\n    'KEN': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,187,253,292,345,358,359],\r\r\n    'LBY': [47,120,187,188,252,253,254,255,258,274,295,345,357],\r\r\n    'MAR': [0,10,120,188,210,225,231,232,253,274,309,321,345],\r\r\n    'MDG': [0,[i for i, x in enumerate(dayWeekList) if x == 2][12],88,120,124,135,176,226,304,345,358],\r\r\n    'SEN': [0,[i for i, x in enumerate(dayWeekList) if x == 2][12],93,120,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],187,226,255,304,345,358],\r\r\n    'TUN': [0,13,78,98,120,187,188,189,205,224,253,254,255,274,287,345],\r\r\n    'ZAF': [0,79,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],117,120,121,166,220,266,349,358,359],\r\r\n    'ZWE': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],107,120,144,[i for i, x in enumerate(dayWeekList) if x == 2][31],[i for i, x in enumerate(dayWeekList) if x == 3][31],355,358,359],\r\r\n    'ARE': [0,124,186,187,252,253,254,255,274,333,335,336,344],\r\r\n    'BDG': [51,75,84,103,120,140,142,181,183,185,187,226,236,253,254,255,283,284,345,349,358],\r\r\n    'CHN': [0,37,38,39,40,41,42,43,93,120,121,159,257,258,273,274,275,276,277,278,279],\r\r\n    'IND': [25,226,274],\r\r\n    'IRN': [41,71,77,78,79,80,81,89,90,110,124,141,153,154,170,177,187,211,255,263,264,283,284,324,325,350,354],\r\r\n    'JPN': [0,[i for i, x in enumerate(dayWeekList) if x == 2][1],41,79,118,122,123,124,[i for i, x in enumerate(dayWeekList) if x == 2][28],222,[i for i, x in enumerate(dayWeekList) if x == 2][37],264,282,306,326,356],\r\r\n    'KAZ': [0,6,59,66,79,80,81,91,98,187,241,253,334,349,352],\r\r\n    'KOR': [0,37,38,39,40,59,124,133,156,226,256,257,258,275,281,358],\r\r\n    'KWT': [2,55,56,124,156,157,158,252,253,254,255,274,345],\r\r\n    'LKA': [14,22,34,52,65,80,[i for i, x in enumerate(dayWeekList) if x == 6][12],102,103,110,120,140,141,169,186,199,228,254,284,301,317,345,346,358],\r\r\n    'MAC': [0,38,39,40,94,120,258,273,293,353],\r\r\n    'MDV': [0,11,120,156,186,206,253,254,274,306,314,334,345,364],\r\r\n    'MNG': [0,38,191,192,193,194,195,362],\r\r\n    'NPL': [14,49],\r\r\n    'PAK': [35,81,120,187,188,189,225,253,254,283,312,345,358],\r\r\n    'PRK': [0,39,46,52,104,114,120,156,169,207,236,251,281,357,360],\r\r\n    'SAU': [187,190,191,253,254,255,264,265],\r\r\n    'THA': [0,52,95,102,103,104,121,124,126,127,139,168,169,223,296,338,345,364],\r\r\n    'TWN': [0,37,38,39,40,41,42,93,120,128,257,282],\r\r\n    'UZB': [0,13,66,79,98,187,243,255,273,341],\r\r\n    'VNM': [0,36,37,38,39,40,105,106,119,120,121,122,244],\r\r\n    'AUT': [0,5,[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],145,226,298,304,311,341,358,359],\r\r\n    'BEL': [0,[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],201,226,304,314,358],\r\r\n    'BRG': [0,61,62,[i for i, x in enumerate(dayWeekList) if x == 6][17],120,[i for i, x in enumerate(dayWeekList) if x == 2][17],125,141,247,248,264,265,357,358,359],\r\r\n    'BIH': [0,1,120,121],\r\r\n    'BLR': [0,6,7,65,66,120,128,129,183,310,358],\r\r\n    'CHE': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],124,212,358],\r\r\n    'CYP': [0,5,[i for i, x in enumerate(dayWeekList) if x == 2][10],83,90,[i for i, x in enumerate(dayWeekList) if x == 6][17],120,[i for i, x in enumerate(dayWeekList) if x == 2][17],[i for i, x in enumerate(dayWeekList) if x == 2][24],226,273,300,358,359],\r\r\n    'CZE': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,127,185,186,270,300,320,357,358,359],\r\r\n    'DEU': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],275,358,359],\r\r\n    'DNK': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],[i for i, x in enumerate(dayWeekList) if x == 6][16],124,[i for i, x in enumerate(dayWeekList) if x == 2][19],155,357,358,359],\r\r\n    'ESP': [0,5,[i for i, x in enumerate(dayWeekList) if x == 6][12],120,226,284,304,339,341,358],\r\r\n    'FIN': [0,5,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,174,175,308,340,357,358,359],\r\r\n    'FRA': [0,[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,127,[i for i, x in enumerate(dayWeekList) if x == 2][19],194,226,304,314,358],\r\r\n    'GBR': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],121,149,359,360],\r\r\n    'GRC': [0,5,[i for i, x in enumerate(dayWeekList) if x == 2][10],83,[i for i, x in enumerate(dayWeekList) if x == 6][17],120,[i for i, x in enumerate(dayWeekList) if x == 2][17],[i for i, x in enumerate(dayWeekList) if x == 2][24],226,300,358],\r\r\n    'HUN': [0,73,[i for i, x in enumerate(dayWeekList) if x == 1][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,[i for i, x in enumerate(dayWeekList) if x == 1][19],[i for i, x in enumerate(dayWeekList) if x == 2][19],231,295,304,358,359],\r\r\n    'IRL': [0,75,[i for i, x in enumerate(dayWeekList) if x == 2][12],[i for i, x in enumerate(dayWeekList) if x == 2][17],[i for i, x in enumerate(dayWeekList) if x == 2][22],[i for i, x in enumerate(dayWeekList) if x == 2][30],303,358,359,360],\r\r\n    'ISL': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 1][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],110,120,124,[i for i, x in enumerate(dayWeekList) if x == 1][19],[i for i, x in enumerate(dayWeekList) if x == 2][19],167,212,357,358,359,364],\r\r\n    'ISR': [82,113,119,131,163,225,275,276,284,289,297],\r\r\n    'ITA': [0,5,[i for i, x in enumerate(dayWeekList) if x == 2][12],114,120,152,226,304,341,358,359],\r\r\n    'LTU': [0,46,69,[i for i, x in enumerate(dayWeekList) if x == 2][12],120,[i for i, x in enumerate(dayWeekList) if x == 1][22],174,186,226,304,357,358,359],\r\r\n    'NLD': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],116,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],358],\r\r\n    'NOR': [0,[i for i, x in enumerate(dayWeekList) if x == 5][11],[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,[i for i, x in enumerate(dayWeekList) if x == 2][19],136,358,359],\r\r\n    'POL': [0,5,[i for i, x in enumerate(dayWeekList) if x == 1][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,122,134,145,226,304,314,358,359],\r\r\n    'PRT': [0,[i for i, x in enumerate(dayWeekList) if x == 6][12],114,120,160,226,341,357,358],\r\r\n    'ROU': [0,1,23,120,[i for i, x in enumerate(dayWeekList) if x == 2][17],170,226,333,334,358,359],\r\r\n    'RUS': [0,3,4,5,6,53,66,120,128,163,307],\r\r\n    'SRB': [0,1,6,7,45,46,[i for i, x in enumerate(dayWeekList) if x == 6][17],[i for i, x in enumerate(dayWeekList) if x == 0][17],[i for i, x in enumerate(dayWeekList) if x == 1][17],[i for i, x in enumerate(dayWeekList) if x == 2][17],128,283],\r\r\n    'SVK': [0,5,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,127,155,240,243,257,273,289,357,358,359],\r\r\n    'SVN': [0,38,[i for i, x in enumerate(dayWeekList) if x == 2][12],116,120,121,175,226,303,304,358,359],\r\r\n    'SWE': [0,5,[i for i, x in enumerate(dayWeekList) if x == 6][12],[i for i, x in enumerate(dayWeekList) if x == 2][12],120,124,156,174,175,277,357,358,359,364],\r\r\n    'SYR': [0,66,106,120,125,187,255,275,278,345,358],\r\r\n    'TUR': [0,112,120,138,157,158,159,241,253,254,255,256,301],\r\r\n    'UKR': [0,6,66,120,[i for i, x in enumerate(dayWeekList) if x == 2][17],127,128,[i for i, x in enumerate(dayWeekList) if x == 2][24],235,286,324]\r\r\n    }\r\r\n    \r\r\n    return countries[country]\r\r\n\r\r\ndef addHolidays(startVals, holidayValues, weekStartWith, epwFile, customHolidays, lb_preparation):\r\r\n    holidayDOYs = []\r\r\n    if epwFile:\r\r\n        #get the base code from EPW\r\r\n        locationData = lb_preparation.epwLocation(epwFile)\r\r\n        codeNation = lb_preparation.epwDataReader(epwFile, locationData[0])[14][1]\r\r\n        code = codeNation.split(\"_\")\r\r\n        if len(code) == 3:\r\r\n            country = code[2]\r\r\n        elif len(code) == 2:\r\r\n            country = code[1]\r\r\n        else:\r\r\n            country = code[1]\r\r\n        \r\r\n        try:\r\r\n            holidayDOYs = getNationalHols(country, weekStartWith)\r\r\n        except:\r\r\n            holidayDOYs = [0,120,358,359] # international holidays for countries not found.\r\r\n        \r\r\n        # Give a message to show the national holidays.\r\r\n        print \"National holidays(DOYs): \"\r\r\n        for item in holidayDOYs:\r\r\n            print item+1\r\r\n        print \"_\"\r\r\n    \r\r\n    # Add customHolidays.\r\r\n    monthsDict = {'01':'JAN', '02':'FEB', '03':'MAR', '04':'APR', '05':'MAY', '06':'JUN',\r\r\n    '07':'JUL', '08':'AUG', '09':'SEP', '10':'OCT', '11':'NOV', '12':'DEC'}\r\r\n    def fromDateToDay(holiday, months):\r\r\n        startDate = date(2015, 1, 1)\r\r\n        textMonth = holiday.split(' ')[0].upper()\r\r\n        dictReverse = {value: key for key, value in months.items()}\r\r\n        intMonth = int(dictReverse[textMonth])\r\r\n        endDate = date(2015, intMonth, int(holiday.split(' ')[1]))\r\r\n        period = endDate - startDate\r\r\n        day = period.days + 1\r\r\n        return day\r\r\n    \r\r\n    if customHolidays != []:\r\r\n        try:\r\r\n            if customHolidays is not type(int):\r\r\n                customHolidays = map(int, customHolidays)\r\r\n        except ValueError:\r\r\n            customHolidaysDOY = []\r\r\n            for item in customHolidays:\r\r\n                dayDate = fromDateToDay(item, monthsDict)\r\r\n                customHolidaysDOY.append(dayDate)\r\r\n            customHolidays = customHolidaysDOY\r\r\n        \r\r\n        # Give a message to show the national holidays.\r\r\n        print \"Custom holidays(DOYs): \"\r\r\n        for item in customHolidays:\r\r\n            print item\r\r\n            if item-1 not in holidayDOYs:\r\r\n                holidayDOYs.append(item-1)\r\r\n    \r\r\n    # Edit the list of schedule values.\r\r\n    for day in holidayDOYs:\r\r\n        for interval in holidayValues:\r\r\n            if day >= interval[0]-1 and day <= interval[1]-1:\r\r\n                startVals[day] = interval[2]\r\r\n    \r\r\n    # Build up a list of holidays\r\r\n    def fromDayToDate(day, months):\r\r\n        dateDay = date.fromordinal(date(2015, 1, 1).toordinal() + day) # 2015 is not leap year\r\r\n        month, day = str(dateDay).split('-')[1:]\r\r\n        monthsDate = months[month]\r\r\n        dateFromDay = monthsDate + ' ' + day\r\r\n        return dateFromDay\r\r\n    holidayDates = []\r\r\n    for day in holidayDOYs:\r\r\n        holidayDates.append(fromDayToDate(day, monthsDict))\r\r\n    \r\r\n    return startVals, holidayDates\r\r\n\r\r\ndef main(schName, startDayOfTheWeek, epwFile, customHol):\r\r\n    # Check the start day of the week.\r\r\n    daysOfWeek = {'sun':0, 'mon':1, 'tue':2, 'wed':3, 'thu':4, 'fri':5, 'sat':6,\r\r\n    'sunday':0, 'monday':1, 'tuesday':2, 'wednesday':3, 'thursday':4, 'friday':5, 'saturday':6}\r\r\n    \r\r\n    if startDayOfTheWeek != None:\r\r\n        try:\r\r\n            startDayOfTheWeek = int(startDayOfTheWeek)%7\r\r\n        except:\r\r\n            try:\r\r\n                startDayOfTheWeek = daysOfWeek[startDayOfTheWeek.lower()]\r\r\n            except:\r\r\n                warning = 'Input for _weekStartDay_ is not valid.'\r\r\n                print warning\r\r\n                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warning)\r\r\n                return -1\r\r\n    else:\r\r\n        startDayOfTheWeek = 0\r\r\n    \r\r\n    lb_preparation = sc.sticky[\"ladybug_Preparation\"]()\r\r\n    readSchedules = sc.sticky[\"honeybee_ReadSchedules\"](schName, startDayOfTheWeek)\r\r\n    \r\r\n    values = []\r\r\n    holidays = []\r\r\n    dataGotten = False\r\r\n    if schName.lower().endswith(\".csv\"):\r\r\n        # check if csv file exists\r\r\n        if not os.path.isfile(schName):\r\r\n            msg = \"Cannot find the shchedule file: \" + schName\r\r\n            print msg\r\r\n            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\r\r\n            return -1\r\r\n        else:\r\r\n            result = open(schName, 'r')\r\r\n            lineCount = 0\r\r\n            for lineCount, line in enumerate(result):\r\r\n                readSchedules.schType = 'schedule:year'\r\r\n                readSchedules.startHOY = 1\r\r\n                readSchedules.endHOY = 8760\r\r\n                if 'Daysim' in line: pass\r\r\n                else:\r\r\n                    if lineCount == 0:readSchedules.unit = line.split(',')[-2].split(' ')[-1].upper()\r\r\n                    elif lineCount == 1: readSchedules.schName = line.split('; ')[-1].split(':')[0]\r\r\n                    elif lineCount < 4: pass\r\r\n                    else:\r\r\n                        columns = line.split(',')\r\r\n                        try:\r\r\n                            values.append(float(columns[4]))\r\r\n                        except:\r\r\n                            values.append(float(columns[3]))\r\r\n                    lineCount += 1\r\r\n            values.insert(0, values.pop(-1))\r\r\n            dataGotten = True\r\r\n    else:\r\r\n        HBScheduleList = sc.sticky[\"honeybee_ScheduleLib\"].keys()\r\r\n        if schName.upper() not in HBScheduleList:\r\r\n            msg = \"Cannot find \" + schName + \" in Honeybee schedule library.\"\r\r\n            print msg\r\r\n            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msg)\r\r\n            return -1\r\r\n        else:\r\r\n            dataGotten = True\r\r\n            values = readSchedules.getScheduleValues()\r\r\n    \r\r\n    if dataGotten == True:\r\r\n        # Check for any holidays.\r\r\n        if epwFile or customHol != []:\r\r\n            if len(values) == 365 and not schName.lower().endswith(\".csv\"):\r\r\n                holidayValues = readSchedules.getHolidaySchedValues(schName)\r\r\n                values, holidays = addHolidays(values, holidayValues, startDayOfTheWeek, epwFile, customHol, lb_preparation)\r\r\n        \r\r\n        strToBeFound = 'key:location/dataType/units/frequency/startsAt/endsAt'\r\r\n        d, m, t = lb_preparation.hour2Date(readSchedules.startHOY, True)\r\r\n        startDate = m+1, d, t\r\r\n        \r\r\n        d, m, t = lb_preparation.hour2Date(readSchedules.endHOY, True)\r\r\n        endDate = m+1, d, t\r\r\n        if readSchedules.endHOY%24 == 0:\r\r\n            endDate = m+1, d, 24\r\r\n        \r\r\n        header = [strToBeFound, readSchedules.schType, readSchedules.schName, \\\r\r\n                  readSchedules.unit, 'Hourly', startDate, endDate]\r\r\n        \r\r\n        try: values = lb_preparation.flattenList(values)\r\r\n        except: pass\r\r\n        \r\r\n        return header + values, holidays\r\r\n    else:\r\r\n        return -1\r\r\n########################################################\r\r\n########################################################\r\r\n\r\r\ndef checkInputs(_HBZoneObjects, _type):\r\r\n    ## Check the inputs, give warnings\r\r\n    \r\r\n    totalModelRooms = []\r\r\n    for zone in _HBZoneObjects:\r\r\n        try:\r\r\n            # Check for demand controls\r\r\n            if zone.HVACSystem.airDetails.fanControl == 'Variable Volume':\r\r\n                pass\r\r\n            elif zone.HVACSystem.airDetails.fanControl == 'Constant Volume':\r\r\n                msgDemandControl = \"It looks like the Zone(s) have no 'Demand Control' for Fresh Air Ventilation?\\nFor the EP simulations results to match this calculator, be sure to apply 'Demand Control' to your EP model.\\nAdd a 'Honeybee_HVAC Air Details' Component and set 'demandControlledVent_' option to TRUE in order to do this.\"\r\r\n                ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, msgDemandControl)\r\r\n        except:\r\r\n            pass\r\r\n        \r\r\n        try:\r\r\n            # Check for length of rooms, warn about PHPP Exccel table length\r\r\n            noOfRooms = len(zone.PHPProoms)\r\r\n            totalModelRooms.append(noOfRooms)\r\r\n        except:\r\r\n            pass\r\r\n    \r\r\n    if _type != None:\r\r\n        return _type\r\r\n    else:\r\r\n        return 'EP'\r\r\n\r\r\ndef histogram(_data, _nbins):\r\r\n    # Creates a dictionary Histogram of some data in n-bins\r\r\n    \r\r\n    #print _data\r\r\n    min_val = min(_data)\r\r\n    max_val = max(_data)\r\r\n    hist_bins = {} # The number of items in each bin\r\r\n    hist_vals = {} # The avg value for each bin\r\r\n    total = 0\r\r\n    \r\r\n    # Initialize the dict\r\r\n    for k in range(_nbins+1):\r\r\n        hist_bins[k] = 0\r\r\n        hist_vals[k] = 0\r\r\n    \r\r\n    # Create the Histogram\r\r\n    for d in _data:\r\r\n        bin_number = int(_nbins * ((d - min_val) / (max_val - min_val)))\r\r\n        \r\r\n        hist_bins[bin_number] += 1\r\r\n        hist_vals[bin_number] += d\r\r\n        total += 1\r\r\n    \r\r\n    # Clean up / fix the data for output\r\r\n    for n in hist_vals.keys():\r\r\n        hist_vals[n] =  hist_vals[n] / hist_bins[n]\r\r\n    \r\r\n    for h in hist_bins.keys():\r\r\n        hist_bins[h] = hist_bins[h] / total\r\r\n    \r\r\n    return hist_bins, hist_vals # The number of items in each bin, the avg value of the items in the bin\r\r\n\r\r\ndef getHBzoneFloorArea(_HBzoneObj, _zoneGrossFloorArea):\r\r\n    # Finds and returns the zone total floor area\r\r\n    # This will use ALL the floor-type surfaces to determing the zone floor area. Is that right? hmm....\r\r\n    \r\r\n    if _zoneGrossFloorArea == None:\r\r\n        floorAreas = []\r\r\n        for surface in _HBzoneObj.surfaces:\r\r\n            if surface.type >= 2 and surface.type <3: # 2-3 are the Floor surface types\r\r\n                floorAreas.append(ghc.Area(surface.geometry)[0] ) # Return 0 is the Area)\r\r\n        zoneFloorArea = sum(floorAreas)\r\r\n    else:\r\r\n        zoneFloorArea = float(_zoneGrossFloorArea)\r\r\n    \r\r\n    return zoneFloorArea\r\r\n\r\r\ndef getHBLoadAndSched(_HBzoneObj):\r\r\n    ############################################################################\r\r\n    # Get the HB/EP Ventilation Loads and Sched for the Zone from the Hive\r\r\n    ############################################################################\r\r\n    \r\r\n    # Loads from HB Library\r\r\n    HBZoneLoads = _HBzoneObj.getCurrentLoads(True, ghenv.Component)\r\r\n    \r\r\n    HBnumOfPeoplePerArea = _HBzoneObj.numOfPeoplePerArea\r\r\n    HBventilationPerArea = _HBzoneObj.ventilationPerArea\r\r\n    HBventilationPerPerson = _HBzoneObj.ventilationPerPerson\r\r\n    \r\r\n    # Get the HB/EP Occupancy Schedule for the zone for the Hive\r\r\n    HBZoneSchedules = _HBzoneObj.getCurrentSchedules(True, ghenv.Component)\r\r\n    occupancySchedule = HBZoneSchedules['occupancySchedule']\r\r\n    \r\r\n    if occupancySchedule:\r\r\n        result = main(occupancySchedule, None, None, [])[0]\r\r\n    \r\r\n    # Clean up the HB/EP Occupancy Schdeule (remove text header)\r\r\n    HBoccupancySchedualAsValues_ = []\r\r\n    for eachItem in result:\r\r\n        try:\r\r\n            HBoccupancySchedualAsValues_.append(float(eachItem))\r\r\n        except:\r\r\n            pass\r\r\n    \r\r\n    return HBnumOfPeoplePerArea, HBventilationPerArea, HBventilationPerPerson, HBoccupancySchedualAsValues_\r\r\n\r\r\ndef calcZoneAnnualVentFlowRateFromHB(_HBzoneObj, _userVentSched, _zoneGrossFloorArea):\r\r\n    # Figure out the HB Zone's Floor Area to use (different than TFA)\r\r\n    zoneFloorArea = getHBzoneFloorArea(_HBzoneObj, _zoneGrossFloorArea)\r\r\n    \r\r\n    if zoneFloorArea == 0:\r\r\n        warning = \"Something wrong with the floor area - are you sure there is at least one Floor surface in the zone?\"\r\r\n        ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warning)\r\r\n    \r\r\n    # Pull the Ventilaiton loads, Occupancy Schedule from the Hive\r\r\n    numOfPeoplePerArea, ventilationPerArea, ventilationPerPerson, zoneOccSchedAsValues = getHBLoadAndSched(_HBzoneObj)\r\r\n    \r\r\n    # Calc the Avg Zone Occupancy\r\r\n    avgZoneOccupancy = (sum(zoneOccSchedAsValues) / len(zoneOccSchedAsValues)) * numOfPeoplePerArea * zoneFloorArea\r\r\n    \r\r\n    # Calc the Hourly Flow rates (m3/h) from the HB Hive Schedule\r\r\n    zoneVentilation_forArea = [ventilationPerArea * zoneFloorArea * 60 * 60] * 8760 # m3/s---> m3/h\r\r\n    zoneVentilation_forPeople = []\r\r\n    for eachHourOccRate in zoneOccSchedAsValues:\r\r\n        #zoneVentilation_forPeople.append(eachHourOccRate * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60) # m3/s---> m3/h\r\r\n        zoneVentilation_forPeople.append( numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60) # m3/s---> m3/h\r\r\n    \r\r\n    zoneVentilation_forArea_Avg = sum(zoneVentilation_forArea) / len(zoneVentilation_forArea)\r\r\n    zoneVentilation_forPeople_Avg = sum(zoneVentilation_forPeople) / len(zoneVentilation_forPeople)\r\r\n    zoneVentilation_Total_AnnualAvg = zoneVentilation_forArea_Avg + zoneVentilation_forPeople_Avg\r\r\n    \r\r\n    # Return the average Annual Ventialtion Flow rate (m3/h) based on the Zone's HB Schedules\r\r\n    \r\r\n    print \"The HB Zone '{}' has an average Annual airflow of: {:.2f} m3/h\".format(_HBzoneObj.name, zoneVentilation_Total_AnnualAvg)\r\r\n    print \"   >Taking into account the airflow for 'areas' and the airflow for people.\"\r\r\n    print \"   >This is the value BEFORE any occupany schedule or operation sched is applied to reduce this (demand control)\"\r\r\n    print \"      >Reference Zone Floor Area used is: {:.2f}\".format(float(zoneFloorArea))\r\r\n    print \"      >Avg. Annual Zone Occupancy is: {:.2f} PPL\".format(float(avgZoneOccupancy))\r\r\n    print \"      >[Ventilation Per Pers: {:.6f} m3/s-prs] x [Avg Zn Occ: {:.2f} ppl] * 3600 s/hr = {:.2f} m3/hr\".format(ventilationPerPerson, avgZoneOccupancy, ventilationPerPerson*avgZoneOccupancy*3600)\r\r\n    print \"      >[Ventilation Per Area: {:.6f} m3/s-m2] x [Floor Area: {:.2f} m2] * 3600 s/hr = {:.2f} m3/hr\".format(float(ventilationPerArea), float(zoneFloorArea), float(zoneVentilation_forArea_Avg))\r\r\n    print \"      >[Vent For Area: {:.2f} m3/h] + [Vent For PPL: {:.2f} m3/h] = {:.2f} m3/h\".format(zoneVentilation_forArea_Avg, zoneVentilation_forPeople_Avg, zoneVentilation_Total_AnnualAvg)\r\r\n    return zoneVentilation_Total_AnnualAvg, zoneVentilation_forArea_Avg, zoneVentilation_forPeople_Avg\r\r\n\r\r\ndef setRoomVentFlowRates(_HBzoneObj, _type, _zoneAnnualAvgVentRate):\r\r\n    ############################################################################\r\r\n    ###### Apply the Ventilation flow rate  the Zone's Rooms \r\r\n\r\r\n    # if the Zone has Rooms (has the 'PHPProoms' Dict)\r\r\n    if 'PHPProoms' in _HBzoneObj.__dict__.keys():\r\r\n        zoneRooms = _HBzoneObj.PHPProoms # Dict of all the rooms in the zone\r\r\n        \r\r\n        # Get the total Zone TFA\r\r\n        totalZoneTFA = []\r\r\n        for eachRoom in zoneRooms:\r\r\n            totalZoneTFA.append(eachRoom.FloorArea_TFA)\r\r\n        \r\r\n        totalZoneTFA = sum(totalZoneTFA)\r\r\n        \r\r\n        if totalZoneTFA == 0:\r\r\n            warning = \"Zone: '{}' looks like it has no TFA surfaces? Check the TFA surface inputs to make sure.\\nIt \"\\\r\r\n            \"should have at least one room floor surfce with valid TFA?\".format(_HBzoneObj.name)\r\r\n            ghenv.Component.AddRuntimeMessage(gh.GH_RuntimeMessageLevel.Warning, warning)\r\r\n        \r\r\n        \r\r\n        for eachRoom in zoneRooms:\r\r\n            # Compute the Room % of Total TFA and Room's Ventilation Airflows\r\r\n            percentZoneTotalTFA = eachRoom.FloorArea_TFA / totalZoneTFA\r\r\n            \r\r\n            roomAirFlow = percentZoneTotalTFA * _zoneAnnualAvgVentRate\r\r\n            \r\r\n            # If the user says 'EP'\r\r\n            if _type=='EP':\r\r\n                setattr(eachRoom, 'V_sup', roomAirFlow) \r\r\n                setattr(eachRoom, 'V_eta', roomAirFlow)\r\r\n                setattr(eachRoom, 'V_trans', roomAirFlow)\r\r\n            elif _type=='UD':\r\r\n                if eachRoom.V_sup == 'Automatic':\r\r\n                    setattr(eachRoom, 'V_sup', roomAirFlow/2) # Divide by 2 cus' half goes to supply, half to extract?\r\r\n                    setattr(eachRoom, 'V_eta', roomAirFlow/2)\r\r\n                    setattr(eachRoom, 'V_trans', roomAirFlow/2)\r\r\n                else:\r\r\n                    # don't do anything. Leave the rooms as-is\r\r\n                    pass\r\r\n\r\r\ndef setRoomVentSchedule(_HBzoneObj, _type, _userVentSched, _zoneVentilation_Total_AnnualAvg, _annualAvgZoneFlowRate_Area, _annualAvgZoneFlowRate_PPl, _zoneGrossFloorArea):\r\r\n    # Pull the Ventilation loads, Occupancy Schedule from the Hive\r\r\n    numOfPeoplePerArea, ventilationPerArea, ventilationPerPerson, zoneOccSchedAsValues = getHBLoadAndSched(_HBzoneObj)\r\r\n    zoneFloorArea = getHBzoneFloorArea(_HBzoneObj, _zoneGrossFloorArea)\r\r\n    \r\r\n    # Convert the HB Sched Values for the zone as PHPP-Stly (bined 3)\r\r\n    bins, vals = histogram(zoneOccSchedAsValues, 2)\r\r\n    bined_Sched = namedtuple('phppSched', 'speed_high time_high speed_med time_med speed_low time_low')\r\r\n    hbRoomVentSched = bined_Sched(vals[2], bins[2], vals[1], bins[1], vals[0], bins[0] )\r\r\n    \r\r\n    # if the Zone has Rooms (has the 'PHPProoms' Dict)\r\r\n    if 'PHPProoms' in _HBzoneObj.__dict__.keys():\r\r\n        zoneRooms = _HBzoneObj.PHPProoms # Dict of all the rooms in the zone\r\r\n        \r\r\n        # Get the Zone's total TFA\r\r\n        totalZoneTFA = []\r\r\n        for eachRoom in zoneRooms:\r\r\n            totalZoneTFA.append(eachRoom.FloorArea_TFA)\r\r\n        \r\r\n        totalZoneTFA = sum(totalZoneTFA)\r\r\n        \r\r\n        # Go through each room\r\r\n        for eachRoom in zoneRooms:\r\r\n            if _userVentSched:\r\r\n                # If there are user values supplied for the PHPP Schedule, use those \r\r\n                # And ignore any HB Library Schedules found\r\r\n                phppRoomVentSched = _userVentSched[0]\r\r\n                \r\r\n                # Calc the Room's flow rates (m3/h) for People based on the PHPP-Style Schedule\r\r\n                roomFlowrate_People_High = (phppRoomVentSched.speed_high * phppRoomVentSched.time_high * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60) # m3/s---> m3/hour\r\r\n                roomFlowrate_People_Med = (phppRoomVentSched.speed_med * phppRoomVentSched.time_med * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60) # m3/s---> m3/hour\r\r\n                roomFlowrate_People_Low = (phppRoomVentSched.speed_low * phppRoomVentSched.time_low * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60) # m3/s---> m3/hour\r\r\n                \r\r\n                ventilationPerArea = (roomFlowrate_People_High + roomFlowrate_People_Med + roomFlowrate_People_Low)\r\r\n            else:\r\r\n                # Compute the Room % of Total TFA and Room's Ventilation Airflows\r\r\n                percentZoneTotalTFA = eachRoom.FloorArea_TFA / totalZoneTFA\r\r\n                roomFlowrate_People_Peak = numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60 * percentZoneTotalTFA\r\r\n                \r\r\n                # Calc total airflow for People\r\r\n                # Calc the flow rates for people based on the HB Schedule values\r\r\n                roomFlowrate_People_High = (hbRoomVentSched.speed_high * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60 * percentZoneTotalTFA) \r\r\n                roomFlowrate_People_Med = (hbRoomVentSched.speed_med * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60 * percentZoneTotalTFA) \r\r\n                roomFlowrate_People_Low = (hbRoomVentSched.speed_low * numOfPeoplePerArea * zoneFloorArea * ventilationPerPerson * 60 * 60 * percentZoneTotalTFA) \r\r\n                \r\r\n                roomVentilationPerArea = (ventilationPerArea * zoneFloorArea * 60 * 60 * percentZoneTotalTFA)\r\r\n                \r\r\n                if roomVentilationPerArea != 0 and roomFlowrate_People_Peak != 0:\r\r\n                    roomFlowrate_Total_High = (roomFlowrate_People_High + roomVentilationPerArea) / (roomFlowrate_People_Peak + roomVentilationPerArea)\r\r\n                    roomFlowrate_Total_Med = (roomFlowrate_People_Med + roomVentilationPerArea) / (roomFlowrate_People_Peak + roomVentilationPerArea)\r\r\n                    roomFlowrate_Total_Low = (roomFlowrate_People_Low + roomVentilationPerArea) / (roomFlowrate_People_Peak + roomVentilationPerArea)\r\r\n                    \r\r\n                    # Re-set the Room's Vent Schedule Fan-Speeds based on the calculated rates\r\r\n                    # taking into account both Floor Area and People\r\r\n                    phppRoomVentSched = bined_Sched(roomFlowrate_Total_High, bins[2], roomFlowrate_Total_Med, bins[1], roomFlowrate_Total_Low, bins[0] )\r\r\n                else:\r\r\n                    phppRoomVentSched = bined_Sched(1.0, 1.0, 0.0, 0.0, 0.0, 0.0)\r\r\n                \r\r\n                # Output the HB Schedules and loads as Annual Average 'Constant' flow rate (same as PHPP)\r\r\n                roomVentilationPerArea = _zoneVentilation_Total_AnnualAvg / zoneFloorArea\r\r\n                roomVentilationPerPerson = 0.0 # zero out, all the vent is applied as an average to the 'by area'\r\r\n            \r\r\n            # Apply the Zone's new PHPP-Stlye Schedule to the room\r\r\n            setattr(eachRoom, 'phppVentSched', phppRoomVentSched)\r\r\n\r\r\ndef calcHBzoneVentRates(_HBzoneObj, _zoneGrossFloorArea):\r\r\n    ventPerArea = 1\r\r\n    if 'PHPProoms' in _HBzoneObj.__dict__.keys():\r\r\n        tfaRoomsTotalAvgAirflow = 0\r\r\n        tfaRoomsTotalFloorArea = 0\r\r\n        \r\r\n        for eachroom in _HBzoneObj.PHPProoms:\r\r\n            avgRoomAirflow =  (eachroom.V_sup + eachroom.V_eta) / 2\r\r\n            high = avgRoomAirflow * eachroom.phppVentSched.speed_high * eachroom.phppVentSched.time_high\r\r\n            med = avgRoomAirflow * eachroom.phppVentSched.speed_med * eachroom.phppVentSched.time_med\r\r\n            low = avgRoomAirflow * eachroom.phppVentSched.speed_low * eachroom.phppVentSched.time_low\r\r\n            \r\r\n            roomTotalAvgAirflow = high + med + low # The total airflow for one room\r\r\n            tfaRoomsTotalAvgAirflow += roomTotalAvgAirflow # Add in the room's airflow to the runing total for the zone\r\r\n            # Add in the room's Floor Area (GROSS? TFA???)\r\r\n            tfaRoomsTotalFloorArea += eachroom.FloorArea_Gross\r\r\n    \r\r\n    # Get the Zone's total HB floor area\r\r\n    zoneFloorArea = getHBzoneFloorArea(_HBzoneObj, _zoneGrossFloorArea)\r\r\n    \r\r\n    print \"The Zone's TFA Rooms have a total average Annual airflow of: {:.3f} m3/h\".format(tfaRoomsTotalAvgAirflow)\r\r\n    print \"    >Once you take into account the operational schedule\"\r\r\n    # Calc the Average Zone annual airflow\r\r\n    ventPerArea = tfaRoomsTotalAvgAirflow / zoneFloorArea #tfaRoomsTotalFloorArea\r\r\n    \r\r\n    return ventPerArea/60/60, 0\r\r\n\r\r\ndef preview(_zoneObjs):\r\r\n    for zone in _zoneObjs:\r\r\n        for eachroom in zone.PHPProoms:\r\r\n            print '-----'\r\r\n            print 'Room {}: {:.0f} m3/h, runs at {:.0f}% fan speed for {:.0f}% of the year'.format(eachroom.RoomName, eachroom.V_sup, eachroom.phppVentSched.speed_high*100, eachroom.phppVentSched.time_high*100)\r\r\n            print 'Room {}: {:.0f} m3/h, runs at {:.0f}% fan speed for {:.0f}% of the year'.format(eachroom.RoomName, eachroom.V_sup, eachroom.phppVentSched.speed_med*100, eachroom.phppVentSched.time_med*100)\r\r\n            print 'Room {}: {:.0f} m3/h, runs at {:.0f}% fan speed for {:.0f}% of the year'.format(eachroom.RoomName, eachroom.V_sup, eachroom.phppVentSched.speed_low*100, eachroom.phppVentSched.time_low*100)\r\r\n            print '-----'\r\r\n\r\r\n# ------------------------------------------------------------------------------\r\r\n#### Get / Calculate the Zone's Ventilation Flow rates and Schedule\r\r\nif len(_HBZones) > 0:\r\r\n    HBZoneObjects = hb_hive.callFromHoneybeeHive(_HBZones)\r\r\n    type = checkInputs(HBZoneObjects, airFlowInput_)\r\r\n    \r\r\n    for zone in HBZoneObjects:\r\r\n        # 1) Figure out the Zone's Annual Average Ventilation Flow Rate\r\r\n        #    (People + Area)bassed on HB Program (Load / Schedule)\r\r\n        #\r\r\n        # 2) Set the individual room Flow Rates from HB Program, or from Rhino Scene\r\r\n        #\r\r\n        # 3) Calc the HB Flow rates to override the Library and\r\r\n        #    align the EP simulation with the PHPP\r\r\n        \r\r\n        #print '-----'\r\r\n        #print 'looking at Zone {}'.format(zone.name)\r\r\n        \r\r\n        (annualAvgZoneFlowRate,\r\r\n        annualAvgZoneFlowRate_Area,\r\r\n        annualAvgZoneFlowRate_PPl) = calcZoneAnnualVentFlowRateFromHB(zone, _phppVentSched, zoneGrossFloorArea_)\r\r\n        \r\r\n        setRoomVentFlowRates(zone,\r\r\n                            type,\r\r\n                            annualAvgZoneFlowRate)\r\r\n        \r\r\n        setRoomVentSchedule(zone,\r\r\n                            type,\r\r\n                            _phppVentSched,\r\r\n                            annualAvgZoneFlowRate,\r\r\n                            annualAvgZoneFlowRate_Area,\r\r\n                            annualAvgZoneFlowRate_PPl,\r\r\n                            zoneGrossFloorArea_)\r\r\n        \r\r\n        ventilationPerArea_, ventilationPerPerson_ = calcHBzoneVentRates(zone, zoneGrossFloorArea_)\r\r\n    \r\r\n    HBZones_ = _HBZones\r\r\n\r\r\n# ------------------------------------------------------------------------------\r\r\n#### Set the Zone's PHPP Ventilation System as Default\r\r\n# If no systems already assigned, add in a Default Ventilation System.\r\r\n# This can be overwriten by the user later\r\r\nif len(HBZoneObjects) > 0:\r\r\n    defaultVentSystem = PHPP_Sys_Ventilation() # Uses the class defaults\r\r\n    for zone in HBZoneObjects:\r\r\n        \r\r\n        if getattr(zone, 'PHPP_VentSys'):\r\r\n            continue\r\r\n        \r\r\n        setattr(zone, 'PHPP_VentSys', defaultVentSystem)\r\r\n        for room in zone.PHPProoms:\r\r\n            setattr(room, 'VentUnitName', defaultVentSystem.Unit_Name)\r\r\n            setattr(room, 'VentSystemName', defaultVentSystem.SystemName)\r\r\n\r\r\n# ------------------------------------------------------------------------------\r\r\n# Modify the HB Zone's Floor Area parameter\r\r\nif zoneGrossFloorArea_ != None:\r\r\n    if len(HBZoneObjects)>0:\r\r\n        for zone in HBZoneObjects:\r\r\n            zoneFloorArea = getHBzoneFloorArea(zone, zoneGrossFloorArea_)\r\r\n            setattr(zone, 'floorArea', zoneFloorArea)\r\r\n\r\r\n# ------------------------------------------------------------------------------\r\r\n# Add modified zones back to the HB dictionary\r\r\nif len(_HBZones)>0:\r\r\n    HBZones_  = hb_hive.addToHoneybeeHive(HBZoneObjects, ghenv.Component)\r\r\nelse:\r\r\n    HBZones_ = _HBZones\r\r\n\r\r\npreview(HBZoneObjects)\r\n",
  "language": "python",
  "imports": [
    "ghpythonlib",
    "scriptcontext"
  ],
  "has_docstring": true
}