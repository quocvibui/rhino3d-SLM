{
  "source_url": "https://github.com/PH-Tools/honeybee_grasshopper_ph_plus/blob/b89f9887488d9c10eb732ffafe910cec70be0752/honeybee_ph_plus_rhino/gh_compo_io/hb_tools/clean_input_breps.py",
  "repo": "PH-Tools/honeybee_grasshopper_ph_plus",
  "repo_stars": 2,
  "repo_description": "Additional Honeybe-PH Grasshopper Components",
  "license": "GPL-3.0",
  "filepath": "honeybee_ph_plus_rhino/gh_compo_io/hb_tools/clean_input_breps.py",
  "instruction": "GHCompo Interface: HBPH - Clean Input Breps.",
  "code": "# -*- coding: utf-8 -*-\n# -*- Python Version: 2.7 -*-\n\n\"\"\"GHCompo Interface: HBPH - Clean Input Breps.\"\"\"\n\ntry:\n    from typing import Any, Optional, Tuple\nexcept ImportError:\n    pass  # IronPython 2.7\n\ntry:\n    from Rhino.Geometry import Brep  # type: ignore\nexcept:\n    pass  # Outside Rhino\n\ntry:\n    from Grasshopper import DataTree  # type: ignore\n    from Grasshopper.Kernel.Data import GH_Path  # type: ignore\n    from System import Object  # type: ignore\nexcept:\n    pass  # Outside Rhino\n\ntry:\n    from honeybee_ph_rhino import gh_io\nexcept ImportError:\n    raise ImportError(\"Failed to import honeybee_ph_rhino\")\n\n\nclass GHCompo_CleanInputBreps(object):\n    def __init__(self, _IGH, _breps, *args, **kwargs):\n        # type: (gh_io.IGH, DataTree[Brep], *Any, **Any) -> None\n        self.IGH = _IGH\n        self.breps = _breps\n\n    def get_clean_face(self, face):\n        # type: (Any) -> Tuple[Any, Optional[Any]]\n        \"\"\"Get a clean face from a Rhino Brep. If the input face as a U or V count > 2, will convert to a trimmed surface.\"\"\"\n\n        point, weights, greville, u_count, v_count = self.IGH.ghc.SurfacePoints(face)\n        if u_count > 2 or v_count > 2:\n            msg = (\n                \"An input Face has u_count={} and \"\n                \"v_count={}. Converting. See 'bad_faces_' \"\n                \"output to visualize these problem faces.\".format(u_count, v_count)\n            )\n            self.IGH.warning(msg)\n\n            bad_face = face\n            face = self.IGH.ghc.BoundarySurfaces(\n                self.IGH.ghc.JoinCurves(self.IGH.ghc.DeconstructBrep(face).edges, True)\n            )\n            return face, bad_face\n        return face, None\n\n    def get_clean_brep(self, brep):\n        # type: (Any) -> Tuple[Optional[Any], Optional[Any], Optional[Any]]\n        \"\"\"Get a clean brep from a Rhino Brep. If the input brep is not closed, will try to join the faces.\"\"\"\n\n        good_brep_faces = []\n        bad_brep_faces = []\n\n        # -- Build up all the Brep Faces. Fix any faces if needed.\n        for face in self.IGH.ghc.DeconstructBrep(brep).faces:\n            good_face, bad_face = self.get_clean_face(face)\n            good_brep_faces.append(good_face)\n            if bad_face:\n                bad_brep_faces.append(bad_face)\n\n        brep_, brep_is_closed = self.IGH.ghc.BrepJoin(good_brep_faces)\n\n        if not brep_is_closed:\n            msg = \"Error: Brep '{}' is not closed.\" \"Check the 'bad_breps_' to visualize.\".format(brep)\n            self.IGH.error(msg)\n            return None, brep_, bad_brep_faces\n\n        return brep_, None, bad_brep_faces\n\n    def run(self):\n        # type: () -> Tuple[DataTree[Optional[Brep]], DataTree[Optional[Brep]], DataTree[Optional[Brep]]]\n        good_breps_ = DataTree[Object]()\n        bad_breps_ = DataTree[Object]()\n        bad_faces_ = DataTree[Object]()\n\n        for i, branch in enumerate(self.breps.Branches):\n            for k, brep in enumerate(branch):\n                if not brep:\n                    continue\n\n                good_brep, bad_brep, bad_faces = self.get_clean_brep(brep)\n                good_breps_.Add(good_brep, GH_Path(i, k))\n                bad_breps_.Add(bad_brep, GH_Path(i, k))\n                bad_faces_.AddRange(bad_faces, GH_Path(i, k))\n\n        return good_breps_, bad_breps_, bad_faces_\n",
  "language": "python",
  "imports": [
    "Rhino",
    "Rhino.Geometry"
  ],
  "has_docstring": true
}